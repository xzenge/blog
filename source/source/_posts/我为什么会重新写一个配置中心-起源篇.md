---
title: 我为什么会手撸一个配置中心--起源篇
date: 2020-03-19 22:16:13
tags: 
    - Java
    - Redis
    - 配置中心
categories :
    - Technology
---

## 聊聊后端的工作
作为一个后端狗最怕的有几件事：
1. 需求做也做不完就罢辽，隔三差五的业务同学还会跑来说“大锅，昨天上架的产品麻烦调整下文案”。。。
2. 好不容易做完了需求并且熬到了上线，第二天产品过来说“老弟，那个需求被监管部门勒令下架了，能把那个功能下了不”。。。
3. 代码敲的开心的时候，隔壁老大跑过来说“兄弟，之前那个XX报表不错啊，也定时发我一份”。。。
<!-- more -->
上面的场景大家认识我的不要对号入座哈，作为个后端狗，最怕的就是重复劳动。

产品的文案、业务的开关、报表的收件人等等这些我们都可以叫做业务配置，一个合格的开发也能在需求设计阶段将这些配置从需求中提炼出来并进行配置化，方便日后的变更。
那么，不是说配置能变更我们就没事了。

首先，如果基于spring开发的小伙伴肯定会想到spring自带的配置文件。
通过配置文件的隔离，我们完全能够隔离出dev、staging、prod甚至更多环境的配置。每当配置有变更我们只需要修改相应环境的配置，并重新部署就OK了。

<font color=red >这样好吗？</font>答案是没什么不好。<font color=red >但是优雅吗？</font>那必须是挫的一塌糊涂。
互联网的根基就是快速尝试、快速落地、反复尝试从而寻找到最优的解决方案。
业务在不断的尝试过程中，或许会蹦出个大神拍着脑袋说“我觉得客户要的就是这个，这么那么做准没错”。但现实往往证明我们都是普通人，成为别人肚子里的蛔虫那是多么困难的一件事。
所以需求的反反复复，代码的来来回回就是一个后端狗的日常。

## 配置中心的出现
那在这种快速变化的场景下，我们作为开发能做些什么呢？答案其实很简答，古人都说了“大道化简”，那自然是有变化我们就拥抱变化。
但一个聪明或者说懒惰的程序员在拥抱变化的同时最重要的工作就是寻找那个不变。代码的抽象、业务的抽象时我们日后服务搭建的根基。自然我们上面说道的配置当然也是。

聪明的程序员早就把这些繁杂的工作抽离了出来，配置中心而然而然的孕育出世。百度的Disconf、携程的Apollo、阿里的Nacos、Spring Cloud的Spring Cloud Config。
后面我会专门聊聊这几个常见的配置中心的优劣。

## 我为什么手撸个配置中心
那还要回到1年前，我们公司最为创业公司，业务刚刚起步。为了快速的业务落地，我们也是能来什么就来什么，时间长了我们发现了一个很重要的问题：<font color=red >发版成分太高</font>。

相信每个做开发的小伙伴都有体会，晚上发版是一件多么让人惆怅的事情啊。。。但更让人惆怅的是，本来只是一个小小的配置变更，却还要等到晚上才能重新上线，着实让人受不了。从那个时候开始，我们就打算引入配置中心了。

首先调研配置中心的小伙伴经过几个现存开源系统的比较，最后选定了百度的Disconf。说上就上，Disconf就在我们的系统中愉快的奔跑起来了。

1年过去了，系统越来越复杂，业务越来越繁琐，当初那个人见人爱的Disconf不时的变成了我们午饭时诟病的谈资。当然并不是Disconf本身不好，不过失去维护的社区本身也是它问题的一环。但最重要的一点是，Disconf本身已经慢慢不适合我们的业务了。可能会有些小伙伴说，那就使用更强大的Apollo，或者Nacos。Apollo本身固然强大，但一个第三方系统始终无法契合我们现在的业务场景，Nacos也有同样的问题，才外由于我们使用的是Spring Cloud的全家桶，若引入Nacos，必然需要升级到Alibaba Spring Cloud。想必风险和工作量只增无减。

因此在这样的一个大前提下，我们冒出了“我什么不自己手撸个配置中心”的想法。

## 配置中心 nadia-config
自我打个广告，我的配置中心已经上线了，并且第一版也已经开源，欢迎大家拍砖 
>https://github.com/nadia-repository/nadia-config

