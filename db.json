{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/minos/source/css/insight.scss","path":"css/insight.scss","modified":0,"renderable":1},{"_id":"themes/minos/source/images/check.svg","path":"images/check.svg","modified":0,"renderable":1},{"_id":"themes/minos/source/images/exclamation.svg","path":"images/exclamation.svg","modified":0,"renderable":1},{"_id":"themes/minos/source/css/style.scss","path":"css/style.scss","modified":0,"renderable":1},{"_id":"themes/minos/source/images/info.svg","path":"images/info.svg","modified":0,"renderable":1},{"_id":"themes/minos/source/images/quote-left.svg","path":"images/quote-left.svg","modified":0,"renderable":1},{"_id":"themes/minos/source/images/question.svg","path":"images/question.svg","modified":0,"renderable":1},{"_id":"themes/minos/source/images/logo.png","path":"images/logo.png","modified":0,"renderable":1},{"_id":"themes/minos/source/js/insight.js","path":"js/insight.js","modified":0,"renderable":1},{"_id":"themes/minos/source/js/script.js","path":"js/script.js","modified":0,"renderable":1}],"Cache":[{"_id":"themes/minos/package-lock.json","hash":"1fdf3ebc293bb2df47fe5c4f833c6797d5e8a546","modified":1568123082064},{"_id":"themes/minos/package.json","hash":"76b6439e405b7b479535d40bad6d982957ac4fa7","modified":1568123082064},{"_id":"source/_posts/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘.md","hash":"1be1eb02ea07fea82d2bf0de762c44741c0098ed","modified":1568123081980},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1.md","hash":"abb3897bcec40ba8bf9f07386ac3820a284f6054","modified":1568123081984},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°3.md","hash":"dbc3737adfd45fb433822e6dab03a34bcf14e5bc","modified":1568555428396},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°2.md","hash":"21c2f49bd18fa61934828232874d5fc15d0622da","modified":1568364415468},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4.md","hash":"b4aad08cd9bcdf1b3ea0440c98570aab40cbddf6","modified":1569508266218},{"_id":"source/_posts/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜.md","hash":"6b4a6dc64a788ba67b8770aab540ccc2677d0a27","modified":1569416064699},{"_id":"source/_posts/ğŸ‡.md","hash":"adfbcb468c817b983da9a7ad51c6a395d485827d","modified":1568123081985},{"_id":"source/about/index.md","hash":"bbf18ec9fc016f66677fb4ecbd2af36e0b84a524","modified":1568123082019},{"_id":"source/categories/index.md","hash":"ad9ccb8c69e08c4be734e7e43a7e4a6006ca2b48","modified":1568123082020},{"_id":"source/_posts/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜.md","hash":"86431da9023475677bd070abfa185f1288ada40d","modified":1568123081982},{"_id":"themes/minos/_config.yml","hash":"ee1969d0383458a95f1bf4b9341c2db8b1a88e13","modified":1568123082051},{"_id":"source/_posts/æœå¯»æµæµªç‹—APP.md","hash":"da3798077751cb9526113d1f572d99eb4c1bb37f","modified":1568123081984},{"_id":"source/tags/index.md","hash":"cbee60ff133d01e398473d8e266136f13eeda969","modified":1568123082020},{"_id":"themes/minos/languages/en.yml","hash":"b0106e055e348cff3dc04bbfa92eaf078887914a","modified":1568123082052},{"_id":"themes/minos/languages/fr.yml","hash":"14fe6ca8e0dc50791e1c4d2e190bf75774c1bf0f","modified":1568123082052},{"_id":"themes/minos/languages/es.yml","hash":"2492235c429294caef66d220d2b958d147d2a8e7","modified":1568123082052},{"_id":"themes/minos/languages/ko.yml","hash":"5cdf4a031fc3fcbab392dec89053e2417485e4c7","modified":1568123082052},{"_id":"themes/minos/languages/ru.yml","hash":"c7d59fc5906eeb9230ca794515cabd6064e853bc","modified":1568123082053},{"_id":"themes/minos/languages/zh-cn.yml","hash":"ba7eabb49391804f1d83acd1a4e03d1a73e02089","modified":1568123082053},{"_id":"themes/minos/languages/zh-tw.yml","hash":"235107d79bc8a6e0796d46fb409045c7c5142865","modified":1568123082053},{"_id":"themes/minos/layout/category.ejs","hash":"587fc7dac77115589ed8cb368ed4a8a2a6f129af","modified":1568123082054},{"_id":"themes/minos/layout/archive.ejs","hash":"4239b7b97f02d86e83878ee0c32b0eccb9893420","modified":1568123082054},{"_id":"themes/minos/layout/categories.ejs","hash":"b609b00fd03b521689dfc2d267aead94d49fcc80","modified":1568123082054},{"_id":"themes/minos/layout/index.ejs","hash":"64c432857172b1c775bf82c0a60ca1ecdc7d9d21","modified":1568123082059},{"_id":"themes/minos/layout/layout.ejs","hash":"d1293320d738ac7f097869a4e74f6089a79d1c46","modified":1568123082059},{"_id":"themes/minos/layout/post.ejs","hash":"bba00a681d797817baf34737467be2eca3bdcfbb","modified":1568123082061},{"_id":"themes/minos/layout/tag.ejs","hash":"b72bf2ebd9c5d9d7546f448a4331f13dc6b49950","modified":1568123082063},{"_id":"themes/minos/lib/i18n.js","hash":"89a99d1d69cf8ca6be326880a8b01809535e8ac8","modified":1568123082063},{"_id":"themes/minos/lib/rfc5646.js","hash":"50de178e1fcd2224c99db56227652eb1dbaabe40","modified":1568123082064},{"_id":"themes/minos/layout/tags.ejs","hash":"9b54bfb0c56e54ff89da9a0a390414ef13a14931","modified":1568123082063},{"_id":"themes/minos/scripts/01_check.js","hash":"799fee2a7e989e211a1727f3f52cec47ae887b18","modified":1568123082065},{"_id":"themes/minos/scripts/10_i18n.js","hash":"2383fb5519c9966d27081c276203f961fcb6b783","modified":1568123082065},{"_id":"themes/minos/scripts/99_config.js","hash":"c4496562e4ecae5e49dbc57490edae0682f77989","modified":1568123082065},{"_id":"themes/minos/scripts/99_tags.js","hash":"30b235e1deaa1a857aeb62bfd7c672a6e5762723","modified":1568123082066},{"_id":"themes/minos/scripts/99_content.js","hash":"d73731b1eecbef4874621bf35e4ed70ca3fd8979","modified":1568123082066},{"_id":"source/_posts/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘/nolayout.jpg","hash":"b7e6217718a630562255060b224ee116d1caf824","modified":1568123081981},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1/gopath.png","hash":"651d1a1fb00e3250828a1e1570d1ee3f842774ca","modified":1568123081984},{"_id":"source/_posts/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/springCache.png","hash":"244dfd7e60a2e01dbd8ed66d5f0828db5737c32d","modified":1568123081982},{"_id":"themes/minos/layout/comment/changyan.ejs","hash":"e0a2716e7a6c7da26182135fce4776596761a699","modified":1568123082055},{"_id":"themes/minos/layout/comment/facebook.ejs","hash":"cd2fe44bc6be457d4cb6dc43c75023e9f83d66f7","modified":1568123082055},{"_id":"themes/minos/layout/comment/disqus.ejs","hash":"2e35b7578478cf25544ae7f4b3535521ad73c5a2","modified":1568123082055},{"_id":"themes/minos/layout/comment/isso.ejs","hash":"55bfe636859f118b40750bd36e2c3ef1a2ec4c0e","modified":1568123082056},{"_id":"themes/minos/layout/comment/gitment.ejs","hash":"033fb890dc1de71f7d3b97061d0d75f4564bd09a","modified":1568123082055},{"_id":"themes/minos/layout/comment/youyan.ejs","hash":"bcb4b7282a7bcfcb514133e752c0f9d606b3c4d5","modified":1568123082057},{"_id":"themes/minos/layout/comment/livere.ejs","hash":"792a1e44b71ed8048903ea898aeaf74a6c109037","modified":1568123082056},{"_id":"themes/minos/layout/comment/valine.ejs","hash":"4400de3b0d2d16e2c3e79d1f6ea0841395bd5477","modified":1568123082056},{"_id":"themes/minos/layout/common/article.ejs","hash":"8b553b16b23e4e2712442426d7a35f7ec80f22a7","modified":1568123082057},{"_id":"themes/minos/layout/common/footer.ejs","hash":"c52c678e3fd336651dd1fd7e7241515adb52a897","modified":1568123082057},{"_id":"themes/minos/layout/common/head.ejs","hash":"4b3085f2fe06f684b8e12184dcbbdffb05509d20","modified":1568123082058},{"_id":"themes/minos/layout/common/languages.ejs","hash":"9b503282ca6e665ca41412b277debf4cd15635fd","modified":1568123082058},{"_id":"themes/minos/layout/common/navbar.ejs","hash":"075b13ec8d6450bad5f6080505449630ffecb66a","modified":1568123082058},{"_id":"themes/minos/layout/common/scripts.ejs","hash":"0262a28c2e0f4a9e57fe1da871c517909710eca3","modified":1568123082059},{"_id":"themes/minos/layout/common/paginator.ejs","hash":"2ea7e6c7349d4529bfcfd50c51088c7475743686","modified":1568123082058},{"_id":"themes/minos/layout/plugins/clipboard.ejs","hash":"3ba8b96450707cef02f243c9ec4688b1adf06c72","modified":1568123082060},{"_id":"themes/minos/layout/plugins/gallery.ejs","hash":"a1b9814c597f0e6b74be2bb5550e50c2915ae482","modified":1568123082060},{"_id":"themes/minos/layout/plugins/google-analytics.ejs","hash":"725fd626b6535c6d05b88e736eeefbca6d39e7e8","modified":1568123082060},{"_id":"themes/minos/layout/plugins/mathjax.ejs","hash":"461c9b17ceddfdfd15ce4ed648d903953d2c7e9b","modified":1568123082061},{"_id":"themes/minos/layout/share/addthis.ejs","hash":"9cc26da261527bbba8b0180e0f73e0c6ae5416b5","modified":1568123082062},{"_id":"themes/minos/layout/search/insight.ejs","hash":"2ef94c3ddae02db57c9dc5cf69da72b1c90c9236","modified":1568123082062},{"_id":"themes/minos/layout/share/sharethis.ejs","hash":"307d905cd39ac4908ef5589829a18777f314428d","modified":1568123082062},{"_id":"themes/minos/layout/plugins/katex.ejs","hash":"9fbd9065ead2f35a2f69f9e0b2421b5bc0ae81b5","modified":1568123082060},{"_id":"themes/minos/layout/search/google-cse.ejs","hash":"ab3aa6c57d7dd045b8838280548aa447ec38ffa6","modified":1568123082061},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4/è¿è¡Œæ—¶æ•°æ®åŒº.png","hash":"5057a5c3a444bc1720a6bf1951d4d3c373386042","modified":1569507719971},{"_id":"source/_posts/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/å¤šçº§ç¼“å­˜.png","hash":"22fa4a74b7c688ad6fbb3a3a56c585d2acf0dfef","modified":1568123081983},{"_id":"themes/minos/source/css/insight.scss","hash":"b7340f343e8bfe967b21b502d6cb5b78295fd9e0","modified":1568123082067},{"_id":"themes/minos/source/images/check.svg","hash":"16e9a53d7c49621be8e3f1a28b11bcf5e751105e","modified":1568123082067},{"_id":"themes/minos/source/images/exclamation.svg","hash":"213125a083bcef89806b4285190e050eef2660f2","modified":1568123082068},{"_id":"themes/minos/source/css/style.scss","hash":"063f69c121ffab9f809c41bb088c1e177a9bd4c7","modified":1568123082067},{"_id":"themes/minos/source/images/info.svg","hash":"60613abd8f8522c6cebdbb4bf7bf3fcc482245bd","modified":1568123082068},{"_id":"themes/minos/source/images/quote-left.svg","hash":"d2561fa8d13e63ff196b71232a5968415ec6e372","modified":1568123082069},{"_id":"themes/minos/source/images/question.svg","hash":"e4005d2eabfbd3bdd291236f56a4d385e3b337b2","modified":1568123082068},{"_id":"themes/minos/source/images/logo.png","hash":"4e012d9ba58cb8f87ee775262ef871c158ac5948","modified":1568123082068},{"_id":"themes/minos/source/js/insight.js","hash":"4be407e66c2c45333a8cf1a064a9302cd6d90422","modified":1568123082069},{"_id":"themes/minos/source/js/script.js","hash":"b51152561a894d1b0afee2d908364e69b253bfc2","modified":1568123082069},{"_id":"source/_posts/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜/wenti.png","hash":"e6843d420e7ad46c852f2f041812eb927fb1399d","modified":1569416064701},{"_id":"source/_posts/ğŸ‡/ç‰Œå­.jpeg","hash":"24f95dd5ddc228a74e8ff4887a29431510ec6620","modified":1568123082019},{"_id":"source/_posts/ğŸ‡/å…¨æ™¯.jpeg","hash":"147aba5c942fd21ed61065267d438905756dc1fb","modified":1568123082002},{"_id":"public/content.json","hash":"e803614230d7123d6ee712850561675921fe3049","modified":1569508274023},{"_id":"public/about/index.html","hash":"06b638a6693e1d0db3f96a5cc3ba6550a1722391","modified":1569507763794},{"_id":"public/categories/index.html","hash":"7bcc5cdc4f834f8210d24c40eb42cc9792b515e7","modified":1569507763794},{"_id":"public/tags/index.html","hash":"e778552421e29690e3bc2df2fbe85433fd15419b","modified":1569507764028},{"_id":"public/2019/09/26/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4/index.html","hash":"a66a73082ffbdf276ee62bdf0311d8b203cd24f7","modified":1569508274394},{"_id":"public/2019/09/24/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜/index.html","hash":"cf38c007e1676a7bc006e126ffb2d108926404c1","modified":1569507764033},{"_id":"public/2019/09/13/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°3/index.html","hash":"6ddc827adf895768c983af8ed189e48b1ebdca0f","modified":1569507764033},{"_id":"public/2019/09/07/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘/index.html","hash":"1738abe01ccb4701e426b9bf509f5bc0ef914dc9","modified":1569507764037},{"_id":"public/2019/09/06/æœå¯»æµæµªç‹—APP/index.html","hash":"0131a7ae280771948075030808dd7dff5600226d","modified":1569507764037},{"_id":"public/2019/09/05/ğŸ‡/index.html","hash":"fb8da487c5a2e1e9c46ddc46277797c192593b95","modified":1569507764037},{"_id":"public/archives/index.html","hash":"939aa80c53a331bd35ed2cfe4f4c170afbc35c61","modified":1569507764037},{"_id":"public/archives/2019/index.html","hash":"6369070363ade10feb623e652f1451d5b55755e0","modified":1569507764037},{"_id":"public/archives/2019/09/index.html","hash":"3d71a5fb6544122ce2b2e947b266279238733268","modified":1569507764037},{"_id":"public/categories/Life/index.html","hash":"f4ddde1f4dc23fc8d1a754218e2e7b2df633a9da","modified":1569507764037},{"_id":"public/categories/Translation/index.html","hash":"bdc8d530a9d3f0403c3ec417bad02ad3f678c437","modified":1569507764037},{"_id":"public/tags/Hexo/index.html","hash":"960105a763eb872a91fbe90f16cd307cffac35b0","modified":1569507764037},{"_id":"public/tags/JVM/index.html","hash":"7575e46dd2d9ef89962b2d37094f9db917e28150","modified":1569508274393},{"_id":"public/tags/Go/index.html","hash":"f7e669537fe648d7e9d70cbba1cd49d0ada45bbc","modified":1569508274393},{"_id":"public/tags/Spring-Boot/index.html","hash":"a6040eece2e304059b03b231ca9fb7133a088f9d","modified":1569507764037},{"_id":"public/tags/Redis/index.html","hash":"bdf423d9f1df94e71aa5d983fe0e722e6c7edd3d","modified":1569507764037},{"_id":"public/tags/Cache/index.html","hash":"5a21d8a069ffb48e6bec5b2530d70d8cd3d1ca2e","modified":1569507764037},{"_id":"public/tags/Food/index.html","hash":"f9de5d723f14cfef4a1a8438458fcd4cd5385563","modified":1569507764037},{"_id":"public/tags/AI/index.html","hash":"42c6bb84e4771ca6e2de1060877d86f850d0ccf7","modified":1569507764037},{"_id":"public/tags/APP/index.html","hash":"6c3ec5294618daf3f71571fcdcf1d35e349553f1","modified":1569507764037},{"_id":"public/2019/09/10/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°2/index.html","hash":"d4c7a927def8389db630763d16fe8937f261cf56","modified":1569507764037},{"_id":"public/2019/09/09/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1/index.html","hash":"b65f42cd6a18211cfe28d8a74ab783e820b8372d","modified":1569507764037},{"_id":"public/2019/09/04/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/index.html","hash":"818041f2658474b8333ca0d773354de53d246bc2","modified":1569507764037},{"_id":"public/categories/Technology/index.html","hash":"32cab07dd17554d9b2e37a119c9097d1697ca2d7","modified":1569508274394},{"_id":"public/tags/Java/index.html","hash":"4f1ce73e648296b4a66ef13c6c9ab5415995c889","modified":1569508274394},{"_id":"public/index.html","hash":"7f853cc2a9f40fe4304c2b481d22b77abfac8b3b","modified":1569508274394},{"_id":"public/images/exclamation.svg","hash":"213125a083bcef89806b4285190e050eef2660f2","modified":1569507764038},{"_id":"public/images/check.svg","hash":"16e9a53d7c49621be8e3f1a28b11bcf5e751105e","modified":1569507764038},{"_id":"public/images/info.svg","hash":"60613abd8f8522c6cebdbb4bf7bf3fcc482245bd","modified":1569507764038},{"_id":"public/images/quote-left.svg","hash":"d2561fa8d13e63ff196b71232a5968415ec6e372","modified":1569507764038},{"_id":"public/images/logo.png","hash":"4e012d9ba58cb8f87ee775262ef871c158ac5948","modified":1569507764038},{"_id":"public/images/question.svg","hash":"e4005d2eabfbd3bdd291236f56a4d385e3b337b2","modified":1569507764038},{"_id":"public/2019/09/07/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘/nolayout.jpg","hash":"b7e6217718a630562255060b224ee116d1caf824","modified":1569507764038},{"_id":"public/2019/09/09/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1/gopath.png","hash":"651d1a1fb00e3250828a1e1570d1ee3f842774ca","modified":1569507764038},{"_id":"public/2019/09/04/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/springCache.png","hash":"244dfd7e60a2e01dbd8ed66d5f0828db5737c32d","modified":1569507764038},{"_id":"public/2019/09/26/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4/è¿è¡Œæ—¶æ•°æ®åŒº.png","hash":"5057a5c3a444bc1720a6bf1951d4d3c373386042","modified":1569507764049},{"_id":"public/2019/09/04/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/å¤šçº§ç¼“å­˜.png","hash":"22fa4a74b7c688ad6fbb3a3a56c585d2acf0dfef","modified":1569507764050},{"_id":"public/js/script.js","hash":"6b670ec4f90fb43b21a0bbd750a217af5d8aab6b","modified":1569507764052},{"_id":"public/2019/09/24/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜/wenti.png","hash":"e6843d420e7ad46c852f2f041812eb927fb1399d","modified":1569507764052},{"_id":"public/js/insight.js","hash":"eb23c31141784eef7300f1d1c548950e77883f56","modified":1569507764053},{"_id":"public/css/insight.css","hash":"f376dcda6bb50b708f3206c15a49f7530b3c534d","modified":1569507764070},{"_id":"public/css/style.css","hash":"4e7a159e292129b1abbdcabc69aad37c4eb5fc8e","modified":1569507764079},{"_id":"public/2019/09/05/ğŸ‡/ç‰Œå­.jpeg","hash":"24f95dd5ddc228a74e8ff4887a29431510ec6620","modified":1569507764104},{"_id":"public/2019/09/05/ğŸ‡/å…¨æ™¯.jpeg","hash":"147aba5c942fd21ed61065267d438905756dc1fb","modified":1569507764107}],"Category":[{"name":"Technology","_id":"ck10secr80004jony05qszx6a"},{"name":"Life","_id":"ck10secrm000ljonymrd4536o"},{"name":"Translation","_id":"ck10secrn000pjony0ehwfsyr"}],"Data":[],"Page":[{"title":"about","date":"2019-09-04T03:48:57.000Z","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2019-09-04 11:48:57\n---\n","updated":"2019-09-10T13:44:42.019Z","path":"about/index.html","comments":1,"layout":"page","_id":"ck10secr40001jony2c5pph68","content":"","site":{"data":{}},"_categories":[],"_tags":[],"excerpt":"","more":""},{"title":"categories","date":"2019-09-04T03:49:09.000Z","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2019-09-04 11:49:09\n---\n","updated":"2019-09-10T13:44:42.020Z","path":"categories/index.html","comments":1,"layout":"page","_id":"ck10secr70003jonyldyrvavr","content":"","site":{"data":{}},"_categories":[],"_tags":[],"excerpt":"","more":""},{"title":"tags","date":"2019-09-04T03:48:44.000Z","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2019-09-04 11:48:44\n---\n","updated":"2019-09-10T13:44:42.020Z","path":"tags/index.html","comments":1,"layout":"page","_id":"ck10secra0007jonykvdmh24e","content":"","site":{"data":{}},"_categories":[],"_tags":[],"excerpt":"","more":""}],"Post":[{"title":"hexoæ­å»ºé—®é¢˜ã€ no layout: index.htmlã€‘","date":"2019-09-07T08:03:18.000Z","_content":"\nç”±äºåœ¨å…¬å¸éƒ½æ˜¯ç”¨MACå†™åšå®¢ï¼Œå›åˆ°å®¶æƒ³ç”¨Windowsæ­ä¸€å¥—ç¯å¢ƒã€‚\n\nä½†æ˜¯å¯åŠ¨çš„æ—¶å€™æ€»æ˜¯æç¤ºno layout: index.html çš„é”™è¯¯ã€‚\n\næ‰¾äº†åŠå¤©åŸå› åŸæ¥æ˜¯ä¸ªå¾ˆå‚»çš„é—®é¢˜ï¼Œè¿™é‡Œmarkä¸‹ä»¥å…ä¸‹æ¬¡å†çŠ¯ã€‚\n\n{% asset_img nolayout.jpg 200 200 no layout %}\n\næ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼","source":"_posts/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘.md","raw":"---\ntitle: 'hexoæ­å»ºé—®é¢˜ã€ no layout: index.htmlã€‘'\ndate: 2019-09-07 16:03:18\ntags: \n    - Hexo\ncategories :\n    - Technology\n---\n\nç”±äºåœ¨å…¬å¸éƒ½æ˜¯ç”¨MACå†™åšå®¢ï¼Œå›åˆ°å®¶æƒ³ç”¨Windowsæ­ä¸€å¥—ç¯å¢ƒã€‚\n\nä½†æ˜¯å¯åŠ¨çš„æ—¶å€™æ€»æ˜¯æç¤ºno layout: index.html çš„é”™è¯¯ã€‚\n\næ‰¾äº†åŠå¤©åŸå› åŸæ¥æ˜¯ä¸ªå¾ˆå‚»çš„é—®é¢˜ï¼Œè¿™é‡Œmarkä¸‹ä»¥å…ä¸‹æ¬¡å†çŠ¯ã€‚\n\n{% asset_img nolayout.jpg 200 200 no layout %}\n\næ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼","slug":"hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘","published":1,"updated":"2019-09-10T13:44:41.980Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck10secr00000jony8g4p9j8y","content":"<p>ç”±äºåœ¨å…¬å¸éƒ½æ˜¯ç”¨MACå†™åšå®¢ï¼Œå›åˆ°å®¶æƒ³ç”¨Windowsæ­ä¸€å¥—ç¯å¢ƒã€‚</p>\n<p>ä½†æ˜¯å¯åŠ¨çš„æ—¶å€™æ€»æ˜¯æç¤ºno layout: index.html çš„é”™è¯¯ã€‚</p>\n<p>æ‰¾äº†åŠå¤©åŸå› åŸæ¥æ˜¯ä¸ªå¾ˆå‚»çš„é—®é¢˜ï¼Œè¿™é‡Œmarkä¸‹ä»¥å…ä¸‹æ¬¡å†çŠ¯ã€‚</p>\n<img src=\"/2019/09/07/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘/nolayout.jpg\" width=\"200\" height=\"200\" title=\"no layout\">\n\n<p>æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼</p>\n","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Hexo","path":"tags/Hexo/"}],"excerpt":"","more":"<p>ç”±äºåœ¨å…¬å¸éƒ½æ˜¯ç”¨MACå†™åšå®¢ï¼Œå›åˆ°å®¶æƒ³ç”¨Windowsæ­ä¸€å¥—ç¯å¢ƒã€‚</p>\n<p>ä½†æ˜¯å¯åŠ¨çš„æ—¶å€™æ€»æ˜¯æç¤ºno layout: index.html çš„é”™è¯¯ã€‚</p>\n<p>æ‰¾äº†åŠå¤©åŸå› åŸæ¥æ˜¯ä¸ªå¾ˆå‚»çš„é—®é¢˜ï¼Œè¿™é‡Œmarkä¸‹ä»¥å…ä¸‹æ¬¡å†çŠ¯ã€‚</p>\n<img src=\"/2019/09/07/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘/nolayout.jpg\" width=\"200\" height=\"200\" title=\"no layout\">\n\n<p>æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼</p>\n"},{"title":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°1","date":"2019-09-09T14:18:50.000Z","_content":"\n## ç¯å¢ƒé…ç½®\n1. å®‰è£…Golang\n   \n{% blockquote %}\nhttps://golang.google.cn/\n{% endblockquote %}\n\n2. è®¾ç½®Goç¯å¢ƒå˜é‡\n\n{% asset_img gopath.png GOPATH %}\n\nåŒæ—¶è¦æ³¨æ„ï¼Œgoçš„å·¥ä½œç›®å½•ä¸ºè¯¥ç›®å½•ï¼Œå¦‚æœéœ€è¦åˆ‡æ¢éœ€è¦æ”¹å˜æ­¤è·¯å¾„ï¼Œä¸ç„¶å¯ä½¿ç”¨GoLandç­‰ideåˆ‡æ¢ã€‚\n<!-- more -->\n\n## ç®€å•å®ç°javaå‘½ä»¤\njava SDKè‡ªå¸¦å¾ˆå¤šå‘½ä»¤ï¼Œå¦‚javaã€javacã€javapç­‰ã€‚\njavaå‘½ä»¤æ˜¯å…¶ä¸­æœ€ç»ˆè¦çš„ä¸€ä¸ªï¼Œå¹³æ—¶æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªjarï¼Œå¦‚springbootå·¥ç¨‹ã€‚è¿˜æ˜¯ä¸€ä¸ªåŸºäºtomcatã€weblogicã€jbossçš„waråŒ…ã€‚å…¶æ ¹æœ¬éƒ½æ˜¯åˆ©ç”¨javaå‘½ä»¤æ‰§è¡Œmainæ–¹æ³•ä¸ºå…¥å£ã€‚\n\n{% codeblock %}\njava [-options] class [args]\njava [-options] -jar jarfile [args]\njavaw [-options] class [args]\njavaw [-options] -jar jarfile [args]\n{% endcodeblock %}\n\n{% blockquote %}\nå®˜æ–¹è¯´æ˜ï¼š  https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html\n{% endblockquote %}\n\n## ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\n1. javaå‘½ä»¤å…¥å‚ç»“æ„\n\n{% codeblock lang:go %}\ntype Cmd struct {\n\thelpFlag bool //å‘½ä»¤ä¸ºhelp æˆ– ? æ—¶ï¼štrue\n\tversionFlag bool //å‘½ä»¤æ˜¯å¦ä¸ºversionæ—¶ï¼štrue\n\tcpOption string //å‘½ä»¤ä¸ºcp æˆ– classpathæ—¶ï¼Œä¿å­˜å€¼\n\tXjreOption string //å‘½ä»¤ä¸ºXjreæ—¶ï¼Œä¿å­˜å€¼\n\tclass string //ä¿å­˜class\n\targs []string //ä¿å­˜å…¶ä»–å…¥å‚\n}\n{% endcodeblock %}\n\n2. è§£æå…¥å‚\n\n{% codeblock lang:go %}\nfunc parseCmd() *Cmd {\n\tcmd := &Cmd{} //å®ä¾‹åŒ–å…¥å‚å¯¹è±¡\n\tflag.Usage = printUsage //è®¾ç½®ç”¨æ³•è¯´æ˜\n\tflag.BoolVar(&cmd.helpFlag,\"help\",false,\"print help message\") //å‚æ•°ä¸ºhelpæ—¶ï¼Œ&cmd.helpFlag = true\n\tflag.BoolVar(&cmd.helpFlag,\"?\",false,\"print help message\") //å‚æ•°ä¸º?æ—¶ï¼Œ&cmd.helpFlag = true\n\tflag.BoolVar(&cmd.versionFlag,\"version\",false,\"print version and exit\") //å‚æ•°ä¸ºversionæ—¶ï¼Œ&cmd.versionFlag = true\n\tflag.StringVar(&cmd.cpOption,\"cp\",\"\",\"classpath\") //å‚æ•°ä¸ºversionæ—¶ï¼Œ&cmd.versionFlag = true\n\tflag.StringVar(&cmd.cpOption,\"classpath\",\"\",\"classpath\")\n\tflag.StringVar(&cmd.XjreOption,\"Xjre\",\"\",\"path to jres\")\n\tflag.Parse()\n\targs := flag.Args()\n\tif len(args) > 0 {\n\t\tcmd.class = args[0]\n\t\tcmd.args = args[1:]\n\t}\n\treturn cmd\n}\n\nfunc printUsage() {\n\tfmt.Printf(\"Usage: %s [-options] class [args...]\\n\",os.Args[0])\n}\n{% endcodeblock %}\n\n3. å¯åŠ¨æ–¹æ³•\n\n\n{% codeblock lang:go %}\nfunc main () {\n\tcmd := parseCmd() //è§£ææ–¹æ³•\n\tif cmd.versionFlag {\n\t\tfmt.Println(\"version 0.0.1\") //å…¥å‚ä¸ºversionæ—¶æ‰“å°ç‰ˆæœ¬å·\n\t} else if cmd.helpFlag || cmd.class == \"\" {\n\t\tprintUsage() //å…¥å‚ä¸ºhelpæˆ–?æˆ–classpathã€cpä¸ºç©ºæ—¶æ‰“å°è¯´æ˜\n\t}else {\n\t\tstartJVM(cmd) //å¯åŠ¨JVM\n\t}\n}\n\nfunc startJVM(cmd *Cmd){\n\tfmt.Printf(\"classpath:%s class:%s args:%v\",cmd.cpOption,cmd.class,cmd.args)\n}\n{% endcodeblock %}\n\n4. è¯•è¿è¡Œ\n\n{% codeblock lang:shell %}\nD:\\work\\workspace_go\\src\\jvmgo\\ch01> go install\n\nPS D:\\work\\workspace_go\\bin> .\\ch01.exe -version\nversion 0.0.1\n\nPS D:\\work\\workspace_go\\bin> .\\ch01.exe -help\nUsage: D:\\work\\workspace_go\\bin\\ch01.exe [-options] class [args...]\n\nPS D:\\work\\workspace_go\\bin> .\\ch01.exe -cp test.class a b c\nclasspath:test.class class:a args:[b c]\n{% endcodeblock %}","source":"_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1.md","raw":"---\ntitle: è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°1\ndate: 2019-09-09 22:18:50\ntags: \n    - JVM\n    - Java\n    - Go\ncategories :\n    - Technology\n---\n\n## ç¯å¢ƒé…ç½®\n1. å®‰è£…Golang\n   \n{% blockquote %}\nhttps://golang.google.cn/\n{% endblockquote %}\n\n2. è®¾ç½®Goç¯å¢ƒå˜é‡\n\n{% asset_img gopath.png GOPATH %}\n\nåŒæ—¶è¦æ³¨æ„ï¼Œgoçš„å·¥ä½œç›®å½•ä¸ºè¯¥ç›®å½•ï¼Œå¦‚æœéœ€è¦åˆ‡æ¢éœ€è¦æ”¹å˜æ­¤è·¯å¾„ï¼Œä¸ç„¶å¯ä½¿ç”¨GoLandç­‰ideåˆ‡æ¢ã€‚\n<!-- more -->\n\n## ç®€å•å®ç°javaå‘½ä»¤\njava SDKè‡ªå¸¦å¾ˆå¤šå‘½ä»¤ï¼Œå¦‚javaã€javacã€javapç­‰ã€‚\njavaå‘½ä»¤æ˜¯å…¶ä¸­æœ€ç»ˆè¦çš„ä¸€ä¸ªï¼Œå¹³æ—¶æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªjarï¼Œå¦‚springbootå·¥ç¨‹ã€‚è¿˜æ˜¯ä¸€ä¸ªåŸºäºtomcatã€weblogicã€jbossçš„waråŒ…ã€‚å…¶æ ¹æœ¬éƒ½æ˜¯åˆ©ç”¨javaå‘½ä»¤æ‰§è¡Œmainæ–¹æ³•ä¸ºå…¥å£ã€‚\n\n{% codeblock %}\njava [-options] class [args]\njava [-options] -jar jarfile [args]\njavaw [-options] class [args]\njavaw [-options] -jar jarfile [args]\n{% endcodeblock %}\n\n{% blockquote %}\nå®˜æ–¹è¯´æ˜ï¼š  https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html\n{% endblockquote %}\n\n## ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\n1. javaå‘½ä»¤å…¥å‚ç»“æ„\n\n{% codeblock lang:go %}\ntype Cmd struct {\n\thelpFlag bool //å‘½ä»¤ä¸ºhelp æˆ– ? æ—¶ï¼štrue\n\tversionFlag bool //å‘½ä»¤æ˜¯å¦ä¸ºversionæ—¶ï¼štrue\n\tcpOption string //å‘½ä»¤ä¸ºcp æˆ– classpathæ—¶ï¼Œä¿å­˜å€¼\n\tXjreOption string //å‘½ä»¤ä¸ºXjreæ—¶ï¼Œä¿å­˜å€¼\n\tclass string //ä¿å­˜class\n\targs []string //ä¿å­˜å…¶ä»–å…¥å‚\n}\n{% endcodeblock %}\n\n2. è§£æå…¥å‚\n\n{% codeblock lang:go %}\nfunc parseCmd() *Cmd {\n\tcmd := &Cmd{} //å®ä¾‹åŒ–å…¥å‚å¯¹è±¡\n\tflag.Usage = printUsage //è®¾ç½®ç”¨æ³•è¯´æ˜\n\tflag.BoolVar(&cmd.helpFlag,\"help\",false,\"print help message\") //å‚æ•°ä¸ºhelpæ—¶ï¼Œ&cmd.helpFlag = true\n\tflag.BoolVar(&cmd.helpFlag,\"?\",false,\"print help message\") //å‚æ•°ä¸º?æ—¶ï¼Œ&cmd.helpFlag = true\n\tflag.BoolVar(&cmd.versionFlag,\"version\",false,\"print version and exit\") //å‚æ•°ä¸ºversionæ—¶ï¼Œ&cmd.versionFlag = true\n\tflag.StringVar(&cmd.cpOption,\"cp\",\"\",\"classpath\") //å‚æ•°ä¸ºversionæ—¶ï¼Œ&cmd.versionFlag = true\n\tflag.StringVar(&cmd.cpOption,\"classpath\",\"\",\"classpath\")\n\tflag.StringVar(&cmd.XjreOption,\"Xjre\",\"\",\"path to jres\")\n\tflag.Parse()\n\targs := flag.Args()\n\tif len(args) > 0 {\n\t\tcmd.class = args[0]\n\t\tcmd.args = args[1:]\n\t}\n\treturn cmd\n}\n\nfunc printUsage() {\n\tfmt.Printf(\"Usage: %s [-options] class [args...]\\n\",os.Args[0])\n}\n{% endcodeblock %}\n\n3. å¯åŠ¨æ–¹æ³•\n\n\n{% codeblock lang:go %}\nfunc main () {\n\tcmd := parseCmd() //è§£ææ–¹æ³•\n\tif cmd.versionFlag {\n\t\tfmt.Println(\"version 0.0.1\") //å…¥å‚ä¸ºversionæ—¶æ‰“å°ç‰ˆæœ¬å·\n\t} else if cmd.helpFlag || cmd.class == \"\" {\n\t\tprintUsage() //å…¥å‚ä¸ºhelpæˆ–?æˆ–classpathã€cpä¸ºç©ºæ—¶æ‰“å°è¯´æ˜\n\t}else {\n\t\tstartJVM(cmd) //å¯åŠ¨JVM\n\t}\n}\n\nfunc startJVM(cmd *Cmd){\n\tfmt.Printf(\"classpath:%s class:%s args:%v\",cmd.cpOption,cmd.class,cmd.args)\n}\n{% endcodeblock %}\n\n4. è¯•è¿è¡Œ\n\n{% codeblock lang:shell %}\nD:\\work\\workspace_go\\src\\jvmgo\\ch01> go install\n\nPS D:\\work\\workspace_go\\bin> .\\ch01.exe -version\nversion 0.0.1\n\nPS D:\\work\\workspace_go\\bin> .\\ch01.exe -help\nUsage: D:\\work\\workspace_go\\bin\\ch01.exe [-options] class [args...]\n\nPS D:\\work\\workspace_go\\bin> .\\ch01.exe -cp test.class a b c\nclasspath:test.class class:a args:[b c]\n{% endcodeblock %}","slug":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1","published":1,"updated":"2019-09-10T13:44:41.984Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck10secr50002jony100co07u","content":"<h2 id=\"ç¯å¢ƒé…ç½®\"><a href=\"#ç¯å¢ƒé…ç½®\" class=\"headerlink\" title=\"ç¯å¢ƒé…ç½®\"></a>ç¯å¢ƒé…ç½®</h2><ol>\n<li>å®‰è£…Golang</li>\n</ol>\n<blockquote><p><a href=\"https://golang.google.cn/\" target=\"_blank\" rel=\"noopener\">https://golang.google.cn/</a></p>\n</blockquote>\n\n<ol start=\"2\">\n<li>è®¾ç½®Goç¯å¢ƒå˜é‡</li>\n</ol>\n<img src=\"/2019/09/09/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1/gopath.png\" title=\"GOPATH\">\n\n<p>åŒæ—¶è¦æ³¨æ„ï¼Œgoçš„å·¥ä½œç›®å½•ä¸ºè¯¥ç›®å½•ï¼Œå¦‚æœéœ€è¦åˆ‡æ¢éœ€è¦æ”¹å˜æ­¤è·¯å¾„ï¼Œä¸ç„¶å¯ä½¿ç”¨GoLandç­‰ideåˆ‡æ¢ã€‚</p>\n<a id=\"more\"></a>\n\n<h2 id=\"ç®€å•å®ç°javaå‘½ä»¤\"><a href=\"#ç®€å•å®ç°javaå‘½ä»¤\" class=\"headerlink\" title=\"ç®€å•å®ç°javaå‘½ä»¤\"></a>ç®€å•å®ç°javaå‘½ä»¤</h2><p>java SDKè‡ªå¸¦å¾ˆå¤šå‘½ä»¤ï¼Œå¦‚javaã€javacã€javapç­‰ã€‚<br>javaå‘½ä»¤æ˜¯å…¶ä¸­æœ€ç»ˆè¦çš„ä¸€ä¸ªï¼Œå¹³æ—¶æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªjarï¼Œå¦‚springbootå·¥ç¨‹ã€‚è¿˜æ˜¯ä¸€ä¸ªåŸºäºtomcatã€weblogicã€jbossçš„waråŒ…ã€‚å…¶æ ¹æœ¬éƒ½æ˜¯åˆ©ç”¨javaå‘½ä»¤æ‰§è¡Œmainæ–¹æ³•ä¸ºå…¥å£ã€‚</p>\n<figure class=\"highlight plain hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java [-options] class [args]</span><br><span class=\"line\">java [-options] -jar jarfile [args]</span><br><span class=\"line\">javaw [-options] class [args]</span><br><span class=\"line\">javaw [-options] -jar jarfile [args]</span><br></pre></td></tr></table></figure>\n\n<blockquote><p>å®˜æ–¹è¯´æ˜ï¼š  <a href=\"https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html\" target=\"_blank\" rel=\"noopener\">https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html</a></p>\n</blockquote>\n\n<h2 id=\"ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\"><a href=\"#ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\" class=\"headerlink\" title=\"ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\"></a>ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–</h2><ol>\n<li>javaå‘½ä»¤å…¥å‚ç»“æ„</li>\n</ol>\n<figure class=\"highlight go hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> Cmd <span class=\"hljs-keyword\">struct</span> &#123;</span><br><span class=\"line\">\thelpFlag <span class=\"hljs-keyword\">bool</span> <span class=\"hljs-comment\">//å‘½ä»¤ä¸ºhelp æˆ– ? æ—¶ï¼štrue</span></span><br><span class=\"line\">\tversionFlag <span class=\"hljs-keyword\">bool</span> <span class=\"hljs-comment\">//å‘½ä»¤æ˜¯å¦ä¸ºversionæ—¶ï¼štrue</span></span><br><span class=\"line\">\tcpOption <span class=\"hljs-keyword\">string</span> <span class=\"hljs-comment\">//å‘½ä»¤ä¸ºcp æˆ– classpathæ—¶ï¼Œä¿å­˜å€¼</span></span><br><span class=\"line\">\tXjreOption <span class=\"hljs-keyword\">string</span> <span class=\"hljs-comment\">//å‘½ä»¤ä¸ºXjreæ—¶ï¼Œä¿å­˜å€¼</span></span><br><span class=\"line\">\tclass <span class=\"hljs-keyword\">string</span> <span class=\"hljs-comment\">//ä¿å­˜class</span></span><br><span class=\"line\">\targs []<span class=\"hljs-keyword\">string</span> <span class=\"hljs-comment\">//ä¿å­˜å…¶ä»–å…¥å‚</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>è§£æå…¥å‚</li>\n</ol>\n<figure class=\"highlight go hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">parseCmd</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Cmd</span></span> &#123;</span><br><span class=\"line\">\tcmd := &amp;Cmd&#123;&#125; <span class=\"hljs-comment\">//å®ä¾‹åŒ–å…¥å‚å¯¹è±¡</span></span><br><span class=\"line\">\tflag.Usage = printUsage <span class=\"hljs-comment\">//è®¾ç½®ç”¨æ³•è¯´æ˜</span></span><br><span class=\"line\">\tflag.BoolVar(&amp;cmd.helpFlag,<span class=\"hljs-string\">\"help\"</span>,<span class=\"hljs-literal\">false</span>,<span class=\"hljs-string\">\"print help message\"</span>) <span class=\"hljs-comment\">//å‚æ•°ä¸ºhelpæ—¶ï¼Œ&amp;cmd.helpFlag = true</span></span><br><span class=\"line\">\tflag.BoolVar(&amp;cmd.helpFlag,<span class=\"hljs-string\">\"?\"</span>,<span class=\"hljs-literal\">false</span>,<span class=\"hljs-string\">\"print help message\"</span>) <span class=\"hljs-comment\">//å‚æ•°ä¸º?æ—¶ï¼Œ&amp;cmd.helpFlag = true</span></span><br><span class=\"line\">\tflag.BoolVar(&amp;cmd.versionFlag,<span class=\"hljs-string\">\"version\"</span>,<span class=\"hljs-literal\">false</span>,<span class=\"hljs-string\">\"print version and exit\"</span>) <span class=\"hljs-comment\">//å‚æ•°ä¸ºversionæ—¶ï¼Œ&amp;cmd.versionFlag = true</span></span><br><span class=\"line\">\tflag.StringVar(&amp;cmd.cpOption,<span class=\"hljs-string\">\"cp\"</span>,<span class=\"hljs-string\">\"\"</span>,<span class=\"hljs-string\">\"classpath\"</span>) <span class=\"hljs-comment\">//å‚æ•°ä¸ºversionæ—¶ï¼Œ&amp;cmd.versionFlag = true</span></span><br><span class=\"line\">\tflag.StringVar(&amp;cmd.cpOption,<span class=\"hljs-string\">\"classpath\"</span>,<span class=\"hljs-string\">\"\"</span>,<span class=\"hljs-string\">\"classpath\"</span>)</span><br><span class=\"line\">\tflag.StringVar(&amp;cmd.XjreOption,<span class=\"hljs-string\">\"Xjre\"</span>,<span class=\"hljs-string\">\"\"</span>,<span class=\"hljs-string\">\"path to jres\"</span>)</span><br><span class=\"line\">\tflag.Parse()</span><br><span class=\"line\">\targs := flag.Args()</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(args) &gt; <span class=\"hljs-number\">0</span> &#123;</span><br><span class=\"line\">\t\tcmd.class = args[<span class=\"hljs-number\">0</span>]</span><br><span class=\"line\">\t\tcmd.args = args[<span class=\"hljs-number\">1</span>:]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> cmd</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">printUsage</span><span class=\"hljs-params\">()</span></span> &#123;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"hljs-string\">\"Usage: %s [-options] class [args...]\\n\"</span>,os.Args[<span class=\"hljs-number\">0</span>])</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>å¯åŠ¨æ–¹æ³•</li>\n</ol>\n<figure class=\"highlight go hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">main</span> <span class=\"hljs-params\">()</span></span> &#123;</span><br><span class=\"line\">\tcmd := parseCmd() <span class=\"hljs-comment\">//è§£ææ–¹æ³•</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> cmd.versionFlag &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"hljs-string\">\"version 0.0.1\"</span>) <span class=\"hljs-comment\">//å…¥å‚ä¸ºversionæ—¶æ‰“å°ç‰ˆæœ¬å·</span></span><br><span class=\"line\">\t&#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> cmd.helpFlag || cmd.class == <span class=\"hljs-string\">\"\"</span> &#123;</span><br><span class=\"line\">\t\tprintUsage() <span class=\"hljs-comment\">//å…¥å‚ä¸ºhelpæˆ–?æˆ–classpathã€cpä¸ºç©ºæ—¶æ‰“å°è¯´æ˜</span></span><br><span class=\"line\">\t&#125;<span class=\"hljs-keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tstartJVM(cmd) <span class=\"hljs-comment\">//å¯åŠ¨JVM</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">startJVM</span><span class=\"hljs-params\">(cmd *Cmd)</span></span>&#123;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"hljs-string\">\"classpath:%s class:%s args:%v\"</span>,cmd.cpOption,cmd.class,cmd.args)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>è¯•è¿è¡Œ</li>\n</ol>\n<figure class=\"highlight shell hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">D:\\work\\workspace_go\\src\\jvmgo\\ch01&gt; go install</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch01.exe -version</span><br><span class=\"line\">version 0.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch01.exe -help</span><br><span class=\"line\">Usage: D:\\work\\workspace_go\\bin\\ch01.exe [-options] class [args...]</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch01.exe -cp test.class a b c</span><br><span class=\"line\">classpath:test.class class:a args:[b c]</span><br></pre></td></tr></table></figure>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"JVM","path":"tags/JVM/"},{"name":"Java","path":"tags/Java/"},{"name":"Go","path":"tags/Go/"}],"excerpt":"<h2 id=\"ç¯å¢ƒé…ç½®\"><a href=\"#ç¯å¢ƒé…ç½®\" class=\"headerlink\" title=\"ç¯å¢ƒé…ç½®\"></a>ç¯å¢ƒé…ç½®</h2><ol>\n<li>å®‰è£…Golang</li>\n</ol>\n<blockquote><p><a href=\"https://golang.google.cn/\" target=\"_blank\" rel=\"noopener\">https://golang.google.cn/</a></p>\n</blockquote>\n\n<ol start=\"2\">\n<li>è®¾ç½®Goç¯å¢ƒå˜é‡</li>\n</ol>\n<img src=\"/2019/09/09/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1/gopath.png\" title=\"GOPATH\">\n\n<p>åŒæ—¶è¦æ³¨æ„ï¼Œgoçš„å·¥ä½œç›®å½•ä¸ºè¯¥ç›®å½•ï¼Œå¦‚æœéœ€è¦åˆ‡æ¢éœ€è¦æ”¹å˜æ­¤è·¯å¾„ï¼Œä¸ç„¶å¯ä½¿ç”¨GoLandç­‰ideåˆ‡æ¢ã€‚</p>","more":"<h2 id=\"ç®€å•å®ç°javaå‘½ä»¤\"><a href=\"#ç®€å•å®ç°javaå‘½ä»¤\" class=\"headerlink\" title=\"ç®€å•å®ç°javaå‘½ä»¤\"></a>ç®€å•å®ç°javaå‘½ä»¤</h2><p>java SDKè‡ªå¸¦å¾ˆå¤šå‘½ä»¤ï¼Œå¦‚javaã€javacã€javapç­‰ã€‚<br>javaå‘½ä»¤æ˜¯å…¶ä¸­æœ€ç»ˆè¦çš„ä¸€ä¸ªï¼Œå¹³æ—¶æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªjarï¼Œå¦‚springbootå·¥ç¨‹ã€‚è¿˜æ˜¯ä¸€ä¸ªåŸºäºtomcatã€weblogicã€jbossçš„waråŒ…ã€‚å…¶æ ¹æœ¬éƒ½æ˜¯åˆ©ç”¨javaå‘½ä»¤æ‰§è¡Œmainæ–¹æ³•ä¸ºå…¥å£ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java [-options] class [args]</span><br><span class=\"line\">java [-options] -jar jarfile [args]</span><br><span class=\"line\">javaw [-options] class [args]</span><br><span class=\"line\">javaw [-options] -jar jarfile [args]</span><br></pre></td></tr></table></figure>\n\n<blockquote><p>å®˜æ–¹è¯´æ˜ï¼š  <a href=\"https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html\" target=\"_blank\" rel=\"noopener\">https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html</a></p>\n</blockquote>\n\n<h2 id=\"ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\"><a href=\"#ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\" class=\"headerlink\" title=\"ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\"></a>ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–</h2><ol>\n<li>javaå‘½ä»¤å…¥å‚ç»“æ„</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Cmd <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\thelpFlag <span class=\"keyword\">bool</span> <span class=\"comment\">//å‘½ä»¤ä¸ºhelp æˆ– ? æ—¶ï¼štrue</span></span><br><span class=\"line\">\tversionFlag <span class=\"keyword\">bool</span> <span class=\"comment\">//å‘½ä»¤æ˜¯å¦ä¸ºversionæ—¶ï¼štrue</span></span><br><span class=\"line\">\tcpOption <span class=\"keyword\">string</span> <span class=\"comment\">//å‘½ä»¤ä¸ºcp æˆ– classpathæ—¶ï¼Œä¿å­˜å€¼</span></span><br><span class=\"line\">\tXjreOption <span class=\"keyword\">string</span> <span class=\"comment\">//å‘½ä»¤ä¸ºXjreæ—¶ï¼Œä¿å­˜å€¼</span></span><br><span class=\"line\">\tclass <span class=\"keyword\">string</span> <span class=\"comment\">//ä¿å­˜class</span></span><br><span class=\"line\">\targs []<span class=\"keyword\">string</span> <span class=\"comment\">//ä¿å­˜å…¶ä»–å…¥å‚</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>è§£æå…¥å‚</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">parseCmd</span><span class=\"params\">()</span> *<span class=\"title\">Cmd</span></span> &#123;</span><br><span class=\"line\">\tcmd := &amp;Cmd&#123;&#125; <span class=\"comment\">//å®ä¾‹åŒ–å…¥å‚å¯¹è±¡</span></span><br><span class=\"line\">\tflag.Usage = printUsage <span class=\"comment\">//è®¾ç½®ç”¨æ³•è¯´æ˜</span></span><br><span class=\"line\">\tflag.BoolVar(&amp;cmd.helpFlag,<span class=\"string\">\"help\"</span>,<span class=\"literal\">false</span>,<span class=\"string\">\"print help message\"</span>) <span class=\"comment\">//å‚æ•°ä¸ºhelpæ—¶ï¼Œ&amp;cmd.helpFlag = true</span></span><br><span class=\"line\">\tflag.BoolVar(&amp;cmd.helpFlag,<span class=\"string\">\"?\"</span>,<span class=\"literal\">false</span>,<span class=\"string\">\"print help message\"</span>) <span class=\"comment\">//å‚æ•°ä¸º?æ—¶ï¼Œ&amp;cmd.helpFlag = true</span></span><br><span class=\"line\">\tflag.BoolVar(&amp;cmd.versionFlag,<span class=\"string\">\"version\"</span>,<span class=\"literal\">false</span>,<span class=\"string\">\"print version and exit\"</span>) <span class=\"comment\">//å‚æ•°ä¸ºversionæ—¶ï¼Œ&amp;cmd.versionFlag = true</span></span><br><span class=\"line\">\tflag.StringVar(&amp;cmd.cpOption,<span class=\"string\">\"cp\"</span>,<span class=\"string\">\"\"</span>,<span class=\"string\">\"classpath\"</span>) <span class=\"comment\">//å‚æ•°ä¸ºversionæ—¶ï¼Œ&amp;cmd.versionFlag = true</span></span><br><span class=\"line\">\tflag.StringVar(&amp;cmd.cpOption,<span class=\"string\">\"classpath\"</span>,<span class=\"string\">\"\"</span>,<span class=\"string\">\"classpath\"</span>)</span><br><span class=\"line\">\tflag.StringVar(&amp;cmd.XjreOption,<span class=\"string\">\"Xjre\"</span>,<span class=\"string\">\"\"</span>,<span class=\"string\">\"path to jres\"</span>)</span><br><span class=\"line\">\tflag.Parse()</span><br><span class=\"line\">\targs := flag.Args()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(args) &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\tcmd.class = args[<span class=\"number\">0</span>]</span><br><span class=\"line\">\t\tcmd.args = args[<span class=\"number\">1</span>:]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> cmd</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">printUsage</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">\"Usage: %s [-options] class [args...]\\n\"</span>,os.Args[<span class=\"number\">0</span>])</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>å¯åŠ¨æ–¹æ³•</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span> <span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tcmd := parseCmd() <span class=\"comment\">//è§£ææ–¹æ³•</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> cmd.versionFlag &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">\"version 0.0.1\"</span>) <span class=\"comment\">//å…¥å‚ä¸ºversionæ—¶æ‰“å°ç‰ˆæœ¬å·</span></span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> cmd.helpFlag || cmd.class == <span class=\"string\">\"\"</span> &#123;</span><br><span class=\"line\">\t\tprintUsage() <span class=\"comment\">//å…¥å‚ä¸ºhelpæˆ–?æˆ–classpathã€cpä¸ºç©ºæ—¶æ‰“å°è¯´æ˜</span></span><br><span class=\"line\">\t&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tstartJVM(cmd) <span class=\"comment\">//å¯åŠ¨JVM</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">startJVM</span><span class=\"params\">(cmd *Cmd)</span></span>&#123;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">\"classpath:%s class:%s args:%v\"</span>,cmd.cpOption,cmd.class,cmd.args)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>è¯•è¿è¡Œ</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">D:\\work\\workspace_go\\src\\jvmgo\\ch01&gt; go install</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch01.exe -version</span><br><span class=\"line\">version 0.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch01.exe -help</span><br><span class=\"line\">Usage: D:\\work\\workspace_go\\bin\\ch01.exe [-options] class [args...]</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch01.exe -cp test.class a b c</span><br><span class=\"line\">classpath:test.class class:a args:[b c]</span><br></pre></td></tr></table></figure>"},{"title":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°3","date":"2019-09-13T10:44:38.000Z","_content":"\nç¬¬ä¸‰ç¯‡ä¸»è¦å­¦ä¹ JVMä¸­classæ–‡ä»¶çš„å…·ä½“ç»“æ„ï¼Œå’ŒJVMæ˜¯å¦‚ä½•è§£æè¿™äº›ç»“æ„çš„ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡javacå·¥å…·å°†ä¸€ä¸ªjavaæ–‡ä»¶compileæˆä¸€ä¸ª.classæ–‡ä»¶ï¼Œå¹¶é€šè¿‡æˆ‘ä»¬è‡ªå·±å†™çš„jvmå°†è¯¥æ–‡ä»¶è§£æå¹¶æ‰“å°å‡ºæ¥ã€‚é€šè¿‡classæ–‡ä»¶çš„å­¦ä¹ èƒ½è®©æˆ‘ä»¬æ›´åŠ æ·±åˆ»çš„ç†è§£javaæ˜¯æ€æ ·å®ç°è·¨å¹³å°ï¼Œå¹¶ä¸”æˆ‘ä»¬ç¼–å†™çš„javaä»£ç åˆæ˜¯å¦‚ä½•åœ¨JVMä¸­ä½“ç°çš„ã€‚\n<!-- more -->\n\n### JVMä¸­classæ–‡ä»¶ç»“æ„(ClassFile)\nLength|name\n---|---\nu4|magic\nu2|minor_version\nu2|major_version\nu2|constant_pool_count\ncp_info|constant_pool[constant_pool_count-1]\nu2|access_flags\nu2|this_class\nu2|super_class\nu2|interfaces_count\nu2|interfaces[interfaces_count]\nu2|fields_count\nfield_info|fields[fields_count]\nu2|methods_count\nmethod_info|methods[methods_count]\n\n### JVMä¸­å­—æ®µç»“æ„(field_info)\nLength|name\n---|---\nu2|access_flags\nu2|name_index\nu2|descriptor_index\nu2|attributes_count\nattribute_info|attributes[attributes_count]\n\n### JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„(access_flags)\næ ‡å¿—å|æ ‡å¿—å€¼|æ ‡å¿—å«ä¹‰|é’ˆå¯¹çš„å¯¹è±¡\n---|---|---|---\nACC_PUBLIC|0x0001|publicç±»å‹|æ‰€æœ‰ç±»å‹\nACC_FINAL|0x0010|finalç±»å‹|ç±»\nACC_SUPER|0x0020|ä½¿ç”¨æ–°çš„invokespecialè¯­ä¹‰|ç±»å’Œæ¥å£\nACC_INTERFACE|0x0200|æ¥å£ç±»å‹|æ¥å£\nACC_ABSTRACT|0x0400|æŠ½è±¡ç±»å‹|ç±»å’Œæ¥å£\nACC_SYNTHETIC|0x1000|è¯¥ç±»ä¸ç”±ç”¨æˆ·ä»£ç ç”Ÿæˆ|æ‰€æœ‰ç±»å‹\nACC_ANNOTATION|0x2000|æ³¨è§£ç±»å‹|æ³¨è§£\nACC_ENUM|0x4000|æšä¸¾ç±»å‹|æšä¸¾\n\n### å®ç°\n1. å®šä¹‰Classæ–‡ä»¶çš„å½•å–ç±»(ClassReader)\n\n{% codeblock lang:golang %}\ntype ClassReader struct {\n\tdata []byte //classæ–‡ä»¶å­—èŠ‚æµ\n}\n\n// è¯»å–u1\nfunc (self *ClassReader) readUint8() uint8 {\n\tval := self.data[0] //è¯»å–1Byte\n\tself.data = self.data[1:]\n\treturn val\n}\n\n// u2\nfunc (self *ClassReader) readUint16() uint16 {\n\tval := binary.BigEndian.Uint16(self.data) //è¯»å–2Byteå¹¶è½¬ä¸ºuint16\n\tself.data = self.data[2:]\n\treturn val\n}\n\n// u4\nfunc (self *ClassReader) readUint32() uint32 {\n\tval := binary.BigEndian.Uint32(self.data) //è¯»å–4Byteå¹¶è½¬ä¸ºuint32\n\tself.data = self.data[4:]\n\treturn val\n}\n\nfunc (self *ClassReader) readUint64() uint64 {\n\tval := binary.BigEndian.Uint64(self.data) //è¯»å–8Byteå¹¶è½¬ä¸ºuint64\n\tself.data = self.data[8:]\n\treturn val\n}\n\nfunc (self *ClassReader) readUint16s() []uint16 {\n\tn := self.readUint16() //è¯»å–2Byteï¼Œè¯¥å€¼ä¸ºåç»­æ•°ç»„çš„é•¿åº¦\n\ts := make([]uint16, n) //ç”Ÿäº§é•¿åº¦ä¸ºnçš„uint16ç±»å‹æ•°ç»„\n\tfor i := range s {\n\t\ts[i] = self.readUint16() //è¯»å–classæ–‡ä»¶ï¼Œæ¯è¯»å–2Byteä¾¿æ”¾å…¥æ•°ç»„\n\t}\n\treturn s\n}\n\nfunc (self *ClassReader) readBytes(n uint32) []byte {\n\tbytes := self.data[:n] //è¯»å–é•¿åº¦ä¸ºnçš„å­—èŠ‚\n\tself.data = self.data[n:]\n\treturn bytes\n}\n{% endcodeblock %}\n\n1. å®šä¹‰Classæ–‡ä»¶çš„æ ¼å¼(ClassFile)\n\n{% codeblock lang:golang %}\ntype ClassFile struct { //æŒ‰ç…§jvmè§„èŒƒï¼Œå®šä¹‰classæ–‡ä»¶ç»“æ„\n\t//magic      uint32\n\tminorVersion uint16\n\tmajorVersion uint16\n\tconstantPool ConstantPool\n\taccessFlags  uint16\n\tthisClass    uint16\n\tsuperClass   uint16\n\tinterfaces   []uint16\n\tfields       []*MemberInfo\n\tmethods      []*MemberInfo\n\tattributes   []AttributeInfo\n}\n\n//æ–‡ä»¶è§£æå…¥å£æ–¹æ³•ï¼Œå…¥å‚classæ–‡ä»¶æµï¼Œè¿”å›classæ–‡ä»¶å¯¹è±¡\nfunc Parse(classData []byte) (cf *ClassFile, err error) {\n\tdefer func() { //æ•è·å¼‚å¸¸\n\t\tif r := recover(); r != nil {\n\t\t\tvar ok bool\n\t\t\terr, ok = r.(error)\n\t\t\tif !ok {\n\t\t\t\terr = fmt.Errorf(\"%v\", r)\n\t\t\t}\n\t\t}\n\t}()\n\n\tcr := &ClassReader{classData} //å®ä¾‹åŒ–classReaderç±»\n\tcf = &ClassFile{} //å®ä¾‹åŒ–ClassFileç±»\n\tcf.read(cr) //è¯»å–classæ–‡ä»¶\n\treturn\n}\n\n//è¯»å–classæ–‡ä»¶çš„å…·ä½“æ–¹æ³•\nfunc (self *ClassFile) read(reader *ClassReader) {\n\tself.readAndCheckMagic(reader) //è¯»å–é­”æ•°\n\tself.readAndCheckVersion(reader) //è¯»å–ä¸»æ¬¡ç‰ˆæœ¬å·\n\tself.constantPool = readConstantPool(reader) //è¯»å–å¸¸é‡æ± \n\tself.accessFlags = reader.readUint16() //è¯»å–å½“å‰ç±»ï¼ˆæˆ–è€…æ¥å£ï¼‰çš„è®¿é—®ä¿®é¥°ç¬¦\n\tself.thisClass = reader.readUint16() //è¯»å–å½“å‰ç±»ç´¢å¼•\n\tself.superClass = reader.readUint16() //è¯»å–çˆ¶ç±»ç´¢å¼•\n\tself.interfaces = reader.readUint16s() //è¯»å–æ‰€æœ‰æ¥å£ç´¢å¼•\n\tself.fields = readMembers(reader, self.constantPool) //ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æˆå‘˜\n\tself.methods = readMembers(reader, self.constantPool) //ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æ–¹æ³•\n\tself.attributes = readAttributes(reader, self.constantPool) //ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰å±æ€§\n}\n\nfunc (self *ClassFile) readAndCheckMagic(reader *ClassReader) {\n\tmagic := reader.readUint32() //è¯»å–4Byteé­”æ•°\n\tif magic != 0xCAFEBABE { //åˆ¤æ–­é­”æ•°æ˜¯å¦ä¸º0xCAFEBABE\n\t\tpanic(\"java.lang.ClassFormatError: magic!\")\n\t}\n}\n\nfunc (self *ClassFile) readAndCheckVersion(reader *ClassReader) {\n\tself.minorVersion = reader.readUint16() //é«˜2Byteä¸ºæ¬¡ç‰ˆæœ¬å·\n\tself.majorVersion = reader.readUint16() //ä½2Byteä¸ºä¸»ç‰ˆæœ¬å·\n\tswitch self.majorVersion { //æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¸º45~52\n\tcase 45:\n\t\treturn\n\tcase 46, 47, 48, 49, 50, 51, 52:\n\t\tif self.minorVersion == 0 {\n\t\t\treturn\n\t\t}\n\t}\n\n\tpanic(\"java.lang.UnsupportedClassVersionError!\")\n}\n\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) MinorVersion() uint16 {\n\treturn self.minorVersion\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) MajorVersion() uint16 {\n\treturn self.majorVersion\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) ConstantPool() ConstantPool {\n\treturn self.constantPool\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) AccessFlags() uint16 {\n\treturn self.accessFlags\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) Fields() []*MemberInfo {\n\treturn self.fields\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) Methods() []*MemberInfo {\n\treturn self.methods\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®thisClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°\nfunc (self *ClassFile) ClassName() string {\n\treturn self.constantPool.getClassName(self.thisClass)\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®superClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°\nfunc (self *ClassFile) SuperClassName() string {\n\tif self.superClass > 0 {\n\t\treturn self.constantPool.getClassName(self.superClass)\n\t}\n\treturn \"\"\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®interfacesç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°\nfunc (self *ClassFile) InterfaceNames() []string {\n\tinterfaceNames := make([]string, len(self.interfaces))\n\tfor i, cpIndex := range self.interfaces {\n\t\tinterfaceNames[i] = self.constantPool.getClassName(cpIndex)\n\t}\n\treturn interfaceNames\n}\n{% endcodeblock %}\n\n1. å®šä¹‰å­—æ®µå’Œæ–¹æ³•çš„ç»“æ„(field_infoã€method_info)\n\n{% codeblock lang:golang %}\ntype MemberInfo struct { //fieldå’Œmethodçš„ç»“æ„ç±»å‹ï¼Œä½¿ç”¨åŒä¸€ä¸ªç»“æ„\n\tcp              ConstantPool //å½“å‰å¸¸é‡æ± \n\taccessFlags     uint16 //è®¿é—®æ ‡å¿—\n\tnameIndex       uint16 //åç§°ç´¢å¼•\n\tdescriptorIndex uint16 //æè¿°ç´¢å¼•\n\tattributes      []AttributeInfo //å±æ€§åˆ—è¡¨ \n}\n\n// read field or method table\nfunc readMembers(reader *ClassReader, cp ConstantPool) []*MemberInfo {\n\tmemberCount := reader.readUint16() //è¯»å–fieldæˆ–methodæ•°é‡\n\tmembers := make([]*MemberInfo, memberCount) //åˆ›å»ºæ•°ç»„\n\tfor i := range members {\n\t\tmembers[i] = readMember(reader, cp)\n\t}\n\treturn members\n}\n\n//å…·ä½“è¯»å–fieldå’Œmethodçš„æ–¹æ³•\nfunc readMember(reader *ClassReader, cp ConstantPool) *MemberInfo {\n\treturn &MemberInfo{\n\t\tcp:              cp,\n\t\taccessFlags:     reader.readUint16(), //è¯»å–2Byteçš„è®¿é—®æ§åˆ¶ç¬¦\n\t\tnameIndex:       reader.readUint16(), //è¯»å–2Byteçš„åç§°ç´¢å¼•\n\t\tdescriptorIndex: reader.readUint16(), //è¯»å–2Byteçš„æè¿°ç´¢å¼•\n\t\tattributes:      readAttributes(reader, cp), //è¯»å–å±æ€§åˆ—è¡¨\n\t}\n}\n\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *MemberInfo) AccessFlags() uint16 {\n\treturn self.accessFlags\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡åç§°ç´¢å¼•è®¿é—®å¸¸é‡æ± \nfunc (self *MemberInfo) Name() string {\n\treturn self.cp.getUtf8(self.nameIndex)\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡æè¿°ç´¢å¼•è®¿é—®å¸¸é‡æ± \nfunc (self *MemberInfo) Descriptor() string {\n\treturn self.cp.getUtf8(self.descriptorIndex)\n}\n\n{% endcodeblock %}","source":"_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°3.md","raw":"---\ntitle: è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°3\ndate: 2019-09-13 18:44:38\ntags: \n    - JVM\n    - Java\n    - Go\ncategories :\n    - Technology\n---\n\nç¬¬ä¸‰ç¯‡ä¸»è¦å­¦ä¹ JVMä¸­classæ–‡ä»¶çš„å…·ä½“ç»“æ„ï¼Œå’ŒJVMæ˜¯å¦‚ä½•è§£æè¿™äº›ç»“æ„çš„ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡javacå·¥å…·å°†ä¸€ä¸ªjavaæ–‡ä»¶compileæˆä¸€ä¸ª.classæ–‡ä»¶ï¼Œå¹¶é€šè¿‡æˆ‘ä»¬è‡ªå·±å†™çš„jvmå°†è¯¥æ–‡ä»¶è§£æå¹¶æ‰“å°å‡ºæ¥ã€‚é€šè¿‡classæ–‡ä»¶çš„å­¦ä¹ èƒ½è®©æˆ‘ä»¬æ›´åŠ æ·±åˆ»çš„ç†è§£javaæ˜¯æ€æ ·å®ç°è·¨å¹³å°ï¼Œå¹¶ä¸”æˆ‘ä»¬ç¼–å†™çš„javaä»£ç åˆæ˜¯å¦‚ä½•åœ¨JVMä¸­ä½“ç°çš„ã€‚\n<!-- more -->\n\n### JVMä¸­classæ–‡ä»¶ç»“æ„(ClassFile)\nLength|name\n---|---\nu4|magic\nu2|minor_version\nu2|major_version\nu2|constant_pool_count\ncp_info|constant_pool[constant_pool_count-1]\nu2|access_flags\nu2|this_class\nu2|super_class\nu2|interfaces_count\nu2|interfaces[interfaces_count]\nu2|fields_count\nfield_info|fields[fields_count]\nu2|methods_count\nmethod_info|methods[methods_count]\n\n### JVMä¸­å­—æ®µç»“æ„(field_info)\nLength|name\n---|---\nu2|access_flags\nu2|name_index\nu2|descriptor_index\nu2|attributes_count\nattribute_info|attributes[attributes_count]\n\n### JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„(access_flags)\næ ‡å¿—å|æ ‡å¿—å€¼|æ ‡å¿—å«ä¹‰|é’ˆå¯¹çš„å¯¹è±¡\n---|---|---|---\nACC_PUBLIC|0x0001|publicç±»å‹|æ‰€æœ‰ç±»å‹\nACC_FINAL|0x0010|finalç±»å‹|ç±»\nACC_SUPER|0x0020|ä½¿ç”¨æ–°çš„invokespecialè¯­ä¹‰|ç±»å’Œæ¥å£\nACC_INTERFACE|0x0200|æ¥å£ç±»å‹|æ¥å£\nACC_ABSTRACT|0x0400|æŠ½è±¡ç±»å‹|ç±»å’Œæ¥å£\nACC_SYNTHETIC|0x1000|è¯¥ç±»ä¸ç”±ç”¨æˆ·ä»£ç ç”Ÿæˆ|æ‰€æœ‰ç±»å‹\nACC_ANNOTATION|0x2000|æ³¨è§£ç±»å‹|æ³¨è§£\nACC_ENUM|0x4000|æšä¸¾ç±»å‹|æšä¸¾\n\n### å®ç°\n1. å®šä¹‰Classæ–‡ä»¶çš„å½•å–ç±»(ClassReader)\n\n{% codeblock lang:golang %}\ntype ClassReader struct {\n\tdata []byte //classæ–‡ä»¶å­—èŠ‚æµ\n}\n\n// è¯»å–u1\nfunc (self *ClassReader) readUint8() uint8 {\n\tval := self.data[0] //è¯»å–1Byte\n\tself.data = self.data[1:]\n\treturn val\n}\n\n// u2\nfunc (self *ClassReader) readUint16() uint16 {\n\tval := binary.BigEndian.Uint16(self.data) //è¯»å–2Byteå¹¶è½¬ä¸ºuint16\n\tself.data = self.data[2:]\n\treturn val\n}\n\n// u4\nfunc (self *ClassReader) readUint32() uint32 {\n\tval := binary.BigEndian.Uint32(self.data) //è¯»å–4Byteå¹¶è½¬ä¸ºuint32\n\tself.data = self.data[4:]\n\treturn val\n}\n\nfunc (self *ClassReader) readUint64() uint64 {\n\tval := binary.BigEndian.Uint64(self.data) //è¯»å–8Byteå¹¶è½¬ä¸ºuint64\n\tself.data = self.data[8:]\n\treturn val\n}\n\nfunc (self *ClassReader) readUint16s() []uint16 {\n\tn := self.readUint16() //è¯»å–2Byteï¼Œè¯¥å€¼ä¸ºåç»­æ•°ç»„çš„é•¿åº¦\n\ts := make([]uint16, n) //ç”Ÿäº§é•¿åº¦ä¸ºnçš„uint16ç±»å‹æ•°ç»„\n\tfor i := range s {\n\t\ts[i] = self.readUint16() //è¯»å–classæ–‡ä»¶ï¼Œæ¯è¯»å–2Byteä¾¿æ”¾å…¥æ•°ç»„\n\t}\n\treturn s\n}\n\nfunc (self *ClassReader) readBytes(n uint32) []byte {\n\tbytes := self.data[:n] //è¯»å–é•¿åº¦ä¸ºnçš„å­—èŠ‚\n\tself.data = self.data[n:]\n\treturn bytes\n}\n{% endcodeblock %}\n\n1. å®šä¹‰Classæ–‡ä»¶çš„æ ¼å¼(ClassFile)\n\n{% codeblock lang:golang %}\ntype ClassFile struct { //æŒ‰ç…§jvmè§„èŒƒï¼Œå®šä¹‰classæ–‡ä»¶ç»“æ„\n\t//magic      uint32\n\tminorVersion uint16\n\tmajorVersion uint16\n\tconstantPool ConstantPool\n\taccessFlags  uint16\n\tthisClass    uint16\n\tsuperClass   uint16\n\tinterfaces   []uint16\n\tfields       []*MemberInfo\n\tmethods      []*MemberInfo\n\tattributes   []AttributeInfo\n}\n\n//æ–‡ä»¶è§£æå…¥å£æ–¹æ³•ï¼Œå…¥å‚classæ–‡ä»¶æµï¼Œè¿”å›classæ–‡ä»¶å¯¹è±¡\nfunc Parse(classData []byte) (cf *ClassFile, err error) {\n\tdefer func() { //æ•è·å¼‚å¸¸\n\t\tif r := recover(); r != nil {\n\t\t\tvar ok bool\n\t\t\terr, ok = r.(error)\n\t\t\tif !ok {\n\t\t\t\terr = fmt.Errorf(\"%v\", r)\n\t\t\t}\n\t\t}\n\t}()\n\n\tcr := &ClassReader{classData} //å®ä¾‹åŒ–classReaderç±»\n\tcf = &ClassFile{} //å®ä¾‹åŒ–ClassFileç±»\n\tcf.read(cr) //è¯»å–classæ–‡ä»¶\n\treturn\n}\n\n//è¯»å–classæ–‡ä»¶çš„å…·ä½“æ–¹æ³•\nfunc (self *ClassFile) read(reader *ClassReader) {\n\tself.readAndCheckMagic(reader) //è¯»å–é­”æ•°\n\tself.readAndCheckVersion(reader) //è¯»å–ä¸»æ¬¡ç‰ˆæœ¬å·\n\tself.constantPool = readConstantPool(reader) //è¯»å–å¸¸é‡æ± \n\tself.accessFlags = reader.readUint16() //è¯»å–å½“å‰ç±»ï¼ˆæˆ–è€…æ¥å£ï¼‰çš„è®¿é—®ä¿®é¥°ç¬¦\n\tself.thisClass = reader.readUint16() //è¯»å–å½“å‰ç±»ç´¢å¼•\n\tself.superClass = reader.readUint16() //è¯»å–çˆ¶ç±»ç´¢å¼•\n\tself.interfaces = reader.readUint16s() //è¯»å–æ‰€æœ‰æ¥å£ç´¢å¼•\n\tself.fields = readMembers(reader, self.constantPool) //ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æˆå‘˜\n\tself.methods = readMembers(reader, self.constantPool) //ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æ–¹æ³•\n\tself.attributes = readAttributes(reader, self.constantPool) //ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰å±æ€§\n}\n\nfunc (self *ClassFile) readAndCheckMagic(reader *ClassReader) {\n\tmagic := reader.readUint32() //è¯»å–4Byteé­”æ•°\n\tif magic != 0xCAFEBABE { //åˆ¤æ–­é­”æ•°æ˜¯å¦ä¸º0xCAFEBABE\n\t\tpanic(\"java.lang.ClassFormatError: magic!\")\n\t}\n}\n\nfunc (self *ClassFile) readAndCheckVersion(reader *ClassReader) {\n\tself.minorVersion = reader.readUint16() //é«˜2Byteä¸ºæ¬¡ç‰ˆæœ¬å·\n\tself.majorVersion = reader.readUint16() //ä½2Byteä¸ºä¸»ç‰ˆæœ¬å·\n\tswitch self.majorVersion { //æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¸º45~52\n\tcase 45:\n\t\treturn\n\tcase 46, 47, 48, 49, 50, 51, 52:\n\t\tif self.minorVersion == 0 {\n\t\t\treturn\n\t\t}\n\t}\n\n\tpanic(\"java.lang.UnsupportedClassVersionError!\")\n}\n\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) MinorVersion() uint16 {\n\treturn self.minorVersion\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) MajorVersion() uint16 {\n\treturn self.majorVersion\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) ConstantPool() ConstantPool {\n\treturn self.constantPool\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) AccessFlags() uint16 {\n\treturn self.accessFlags\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) Fields() []*MemberInfo {\n\treturn self.fields\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) Methods() []*MemberInfo {\n\treturn self.methods\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®thisClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°\nfunc (self *ClassFile) ClassName() string {\n\treturn self.constantPool.getClassName(self.thisClass)\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®superClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°\nfunc (self *ClassFile) SuperClassName() string {\n\tif self.superClass > 0 {\n\t\treturn self.constantPool.getClassName(self.superClass)\n\t}\n\treturn \"\"\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®interfacesç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°\nfunc (self *ClassFile) InterfaceNames() []string {\n\tinterfaceNames := make([]string, len(self.interfaces))\n\tfor i, cpIndex := range self.interfaces {\n\t\tinterfaceNames[i] = self.constantPool.getClassName(cpIndex)\n\t}\n\treturn interfaceNames\n}\n{% endcodeblock %}\n\n1. å®šä¹‰å­—æ®µå’Œæ–¹æ³•çš„ç»“æ„(field_infoã€method_info)\n\n{% codeblock lang:golang %}\ntype MemberInfo struct { //fieldå’Œmethodçš„ç»“æ„ç±»å‹ï¼Œä½¿ç”¨åŒä¸€ä¸ªç»“æ„\n\tcp              ConstantPool //å½“å‰å¸¸é‡æ± \n\taccessFlags     uint16 //è®¿é—®æ ‡å¿—\n\tnameIndex       uint16 //åç§°ç´¢å¼•\n\tdescriptorIndex uint16 //æè¿°ç´¢å¼•\n\tattributes      []AttributeInfo //å±æ€§åˆ—è¡¨ \n}\n\n// read field or method table\nfunc readMembers(reader *ClassReader, cp ConstantPool) []*MemberInfo {\n\tmemberCount := reader.readUint16() //è¯»å–fieldæˆ–methodæ•°é‡\n\tmembers := make([]*MemberInfo, memberCount) //åˆ›å»ºæ•°ç»„\n\tfor i := range members {\n\t\tmembers[i] = readMember(reader, cp)\n\t}\n\treturn members\n}\n\n//å…·ä½“è¯»å–fieldå’Œmethodçš„æ–¹æ³•\nfunc readMember(reader *ClassReader, cp ConstantPool) *MemberInfo {\n\treturn &MemberInfo{\n\t\tcp:              cp,\n\t\taccessFlags:     reader.readUint16(), //è¯»å–2Byteçš„è®¿é—®æ§åˆ¶ç¬¦\n\t\tnameIndex:       reader.readUint16(), //è¯»å–2Byteçš„åç§°ç´¢å¼•\n\t\tdescriptorIndex: reader.readUint16(), //è¯»å–2Byteçš„æè¿°ç´¢å¼•\n\t\tattributes:      readAttributes(reader, cp), //è¯»å–å±æ€§åˆ—è¡¨\n\t}\n}\n\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *MemberInfo) AccessFlags() uint16 {\n\treturn self.accessFlags\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡åç§°ç´¢å¼•è®¿é—®å¸¸é‡æ± \nfunc (self *MemberInfo) Name() string {\n\treturn self.cp.getUtf8(self.nameIndex)\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡æè¿°ç´¢å¼•è®¿é—®å¸¸é‡æ± \nfunc (self *MemberInfo) Descriptor() string {\n\treturn self.cp.getUtf8(self.descriptorIndex)\n}\n\n{% endcodeblock %}","slug":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°3","published":1,"updated":"2019-09-15T13:50:28.396Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck10secra0006jony273wlg3x","content":"<p>ç¬¬ä¸‰ç¯‡ä¸»è¦å­¦ä¹ JVMä¸­classæ–‡ä»¶çš„å…·ä½“ç»“æ„ï¼Œå’ŒJVMæ˜¯å¦‚ä½•è§£æè¿™äº›ç»“æ„çš„ã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡javacå·¥å…·å°†ä¸€ä¸ªjavaæ–‡ä»¶compileæˆä¸€ä¸ª.classæ–‡ä»¶ï¼Œå¹¶é€šè¿‡æˆ‘ä»¬è‡ªå·±å†™çš„jvmå°†è¯¥æ–‡ä»¶è§£æå¹¶æ‰“å°å‡ºæ¥ã€‚é€šè¿‡classæ–‡ä»¶çš„å­¦ä¹ èƒ½è®©æˆ‘ä»¬æ›´åŠ æ·±åˆ»çš„ç†è§£javaæ˜¯æ€æ ·å®ç°è·¨å¹³å°ï¼Œå¹¶ä¸”æˆ‘ä»¬ç¼–å†™çš„javaä»£ç åˆæ˜¯å¦‚ä½•åœ¨JVMä¸­ä½“ç°çš„ã€‚</p>\n<a id=\"more\"></a>\n\n<h3 id=\"JVMä¸­classæ–‡ä»¶ç»“æ„-ClassFile\"><a href=\"#JVMä¸­classæ–‡ä»¶ç»“æ„-ClassFile\" class=\"headerlink\" title=\"JVMä¸­classæ–‡ä»¶ç»“æ„(ClassFile)\"></a>JVMä¸­classæ–‡ä»¶ç»“æ„(ClassFile)</h3><table>\n<thead>\n<tr>\n<th>Length</th>\n<th>name</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>u4</td>\n<td>magic</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>minor_version</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>major_version</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>constant_pool_count</td>\n</tr>\n<tr>\n<td>cp_info</td>\n<td>constant_pool[constant_pool_count-1]</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>access_flags</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>this_class</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>super_class</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>interfaces_count</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>interfaces[interfaces_count]</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>fields_count</td>\n</tr>\n<tr>\n<td>field_info</td>\n<td>fields[fields_count]</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>methods_count</td>\n</tr>\n<tr>\n<td>method_info</td>\n<td>methods[methods_count]</td>\n</tr>\n</tbody></table>\n<h3 id=\"JVMä¸­å­—æ®µç»“æ„-field-info\"><a href=\"#JVMä¸­å­—æ®µç»“æ„-field-info\" class=\"headerlink\" title=\"JVMä¸­å­—æ®µç»“æ„(field_info)\"></a>JVMä¸­å­—æ®µç»“æ„(field_info)</h3><table>\n<thead>\n<tr>\n<th>Length</th>\n<th>name</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>u2</td>\n<td>access_flags</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>name_index</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>descriptor_index</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>attributes_count</td>\n</tr>\n<tr>\n<td>attribute_info</td>\n<td>attributes[attributes_count]</td>\n</tr>\n</tbody></table>\n<h3 id=\"JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„-access-flags\"><a href=\"#JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„-access-flags\" class=\"headerlink\" title=\"JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„(access_flags)\"></a>JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„(access_flags)</h3><table>\n<thead>\n<tr>\n<th>æ ‡å¿—å</th>\n<th>æ ‡å¿—å€¼</th>\n<th>æ ‡å¿—å«ä¹‰</th>\n<th>é’ˆå¯¹çš„å¯¹è±¡</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>ACC_PUBLIC</td>\n<td>0x0001</td>\n<td>publicç±»å‹</td>\n<td>æ‰€æœ‰ç±»å‹</td>\n</tr>\n<tr>\n<td>ACC_FINAL</td>\n<td>0x0010</td>\n<td>finalç±»å‹</td>\n<td>ç±»</td>\n</tr>\n<tr>\n<td>ACC_SUPER</td>\n<td>0x0020</td>\n<td>ä½¿ç”¨æ–°çš„invokespecialè¯­ä¹‰</td>\n<td>ç±»å’Œæ¥å£</td>\n</tr>\n<tr>\n<td>ACC_INTERFACE</td>\n<td>0x0200</td>\n<td>æ¥å£ç±»å‹</td>\n<td>æ¥å£</td>\n</tr>\n<tr>\n<td>ACC_ABSTRACT</td>\n<td>0x0400</td>\n<td>æŠ½è±¡ç±»å‹</td>\n<td>ç±»å’Œæ¥å£</td>\n</tr>\n<tr>\n<td>ACC_SYNTHETIC</td>\n<td>0x1000</td>\n<td>è¯¥ç±»ä¸ç”±ç”¨æˆ·ä»£ç ç”Ÿæˆ</td>\n<td>æ‰€æœ‰ç±»å‹</td>\n</tr>\n<tr>\n<td>ACC_ANNOTATION</td>\n<td>0x2000</td>\n<td>æ³¨è§£ç±»å‹</td>\n<td>æ³¨è§£</td>\n</tr>\n<tr>\n<td>ACC_ENUM</td>\n<td>0x4000</td>\n<td>æšä¸¾ç±»å‹</td>\n<td>æšä¸¾</td>\n</tr>\n</tbody></table>\n<h3 id=\"å®ç°\"><a href=\"#å®ç°\" class=\"headerlink\" title=\"å®ç°\"></a>å®ç°</h3><ol>\n<li>å®šä¹‰Classæ–‡ä»¶çš„å½•å–ç±»(ClassReader)</li>\n</ol>\n<figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> ClassReader <span class=\"hljs-keyword\">struct</span> &#123;</span><br><span class=\"line\">\tdata []<span class=\"hljs-keyword\">byte</span> <span class=\"hljs-comment\">//classæ–‡ä»¶å­—èŠ‚æµ</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// è¯»å–u1</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassReader)</span> <span class=\"hljs-title\">readUint8</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint8</span></span> &#123;</span><br><span class=\"line\">\tval := self.data[<span class=\"hljs-number\">0</span>] <span class=\"hljs-comment\">//è¯»å–1Byte</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"hljs-number\">1</span>:]</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// u2</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassReader)</span> <span class=\"hljs-title\">readUint16</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint16</span></span> &#123;</span><br><span class=\"line\">\tval := binary.BigEndian.Uint16(self.data) <span class=\"hljs-comment\">//è¯»å–2Byteå¹¶è½¬ä¸ºuint16</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"hljs-number\">2</span>:]</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// u4</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassReader)</span> <span class=\"hljs-title\">readUint32</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint32</span></span> &#123;</span><br><span class=\"line\">\tval := binary.BigEndian.Uint32(self.data) <span class=\"hljs-comment\">//è¯»å–4Byteå¹¶è½¬ä¸ºuint32</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"hljs-number\">4</span>:]</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassReader)</span> <span class=\"hljs-title\">readUint64</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint64</span></span> &#123;</span><br><span class=\"line\">\tval := binary.BigEndian.Uint64(self.data) <span class=\"hljs-comment\">//è¯»å–8Byteå¹¶è½¬ä¸ºuint64</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"hljs-number\">8</span>:]</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassReader)</span> <span class=\"hljs-title\">readUint16s</span><span class=\"hljs-params\">()</span> []<span class=\"hljs-title\">uint16</span></span> &#123;</span><br><span class=\"line\">\tn := self.readUint16() <span class=\"hljs-comment\">//è¯»å–2Byteï¼Œè¯¥å€¼ä¸ºåç»­æ•°ç»„çš„é•¿åº¦</span></span><br><span class=\"line\">\ts := <span class=\"hljs-built_in\">make</span>([]<span class=\"hljs-keyword\">uint16</span>, n) <span class=\"hljs-comment\">//ç”Ÿäº§é•¿åº¦ä¸ºnçš„uint16ç±»å‹æ•°ç»„</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> i := <span class=\"hljs-keyword\">range</span> s &#123;</span><br><span class=\"line\">\t\ts[i] = self.readUint16() <span class=\"hljs-comment\">//è¯»å–classæ–‡ä»¶ï¼Œæ¯è¯»å–2Byteä¾¿æ”¾å…¥æ•°ç»„</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> s</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassReader)</span> <span class=\"hljs-title\">readBytes</span><span class=\"hljs-params\">(n <span class=\"hljs-keyword\">uint32</span>)</span> []<span class=\"hljs-title\">byte</span></span> &#123;</span><br><span class=\"line\">\tbytes := self.data[:n] <span class=\"hljs-comment\">//è¯»å–é•¿åº¦ä¸ºnçš„å­—èŠ‚</span></span><br><span class=\"line\">\tself.data = self.data[n:]</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> bytes</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>å®šä¹‰Classæ–‡ä»¶çš„æ ¼å¼(ClassFile)</li>\n</ol>\n<figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> ClassFile <span class=\"hljs-keyword\">struct</span> &#123; <span class=\"hljs-comment\">//æŒ‰ç…§jvmè§„èŒƒï¼Œå®šä¹‰classæ–‡ä»¶ç»“æ„</span></span><br><span class=\"line\">\t<span class=\"hljs-comment\">//magic      uint32</span></span><br><span class=\"line\">\tminorVersion <span class=\"hljs-keyword\">uint16</span></span><br><span class=\"line\">\tmajorVersion <span class=\"hljs-keyword\">uint16</span></span><br><span class=\"line\">\tconstantPool ConstantPool</span><br><span class=\"line\">\taccessFlags  <span class=\"hljs-keyword\">uint16</span></span><br><span class=\"line\">\tthisClass    <span class=\"hljs-keyword\">uint16</span></span><br><span class=\"line\">\tsuperClass   <span class=\"hljs-keyword\">uint16</span></span><br><span class=\"line\">\tinterfaces   []<span class=\"hljs-keyword\">uint16</span></span><br><span class=\"line\">\tfields       []*MemberInfo</span><br><span class=\"line\">\tmethods      []*MemberInfo</span><br><span class=\"line\">\tattributes   []AttributeInfo</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//æ–‡ä»¶è§£æå…¥å£æ–¹æ³•ï¼Œå…¥å‚classæ–‡ä»¶æµï¼Œè¿”å›classæ–‡ä»¶å¯¹è±¡</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">Parse</span><span class=\"hljs-params\">(classData []<span class=\"hljs-keyword\">byte</span>)</span> <span class=\"hljs-params\">(cf *ClassFile, err error)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">defer</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span><span class=\"hljs-params\">()</span></span> &#123; <span class=\"hljs-comment\">//æ•è·å¼‚å¸¸</span></span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> r := <span class=\"hljs-built_in\">recover</span>(); r != <span class=\"hljs-literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"hljs-keyword\">var</span> ok <span class=\"hljs-keyword\">bool</span></span><br><span class=\"line\">\t\t\terr, ok = r.(error)</span><br><span class=\"line\">\t\t\t<span class=\"hljs-keyword\">if</span> !ok &#123;</span><br><span class=\"line\">\t\t\t\terr = fmt.Errorf(<span class=\"hljs-string\">\"%v\"</span>, r)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">\tcr := &amp;ClassReader&#123;classData&#125; <span class=\"hljs-comment\">//å®ä¾‹åŒ–classReaderç±»</span></span><br><span class=\"line\">\tcf = &amp;ClassFile&#123;&#125; <span class=\"hljs-comment\">//å®ä¾‹åŒ–ClassFileç±»</span></span><br><span class=\"line\">\tcf.read(cr) <span class=\"hljs-comment\">//è¯»å–classæ–‡ä»¶</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//è¯»å–classæ–‡ä»¶çš„å…·ä½“æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">read</span><span class=\"hljs-params\">(reader *ClassReader)</span></span> &#123;</span><br><span class=\"line\">\tself.readAndCheckMagic(reader) <span class=\"hljs-comment\">//è¯»å–é­”æ•°</span></span><br><span class=\"line\">\tself.readAndCheckVersion(reader) <span class=\"hljs-comment\">//è¯»å–ä¸»æ¬¡ç‰ˆæœ¬å·</span></span><br><span class=\"line\">\tself.constantPool = readConstantPool(reader) <span class=\"hljs-comment\">//è¯»å–å¸¸é‡æ± </span></span><br><span class=\"line\">\tself.accessFlags = reader.readUint16() <span class=\"hljs-comment\">//è¯»å–å½“å‰ç±»ï¼ˆæˆ–è€…æ¥å£ï¼‰çš„è®¿é—®ä¿®é¥°ç¬¦</span></span><br><span class=\"line\">\tself.thisClass = reader.readUint16() <span class=\"hljs-comment\">//è¯»å–å½“å‰ç±»ç´¢å¼•</span></span><br><span class=\"line\">\tself.superClass = reader.readUint16() <span class=\"hljs-comment\">//è¯»å–çˆ¶ç±»ç´¢å¼•</span></span><br><span class=\"line\">\tself.interfaces = reader.readUint16s() <span class=\"hljs-comment\">//è¯»å–æ‰€æœ‰æ¥å£ç´¢å¼•</span></span><br><span class=\"line\">\tself.fields = readMembers(reader, self.constantPool) <span class=\"hljs-comment\">//ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æˆå‘˜</span></span><br><span class=\"line\">\tself.methods = readMembers(reader, self.constantPool) <span class=\"hljs-comment\">//ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æ–¹æ³•</span></span><br><span class=\"line\">\tself.attributes = readAttributes(reader, self.constantPool) <span class=\"hljs-comment\">//ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰å±æ€§</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">readAndCheckMagic</span><span class=\"hljs-params\">(reader *ClassReader)</span></span> &#123;</span><br><span class=\"line\">\tmagic := reader.readUint32() <span class=\"hljs-comment\">//è¯»å–4Byteé­”æ•°</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> magic != <span class=\"hljs-number\">0xCAFEBABE</span> &#123; <span class=\"hljs-comment\">//åˆ¤æ–­é­”æ•°æ˜¯å¦ä¸º0xCAFEBABE</span></span><br><span class=\"line\">\t\t<span class=\"hljs-built_in\">panic</span>(<span class=\"hljs-string\">\"java.lang.ClassFormatError: magic!\"</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">readAndCheckVersion</span><span class=\"hljs-params\">(reader *ClassReader)</span></span> &#123;</span><br><span class=\"line\">\tself.minorVersion = reader.readUint16() <span class=\"hljs-comment\">//é«˜2Byteä¸ºæ¬¡ç‰ˆæœ¬å·</span></span><br><span class=\"line\">\tself.majorVersion = reader.readUint16() <span class=\"hljs-comment\">//ä½2Byteä¸ºä¸»ç‰ˆæœ¬å·</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">switch</span> self.majorVersion &#123; <span class=\"hljs-comment\">//æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¸º45~52</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">case</span> <span class=\"hljs-number\">45</span>:</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">return</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">case</span> <span class=\"hljs-number\">46</span>, <span class=\"hljs-number\">47</span>, <span class=\"hljs-number\">48</span>, <span class=\"hljs-number\">49</span>, <span class=\"hljs-number\">50</span>, <span class=\"hljs-number\">51</span>, <span class=\"hljs-number\">52</span>:</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> self.minorVersion == <span class=\"hljs-number\">0</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"hljs-keyword\">return</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-built_in\">panic</span>(<span class=\"hljs-string\">\"java.lang.UnsupportedClassVersionError!\"</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">MinorVersion</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint16</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.minorVersion</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">MajorVersion</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint16</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.majorVersion</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">ConstantPool</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">ConstantPool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.constantPool</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">AccessFlags</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint16</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.accessFlags</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">Fields</span><span class=\"hljs-params\">()</span> []*<span class=\"hljs-title\">MemberInfo</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.fields</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">Methods</span><span class=\"hljs-params\">()</span> []*<span class=\"hljs-title\">MemberInfo</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.methods</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®thisClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">ClassName</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.constantPool.getClassName(self.thisClass)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®superClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">SuperClassName</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> self.superClass &gt; <span class=\"hljs-number\">0</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">return</span> self.constantPool.getClassName(self.superClass)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®interfacesç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">InterfaceNames</span><span class=\"hljs-params\">()</span> []<span class=\"hljs-title\">string</span></span> &#123;</span><br><span class=\"line\">\tinterfaceNames := <span class=\"hljs-built_in\">make</span>([]<span class=\"hljs-keyword\">string</span>, <span class=\"hljs-built_in\">len</span>(self.interfaces))</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> i, cpIndex := <span class=\"hljs-keyword\">range</span> self.interfaces &#123;</span><br><span class=\"line\">\t\tinterfaceNames[i] = self.constantPool.getClassName(cpIndex)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> interfaceNames</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>å®šä¹‰å­—æ®µå’Œæ–¹æ³•çš„ç»“æ„(field_infoã€method_info)</li>\n</ol>\n<figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> MemberInfo <span class=\"hljs-keyword\">struct</span> &#123; <span class=\"hljs-comment\">//fieldå’Œmethodçš„ç»“æ„ç±»å‹ï¼Œä½¿ç”¨åŒä¸€ä¸ªç»“æ„</span></span><br><span class=\"line\">\tcp              ConstantPool <span class=\"hljs-comment\">//å½“å‰å¸¸é‡æ± </span></span><br><span class=\"line\">\taccessFlags     <span class=\"hljs-keyword\">uint16</span> <span class=\"hljs-comment\">//è®¿é—®æ ‡å¿—</span></span><br><span class=\"line\">\tnameIndex       <span class=\"hljs-keyword\">uint16</span> <span class=\"hljs-comment\">//åç§°ç´¢å¼•</span></span><br><span class=\"line\">\tdescriptorIndex <span class=\"hljs-keyword\">uint16</span> <span class=\"hljs-comment\">//æè¿°ç´¢å¼•</span></span><br><span class=\"line\">\tattributes      []AttributeInfo <span class=\"hljs-comment\">//å±æ€§åˆ—è¡¨ </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// read field or method table</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">readMembers</span><span class=\"hljs-params\">(reader *ClassReader, cp ConstantPool)</span> []*<span class=\"hljs-title\">MemberInfo</span></span> &#123;</span><br><span class=\"line\">\tmemberCount := reader.readUint16() <span class=\"hljs-comment\">//è¯»å–fieldæˆ–methodæ•°é‡</span></span><br><span class=\"line\">\tmembers := <span class=\"hljs-built_in\">make</span>([]*MemberInfo, memberCount) <span class=\"hljs-comment\">//åˆ›å»ºæ•°ç»„</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> i := <span class=\"hljs-keyword\">range</span> members &#123;</span><br><span class=\"line\">\t\tmembers[i] = readMember(reader, cp)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> members</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//å…·ä½“è¯»å–fieldå’Œmethodçš„æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">readMember</span><span class=\"hljs-params\">(reader *ClassReader, cp ConstantPool)</span> *<span class=\"hljs-title\">MemberInfo</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> &amp;MemberInfo&#123;</span><br><span class=\"line\">\t\tcp:              cp,</span><br><span class=\"line\">\t\taccessFlags:     reader.readUint16(), <span class=\"hljs-comment\">//è¯»å–2Byteçš„è®¿é—®æ§åˆ¶ç¬¦</span></span><br><span class=\"line\">\t\tnameIndex:       reader.readUint16(), <span class=\"hljs-comment\">//è¯»å–2Byteçš„åç§°ç´¢å¼•</span></span><br><span class=\"line\">\t\tdescriptorIndex: reader.readUint16(), <span class=\"hljs-comment\">//è¯»å–2Byteçš„æè¿°ç´¢å¼•</span></span><br><span class=\"line\">\t\tattributes:      readAttributes(reader, cp), <span class=\"hljs-comment\">//è¯»å–å±æ€§åˆ—è¡¨</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *MemberInfo)</span> <span class=\"hljs-title\">AccessFlags</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint16</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.accessFlags</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡åç§°ç´¢å¼•è®¿é—®å¸¸é‡æ± </span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *MemberInfo)</span> <span class=\"hljs-title\">Name</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.cp.getUtf8(self.nameIndex)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡æè¿°ç´¢å¼•è®¿é—®å¸¸é‡æ± </span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *MemberInfo)</span> <span class=\"hljs-title\">Descriptor</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.cp.getUtf8(self.descriptorIndex)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"JVM","path":"tags/JVM/"},{"name":"Java","path":"tags/Java/"},{"name":"Go","path":"tags/Go/"}],"excerpt":"<p>ç¬¬ä¸‰ç¯‡ä¸»è¦å­¦ä¹ JVMä¸­classæ–‡ä»¶çš„å…·ä½“ç»“æ„ï¼Œå’ŒJVMæ˜¯å¦‚ä½•è§£æè¿™äº›ç»“æ„çš„ã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡javacå·¥å…·å°†ä¸€ä¸ªjavaæ–‡ä»¶compileæˆä¸€ä¸ª.classæ–‡ä»¶ï¼Œå¹¶é€šè¿‡æˆ‘ä»¬è‡ªå·±å†™çš„jvmå°†è¯¥æ–‡ä»¶è§£æå¹¶æ‰“å°å‡ºæ¥ã€‚é€šè¿‡classæ–‡ä»¶çš„å­¦ä¹ èƒ½è®©æˆ‘ä»¬æ›´åŠ æ·±åˆ»çš„ç†è§£javaæ˜¯æ€æ ·å®ç°è·¨å¹³å°ï¼Œå¹¶ä¸”æˆ‘ä»¬ç¼–å†™çš„javaä»£ç åˆæ˜¯å¦‚ä½•åœ¨JVMä¸­ä½“ç°çš„ã€‚</p>","more":"<h3 id=\"JVMä¸­classæ–‡ä»¶ç»“æ„-ClassFile\"><a href=\"#JVMä¸­classæ–‡ä»¶ç»“æ„-ClassFile\" class=\"headerlink\" title=\"JVMä¸­classæ–‡ä»¶ç»“æ„(ClassFile)\"></a>JVMä¸­classæ–‡ä»¶ç»“æ„(ClassFile)</h3><table>\n<thead>\n<tr>\n<th>Length</th>\n<th>name</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>u4</td>\n<td>magic</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>minor_version</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>major_version</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>constant_pool_count</td>\n</tr>\n<tr>\n<td>cp_info</td>\n<td>constant_pool[constant_pool_count-1]</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>access_flags</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>this_class</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>super_class</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>interfaces_count</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>interfaces[interfaces_count]</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>fields_count</td>\n</tr>\n<tr>\n<td>field_info</td>\n<td>fields[fields_count]</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>methods_count</td>\n</tr>\n<tr>\n<td>method_info</td>\n<td>methods[methods_count]</td>\n</tr>\n</tbody></table>\n<h3 id=\"JVMä¸­å­—æ®µç»“æ„-field-info\"><a href=\"#JVMä¸­å­—æ®µç»“æ„-field-info\" class=\"headerlink\" title=\"JVMä¸­å­—æ®µç»“æ„(field_info)\"></a>JVMä¸­å­—æ®µç»“æ„(field_info)</h3><table>\n<thead>\n<tr>\n<th>Length</th>\n<th>name</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>u2</td>\n<td>access_flags</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>name_index</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>descriptor_index</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>attributes_count</td>\n</tr>\n<tr>\n<td>attribute_info</td>\n<td>attributes[attributes_count]</td>\n</tr>\n</tbody></table>\n<h3 id=\"JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„-access-flags\"><a href=\"#JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„-access-flags\" class=\"headerlink\" title=\"JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„(access_flags)\"></a>JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„(access_flags)</h3><table>\n<thead>\n<tr>\n<th>æ ‡å¿—å</th>\n<th>æ ‡å¿—å€¼</th>\n<th>æ ‡å¿—å«ä¹‰</th>\n<th>é’ˆå¯¹çš„å¯¹è±¡</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>ACC_PUBLIC</td>\n<td>0x0001</td>\n<td>publicç±»å‹</td>\n<td>æ‰€æœ‰ç±»å‹</td>\n</tr>\n<tr>\n<td>ACC_FINAL</td>\n<td>0x0010</td>\n<td>finalç±»å‹</td>\n<td>ç±»</td>\n</tr>\n<tr>\n<td>ACC_SUPER</td>\n<td>0x0020</td>\n<td>ä½¿ç”¨æ–°çš„invokespecialè¯­ä¹‰</td>\n<td>ç±»å’Œæ¥å£</td>\n</tr>\n<tr>\n<td>ACC_INTERFACE</td>\n<td>0x0200</td>\n<td>æ¥å£ç±»å‹</td>\n<td>æ¥å£</td>\n</tr>\n<tr>\n<td>ACC_ABSTRACT</td>\n<td>0x0400</td>\n<td>æŠ½è±¡ç±»å‹</td>\n<td>ç±»å’Œæ¥å£</td>\n</tr>\n<tr>\n<td>ACC_SYNTHETIC</td>\n<td>0x1000</td>\n<td>è¯¥ç±»ä¸ç”±ç”¨æˆ·ä»£ç ç”Ÿæˆ</td>\n<td>æ‰€æœ‰ç±»å‹</td>\n</tr>\n<tr>\n<td>ACC_ANNOTATION</td>\n<td>0x2000</td>\n<td>æ³¨è§£ç±»å‹</td>\n<td>æ³¨è§£</td>\n</tr>\n<tr>\n<td>ACC_ENUM</td>\n<td>0x4000</td>\n<td>æšä¸¾ç±»å‹</td>\n<td>æšä¸¾</td>\n</tr>\n</tbody></table>\n<h3 id=\"å®ç°\"><a href=\"#å®ç°\" class=\"headerlink\" title=\"å®ç°\"></a>å®ç°</h3><ol>\n<li>å®šä¹‰Classæ–‡ä»¶çš„å½•å–ç±»(ClassReader)</li>\n</ol>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> ClassReader <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tdata []<span class=\"keyword\">byte</span> <span class=\"comment\">//classæ–‡ä»¶å­—èŠ‚æµ</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¯»å–u1</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassReader)</span> <span class=\"title\">readUint8</span><span class=\"params\">()</span> <span class=\"title\">uint8</span></span> &#123;</span><br><span class=\"line\">\tval := self.data[<span class=\"number\">0</span>] <span class=\"comment\">//è¯»å–1Byte</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"number\">1</span>:]</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// u2</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassReader)</span> <span class=\"title\">readUint16</span><span class=\"params\">()</span> <span class=\"title\">uint16</span></span> &#123;</span><br><span class=\"line\">\tval := binary.BigEndian.Uint16(self.data) <span class=\"comment\">//è¯»å–2Byteå¹¶è½¬ä¸ºuint16</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"number\">2</span>:]</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// u4</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassReader)</span> <span class=\"title\">readUint32</span><span class=\"params\">()</span> <span class=\"title\">uint32</span></span> &#123;</span><br><span class=\"line\">\tval := binary.BigEndian.Uint32(self.data) <span class=\"comment\">//è¯»å–4Byteå¹¶è½¬ä¸ºuint32</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"number\">4</span>:]</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassReader)</span> <span class=\"title\">readUint64</span><span class=\"params\">()</span> <span class=\"title\">uint64</span></span> &#123;</span><br><span class=\"line\">\tval := binary.BigEndian.Uint64(self.data) <span class=\"comment\">//è¯»å–8Byteå¹¶è½¬ä¸ºuint64</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"number\">8</span>:]</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassReader)</span> <span class=\"title\">readUint16s</span><span class=\"params\">()</span> []<span class=\"title\">uint16</span></span> &#123;</span><br><span class=\"line\">\tn := self.readUint16() <span class=\"comment\">//è¯»å–2Byteï¼Œè¯¥å€¼ä¸ºåç»­æ•°ç»„çš„é•¿åº¦</span></span><br><span class=\"line\">\ts := <span class=\"built_in\">make</span>([]<span class=\"keyword\">uint16</span>, n) <span class=\"comment\">//ç”Ÿäº§é•¿åº¦ä¸ºnçš„uint16ç±»å‹æ•°ç»„</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> s &#123;</span><br><span class=\"line\">\t\ts[i] = self.readUint16() <span class=\"comment\">//è¯»å–classæ–‡ä»¶ï¼Œæ¯è¯»å–2Byteä¾¿æ”¾å…¥æ•°ç»„</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> s</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassReader)</span> <span class=\"title\">readBytes</span><span class=\"params\">(n <span class=\"keyword\">uint32</span>)</span> []<span class=\"title\">byte</span></span> &#123;</span><br><span class=\"line\">\tbytes := self.data[:n] <span class=\"comment\">//è¯»å–é•¿åº¦ä¸ºnçš„å­—èŠ‚</span></span><br><span class=\"line\">\tself.data = self.data[n:]</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> bytes</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>å®šä¹‰Classæ–‡ä»¶çš„æ ¼å¼(ClassFile)</li>\n</ol>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> ClassFile <span class=\"keyword\">struct</span> &#123; <span class=\"comment\">//æŒ‰ç…§jvmè§„èŒƒï¼Œå®šä¹‰classæ–‡ä»¶ç»“æ„</span></span><br><span class=\"line\">\t<span class=\"comment\">//magic      uint32</span></span><br><span class=\"line\">\tminorVersion <span class=\"keyword\">uint16</span></span><br><span class=\"line\">\tmajorVersion <span class=\"keyword\">uint16</span></span><br><span class=\"line\">\tconstantPool ConstantPool</span><br><span class=\"line\">\taccessFlags  <span class=\"keyword\">uint16</span></span><br><span class=\"line\">\tthisClass    <span class=\"keyword\">uint16</span></span><br><span class=\"line\">\tsuperClass   <span class=\"keyword\">uint16</span></span><br><span class=\"line\">\tinterfaces   []<span class=\"keyword\">uint16</span></span><br><span class=\"line\">\tfields       []*MemberInfo</span><br><span class=\"line\">\tmethods      []*MemberInfo</span><br><span class=\"line\">\tattributes   []AttributeInfo</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//æ–‡ä»¶è§£æå…¥å£æ–¹æ³•ï¼Œå…¥å‚classæ–‡ä»¶æµï¼Œè¿”å›classæ–‡ä»¶å¯¹è±¡</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Parse</span><span class=\"params\">(classData []<span class=\"keyword\">byte</span>)</span> <span class=\"params\">(cf *ClassFile, err error)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123; <span class=\"comment\">//æ•è·å¼‚å¸¸</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> r := <span class=\"built_in\">recover</span>(); r != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> ok <span class=\"keyword\">bool</span></span><br><span class=\"line\">\t\t\terr, ok = r.(error)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">\t\t\t\terr = fmt.Errorf(<span class=\"string\">\"%v\"</span>, r)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">\tcr := &amp;ClassReader&#123;classData&#125; <span class=\"comment\">//å®ä¾‹åŒ–classReaderç±»</span></span><br><span class=\"line\">\tcf = &amp;ClassFile&#123;&#125; <span class=\"comment\">//å®ä¾‹åŒ–ClassFileç±»</span></span><br><span class=\"line\">\tcf.read(cr) <span class=\"comment\">//è¯»å–classæ–‡ä»¶</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//è¯»å–classæ–‡ä»¶çš„å…·ä½“æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">read</span><span class=\"params\">(reader *ClassReader)</span></span> &#123;</span><br><span class=\"line\">\tself.readAndCheckMagic(reader) <span class=\"comment\">//è¯»å–é­”æ•°</span></span><br><span class=\"line\">\tself.readAndCheckVersion(reader) <span class=\"comment\">//è¯»å–ä¸»æ¬¡ç‰ˆæœ¬å·</span></span><br><span class=\"line\">\tself.constantPool = readConstantPool(reader) <span class=\"comment\">//è¯»å–å¸¸é‡æ± </span></span><br><span class=\"line\">\tself.accessFlags = reader.readUint16() <span class=\"comment\">//è¯»å–å½“å‰ç±»ï¼ˆæˆ–è€…æ¥å£ï¼‰çš„è®¿é—®ä¿®é¥°ç¬¦</span></span><br><span class=\"line\">\tself.thisClass = reader.readUint16() <span class=\"comment\">//è¯»å–å½“å‰ç±»ç´¢å¼•</span></span><br><span class=\"line\">\tself.superClass = reader.readUint16() <span class=\"comment\">//è¯»å–çˆ¶ç±»ç´¢å¼•</span></span><br><span class=\"line\">\tself.interfaces = reader.readUint16s() <span class=\"comment\">//è¯»å–æ‰€æœ‰æ¥å£ç´¢å¼•</span></span><br><span class=\"line\">\tself.fields = readMembers(reader, self.constantPool) <span class=\"comment\">//ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æˆå‘˜</span></span><br><span class=\"line\">\tself.methods = readMembers(reader, self.constantPool) <span class=\"comment\">//ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æ–¹æ³•</span></span><br><span class=\"line\">\tself.attributes = readAttributes(reader, self.constantPool) <span class=\"comment\">//ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰å±æ€§</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">readAndCheckMagic</span><span class=\"params\">(reader *ClassReader)</span></span> &#123;</span><br><span class=\"line\">\tmagic := reader.readUint32() <span class=\"comment\">//è¯»å–4Byteé­”æ•°</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> magic != <span class=\"number\">0xCAFEBABE</span> &#123; <span class=\"comment\">//åˆ¤æ–­é­”æ•°æ˜¯å¦ä¸º0xCAFEBABE</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(<span class=\"string\">\"java.lang.ClassFormatError: magic!\"</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">readAndCheckVersion</span><span class=\"params\">(reader *ClassReader)</span></span> &#123;</span><br><span class=\"line\">\tself.minorVersion = reader.readUint16() <span class=\"comment\">//é«˜2Byteä¸ºæ¬¡ç‰ˆæœ¬å·</span></span><br><span class=\"line\">\tself.majorVersion = reader.readUint16() <span class=\"comment\">//ä½2Byteä¸ºä¸»ç‰ˆæœ¬å·</span></span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> self.majorVersion &#123; <span class=\"comment\">//æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¸º45~52</span></span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">45</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">46</span>, <span class=\"number\">47</span>, <span class=\"number\">48</span>, <span class=\"number\">49</span>, <span class=\"number\">50</span>, <span class=\"number\">51</span>, <span class=\"number\">52</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> self.minorVersion == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">panic</span>(<span class=\"string\">\"java.lang.UnsupportedClassVersionError!\"</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">MinorVersion</span><span class=\"params\">()</span> <span class=\"title\">uint16</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.minorVersion</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">MajorVersion</span><span class=\"params\">()</span> <span class=\"title\">uint16</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.majorVersion</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">ConstantPool</span><span class=\"params\">()</span> <span class=\"title\">ConstantPool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.constantPool</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">AccessFlags</span><span class=\"params\">()</span> <span class=\"title\">uint16</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.accessFlags</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">Fields</span><span class=\"params\">()</span> []*<span class=\"title\">MemberInfo</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.fields</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">Methods</span><span class=\"params\">()</span> []*<span class=\"title\">MemberInfo</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.methods</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®thisClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">ClassName</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.constantPool.getClassName(self.thisClass)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®superClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">SuperClassName</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> self.superClass &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> self.constantPool.getClassName(self.superClass)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"string\">\"\"</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®interfacesç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">InterfaceNames</span><span class=\"params\">()</span> []<span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\tinterfaceNames := <span class=\"built_in\">make</span>([]<span class=\"keyword\">string</span>, <span class=\"built_in\">len</span>(self.interfaces))</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i, cpIndex := <span class=\"keyword\">range</span> self.interfaces &#123;</span><br><span class=\"line\">\t\tinterfaceNames[i] = self.constantPool.getClassName(cpIndex)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> interfaceNames</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>å®šä¹‰å­—æ®µå’Œæ–¹æ³•çš„ç»“æ„(field_infoã€method_info)</li>\n</ol>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> MemberInfo <span class=\"keyword\">struct</span> &#123; <span class=\"comment\">//fieldå’Œmethodçš„ç»“æ„ç±»å‹ï¼Œä½¿ç”¨åŒä¸€ä¸ªç»“æ„</span></span><br><span class=\"line\">\tcp              ConstantPool <span class=\"comment\">//å½“å‰å¸¸é‡æ± </span></span><br><span class=\"line\">\taccessFlags     <span class=\"keyword\">uint16</span> <span class=\"comment\">//è®¿é—®æ ‡å¿—</span></span><br><span class=\"line\">\tnameIndex       <span class=\"keyword\">uint16</span> <span class=\"comment\">//åç§°ç´¢å¼•</span></span><br><span class=\"line\">\tdescriptorIndex <span class=\"keyword\">uint16</span> <span class=\"comment\">//æè¿°ç´¢å¼•</span></span><br><span class=\"line\">\tattributes      []AttributeInfo <span class=\"comment\">//å±æ€§åˆ—è¡¨ </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// read field or method table</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">readMembers</span><span class=\"params\">(reader *ClassReader, cp ConstantPool)</span> []*<span class=\"title\">MemberInfo</span></span> &#123;</span><br><span class=\"line\">\tmemberCount := reader.readUint16() <span class=\"comment\">//è¯»å–fieldæˆ–methodæ•°é‡</span></span><br><span class=\"line\">\tmembers := <span class=\"built_in\">make</span>([]*MemberInfo, memberCount) <span class=\"comment\">//åˆ›å»ºæ•°ç»„</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> members &#123;</span><br><span class=\"line\">\t\tmembers[i] = readMember(reader, cp)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> members</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å…·ä½“è¯»å–fieldå’Œmethodçš„æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">readMember</span><span class=\"params\">(reader *ClassReader, cp ConstantPool)</span> *<span class=\"title\">MemberInfo</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;MemberInfo&#123;</span><br><span class=\"line\">\t\tcp:              cp,</span><br><span class=\"line\">\t\taccessFlags:     reader.readUint16(), <span class=\"comment\">//è¯»å–2Byteçš„è®¿é—®æ§åˆ¶ç¬¦</span></span><br><span class=\"line\">\t\tnameIndex:       reader.readUint16(), <span class=\"comment\">//è¯»å–2Byteçš„åç§°ç´¢å¼•</span></span><br><span class=\"line\">\t\tdescriptorIndex: reader.readUint16(), <span class=\"comment\">//è¯»å–2Byteçš„æè¿°ç´¢å¼•</span></span><br><span class=\"line\">\t\tattributes:      readAttributes(reader, cp), <span class=\"comment\">//è¯»å–å±æ€§åˆ—è¡¨</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *MemberInfo)</span> <span class=\"title\">AccessFlags</span><span class=\"params\">()</span> <span class=\"title\">uint16</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.accessFlags</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡åç§°ç´¢å¼•è®¿é—®å¸¸é‡æ± </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *MemberInfo)</span> <span class=\"title\">Name</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.cp.getUtf8(self.nameIndex)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡æè¿°ç´¢å¼•è®¿é—®å¸¸é‡æ± </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *MemberInfo)</span> <span class=\"title\">Descriptor</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.cp.getUtf8(self.descriptorIndex)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜","date":"2019-09-24T06:36:13.000Z","_content":"\næ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š\n{% asset_img wenti.png 400 400 é”™è¯¯ %}\n<!-- more -->\n\nç»è¿‡è°ƒæŸ¥,ç”±äºé‡å†™äº†WebMvcConfigurationSupport.configureMessageConvertersæ–¹æ³•\n{% codeblock lang:java %}\n@Configuration\npublic class OpenServiceConfig extends WebMvcConfigurationSupport implements ApplicationRunner {\n\n    @Autowired\n    private Environment environment;\n\n    private ApiMappingHandlerMapping apiMappingHandlerMapping = new ApiMappingHandlerMapping();\n\n    @Override\n    protected RequestMappingHandlerMapping createRequestMappingHandlerMapping() {\n        return apiMappingHandlerMapping;\n    }\n\n    @Override\n    public void run(ApplicationArguments args) {\n        ApiMetaManager apiMetaManager = new ServiceZookeeperApiMetaManager(environment);\n        RequestMappingEvent requestMappingEvent = new DefaultRequestMappingEvent(apiMetaManager, environment);\n        requestMappingEvent.onRegisterSuccess(apiMappingHandlerMapping);\n    }\n\n    @Override\n    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {\n        converters.clear();\n        ObjectMapper objectMapper = new ObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);\n        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false);\n        converters.add(new MappingJackson2HttpMessageConverter(objectMapper));\n    }\n\n    @Override\n    protected void addResourceHandlers(ResourceHandlerRegistry registry) {\n        registry.addResourceHandler(\"swagger-ui.html\")\n                .addResourceLocations(\"classpath:/META-INF/resources/\");\n\n        registry.addResourceHandler(\"/webjars/**\")\n                .addResourceLocations(\"classpath:/META-INF/resources/webjars/\");\n    }\n}\n{% endcodeblock %}\n\nspringMVCå¼€å§‹åŠ è½½è½¬æ¢å™¨çš„æ—¶å€™ä¼šå…ˆèµ°ç”¨æˆ·å®šåˆ¶åŒ–æ–¹æ³•\n{% codeblock lang:java %}\n\tprotected final List<HttpMessageConverter<?>> getMessageConverters() {\n\t\tif (this.messageConverters == null) {\n\t\t\tthis.messageConverters = new ArrayList<HttpMessageConverter<?>>();\n\t\t\tconfigureMessageConverters(this.messageConverters);\n\t\t\tif (this.messageConverters.isEmpty()) {\n\t\t\t\taddDefaultHttpMessageConverters(this.messageConverters);\n\t\t\t}\n\t\t\textendMessageConverters(this.messageConverters);\n\t\t}\n\t\treturn this.messageConverters;\n\t}\n{% endcodeblock %}\n\nå¦‚æœç”¨æˆ·æ²¡æœ‰å®šåˆ¶åŒ–ï¼Œspringmvcä¼šä½¿ç”¨è‡ªå®šä¸ªçš„7ä¸ªè½¬æ¢å™¨\n{% codeblock lang:java %}\n\tprotected final void addDefaultHttpMessageConverters(List<HttpMessageConverter<?>> messageConverters) {\n\t\tStringHttpMessageConverter stringConverter = new StringHttpMessageConverter();\n\t\tstringConverter.setWriteAcceptCharset(false);\n\n\t\tmessageConverters.add(new ByteArrayHttpMessageConverter());\n\t\tmessageConverters.add(stringConverter);\n\t\tmessageConverters.add(new ResourceHttpMessageConverter());\n\t\tmessageConverters.add(new SourceHttpMessageConverter<Source>());\n\t\tmessageConverters.add(new AllEncompassingFormHttpMessageConverter());\n\n\t\tif (romePresent) {\n\t\t\tmessageConverters.add(new AtomFeedHttpMessageConverter());\n\t\t\tmessageConverters.add(new RssChannelHttpMessageConverter());\n\t\t}\n\n\t\tif (jackson2XmlPresent) {\n\t\t\tmessageConverters.add(new MappingJackson2XmlHttpMessageConverter(\n\t\t\t\t\tJackson2ObjectMapperBuilder.xml().applicationContext(this.applicationContext).build()));\n\t\t}\n\t\telse if (jaxb2Present) {\n\t\t\tmessageConverters.add(new Jaxb2RootElementHttpMessageConverter());\n\t\t}\n\n\t\tif (jackson2Present) {\n\t\t\tmessageConverters.add(new MappingJackson2HttpMessageConverter(\n\t\t\t\t\tJackson2ObjectMapperBuilder.json().applicationContext(this.applicationContext).build()));\n\t\t}\n\t\telse if (gsonPresent) {\n\t\t\tmessageConverters.add(new GsonHttpMessageConverter());\n\t\t}\n\t}\n{% endcodeblock %}\n\nç”±äºé¡¹ç›®åœ¨è‡ªå®šä¹‰çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½è¿™ç§å­—èŠ‚æµçš„è§£æï¼Œå¯¼è‡´åºåˆ—åŒ–å¤±è´¥\nå¢åŠ é…ç½®è§£å†³é—®é¢˜\n{% codeblock lang:java %}\nobjectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false);\n{% endcodeblock %}","source":"_posts/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜.md","raw":"---\ntitle: è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜\ndate: 2019-09-24 14:36:13\ntags:\n    - Java\n    - Spring Boot\ncategories:\n    - Technology\n---\n\næ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š\n{% asset_img wenti.png 400 400 é”™è¯¯ %}\n<!-- more -->\n\nç»è¿‡è°ƒæŸ¥,ç”±äºé‡å†™äº†WebMvcConfigurationSupport.configureMessageConvertersæ–¹æ³•\n{% codeblock lang:java %}\n@Configuration\npublic class OpenServiceConfig extends WebMvcConfigurationSupport implements ApplicationRunner {\n\n    @Autowired\n    private Environment environment;\n\n    private ApiMappingHandlerMapping apiMappingHandlerMapping = new ApiMappingHandlerMapping();\n\n    @Override\n    protected RequestMappingHandlerMapping createRequestMappingHandlerMapping() {\n        return apiMappingHandlerMapping;\n    }\n\n    @Override\n    public void run(ApplicationArguments args) {\n        ApiMetaManager apiMetaManager = new ServiceZookeeperApiMetaManager(environment);\n        RequestMappingEvent requestMappingEvent = new DefaultRequestMappingEvent(apiMetaManager, environment);\n        requestMappingEvent.onRegisterSuccess(apiMappingHandlerMapping);\n    }\n\n    @Override\n    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {\n        converters.clear();\n        ObjectMapper objectMapper = new ObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);\n        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false);\n        converters.add(new MappingJackson2HttpMessageConverter(objectMapper));\n    }\n\n    @Override\n    protected void addResourceHandlers(ResourceHandlerRegistry registry) {\n        registry.addResourceHandler(\"swagger-ui.html\")\n                .addResourceLocations(\"classpath:/META-INF/resources/\");\n\n        registry.addResourceHandler(\"/webjars/**\")\n                .addResourceLocations(\"classpath:/META-INF/resources/webjars/\");\n    }\n}\n{% endcodeblock %}\n\nspringMVCå¼€å§‹åŠ è½½è½¬æ¢å™¨çš„æ—¶å€™ä¼šå…ˆèµ°ç”¨æˆ·å®šåˆ¶åŒ–æ–¹æ³•\n{% codeblock lang:java %}\n\tprotected final List<HttpMessageConverter<?>> getMessageConverters() {\n\t\tif (this.messageConverters == null) {\n\t\t\tthis.messageConverters = new ArrayList<HttpMessageConverter<?>>();\n\t\t\tconfigureMessageConverters(this.messageConverters);\n\t\t\tif (this.messageConverters.isEmpty()) {\n\t\t\t\taddDefaultHttpMessageConverters(this.messageConverters);\n\t\t\t}\n\t\t\textendMessageConverters(this.messageConverters);\n\t\t}\n\t\treturn this.messageConverters;\n\t}\n{% endcodeblock %}\n\nå¦‚æœç”¨æˆ·æ²¡æœ‰å®šåˆ¶åŒ–ï¼Œspringmvcä¼šä½¿ç”¨è‡ªå®šä¸ªçš„7ä¸ªè½¬æ¢å™¨\n{% codeblock lang:java %}\n\tprotected final void addDefaultHttpMessageConverters(List<HttpMessageConverter<?>> messageConverters) {\n\t\tStringHttpMessageConverter stringConverter = new StringHttpMessageConverter();\n\t\tstringConverter.setWriteAcceptCharset(false);\n\n\t\tmessageConverters.add(new ByteArrayHttpMessageConverter());\n\t\tmessageConverters.add(stringConverter);\n\t\tmessageConverters.add(new ResourceHttpMessageConverter());\n\t\tmessageConverters.add(new SourceHttpMessageConverter<Source>());\n\t\tmessageConverters.add(new AllEncompassingFormHttpMessageConverter());\n\n\t\tif (romePresent) {\n\t\t\tmessageConverters.add(new AtomFeedHttpMessageConverter());\n\t\t\tmessageConverters.add(new RssChannelHttpMessageConverter());\n\t\t}\n\n\t\tif (jackson2XmlPresent) {\n\t\t\tmessageConverters.add(new MappingJackson2XmlHttpMessageConverter(\n\t\t\t\t\tJackson2ObjectMapperBuilder.xml().applicationContext(this.applicationContext).build()));\n\t\t}\n\t\telse if (jaxb2Present) {\n\t\t\tmessageConverters.add(new Jaxb2RootElementHttpMessageConverter());\n\t\t}\n\n\t\tif (jackson2Present) {\n\t\t\tmessageConverters.add(new MappingJackson2HttpMessageConverter(\n\t\t\t\t\tJackson2ObjectMapperBuilder.json().applicationContext(this.applicationContext).build()));\n\t\t}\n\t\telse if (gsonPresent) {\n\t\t\tmessageConverters.add(new GsonHttpMessageConverter());\n\t\t}\n\t}\n{% endcodeblock %}\n\nç”±äºé¡¹ç›®åœ¨è‡ªå®šä¹‰çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½è¿™ç§å­—èŠ‚æµçš„è§£æï¼Œå¯¼è‡´åºåˆ—åŒ–å¤±è´¥\nå¢åŠ é…ç½®è§£å†³é—®é¢˜\n{% codeblock lang:java %}\nobjectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false);\n{% endcodeblock %}","slug":"è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜","published":1,"updated":"2019-09-25T12:54:24.699Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck10secrc0008jonyjxbet15l","content":"<p>æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š</p>\n<img src=\"/2019/09/24/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜/wenti.png\" width=\"400\" height=\"400\" title=\"é”™è¯¯\">\n<a id=\"more\"></a>\n\n<p>ç»è¿‡è°ƒæŸ¥,ç”±äºé‡å†™äº†WebMvcConfigurationSupport.configureMessageConvertersæ–¹æ³•</p>\n<figure class=\"highlight java hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OpenServiceConfig</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">WebMvcConfigurationSupport</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">ApplicationRunner</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> Environment environment;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> ApiMappingHandlerMapping apiMappingHandlerMapping = <span class=\"hljs-keyword\">new</span> ApiMappingHandlerMapping();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> RequestMappingHandlerMapping <span class=\"hljs-title\">createRequestMappingHandlerMapping</span><span class=\"hljs-params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> apiMappingHandlerMapping;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">run</span><span class=\"hljs-params\">(ApplicationArguments args)</span> </span>&#123;</span><br><span class=\"line\">        ApiMetaManager apiMetaManager = <span class=\"hljs-keyword\">new</span> ServiceZookeeperApiMetaManager(environment);</span><br><span class=\"line\">        RequestMappingEvent requestMappingEvent = <span class=\"hljs-keyword\">new</span> DefaultRequestMappingEvent(apiMetaManager, environment);</span><br><span class=\"line\">        requestMappingEvent.onRegisterSuccess(apiMappingHandlerMapping);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">configureMessageConverters</span><span class=\"hljs-params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class=\"line\">        converters.clear();</span><br><span class=\"line\">        ObjectMapper objectMapper = <span class=\"hljs-keyword\">new</span> ObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br><span class=\"line\">        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,<span class=\"hljs-keyword\">false</span>);</span><br><span class=\"line\">        converters.add(<span class=\"hljs-keyword\">new</span> MappingJackson2HttpMessageConverter(objectMapper));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">addResourceHandlers</span><span class=\"hljs-params\">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class=\"line\">        registry.addResourceHandler(<span class=\"hljs-string\">\"swagger-ui.html\"</span>)</span><br><span class=\"line\">                .addResourceLocations(<span class=\"hljs-string\">\"classpath:/META-INF/resources/\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        registry.addResourceHandler(<span class=\"hljs-string\">\"/webjars/**\"</span>)</span><br><span class=\"line\">                .addResourceLocations(<span class=\"hljs-string\">\"classpath:/META-INF/resources/webjars/\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>springMVCå¼€å§‹åŠ è½½è½¬æ¢å™¨çš„æ—¶å€™ä¼šå…ˆèµ°ç”¨æˆ·å®šåˆ¶åŒ–æ–¹æ³•</p>\n<figure class=\"highlight java hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">final</span> List&lt;HttpMessageConverter&lt;?&gt;&gt; getMessageConverters() &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">this</span>.messageConverters == <span class=\"hljs-keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">this</span>.messageConverters = <span class=\"hljs-keyword\">new</span> ArrayList&lt;HttpMessageConverter&lt;?&gt;&gt;();</span><br><span class=\"line\">\t\tconfigureMessageConverters(<span class=\"hljs-keyword\">this</span>.messageConverters);</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">this</span>.messageConverters.isEmpty()) &#123;</span><br><span class=\"line\">\t\t\taddDefaultHttpMessageConverters(<span class=\"hljs-keyword\">this</span>.messageConverters);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\textendMessageConverters(<span class=\"hljs-keyword\">this</span>.messageConverters);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">this</span>.messageConverters;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¦‚æœç”¨æˆ·æ²¡æœ‰å®šåˆ¶åŒ–ï¼Œspringmvcä¼šä½¿ç”¨è‡ªå®šä¸ªçš„7ä¸ªè½¬æ¢å™¨</p>\n<figure class=\"highlight java hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">addDefaultHttpMessageConverters</span><span class=\"hljs-params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters)</span> </span>&#123;</span><br><span class=\"line\">\tStringHttpMessageConverter stringConverter = <span class=\"hljs-keyword\">new</span> StringHttpMessageConverter();</span><br><span class=\"line\">\tstringConverter.setWriteAcceptCharset(<span class=\"hljs-keyword\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> ByteArrayHttpMessageConverter());</span><br><span class=\"line\">\tmessageConverters.add(stringConverter);</span><br><span class=\"line\">\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> ResourceHttpMessageConverter());</span><br><span class=\"line\">\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> SourceHttpMessageConverter&lt;Source&gt;());</span><br><span class=\"line\">\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> AllEncompassingFormHttpMessageConverter());</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> (romePresent) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> AtomFeedHttpMessageConverter());</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> RssChannelHttpMessageConverter());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> (jackson2XmlPresent) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> MappingJackson2XmlHttpMessageConverter(</span><br><span class=\"line\">\t\t\t\tJackson2ObjectMapperBuilder.xml().applicationContext(<span class=\"hljs-keyword\">this</span>.applicationContext).build()));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (jaxb2Present) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> Jaxb2RootElementHttpMessageConverter());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> (jackson2Present) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> MappingJackson2HttpMessageConverter(</span><br><span class=\"line\">\t\t\t\tJackson2ObjectMapperBuilder.json().applicationContext(<span class=\"hljs-keyword\">this</span>.applicationContext).build()));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (gsonPresent) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> GsonHttpMessageConverter());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç”±äºé¡¹ç›®åœ¨è‡ªå®šä¹‰çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½è¿™ç§å­—èŠ‚æµçš„è§£æï¼Œå¯¼è‡´åºåˆ—åŒ–å¤±è´¥<br>å¢åŠ é…ç½®è§£å†³é—®é¢˜</p>\n<figure class=\"highlight java hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">objectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, <span class=\"hljs-keyword\">false</span>);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Spring Boot","path":"tags/Spring-Boot/"}],"excerpt":"<p>æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š</p>\n<img src=\"/2019/09/24/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜/wenti.png\" width=\"400\" height=\"400\" title=\"é”™è¯¯\">","more":"<p>ç»è¿‡è°ƒæŸ¥,ç”±äºé‡å†™äº†WebMvcConfigurationSupport.configureMessageConvertersæ–¹æ³•</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OpenServiceConfig</span> <span class=\"keyword\">extends</span> <span class=\"title\">WebMvcConfigurationSupport</span> <span class=\"keyword\">implements</span> <span class=\"title\">ApplicationRunner</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Environment environment;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ApiMappingHandlerMapping apiMappingHandlerMapping = <span class=\"keyword\">new</span> ApiMappingHandlerMapping();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> RequestMappingHandlerMapping <span class=\"title\">createRequestMappingHandlerMapping</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> apiMappingHandlerMapping;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">(ApplicationArguments args)</span> </span>&#123;</span><br><span class=\"line\">        ApiMetaManager apiMetaManager = <span class=\"keyword\">new</span> ServiceZookeeperApiMetaManager(environment);</span><br><span class=\"line\">        RequestMappingEvent requestMappingEvent = <span class=\"keyword\">new</span> DefaultRequestMappingEvent(apiMetaManager, environment);</span><br><span class=\"line\">        requestMappingEvent.onRegisterSuccess(apiMappingHandlerMapping);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">configureMessageConverters</span><span class=\"params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class=\"line\">        converters.clear();</span><br><span class=\"line\">        ObjectMapper objectMapper = <span class=\"keyword\">new</span> ObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br><span class=\"line\">        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,<span class=\"keyword\">false</span>);</span><br><span class=\"line\">        converters.add(<span class=\"keyword\">new</span> MappingJackson2HttpMessageConverter(objectMapper));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">addResourceHandlers</span><span class=\"params\">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class=\"line\">        registry.addResourceHandler(<span class=\"string\">\"swagger-ui.html\"</span>)</span><br><span class=\"line\">                .addResourceLocations(<span class=\"string\">\"classpath:/META-INF/resources/\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        registry.addResourceHandler(<span class=\"string\">\"/webjars/**\"</span>)</span><br><span class=\"line\">                .addResourceLocations(<span class=\"string\">\"classpath:/META-INF/resources/webjars/\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>springMVCå¼€å§‹åŠ è½½è½¬æ¢å™¨çš„æ—¶å€™ä¼šå…ˆèµ°ç”¨æˆ·å®šåˆ¶åŒ–æ–¹æ³•</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">final</span> List&lt;HttpMessageConverter&lt;?&gt;&gt; getMessageConverters() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.messageConverters == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.messageConverters = <span class=\"keyword\">new</span> ArrayList&lt;HttpMessageConverter&lt;?&gt;&gt;();</span><br><span class=\"line\">\t\tconfigureMessageConverters(<span class=\"keyword\">this</span>.messageConverters);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.messageConverters.isEmpty()) &#123;</span><br><span class=\"line\">\t\t\taddDefaultHttpMessageConverters(<span class=\"keyword\">this</span>.messageConverters);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\textendMessageConverters(<span class=\"keyword\">this</span>.messageConverters);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.messageConverters;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¦‚æœç”¨æˆ·æ²¡æœ‰å®šåˆ¶åŒ–ï¼Œspringmvcä¼šä½¿ç”¨è‡ªå®šä¸ªçš„7ä¸ªè½¬æ¢å™¨</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">addDefaultHttpMessageConverters</span><span class=\"params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters)</span> </span>&#123;</span><br><span class=\"line\">\tStringHttpMessageConverter stringConverter = <span class=\"keyword\">new</span> StringHttpMessageConverter();</span><br><span class=\"line\">\tstringConverter.setWriteAcceptCharset(<span class=\"keyword\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\tmessageConverters.add(<span class=\"keyword\">new</span> ByteArrayHttpMessageConverter());</span><br><span class=\"line\">\tmessageConverters.add(stringConverter);</span><br><span class=\"line\">\tmessageConverters.add(<span class=\"keyword\">new</span> ResourceHttpMessageConverter());</span><br><span class=\"line\">\tmessageConverters.add(<span class=\"keyword\">new</span> SourceHttpMessageConverter&lt;Source&gt;());</span><br><span class=\"line\">\tmessageConverters.add(<span class=\"keyword\">new</span> AllEncompassingFormHttpMessageConverter());</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (romePresent) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"keyword\">new</span> AtomFeedHttpMessageConverter());</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"keyword\">new</span> RssChannelHttpMessageConverter());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (jackson2XmlPresent) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"keyword\">new</span> MappingJackson2XmlHttpMessageConverter(</span><br><span class=\"line\">\t\t\t\tJackson2ObjectMapperBuilder.xml().applicationContext(<span class=\"keyword\">this</span>.applicationContext).build()));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (jaxb2Present) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"keyword\">new</span> Jaxb2RootElementHttpMessageConverter());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (jackson2Present) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"keyword\">new</span> MappingJackson2HttpMessageConverter(</span><br><span class=\"line\">\t\t\t\tJackson2ObjectMapperBuilder.json().applicationContext(<span class=\"keyword\">this</span>.applicationContext).build()));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (gsonPresent) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"keyword\">new</span> GsonHttpMessageConverter());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç”±äºé¡¹ç›®åœ¨è‡ªå®šä¹‰çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½è¿™ç§å­—èŠ‚æµçš„è§£æï¼Œå¯¼è‡´åºåˆ—åŒ–å¤±è´¥<br>å¢åŠ é…ç½®è§£å†³é—®é¢˜</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">objectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, <span class=\"keyword\">false</span>);</span><br></pre></td></tr></table></figure>"},{"title":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°4","date":"2019-09-26T13:49:11.000Z","_content":"\n### è¿è¡Œæ—¶æ•°æ®åŒº\nJVMå°†éœ€è¦ç”¨åˆ°çš„æ•°æ®å­˜æ”¾å…¥å†…å­˜ä¸­ï¼Œè¿™ä¸ªå†…å­˜åŒºå°±å«è¿è¡Œæ—¶æ•°æ®åŒº\nå¯åˆ†ä¸ºä¸¤ç§ï¼š\n1. ä¸€ç±»æ˜¯å¤šçº¿ç¨‹å…±äº«çš„ï¼Œè¯¥æ•°æ®åŒºéœ€è¦åœ¨Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºå¥½ï¼Œåœ¨Javaè™šæ‹Ÿæœºé€€å‡ºæ—¶é”€æ¯ã€‚\n2. ä¸€ç±»åˆ™æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œè¯¥æ•°æ®åŒºåˆ™åœ¨åˆ›å»ºçº¿ç¨‹æ—¶æ‰åˆ›å»ºï¼Œçº¿ç¨‹é€€å‡ºæ—¶é”€æ¯ã€‚\n\n<!-- more -->\n\n{% asset_img è¿è¡Œæ—¶æ•°æ®åŒº.png 800 800 è¿è¡Œæ—¶æ•°æ®åŒº %}\n\n### å®ç°\n#### å®šä¹‰å¯¹è±¡ç»“æ„\n\n{% codeblock lang:golang %}\ntype Object struct {\n\t// todo\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\n\n{% codeblock lang:golang %}\ntype Thread struct {\n\tpc    int // the address of the instruction currently being executed\n\tstack *Stack //Javaè™šæ‹Ÿæœºæ ˆæŒ‡é’ˆ\n\t// todo\n}\n\n//åˆ›å»ºThreadå®ä¾‹\n//javaå‘½ä»¤æä¾›äº†-Xssé€‰é¡¹æ¥è®¾ç½®Javaè™šæ‹Ÿæœºæ ˆå¤§å°\nfunc NewThread() *Thread {\n\treturn &Thread{\n\t\tstack: newStack(1024), //æœ€å¤šå®¹çº³1024å¸§\n\t}\n}\n\nfunc (self *Thread) PC() int {\n\treturn self.pc\n}\nfunc (self *Thread) SetPC(pc int) {\n\tself.pc = pc\n}\n\n//å½“å‰å¸§è¿›æ ˆ\nfunc (self *Thread) PushFrame(frame *Frame) {\n\tself.stack.push(frame)\n}\n//å½“å‰å¸§å‡ºæ ˆ\nfunc (self *Thread) PopFrame() *Frame {\n\treturn self.stack.pop()\n}\n//è·å–å½“å‰å¸§\nfunc (self *Thread) CurrentFrame() *Frame {\n\treturn self.stack.top()\n}\n\n\n\n\n{% endcodeblock %}\n\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\n\n{% codeblock lang:golang %}\ntype Stack struct {\n\tmaxSize uint //æœ€å¤šå¯ä»¥å®¹çº³å¤šå°‘å¸§\n\tsize    uint //æ ˆçš„å½“å‰å¤§å°\n\t_top    *Frame //ä¿å­˜æ ˆé¡¶æŒ‡é’ˆ\n}\n\n//å®ä¾‹ä¸€ä¸ªæ ˆ\nfunc newStack(maxSize uint) *Stack {\n\treturn &Stack{\n\t\tmaxSize: maxSize,\n\t}\n}\n\n//å½“å‰å¸§è¿›æ ˆ\nfunc (self *Stack) push(frame *Frame) {\n\tif self.size >= self.maxSize { //åˆ¤æ–­å½“å‰æ ˆå¤§å°æ˜¯å¦è¶…è¿‡æœ€å¤§å®¹é‡\n\t\tpanic(\"java.lang.StackOverflowError\") \n\t}\n\n\tif self._top != nil {  //å½“å‰æ ˆé¡¶ä¸ä¸ºç©ºæ—¶\n\t\tframe.lower = self._top //å°†æ’å…¥å¸§å°¾æŒ‡å‘æ ˆé¡¶æŒ‡é’ˆ\n\t}\n\n\tself._top = frame //å½“å‰æ ˆé¡¶æŒ‡å‘å½“å‰å¸§\n\tself.size++ //å½“å‰æ ˆå¤§å°åŠ 1\n}\n\n//å½“å‰å¸§å‡ºæ ˆ\nfunc (self *Stack) pop() *Frame {\n\tif self._top == nil { //å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™\n\t\tpanic(\"jvm stack is empty!\")\n\t}\n\n\ttop := self._top //å–å‡ºå½“å‰æ ˆé¡¶å¸§\n\tself._top = top.lower //å°†å½“å‰æ ˆé¡¶æŒ‡å‘topçš„ä¸‹ä¸€å¸§\n\ttop.lower = nil //æ–­å¼€topçš„å°¾æŒ‡é’ˆ\n\tself.size-- //å½“å‰æ ˆå¤§å°å‡1\n\n\treturn top //è¿”å›top\n}\n\n//è·å–å½“å‰æ ˆé¡¶å¸§\nfunc (self *Stack) top() *Frame {\n\tif self._top == nil { ////å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™\n\t\tpanic(\"jvm stack is empty!\")\n\t}\n\n\treturn self._top //è¿”å›å½“å‰æ ˆé¡¶å¸§\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\n\n{% codeblock lang:golang %}\ntype Frame struct {\n\tlower        *Frame //æŒ‡å‘ä¸‹ä¸€å¸§\n\tlocalVars    LocalVars //ä¿å­˜å±€éƒ¨å˜é‡è¡¨æŒ‡é’ˆ\n\toperandStack *OperandStack //ä¿å­˜æ“ä½œæ•°æ ˆæŒ‡é’ˆ\n\t// todo\n}\n\n//å®ä¾‹åŒ–å¸§\nfunc NewFrame(maxLocals, maxStack uint) *Frame {\n\treturn &Frame{\n\t\tlocalVars:    newLocalVars(maxLocals), //å®ä¾‹åŒ–å±€éƒ¨å˜é‡å¯¹è±¡\n\t\toperandStack: newOperandStack(maxStack), //å®ä¾‹åŒ–æ“ä½œæ•°æ ˆå¯¹è±¡\n\t}\n}\n\n// getters\nfunc (self *Frame) LocalVars() LocalVars {\n\treturn self.localVars\n}\nfunc (self *Frame) OperandStack() *OperandStack {\n\treturn self.operandStack\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\n\n{% codeblock lang:golang %}\ntype LocalVars []Slot\n\n//åˆ›å»ºå±€éƒ¨å˜é‡å®ä¾‹\nfunc newLocalVars(maxLocals uint) LocalVars {\n\tif maxLocals > 0 {\n\t\treturn make([]Slot, maxLocals) //ç”³æ˜å¤§å°ä¸ºmaxLocalsçš„Slotæ•°ç»„\n\t}\n\treturn nil\n}\n\n//è®¾ç½®intç±»å‹\nfunc (self LocalVars) SetInt(index uint, val int32) {\n\tself[index].num = val\n}\n//å–intç±»å‹\nfunc (self LocalVars) GetInt(index uint) int32 {\n\treturn self[index].num\n}\n//è®¾ç½®float32ç±»å‹\nfunc (self LocalVars) SetFloat(index uint, val float32) {\n\tbits := math.Float32bits(val)//è½¬ä¸ºuint32\n\tself[index].num = int32(bits) //è½¬ä¸ºint32\n}\n//å–float32ç±»å‹\nfunc (self LocalVars) GetFloat(index uint) float32 {\n\tbits := uint32(self[index].num)//è½¬ä¸ºunit32\n\treturn math.Float32frombits(bits)//è½¬ä¸ºfloat\n}\n\n//è®¾ç½®longç±»å‹\nfunc (self LocalVars) SetLong(index uint, val int64) {\n\tself[index].num = int32(val)//å–ä½ä½32ä½å­˜å‚¨åœ¨index\n\tself[index+1].num = int32(val >> 32) //å³ç§»32ä½å–é«˜ä½32ä½å­˜å‚¨åœ¨index+1\n}\n//å–longç±»å‹\nfunc (self LocalVars) GetLong(index uint) int64 {\n\tlow := uint32(self[index].num) //å–indexä½32ä½\n\thigh := uint32(self[index+1].num) //å–index+1é«˜32ä½\n\treturn int64(high)<<32 | int64(low) //å·¦ç§»é«˜ä½32ä½ï¼Œæ‹¼æ¥é«˜ä½ä½è¿”å›\n}\n\n//è®¾ç½®float64\nfunc (self LocalVars) SetDouble(index uint, val float64) {\n\tbits := math.Float64bits(val) //è½¬ä¸ºuint64\n\tself.SetLong(index, int64(bits)) //ç”¨longå‹è®¾ç½®æ–¹æ³•è®¾ç½®int64\n}\n//å–float64\nfunc (self LocalVars) GetDouble(index uint) float64 {\n\tbits := uint64(self.GetLong(index)) //æŒ‰longå‹å–å€¼æ–¹æ³•å–å‡ºuint64\n\treturn math.Float64frombits(bits) //è½¬ä¸ºfloat64\n}\n//è®¾ç½®å¼•ç”¨\nfunc (self LocalVars) SetRef(index uint, ref *Object) {\n\tself[index].ref = ref\n}\n//å–å¼•ç”¨\nfunc (self LocalVars) GetRef(index uint) *Object {\n\treturn self[index].ref\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\n\n{% codeblock lang:golang %}\ntype OperandStack struct {\n\tsize  uint //è®°å½•æ ˆé¡¶ä½ç½®\n\tslots []Slot\n}\n//å®ä¾‹åŒ–æ“ä½œæ•°æ ˆ\nfunc newOperandStack(maxStack uint) *OperandStack {\n\tif maxStack > 0 {\n\t\treturn &OperandStack{\n\t\t\tslots: make([]Slot, maxStack),//ç”³æ˜maxStackå¤§å°çš„Slotæ•°ç»„\n\t\t}\n\t}\n\treturn nil\n}\n\nfunc (self *OperandStack) PushInt(val int32) {\n\tself.slots[self.size].num = val\n\tself.size++\n}\nfunc (self *OperandStack) PopInt() int32 {\n\tself.size--\n\treturn self.slots[self.size].num\n}\n\nfunc (self *OperandStack) PushFloat(val float32) {\n\tbits := math.Float32bits(val)\n\tself.slots[self.size].num = int32(bits)\n\tself.size++\n}\nfunc (self *OperandStack) PopFloat() float32 {\n\tself.size--\n\tbits := uint32(self.slots[self.size].num)\n\treturn math.Float32frombits(bits)\n}\n\n// long consumes two slots\nfunc (self *OperandStack) PushLong(val int64) {\n\tself.slots[self.size].num = int32(val)\n\tself.slots[self.size+1].num = int32(val >> 32)\n\tself.size += 2\n}\nfunc (self *OperandStack) PopLong() int64 {\n\tself.size -= 2\n\tlow := uint32(self.slots[self.size].num)\n\thigh := uint32(self.slots[self.size+1].num)\n\treturn int64(high)<<32 | int64(low)\n}\n\n// double consumes two slots\nfunc (self *OperandStack) PushDouble(val float64) {\n\tbits := math.Float64bits(val)\n\tself.PushLong(int64(bits))\n}\nfunc (self *OperandStack) PopDouble() float64 {\n\tbits := uint64(self.PopLong())\n\treturn math.Float64frombits(bits)\n}\n\nfunc (self *OperandStack) PushRef(ref *Object) {\n\tself.slots[self.size].ref = ref\n\tself.size++\n}\nfunc (self *OperandStack) PopRef() *Object {\n\tself.size--\n\tref := self.slots[self.size].ref\n\tself.slots[self.size].ref = nil\n\treturn ref\n}\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\n\n{% codeblock lang:golang %}\n\n{% endcodeblock %}","source":"_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4.md","raw":"---\ntitle: è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°4\ndate: 2019-09-26 21:49:11\ntags: \n    - JVM\n    - Java\n    - Go\ncategories :\n    - Technology\n---\n\n### è¿è¡Œæ—¶æ•°æ®åŒº\nJVMå°†éœ€è¦ç”¨åˆ°çš„æ•°æ®å­˜æ”¾å…¥å†…å­˜ä¸­ï¼Œè¿™ä¸ªå†…å­˜åŒºå°±å«è¿è¡Œæ—¶æ•°æ®åŒº\nå¯åˆ†ä¸ºä¸¤ç§ï¼š\n1. ä¸€ç±»æ˜¯å¤šçº¿ç¨‹å…±äº«çš„ï¼Œè¯¥æ•°æ®åŒºéœ€è¦åœ¨Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºå¥½ï¼Œåœ¨Javaè™šæ‹Ÿæœºé€€å‡ºæ—¶é”€æ¯ã€‚\n2. ä¸€ç±»åˆ™æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œè¯¥æ•°æ®åŒºåˆ™åœ¨åˆ›å»ºçº¿ç¨‹æ—¶æ‰åˆ›å»ºï¼Œçº¿ç¨‹é€€å‡ºæ—¶é”€æ¯ã€‚\n\n<!-- more -->\n\n{% asset_img è¿è¡Œæ—¶æ•°æ®åŒº.png 800 800 è¿è¡Œæ—¶æ•°æ®åŒº %}\n\n### å®ç°\n#### å®šä¹‰å¯¹è±¡ç»“æ„\n\n{% codeblock lang:golang %}\ntype Object struct {\n\t// todo\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\n\n{% codeblock lang:golang %}\ntype Thread struct {\n\tpc    int // the address of the instruction currently being executed\n\tstack *Stack //Javaè™šæ‹Ÿæœºæ ˆæŒ‡é’ˆ\n\t// todo\n}\n\n//åˆ›å»ºThreadå®ä¾‹\n//javaå‘½ä»¤æä¾›äº†-Xssé€‰é¡¹æ¥è®¾ç½®Javaè™šæ‹Ÿæœºæ ˆå¤§å°\nfunc NewThread() *Thread {\n\treturn &Thread{\n\t\tstack: newStack(1024), //æœ€å¤šå®¹çº³1024å¸§\n\t}\n}\n\nfunc (self *Thread) PC() int {\n\treturn self.pc\n}\nfunc (self *Thread) SetPC(pc int) {\n\tself.pc = pc\n}\n\n//å½“å‰å¸§è¿›æ ˆ\nfunc (self *Thread) PushFrame(frame *Frame) {\n\tself.stack.push(frame)\n}\n//å½“å‰å¸§å‡ºæ ˆ\nfunc (self *Thread) PopFrame() *Frame {\n\treturn self.stack.pop()\n}\n//è·å–å½“å‰å¸§\nfunc (self *Thread) CurrentFrame() *Frame {\n\treturn self.stack.top()\n}\n\n\n\n\n{% endcodeblock %}\n\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\n\n{% codeblock lang:golang %}\ntype Stack struct {\n\tmaxSize uint //æœ€å¤šå¯ä»¥å®¹çº³å¤šå°‘å¸§\n\tsize    uint //æ ˆçš„å½“å‰å¤§å°\n\t_top    *Frame //ä¿å­˜æ ˆé¡¶æŒ‡é’ˆ\n}\n\n//å®ä¾‹ä¸€ä¸ªæ ˆ\nfunc newStack(maxSize uint) *Stack {\n\treturn &Stack{\n\t\tmaxSize: maxSize,\n\t}\n}\n\n//å½“å‰å¸§è¿›æ ˆ\nfunc (self *Stack) push(frame *Frame) {\n\tif self.size >= self.maxSize { //åˆ¤æ–­å½“å‰æ ˆå¤§å°æ˜¯å¦è¶…è¿‡æœ€å¤§å®¹é‡\n\t\tpanic(\"java.lang.StackOverflowError\") \n\t}\n\n\tif self._top != nil {  //å½“å‰æ ˆé¡¶ä¸ä¸ºç©ºæ—¶\n\t\tframe.lower = self._top //å°†æ’å…¥å¸§å°¾æŒ‡å‘æ ˆé¡¶æŒ‡é’ˆ\n\t}\n\n\tself._top = frame //å½“å‰æ ˆé¡¶æŒ‡å‘å½“å‰å¸§\n\tself.size++ //å½“å‰æ ˆå¤§å°åŠ 1\n}\n\n//å½“å‰å¸§å‡ºæ ˆ\nfunc (self *Stack) pop() *Frame {\n\tif self._top == nil { //å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™\n\t\tpanic(\"jvm stack is empty!\")\n\t}\n\n\ttop := self._top //å–å‡ºå½“å‰æ ˆé¡¶å¸§\n\tself._top = top.lower //å°†å½“å‰æ ˆé¡¶æŒ‡å‘topçš„ä¸‹ä¸€å¸§\n\ttop.lower = nil //æ–­å¼€topçš„å°¾æŒ‡é’ˆ\n\tself.size-- //å½“å‰æ ˆå¤§å°å‡1\n\n\treturn top //è¿”å›top\n}\n\n//è·å–å½“å‰æ ˆé¡¶å¸§\nfunc (self *Stack) top() *Frame {\n\tif self._top == nil { ////å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™\n\t\tpanic(\"jvm stack is empty!\")\n\t}\n\n\treturn self._top //è¿”å›å½“å‰æ ˆé¡¶å¸§\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\n\n{% codeblock lang:golang %}\ntype Frame struct {\n\tlower        *Frame //æŒ‡å‘ä¸‹ä¸€å¸§\n\tlocalVars    LocalVars //ä¿å­˜å±€éƒ¨å˜é‡è¡¨æŒ‡é’ˆ\n\toperandStack *OperandStack //ä¿å­˜æ“ä½œæ•°æ ˆæŒ‡é’ˆ\n\t// todo\n}\n\n//å®ä¾‹åŒ–å¸§\nfunc NewFrame(maxLocals, maxStack uint) *Frame {\n\treturn &Frame{\n\t\tlocalVars:    newLocalVars(maxLocals), //å®ä¾‹åŒ–å±€éƒ¨å˜é‡å¯¹è±¡\n\t\toperandStack: newOperandStack(maxStack), //å®ä¾‹åŒ–æ“ä½œæ•°æ ˆå¯¹è±¡\n\t}\n}\n\n// getters\nfunc (self *Frame) LocalVars() LocalVars {\n\treturn self.localVars\n}\nfunc (self *Frame) OperandStack() *OperandStack {\n\treturn self.operandStack\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\n\n{% codeblock lang:golang %}\ntype LocalVars []Slot\n\n//åˆ›å»ºå±€éƒ¨å˜é‡å®ä¾‹\nfunc newLocalVars(maxLocals uint) LocalVars {\n\tif maxLocals > 0 {\n\t\treturn make([]Slot, maxLocals) //ç”³æ˜å¤§å°ä¸ºmaxLocalsçš„Slotæ•°ç»„\n\t}\n\treturn nil\n}\n\n//è®¾ç½®intç±»å‹\nfunc (self LocalVars) SetInt(index uint, val int32) {\n\tself[index].num = val\n}\n//å–intç±»å‹\nfunc (self LocalVars) GetInt(index uint) int32 {\n\treturn self[index].num\n}\n//è®¾ç½®float32ç±»å‹\nfunc (self LocalVars) SetFloat(index uint, val float32) {\n\tbits := math.Float32bits(val)//è½¬ä¸ºuint32\n\tself[index].num = int32(bits) //è½¬ä¸ºint32\n}\n//å–float32ç±»å‹\nfunc (self LocalVars) GetFloat(index uint) float32 {\n\tbits := uint32(self[index].num)//è½¬ä¸ºunit32\n\treturn math.Float32frombits(bits)//è½¬ä¸ºfloat\n}\n\n//è®¾ç½®longç±»å‹\nfunc (self LocalVars) SetLong(index uint, val int64) {\n\tself[index].num = int32(val)//å–ä½ä½32ä½å­˜å‚¨åœ¨index\n\tself[index+1].num = int32(val >> 32) //å³ç§»32ä½å–é«˜ä½32ä½å­˜å‚¨åœ¨index+1\n}\n//å–longç±»å‹\nfunc (self LocalVars) GetLong(index uint) int64 {\n\tlow := uint32(self[index].num) //å–indexä½32ä½\n\thigh := uint32(self[index+1].num) //å–index+1é«˜32ä½\n\treturn int64(high)<<32 | int64(low) //å·¦ç§»é«˜ä½32ä½ï¼Œæ‹¼æ¥é«˜ä½ä½è¿”å›\n}\n\n//è®¾ç½®float64\nfunc (self LocalVars) SetDouble(index uint, val float64) {\n\tbits := math.Float64bits(val) //è½¬ä¸ºuint64\n\tself.SetLong(index, int64(bits)) //ç”¨longå‹è®¾ç½®æ–¹æ³•è®¾ç½®int64\n}\n//å–float64\nfunc (self LocalVars) GetDouble(index uint) float64 {\n\tbits := uint64(self.GetLong(index)) //æŒ‰longå‹å–å€¼æ–¹æ³•å–å‡ºuint64\n\treturn math.Float64frombits(bits) //è½¬ä¸ºfloat64\n}\n//è®¾ç½®å¼•ç”¨\nfunc (self LocalVars) SetRef(index uint, ref *Object) {\n\tself[index].ref = ref\n}\n//å–å¼•ç”¨\nfunc (self LocalVars) GetRef(index uint) *Object {\n\treturn self[index].ref\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\n\n{% codeblock lang:golang %}\ntype OperandStack struct {\n\tsize  uint //è®°å½•æ ˆé¡¶ä½ç½®\n\tslots []Slot\n}\n//å®ä¾‹åŒ–æ“ä½œæ•°æ ˆ\nfunc newOperandStack(maxStack uint) *OperandStack {\n\tif maxStack > 0 {\n\t\treturn &OperandStack{\n\t\t\tslots: make([]Slot, maxStack),//ç”³æ˜maxStackå¤§å°çš„Slotæ•°ç»„\n\t\t}\n\t}\n\treturn nil\n}\n\nfunc (self *OperandStack) PushInt(val int32) {\n\tself.slots[self.size].num = val\n\tself.size++\n}\nfunc (self *OperandStack) PopInt() int32 {\n\tself.size--\n\treturn self.slots[self.size].num\n}\n\nfunc (self *OperandStack) PushFloat(val float32) {\n\tbits := math.Float32bits(val)\n\tself.slots[self.size].num = int32(bits)\n\tself.size++\n}\nfunc (self *OperandStack) PopFloat() float32 {\n\tself.size--\n\tbits := uint32(self.slots[self.size].num)\n\treturn math.Float32frombits(bits)\n}\n\n// long consumes two slots\nfunc (self *OperandStack) PushLong(val int64) {\n\tself.slots[self.size].num = int32(val)\n\tself.slots[self.size+1].num = int32(val >> 32)\n\tself.size += 2\n}\nfunc (self *OperandStack) PopLong() int64 {\n\tself.size -= 2\n\tlow := uint32(self.slots[self.size].num)\n\thigh := uint32(self.slots[self.size+1].num)\n\treturn int64(high)<<32 | int64(low)\n}\n\n// double consumes two slots\nfunc (self *OperandStack) PushDouble(val float64) {\n\tbits := math.Float64bits(val)\n\tself.PushLong(int64(bits))\n}\nfunc (self *OperandStack) PopDouble() float64 {\n\tbits := uint64(self.PopLong())\n\treturn math.Float64frombits(bits)\n}\n\nfunc (self *OperandStack) PushRef(ref *Object) {\n\tself.slots[self.size].ref = ref\n\tself.size++\n}\nfunc (self *OperandStack) PopRef() *Object {\n\tself.size--\n\tref := self.slots[self.size].ref\n\tself.slots[self.size].ref = nil\n\treturn ref\n}\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\n\n{% codeblock lang:golang %}\n\n{% endcodeblock %}","slug":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4","published":1,"updated":"2019-09-26T14:31:06.218Z","_id":"ck10secrd0009jonyz4a345c0","comments":1,"layout":"post","photos":[],"link":"","content":"<h3 id=\"è¿è¡Œæ—¶æ•°æ®åŒº\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº\"></a>è¿è¡Œæ—¶æ•°æ®åŒº</h3><p>JVMå°†éœ€è¦ç”¨åˆ°çš„æ•°æ®å­˜æ”¾å…¥å†…å­˜ä¸­ï¼Œè¿™ä¸ªå†…å­˜åŒºå°±å«è¿è¡Œæ—¶æ•°æ®åŒº<br>å¯åˆ†ä¸ºä¸¤ç§ï¼š</p>\n<ol>\n<li>ä¸€ç±»æ˜¯å¤šçº¿ç¨‹å…±äº«çš„ï¼Œè¯¥æ•°æ®åŒºéœ€è¦åœ¨Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºå¥½ï¼Œåœ¨Javaè™šæ‹Ÿæœºé€€å‡ºæ—¶é”€æ¯ã€‚</li>\n<li>ä¸€ç±»åˆ™æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œè¯¥æ•°æ®åŒºåˆ™åœ¨åˆ›å»ºçº¿ç¨‹æ—¶æ‰åˆ›å»ºï¼Œçº¿ç¨‹é€€å‡ºæ—¶é”€æ¯ã€‚</li>\n</ol>\n<a id=\"more\"></a>\n\n<img src=\"/2019/09/26/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4/è¿è¡Œæ—¶æ•°æ®åŒº.png\" width=\"800\" height=\"800\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº\">\n\n<h3 id=\"å®ç°\"><a href=\"#å®ç°\" class=\"headerlink\" title=\"å®ç°\"></a>å®ç°</h3><h4 id=\"å®šä¹‰å¯¹è±¡ç»“æ„\"><a href=\"#å®šä¹‰å¯¹è±¡ç»“æ„\" class=\"headerlink\" title=\"å®šä¹‰å¯¹è±¡ç»“æ„\"></a>å®šä¹‰å¯¹è±¡ç»“æ„</h4><figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> Object <span class=\"hljs-keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-comment\">// todo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹</h4><figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> Thread <span class=\"hljs-keyword\">struct</span> &#123;</span><br><span class=\"line\">\tpc    <span class=\"hljs-keyword\">int</span> <span class=\"hljs-comment\">// the address of the instruction currently being executed</span></span><br><span class=\"line\">\tstack *Stack <span class=\"hljs-comment\">//Javaè™šæ‹Ÿæœºæ ˆæŒ‡é’ˆ</span></span><br><span class=\"line\">\t<span class=\"hljs-comment\">// todo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//åˆ›å»ºThreadå®ä¾‹</span></span><br><span class=\"line\"><span class=\"hljs-comment\">//javaå‘½ä»¤æä¾›äº†-Xssé€‰é¡¹æ¥è®¾ç½®Javaè™šæ‹Ÿæœºæ ˆå¤§å°</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">NewThread</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Thread</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> &amp;Thread&#123;</span><br><span class=\"line\">\t\tstack: newStack(<span class=\"hljs-number\">1024</span>), <span class=\"hljs-comment\">//æœ€å¤šå®¹çº³1024å¸§</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Thread)</span> <span class=\"hljs-title\">PC</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">int</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.pc</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Thread)</span> <span class=\"hljs-title\">SetPC</span><span class=\"hljs-params\">(pc <span class=\"hljs-keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\tself.pc = pc</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//å½“å‰å¸§è¿›æ ˆ</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Thread)</span> <span class=\"hljs-title\">PushFrame</span><span class=\"hljs-params\">(frame *Frame)</span></span> &#123;</span><br><span class=\"line\">\tself.stack.push(frame)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å½“å‰å¸§å‡ºæ ˆ</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Thread)</span> <span class=\"hljs-title\">PopFrame</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.stack.pop()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//è·å–å½“å‰å¸§</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Thread)</span> <span class=\"hljs-title\">CurrentFrame</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.stack.top()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ</h4><figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> Stack <span class=\"hljs-keyword\">struct</span> &#123;</span><br><span class=\"line\">\tmaxSize <span class=\"hljs-keyword\">uint</span> <span class=\"hljs-comment\">//æœ€å¤šå¯ä»¥å®¹çº³å¤šå°‘å¸§</span></span><br><span class=\"line\">\tsize    <span class=\"hljs-keyword\">uint</span> <span class=\"hljs-comment\">//æ ˆçš„å½“å‰å¤§å°</span></span><br><span class=\"line\">\t_top    *Frame <span class=\"hljs-comment\">//ä¿å­˜æ ˆé¡¶æŒ‡é’ˆ</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//å®ä¾‹ä¸€ä¸ªæ ˆ</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newStack</span><span class=\"hljs-params\">(maxSize <span class=\"hljs-keyword\">uint</span>)</span> *<span class=\"hljs-title\">Stack</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> &amp;Stack&#123;</span><br><span class=\"line\">\t\tmaxSize: maxSize,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//å½“å‰å¸§è¿›æ ˆ</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Stack)</span> <span class=\"hljs-title\">push</span><span class=\"hljs-params\">(frame *Frame)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> self.size &gt;= self.maxSize &#123; <span class=\"hljs-comment\">//åˆ¤æ–­å½“å‰æ ˆå¤§å°æ˜¯å¦è¶…è¿‡æœ€å¤§å®¹é‡</span></span><br><span class=\"line\">\t\t<span class=\"hljs-built_in\">panic</span>(<span class=\"hljs-string\">\"java.lang.StackOverflowError\"</span>) </span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> self._top != <span class=\"hljs-literal\">nil</span> &#123;  <span class=\"hljs-comment\">//å½“å‰æ ˆé¡¶ä¸ä¸ºç©ºæ—¶</span></span><br><span class=\"line\">\t\tframe.lower = self._top <span class=\"hljs-comment\">//å°†æ’å…¥å¸§å°¾æŒ‡å‘æ ˆé¡¶æŒ‡é’ˆ</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tself._top = frame <span class=\"hljs-comment\">//å½“å‰æ ˆé¡¶æŒ‡å‘å½“å‰å¸§</span></span><br><span class=\"line\">\tself.size++ <span class=\"hljs-comment\">//å½“å‰æ ˆå¤§å°åŠ 1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//å½“å‰å¸§å‡ºæ ˆ</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Stack)</span> <span class=\"hljs-title\">pop</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> self._top == <span class=\"hljs-literal\">nil</span> &#123; <span class=\"hljs-comment\">//å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™</span></span><br><span class=\"line\">\t\t<span class=\"hljs-built_in\">panic</span>(<span class=\"hljs-string\">\"jvm stack is empty!\"</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\ttop := self._top <span class=\"hljs-comment\">//å–å‡ºå½“å‰æ ˆé¡¶å¸§</span></span><br><span class=\"line\">\tself._top = top.lower <span class=\"hljs-comment\">//å°†å½“å‰æ ˆé¡¶æŒ‡å‘topçš„ä¸‹ä¸€å¸§</span></span><br><span class=\"line\">\ttop.lower = <span class=\"hljs-literal\">nil</span> <span class=\"hljs-comment\">//æ–­å¼€topçš„å°¾æŒ‡é’ˆ</span></span><br><span class=\"line\">\tself.size-- <span class=\"hljs-comment\">//å½“å‰æ ˆå¤§å°å‡1</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> top <span class=\"hljs-comment\">//è¿”å›top</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//è·å–å½“å‰æ ˆé¡¶å¸§</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Stack)</span> <span class=\"hljs-title\">top</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> self._top == <span class=\"hljs-literal\">nil</span> &#123; <span class=\"hljs-comment\">////å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™</span></span><br><span class=\"line\">\t\t<span class=\"hljs-built_in\">panic</span>(<span class=\"hljs-string\">\"jvm stack is empty!\"</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self._top <span class=\"hljs-comment\">//è¿”å›å½“å‰æ ˆé¡¶å¸§</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-å¸§</h4><figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> Frame <span class=\"hljs-keyword\">struct</span> &#123;</span><br><span class=\"line\">\tlower        *Frame <span class=\"hljs-comment\">//æŒ‡å‘ä¸‹ä¸€å¸§</span></span><br><span class=\"line\">\tlocalVars    LocalVars <span class=\"hljs-comment\">//ä¿å­˜å±€éƒ¨å˜é‡è¡¨æŒ‡é’ˆ</span></span><br><span class=\"line\">\toperandStack *OperandStack <span class=\"hljs-comment\">//ä¿å­˜æ“ä½œæ•°æ ˆæŒ‡é’ˆ</span></span><br><span class=\"line\">\t<span class=\"hljs-comment\">// todo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//å®ä¾‹åŒ–å¸§</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">NewFrame</span><span class=\"hljs-params\">(maxLocals, maxStack <span class=\"hljs-keyword\">uint</span>)</span> *<span class=\"hljs-title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> &amp;Frame&#123;</span><br><span class=\"line\">\t\tlocalVars:    newLocalVars(maxLocals), <span class=\"hljs-comment\">//å®ä¾‹åŒ–å±€éƒ¨å˜é‡å¯¹è±¡</span></span><br><span class=\"line\">\t\toperandStack: newOperandStack(maxStack), <span class=\"hljs-comment\">//å®ä¾‹åŒ–æ“ä½œæ•°æ ˆå¯¹è±¡</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// getters</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Frame)</span> <span class=\"hljs-title\">LocalVars</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">LocalVars</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.localVars</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Frame)</span> <span class=\"hljs-title\">OperandStack</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">OperandStack</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.operandStack</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨</h4><figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> LocalVars []Slot</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//åˆ›å»ºå±€éƒ¨å˜é‡å®ä¾‹</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newLocalVars</span><span class=\"hljs-params\">(maxLocals <span class=\"hljs-keyword\">uint</span>)</span> <span class=\"hljs-title\">LocalVars</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> maxLocals &gt; <span class=\"hljs-number\">0</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">make</span>([]Slot, maxLocals) <span class=\"hljs-comment\">//ç”³æ˜å¤§å°ä¸ºmaxLocalsçš„Slotæ•°ç»„</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//è®¾ç½®intç±»å‹</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">SetInt</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>, val <span class=\"hljs-keyword\">int32</span>)</span></span> &#123;</span><br><span class=\"line\">\tself[index].num = val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å–intç±»å‹</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">GetInt</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>)</span> <span class=\"hljs-title\">int32</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self[index].num</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//è®¾ç½®float32ç±»å‹</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">SetFloat</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>, val <span class=\"hljs-keyword\">float32</span>)</span></span> &#123;</span><br><span class=\"line\">\tbits := math.Float32bits(val)<span class=\"hljs-comment\">//è½¬ä¸ºuint32</span></span><br><span class=\"line\">\tself[index].num = <span class=\"hljs-keyword\">int32</span>(bits) <span class=\"hljs-comment\">//è½¬ä¸ºint32</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å–float32ç±»å‹</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">GetFloat</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>)</span> <span class=\"hljs-title\">float32</span></span> &#123;</span><br><span class=\"line\">\tbits := <span class=\"hljs-keyword\">uint32</span>(self[index].num)<span class=\"hljs-comment\">//è½¬ä¸ºunit32</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> math.Float32frombits(bits)<span class=\"hljs-comment\">//è½¬ä¸ºfloat</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//è®¾ç½®longç±»å‹</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">SetLong</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>, val <span class=\"hljs-keyword\">int64</span>)</span></span> &#123;</span><br><span class=\"line\">\tself[index].num = <span class=\"hljs-keyword\">int32</span>(val)<span class=\"hljs-comment\">//å–ä½ä½32ä½å­˜å‚¨åœ¨index</span></span><br><span class=\"line\">\tself[index+<span class=\"hljs-number\">1</span>].num = <span class=\"hljs-keyword\">int32</span>(val &gt;&gt; <span class=\"hljs-number\">32</span>) <span class=\"hljs-comment\">//å³ç§»32ä½å–é«˜ä½32ä½å­˜å‚¨åœ¨index+1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å–longç±»å‹</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">GetLong</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>)</span> <span class=\"hljs-title\">int64</span></span> &#123;</span><br><span class=\"line\">\tlow := <span class=\"hljs-keyword\">uint32</span>(self[index].num) <span class=\"hljs-comment\">//å–indexä½32ä½</span></span><br><span class=\"line\">\thigh := <span class=\"hljs-keyword\">uint32</span>(self[index+<span class=\"hljs-number\">1</span>].num) <span class=\"hljs-comment\">//å–index+1é«˜32ä½</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">int64</span>(high)&lt;&lt;<span class=\"hljs-number\">32</span> | <span class=\"hljs-keyword\">int64</span>(low) <span class=\"hljs-comment\">//å·¦ç§»é«˜ä½32ä½ï¼Œæ‹¼æ¥é«˜ä½ä½è¿”å›</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//è®¾ç½®float64</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">SetDouble</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>, val <span class=\"hljs-keyword\">float64</span>)</span></span> &#123;</span><br><span class=\"line\">\tbits := math.Float64bits(val) <span class=\"hljs-comment\">//è½¬ä¸ºuint64</span></span><br><span class=\"line\">\tself.SetLong(index, <span class=\"hljs-keyword\">int64</span>(bits)) <span class=\"hljs-comment\">//ç”¨longå‹è®¾ç½®æ–¹æ³•è®¾ç½®int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å–float64</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">GetDouble</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>)</span> <span class=\"hljs-title\">float64</span></span> &#123;</span><br><span class=\"line\">\tbits := <span class=\"hljs-keyword\">uint64</span>(self.GetLong(index)) <span class=\"hljs-comment\">//æŒ‰longå‹å–å€¼æ–¹æ³•å–å‡ºuint64</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> math.Float64frombits(bits) <span class=\"hljs-comment\">//è½¬ä¸ºfloat64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//è®¾ç½®å¼•ç”¨</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">SetRef</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>, ref *Object)</span></span> &#123;</span><br><span class=\"line\">\tself[index].ref = ref</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å–å¼•ç”¨</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">GetRef</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>)</span> *<span class=\"hljs-title\">Object</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self[index].ref</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ</h4><figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> OperandStack <span class=\"hljs-keyword\">struct</span> &#123;</span><br><span class=\"line\">\tsize  <span class=\"hljs-keyword\">uint</span> <span class=\"hljs-comment\">//è®°å½•æ ˆé¡¶ä½ç½®</span></span><br><span class=\"line\">\tslots []Slot</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-comment\">//å®ä¾‹åŒ–æ“ä½œæ•°æ ˆ</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newOperandStack</span><span class=\"hljs-params\">(maxStack <span class=\"hljs-keyword\">uint</span>)</span> *<span class=\"hljs-title\">OperandStack</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> maxStack &gt; <span class=\"hljs-number\">0</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">return</span> &amp;OperandStack&#123;</span><br><span class=\"line\">\t\t\tslots: <span class=\"hljs-built_in\">make</span>([]Slot, maxStack),<span class=\"hljs-comment\">//ç”³æ˜maxStackå¤§å°çš„Slotæ•°ç»„</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PushInt</span><span class=\"hljs-params\">(val <span class=\"hljs-keyword\">int32</span>)</span></span> &#123;</span><br><span class=\"line\">\tself.slots[self.size].num = val</span><br><span class=\"line\">\tself.size++</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PopInt</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">int32</span></span> &#123;</span><br><span class=\"line\">\tself.size--</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.slots[self.size].num</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PushFloat</span><span class=\"hljs-params\">(val <span class=\"hljs-keyword\">float32</span>)</span></span> &#123;</span><br><span class=\"line\">\tbits := math.Float32bits(val)</span><br><span class=\"line\">\tself.slots[self.size].num = <span class=\"hljs-keyword\">int32</span>(bits)</span><br><span class=\"line\">\tself.size++</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PopFloat</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">float32</span></span> &#123;</span><br><span class=\"line\">\tself.size--</span><br><span class=\"line\">\tbits := <span class=\"hljs-keyword\">uint32</span>(self.slots[self.size].num)</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> math.Float32frombits(bits)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// long consumes two slots</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PushLong</span><span class=\"hljs-params\">(val <span class=\"hljs-keyword\">int64</span>)</span></span> &#123;</span><br><span class=\"line\">\tself.slots[self.size].num = <span class=\"hljs-keyword\">int32</span>(val)</span><br><span class=\"line\">\tself.slots[self.size+<span class=\"hljs-number\">1</span>].num = <span class=\"hljs-keyword\">int32</span>(val &gt;&gt; <span class=\"hljs-number\">32</span>)</span><br><span class=\"line\">\tself.size += <span class=\"hljs-number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PopLong</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">int64</span></span> &#123;</span><br><span class=\"line\">\tself.size -= <span class=\"hljs-number\">2</span></span><br><span class=\"line\">\tlow := <span class=\"hljs-keyword\">uint32</span>(self.slots[self.size].num)</span><br><span class=\"line\">\thigh := <span class=\"hljs-keyword\">uint32</span>(self.slots[self.size+<span class=\"hljs-number\">1</span>].num)</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">int64</span>(high)&lt;&lt;<span class=\"hljs-number\">32</span> | <span class=\"hljs-keyword\">int64</span>(low)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// double consumes two slots</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PushDouble</span><span class=\"hljs-params\">(val <span class=\"hljs-keyword\">float64</span>)</span></span> &#123;</span><br><span class=\"line\">\tbits := math.Float64bits(val)</span><br><span class=\"line\">\tself.PushLong(<span class=\"hljs-keyword\">int64</span>(bits))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PopDouble</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">float64</span></span> &#123;</span><br><span class=\"line\">\tbits := <span class=\"hljs-keyword\">uint64</span>(self.PopLong())</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> math.Float64frombits(bits)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PushRef</span><span class=\"hljs-params\">(ref *Object)</span></span> &#123;</span><br><span class=\"line\">\tself.slots[self.size].ref = ref</span><br><span class=\"line\">\tself.size++</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PopRef</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Object</span></span> &#123;</span><br><span class=\"line\">\tself.size--</span><br><span class=\"line\">\tref := self.slots[self.size].ref</span><br><span class=\"line\">\tself.slots[self.size].ref = <span class=\"hljs-literal\">nil</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> ref</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ-1\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ-1\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ</h4><figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"JVM","path":"tags/JVM/"},{"name":"Java","path":"tags/Java/"},{"name":"Go","path":"tags/Go/"}],"excerpt":"<h3 id=\"è¿è¡Œæ—¶æ•°æ®åŒº\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº\"></a>è¿è¡Œæ—¶æ•°æ®åŒº</h3><p>JVMå°†éœ€è¦ç”¨åˆ°çš„æ•°æ®å­˜æ”¾å…¥å†…å­˜ä¸­ï¼Œè¿™ä¸ªå†…å­˜åŒºå°±å«è¿è¡Œæ—¶æ•°æ®åŒº<br>å¯åˆ†ä¸ºä¸¤ç§ï¼š</p>\n<ol>\n<li>ä¸€ç±»æ˜¯å¤šçº¿ç¨‹å…±äº«çš„ï¼Œè¯¥æ•°æ®åŒºéœ€è¦åœ¨Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºå¥½ï¼Œåœ¨Javaè™šæ‹Ÿæœºé€€å‡ºæ—¶é”€æ¯ã€‚</li>\n<li>ä¸€ç±»åˆ™æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œè¯¥æ•°æ®åŒºåˆ™åœ¨åˆ›å»ºçº¿ç¨‹æ—¶æ‰åˆ›å»ºï¼Œçº¿ç¨‹é€€å‡ºæ—¶é”€æ¯ã€‚</li>\n</ol>","more":"<img src=\"/2019/09/26/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4/è¿è¡Œæ—¶æ•°æ®åŒº.png\" width=\"800\" height=\"800\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº\">\n\n<h3 id=\"å®ç°\"><a href=\"#å®ç°\" class=\"headerlink\" title=\"å®ç°\"></a>å®ç°</h3><h4 id=\"å®šä¹‰å¯¹è±¡ç»“æ„\"><a href=\"#å®šä¹‰å¯¹è±¡ç»“æ„\" class=\"headerlink\" title=\"å®šä¹‰å¯¹è±¡ç»“æ„\"></a>å®šä¹‰å¯¹è±¡ç»“æ„</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Object <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// todo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Thread <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tpc    <span class=\"keyword\">int</span> <span class=\"comment\">// the address of the instruction currently being executed</span></span><br><span class=\"line\">\tstack *Stack <span class=\"comment\">//Javaè™šæ‹Ÿæœºæ ˆæŒ‡é’ˆ</span></span><br><span class=\"line\">\t<span class=\"comment\">// todo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//åˆ›å»ºThreadå®ä¾‹</span></span><br><span class=\"line\"><span class=\"comment\">//javaå‘½ä»¤æä¾›äº†-Xssé€‰é¡¹æ¥è®¾ç½®Javaè™šæ‹Ÿæœºæ ˆå¤§å°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewThread</span><span class=\"params\">()</span> *<span class=\"title\">Thread</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;Thread&#123;</span><br><span class=\"line\">\t\tstack: newStack(<span class=\"number\">1024</span>), <span class=\"comment\">//æœ€å¤šå®¹çº³1024å¸§</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Thread)</span> <span class=\"title\">PC</span><span class=\"params\">()</span> <span class=\"title\">int</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.pc</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Thread)</span> <span class=\"title\">SetPC</span><span class=\"params\">(pc <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\tself.pc = pc</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å½“å‰å¸§è¿›æ ˆ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Thread)</span> <span class=\"title\">PushFrame</span><span class=\"params\">(frame *Frame)</span></span> &#123;</span><br><span class=\"line\">\tself.stack.push(frame)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å½“å‰å¸§å‡ºæ ˆ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Thread)</span> <span class=\"title\">PopFrame</span><span class=\"params\">()</span> *<span class=\"title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.stack.pop()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//è·å–å½“å‰å¸§</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Thread)</span> <span class=\"title\">CurrentFrame</span><span class=\"params\">()</span> *<span class=\"title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.stack.top()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Stack <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tmaxSize <span class=\"keyword\">uint</span> <span class=\"comment\">//æœ€å¤šå¯ä»¥å®¹çº³å¤šå°‘å¸§</span></span><br><span class=\"line\">\tsize    <span class=\"keyword\">uint</span> <span class=\"comment\">//æ ˆçš„å½“å‰å¤§å°</span></span><br><span class=\"line\">\t_top    *Frame <span class=\"comment\">//ä¿å­˜æ ˆé¡¶æŒ‡é’ˆ</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å®ä¾‹ä¸€ä¸ªæ ˆ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newStack</span><span class=\"params\">(maxSize <span class=\"keyword\">uint</span>)</span> *<span class=\"title\">Stack</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;Stack&#123;</span><br><span class=\"line\">\t\tmaxSize: maxSize,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å½“å‰å¸§è¿›æ ˆ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Stack)</span> <span class=\"title\">push</span><span class=\"params\">(frame *Frame)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> self.size &gt;= self.maxSize &#123; <span class=\"comment\">//åˆ¤æ–­å½“å‰æ ˆå¤§å°æ˜¯å¦è¶…è¿‡æœ€å¤§å®¹é‡</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(<span class=\"string\">\"java.lang.StackOverflowError\"</span>) </span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> self._top != <span class=\"literal\">nil</span> &#123;  <span class=\"comment\">//å½“å‰æ ˆé¡¶ä¸ä¸ºç©ºæ—¶</span></span><br><span class=\"line\">\t\tframe.lower = self._top <span class=\"comment\">//å°†æ’å…¥å¸§å°¾æŒ‡å‘æ ˆé¡¶æŒ‡é’ˆ</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tself._top = frame <span class=\"comment\">//å½“å‰æ ˆé¡¶æŒ‡å‘å½“å‰å¸§</span></span><br><span class=\"line\">\tself.size++ <span class=\"comment\">//å½“å‰æ ˆå¤§å°åŠ 1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å½“å‰å¸§å‡ºæ ˆ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Stack)</span> <span class=\"title\">pop</span><span class=\"params\">()</span> *<span class=\"title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> self._top == <span class=\"literal\">nil</span> &#123; <span class=\"comment\">//å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(<span class=\"string\">\"jvm stack is empty!\"</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\ttop := self._top <span class=\"comment\">//å–å‡ºå½“å‰æ ˆé¡¶å¸§</span></span><br><span class=\"line\">\tself._top = top.lower <span class=\"comment\">//å°†å½“å‰æ ˆé¡¶æŒ‡å‘topçš„ä¸‹ä¸€å¸§</span></span><br><span class=\"line\">\ttop.lower = <span class=\"literal\">nil</span> <span class=\"comment\">//æ–­å¼€topçš„å°¾æŒ‡é’ˆ</span></span><br><span class=\"line\">\tself.size-- <span class=\"comment\">//å½“å‰æ ˆå¤§å°å‡1</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> top <span class=\"comment\">//è¿”å›top</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//è·å–å½“å‰æ ˆé¡¶å¸§</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Stack)</span> <span class=\"title\">top</span><span class=\"params\">()</span> *<span class=\"title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> self._top == <span class=\"literal\">nil</span> &#123; <span class=\"comment\">////å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(<span class=\"string\">\"jvm stack is empty!\"</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self._top <span class=\"comment\">//è¿”å›å½“å‰æ ˆé¡¶å¸§</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-å¸§</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Frame <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tlower        *Frame <span class=\"comment\">//æŒ‡å‘ä¸‹ä¸€å¸§</span></span><br><span class=\"line\">\tlocalVars    LocalVars <span class=\"comment\">//ä¿å­˜å±€éƒ¨å˜é‡è¡¨æŒ‡é’ˆ</span></span><br><span class=\"line\">\toperandStack *OperandStack <span class=\"comment\">//ä¿å­˜æ“ä½œæ•°æ ˆæŒ‡é’ˆ</span></span><br><span class=\"line\">\t<span class=\"comment\">// todo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å®ä¾‹åŒ–å¸§</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewFrame</span><span class=\"params\">(maxLocals, maxStack <span class=\"keyword\">uint</span>)</span> *<span class=\"title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;Frame&#123;</span><br><span class=\"line\">\t\tlocalVars:    newLocalVars(maxLocals), <span class=\"comment\">//å®ä¾‹åŒ–å±€éƒ¨å˜é‡å¯¹è±¡</span></span><br><span class=\"line\">\t\toperandStack: newOperandStack(maxStack), <span class=\"comment\">//å®ä¾‹åŒ–æ“ä½œæ•°æ ˆå¯¹è±¡</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// getters</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Frame)</span> <span class=\"title\">LocalVars</span><span class=\"params\">()</span> <span class=\"title\">LocalVars</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.localVars</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Frame)</span> <span class=\"title\">OperandStack</span><span class=\"params\">()</span> *<span class=\"title\">OperandStack</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.operandStack</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> LocalVars []Slot</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//åˆ›å»ºå±€éƒ¨å˜é‡å®ä¾‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newLocalVars</span><span class=\"params\">(maxLocals <span class=\"keyword\">uint</span>)</span> <span class=\"title\">LocalVars</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> maxLocals &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">make</span>([]Slot, maxLocals) <span class=\"comment\">//ç”³æ˜å¤§å°ä¸ºmaxLocalsçš„Slotæ•°ç»„</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®intç±»å‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">SetInt</span><span class=\"params\">(index <span class=\"keyword\">uint</span>, val <span class=\"keyword\">int32</span>)</span></span> &#123;</span><br><span class=\"line\">\tself[index].num = val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å–intç±»å‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">GetInt</span><span class=\"params\">(index <span class=\"keyword\">uint</span>)</span> <span class=\"title\">int32</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self[index].num</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®float32ç±»å‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">SetFloat</span><span class=\"params\">(index <span class=\"keyword\">uint</span>, val <span class=\"keyword\">float32</span>)</span></span> &#123;</span><br><span class=\"line\">\tbits := math.Float32bits(val)<span class=\"comment\">//è½¬ä¸ºuint32</span></span><br><span class=\"line\">\tself[index].num = <span class=\"keyword\">int32</span>(bits) <span class=\"comment\">//è½¬ä¸ºint32</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å–float32ç±»å‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">GetFloat</span><span class=\"params\">(index <span class=\"keyword\">uint</span>)</span> <span class=\"title\">float32</span></span> &#123;</span><br><span class=\"line\">\tbits := <span class=\"keyword\">uint32</span>(self[index].num)<span class=\"comment\">//è½¬ä¸ºunit32</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> math.Float32frombits(bits)<span class=\"comment\">//è½¬ä¸ºfloat</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®longç±»å‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">SetLong</span><span class=\"params\">(index <span class=\"keyword\">uint</span>, val <span class=\"keyword\">int64</span>)</span></span> &#123;</span><br><span class=\"line\">\tself[index].num = <span class=\"keyword\">int32</span>(val)<span class=\"comment\">//å–ä½ä½32ä½å­˜å‚¨åœ¨index</span></span><br><span class=\"line\">\tself[index+<span class=\"number\">1</span>].num = <span class=\"keyword\">int32</span>(val &gt;&gt; <span class=\"number\">32</span>) <span class=\"comment\">//å³ç§»32ä½å–é«˜ä½32ä½å­˜å‚¨åœ¨index+1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å–longç±»å‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">GetLong</span><span class=\"params\">(index <span class=\"keyword\">uint</span>)</span> <span class=\"title\">int64</span></span> &#123;</span><br><span class=\"line\">\tlow := <span class=\"keyword\">uint32</span>(self[index].num) <span class=\"comment\">//å–indexä½32ä½</span></span><br><span class=\"line\">\thigh := <span class=\"keyword\">uint32</span>(self[index+<span class=\"number\">1</span>].num) <span class=\"comment\">//å–index+1é«˜32ä½</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">int64</span>(high)&lt;&lt;<span class=\"number\">32</span> | <span class=\"keyword\">int64</span>(low) <span class=\"comment\">//å·¦ç§»é«˜ä½32ä½ï¼Œæ‹¼æ¥é«˜ä½ä½è¿”å›</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®float64</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">SetDouble</span><span class=\"params\">(index <span class=\"keyword\">uint</span>, val <span class=\"keyword\">float64</span>)</span></span> &#123;</span><br><span class=\"line\">\tbits := math.Float64bits(val) <span class=\"comment\">//è½¬ä¸ºuint64</span></span><br><span class=\"line\">\tself.SetLong(index, <span class=\"keyword\">int64</span>(bits)) <span class=\"comment\">//ç”¨longå‹è®¾ç½®æ–¹æ³•è®¾ç½®int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å–float64</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">GetDouble</span><span class=\"params\">(index <span class=\"keyword\">uint</span>)</span> <span class=\"title\">float64</span></span> &#123;</span><br><span class=\"line\">\tbits := <span class=\"keyword\">uint64</span>(self.GetLong(index)) <span class=\"comment\">//æŒ‰longå‹å–å€¼æ–¹æ³•å–å‡ºuint64</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> math.Float64frombits(bits) <span class=\"comment\">//è½¬ä¸ºfloat64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®å¼•ç”¨</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">SetRef</span><span class=\"params\">(index <span class=\"keyword\">uint</span>, ref *Object)</span></span> &#123;</span><br><span class=\"line\">\tself[index].ref = ref</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å–å¼•ç”¨</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">GetRef</span><span class=\"params\">(index <span class=\"keyword\">uint</span>)</span> *<span class=\"title\">Object</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self[index].ref</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> OperandStack <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tsize  <span class=\"keyword\">uint</span> <span class=\"comment\">//è®°å½•æ ˆé¡¶ä½ç½®</span></span><br><span class=\"line\">\tslots []Slot</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å®ä¾‹åŒ–æ“ä½œæ•°æ ˆ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newOperandStack</span><span class=\"params\">(maxStack <span class=\"keyword\">uint</span>)</span> *<span class=\"title\">OperandStack</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> maxStack &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> &amp;OperandStack&#123;</span><br><span class=\"line\">\t\t\tslots: <span class=\"built_in\">make</span>([]Slot, maxStack),<span class=\"comment\">//ç”³æ˜maxStackå¤§å°çš„Slotæ•°ç»„</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PushInt</span><span class=\"params\">(val <span class=\"keyword\">int32</span>)</span></span> &#123;</span><br><span class=\"line\">\tself.slots[self.size].num = val</span><br><span class=\"line\">\tself.size++</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PopInt</span><span class=\"params\">()</span> <span class=\"title\">int32</span></span> &#123;</span><br><span class=\"line\">\tself.size--</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.slots[self.size].num</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PushFloat</span><span class=\"params\">(val <span class=\"keyword\">float32</span>)</span></span> &#123;</span><br><span class=\"line\">\tbits := math.Float32bits(val)</span><br><span class=\"line\">\tself.slots[self.size].num = <span class=\"keyword\">int32</span>(bits)</span><br><span class=\"line\">\tself.size++</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PopFloat</span><span class=\"params\">()</span> <span class=\"title\">float32</span></span> &#123;</span><br><span class=\"line\">\tself.size--</span><br><span class=\"line\">\tbits := <span class=\"keyword\">uint32</span>(self.slots[self.size].num)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> math.Float32frombits(bits)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// long consumes two slots</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PushLong</span><span class=\"params\">(val <span class=\"keyword\">int64</span>)</span></span> &#123;</span><br><span class=\"line\">\tself.slots[self.size].num = <span class=\"keyword\">int32</span>(val)</span><br><span class=\"line\">\tself.slots[self.size+<span class=\"number\">1</span>].num = <span class=\"keyword\">int32</span>(val &gt;&gt; <span class=\"number\">32</span>)</span><br><span class=\"line\">\tself.size += <span class=\"number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PopLong</span><span class=\"params\">()</span> <span class=\"title\">int64</span></span> &#123;</span><br><span class=\"line\">\tself.size -= <span class=\"number\">2</span></span><br><span class=\"line\">\tlow := <span class=\"keyword\">uint32</span>(self.slots[self.size].num)</span><br><span class=\"line\">\thigh := <span class=\"keyword\">uint32</span>(self.slots[self.size+<span class=\"number\">1</span>].num)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">int64</span>(high)&lt;&lt;<span class=\"number\">32</span> | <span class=\"keyword\">int64</span>(low)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// double consumes two slots</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PushDouble</span><span class=\"params\">(val <span class=\"keyword\">float64</span>)</span></span> &#123;</span><br><span class=\"line\">\tbits := math.Float64bits(val)</span><br><span class=\"line\">\tself.PushLong(<span class=\"keyword\">int64</span>(bits))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PopDouble</span><span class=\"params\">()</span> <span class=\"title\">float64</span></span> &#123;</span><br><span class=\"line\">\tbits := <span class=\"keyword\">uint64</span>(self.PopLong())</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> math.Float64frombits(bits)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PushRef</span><span class=\"params\">(ref *Object)</span></span> &#123;</span><br><span class=\"line\">\tself.slots[self.size].ref = ref</span><br><span class=\"line\">\tself.size++</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PopRef</span><span class=\"params\">()</span> *<span class=\"title\">Object</span></span> &#123;</span><br><span class=\"line\">\tself.size--</span><br><span class=\"line\">\tref := self.slots[self.size].ref</span><br><span class=\"line\">\tself.slots[self.size].ref = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ref</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ-1\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ-1\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"å¤šçº§ç¼“å­˜","date":"2019-09-04T07:35:11.000Z","_content":"### èµ·å› \né¡¹ç›®å¹³ç¨³çš„å·²ç»è¿è¡Œå¿«ä¸€å¹´äº†ï¼ŒæŸå¤©æ—©ä¸Šç›‘æ§çªç„¶å‘Šè­¦å¤§é‡æ ¸å¿ƒæœåŠ¡ä¸å¯èƒ½ï¼Œè™½ç„¶è¿ç»´ç´§æ€¥å¤„ç†å¹¶é‡å¯äº†æœåŠ¡ã€‚ä½†è¿™ç§éæ­£å¸¸çš„æœåŠ¡å®•æœºç€å®è®©äººæäº†æŠŠå†·æ±—ï¼ˆè¿˜å¥½åˆ›ä¸šå…¬å¸è¿˜æ²¡æœ‰ç”Ÿäº§äº‹æ•…æƒ©ç½šæœºåˆ¶ï¼‰ã€‚\n\néšåæˆ‘ä»¬Dumpä¸‹äº†æœåŠ¡èµ·çš„æ—¥å¿—ï¼Œå‘ç°äº‹æ•…æœŸé—´JVMå­˜åœ¨å¤§é‡çš„Full GCï¼Œé…åˆCATçš„ç›‘æ§æŒ‡æ ‡å‘ç°æŸå‡ ä¸ªæ¥å£çš„è°ƒç”¨é‡å‰§å¢ã€‚ã€‚ã€‚ã€‚å¤§æ¦‚æˆ‘ä»¬æ˜¯è¢«åˆ·æ¥å£äº†ã€‚\n\næŸ¥çœ‹å…·ä½“æ¥å£ï¼Œå‘ç°å‰ç«¯åå¤æŸ¥è¯¢é…ç½®ä¿¡æ¯è€Œä¸”æ²¡æœ‰åšç¼“å­˜ï¼Œå¤§é‡çš„å¤§å¯¹è±¡å †ç§¯ä¸é¢‘ç¹Full GCæ‰æ€ªã€‚ã€‚ã€‚ã€‚çŸ¥é“é—®é¢˜é‚£æˆ‘ä»¬å°±å¼€å§‹ä¼˜åŒ–å§\n\n<!-- more -->\n\n### ç¼“å­˜\n\n### Spring Cache\n\n\næ³¨è§£|åŠŸèƒ½\n---|---\nCacheable|\nCacheEvict|\nCachePut|\nCaching|\n\n#### spring boot cache æµç¨‹\n{% asset_img springCache.png This is an example image %}\n\n#### å¤šçº§ç¼“å­˜æµç¨‹\n{% asset_img å¤šçº§ç¼“å­˜.png This is an example image %}\n\n\n#### springboot å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\n1. ä¾èµ–org.springframework.boot:spring-boot-starter-cache\n2. åœ¨å¯åŠ¨ç±»å¢åŠ æ³¨è§£@EnableCaching\n3. åœ¨æƒ³è¦å¢åŠ ç¼“å­˜çš„æ–¹æ³•æˆ–è€…æˆå‘˜å˜é‡ä¸Šå¢åŠ ä»¥ä¸‹æ³¨è§£\n\n#### å¯ç”¨å¤šçº§ç¼“å­˜\n1. å¼•å…¥ç»„ä»¶\n\n```gradle \n\n``` \n\n2. å¼€å¯ç¼“å­˜\n   \n###### æ— å‚ç¼“å­˜\n```java\n\n``` \n\n###### å¸¦å‚ç¼“å­˜1\n```java\n\n``` \n\n###### å¸¦å‚ç¼“å­˜2\n```java\n\n``` \n\n###### ç»„åˆå‚æ•°ç¼“å­˜\n```java\n\n``` ","source":"_posts/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜.md","raw":"---\ntitle: å¤šçº§ç¼“å­˜\ndate: 2019-09-04 15:35:11\ntags: \n    - Java\n    - Redis\n    - Cache\ncategories :\n    - Technology\n---\n### èµ·å› \né¡¹ç›®å¹³ç¨³çš„å·²ç»è¿è¡Œå¿«ä¸€å¹´äº†ï¼ŒæŸå¤©æ—©ä¸Šç›‘æ§çªç„¶å‘Šè­¦å¤§é‡æ ¸å¿ƒæœåŠ¡ä¸å¯èƒ½ï¼Œè™½ç„¶è¿ç»´ç´§æ€¥å¤„ç†å¹¶é‡å¯äº†æœåŠ¡ã€‚ä½†è¿™ç§éæ­£å¸¸çš„æœåŠ¡å®•æœºç€å®è®©äººæäº†æŠŠå†·æ±—ï¼ˆè¿˜å¥½åˆ›ä¸šå…¬å¸è¿˜æ²¡æœ‰ç”Ÿäº§äº‹æ•…æƒ©ç½šæœºåˆ¶ï¼‰ã€‚\n\néšåæˆ‘ä»¬Dumpä¸‹äº†æœåŠ¡èµ·çš„æ—¥å¿—ï¼Œå‘ç°äº‹æ•…æœŸé—´JVMå­˜åœ¨å¤§é‡çš„Full GCï¼Œé…åˆCATçš„ç›‘æ§æŒ‡æ ‡å‘ç°æŸå‡ ä¸ªæ¥å£çš„è°ƒç”¨é‡å‰§å¢ã€‚ã€‚ã€‚ã€‚å¤§æ¦‚æˆ‘ä»¬æ˜¯è¢«åˆ·æ¥å£äº†ã€‚\n\næŸ¥çœ‹å…·ä½“æ¥å£ï¼Œå‘ç°å‰ç«¯åå¤æŸ¥è¯¢é…ç½®ä¿¡æ¯è€Œä¸”æ²¡æœ‰åšç¼“å­˜ï¼Œå¤§é‡çš„å¤§å¯¹è±¡å †ç§¯ä¸é¢‘ç¹Full GCæ‰æ€ªã€‚ã€‚ã€‚ã€‚çŸ¥é“é—®é¢˜é‚£æˆ‘ä»¬å°±å¼€å§‹ä¼˜åŒ–å§\n\n<!-- more -->\n\n### ç¼“å­˜\n\n### Spring Cache\n\n\næ³¨è§£|åŠŸèƒ½\n---|---\nCacheable|\nCacheEvict|\nCachePut|\nCaching|\n\n#### spring boot cache æµç¨‹\n{% asset_img springCache.png This is an example image %}\n\n#### å¤šçº§ç¼“å­˜æµç¨‹\n{% asset_img å¤šçº§ç¼“å­˜.png This is an example image %}\n\n\n#### springboot å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\n1. ä¾èµ–org.springframework.boot:spring-boot-starter-cache\n2. åœ¨å¯åŠ¨ç±»å¢åŠ æ³¨è§£@EnableCaching\n3. åœ¨æƒ³è¦å¢åŠ ç¼“å­˜çš„æ–¹æ³•æˆ–è€…æˆå‘˜å˜é‡ä¸Šå¢åŠ ä»¥ä¸‹æ³¨è§£\n\n#### å¯ç”¨å¤šçº§ç¼“å­˜\n1. å¼•å…¥ç»„ä»¶\n\n```gradle \n\n``` \n\n2. å¼€å¯ç¼“å­˜\n   \n###### æ— å‚ç¼“å­˜\n```java\n\n``` \n\n###### å¸¦å‚ç¼“å­˜1\n```java\n\n``` \n\n###### å¸¦å‚ç¼“å­˜2\n```java\n\n``` \n\n###### ç»„åˆå‚æ•°ç¼“å­˜\n```java\n\n``` ","slug":"ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜","published":1,"updated":"2019-09-10T13:44:41.982Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck10secrh000djonyrf87fdm6","content":"<h3 id=\"èµ·å› \"><a href=\"#èµ·å› \" class=\"headerlink\" title=\"èµ·å› \"></a>èµ·å› </h3><p>é¡¹ç›®å¹³ç¨³çš„å·²ç»è¿è¡Œå¿«ä¸€å¹´äº†ï¼ŒæŸå¤©æ—©ä¸Šç›‘æ§çªç„¶å‘Šè­¦å¤§é‡æ ¸å¿ƒæœåŠ¡ä¸å¯èƒ½ï¼Œè™½ç„¶è¿ç»´ç´§æ€¥å¤„ç†å¹¶é‡å¯äº†æœåŠ¡ã€‚ä½†è¿™ç§éæ­£å¸¸çš„æœåŠ¡å®•æœºç€å®è®©äººæäº†æŠŠå†·æ±—ï¼ˆè¿˜å¥½åˆ›ä¸šå…¬å¸è¿˜æ²¡æœ‰ç”Ÿäº§äº‹æ•…æƒ©ç½šæœºåˆ¶ï¼‰ã€‚</p>\n<p>éšåæˆ‘ä»¬Dumpä¸‹äº†æœåŠ¡èµ·çš„æ—¥å¿—ï¼Œå‘ç°äº‹æ•…æœŸé—´JVMå­˜åœ¨å¤§é‡çš„Full GCï¼Œé…åˆCATçš„ç›‘æ§æŒ‡æ ‡å‘ç°æŸå‡ ä¸ªæ¥å£çš„è°ƒç”¨é‡å‰§å¢ã€‚ã€‚ã€‚ã€‚å¤§æ¦‚æˆ‘ä»¬æ˜¯è¢«åˆ·æ¥å£äº†ã€‚</p>\n<p>æŸ¥çœ‹å…·ä½“æ¥å£ï¼Œå‘ç°å‰ç«¯åå¤æŸ¥è¯¢é…ç½®ä¿¡æ¯è€Œä¸”æ²¡æœ‰åšç¼“å­˜ï¼Œå¤§é‡çš„å¤§å¯¹è±¡å †ç§¯ä¸é¢‘ç¹Full GCæ‰æ€ªã€‚ã€‚ã€‚ã€‚çŸ¥é“é—®é¢˜é‚£æˆ‘ä»¬å°±å¼€å§‹ä¼˜åŒ–å§</p>\n<a id=\"more\"></a>\n\n<h3 id=\"ç¼“å­˜\"><a href=\"#ç¼“å­˜\" class=\"headerlink\" title=\"ç¼“å­˜\"></a>ç¼“å­˜</h3><h3 id=\"Spring-Cache\"><a href=\"#Spring-Cache\" class=\"headerlink\" title=\"Spring Cache\"></a>Spring Cache</h3><table>\n<thead>\n<tr>\n<th>æ³¨è§£</th>\n<th>åŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Cacheable</td>\n<td></td>\n</tr>\n<tr>\n<td>CacheEvict</td>\n<td></td>\n</tr>\n<tr>\n<td>CachePut</td>\n<td></td>\n</tr>\n<tr>\n<td>Caching</td>\n<td></td>\n</tr>\n</tbody></table>\n<h4 id=\"spring-boot-cache-æµç¨‹\"><a href=\"#spring-boot-cache-æµç¨‹\" class=\"headerlink\" title=\"spring boot cache æµç¨‹\"></a>spring boot cache æµç¨‹</h4><img src=\"/2019/09/04/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/springCache.png\" title=\"This is an example image\">\n\n<h4 id=\"å¤šçº§ç¼“å­˜æµç¨‹\"><a href=\"#å¤šçº§ç¼“å­˜æµç¨‹\" class=\"headerlink\" title=\"å¤šçº§ç¼“å­˜æµç¨‹\"></a>å¤šçº§ç¼“å­˜æµç¨‹</h4><img src=\"/2019/09/04/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/å¤šçº§ç¼“å­˜.png\" title=\"This is an example image\">\n\n\n<h4 id=\"springboot-å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\"><a href=\"#springboot-å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\" class=\"headerlink\" title=\"springboot å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\"></a>springboot å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿</h4><ol>\n<li>ä¾èµ–org.springframework.boot:spring-boot-starter-cache</li>\n<li>åœ¨å¯åŠ¨ç±»å¢åŠ æ³¨è§£@EnableCaching</li>\n<li>åœ¨æƒ³è¦å¢åŠ ç¼“å­˜çš„æ–¹æ³•æˆ–è€…æˆå‘˜å˜é‡ä¸Šå¢åŠ ä»¥ä¸‹æ³¨è§£</li>\n</ol>\n<h4 id=\"å¯ç”¨å¤šçº§ç¼“å­˜\"><a href=\"#å¯ç”¨å¤šçº§ç¼“å­˜\" class=\"headerlink\" title=\"å¯ç”¨å¤šçº§ç¼“å­˜\"></a>å¯ç”¨å¤šçº§ç¼“å­˜</h4><ol>\n<li>å¼•å…¥ç»„ä»¶</li>\n</ol>\n<pre><code class=\"gradle\"></code></pre>\n<ol start=\"2\">\n<li>å¼€å¯ç¼“å­˜</li>\n</ol>\n<h6 id=\"æ— å‚ç¼“å­˜\"><a href=\"#æ— å‚ç¼“å­˜\" class=\"headerlink\" title=\"æ— å‚ç¼“å­˜\"></a>æ— å‚ç¼“å­˜</h6><pre><code class=\"java\"></code></pre>\n<h6 id=\"å¸¦å‚ç¼“å­˜1\"><a href=\"#å¸¦å‚ç¼“å­˜1\" class=\"headerlink\" title=\"å¸¦å‚ç¼“å­˜1\"></a>å¸¦å‚ç¼“å­˜1</h6><pre><code class=\"java\"></code></pre>\n<h6 id=\"å¸¦å‚ç¼“å­˜2\"><a href=\"#å¸¦å‚ç¼“å­˜2\" class=\"headerlink\" title=\"å¸¦å‚ç¼“å­˜2\"></a>å¸¦å‚ç¼“å­˜2</h6><pre><code class=\"java\"></code></pre>\n<h6 id=\"ç»„åˆå‚æ•°ç¼“å­˜\"><a href=\"#ç»„åˆå‚æ•°ç¼“å­˜\" class=\"headerlink\" title=\"ç»„åˆå‚æ•°ç¼“å­˜\"></a>ç»„åˆå‚æ•°ç¼“å­˜</h6><pre><code class=\"java\"></code></pre>\n","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Redis","path":"tags/Redis/"},{"name":"Cache","path":"tags/Cache/"}],"excerpt":"<h3 id=\"èµ·å› \"><a href=\"#èµ·å› \" class=\"headerlink\" title=\"èµ·å› \"></a>èµ·å› </h3><p>é¡¹ç›®å¹³ç¨³çš„å·²ç»è¿è¡Œå¿«ä¸€å¹´äº†ï¼ŒæŸå¤©æ—©ä¸Šç›‘æ§çªç„¶å‘Šè­¦å¤§é‡æ ¸å¿ƒæœåŠ¡ä¸å¯èƒ½ï¼Œè™½ç„¶è¿ç»´ç´§æ€¥å¤„ç†å¹¶é‡å¯äº†æœåŠ¡ã€‚ä½†è¿™ç§éæ­£å¸¸çš„æœåŠ¡å®•æœºç€å®è®©äººæäº†æŠŠå†·æ±—ï¼ˆè¿˜å¥½åˆ›ä¸šå…¬å¸è¿˜æ²¡æœ‰ç”Ÿäº§äº‹æ•…æƒ©ç½šæœºåˆ¶ï¼‰ã€‚</p>\n<p>éšåæˆ‘ä»¬Dumpä¸‹äº†æœåŠ¡èµ·çš„æ—¥å¿—ï¼Œå‘ç°äº‹æ•…æœŸé—´JVMå­˜åœ¨å¤§é‡çš„Full GCï¼Œé…åˆCATçš„ç›‘æ§æŒ‡æ ‡å‘ç°æŸå‡ ä¸ªæ¥å£çš„è°ƒç”¨é‡å‰§å¢ã€‚ã€‚ã€‚ã€‚å¤§æ¦‚æˆ‘ä»¬æ˜¯è¢«åˆ·æ¥å£äº†ã€‚</p>\n<p>æŸ¥çœ‹å…·ä½“æ¥å£ï¼Œå‘ç°å‰ç«¯åå¤æŸ¥è¯¢é…ç½®ä¿¡æ¯è€Œä¸”æ²¡æœ‰åšç¼“å­˜ï¼Œå¤§é‡çš„å¤§å¯¹è±¡å †ç§¯ä¸é¢‘ç¹Full GCæ‰æ€ªã€‚ã€‚ã€‚ã€‚çŸ¥é“é—®é¢˜é‚£æˆ‘ä»¬å°±å¼€å§‹ä¼˜åŒ–å§</p>","more":"<h3 id=\"ç¼“å­˜\"><a href=\"#ç¼“å­˜\" class=\"headerlink\" title=\"ç¼“å­˜\"></a>ç¼“å­˜</h3><h3 id=\"Spring-Cache\"><a href=\"#Spring-Cache\" class=\"headerlink\" title=\"Spring Cache\"></a>Spring Cache</h3><table>\n<thead>\n<tr>\n<th>æ³¨è§£</th>\n<th>åŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Cacheable</td>\n<td></td>\n</tr>\n<tr>\n<td>CacheEvict</td>\n<td></td>\n</tr>\n<tr>\n<td>CachePut</td>\n<td></td>\n</tr>\n<tr>\n<td>Caching</td>\n<td></td>\n</tr>\n</tbody></table>\n<h4 id=\"spring-boot-cache-æµç¨‹\"><a href=\"#spring-boot-cache-æµç¨‹\" class=\"headerlink\" title=\"spring boot cache æµç¨‹\"></a>spring boot cache æµç¨‹</h4><img src=\"/2019/09/04/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/springCache.png\" title=\"This is an example image\">\n\n<h4 id=\"å¤šçº§ç¼“å­˜æµç¨‹\"><a href=\"#å¤šçº§ç¼“å­˜æµç¨‹\" class=\"headerlink\" title=\"å¤šçº§ç¼“å­˜æµç¨‹\"></a>å¤šçº§ç¼“å­˜æµç¨‹</h4><img src=\"/2019/09/04/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/å¤šçº§ç¼“å­˜.png\" title=\"This is an example image\">\n\n\n<h4 id=\"springboot-å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\"><a href=\"#springboot-å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\" class=\"headerlink\" title=\"springboot å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\"></a>springboot å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿</h4><ol>\n<li>ä¾èµ–org.springframework.boot:spring-boot-starter-cache</li>\n<li>åœ¨å¯åŠ¨ç±»å¢åŠ æ³¨è§£@EnableCaching</li>\n<li>åœ¨æƒ³è¦å¢åŠ ç¼“å­˜çš„æ–¹æ³•æˆ–è€…æˆå‘˜å˜é‡ä¸Šå¢åŠ ä»¥ä¸‹æ³¨è§£</li>\n</ol>\n<h4 id=\"å¯ç”¨å¤šçº§ç¼“å­˜\"><a href=\"#å¯ç”¨å¤šçº§ç¼“å­˜\" class=\"headerlink\" title=\"å¯ç”¨å¤šçº§ç¼“å­˜\"></a>å¯ç”¨å¤šçº§ç¼“å­˜</h4><ol>\n<li>å¼•å…¥ç»„ä»¶</li>\n</ol>\n<pre><code class=\"gradle\"></code></pre>\n<ol start=\"2\">\n<li>å¼€å¯ç¼“å­˜</li>\n</ol>\n<h6 id=\"æ— å‚ç¼“å­˜\"><a href=\"#æ— å‚ç¼“å­˜\" class=\"headerlink\" title=\"æ— å‚ç¼“å­˜\"></a>æ— å‚ç¼“å­˜</h6><pre><code class=\"java\"></code></pre>\n<h6 id=\"å¸¦å‚ç¼“å­˜1\"><a href=\"#å¸¦å‚ç¼“å­˜1\" class=\"headerlink\" title=\"å¸¦å‚ç¼“å­˜1\"></a>å¸¦å‚ç¼“å­˜1</h6><pre><code class=\"java\"></code></pre>\n<h6 id=\"å¸¦å‚ç¼“å­˜2\"><a href=\"#å¸¦å‚ç¼“å­˜2\" class=\"headerlink\" title=\"å¸¦å‚ç¼“å­˜2\"></a>å¸¦å‚ç¼“å­˜2</h6><pre><code class=\"java\"></code></pre>\n<h6 id=\"ç»„åˆå‚æ•°ç¼“å­˜\"><a href=\"#ç»„åˆå‚æ•°ç¼“å­˜\" class=\"headerlink\" title=\"ç»„åˆå‚æ•°ç¼“å­˜\"></a>ç»„åˆå‚æ•°ç¼“å­˜</h6><pre><code class=\"java\"></code></pre>"},{"title":"ğŸ‡","date":"2019-09-05T05:19:02.000Z","_content":"\nå¤§ç™½å…”ã€‚ã€‚ä½ å˜äº†ã€‚ã€‚ã€‚\n\n{% asset_img ç‰Œå­.jpeg 400 400 ç‰Œå­ %}\n<!-- more -->\n\n{% asset_img å…¨æ™¯.jpeg 400 400 æ’é˜Ÿ %}","source":"_posts/ğŸ‡.md","raw":"---\ntitle: \"\\U0001F407\"\ndate: 2019-09-05 13:19:02\ntags: \n    - Food\ncategories :\n    - Life\n---\n\nå¤§ç™½å…”ã€‚ã€‚ä½ å˜äº†ã€‚ã€‚ã€‚\n\n{% asset_img ç‰Œå­.jpeg 400 400 ç‰Œå­ %}\n<!-- more -->\n\n{% asset_img å…¨æ™¯.jpeg 400 400 æ’é˜Ÿ %}","slug":"ğŸ‡","published":1,"updated":"2019-09-10T13:44:41.985Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck10secri000ejonyv69h1ot6","content":"<p>å¤§ç™½å…”ã€‚ã€‚ä½ å˜äº†ã€‚ã€‚ã€‚</p>\n<img src=\"/2019/09/05/ğŸ‡/ç‰Œå­.jpeg\" width=\"400\" height=\"400\" title=\"ç‰Œå­\">\n<a id=\"more\"></a>\n\n<img src=\"/2019/09/05/ğŸ‡/å…¨æ™¯.jpeg\" width=\"400\" height=\"400\" title=\"æ’é˜Ÿ\">","site":{"data":{}},"_categories":[{"name":"Life","path":"categories/Life/"}],"_tags":[{"name":"Food","path":"tags/Food/"}],"excerpt":"<p>å¤§ç™½å…”ã€‚ã€‚ä½ å˜äº†ã€‚ã€‚ã€‚</p>\n<img src=\"/2019/09/05/ğŸ‡/ç‰Œå­.jpeg\" width=\"400\" height=\"400\" title=\"ç‰Œå­\">","more":"<img src=\"/2019/09/05/ğŸ‡/å…¨æ™¯.jpeg\" width=\"400\" height=\"400\" title=\"æ’é˜Ÿ\">"},{"title":"æœå¯»æµæµªç‹—APP???","date":"2019-09-06T15:41:32.000Z","_content":"\n## ä¸­å›½AIå…¬å¸å¼€å‘äº†ç”¨é¼»çº¹æœç´¢æµæµªç‹—çš„APP\n\n\nå¦‚æœç¥åˆ°æµæµªç‹—çš„æµ·æŠ¥ä¸€å®šè¦çœ‹çœ‹ã€‚\n\néšç€ä¸€ä¸ªä¸ªå¯’å†·çš„æ—¥å­ï¼Œåˆè¦åˆ°çƒŸèŠ±å¤§ä¼šçš„å­£èŠ‚ã€‚ä¹Ÿæ˜¯å®¶çŠ¬è¢«é­ç‚®å£°å“è·‘çš„å­£èŠ‚ã€‚\n<!-- more -->\næœ€è¿‘å®¶é‡Œå…»ç‹—çš„è¶Šæ¥è¶Šå¤šï¼Œè¹­ç€çª—é—¨å¼€ç€ä¸»äººä¸€ä¸ç•™ç¥é€ƒè·‘çš„ä¹Ÿä¸åœ¨å°‘æ•°ï¼Œæˆ‘å®¶çš„çˆ±çŠ¬å°±æ˜¯åœ¨è¿™ä¸ªå­£èŠ‚é€ƒè·‘çš„ã€‚\n\nçˆ±çŠ¬èµ°ä¸¢æ—¶ä¸€èˆ¬æ¥è¯´å°±æ˜¯å¼ è´´å¯»ç‹—æµ·æŠ¥æˆ–è€…å„å¤„æ‰“å¬ã€‚ä½†æ˜¯ä¸­å›½çš„ä¸€å®¶å«Megviiï¼ˆæ—·ä¸–ï¼‰çš„AIå…¬å¸å¯ä¸ä¸€æ ·ã€‚\n\næ ¹æ®VergeæŠ¥é“ï¼Œè¯¥å…¬å¸æ­£åœ¨å¼€å‘ä¸€ç§åƒäººç±»æŒ‡çº¹ä¸€æ ·è¯†åˆ«ç‹—é¼»å­å½¢çŠ¶çš„ã€ç‹—è¯†åˆ«ç³»ç»Ÿã€‘ã€‚ä½¿ç”¨æ—·ä¸–çš„APPï¼Œé€šè¿‡æ‰‹æœºæ‘„åƒå¤´å¤šè§’åº¦æ‹æ‘„ç‹—é¼»å­å°±èƒ½ç™»å½•å®Œæˆã€‚å¹¶ç§°å…·æœ‰95%çš„ç²¾åº¦ï¼Œå› æ­¤é€šè¿‡è¿™ä¸ªAPPï¼Œæœ‰1ä¸‡5000æ¡å® ç‰©çŠ¬èƒ½å†å’Œå®ƒçš„ä¸»äººå†ä¼šã€‚\n\nä½†æ˜¯åœ¨ä¸­å›½ä¸æ˜¯ç”¨åœ¨å’Œä¸»äººçš„å†ä¼šï¼Œè€Œæ˜¯å’Œæ”¿åºœåˆä½œè§„èŒƒä¸è‰¯ç‹—ä¸»äººçš„è¡Œä¸ºã€‚\n\nå…·ä½“æ€æ ·ç›‘è§†è¿˜ä¸æ¸…æ¥šï¼Œå¯èƒ½æ˜¯å® ç‰©ç¬¬ä¸€æ¬¡è¿›å…¥å®¶åº­çš„æ—¶å€™ç™»å½•å§ã€‚ç„¶åå¦‚æœæƒ³æœå¯»æœ‰é—®é¢˜çš„ç‹—ä¸»äººï¼Œéœ€è¦å·¥ä½œäººå‘˜å½“åœºæ‰«æç‹—é¼»å­ä»è€Œé‰´åˆ«ç‹—ä¸»äººï¼Ÿ\n\nå°±æˆ‘çš„è¯è¿˜æ˜¯å¸Œæœ›èƒ½å¾—åˆ°éšåœ°å¤§å°ä¾¿çš„ç‹—ç‹—çš„ä¸»äººä¿¡æ¯ï¼Œæ¯•ç«Ÿå®¶é—¨å£è½ä¸‹çš„ä¾¿ä¾¿ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚\n\n\n\n{% blockquote ä¸­å·çœŸçŸ¥å­ https://www.gizmodo.jp/2019/07/ai-start-up-dog-nose.html ä¸­å›½ã®AIã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãŒè¿·ã„çŠ¬ã‚’é¼»ã®æŒ‡ç´‹ï¼ˆï¼Ÿï¼‰ã‚’ä½¿ã£ã¦æœç´¢ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’é–‹ç™º %}\næœ¬æ–‡è¯‘è‡ª\n{% endblockquote %}","source":"_posts/æœå¯»æµæµªç‹—APP.md","raw":"---\ntitle: æœå¯»æµæµªç‹—APP???\ndate: 2019-09-06 23:41:32\ntags: \n    - AI\n    - APP\ncategories:\n    - Translation\n---\n\n## ä¸­å›½AIå…¬å¸å¼€å‘äº†ç”¨é¼»çº¹æœç´¢æµæµªç‹—çš„APP\n\n\nå¦‚æœç¥åˆ°æµæµªç‹—çš„æµ·æŠ¥ä¸€å®šè¦çœ‹çœ‹ã€‚\n\néšç€ä¸€ä¸ªä¸ªå¯’å†·çš„æ—¥å­ï¼Œåˆè¦åˆ°çƒŸèŠ±å¤§ä¼šçš„å­£èŠ‚ã€‚ä¹Ÿæ˜¯å®¶çŠ¬è¢«é­ç‚®å£°å“è·‘çš„å­£èŠ‚ã€‚\n<!-- more -->\næœ€è¿‘å®¶é‡Œå…»ç‹—çš„è¶Šæ¥è¶Šå¤šï¼Œè¹­ç€çª—é—¨å¼€ç€ä¸»äººä¸€ä¸ç•™ç¥é€ƒè·‘çš„ä¹Ÿä¸åœ¨å°‘æ•°ï¼Œæˆ‘å®¶çš„çˆ±çŠ¬å°±æ˜¯åœ¨è¿™ä¸ªå­£èŠ‚é€ƒè·‘çš„ã€‚\n\nçˆ±çŠ¬èµ°ä¸¢æ—¶ä¸€èˆ¬æ¥è¯´å°±æ˜¯å¼ è´´å¯»ç‹—æµ·æŠ¥æˆ–è€…å„å¤„æ‰“å¬ã€‚ä½†æ˜¯ä¸­å›½çš„ä¸€å®¶å«Megviiï¼ˆæ—·ä¸–ï¼‰çš„AIå…¬å¸å¯ä¸ä¸€æ ·ã€‚\n\næ ¹æ®VergeæŠ¥é“ï¼Œè¯¥å…¬å¸æ­£åœ¨å¼€å‘ä¸€ç§åƒäººç±»æŒ‡çº¹ä¸€æ ·è¯†åˆ«ç‹—é¼»å­å½¢çŠ¶çš„ã€ç‹—è¯†åˆ«ç³»ç»Ÿã€‘ã€‚ä½¿ç”¨æ—·ä¸–çš„APPï¼Œé€šè¿‡æ‰‹æœºæ‘„åƒå¤´å¤šè§’åº¦æ‹æ‘„ç‹—é¼»å­å°±èƒ½ç™»å½•å®Œæˆã€‚å¹¶ç§°å…·æœ‰95%çš„ç²¾åº¦ï¼Œå› æ­¤é€šè¿‡è¿™ä¸ªAPPï¼Œæœ‰1ä¸‡5000æ¡å® ç‰©çŠ¬èƒ½å†å’Œå®ƒçš„ä¸»äººå†ä¼šã€‚\n\nä½†æ˜¯åœ¨ä¸­å›½ä¸æ˜¯ç”¨åœ¨å’Œä¸»äººçš„å†ä¼šï¼Œè€Œæ˜¯å’Œæ”¿åºœåˆä½œè§„èŒƒä¸è‰¯ç‹—ä¸»äººçš„è¡Œä¸ºã€‚\n\nå…·ä½“æ€æ ·ç›‘è§†è¿˜ä¸æ¸…æ¥šï¼Œå¯èƒ½æ˜¯å® ç‰©ç¬¬ä¸€æ¬¡è¿›å…¥å®¶åº­çš„æ—¶å€™ç™»å½•å§ã€‚ç„¶åå¦‚æœæƒ³æœå¯»æœ‰é—®é¢˜çš„ç‹—ä¸»äººï¼Œéœ€è¦å·¥ä½œäººå‘˜å½“åœºæ‰«æç‹—é¼»å­ä»è€Œé‰´åˆ«ç‹—ä¸»äººï¼Ÿ\n\nå°±æˆ‘çš„è¯è¿˜æ˜¯å¸Œæœ›èƒ½å¾—åˆ°éšåœ°å¤§å°ä¾¿çš„ç‹—ç‹—çš„ä¸»äººä¿¡æ¯ï¼Œæ¯•ç«Ÿå®¶é—¨å£è½ä¸‹çš„ä¾¿ä¾¿ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚\n\n\n\n{% blockquote ä¸­å·çœŸçŸ¥å­ https://www.gizmodo.jp/2019/07/ai-start-up-dog-nose.html ä¸­å›½ã®AIã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãŒè¿·ã„çŠ¬ã‚’é¼»ã®æŒ‡ç´‹ï¼ˆï¼Ÿï¼‰ã‚’ä½¿ã£ã¦æœç´¢ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’é–‹ç™º %}\næœ¬æ–‡è¯‘è‡ª\n{% endblockquote %}","slug":"æœå¯»æµæµªç‹—APP","published":1,"updated":"2019-09-10T13:44:41.984Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck10secrk000ijonyqozyx34c","content":"<h2 id=\"ä¸­å›½AIå…¬å¸å¼€å‘äº†ç”¨é¼»çº¹æœç´¢æµæµªç‹—çš„APP\"><a href=\"#ä¸­å›½AIå…¬å¸å¼€å‘äº†ç”¨é¼»çº¹æœç´¢æµæµªç‹—çš„APP\" class=\"headerlink\" title=\"ä¸­å›½AIå…¬å¸å¼€å‘äº†ç”¨é¼»çº¹æœç´¢æµæµªç‹—çš„APP\"></a>ä¸­å›½AIå…¬å¸å¼€å‘äº†ç”¨é¼»çº¹æœç´¢æµæµªç‹—çš„APP</h2><p>å¦‚æœç¥åˆ°æµæµªç‹—çš„æµ·æŠ¥ä¸€å®šè¦çœ‹çœ‹ã€‚</p>\n<p>éšç€ä¸€ä¸ªä¸ªå¯’å†·çš„æ—¥å­ï¼Œåˆè¦åˆ°çƒŸèŠ±å¤§ä¼šçš„å­£èŠ‚ã€‚ä¹Ÿæ˜¯å®¶çŠ¬è¢«é­ç‚®å£°å“è·‘çš„å­£èŠ‚ã€‚</p>\n<a id=\"more\"></a>\n<p>æœ€è¿‘å®¶é‡Œå…»ç‹—çš„è¶Šæ¥è¶Šå¤šï¼Œè¹­ç€çª—é—¨å¼€ç€ä¸»äººä¸€ä¸ç•™ç¥é€ƒè·‘çš„ä¹Ÿä¸åœ¨å°‘æ•°ï¼Œæˆ‘å®¶çš„çˆ±çŠ¬å°±æ˜¯åœ¨è¿™ä¸ªå­£èŠ‚é€ƒè·‘çš„ã€‚</p>\n<p>çˆ±çŠ¬èµ°ä¸¢æ—¶ä¸€èˆ¬æ¥è¯´å°±æ˜¯å¼ è´´å¯»ç‹—æµ·æŠ¥æˆ–è€…å„å¤„æ‰“å¬ã€‚ä½†æ˜¯ä¸­å›½çš„ä¸€å®¶å«Megviiï¼ˆæ—·ä¸–ï¼‰çš„AIå…¬å¸å¯ä¸ä¸€æ ·ã€‚</p>\n<p>æ ¹æ®VergeæŠ¥é“ï¼Œè¯¥å…¬å¸æ­£åœ¨å¼€å‘ä¸€ç§åƒäººç±»æŒ‡çº¹ä¸€æ ·è¯†åˆ«ç‹—é¼»å­å½¢çŠ¶çš„ã€ç‹—è¯†åˆ«ç³»ç»Ÿã€‘ã€‚ä½¿ç”¨æ—·ä¸–çš„APPï¼Œé€šè¿‡æ‰‹æœºæ‘„åƒå¤´å¤šè§’åº¦æ‹æ‘„ç‹—é¼»å­å°±èƒ½ç™»å½•å®Œæˆã€‚å¹¶ç§°å…·æœ‰95%çš„ç²¾åº¦ï¼Œå› æ­¤é€šè¿‡è¿™ä¸ªAPPï¼Œæœ‰1ä¸‡5000æ¡å® ç‰©çŠ¬èƒ½å†å’Œå®ƒçš„ä¸»äººå†ä¼šã€‚</p>\n<p>ä½†æ˜¯åœ¨ä¸­å›½ä¸æ˜¯ç”¨åœ¨å’Œä¸»äººçš„å†ä¼šï¼Œè€Œæ˜¯å’Œæ”¿åºœåˆä½œè§„èŒƒä¸è‰¯ç‹—ä¸»äººçš„è¡Œä¸ºã€‚</p>\n<p>å…·ä½“æ€æ ·ç›‘è§†è¿˜ä¸æ¸…æ¥šï¼Œå¯èƒ½æ˜¯å® ç‰©ç¬¬ä¸€æ¬¡è¿›å…¥å®¶åº­çš„æ—¶å€™ç™»å½•å§ã€‚ç„¶åå¦‚æœæƒ³æœå¯»æœ‰é—®é¢˜çš„ç‹—ä¸»äººï¼Œéœ€è¦å·¥ä½œäººå‘˜å½“åœºæ‰«æç‹—é¼»å­ä»è€Œé‰´åˆ«ç‹—ä¸»äººï¼Ÿ</p>\n<p>å°±æˆ‘çš„è¯è¿˜æ˜¯å¸Œæœ›èƒ½å¾—åˆ°éšåœ°å¤§å°ä¾¿çš„ç‹—ç‹—çš„ä¸»äººä¿¡æ¯ï¼Œæ¯•ç«Ÿå®¶é—¨å£è½ä¸‹çš„ä¾¿ä¾¿ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>\n<blockquote><p>æœ¬æ–‡è¯‘è‡ª</p>\n<footer><strong>ä¸­å·çœŸçŸ¥å­</strong><cite><a href=\"https://www.gizmodo.jp/2019/07/ai-start-up-dog-nose.html\" target=\"_blank\" rel=\"noopener\">ä¸­å›½ã®AIã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãŒè¿·ã„çŠ¬ã‚’é¼»ã®æŒ‡ç´‹ï¼ˆï¼Ÿï¼‰ã‚’ä½¿ã£ã¦æœç´¢ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’é–‹ç™º</a></cite></footer></blockquote>","site":{"data":{}},"_categories":[{"name":"Translation","path":"categories/Translation/"}],"_tags":[{"name":"AI","path":"tags/AI/"},{"name":"APP","path":"tags/APP/"}],"excerpt":"<h2 id=\"ä¸­å›½AIå…¬å¸å¼€å‘äº†ç”¨é¼»çº¹æœç´¢æµæµªç‹—çš„APP\"><a href=\"#ä¸­å›½AIå…¬å¸å¼€å‘äº†ç”¨é¼»çº¹æœç´¢æµæµªç‹—çš„APP\" class=\"headerlink\" title=\"ä¸­å›½AIå…¬å¸å¼€å‘äº†ç”¨é¼»çº¹æœç´¢æµæµªç‹—çš„APP\"></a>ä¸­å›½AIå…¬å¸å¼€å‘äº†ç”¨é¼»çº¹æœç´¢æµæµªç‹—çš„APP</h2><p>å¦‚æœç¥åˆ°æµæµªç‹—çš„æµ·æŠ¥ä¸€å®šè¦çœ‹çœ‹ã€‚</p>\n<p>éšç€ä¸€ä¸ªä¸ªå¯’å†·çš„æ—¥å­ï¼Œåˆè¦åˆ°çƒŸèŠ±å¤§ä¼šçš„å­£èŠ‚ã€‚ä¹Ÿæ˜¯å®¶çŠ¬è¢«é­ç‚®å£°å“è·‘çš„å­£èŠ‚ã€‚</p>","more":"<p>æœ€è¿‘å®¶é‡Œå…»ç‹—çš„è¶Šæ¥è¶Šå¤šï¼Œè¹­ç€çª—é—¨å¼€ç€ä¸»äººä¸€ä¸ç•™ç¥é€ƒè·‘çš„ä¹Ÿä¸åœ¨å°‘æ•°ï¼Œæˆ‘å®¶çš„çˆ±çŠ¬å°±æ˜¯åœ¨è¿™ä¸ªå­£èŠ‚é€ƒè·‘çš„ã€‚</p>\n<p>çˆ±çŠ¬èµ°ä¸¢æ—¶ä¸€èˆ¬æ¥è¯´å°±æ˜¯å¼ è´´å¯»ç‹—æµ·æŠ¥æˆ–è€…å„å¤„æ‰“å¬ã€‚ä½†æ˜¯ä¸­å›½çš„ä¸€å®¶å«Megviiï¼ˆæ—·ä¸–ï¼‰çš„AIå…¬å¸å¯ä¸ä¸€æ ·ã€‚</p>\n<p>æ ¹æ®VergeæŠ¥é“ï¼Œè¯¥å…¬å¸æ­£åœ¨å¼€å‘ä¸€ç§åƒäººç±»æŒ‡çº¹ä¸€æ ·è¯†åˆ«ç‹—é¼»å­å½¢çŠ¶çš„ã€ç‹—è¯†åˆ«ç³»ç»Ÿã€‘ã€‚ä½¿ç”¨æ—·ä¸–çš„APPï¼Œé€šè¿‡æ‰‹æœºæ‘„åƒå¤´å¤šè§’åº¦æ‹æ‘„ç‹—é¼»å­å°±èƒ½ç™»å½•å®Œæˆã€‚å¹¶ç§°å…·æœ‰95%çš„ç²¾åº¦ï¼Œå› æ­¤é€šè¿‡è¿™ä¸ªAPPï¼Œæœ‰1ä¸‡5000æ¡å® ç‰©çŠ¬èƒ½å†å’Œå®ƒçš„ä¸»äººå†ä¼šã€‚</p>\n<p>ä½†æ˜¯åœ¨ä¸­å›½ä¸æ˜¯ç”¨åœ¨å’Œä¸»äººçš„å†ä¼šï¼Œè€Œæ˜¯å’Œæ”¿åºœåˆä½œè§„èŒƒä¸è‰¯ç‹—ä¸»äººçš„è¡Œä¸ºã€‚</p>\n<p>å…·ä½“æ€æ ·ç›‘è§†è¿˜ä¸æ¸…æ¥šï¼Œå¯èƒ½æ˜¯å® ç‰©ç¬¬ä¸€æ¬¡è¿›å…¥å®¶åº­çš„æ—¶å€™ç™»å½•å§ã€‚ç„¶åå¦‚æœæƒ³æœå¯»æœ‰é—®é¢˜çš„ç‹—ä¸»äººï¼Œéœ€è¦å·¥ä½œäººå‘˜å½“åœºæ‰«æç‹—é¼»å­ä»è€Œé‰´åˆ«ç‹—ä¸»äººï¼Ÿ</p>\n<p>å°±æˆ‘çš„è¯è¿˜æ˜¯å¸Œæœ›èƒ½å¾—åˆ°éšåœ°å¤§å°ä¾¿çš„ç‹—ç‹—çš„ä¸»äººä¿¡æ¯ï¼Œæ¯•ç«Ÿå®¶é—¨å£è½ä¸‹çš„ä¾¿ä¾¿ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>\n<blockquote><p>æœ¬æ–‡è¯‘è‡ª</p>\n<footer><strong>ä¸­å·çœŸçŸ¥å­</strong><cite><a href=\"https://www.gizmodo.jp/2019/07/ai-start-up-dog-nose.html\" target=\"_blank\" rel=\"noopener\">ä¸­å›½ã®AIã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãŒè¿·ã„çŠ¬ã‚’é¼»ã®æŒ‡ç´‹ï¼ˆï¼Ÿï¼‰ã‚’ä½¿ã£ã¦æœç´¢ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’é–‹ç™º</a></cite></footer></blockquote>"},{"title":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°2","date":"2019-09-10T13:47:52.000Z","_content":"\n## å®ç°cp/classpath å‚æ•°æœç´¢classæ–‡ä»¶\n\n### java class path æœç´¢é¡ºåºï¼š\n1. å¯åŠ¨ç±»è·¯å¾„ï¼ˆbootstrap classpathï¼‰:jre\\lib ï¼ˆå¯é€šè¿‡-Xbootclasspathå‚æ•°ä¿®æ”¹è¯¥è·¯å¾„ï¼‰\n2. æ‰©å±•ç±»è·¯å¾„ï¼ˆextension classpathï¼‰:jre\\lib\\ext\n3. ç”¨æˆ·ç±»è·¯å¾„ï¼ˆuser classpathï¼‰:ç”¨æˆ·è‡ªå·±æŒ‡å®š\n\n<!-- more -->\n\n### å®ç°\n1. Entryæ¥å£ç”¨æ¥å®šä¹‰å¯åŠ¨ç±»çš„åŸºæœ¬åŠŸèƒ½\n\n{% codeblock lang:go %}\nconst pathListSeparator = string(os.PathListSeparator) //è·å–å½“å‰æ“ä½œç³»ç»Ÿåˆ†éš”ç¬¦\n\ntype Entry interface {\n\treadClass(classNme string) ([]byte,Entry,error) //å®šä¹‰æŒ‰classåè¯»å–classæ–‡ä»¶çš„æ–¹\n\tString() string \n}\n\n//æ ¹æ®classpathç”Ÿæˆå¯¹åº”çš„å¯åŠ¨ç±»\nfunc newEntry(path string) Entry {\n\tif strings.Contains(path,pathListSeparator){ //classpathè·¯å¾„åŒ…å«ç³»ç»Ÿåˆ†å‰²ç¬¦æ—¶ï¼Œnewç»„åˆå¯åŠ¨ç±»\n\t\treturn newCompositeEntry(path)\n\t}\n\n\tif strings.HasSuffix(path,\"*\") {\n\t\treturn newWildcardEntry(path) //classpathè·¯å¾„åŒ…å«*æ—¶ï¼Œnewé€šé…ç¬¦å¯åŠ¨ç±»\n\t}\n\n\tif strings.HasSuffix(path, \".jar\") || strings.HasSuffix(path, \".JAR\") ||\n      strings.HasSuffix(path, \".zip\") || strings.HasSuffix(path, \".ZIP\") {\n      return newZipEntry(path) //classpathè·¯å¾„åŒ…å«jarã€JARã€zipã€ZIPæ—¶ï¼Œnewæ–‡ä»¶å¤¹å¯åŠ¨ç±»\n   }\n\treturn newDirEntry(path)\n\n}\n{% endcodeblock %}\n\n2. Entryæ¥å£çš„å…·ä½“å®ç°\n * DirEntryï¼ŒæŒ‰ç…§æ–‡ä»¶è·¯å¾„è¯»å–æ–‡ä»¶äºŒè¿›åˆ¶æµ \n{% codeblock lang:golang %}\ntype DirEntry struct {\n\tabsDir string //å­˜å‚¨æ–‡ä»¶å¤¹è·¯å¾„\n}\n\nfunc newDirEntry(path string) *DirEntry {\n\tabsDir,err := filepath.Abs(path) //å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„\n\tif err != nil {\n\t\tpanic(err) //æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨æ—¶æç¤ºé”™è¯¯\n\t}\n\n\treturn &DirEntry{absDir} //è¿”å›DirEntryå®ä¾‹\n}\n\nfunc (self *DirEntry) readClass(className string) ([]byte,Entry,error){\n\tfileName := filepath.Join(self.absDir,className) //æ‹¼æ¥æ–‡ä»¶å¤¹è·¯å¾„å’Œclassname\n\tdata,err := ioutil.ReadFile(fileName) //è¯»å–æ–‡ä»¶\n\treturn data,self,err //è¿”å›æ–‡ä»¶å†…å®¹\n}\n\nfunc(self *DirEntry) String() string {\n\treturn self.absDir //è¿”å›æ–‡ä»¶å¤¹è·¯å¾„\n}\n{% endcodeblock %}\n\n * ZipEntry,è¯»å–å‹ç¼©æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶\n{% codeblock lang:golang %}\ntype ZipEnty struct {\n\tabsPath string //æ–‡ä»¶å¤¹è·¯å¾„\n}\n\nfunc newZipEntry(path string) *ZipEnty {\n\tabsPath, err := filepath.Abs(path) //å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn &ZipEnty{absPath}\n}\n\nfunc (self *ZipEnty) readClass(className string) ([]byte,Entry,error){\n\tr, err := zip.OpenReader(self.absPath) //ä»¥å‹ç¼©æ–‡ä»¶æ ¼å¼è§£å‹\n\tif err != nil {\n\t   return nil, nil, err\n\t}\n\tdefer r.Close() //æœ€åå…³é—­æ–‡ä»¶æµ\n\tfor _, f := range r.File { //å¾ªç¯è§£å‹å‡ºæ¥çš„æ–‡ä»¶\n\t   if f.Name == className { //å¦‚æœå½“å‰æ–‡ä»¶ä¸ºæŒ‡å®šæ–‡ä»¶\n\t\t  rc, err := f.Open() //æ‰“å¼€è¯¥æ–‡ä»¶\n\t\t  if err != nil {\n\t\t\t return nil, nil, err\n\t\t  }\n\t\t  defer rc.Close() //æœ€åå…³é—­æ–‡ä»¶\n\t\t  data, err := ioutil.ReadAll(rc) //è¯»å–æ–‡ä»¶æµ\n\t\t  if err != nil {\n\t\t\t return nil, nil, err\n\t\t  }\n\t\t  return data, self, nil //è¿”å›æ–‡ä»¶æµ\n\t   }\n\t}\n\treturn nil, nil, errors.New(\"class not found: \" + className)\n}\n\nfunc (self *ZipEnty) String() string {\n\treturn self.absPath\n}\n{% endcodeblock %}\n\n * CompositeEntry,è¯»å–ç¬¦åˆæ–‡ä»¶ç±»å‹\n{% codeblock lang:golang %}\ntype CompositeEntry []Entry //CompositeEntryä¸ºå¤šç§Entryçš„æ•°ç»„ï¼ˆDirã€Zipï¼‰\n\nfunc newCompositeEntry(pathList string) CompositeEntry {\n\tcompositeEntry := []Entry{} //å®ä¾‹Entryæ¥å£æ•°ç»„\n\n\tfor _,path := range strings.Split(pathList,pathListSeparator){ //æŒ‰ç…§ç³»ç»Ÿåˆ†å‰²ç¬¦æˆªå–pathåˆ—è¡¨ï¼Œå¹¶å¾ªç¯\n\t\tentry := newEntry(path) //æŒ‰ç…§æ¯ç§pathå®ä¾‹åŒ–ä¸åŒçš„Entry(Dirã€Zipã€Wildcard)\n\t\tcompositeEntry = append(compositeEntry,entry) //å°†å®ä¾‹åŒ–çš„ä¸åŒEntryæ”¾å…¥CompositeEntryæ•°ç»„ä¸­\n\t}\n\treturn compositeEntry\n}\n\nfunc (self CompositeEntry) readClass(className string)([]byte,Entry,error){\n\tfor _, entry := range self { //å¾ªç¯compositeEntryæ•°ç»„\n\t\tdata, from, err := entry.readClass(className) //æ ¹æ®ä¸åŒEntry(Dirã€Zipã€Wildcard)ï¼ŒæŒ‰æŒ‡å®šclassnameè¯»å–æ–‡ä»¶\n\t\tif err == nil {\n\t\t   return data, from, nil //è¿”å›è¯»å–ç»“æœ\n\t\t}\n\t }\n\t return nil, nil, errors.New(\"class not found: \" + className) //æ— ç»“æœæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯\n}\n\nfunc (self CompositeEntry) String() string {\n\tstrs := make([]string, len(self)) //æŒ‰ç…§CompositeEntryçš„é•¿åº¦ç”³æ˜è¯¥é•¿åº¦çš„Sringæ•°ç»„\n\tfor i, entry := range self { //å¾ªç¯CompositeEntry\n\t   strs[i] = entry.String() //è°ƒç”¨æ¯ä¸ªEntry(Dirã€Zipã€Wildcard)å®ç°ç±»çš„String()æ–¹æ³•,å¹¶æ”¾å…¥Stringæ•°ç»„ä¸­\n\t}\n\treturn strings.Join(strs, pathListSeparator) //å°†Stringæ•°ç»„ä¸­çš„ç»“æœä»¥ç³»ç»Ÿåˆ†éš”ç¬¦æ‹¼æ¥å¹¶è¿”å›\n}\n{% endcodeblock %}\n\n * WildcardEntryï¼ŒæŒ‰ç…§é€šé…ç¬¦è§£ææ–‡ä»¶\n{% codeblock lang:golang %}\nfunc newWildcardEntry(path string) CompositeEntry {\n\tbaseDir := path[:len(path)-1] // remove *\n\tcompositeEntry := []Entry{} //ç”³æ˜compositeEntryå¯¹è±¡(Entryçš„æ•°ç»„)\n\twalkFn := func(path string, info os.FileInfo, err error) error {\n\t\tif err != nil {\n\t\t   return err\n\t\t}\n\t\tif info.IsDir() && path != baseDir { //å¦‚æœå½“å‰ç›®å½•æ˜¯æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ˜¯æ ¹ç›®å½•\n\t\t   return filepath.SkipDir //è¿”å›SkipDirçš„é”™è¯¯\n\t\t}\n\t\tif strings.HasSuffix(path, \".jar\") || strings.HasSuffix(path, \".JAR\") { //å¦‚æœå½“å‰è·¯å¾„æ˜¯ä»¥.jaræˆ–.JARç»“å°¾çš„\n\t\t\tjarEntry := newZipEntry(path) //å®ä¾‹åŒ–ZipEntry\n\t\t\tcompositeEntry = append(compositeEntry, jarEntry) //å°†å®ä¾‹åŒ–çš„ZipEntryå¯¹è±¡æ”¾å…¥compositeEntryæ•°ç»„ä¸­\n\t\t }\n\t\t return nil\n\t  }\n\tfilepath.Walk(baseDir, walkFn) //å°†walkFnæ–¹æ³•ä¼ é€’ç»™filepath.Walk\n\treturn compositeEntry //è¿”å›ç»“æœ\n }\n{% endcodeblock %}\n\n* Classpathï¼Œ-cp|classpathå‚æ•°è§£æå®ç°çš„å…¥å£æ–¹æ³•\n{% codeblock lang:golang %}\ntype Classpath struct { //ClasspathåŒ…å«javaçš„ä¸‰ç§åŸºç¡€å¯åŠ¨è·¯å¾„\n\tbootClasspath Entry \n\textClasspath Entry\n\tuserClasspath Entry\n}\n\nfunc Parse(jreOption, cpOption string) * Classpath  {\n\tcp := &Classpath{} //å®ä¾‹åŒ–Classpathå¯¹è±¡\n\tcp.parseBootAndExtClasspath(jreOption) //æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„\n\tcp.parseUserClasspath(cpOption) //æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨è·¯å¾„\n\treturn cp //è¿”å›è®¾ç½®å¥½å¯åŠ¨è·¯å¾„çš„Classpathå¯¹è±¡\n}\n\nfunc (self *Classpath) ReadClass(className string) ([]byte,Entry,error){\n\tclassName = className + \".class\" //åˆå§‹åŒ–classNameæ–‡ä»¶å\n\tif data, entry, err := self.bootClasspath.readClass(className); err == nil { //å…ˆæ‰«æBootå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶\n\t   return data, entry, err //å­˜åœ¨åˆ™è¿”å›\n\t}\n\tif data, entry, err := self.extClasspath.readClass(className); err == nil { //å†æ‰«æExtå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶\n\t   return data, entry, err //å­˜åœ¨åˆ™è¿”å›\n\t}\n\treturn self.userClasspath.readClass(className) //ä»¥ä¸Šä¸¤ä¸ªè·¯å¾„ä¸‹éƒ½ä¸å­˜åœ¨ï¼Œåˆ™æ‰«æUserå¯åŠ¨è·¯å¾„\n}\n\nfunc (self *Classpath) String() string  {\n\treturn self.userClasspath.String()\n}\n\nfunc (self *Classpath) parseBootAndExtClasspath(jreOption string) { //æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„\n\tjreDir := getJreDir(jreOption) //è·å–jreè·¯å¾„\n   // jre/lib/*\n   jreLibPath := filepath.Join(jreDir, \"lib\", \"*\")\n   self.bootClasspath = newWildcardEntry(jreLibPath)\n   // jre/lib/ext/*\n   jreExtPath := filepath.Join(jreDir, \"lib\", \"ext\", \"*\")\n   self.extClasspath = newWildcardEntry(jreExtPath)\n}\n\nfunc getJreDir(jreOption string) string {\n\tif jreOption != \"\" && exists(jreOption) { //jreOptionä¸ä¸ºç©ºä¸”å­˜åœ¨æ—¶è¿”å›è¯¥è·¯å¾„\n\t   return jreOption\n\t}\n\tif exists(\"./jre\") { //./jreè·¯å¾„å­˜åœ¨æ—¶ï¼Œè¿”å›.jre\n\t   return \"./jre\"\n\t}\n\tif jh := os.Getenv(\"JAVA_HOME\"); jh != \"\" { //ç¯å¢ƒå˜é‡JAVA_HOMEå­˜åœ¨å¹¶ä¸”ä¸ä¸ºç©ºæ—¶\n\t   return filepath.Join(jh, \"jre\") //è¿”å›JAVA_HOME + \"jre\"\n\t}\n\tpanic(\"Can not find jre folder!\")\n }\n\n func exists(path string) bool {\n\tif _, err := os.Stat(path); err != nil {\n\t   if os.IsNotExist(err) {\n\t\t  return false\n\t   }\n\t}\n\treturn true\n }\n\n func (self *Classpath) parseUserClasspath(cpOption string) { //æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨å‚æ•°\n\tif cpOption == \"\" { //cpOptionä¸ºç©ºæ—¶\n\t   cpOption = \".\" //è¿”å›ç›¸å¯¹è·¯åŠ²\n\t}\n\tself.userClasspath = newEntry(cpOption) //æ ¹æ®-cp|classpathå‚æ•°å®ä¾‹åŒ–å¯¹åº”çš„Entry\n }\n{% endcodeblock %}\n\n * mainï¼Œä¿®æ”¹å¯åŠ¨ç±»\n{% codeblock lang:golang %}\nfunc startJVM(cmd *Cmd){\n\tcp := classpath.Parse(cmd.XjreOption, cmd.cpOption) //æ ¹æ®-Xjreå’Œ-cp|classpathå‚æ•°å®ä¾‹åŒ–classpathå¯¹è±¡å®ä¾‹\n\tfmt.Printf(\"classpath:%v class:%v args:%v\\n\",\n\t   cp, cmd.class, cmd.args)\n\tclassName := strings.Replace(cmd.class, \".\", \"/\", -1)\n\tclassData, _, err := cp.ReadClass(className) //æŒ‰ç…§3ä¸ªå¯åŠ¨è·¯å¾„æŸ¥æ‰¾å¹¶è¯»å–classNameæ–‡ä»¶\n\tif err != nil {\n\t   fmt.Printf(\"Could not find or load main class %s\\n\", cmd.class)\n\t   return\n\t}\n\tfmt.Printf(\"class data:%v\\n\", classData)\n}\n{% endcodeblock %}\n\n3. è¯•è¿è¡Œ\n{% codeblock lang:shell %}\nPS D:\\work\\workspace_go\\src\\jvmgo\\ch02> go install\n\nPS D:\\work\\workspace_go\\bin> .\\ch02.exe -Xjre \"C:\\Program Files\\Java\\jre1.8.0_202\" java.lang.Object\nclasspath:D:\\work\\workspace_go\\bin class:java.lang.Object args:[]\nclass data:[202 254 186 190 0 0 0 52 0 75 3 0 15 66 63 8 0 16 8 0 36 8 0 40 1 0 3 40 41 73 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 3 40 41 86 1 0 21 40 73 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 4 40 74 41 86 1 0 5 40 74 73 41 86 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 41 90 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 86 1 0 8 60 99 108 105 110 105 116 62 1 0 6 60 105 110 105 116 62 1 0 1 64 1 0 4 67 111 100\n101 1 0 10 69 120 99 101 112 116 105 111 110 115 1 0 9 83 105 103 110 97 116 117 114 101 1 0 13 83 116 97 99 107 77 97 112 84 97 98 108 101 1 0 6 97 112 112 101 110 100 1 0 5 99 108 111 110 101 1 0 6 101 113\n117 97 108 115 1 0 8 102 105 110 97 108 105 122 101 1 0 8 103 101 116 67 108 97 115 115 1 0 7 103 101 116 78 97 109 101 1 0 8 104 97 115 104 67 111 100 101 1 0 15 106 97 118 97 47 108 97 110 103 47 67 108 97\n115 115 1 0 36 106 97 118 97 47 108 97 110 103 47 67 108 111 110 101 78 111 116 83 117 112 112 111 114 116 101 100 69 120 99 101 112 116 105 111 110 1 0 34 106 97 118 97 47 108 97 110 103 47 73 108 108 101 103 97 108 65 114 103 117 109 101 110 116 69 120 99 101 112 116 105 111 110 1 0 17 106 97 118 97 47 108 97 110 103 47 73 110 116 101 103 101 114 1 0 30 106 97 118 97 47 108 97 110 103 47 73 110 116 101 114 114\n117 112 116 101 100 69 120 99 101 112 116 105 111 110 1 0 16 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 1 0 23 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 1 0 19 106 97 118 97 47 108 97 110 103 47 84 104 114 111 119 97 98 108 101 1 0 37 110 97 110 111 115 101 99 111 110 100 32 116 105 109 101 111 117 116 32 118 97 108 117 101 32 111 117 116 32 111 102 32 114 97 110 103 101 1 0 6 110 111 116 105 102 121 1 0 9 110 111 116 105 102 121 65 108 108 1 0 15 114 101 103 105 115 116 101 114 78 97 116 105 118 101 115 1 0 25 116 105 109 101 111 117 116 32 118 97 108 117 101 32 105 115 32 110 101 103 97 116 105 118 101 1 0 11 116 111 72 101 120 83 116 114 105 110 103 1 0 8 116 111 83 116 114 105 110 103 1 0 4 119 97 105 116 7 0 28 7 0 29 7 0 30 7 0 31 7 0 32 7 0 33 7 0 34 7 0 35 1 0 19 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 59 1 0 22 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 60 42 62 59 1 0 45 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 59 12 0 27 0 5 12 0 15 0 8 12 0 39 0 8 12 0 43 0 10 12 0 25 0 52 12 0 26 0 7 12 0 42 0 7 12 0 41 0\n9 12 0 15 0 13 12 0 21 0 54 10 0 44 0 60 10 0 46 0 63 10 0 47 0 62 10 0 49 0 55 10 0 49 0 57 10 0 49 0 58 10 0 49 0 59 10 0 50 0 56 10 0 50 0 61 10 0 50 0 64 0 33 0 49 0 0 0 0 0 0 0 14 0 1 0 15 0 8 0 1 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 1 10 0 39 0 8 0 0 1 17 0 25 0 52 0 1 0 19 0 0 0 2 0 53 1 1 0 27 0 5 0 0 0 1 0 23 0 12 0 1 0 17 0 0 0 34 0 2 0 2 0 0 0 11 42 43 166 0 7 4 167 0 4 3 172 0 0 0 1 0 20 0 0 0 5\n0 2 9 64 1 1 4 0 22 0 6 0 1 0 18 0 0 0 4 0 1 0 45 0 1 0 42 0 7 0 1 0 17 0 0 0 48 0 2 0 1 0 0 0 36 187 0 50 89 183 0 72 42 182 0 71 182 0 65 182 0 74 18 2 182 0 74 42 182 0 68 184 0 67 182 0 74 182 0 73 176 0\n0 0 0 1 17 0 37 0 8 0 0 1 17 0 38 0 8 0 0 1 17 0 43 0 10 0 1 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 11 0 2 0 17 0 0 0 74 0 4 0 4 0 0 0 50 31 9 148 156 0 13 187 0 46 89 18 4 183 0 66 191 29 155 0 9 29 18 1 164 0 13 187 0 46 89 18 3 183 0 66 191 29 158 0 7 31 10 97 64 42 31 182 0 70 177 0 0 0 1 0 20 0 0 0 6 0 4 16 9 9 7 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 8 0 2 0 17 0 0 0 18 0 3 0 1 0 0 0 6 42 9 182 0 70 177 0 0 0 0 0 18\n0 0 0 4 0 1 0 48 0 4 0 24 0 8 0 2 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 0 18 0 0 0 4 0 1 0 51 0 8 0 14 0 8 0 1 0 17 0 0 0 16 0 0 0 0 0 0 0 4 184 0 69 177 0 0 0 0 0 0]\n{% endcodeblock %}\n","source":"_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°2.md","raw":"---\ntitle: è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°2\ndate: 2019-09-10 21:47:52\ntags: \n    - JVM\n    - Java\n    - Go\ncategories :\n    - Technology\n---\n\n## å®ç°cp/classpath å‚æ•°æœç´¢classæ–‡ä»¶\n\n### java class path æœç´¢é¡ºåºï¼š\n1. å¯åŠ¨ç±»è·¯å¾„ï¼ˆbootstrap classpathï¼‰:jre\\lib ï¼ˆå¯é€šè¿‡-Xbootclasspathå‚æ•°ä¿®æ”¹è¯¥è·¯å¾„ï¼‰\n2. æ‰©å±•ç±»è·¯å¾„ï¼ˆextension classpathï¼‰:jre\\lib\\ext\n3. ç”¨æˆ·ç±»è·¯å¾„ï¼ˆuser classpathï¼‰:ç”¨æˆ·è‡ªå·±æŒ‡å®š\n\n<!-- more -->\n\n### å®ç°\n1. Entryæ¥å£ç”¨æ¥å®šä¹‰å¯åŠ¨ç±»çš„åŸºæœ¬åŠŸèƒ½\n\n{% codeblock lang:go %}\nconst pathListSeparator = string(os.PathListSeparator) //è·å–å½“å‰æ“ä½œç³»ç»Ÿåˆ†éš”ç¬¦\n\ntype Entry interface {\n\treadClass(classNme string) ([]byte,Entry,error) //å®šä¹‰æŒ‰classåè¯»å–classæ–‡ä»¶çš„æ–¹\n\tString() string \n}\n\n//æ ¹æ®classpathç”Ÿæˆå¯¹åº”çš„å¯åŠ¨ç±»\nfunc newEntry(path string) Entry {\n\tif strings.Contains(path,pathListSeparator){ //classpathè·¯å¾„åŒ…å«ç³»ç»Ÿåˆ†å‰²ç¬¦æ—¶ï¼Œnewç»„åˆå¯åŠ¨ç±»\n\t\treturn newCompositeEntry(path)\n\t}\n\n\tif strings.HasSuffix(path,\"*\") {\n\t\treturn newWildcardEntry(path) //classpathè·¯å¾„åŒ…å«*æ—¶ï¼Œnewé€šé…ç¬¦å¯åŠ¨ç±»\n\t}\n\n\tif strings.HasSuffix(path, \".jar\") || strings.HasSuffix(path, \".JAR\") ||\n      strings.HasSuffix(path, \".zip\") || strings.HasSuffix(path, \".ZIP\") {\n      return newZipEntry(path) //classpathè·¯å¾„åŒ…å«jarã€JARã€zipã€ZIPæ—¶ï¼Œnewæ–‡ä»¶å¤¹å¯åŠ¨ç±»\n   }\n\treturn newDirEntry(path)\n\n}\n{% endcodeblock %}\n\n2. Entryæ¥å£çš„å…·ä½“å®ç°\n * DirEntryï¼ŒæŒ‰ç…§æ–‡ä»¶è·¯å¾„è¯»å–æ–‡ä»¶äºŒè¿›åˆ¶æµ \n{% codeblock lang:golang %}\ntype DirEntry struct {\n\tabsDir string //å­˜å‚¨æ–‡ä»¶å¤¹è·¯å¾„\n}\n\nfunc newDirEntry(path string) *DirEntry {\n\tabsDir,err := filepath.Abs(path) //å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„\n\tif err != nil {\n\t\tpanic(err) //æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨æ—¶æç¤ºé”™è¯¯\n\t}\n\n\treturn &DirEntry{absDir} //è¿”å›DirEntryå®ä¾‹\n}\n\nfunc (self *DirEntry) readClass(className string) ([]byte,Entry,error){\n\tfileName := filepath.Join(self.absDir,className) //æ‹¼æ¥æ–‡ä»¶å¤¹è·¯å¾„å’Œclassname\n\tdata,err := ioutil.ReadFile(fileName) //è¯»å–æ–‡ä»¶\n\treturn data,self,err //è¿”å›æ–‡ä»¶å†…å®¹\n}\n\nfunc(self *DirEntry) String() string {\n\treturn self.absDir //è¿”å›æ–‡ä»¶å¤¹è·¯å¾„\n}\n{% endcodeblock %}\n\n * ZipEntry,è¯»å–å‹ç¼©æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶\n{% codeblock lang:golang %}\ntype ZipEnty struct {\n\tabsPath string //æ–‡ä»¶å¤¹è·¯å¾„\n}\n\nfunc newZipEntry(path string) *ZipEnty {\n\tabsPath, err := filepath.Abs(path) //å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn &ZipEnty{absPath}\n}\n\nfunc (self *ZipEnty) readClass(className string) ([]byte,Entry,error){\n\tr, err := zip.OpenReader(self.absPath) //ä»¥å‹ç¼©æ–‡ä»¶æ ¼å¼è§£å‹\n\tif err != nil {\n\t   return nil, nil, err\n\t}\n\tdefer r.Close() //æœ€åå…³é—­æ–‡ä»¶æµ\n\tfor _, f := range r.File { //å¾ªç¯è§£å‹å‡ºæ¥çš„æ–‡ä»¶\n\t   if f.Name == className { //å¦‚æœå½“å‰æ–‡ä»¶ä¸ºæŒ‡å®šæ–‡ä»¶\n\t\t  rc, err := f.Open() //æ‰“å¼€è¯¥æ–‡ä»¶\n\t\t  if err != nil {\n\t\t\t return nil, nil, err\n\t\t  }\n\t\t  defer rc.Close() //æœ€åå…³é—­æ–‡ä»¶\n\t\t  data, err := ioutil.ReadAll(rc) //è¯»å–æ–‡ä»¶æµ\n\t\t  if err != nil {\n\t\t\t return nil, nil, err\n\t\t  }\n\t\t  return data, self, nil //è¿”å›æ–‡ä»¶æµ\n\t   }\n\t}\n\treturn nil, nil, errors.New(\"class not found: \" + className)\n}\n\nfunc (self *ZipEnty) String() string {\n\treturn self.absPath\n}\n{% endcodeblock %}\n\n * CompositeEntry,è¯»å–ç¬¦åˆæ–‡ä»¶ç±»å‹\n{% codeblock lang:golang %}\ntype CompositeEntry []Entry //CompositeEntryä¸ºå¤šç§Entryçš„æ•°ç»„ï¼ˆDirã€Zipï¼‰\n\nfunc newCompositeEntry(pathList string) CompositeEntry {\n\tcompositeEntry := []Entry{} //å®ä¾‹Entryæ¥å£æ•°ç»„\n\n\tfor _,path := range strings.Split(pathList,pathListSeparator){ //æŒ‰ç…§ç³»ç»Ÿåˆ†å‰²ç¬¦æˆªå–pathåˆ—è¡¨ï¼Œå¹¶å¾ªç¯\n\t\tentry := newEntry(path) //æŒ‰ç…§æ¯ç§pathå®ä¾‹åŒ–ä¸åŒçš„Entry(Dirã€Zipã€Wildcard)\n\t\tcompositeEntry = append(compositeEntry,entry) //å°†å®ä¾‹åŒ–çš„ä¸åŒEntryæ”¾å…¥CompositeEntryæ•°ç»„ä¸­\n\t}\n\treturn compositeEntry\n}\n\nfunc (self CompositeEntry) readClass(className string)([]byte,Entry,error){\n\tfor _, entry := range self { //å¾ªç¯compositeEntryæ•°ç»„\n\t\tdata, from, err := entry.readClass(className) //æ ¹æ®ä¸åŒEntry(Dirã€Zipã€Wildcard)ï¼ŒæŒ‰æŒ‡å®šclassnameè¯»å–æ–‡ä»¶\n\t\tif err == nil {\n\t\t   return data, from, nil //è¿”å›è¯»å–ç»“æœ\n\t\t}\n\t }\n\t return nil, nil, errors.New(\"class not found: \" + className) //æ— ç»“æœæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯\n}\n\nfunc (self CompositeEntry) String() string {\n\tstrs := make([]string, len(self)) //æŒ‰ç…§CompositeEntryçš„é•¿åº¦ç”³æ˜è¯¥é•¿åº¦çš„Sringæ•°ç»„\n\tfor i, entry := range self { //å¾ªç¯CompositeEntry\n\t   strs[i] = entry.String() //è°ƒç”¨æ¯ä¸ªEntry(Dirã€Zipã€Wildcard)å®ç°ç±»çš„String()æ–¹æ³•,å¹¶æ”¾å…¥Stringæ•°ç»„ä¸­\n\t}\n\treturn strings.Join(strs, pathListSeparator) //å°†Stringæ•°ç»„ä¸­çš„ç»“æœä»¥ç³»ç»Ÿåˆ†éš”ç¬¦æ‹¼æ¥å¹¶è¿”å›\n}\n{% endcodeblock %}\n\n * WildcardEntryï¼ŒæŒ‰ç…§é€šé…ç¬¦è§£ææ–‡ä»¶\n{% codeblock lang:golang %}\nfunc newWildcardEntry(path string) CompositeEntry {\n\tbaseDir := path[:len(path)-1] // remove *\n\tcompositeEntry := []Entry{} //ç”³æ˜compositeEntryå¯¹è±¡(Entryçš„æ•°ç»„)\n\twalkFn := func(path string, info os.FileInfo, err error) error {\n\t\tif err != nil {\n\t\t   return err\n\t\t}\n\t\tif info.IsDir() && path != baseDir { //å¦‚æœå½“å‰ç›®å½•æ˜¯æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ˜¯æ ¹ç›®å½•\n\t\t   return filepath.SkipDir //è¿”å›SkipDirçš„é”™è¯¯\n\t\t}\n\t\tif strings.HasSuffix(path, \".jar\") || strings.HasSuffix(path, \".JAR\") { //å¦‚æœå½“å‰è·¯å¾„æ˜¯ä»¥.jaræˆ–.JARç»“å°¾çš„\n\t\t\tjarEntry := newZipEntry(path) //å®ä¾‹åŒ–ZipEntry\n\t\t\tcompositeEntry = append(compositeEntry, jarEntry) //å°†å®ä¾‹åŒ–çš„ZipEntryå¯¹è±¡æ”¾å…¥compositeEntryæ•°ç»„ä¸­\n\t\t }\n\t\t return nil\n\t  }\n\tfilepath.Walk(baseDir, walkFn) //å°†walkFnæ–¹æ³•ä¼ é€’ç»™filepath.Walk\n\treturn compositeEntry //è¿”å›ç»“æœ\n }\n{% endcodeblock %}\n\n* Classpathï¼Œ-cp|classpathå‚æ•°è§£æå®ç°çš„å…¥å£æ–¹æ³•\n{% codeblock lang:golang %}\ntype Classpath struct { //ClasspathåŒ…å«javaçš„ä¸‰ç§åŸºç¡€å¯åŠ¨è·¯å¾„\n\tbootClasspath Entry \n\textClasspath Entry\n\tuserClasspath Entry\n}\n\nfunc Parse(jreOption, cpOption string) * Classpath  {\n\tcp := &Classpath{} //å®ä¾‹åŒ–Classpathå¯¹è±¡\n\tcp.parseBootAndExtClasspath(jreOption) //æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„\n\tcp.parseUserClasspath(cpOption) //æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨è·¯å¾„\n\treturn cp //è¿”å›è®¾ç½®å¥½å¯åŠ¨è·¯å¾„çš„Classpathå¯¹è±¡\n}\n\nfunc (self *Classpath) ReadClass(className string) ([]byte,Entry,error){\n\tclassName = className + \".class\" //åˆå§‹åŒ–classNameæ–‡ä»¶å\n\tif data, entry, err := self.bootClasspath.readClass(className); err == nil { //å…ˆæ‰«æBootå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶\n\t   return data, entry, err //å­˜åœ¨åˆ™è¿”å›\n\t}\n\tif data, entry, err := self.extClasspath.readClass(className); err == nil { //å†æ‰«æExtå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶\n\t   return data, entry, err //å­˜åœ¨åˆ™è¿”å›\n\t}\n\treturn self.userClasspath.readClass(className) //ä»¥ä¸Šä¸¤ä¸ªè·¯å¾„ä¸‹éƒ½ä¸å­˜åœ¨ï¼Œåˆ™æ‰«æUserå¯åŠ¨è·¯å¾„\n}\n\nfunc (self *Classpath) String() string  {\n\treturn self.userClasspath.String()\n}\n\nfunc (self *Classpath) parseBootAndExtClasspath(jreOption string) { //æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„\n\tjreDir := getJreDir(jreOption) //è·å–jreè·¯å¾„\n   // jre/lib/*\n   jreLibPath := filepath.Join(jreDir, \"lib\", \"*\")\n   self.bootClasspath = newWildcardEntry(jreLibPath)\n   // jre/lib/ext/*\n   jreExtPath := filepath.Join(jreDir, \"lib\", \"ext\", \"*\")\n   self.extClasspath = newWildcardEntry(jreExtPath)\n}\n\nfunc getJreDir(jreOption string) string {\n\tif jreOption != \"\" && exists(jreOption) { //jreOptionä¸ä¸ºç©ºä¸”å­˜åœ¨æ—¶è¿”å›è¯¥è·¯å¾„\n\t   return jreOption\n\t}\n\tif exists(\"./jre\") { //./jreè·¯å¾„å­˜åœ¨æ—¶ï¼Œè¿”å›.jre\n\t   return \"./jre\"\n\t}\n\tif jh := os.Getenv(\"JAVA_HOME\"); jh != \"\" { //ç¯å¢ƒå˜é‡JAVA_HOMEå­˜åœ¨å¹¶ä¸”ä¸ä¸ºç©ºæ—¶\n\t   return filepath.Join(jh, \"jre\") //è¿”å›JAVA_HOME + \"jre\"\n\t}\n\tpanic(\"Can not find jre folder!\")\n }\n\n func exists(path string) bool {\n\tif _, err := os.Stat(path); err != nil {\n\t   if os.IsNotExist(err) {\n\t\t  return false\n\t   }\n\t}\n\treturn true\n }\n\n func (self *Classpath) parseUserClasspath(cpOption string) { //æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨å‚æ•°\n\tif cpOption == \"\" { //cpOptionä¸ºç©ºæ—¶\n\t   cpOption = \".\" //è¿”å›ç›¸å¯¹è·¯åŠ²\n\t}\n\tself.userClasspath = newEntry(cpOption) //æ ¹æ®-cp|classpathå‚æ•°å®ä¾‹åŒ–å¯¹åº”çš„Entry\n }\n{% endcodeblock %}\n\n * mainï¼Œä¿®æ”¹å¯åŠ¨ç±»\n{% codeblock lang:golang %}\nfunc startJVM(cmd *Cmd){\n\tcp := classpath.Parse(cmd.XjreOption, cmd.cpOption) //æ ¹æ®-Xjreå’Œ-cp|classpathå‚æ•°å®ä¾‹åŒ–classpathå¯¹è±¡å®ä¾‹\n\tfmt.Printf(\"classpath:%v class:%v args:%v\\n\",\n\t   cp, cmd.class, cmd.args)\n\tclassName := strings.Replace(cmd.class, \".\", \"/\", -1)\n\tclassData, _, err := cp.ReadClass(className) //æŒ‰ç…§3ä¸ªå¯åŠ¨è·¯å¾„æŸ¥æ‰¾å¹¶è¯»å–classNameæ–‡ä»¶\n\tif err != nil {\n\t   fmt.Printf(\"Could not find or load main class %s\\n\", cmd.class)\n\t   return\n\t}\n\tfmt.Printf(\"class data:%v\\n\", classData)\n}\n{% endcodeblock %}\n\n3. è¯•è¿è¡Œ\n{% codeblock lang:shell %}\nPS D:\\work\\workspace_go\\src\\jvmgo\\ch02> go install\n\nPS D:\\work\\workspace_go\\bin> .\\ch02.exe -Xjre \"C:\\Program Files\\Java\\jre1.8.0_202\" java.lang.Object\nclasspath:D:\\work\\workspace_go\\bin class:java.lang.Object args:[]\nclass data:[202 254 186 190 0 0 0 52 0 75 3 0 15 66 63 8 0 16 8 0 36 8 0 40 1 0 3 40 41 73 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 3 40 41 86 1 0 21 40 73 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 4 40 74 41 86 1 0 5 40 74 73 41 86 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 41 90 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 86 1 0 8 60 99 108 105 110 105 116 62 1 0 6 60 105 110 105 116 62 1 0 1 64 1 0 4 67 111 100\n101 1 0 10 69 120 99 101 112 116 105 111 110 115 1 0 9 83 105 103 110 97 116 117 114 101 1 0 13 83 116 97 99 107 77 97 112 84 97 98 108 101 1 0 6 97 112 112 101 110 100 1 0 5 99 108 111 110 101 1 0 6 101 113\n117 97 108 115 1 0 8 102 105 110 97 108 105 122 101 1 0 8 103 101 116 67 108 97 115 115 1 0 7 103 101 116 78 97 109 101 1 0 8 104 97 115 104 67 111 100 101 1 0 15 106 97 118 97 47 108 97 110 103 47 67 108 97\n115 115 1 0 36 106 97 118 97 47 108 97 110 103 47 67 108 111 110 101 78 111 116 83 117 112 112 111 114 116 101 100 69 120 99 101 112 116 105 111 110 1 0 34 106 97 118 97 47 108 97 110 103 47 73 108 108 101 103 97 108 65 114 103 117 109 101 110 116 69 120 99 101 112 116 105 111 110 1 0 17 106 97 118 97 47 108 97 110 103 47 73 110 116 101 103 101 114 1 0 30 106 97 118 97 47 108 97 110 103 47 73 110 116 101 114 114\n117 112 116 101 100 69 120 99 101 112 116 105 111 110 1 0 16 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 1 0 23 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 1 0 19 106 97 118 97 47 108 97 110 103 47 84 104 114 111 119 97 98 108 101 1 0 37 110 97 110 111 115 101 99 111 110 100 32 116 105 109 101 111 117 116 32 118 97 108 117 101 32 111 117 116 32 111 102 32 114 97 110 103 101 1 0 6 110 111 116 105 102 121 1 0 9 110 111 116 105 102 121 65 108 108 1 0 15 114 101 103 105 115 116 101 114 78 97 116 105 118 101 115 1 0 25 116 105 109 101 111 117 116 32 118 97 108 117 101 32 105 115 32 110 101 103 97 116 105 118 101 1 0 11 116 111 72 101 120 83 116 114 105 110 103 1 0 8 116 111 83 116 114 105 110 103 1 0 4 119 97 105 116 7 0 28 7 0 29 7 0 30 7 0 31 7 0 32 7 0 33 7 0 34 7 0 35 1 0 19 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 59 1 0 22 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 60 42 62 59 1 0 45 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 59 12 0 27 0 5 12 0 15 0 8 12 0 39 0 8 12 0 43 0 10 12 0 25 0 52 12 0 26 0 7 12 0 42 0 7 12 0 41 0\n9 12 0 15 0 13 12 0 21 0 54 10 0 44 0 60 10 0 46 0 63 10 0 47 0 62 10 0 49 0 55 10 0 49 0 57 10 0 49 0 58 10 0 49 0 59 10 0 50 0 56 10 0 50 0 61 10 0 50 0 64 0 33 0 49 0 0 0 0 0 0 0 14 0 1 0 15 0 8 0 1 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 1 10 0 39 0 8 0 0 1 17 0 25 0 52 0 1 0 19 0 0 0 2 0 53 1 1 0 27 0 5 0 0 0 1 0 23 0 12 0 1 0 17 0 0 0 34 0 2 0 2 0 0 0 11 42 43 166 0 7 4 167 0 4 3 172 0 0 0 1 0 20 0 0 0 5\n0 2 9 64 1 1 4 0 22 0 6 0 1 0 18 0 0 0 4 0 1 0 45 0 1 0 42 0 7 0 1 0 17 0 0 0 48 0 2 0 1 0 0 0 36 187 0 50 89 183 0 72 42 182 0 71 182 0 65 182 0 74 18 2 182 0 74 42 182 0 68 184 0 67 182 0 74 182 0 73 176 0\n0 0 0 1 17 0 37 0 8 0 0 1 17 0 38 0 8 0 0 1 17 0 43 0 10 0 1 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 11 0 2 0 17 0 0 0 74 0 4 0 4 0 0 0 50 31 9 148 156 0 13 187 0 46 89 18 4 183 0 66 191 29 155 0 9 29 18 1 164 0 13 187 0 46 89 18 3 183 0 66 191 29 158 0 7 31 10 97 64 42 31 182 0 70 177 0 0 0 1 0 20 0 0 0 6 0 4 16 9 9 7 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 8 0 2 0 17 0 0 0 18 0 3 0 1 0 0 0 6 42 9 182 0 70 177 0 0 0 0 0 18\n0 0 0 4 0 1 0 48 0 4 0 24 0 8 0 2 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 0 18 0 0 0 4 0 1 0 51 0 8 0 14 0 8 0 1 0 17 0 0 0 16 0 0 0 0 0 0 0 4 184 0 69 177 0 0 0 0 0 0]\n{% endcodeblock %}\n","slug":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°2","published":1,"updated":"2019-09-13T08:46:55.468Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck10secrz001ojonym2t4kgv6","content":"<h2 id=\"å®ç°cp-classpath-å‚æ•°æœç´¢classæ–‡ä»¶\"><a href=\"#å®ç°cp-classpath-å‚æ•°æœç´¢classæ–‡ä»¶\" class=\"headerlink\" title=\"å®ç°cp/classpath å‚æ•°æœç´¢classæ–‡ä»¶\"></a>å®ç°cp/classpath å‚æ•°æœç´¢classæ–‡ä»¶</h2><h3 id=\"java-class-path-æœç´¢é¡ºåºï¼š\"><a href=\"#java-class-path-æœç´¢é¡ºåºï¼š\" class=\"headerlink\" title=\"java class path æœç´¢é¡ºåºï¼š\"></a>java class path æœç´¢é¡ºåºï¼š</h3><ol>\n<li>å¯åŠ¨ç±»è·¯å¾„ï¼ˆbootstrap classpathï¼‰:jre\\lib ï¼ˆå¯é€šè¿‡-Xbootclasspathå‚æ•°ä¿®æ”¹è¯¥è·¯å¾„ï¼‰</li>\n<li>æ‰©å±•ç±»è·¯å¾„ï¼ˆextension classpathï¼‰:jre\\lib\\ext</li>\n<li>ç”¨æˆ·ç±»è·¯å¾„ï¼ˆuser classpathï¼‰:ç”¨æˆ·è‡ªå·±æŒ‡å®š</li>\n</ol>\n<a id=\"more\"></a>\n\n<h3 id=\"å®ç°\"><a href=\"#å®ç°\" class=\"headerlink\" title=\"å®ç°\"></a>å®ç°</h3><ol>\n<li>Entryæ¥å£ç”¨æ¥å®šä¹‰å¯åŠ¨ç±»çš„åŸºæœ¬åŠŸèƒ½</li>\n</ol>\n<figure class=\"highlight go hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">const</span> pathListSeparator = <span class=\"hljs-keyword\">string</span>(os.PathListSeparator) <span class=\"hljs-comment\">//è·å–å½“å‰æ“ä½œç³»ç»Ÿåˆ†éš”ç¬¦</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">type</span> Entry <span class=\"hljs-keyword\">interface</span> &#123;</span><br><span class=\"line\">\treadClass(classNme <span class=\"hljs-keyword\">string</span>) ([]<span class=\"hljs-keyword\">byte</span>,Entry,error) <span class=\"hljs-comment\">//å®šä¹‰æŒ‰classåè¯»å–classæ–‡ä»¶çš„æ–¹</span></span><br><span class=\"line\">\tString() <span class=\"hljs-keyword\">string</span> </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//æ ¹æ®classpathç”Ÿæˆå¯¹åº”çš„å¯åŠ¨ç±»</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newEntry</span><span class=\"hljs-params\">(path <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-title\">Entry</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> strings.Contains(path,pathListSeparator)&#123; <span class=\"hljs-comment\">//classpathè·¯å¾„åŒ…å«ç³»ç»Ÿåˆ†å‰²ç¬¦æ—¶ï¼Œnewç»„åˆå¯åŠ¨ç±»</span></span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">return</span> newCompositeEntry(path)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> strings.HasSuffix(path,<span class=\"hljs-string\">\"*\"</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">return</span> newWildcardEntry(path) <span class=\"hljs-comment\">//classpathè·¯å¾„åŒ…å«*æ—¶ï¼Œnewé€šé…ç¬¦å¯åŠ¨ç±»</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> strings.HasSuffix(path, <span class=\"hljs-string\">\".jar\"</span>) || strings.HasSuffix(path, <span class=\"hljs-string\">\".JAR\"</span>) ||</span><br><span class=\"line\">      strings.HasSuffix(path, <span class=\"hljs-string\">\".zip\"</span>) || strings.HasSuffix(path, <span class=\"hljs-string\">\".ZIP\"</span>) &#123;</span><br><span class=\"line\">      <span class=\"hljs-keyword\">return</span> newZipEntry(path) <span class=\"hljs-comment\">//classpathè·¯å¾„åŒ…å«jarã€JARã€zipã€ZIPæ—¶ï¼Œnewæ–‡ä»¶å¤¹å¯åŠ¨ç±»</span></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> newDirEntry(path)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p>Entryæ¥å£çš„å…·ä½“å®ç°</p>\n<ul>\n<li><p>DirEntryï¼ŒæŒ‰ç…§æ–‡ä»¶è·¯å¾„è¯»å–æ–‡ä»¶äºŒè¿›åˆ¶æµ </p>\n<figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> DirEntry <span class=\"hljs-keyword\">struct</span> &#123;</span><br><span class=\"line\">\tabsDir <span class=\"hljs-keyword\">string</span> <span class=\"hljs-comment\">//å­˜å‚¨æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newDirEntry</span><span class=\"hljs-params\">(path <span class=\"hljs-keyword\">string</span>)</span> *<span class=\"hljs-title\">DirEntry</span></span> &#123;</span><br><span class=\"line\">\tabsDir,err := filepath.Abs(path) <span class=\"hljs-comment\">//å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"hljs-built_in\">panic</span>(err) <span class=\"hljs-comment\">//æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨æ—¶æç¤ºé”™è¯¯</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> &amp;DirEntry&#123;absDir&#125; <span class=\"hljs-comment\">//è¿”å›DirEntryå®ä¾‹</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *DirEntry)</span> <span class=\"hljs-title\">readClass</span><span class=\"hljs-params\">(className <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-params\">([]<span class=\"hljs-keyword\">byte</span>,Entry,error)</span></span>&#123;</span><br><span class=\"line\">\tfileName := filepath.Join(self.absDir,className) <span class=\"hljs-comment\">//æ‹¼æ¥æ–‡ä»¶å¤¹è·¯å¾„å’Œclassname</span></span><br><span class=\"line\">\tdata,err := ioutil.ReadFile(fileName) <span class=\"hljs-comment\">//è¯»å–æ–‡ä»¶</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> data,self,err <span class=\"hljs-comment\">//è¿”å›æ–‡ä»¶å†…å®¹</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span><span class=\"hljs-params\">(self *DirEntry)</span> <span class=\"hljs-title\">String</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.absDir <span class=\"hljs-comment\">//è¿”å›æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>ZipEntry,è¯»å–å‹ç¼©æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶</p>\n<figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> ZipEnty <span class=\"hljs-keyword\">struct</span> &#123;</span><br><span class=\"line\">\tabsPath <span class=\"hljs-keyword\">string</span> <span class=\"hljs-comment\">//æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newZipEntry</span><span class=\"hljs-params\">(path <span class=\"hljs-keyword\">string</span>)</span> *<span class=\"hljs-title\">ZipEnty</span></span> &#123;</span><br><span class=\"line\">\tabsPath, err := filepath.Abs(path) <span class=\"hljs-comment\">//å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"hljs-built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> &amp;ZipEnty&#123;absPath&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ZipEnty)</span> <span class=\"hljs-title\">readClass</span><span class=\"hljs-params\">(className <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-params\">([]<span class=\"hljs-keyword\">byte</span>,Entry,error)</span></span>&#123;</span><br><span class=\"line\">\tr, err := zip.OpenReader(self.absPath) <span class=\"hljs-comment\">//ä»¥å‹ç¼©æ–‡ä»¶æ ¼å¼è§£å‹</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> &#123;</span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span>, <span class=\"hljs-literal\">nil</span>, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">defer</span> r.Close() <span class=\"hljs-comment\">//æœ€åå…³é—­æ–‡ä»¶æµ</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> _, f := <span class=\"hljs-keyword\">range</span> r.File &#123; <span class=\"hljs-comment\">//å¾ªç¯è§£å‹å‡ºæ¥çš„æ–‡ä»¶</span></span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">if</span> f.Name == className &#123; <span class=\"hljs-comment\">//å¦‚æœå½“å‰æ–‡ä»¶ä¸ºæŒ‡å®šæ–‡ä»¶</span></span><br><span class=\"line\">\t\t  rc, err := f.Open() <span class=\"hljs-comment\">//æ‰“å¼€è¯¥æ–‡ä»¶</span></span><br><span class=\"line\">\t\t  <span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span>, <span class=\"hljs-literal\">nil</span>, err</span><br><span class=\"line\">\t\t  &#125;</span><br><span class=\"line\">\t\t  <span class=\"hljs-keyword\">defer</span> rc.Close() <span class=\"hljs-comment\">//æœ€åå…³é—­æ–‡ä»¶</span></span><br><span class=\"line\">\t\t  data, err := ioutil.ReadAll(rc) <span class=\"hljs-comment\">//è¯»å–æ–‡ä»¶æµ</span></span><br><span class=\"line\">\t\t  <span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span>, <span class=\"hljs-literal\">nil</span>, err</span><br><span class=\"line\">\t\t  &#125;</span><br><span class=\"line\">\t\t  <span class=\"hljs-keyword\">return</span> data, self, <span class=\"hljs-literal\">nil</span> <span class=\"hljs-comment\">//è¿”å›æ–‡ä»¶æµ</span></span><br><span class=\"line\">\t   &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span>, <span class=\"hljs-literal\">nil</span>, errors.New(<span class=\"hljs-string\">\"class not found: \"</span> + className)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ZipEnty)</span> <span class=\"hljs-title\">String</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.absPath</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>CompositeEntry,è¯»å–ç¬¦åˆæ–‡ä»¶ç±»å‹</p>\n<figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> CompositeEntry []Entry <span class=\"hljs-comment\">//CompositeEntryä¸ºå¤šç§Entryçš„æ•°ç»„ï¼ˆDirã€Zipï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newCompositeEntry</span><span class=\"hljs-params\">(pathList <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-title\">CompositeEntry</span></span> &#123;</span><br><span class=\"line\">\tcompositeEntry := []Entry&#123;&#125; <span class=\"hljs-comment\">//å®ä¾‹Entryæ¥å£æ•°ç»„</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> _,path := <span class=\"hljs-keyword\">range</span> strings.Split(pathList,pathListSeparator)&#123; <span class=\"hljs-comment\">//æŒ‰ç…§ç³»ç»Ÿåˆ†å‰²ç¬¦æˆªå–pathåˆ—è¡¨ï¼Œå¹¶å¾ªç¯</span></span><br><span class=\"line\">\t\tentry := newEntry(path) <span class=\"hljs-comment\">//æŒ‰ç…§æ¯ç§pathå®ä¾‹åŒ–ä¸åŒçš„Entry(Dirã€Zipã€Wildcard)</span></span><br><span class=\"line\">\t\tcompositeEntry = <span class=\"hljs-built_in\">append</span>(compositeEntry,entry) <span class=\"hljs-comment\">//å°†å®ä¾‹åŒ–çš„ä¸åŒEntryæ”¾å…¥CompositeEntryæ•°ç»„ä¸­</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> compositeEntry</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self CompositeEntry)</span> <span class=\"hljs-title\">readClass</span><span class=\"hljs-params\">(className <span class=\"hljs-keyword\">string</span>)</span><span class=\"hljs-params\">([]<span class=\"hljs-keyword\">byte</span>,Entry,error)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> _, entry := <span class=\"hljs-keyword\">range</span> self &#123; <span class=\"hljs-comment\">//å¾ªç¯compositeEntryæ•°ç»„</span></span><br><span class=\"line\">\t\tdata, from, err := entry.readClass(className) <span class=\"hljs-comment\">//æ ¹æ®ä¸åŒEntry(Dirã€Zipã€Wildcard)ï¼ŒæŒ‰æŒ‡å®šclassnameè¯»å–æ–‡ä»¶</span></span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> err == <span class=\"hljs-literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t   <span class=\"hljs-keyword\">return</span> data, from, <span class=\"hljs-literal\">nil</span> <span class=\"hljs-comment\">//è¿”å›è¯»å–ç»“æœ</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t &#125;</span><br><span class=\"line\">\t <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span>, <span class=\"hljs-literal\">nil</span>, errors.New(<span class=\"hljs-string\">\"class not found: \"</span> + className) <span class=\"hljs-comment\">//æ— ç»“æœæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self CompositeEntry)</span> <span class=\"hljs-title\">String</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> &#123;</span><br><span class=\"line\">\tstrs := <span class=\"hljs-built_in\">make</span>([]<span class=\"hljs-keyword\">string</span>, <span class=\"hljs-built_in\">len</span>(self)) <span class=\"hljs-comment\">//æŒ‰ç…§CompositeEntryçš„é•¿åº¦ç”³æ˜è¯¥é•¿åº¦çš„Sringæ•°ç»„</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> i, entry := <span class=\"hljs-keyword\">range</span> self &#123; <span class=\"hljs-comment\">//å¾ªç¯CompositeEntry</span></span><br><span class=\"line\">\t   strs[i] = entry.String() <span class=\"hljs-comment\">//è°ƒç”¨æ¯ä¸ªEntry(Dirã€Zipã€Wildcard)å®ç°ç±»çš„String()æ–¹æ³•,å¹¶æ”¾å…¥Stringæ•°ç»„ä¸­</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> strings.Join(strs, pathListSeparator) <span class=\"hljs-comment\">//å°†Stringæ•°ç»„ä¸­çš„ç»“æœä»¥ç³»ç»Ÿåˆ†éš”ç¬¦æ‹¼æ¥å¹¶è¿”å›</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>WildcardEntryï¼ŒæŒ‰ç…§é€šé…ç¬¦è§£ææ–‡ä»¶</p>\n<figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newWildcardEntry</span><span class=\"hljs-params\">(path <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-title\">CompositeEntry</span></span> &#123;</span><br><span class=\"line\">\tbaseDir := path[:<span class=\"hljs-built_in\">len</span>(path)<span class=\"hljs-number\">-1</span>] <span class=\"hljs-comment\">// remove *</span></span><br><span class=\"line\">\tcompositeEntry := []Entry&#123;&#125; <span class=\"hljs-comment\">//ç”³æ˜compositeEntryå¯¹è±¡(Entryçš„æ•°ç»„)</span></span><br><span class=\"line\">\twalkFn := <span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span><span class=\"hljs-params\">(path <span class=\"hljs-keyword\">string</span>, info os.FileInfo, err error)</span> <span class=\"hljs-title\">error</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t   <span class=\"hljs-keyword\">return</span> err</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> info.IsDir() &amp;&amp; path != baseDir &#123; <span class=\"hljs-comment\">//å¦‚æœå½“å‰ç›®å½•æ˜¯æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ˜¯æ ¹ç›®å½•</span></span><br><span class=\"line\">\t\t   <span class=\"hljs-keyword\">return</span> filepath.SkipDir <span class=\"hljs-comment\">//è¿”å›SkipDirçš„é”™è¯¯</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> strings.HasSuffix(path, <span class=\"hljs-string\">\".jar\"</span>) || strings.HasSuffix(path, <span class=\"hljs-string\">\".JAR\"</span>) &#123; <span class=\"hljs-comment\">//å¦‚æœå½“å‰è·¯å¾„æ˜¯ä»¥.jaræˆ–.JARç»“å°¾çš„</span></span><br><span class=\"line\">\t\t\tjarEntry := newZipEntry(path) <span class=\"hljs-comment\">//å®ä¾‹åŒ–ZipEntry</span></span><br><span class=\"line\">\t\t\tcompositeEntry = <span class=\"hljs-built_in\">append</span>(compositeEntry, jarEntry) <span class=\"hljs-comment\">//å°†å®ä¾‹åŒ–çš„ZipEntryå¯¹è±¡æ”¾å…¥compositeEntryæ•°ç»„ä¸­</span></span><br><span class=\"line\">\t\t &#125;</span><br><span class=\"line\">\t\t <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span></span><br><span class=\"line\">\t  &#125;</span><br><span class=\"line\">\tfilepath.Walk(baseDir, walkFn) <span class=\"hljs-comment\">//å°†walkFnæ–¹æ³•ä¼ é€’ç»™filepath.Walk</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> compositeEntry <span class=\"hljs-comment\">//è¿”å›ç»“æœ</span></span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ol>\n<ul>\n<li><p>Classpathï¼Œ-cp|classpathå‚æ•°è§£æå®ç°çš„å…¥å£æ–¹æ³•</p>\n<figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> Classpath <span class=\"hljs-keyword\">struct</span> &#123; <span class=\"hljs-comment\">//ClasspathåŒ…å«javaçš„ä¸‰ç§åŸºç¡€å¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">\tbootClasspath Entry </span><br><span class=\"line\">\textClasspath Entry</span><br><span class=\"line\">\tuserClasspath Entry</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">Parse</span><span class=\"hljs-params\">(jreOption, cpOption <span class=\"hljs-keyword\">string</span>)</span> * <span class=\"hljs-title\">Classpath</span></span>  &#123;</span><br><span class=\"line\">\tcp := &amp;Classpath&#123;&#125; <span class=\"hljs-comment\">//å®ä¾‹åŒ–Classpathå¯¹è±¡</span></span><br><span class=\"line\">\tcp.parseBootAndExtClasspath(jreOption) <span class=\"hljs-comment\">//æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">\tcp.parseUserClasspath(cpOption) <span class=\"hljs-comment\">//æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> cp <span class=\"hljs-comment\">//è¿”å›è®¾ç½®å¥½å¯åŠ¨è·¯å¾„çš„Classpathå¯¹è±¡</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Classpath)</span> <span class=\"hljs-title\">ReadClass</span><span class=\"hljs-params\">(className <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-params\">([]<span class=\"hljs-keyword\">byte</span>,Entry,error)</span></span>&#123;</span><br><span class=\"line\">\tclassName = className + <span class=\"hljs-string\">\".class\"</span> <span class=\"hljs-comment\">//åˆå§‹åŒ–classNameæ–‡ä»¶å</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> data, entry, err := self.bootClasspath.readClass(className); err == <span class=\"hljs-literal\">nil</span> &#123; <span class=\"hljs-comment\">//å…ˆæ‰«æBootå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶</span></span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span> data, entry, err <span class=\"hljs-comment\">//å­˜åœ¨åˆ™è¿”å›</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> data, entry, err := self.extClasspath.readClass(className); err == <span class=\"hljs-literal\">nil</span> &#123; <span class=\"hljs-comment\">//å†æ‰«æExtå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶</span></span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span> data, entry, err <span class=\"hljs-comment\">//å­˜åœ¨åˆ™è¿”å›</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.userClasspath.readClass(className) <span class=\"hljs-comment\">//ä»¥ä¸Šä¸¤ä¸ªè·¯å¾„ä¸‹éƒ½ä¸å­˜åœ¨ï¼Œåˆ™æ‰«æUserå¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Classpath)</span> <span class=\"hljs-title\">String</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span>  &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.userClasspath.String()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Classpath)</span> <span class=\"hljs-title\">parseBootAndExtClasspath</span><span class=\"hljs-params\">(jreOption <span class=\"hljs-keyword\">string</span>)</span></span> &#123; <span class=\"hljs-comment\">//æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">\tjreDir := getJreDir(jreOption) <span class=\"hljs-comment\">//è·å–jreè·¯å¾„</span></span><br><span class=\"line\">   <span class=\"hljs-comment\">// jre/lib/*</span></span><br><span class=\"line\">   jreLibPath := filepath.Join(jreDir, <span class=\"hljs-string\">\"lib\"</span>, <span class=\"hljs-string\">\"*\"</span>)</span><br><span class=\"line\">   self.bootClasspath = newWildcardEntry(jreLibPath)</span><br><span class=\"line\">   <span class=\"hljs-comment\">// jre/lib/ext/*</span></span><br><span class=\"line\">   jreExtPath := filepath.Join(jreDir, <span class=\"hljs-string\">\"lib\"</span>, <span class=\"hljs-string\">\"ext\"</span>, <span class=\"hljs-string\">\"*\"</span>)</span><br><span class=\"line\">   self.extClasspath = newWildcardEntry(jreExtPath)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">getJreDir</span><span class=\"hljs-params\">(jreOption <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> jreOption != <span class=\"hljs-string\">\"\"</span> &amp;&amp; exists(jreOption) &#123; <span class=\"hljs-comment\">//jreOptionä¸ä¸ºç©ºä¸”å­˜åœ¨æ—¶è¿”å›è¯¥è·¯å¾„</span></span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span> jreOption</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> exists(<span class=\"hljs-string\">\"./jre\"</span>) &#123; <span class=\"hljs-comment\">//./jreè·¯å¾„å­˜åœ¨æ—¶ï¼Œè¿”å›.jre</span></span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"./jre\"</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> jh := os.Getenv(<span class=\"hljs-string\">\"JAVA_HOME\"</span>); jh != <span class=\"hljs-string\">\"\"</span> &#123; <span class=\"hljs-comment\">//ç¯å¢ƒå˜é‡JAVA_HOMEå­˜åœ¨å¹¶ä¸”ä¸ä¸ºç©ºæ—¶</span></span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span> filepath.Join(jh, <span class=\"hljs-string\">\"jre\"</span>) <span class=\"hljs-comment\">//è¿”å›JAVA_HOME + \"jre\"</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-built_in\">panic</span>(<span class=\"hljs-string\">\"Can not find jre folder!\"</span>)</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">exists</span><span class=\"hljs-params\">(path <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> _, err := os.Stat(path); err != <span class=\"hljs-literal\">nil</span> &#123;</span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">if</span> os.IsNotExist(err) &#123;</span><br><span class=\"line\">\t\t  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span></span><br><span class=\"line\">\t   &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Classpath)</span> <span class=\"hljs-title\">parseUserClasspath</span><span class=\"hljs-params\">(cpOption <span class=\"hljs-keyword\">string</span>)</span></span> &#123; <span class=\"hljs-comment\">//æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨å‚æ•°</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> cpOption == <span class=\"hljs-string\">\"\"</span> &#123; <span class=\"hljs-comment\">//cpOptionä¸ºç©ºæ—¶</span></span><br><span class=\"line\">\t   cpOption = <span class=\"hljs-string\">\".\"</span> <span class=\"hljs-comment\">//è¿”å›ç›¸å¯¹è·¯åŠ²</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tself.userClasspath = newEntry(cpOption) <span class=\"hljs-comment\">//æ ¹æ®-cp|classpathå‚æ•°å®ä¾‹åŒ–å¯¹åº”çš„Entry</span></span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>mainï¼Œä¿®æ”¹å¯åŠ¨ç±»<figure class=\"highlight golang hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">startJVM</span><span class=\"hljs-params\">(cmd *Cmd)</span></span>&#123;</span><br><span class=\"line\">\tcp := classpath.Parse(cmd.XjreOption, cmd.cpOption) <span class=\"hljs-comment\">//æ ¹æ®-Xjreå’Œ-cp|classpathå‚æ•°å®ä¾‹åŒ–classpathå¯¹è±¡å®ä¾‹</span></span><br><span class=\"line\">\tfmt.Printf(<span class=\"hljs-string\">\"classpath:%v class:%v args:%v\\n\"</span>,</span><br><span class=\"line\">\t   cp, cmd.class, cmd.args)</span><br><span class=\"line\">\tclassName := strings.Replace(cmd.class, <span class=\"hljs-string\">\".\"</span>, <span class=\"hljs-string\">\"/\"</span>, <span class=\"hljs-number\">-1</span>)</span><br><span class=\"line\">\tclassData, _, err := cp.ReadClass(className) <span class=\"hljs-comment\">//æŒ‰ç…§3ä¸ªå¯åŠ¨è·¯å¾„æŸ¥æ‰¾å¹¶è¯»å–classNameæ–‡ä»¶</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> &#123;</span><br><span class=\"line\">\t   fmt.Printf(<span class=\"hljs-string\">\"Could not find or load main class %s\\n\"</span>, cmd.class)</span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"hljs-string\">\"class data:%v\\n\"</span>, classData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<ol start=\"3\">\n<li>è¯•è¿è¡Œ<figure class=\"highlight shell hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS D:\\work\\workspace_go\\src\\jvmgo\\ch02&gt; go install</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch02.exe -Xjre \"C:\\Program Files\\Java\\jre1.8.0_202\" java.lang.Object</span><br><span class=\"line\">classpath:D:\\work\\workspace_go\\bin class:java.lang.Object args:[]</span><br><span class=\"line\">class data:[202 254 186 190 0 0 0 52 0 75 3 0 15 66 63 8 0 16 8 0 36 8 0 40 1 0 3 40 41 73 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 3 40 41 86 1 0 21 40 73 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 4 40 74 41 86 1 0 5 40 74 73 41 86 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 41 90 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 86 1 0 8 60 99 108 105 110 105 116 62 1 0 6 60 105 110 105 116 62 1 0 1 64 1 0 4 67 111 100</span><br><span class=\"line\">101 1 0 10 69 120 99 101 112 116 105 111 110 115 1 0 9 83 105 103 110 97 116 117 114 101 1 0 13 83 116 97 99 107 77 97 112 84 97 98 108 101 1 0 6 97 112 112 101 110 100 1 0 5 99 108 111 110 101 1 0 6 101 113</span><br><span class=\"line\">117 97 108 115 1 0 8 102 105 110 97 108 105 122 101 1 0 8 103 101 116 67 108 97 115 115 1 0 7 103 101 116 78 97 109 101 1 0 8 104 97 115 104 67 111 100 101 1 0 15 106 97 118 97 47 108 97 110 103 47 67 108 97</span><br><span class=\"line\">115 115 1 0 36 106 97 118 97 47 108 97 110 103 47 67 108 111 110 101 78 111 116 83 117 112 112 111 114 116 101 100 69 120 99 101 112 116 105 111 110 1 0 34 106 97 118 97 47 108 97 110 103 47 73 108 108 101 103 97 108 65 114 103 117 109 101 110 116 69 120 99 101 112 116 105 111 110 1 0 17 106 97 118 97 47 108 97 110 103 47 73 110 116 101 103 101 114 1 0 30 106 97 118 97 47 108 97 110 103 47 73 110 116 101 114 114</span><br><span class=\"line\">117 112 116 101 100 69 120 99 101 112 116 105 111 110 1 0 16 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 1 0 23 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 1 0 19 106 97 118 97 47 108 97 110 103 47 84 104 114 111 119 97 98 108 101 1 0 37 110 97 110 111 115 101 99 111 110 100 32 116 105 109 101 111 117 116 32 118 97 108 117 101 32 111 117 116 32 111 102 32 114 97 110 103 101 1 0 6 110 111 116 105 102 121 1 0 9 110 111 116 105 102 121 65 108 108 1 0 15 114 101 103 105 115 116 101 114 78 97 116 105 118 101 115 1 0 25 116 105 109 101 111 117 116 32 118 97 108 117 101 32 105 115 32 110 101 103 97 116 105 118 101 1 0 11 116 111 72 101 120 83 116 114 105 110 103 1 0 8 116 111 83 116 114 105 110 103 1 0 4 119 97 105 116 7 0 28 7 0 29 7 0 30 7 0 31 7 0 32 7 0 33 7 0 34 7 0 35 1 0 19 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 59 1 0 22 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 60 42 62 59 1 0 45 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 59 12 0 27 0 5 12 0 15 0 8 12 0 39 0 8 12 0 43 0 10 12 0 25 0 52 12 0 26 0 7 12 0 42 0 7 12 0 41 0</span><br><span class=\"line\">9 12 0 15 0 13 12 0 21 0 54 10 0 44 0 60 10 0 46 0 63 10 0 47 0 62 10 0 49 0 55 10 0 49 0 57 10 0 49 0 58 10 0 49 0 59 10 0 50 0 56 10 0 50 0 61 10 0 50 0 64 0 33 0 49 0 0 0 0 0 0 0 14 0 1 0 15 0 8 0 1 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 1 10 0 39 0 8 0 0 1 17 0 25 0 52 0 1 0 19 0 0 0 2 0 53 1 1 0 27 0 5 0 0 0 1 0 23 0 12 0 1 0 17 0 0 0 34 0 2 0 2 0 0 0 11 42 43 166 0 7 4 167 0 4 3 172 0 0 0 1 0 20 0 0 0 5</span><br><span class=\"line\">0 2 9 64 1 1 4 0 22 0 6 0 1 0 18 0 0 0 4 0 1 0 45 0 1 0 42 0 7 0 1 0 17 0 0 0 48 0 2 0 1 0 0 0 36 187 0 50 89 183 0 72 42 182 0 71 182 0 65 182 0 74 18 2 182 0 74 42 182 0 68 184 0 67 182 0 74 182 0 73 176 0</span><br><span class=\"line\">0 0 0 1 17 0 37 0 8 0 0 1 17 0 38 0 8 0 0 1 17 0 43 0 10 0 1 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 11 0 2 0 17 0 0 0 74 0 4 0 4 0 0 0 50 31 9 148 156 0 13 187 0 46 89 18 4 183 0 66 191 29 155 0 9 29 18 1 164 0 13 187 0 46 89 18 3 183 0 66 191 29 158 0 7 31 10 97 64 42 31 182 0 70 177 0 0 0 1 0 20 0 0 0 6 0 4 16 9 9 7 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 8 0 2 0 17 0 0 0 18 0 3 0 1 0 0 0 6 42 9 182 0 70 177 0 0 0 0 0 18</span><br><span class=\"line\">0 0 0 4 0 1 0 48 0 4 0 24 0 8 0 2 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 0 18 0 0 0 4 0 1 0 51 0 8 0 14 0 8 0 1 0 17 0 0 0 16 0 0 0 0 0 0 0 4 184 0 69 177 0 0 0 0 0 0]</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"JVM","path":"tags/JVM/"},{"name":"Java","path":"tags/Java/"},{"name":"Go","path":"tags/Go/"}],"excerpt":"<h2 id=\"å®ç°cp-classpath-å‚æ•°æœç´¢classæ–‡ä»¶\"><a href=\"#å®ç°cp-classpath-å‚æ•°æœç´¢classæ–‡ä»¶\" class=\"headerlink\" title=\"å®ç°cp/classpath å‚æ•°æœç´¢classæ–‡ä»¶\"></a>å®ç°cp/classpath å‚æ•°æœç´¢classæ–‡ä»¶</h2><h3 id=\"java-class-path-æœç´¢é¡ºåºï¼š\"><a href=\"#java-class-path-æœç´¢é¡ºåºï¼š\" class=\"headerlink\" title=\"java class path æœç´¢é¡ºåºï¼š\"></a>java class path æœç´¢é¡ºåºï¼š</h3><ol>\n<li>å¯åŠ¨ç±»è·¯å¾„ï¼ˆbootstrap classpathï¼‰:jre\\lib ï¼ˆå¯é€šè¿‡-Xbootclasspathå‚æ•°ä¿®æ”¹è¯¥è·¯å¾„ï¼‰</li>\n<li>æ‰©å±•ç±»è·¯å¾„ï¼ˆextension classpathï¼‰:jre\\lib\\ext</li>\n<li>ç”¨æˆ·ç±»è·¯å¾„ï¼ˆuser classpathï¼‰:ç”¨æˆ·è‡ªå·±æŒ‡å®š</li>\n</ol>","more":"<h3 id=\"å®ç°\"><a href=\"#å®ç°\" class=\"headerlink\" title=\"å®ç°\"></a>å®ç°</h3><ol>\n<li>Entryæ¥å£ç”¨æ¥å®šä¹‰å¯åŠ¨ç±»çš„åŸºæœ¬åŠŸèƒ½</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> pathListSeparator = <span class=\"keyword\">string</span>(os.PathListSeparator) <span class=\"comment\">//è·å–å½“å‰æ“ä½œç³»ç»Ÿåˆ†éš”ç¬¦</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Entry <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">\treadClass(classNme <span class=\"keyword\">string</span>) ([]<span class=\"keyword\">byte</span>,Entry,error) <span class=\"comment\">//å®šä¹‰æŒ‰classåè¯»å–classæ–‡ä»¶çš„æ–¹</span></span><br><span class=\"line\">\tString() <span class=\"keyword\">string</span> </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//æ ¹æ®classpathç”Ÿæˆå¯¹åº”çš„å¯åŠ¨ç±»</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newEntry</span><span class=\"params\">(path <span class=\"keyword\">string</span>)</span> <span class=\"title\">Entry</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> strings.Contains(path,pathListSeparator)&#123; <span class=\"comment\">//classpathè·¯å¾„åŒ…å«ç³»ç»Ÿåˆ†å‰²ç¬¦æ—¶ï¼Œnewç»„åˆå¯åŠ¨ç±»</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> newCompositeEntry(path)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> strings.HasSuffix(path,<span class=\"string\">\"*\"</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> newWildcardEntry(path) <span class=\"comment\">//classpathè·¯å¾„åŒ…å«*æ—¶ï¼Œnewé€šé…ç¬¦å¯åŠ¨ç±»</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> strings.HasSuffix(path, <span class=\"string\">\".jar\"</span>) || strings.HasSuffix(path, <span class=\"string\">\".JAR\"</span>) ||</span><br><span class=\"line\">      strings.HasSuffix(path, <span class=\"string\">\".zip\"</span>) || strings.HasSuffix(path, <span class=\"string\">\".ZIP\"</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> newZipEntry(path) <span class=\"comment\">//classpathè·¯å¾„åŒ…å«jarã€JARã€zipã€ZIPæ—¶ï¼Œnewæ–‡ä»¶å¤¹å¯åŠ¨ç±»</span></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> newDirEntry(path)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p>Entryæ¥å£çš„å…·ä½“å®ç°</p>\n<ul>\n<li><p>DirEntryï¼ŒæŒ‰ç…§æ–‡ä»¶è·¯å¾„è¯»å–æ–‡ä»¶äºŒè¿›åˆ¶æµ </p>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> DirEntry <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tabsDir <span class=\"keyword\">string</span> <span class=\"comment\">//å­˜å‚¨æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newDirEntry</span><span class=\"params\">(path <span class=\"keyword\">string</span>)</span> *<span class=\"title\">DirEntry</span></span> &#123;</span><br><span class=\"line\">\tabsDir,err := filepath.Abs(path) <span class=\"comment\">//å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err) <span class=\"comment\">//æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨æ—¶æç¤ºé”™è¯¯</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;DirEntry&#123;absDir&#125; <span class=\"comment\">//è¿”å›DirEntryå®ä¾‹</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *DirEntry)</span> <span class=\"title\">readClass</span><span class=\"params\">(className <span class=\"keyword\">string</span>)</span> <span class=\"params\">([]<span class=\"keyword\">byte</span>,Entry,error)</span></span>&#123;</span><br><span class=\"line\">\tfileName := filepath.Join(self.absDir,className) <span class=\"comment\">//æ‹¼æ¥æ–‡ä»¶å¤¹è·¯å¾„å’Œclassname</span></span><br><span class=\"line\">\tdata,err := ioutil.ReadFile(fileName) <span class=\"comment\">//è¯»å–æ–‡ä»¶</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> data,self,err <span class=\"comment\">//è¿”å›æ–‡ä»¶å†…å®¹</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(self *DirEntry)</span> <span class=\"title\">String</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.absDir <span class=\"comment\">//è¿”å›æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>ZipEntry,è¯»å–å‹ç¼©æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶</p>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> ZipEnty <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tabsPath <span class=\"keyword\">string</span> <span class=\"comment\">//æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newZipEntry</span><span class=\"params\">(path <span class=\"keyword\">string</span>)</span> *<span class=\"title\">ZipEnty</span></span> &#123;</span><br><span class=\"line\">\tabsPath, err := filepath.Abs(path) <span class=\"comment\">//å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;ZipEnty&#123;absPath&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ZipEnty)</span> <span class=\"title\">readClass</span><span class=\"params\">(className <span class=\"keyword\">string</span>)</span> <span class=\"params\">([]<span class=\"keyword\">byte</span>,Entry,error)</span></span>&#123;</span><br><span class=\"line\">\tr, err := zip.OpenReader(self.absPath) <span class=\"comment\">//ä»¥å‹ç¼©æ–‡ä»¶æ ¼å¼è§£å‹</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span>, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> r.Close() <span class=\"comment\">//æœ€åå…³é—­æ–‡ä»¶æµ</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, f := <span class=\"keyword\">range</span> r.File &#123; <span class=\"comment\">//å¾ªç¯è§£å‹å‡ºæ¥çš„æ–‡ä»¶</span></span><br><span class=\"line\">\t   <span class=\"keyword\">if</span> f.Name == className &#123; <span class=\"comment\">//å¦‚æœå½“å‰æ–‡ä»¶ä¸ºæŒ‡å®šæ–‡ä»¶</span></span><br><span class=\"line\">\t\t  rc, err := f.Open() <span class=\"comment\">//æ‰“å¼€è¯¥æ–‡ä»¶</span></span><br><span class=\"line\">\t\t  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span>, err</span><br><span class=\"line\">\t\t  &#125;</span><br><span class=\"line\">\t\t  <span class=\"keyword\">defer</span> rc.Close() <span class=\"comment\">//æœ€åå…³é—­æ–‡ä»¶</span></span><br><span class=\"line\">\t\t  data, err := ioutil.ReadAll(rc) <span class=\"comment\">//è¯»å–æ–‡ä»¶æµ</span></span><br><span class=\"line\">\t\t  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span>, err</span><br><span class=\"line\">\t\t  &#125;</span><br><span class=\"line\">\t\t  <span class=\"keyword\">return</span> data, self, <span class=\"literal\">nil</span> <span class=\"comment\">//è¿”å›æ–‡ä»¶æµ</span></span><br><span class=\"line\">\t   &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span>, errors.New(<span class=\"string\">\"class not found: \"</span> + className)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ZipEnty)</span> <span class=\"title\">String</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.absPath</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>CompositeEntry,è¯»å–ç¬¦åˆæ–‡ä»¶ç±»å‹</p>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> CompositeEntry []Entry <span class=\"comment\">//CompositeEntryä¸ºå¤šç§Entryçš„æ•°ç»„ï¼ˆDirã€Zipï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newCompositeEntry</span><span class=\"params\">(pathList <span class=\"keyword\">string</span>)</span> <span class=\"title\">CompositeEntry</span></span> &#123;</span><br><span class=\"line\">\tcompositeEntry := []Entry&#123;&#125; <span class=\"comment\">//å®ä¾‹Entryæ¥å£æ•°ç»„</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _,path := <span class=\"keyword\">range</span> strings.Split(pathList,pathListSeparator)&#123; <span class=\"comment\">//æŒ‰ç…§ç³»ç»Ÿåˆ†å‰²ç¬¦æˆªå–pathåˆ—è¡¨ï¼Œå¹¶å¾ªç¯</span></span><br><span class=\"line\">\t\tentry := newEntry(path) <span class=\"comment\">//æŒ‰ç…§æ¯ç§pathå®ä¾‹åŒ–ä¸åŒçš„Entry(Dirã€Zipã€Wildcard)</span></span><br><span class=\"line\">\t\tcompositeEntry = <span class=\"built_in\">append</span>(compositeEntry,entry) <span class=\"comment\">//å°†å®ä¾‹åŒ–çš„ä¸åŒEntryæ”¾å…¥CompositeEntryæ•°ç»„ä¸­</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> compositeEntry</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self CompositeEntry)</span> <span class=\"title\">readClass</span><span class=\"params\">(className <span class=\"keyword\">string</span>)</span><span class=\"params\">([]<span class=\"keyword\">byte</span>,Entry,error)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, entry := <span class=\"keyword\">range</span> self &#123; <span class=\"comment\">//å¾ªç¯compositeEntryæ•°ç»„</span></span><br><span class=\"line\">\t\tdata, from, err := entry.readClass(className) <span class=\"comment\">//æ ¹æ®ä¸åŒEntry(Dirã€Zipã€Wildcard)ï¼ŒæŒ‰æŒ‡å®šclassnameè¯»å–æ–‡ä»¶</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t   <span class=\"keyword\">return</span> data, from, <span class=\"literal\">nil</span> <span class=\"comment\">//è¿”å›è¯»å–ç»“æœ</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t &#125;</span><br><span class=\"line\">\t <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span>, errors.New(<span class=\"string\">\"class not found: \"</span> + className) <span class=\"comment\">//æ— ç»“æœæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self CompositeEntry)</span> <span class=\"title\">String</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\tstrs := <span class=\"built_in\">make</span>([]<span class=\"keyword\">string</span>, <span class=\"built_in\">len</span>(self)) <span class=\"comment\">//æŒ‰ç…§CompositeEntryçš„é•¿åº¦ç”³æ˜è¯¥é•¿åº¦çš„Sringæ•°ç»„</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i, entry := <span class=\"keyword\">range</span> self &#123; <span class=\"comment\">//å¾ªç¯CompositeEntry</span></span><br><span class=\"line\">\t   strs[i] = entry.String() <span class=\"comment\">//è°ƒç”¨æ¯ä¸ªEntry(Dirã€Zipã€Wildcard)å®ç°ç±»çš„String()æ–¹æ³•,å¹¶æ”¾å…¥Stringæ•°ç»„ä¸­</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> strings.Join(strs, pathListSeparator) <span class=\"comment\">//å°†Stringæ•°ç»„ä¸­çš„ç»“æœä»¥ç³»ç»Ÿåˆ†éš”ç¬¦æ‹¼æ¥å¹¶è¿”å›</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>WildcardEntryï¼ŒæŒ‰ç…§é€šé…ç¬¦è§£ææ–‡ä»¶</p>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newWildcardEntry</span><span class=\"params\">(path <span class=\"keyword\">string</span>)</span> <span class=\"title\">CompositeEntry</span></span> &#123;</span><br><span class=\"line\">\tbaseDir := path[:<span class=\"built_in\">len</span>(path)<span class=\"number\">-1</span>] <span class=\"comment\">// remove *</span></span><br><span class=\"line\">\tcompositeEntry := []Entry&#123;&#125; <span class=\"comment\">//ç”³æ˜compositeEntryå¯¹è±¡(Entryçš„æ•°ç»„)</span></span><br><span class=\"line\">\twalkFn := <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(path <span class=\"keyword\">string</span>, info os.FileInfo, err error)</span> <span class=\"title\">error</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t   <span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> info.IsDir() &amp;&amp; path != baseDir &#123; <span class=\"comment\">//å¦‚æœå½“å‰ç›®å½•æ˜¯æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ˜¯æ ¹ç›®å½•</span></span><br><span class=\"line\">\t\t   <span class=\"keyword\">return</span> filepath.SkipDir <span class=\"comment\">//è¿”å›SkipDirçš„é”™è¯¯</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> strings.HasSuffix(path, <span class=\"string\">\".jar\"</span>) || strings.HasSuffix(path, <span class=\"string\">\".JAR\"</span>) &#123; <span class=\"comment\">//å¦‚æœå½“å‰è·¯å¾„æ˜¯ä»¥.jaræˆ–.JARç»“å°¾çš„</span></span><br><span class=\"line\">\t\t\tjarEntry := newZipEntry(path) <span class=\"comment\">//å®ä¾‹åŒ–ZipEntry</span></span><br><span class=\"line\">\t\t\tcompositeEntry = <span class=\"built_in\">append</span>(compositeEntry, jarEntry) <span class=\"comment\">//å°†å®ä¾‹åŒ–çš„ZipEntryå¯¹è±¡æ”¾å…¥compositeEntryæ•°ç»„ä¸­</span></span><br><span class=\"line\">\t\t &#125;</span><br><span class=\"line\">\t\t <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t  &#125;</span><br><span class=\"line\">\tfilepath.Walk(baseDir, walkFn) <span class=\"comment\">//å°†walkFnæ–¹æ³•ä¼ é€’ç»™filepath.Walk</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> compositeEntry <span class=\"comment\">//è¿”å›ç»“æœ</span></span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ol>\n<ul>\n<li><p>Classpathï¼Œ-cp|classpathå‚æ•°è§£æå®ç°çš„å…¥å£æ–¹æ³•</p>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Classpath <span class=\"keyword\">struct</span> &#123; <span class=\"comment\">//ClasspathåŒ…å«javaçš„ä¸‰ç§åŸºç¡€å¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">\tbootClasspath Entry </span><br><span class=\"line\">\textClasspath Entry</span><br><span class=\"line\">\tuserClasspath Entry</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Parse</span><span class=\"params\">(jreOption, cpOption <span class=\"keyword\">string</span>)</span> * <span class=\"title\">Classpath</span></span>  &#123;</span><br><span class=\"line\">\tcp := &amp;Classpath&#123;&#125; <span class=\"comment\">//å®ä¾‹åŒ–Classpathå¯¹è±¡</span></span><br><span class=\"line\">\tcp.parseBootAndExtClasspath(jreOption) <span class=\"comment\">//æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">\tcp.parseUserClasspath(cpOption) <span class=\"comment\">//æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> cp <span class=\"comment\">//è¿”å›è®¾ç½®å¥½å¯åŠ¨è·¯å¾„çš„Classpathå¯¹è±¡</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Classpath)</span> <span class=\"title\">ReadClass</span><span class=\"params\">(className <span class=\"keyword\">string</span>)</span> <span class=\"params\">([]<span class=\"keyword\">byte</span>,Entry,error)</span></span>&#123;</span><br><span class=\"line\">\tclassName = className + <span class=\"string\">\".class\"</span> <span class=\"comment\">//åˆå§‹åŒ–classNameæ–‡ä»¶å</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> data, entry, err := self.bootClasspath.readClass(className); err == <span class=\"literal\">nil</span> &#123; <span class=\"comment\">//å…ˆæ‰«æBootå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶</span></span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> data, entry, err <span class=\"comment\">//å­˜åœ¨åˆ™è¿”å›</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> data, entry, err := self.extClasspath.readClass(className); err == <span class=\"literal\">nil</span> &#123; <span class=\"comment\">//å†æ‰«æExtå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶</span></span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> data, entry, err <span class=\"comment\">//å­˜åœ¨åˆ™è¿”å›</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.userClasspath.readClass(className) <span class=\"comment\">//ä»¥ä¸Šä¸¤ä¸ªè·¯å¾„ä¸‹éƒ½ä¸å­˜åœ¨ï¼Œåˆ™æ‰«æUserå¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Classpath)</span> <span class=\"title\">String</span><span class=\"params\">()</span> <span class=\"title\">string</span></span>  &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.userClasspath.String()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Classpath)</span> <span class=\"title\">parseBootAndExtClasspath</span><span class=\"params\">(jreOption <span class=\"keyword\">string</span>)</span></span> &#123; <span class=\"comment\">//æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">\tjreDir := getJreDir(jreOption) <span class=\"comment\">//è·å–jreè·¯å¾„</span></span><br><span class=\"line\">   <span class=\"comment\">// jre/lib/*</span></span><br><span class=\"line\">   jreLibPath := filepath.Join(jreDir, <span class=\"string\">\"lib\"</span>, <span class=\"string\">\"*\"</span>)</span><br><span class=\"line\">   self.bootClasspath = newWildcardEntry(jreLibPath)</span><br><span class=\"line\">   <span class=\"comment\">// jre/lib/ext/*</span></span><br><span class=\"line\">   jreExtPath := filepath.Join(jreDir, <span class=\"string\">\"lib\"</span>, <span class=\"string\">\"ext\"</span>, <span class=\"string\">\"*\"</span>)</span><br><span class=\"line\">   self.extClasspath = newWildcardEntry(jreExtPath)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">getJreDir</span><span class=\"params\">(jreOption <span class=\"keyword\">string</span>)</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> jreOption != <span class=\"string\">\"\"</span> &amp;&amp; exists(jreOption) &#123; <span class=\"comment\">//jreOptionä¸ä¸ºç©ºä¸”å­˜åœ¨æ—¶è¿”å›è¯¥è·¯å¾„</span></span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> jreOption</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> exists(<span class=\"string\">\"./jre\"</span>) &#123; <span class=\"comment\">//./jreè·¯å¾„å­˜åœ¨æ—¶ï¼Œè¿”å›.jre</span></span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> <span class=\"string\">\"./jre\"</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> jh := os.Getenv(<span class=\"string\">\"JAVA_HOME\"</span>); jh != <span class=\"string\">\"\"</span> &#123; <span class=\"comment\">//ç¯å¢ƒå˜é‡JAVA_HOMEå­˜åœ¨å¹¶ä¸”ä¸ä¸ºç©ºæ—¶</span></span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> filepath.Join(jh, <span class=\"string\">\"jre\"</span>) <span class=\"comment\">//è¿”å›JAVA_HOME + \"jre\"</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">panic</span>(<span class=\"string\">\"Can not find jre folder!\"</span>)</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">exists</span><span class=\"params\">(path <span class=\"keyword\">string</span>)</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> _, err := os.Stat(path); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t   <span class=\"keyword\">if</span> os.IsNotExist(err) &#123;</span><br><span class=\"line\">\t\t  <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">\t   &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Classpath)</span> <span class=\"title\">parseUserClasspath</span><span class=\"params\">(cpOption <span class=\"keyword\">string</span>)</span></span> &#123; <span class=\"comment\">//æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨å‚æ•°</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> cpOption == <span class=\"string\">\"\"</span> &#123; <span class=\"comment\">//cpOptionä¸ºç©ºæ—¶</span></span><br><span class=\"line\">\t   cpOption = <span class=\"string\">\".\"</span> <span class=\"comment\">//è¿”å›ç›¸å¯¹è·¯åŠ²</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tself.userClasspath = newEntry(cpOption) <span class=\"comment\">//æ ¹æ®-cp|classpathå‚æ•°å®ä¾‹åŒ–å¯¹åº”çš„Entry</span></span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>mainï¼Œä¿®æ”¹å¯åŠ¨ç±»<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">startJVM</span><span class=\"params\">(cmd *Cmd)</span></span>&#123;</span><br><span class=\"line\">\tcp := classpath.Parse(cmd.XjreOption, cmd.cpOption) <span class=\"comment\">//æ ¹æ®-Xjreå’Œ-cp|classpathå‚æ•°å®ä¾‹åŒ–classpathå¯¹è±¡å®ä¾‹</span></span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">\"classpath:%v class:%v args:%v\\n\"</span>,</span><br><span class=\"line\">\t   cp, cmd.class, cmd.args)</span><br><span class=\"line\">\tclassName := strings.Replace(cmd.class, <span class=\"string\">\".\"</span>, <span class=\"string\">\"/\"</span>, <span class=\"number\">-1</span>)</span><br><span class=\"line\">\tclassData, _, err := cp.ReadClass(className) <span class=\"comment\">//æŒ‰ç…§3ä¸ªå¯åŠ¨è·¯å¾„æŸ¥æ‰¾å¹¶è¯»å–classNameæ–‡ä»¶</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t   fmt.Printf(<span class=\"string\">\"Could not find or load main class %s\\n\"</span>, cmd.class)</span><br><span class=\"line\">\t   <span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">\"class data:%v\\n\"</span>, classData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n</ul>\n<ol start=\"3\">\n<li>è¯•è¿è¡Œ<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS D:\\work\\workspace_go\\src\\jvmgo\\ch02&gt; go install</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch02.exe -Xjre \"C:\\Program Files\\Java\\jre1.8.0_202\" java.lang.Object</span><br><span class=\"line\">classpath:D:\\work\\workspace_go\\bin class:java.lang.Object args:[]</span><br><span class=\"line\">class data:[202 254 186 190 0 0 0 52 0 75 3 0 15 66 63 8 0 16 8 0 36 8 0 40 1 0 3 40 41 73 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 3 40 41 86 1 0 21 40 73 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 4 40 74 41 86 1 0 5 40 74 73 41 86 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 41 90 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 86 1 0 8 60 99 108 105 110 105 116 62 1 0 6 60 105 110 105 116 62 1 0 1 64 1 0 4 67 111 100</span><br><span class=\"line\">101 1 0 10 69 120 99 101 112 116 105 111 110 115 1 0 9 83 105 103 110 97 116 117 114 101 1 0 13 83 116 97 99 107 77 97 112 84 97 98 108 101 1 0 6 97 112 112 101 110 100 1 0 5 99 108 111 110 101 1 0 6 101 113</span><br><span class=\"line\">117 97 108 115 1 0 8 102 105 110 97 108 105 122 101 1 0 8 103 101 116 67 108 97 115 115 1 0 7 103 101 116 78 97 109 101 1 0 8 104 97 115 104 67 111 100 101 1 0 15 106 97 118 97 47 108 97 110 103 47 67 108 97</span><br><span class=\"line\">115 115 1 0 36 106 97 118 97 47 108 97 110 103 47 67 108 111 110 101 78 111 116 83 117 112 112 111 114 116 101 100 69 120 99 101 112 116 105 111 110 1 0 34 106 97 118 97 47 108 97 110 103 47 73 108 108 101 103 97 108 65 114 103 117 109 101 110 116 69 120 99 101 112 116 105 111 110 1 0 17 106 97 118 97 47 108 97 110 103 47 73 110 116 101 103 101 114 1 0 30 106 97 118 97 47 108 97 110 103 47 73 110 116 101 114 114</span><br><span class=\"line\">117 112 116 101 100 69 120 99 101 112 116 105 111 110 1 0 16 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 1 0 23 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 1 0 19 106 97 118 97 47 108 97 110 103 47 84 104 114 111 119 97 98 108 101 1 0 37 110 97 110 111 115 101 99 111 110 100 32 116 105 109 101 111 117 116 32 118 97 108 117 101 32 111 117 116 32 111 102 32 114 97 110 103 101 1 0 6 110 111 116 105 102 121 1 0 9 110 111 116 105 102 121 65 108 108 1 0 15 114 101 103 105 115 116 101 114 78 97 116 105 118 101 115 1 0 25 116 105 109 101 111 117 116 32 118 97 108 117 101 32 105 115 32 110 101 103 97 116 105 118 101 1 0 11 116 111 72 101 120 83 116 114 105 110 103 1 0 8 116 111 83 116 114 105 110 103 1 0 4 119 97 105 116 7 0 28 7 0 29 7 0 30 7 0 31 7 0 32 7 0 33 7 0 34 7 0 35 1 0 19 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 59 1 0 22 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 60 42 62 59 1 0 45 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 59 12 0 27 0 5 12 0 15 0 8 12 0 39 0 8 12 0 43 0 10 12 0 25 0 52 12 0 26 0 7 12 0 42 0 7 12 0 41 0</span><br><span class=\"line\">9 12 0 15 0 13 12 0 21 0 54 10 0 44 0 60 10 0 46 0 63 10 0 47 0 62 10 0 49 0 55 10 0 49 0 57 10 0 49 0 58 10 0 49 0 59 10 0 50 0 56 10 0 50 0 61 10 0 50 0 64 0 33 0 49 0 0 0 0 0 0 0 14 0 1 0 15 0 8 0 1 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 1 10 0 39 0 8 0 0 1 17 0 25 0 52 0 1 0 19 0 0 0 2 0 53 1 1 0 27 0 5 0 0 0 1 0 23 0 12 0 1 0 17 0 0 0 34 0 2 0 2 0 0 0 11 42 43 166 0 7 4 167 0 4 3 172 0 0 0 1 0 20 0 0 0 5</span><br><span class=\"line\">0 2 9 64 1 1 4 0 22 0 6 0 1 0 18 0 0 0 4 0 1 0 45 0 1 0 42 0 7 0 1 0 17 0 0 0 48 0 2 0 1 0 0 0 36 187 0 50 89 183 0 72 42 182 0 71 182 0 65 182 0 74 18 2 182 0 74 42 182 0 68 184 0 67 182 0 74 182 0 73 176 0</span><br><span class=\"line\">0 0 0 1 17 0 37 0 8 0 0 1 17 0 38 0 8 0 0 1 17 0 43 0 10 0 1 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 11 0 2 0 17 0 0 0 74 0 4 0 4 0 0 0 50 31 9 148 156 0 13 187 0 46 89 18 4 183 0 66 191 29 155 0 9 29 18 1 164 0 13 187 0 46 89 18 3 183 0 66 191 29 158 0 7 31 10 97 64 42 31 182 0 70 177 0 0 0 1 0 20 0 0 0 6 0 4 16 9 9 7 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 8 0 2 0 17 0 0 0 18 0 3 0 1 0 0 0 6 42 9 182 0 70 177 0 0 0 0 0 18</span><br><span class=\"line\">0 0 0 4 0 1 0 48 0 4 0 24 0 8 0 2 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 0 18 0 0 0 4 0 1 0 51 0 8 0 14 0 8 0 1 0 17 0 0 0 16 0 0 0 0 0 0 0 4 184 0 69 177 0 0 0 0 0 0]</span><br></pre></td></tr></table></figure>\n</li>\n</ol>"}],"PostAsset":[{"_id":"source/_posts/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘/nolayout.jpg","slug":"nolayout.jpg","post":"ck10secr00000jony8g4p9j8y","modified":0,"renderable":0},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1/gopath.png","slug":"gopath.png","post":"ck10secr50002jony100co07u","modified":0,"renderable":0},{"_id":"source/_posts/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜/wenti.png","slug":"wenti.png","post":"ck10secrc0008jonyjxbet15l","modified":0,"renderable":0},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4/è¿è¡Œæ—¶æ•°æ®åŒº.png","slug":"è¿è¡Œæ—¶æ•°æ®åŒº.png","post":"ck10secrd0009jonyz4a345c0","modified":0,"renderable":0},{"_id":"source/_posts/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/springCache.png","slug":"springCache.png","post":"ck10secrh000djonyrf87fdm6","modified":0,"renderable":0},{"_id":"source/_posts/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/å¤šçº§ç¼“å­˜.png","slug":"å¤šçº§ç¼“å­˜.png","post":"ck10secrh000djonyrf87fdm6","modified":0,"renderable":0},{"_id":"source/_posts/ğŸ‡/å…¨æ™¯.jpeg","slug":"å…¨æ™¯.jpeg","post":"ck10secri000ejonyv69h1ot6","modified":0,"renderable":0},{"_id":"source/_posts/ğŸ‡/ç‰Œå­.jpeg","slug":"ç‰Œå­.jpeg","post":"ck10secri000ejonyv69h1ot6","modified":0,"renderable":0}],"PostCategory":[{"post_id":"ck10secrc0008jonyjxbet15l","category_id":"ck10secr80004jony05qszx6a","_id":"ck10secrj000fjonymc9r9453"},{"post_id":"ck10secr00000jony8g4p9j8y","category_id":"ck10secr80004jony05qszx6a","_id":"ck10secrl000jjonybk7x9i8u"},{"post_id":"ck10secrh000djonyrf87fdm6","category_id":"ck10secr80004jony05qszx6a","_id":"ck10secrn000njony5az86pux"},{"post_id":"ck10secr50002jony100co07u","category_id":"ck10secr80004jony05qszx6a","_id":"ck10secrn000ojonydj21qke8"},{"post_id":"ck10secra0006jony273wlg3x","category_id":"ck10secr80004jony05qszx6a","_id":"ck10secro000rjonyvl5ux1sk"},{"post_id":"ck10secri000ejonyv69h1ot6","category_id":"ck10secrm000ljonymrd4536o","_id":"ck10secro000tjonydy0oeqa9"},{"post_id":"ck10secrk000ijonyqozyx34c","category_id":"ck10secrn000pjony0ehwfsyr","_id":"ck10secrq000xjonyhwvjjfmb"},{"post_id":"ck10secrz001ojonym2t4kgv6","category_id":"ck10secr80004jony05qszx6a","_id":"ck10secs1001rjonyf1y6nccl"},{"post_id":"ck10secrd0009jonyz4a345c0","category_id":"ck10secr80004jony05qszx6a","_id":"ck10sg05o00029ony1b5gmek8"}],"PostTag":[{"post_id":"ck10secr00000jony8g4p9j8y","tag_id":"ck10secr90005jonyp12z2r3o","_id":"ck10secrh000cjonyh1sns671"},{"post_id":"ck10secr50002jony100co07u","tag_id":"ck10secrf000bjonygdww3yez","_id":"ck10secro000sjonygjw14798"},{"post_id":"ck10secr50002jony100co07u","tag_id":"ck10secrk000hjonyaftoz7t1","_id":"ck10secrp000ujonyb60dab98"},{"post_id":"ck10secr50002jony100co07u","tag_id":"ck10secrn000mjonyolqqvqxc","_id":"ck10secrp000wjony5gjidzka"},{"post_id":"ck10secra0006jony273wlg3x","tag_id":"ck10secrf000bjonygdww3yez","_id":"ck10secrr0010jonyot9uvral"},{"post_id":"ck10secra0006jony273wlg3x","tag_id":"ck10secrk000hjonyaftoz7t1","_id":"ck10secrr0011jonyrl6vtmke"},{"post_id":"ck10secra0006jony273wlg3x","tag_id":"ck10secrn000mjonyolqqvqxc","_id":"ck10secrr0013jonyjsi715vu"},{"post_id":"ck10secrc0008jonyjxbet15l","tag_id":"ck10secrk000hjonyaftoz7t1","_id":"ck10secrs0015jonyjygtfw57"},{"post_id":"ck10secrc0008jonyjxbet15l","tag_id":"ck10secrr0012jony68phx5gj","_id":"ck10secrs0016jonydg2ohpt4"},{"post_id":"ck10secrh000djonyrf87fdm6","tag_id":"ck10secrk000hjonyaftoz7t1","_id":"ck10secrv001gjonyybeicktj"},{"post_id":"ck10secrh000djonyrf87fdm6","tag_id":"ck10secru001cjony5ncx7ctw","_id":"ck10secrv001hjony2e00vwpc"},{"post_id":"ck10secrh000djonyrf87fdm6","tag_id":"ck10secru001ejony45q1jw52","_id":"ck10secrw001jjonyu1yt9vrq"},{"post_id":"ck10secri000ejonyv69h1ot6","tag_id":"ck10secrv001fjony8jk6ahci","_id":"ck10secrw001kjonytd2vyadb"},{"post_id":"ck10secrk000ijonyqozyx34c","tag_id":"ck10secrv001ijonykchk4zgi","_id":"ck10secrw001mjony4st1xjsz"},{"post_id":"ck10secrk000ijonyqozyx34c","tag_id":"ck10secrw001ljonye2skc3y8","_id":"ck10secrx001njony0vexoj9s"},{"post_id":"ck10secrz001ojonym2t4kgv6","tag_id":"ck10secrf000bjonygdww3yez","_id":"ck10secs0001pjonywnrt9s4d"},{"post_id":"ck10secrz001ojonym2t4kgv6","tag_id":"ck10secrk000hjonyaftoz7t1","_id":"ck10secs0001qjony8scjn2oc"},{"post_id":"ck10secrz001ojonym2t4kgv6","tag_id":"ck10secrn000mjonyolqqvqxc","_id":"ck10secs1001sjonyqk7vavyn"},{"post_id":"ck10secrd0009jonyz4a345c0","tag_id":"ck10secrf000bjonygdww3yez","_id":"ck10sg05n00009onydgml9u4s"},{"post_id":"ck10secrd0009jonyz4a345c0","tag_id":"ck10secrk000hjonyaftoz7t1","_id":"ck10sg05n00019onyvzb0nrjm"},{"post_id":"ck10secrd0009jonyz4a345c0","tag_id":"ck10secrn000mjonyolqqvqxc","_id":"ck10sg05o00039onyfev1e2k8"}],"Tag":[{"name":"Hexo","_id":"ck10secr90005jonyp12z2r3o"},{"name":"JVM","_id":"ck10secrf000bjonygdww3yez"},{"name":"Java","_id":"ck10secrk000hjonyaftoz7t1"},{"name":"Go","_id":"ck10secrn000mjonyolqqvqxc"},{"name":"Spring Boot","_id":"ck10secrr0012jony68phx5gj"},{"name":"Redis","_id":"ck10secru001cjony5ncx7ctw"},{"name":"Cache","_id":"ck10secru001ejony45q1jw52"},{"name":"Food","_id":"ck10secrv001fjony8jk6ahci"},{"name":"AI","_id":"ck10secrv001ijonykchk4zgi"},{"name":"APP","_id":"ck10secrw001ljonye2skc3y8"}]}}