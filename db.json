{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/minos/source/css/insight.scss","path":"css/insight.scss","modified":0,"renderable":1},{"_id":"themes/minos/source/css/style.scss","path":"css/style.scss","modified":0,"renderable":1},{"_id":"themes/minos/source/images/check.svg","path":"images/check.svg","modified":0,"renderable":1},{"_id":"themes/minos/source/images/exclamation.svg","path":"images/exclamation.svg","modified":0,"renderable":1},{"_id":"themes/minos/source/images/info.svg","path":"images/info.svg","modified":0,"renderable":1},{"_id":"themes/minos/source/images/logo.png","path":"images/logo.png","modified":0,"renderable":1},{"_id":"themes/minos/source/images/question.svg","path":"images/question.svg","modified":0,"renderable":1},{"_id":"themes/minos/source/images/quote-left.svg","path":"images/quote-left.svg","modified":0,"renderable":1},{"_id":"themes/minos/source/js/insight.js","path":"js/insight.js","modified":0,"renderable":1},{"_id":"themes/minos/source/js/script.js","path":"js/script.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/about/index.md","hash":"b643368607613240c4742a761c9be09abbd05379","modified":1607939484080},{"_id":"source/_posts/CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º.md","hash":"5e3a2161cb779453ae28358f42fd3affc889fbb9","modified":1607942260145},{"_id":"source/_posts/Harmonica.md","hash":"4e2d76fe1a62f1bfd884e14c99bf55390d0ad343","modified":1607942434911},{"_id":"source/_posts/JVM-æ•´ç†.md","hash":"7b44bfe755f72bcc8171139cfa2140da217bb0b4","modified":1607939484008},{"_id":"source/_posts/NIO.md","hash":"8ead196555b8d598e0f5219f6106229e78509f76","modified":1607939484008},{"_id":"source/_posts/Spring-Boot.md","hash":"d5955ad7f7f0448aa515e2a559d4a12c0e3eadae","modified":1607939484008},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥.md","hash":"c74cfffbe76bd32bfa1a6c3b4162587b7c065a14","modified":1607942386423},{"_id":"source/_posts/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘.md","hash":"bf224ed7bb81c5298e6d7a9fea9a1048ed5ba948","modified":1607942439272},{"_id":"source/_posts/linuxæä¾›åŠ è½½ã€å¤„ç†åŠ¨æ€é“¾æ¥åº“çš„ç³»ç»Ÿè°ƒç”¨æ–¹æ³•.md","hash":"2e4648cf9536cd2f66105aa8a3833fe9dca9b1bf","modified":1607939484016},{"_id":"source/_posts/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜.md","hash":"497e9ecf448a4836949efa1230bc018f0d5f52ce","modified":1607942123746},{"_id":"source/_posts/åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•æ•´ç†.md","hash":"3fabac6594716259e343ceb1d6202ce8f252b098","modified":1607939484018},{"_id":"source/_posts/åˆ†å¸ƒå¼äº‹åŠ¡æ•´ç†.md","hash":"f22d9fd94e4bdf027990d4bc815c17510ef1e6ad","modified":1607939484018},{"_id":"source/_posts/åˆ†æ”¯é¢„æµ‹-GCC-builtin-expect.md","hash":"153e57bde8c81aa14015e001a69cf86e8bda8d14","modified":1608170153102},{"_id":"source/_posts/åŸºäºFlinkå®ç°ç®€å•çš„æ—¥å¿—å¼‚å¸¸æ¨é€.md","hash":"5f01d2b41a6b635a0837dfae23d4cc8c65d7e2e1","modified":1607939484018},{"_id":"source/_posts/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•.md","hash":"e8f416fd2efbca2b4552af9ef1986f7c38f2658b","modified":1607941412989},{"_id":"source/_posts/åŸºäºFlinkè®¾è®¡ç»Ÿä¸€æŠ¥è­¦å¹³å°.md","hash":"e6f7f521cec24e72372185c417b22aa62e001d4d","modified":1607939484020},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡.md","hash":"95f463c2166cdea44dae52aef8a723cb433db2dc","modified":1607942024564},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»£ç ç¯‡.md","hash":"0c1f19088800d271f3afd480aa0efd05cc486dd0","modified":1607939484047},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡.md","hash":"20d15e2ad79a7f6224cdf2a962cf60552311e3b8","modified":1607939484047},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2.md","hash":"5a441935628a02cedb414f68b63f610ced08939c","modified":1607942074801},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡3.md","hash":"d05084c5fb7b282325c4ac71b0c08091c219c530","modified":1607939484049},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-èµ·æºç¯‡.md","hash":"e78fe30dd28d0f57535391e478e25325bc38ecf5","modified":1607939484050},{"_id":"source/_posts/æœå¯»æµæµªç‹—APP.md","hash":"d6bdcdfd64e797326fb059651936a4a7ec1b7d2d","modified":1607939484050},{"_id":"source/_posts/æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†.md","hash":"5ceb2899191e733898a9ed8c18c9216b29b694d7","modified":1607941677231},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1.md","hash":"25fc284fe9b1359d3143e3eb274126d4fde9cb3e","modified":1607942149430},{"_id":"source/_posts/è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è¯»å–-è§£æ.md","hash":"0eb726e12b9ef0716402b2a684013a2db66b47b5","modified":1607939484054},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°2.md","hash":"21c2f49bd18fa61934828232874d5fc15d0622da","modified":1607939484055},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°3.md","hash":"dbc3737adfd45fb433822e6dab03a34bcf14e5bc","modified":1607939484056},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4.md","hash":"b2c93b956937ace9dbf5cf59280b5a3277d8a475","modified":1607942174566},{"_id":"source/_posts/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜.md","hash":"75f7bb0d613c30c31b3c2d8ffcf409dc60e7ec12","modified":1607941551707},{"_id":"source/categories/index.md","hash":"57a6b0750e78381e5bd96be4d3fd3a34a9147638","modified":1607939484080},{"_id":"source/_posts/ğŸ‡.md","hash":"e520a57f6e7778bd00ba12cf407ce0c4e759e4b8","modified":1607941076593},{"_id":"source/tags/index.md","hash":"5bc40eb8067b1b802f2f5e1beb961b72527b2355","modified":1607939484172},{"_id":"source/_posts/CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º/pull.png","hash":"75df3bb37ab4153db6a76effdd1f3caa3fd26aae","modified":1607939484005},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/classloadæ–­ç‚¹.png","hash":"b23555690fff99fec7bc4dd33042c62de64194ca","modified":1607939484012},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/idea.png","hash":"e3aa184adced51bc89141426a7e9eae9724dbb55","modified":1607939484014},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/jps.png","hash":"fdaf08415d96c17407a1f77a4c67bd69e218f8ad","modified":1607939484014},{"_id":"source/_posts/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘/nolayout.jpg","hash":"b7e6217718a630562255060b224ee116d1caf824","modified":1607939484016},{"_id":"source/_posts/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/springCache.png","hash":"244dfd7e60a2e01dbd8ed66d5f0828db5737c32d","modified":1607939484017},{"_id":"source/_posts/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/flink-local.png","hash":"7b4ba65ffb265a902ba1857a4d9b44b87e780b77","modified":1607939484019},{"_id":"source/_posts/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-dashboard.png","hash":"3992562c00d407b4e57860b7037eb0d8e63e22d8","modified":1607939484019},{"_id":"source/_posts/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-message.png","hash":"71a6a78f475da2a55fae3fc6ae1339e1e9840238","modified":1607939484019},{"_id":"source/_posts/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-topic.png","hash":"8e3049784ffdb24584139f37b5d6aff0943663fe","modified":1607939484020},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/addGroup.png","hash":"a5b0ba884bb632b2125bee606bf3016966692e4a","modified":1607939484021},{"_id":"source/_posts/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/wechat-message.png","hash":"2f4f5d8186da8887cc614bc0941c3a0aa47377d0","modified":1607939484020},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/history.png","hash":"eb8dac42b2ba7119a89b7c74cbb81e56d03410f9","modified":1607939484030},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/instanceConfig.png","hash":"764b4c39797d533ab1195b65f32d06cc32ce819a","modified":1607939484031},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/switch.png","hash":"92060e35ba1f4220ebb8164c07cdf9da2e280fb7","modified":1607939484039},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/CentOS6-Base-163.repo","hash":"c601efdaeb8c55cb0dea2cade8976c5a8de366ac","modified":1607939484048},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/å®¢æˆ·ç«¯å¯åŠ¨å¹¶æ›´æ–°é…ç½®.png","hash":"fbae1f8e0ac320887b72000346d5dd079ed12a06","modified":1607939484049},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/æœåŠ¡ç«¯çƒ­æ›´æ–°é…ç½®.png","hash":"985f1bfbd2bbdf087c49ff3b6f81f51ac5c81afc","modified":1607939484049},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1/gopath.png","hash":"651d1a1fb00e3250828a1e1570d1ee3f842774ca","modified":1607939484055},{"_id":"themes/minos/.gitignore","hash":"8b02e7219e2dd9b50d198819fd7d8f74ebc9db2a","modified":1607939484172},{"_id":"themes/minos/LICENSE","hash":"ca01a2d52b59346e82f079c593df6cb26dd9a7a5","modified":1607939484172},{"_id":"themes/minos/README.md","hash":"ba6b4e134d718704cfd030e106bf24d6ef8b496d","modified":1607939484173},{"_id":"themes/minos/_config.yml","hash":"7ef78f4e125fc8453a76bcff6182e78c78b0acd1","modified":1607939484173},{"_id":"themes/minos/_config.yml.example","hash":"c16bbed955c4209e6bfdff834fa6281eb5be417d","modified":1607939484173},{"_id":"themes/minos/package.json","hash":"f9d450db80149dea6c372990cdf51dfde901e5cc","modified":1607939484186},{"_id":"themes/minos/languages/de.yml","hash":"3d6abea8c2990b04fcd54ffd88ab15356b5171e8","modified":1607939484173},{"_id":"themes/minos/languages/en.yml","hash":"24b8cf6b8fc989be612333aa5121808bb8cf029b","modified":1607939484174},{"_id":"themes/minos/languages/es.yml","hash":"5c35950221411e34e7a9821d0b0671da9a458d8c","modified":1607939484174},{"_id":"themes/minos/package-lock.json","hash":"e1fbecec56fb65379bf651f21fb485376e692b38","modified":1607939484186},{"_id":"themes/minos/languages/fr.yml","hash":"cca90260b00842bf73fadb3154c2969102cf80c0","modified":1607939484174},{"_id":"themes/minos/languages/ko.yml","hash":"1acf3f959f1d2b4f7a77e7e82851821aa8635362","modified":1607939484174},{"_id":"themes/minos/languages/pl.yml","hash":"cfd7c898b2841bf7a1490ebfaa3cbb40fd7da50d","modified":1607939484175},{"_id":"themes/minos/languages/ru.yml","hash":"dbb9bee79348e29098af6c56b14bbca6986e9795","modified":1607939484175},{"_id":"themes/minos/languages/zh-cn.yml","hash":"9c5a489b11a056d1ea7b9d4a0e127aef9e192ee4","modified":1607939484175},{"_id":"themes/minos/languages/zh-tw.yml","hash":"f61b67b9c454d16bc3973f6cb142b98a4e19f9b0","modified":1607939484175},{"_id":"themes/minos/layout/archive.ejs","hash":"e3eefe819d61b4d0ee069bb705a9f5707a8bf3da","modified":1607939484176},{"_id":"themes/minos/layout/categories.ejs","hash":"fff6f911d0f548ee749292bc1942f8fbbb1fbfe7","modified":1607939484176},{"_id":"themes/minos/layout/category.ejs","hash":"403c646878834964883ac41e63952f7b1595c0ba","modified":1607939484176},{"_id":"themes/minos/layout/layout.ejs","hash":"45588aa46857cf9403fa79d738ab37a46ddcf773","modified":1607939484182},{"_id":"themes/minos/layout/index.ejs","hash":"dff9e199d394f82c5416b814f9e644edbe4090f0","modified":1607939484181},{"_id":"themes/minos/lib/i18n.js","hash":"4c90aa27420e0e2ff74f80e976fe146e96354f61","modified":1607939484185},{"_id":"themes/minos/layout/tag.ejs","hash":"5593c7cf9618ef5650c779ed9d75424f057aa210","modified":1607939484185},{"_id":"themes/minos/layout/post.ejs","hash":"68b84a717efc5ca59ee9eb6202ccf05c5a8abda5","modified":1607939484183},{"_id":"themes/minos/lib/rfc5646.js","hash":"8ecf38d0ec7145720ea8e888da314131712770e8","modified":1607939484186},{"_id":"themes/minos/layout/tags.ejs","hash":"e4a9909119294f131a45f10b2cb1058af5fb9be1","modified":1607939484185},{"_id":"themes/minos/scripts/01_check.js","hash":"e53508ef82a1518ed7e663ce2d87544c20a50779","modified":1607939484187},{"_id":"themes/minos/scripts/10_i18n.js","hash":"9c1f9e3ec3c6299fc599769783925d1898a632f0","modified":1607939484187},{"_id":"themes/minos/scripts/99_config.js","hash":"d41a5df0a442728fbc66514476fe043e416d7438","modified":1607939484187},{"_id":"themes/minos/scripts/99_content.js","hash":"ff61d3d631b06024509d4fe28b4e31590a02f05b","modified":1607939484188},{"_id":"themes/minos/scripts/99_tags.js","hash":"f97c2332a7e13fed99672b27c4380a6183d8600e","modified":1607939484188},{"_id":"themes/minos/layout/comment/changyan.ejs","hash":"9ccc7ec354b968e60bdcfcd1dba451d38de61f12","modified":1607939484176},{"_id":"themes/minos/layout/comment/disqus.ejs","hash":"a2becdc02214a673c804af93488489807fa2c99c","modified":1607939484177},{"_id":"themes/minos/layout/comment/facebook.ejs","hash":"e73b6f93d98b27ba9068c1685874ecccfbac737b","modified":1607939484177},{"_id":"themes/minos/layout/comment/gitment.ejs","hash":"430416210933b7edcbfcc67ede4aa55539da2750","modified":1607939484177},{"_id":"themes/minos/layout/comment/isso.ejs","hash":"cc6a43bd24be764086f88ad7c5c97ff04df87e0b","modified":1607939484177},{"_id":"themes/minos/layout/comment/livere.ejs","hash":"12ff9a345f6bba2f732f592e39508c2afde89b00","modified":1607939484178},{"_id":"themes/minos/layout/comment/youyan.ejs","hash":"3d6cf9c523a7a5510ec2864bb29f861f9bb78af3","modified":1607939484178},{"_id":"themes/minos/layout/comment/valine.ejs","hash":"b0eef3bea0a54b4b66f860ad69889f87e0408f22","modified":1607939484178},{"_id":"themes/minos/layout/common/footer.ejs","hash":"cbf141464dbf127294370e843e6a10cd2ac7ea38","modified":1607939484179},{"_id":"themes/minos/layout/common/head.ejs","hash":"4dd9352ea5f5a59d3af2bedac7d545c08bb08531","modified":1607939484179},{"_id":"themes/minos/layout/common/article.ejs","hash":"3f0ae9f2bf5aae5a6824ee824c552a5af9dc98f0","modified":1607939484179},{"_id":"themes/minos/layout/common/navbar.ejs","hash":"f3aa16f357450651d0454f1ddc06a032f3dc4de3","modified":1607939484180},{"_id":"themes/minos/layout/common/languages.ejs","hash":"89665c656a1ffebc9c97f03e7f9c12dd1d90702a","modified":1607939484180},{"_id":"themes/minos/layout/common/paginator.ejs","hash":"8f5060e4c8a86a3f4e58455c41c98e831e23e4a4","modified":1607939484180},{"_id":"themes/minos/layout/common/scripts.ejs","hash":"7a5a5271930423b95046836597e30e31fa708f66","modified":1607939484180},{"_id":"themes/minos/layout/plugins/clipboard.ejs","hash":"a448757bb8a2c29bd9501c625f7df5087bb18dbe","modified":1607939484182},{"_id":"themes/minos/layout/plugins/gallery.ejs","hash":"7c2becafdf6b60e677cdd5756b9d55eba2af4944","modified":1607939484182},{"_id":"themes/minos/layout/plugins/google-analytics.ejs","hash":"2a9d944a60aff7df27def5215bdc071e605c3c42","modified":1607939484183},{"_id":"themes/minos/layout/plugins/katex.ejs","hash":"c8a7ecdc5802007f8fec46a299790ce4e0834acd","modified":1607939484183},{"_id":"themes/minos/layout/plugins/mathjax.ejs","hash":"b92fc2b30040e09145d80ebb9bad6813dda8acf2","modified":1607939484183},{"_id":"themes/minos/layout/search/google-cse.ejs","hash":"a6bf5c30339735126efa7efa684f9eb14dd6136a","modified":1607939484184},{"_id":"themes/minos/layout/search/insight.ejs","hash":"6fb7d27ef40145d8587b46b44a43516135b5a81a","modified":1607939484184},{"_id":"themes/minos/layout/share/addthis.ejs","hash":"f1c5f337333009d5f00dfbac4864a16ef8f9cb8d","modified":1607939484184},{"_id":"themes/minos/layout/share/sharethis.ejs","hash":"4f2c40f790f3be0a4e79db04f02ea41ba2f4d4c0","modified":1607939484185},{"_id":"themes/minos/source/css/insight.scss","hash":"f785fc6574d2853c660be39b2e3149d4846b577f","modified":1607939484188},{"_id":"themes/minos/source/css/style.scss","hash":"5c8f648617899ff05c62f27da3bfb91755dff595","modified":1607939484189},{"_id":"themes/minos/source/images/check.svg","hash":"029b8b3523b7daa4005983b4463cd93408308aab","modified":1607939484189},{"_id":"themes/minos/source/images/info.svg","hash":"c8aa387e935ba9a7fa72c5dd000b7d46f2e030c4","modified":1607939484189},{"_id":"themes/minos/source/images/exclamation.svg","hash":"b2db56f2cc13fce73dbea46c7b446d9bcb3bf0fd","modified":1607939484189},{"_id":"themes/minos/source/images/logo.png","hash":"4e012d9ba58cb8f87ee775262ef871c158ac5948","modified":1607939484190},{"_id":"themes/minos/source/images/question.svg","hash":"7153fa2a0c21e32da6a1f96a333d8b66a178569d","modified":1607939484190},{"_id":"themes/minos/source/images/quote-left.svg","hash":"d2561fa8d13e63ff196b71232a5968415ec6e372","modified":1607939484190},{"_id":"themes/minos/source/js/insight.js","hash":"eb23c31141784eef7300f1d1c548950e77883f56","modified":1607939484191},{"_id":"themes/minos/source/js/script.js","hash":"6b670ec4f90fb43b21a0bbd750a217af5d8aab6b","modified":1607939484191},{"_id":"source/_posts/CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º/search.png","hash":"315b8aae526635a45d325d6ea6c649cffc3d8043","modified":1607939484006},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/BytecodeVerificationJunit.png","hash":"2bd9676494ca25f8c2dd764a699dbc1bc2313f25","modified":1607939484010},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/BytecodeVerificationWithApp.png","hash":"5d99578cc973f9f91e331e522855b49671335fff","modified":1607939484010},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/hdbs_attach.png","hash":"46e16f350e4b03fcdc63c3091fda3ced1df1c6a6","modified":1607939484014},{"_id":"source/_posts/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/å¤šçº§ç¼“å­˜.png","hash":"22fa4a74b7c688ad6fbb3a3a56c585d2acf0dfef","modified":1607939484017},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/allocateConfigs.png","hash":"a7f351d59d8948559064c6ed1d808e31ef76c91f","modified":1607939484023},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/instance.png","hash":"3a743c6ff182b6f977979beaad06c4d94c4646bc","modified":1607939484031},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/æœåŠ¡éƒ¨ç½²å›¾.png","hash":"04a4f44f1a92e70be92a938141b08baba5105f78","modified":1607939484045},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/æ³¨å†Œ.png","hash":"8adb68e1e6c05139f9fabb380ba6a984e058fbca","modified":1607939484046},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/ç™»å½•.png","hash":"df8b35801e8237cb7eb74a269c1e1c8b1899eeac","modified":1607939484046},{"_id":"source/_posts/æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/flow.png","hash":"f63f7bc7a865169a4803508758f08ac516202f7c","modified":1607939484053},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4/è¿è¡Œæ—¶æ•°æ®åŒº.png","hash":"5057a5c3a444bc1720a6bf1951d4d3c373386042","modified":1607939484057},{"_id":"source/_posts/Harmonica/GodenMelody.jpeg","hash":"1776a2747e1fc0461dd769cb7ec7aa577b973f40","modified":1607939484007},{"_id":"source/_posts/Harmonica/SilverStar.jpeg","hash":"6eb1ea1ca65799a6ed267b9ebc12d34a5ea0c19c","modified":1607939484008},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/class_browser.png","hash":"f7e9280fe7d8b713553007e01090c60d647e6642","modified":1607939484011},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/processingTask.png","hash":"5c6ee9c2839a24498c22fff99e8e3a5dc6e9b009","modified":1607939484036},{"_id":"source/_posts/æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/JVM_start.png","hash":"5b2169fad1184aec8b62f8e544a4fd27b66a9453","modified":1607939484052},{"_id":"source/_posts/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜/wenti.png","hash":"e6843d420e7ad46c852f2f041812eb927fb1399d","modified":1607939484058},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/constantpool.png","hash":"a0154820aa5801757cfaf904dcbe4c857a51ef8b","modified":1607939484013},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/visualVM.png","hash":"fa05315b76c1eeedb588d86dd6d2443e3b3dca57","modified":1607939484016},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/compare.png","hash":"6b238e8bf72dbef0c21966e8ce06dead8f79e73f","modified":1607939484027},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/completeTask.png","hash":"18c9d03bc8c0aa4819d08f019774a966bfe1f210","modified":1607939484028},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/configs.png","hash":"c238a9fe76aaab46faef9dee3478e0683959f7ad","modified":1607939484030},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/metadata.png","hash":"713f1ece021f460bc8aa35e145464d6ee39b6712","modified":1607939484032},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/pendingTask.png","hash":"7fe73f7083117304989e685121fef0eacf97cd02","modified":1607939484035},{"_id":"source/_posts/æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/load_agent_library.png","hash":"50b8fd1d0dd9a7fdd344fed44dbf237acca73451","modified":1607939484054},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/allocate.png","hash":"bcc93b6de9ee67bf69cffa491ba32bacf5882942","modified":1607939484023},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/operationLog.png","hash":"5b01191dd79eedd699843c15bbde293d7fa49a7c","modified":1607939484034},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/role.png","hash":"1a2a190711181260a79e264b5d4cdde5cf3ec50b","modified":1607939484038},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/user.png","hash":"5359c185d0fd367bc7bb02155fb4958c968ea693","modified":1607939484042},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/ä¸»é¡µé¢.png","hash":"db0311a84f696ee037daad0f5615a276e3dd5b45","modified":1607939484044},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/clientLog.png","hash":"c6e768d071372e78d14584fb0c14b2794e5e788f","modified":1607939484026},{"_id":"source/_posts/ğŸ‡/ç‰Œå­.jpeg","hash":"24f95dd5ddc228a74e8ff4887a29431510ec6620","modified":1607939484079},{"_id":"source/_posts/ğŸ‡/å…¨æ™¯.jpeg","hash":"147aba5c942fd21ed61065267d438905756dc1fb","modified":1607939484070},{"_id":"public/content.json","hash":"85ca2cb097dc277477d4cd363b12032021282a73","modified":1608170243337},{"_id":"public/about/index.html","hash":"7f7bd263a36bdbc8484ad45f980cf4381de807e7","modified":1608170243337},{"_id":"public/categories/index.html","hash":"59a4f1780a5ce909a2fcc305edb2cefcaa5f207e","modified":1608170243337},{"_id":"public/tags/index.html","hash":"ea79614d7d74c996c5ae2599ee5207adc12c4655","modified":1608170243337},{"_id":"public/2019/09/07/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘/index.html","hash":"c9473ef8c72b2febb85a8f4788a0bc44cb9ca013","modified":1608170243337},{"_id":"public/2019/09/05/ğŸ‡/index.html","hash":"af061a9f0d4132a005f119630505f2388066ce57","modified":1608170243337},{"_id":"public/archives/index.html","hash":"c30f788d892d7547448562dbdec114613f2377e7","modified":1608170243337},{"_id":"public/archives/page/2/index.html","hash":"1ddc9437fe692c0a66585efd027b325d59976cd2","modified":1608170243337},{"_id":"public/archives/page/3/index.html","hash":"f62e88bad186482835123c94c4fbc370df5a8ecc","modified":1608170243337},{"_id":"public/archives/2019/index.html","hash":"7187fc043c6064f9ef8af99cacae2fa88bf9dfd6","modified":1608170243337},{"_id":"public/archives/2019/09/index.html","hash":"03d4ebb36c58f7a8f9f197f3e3c4a4ad004282ab","modified":1608170243337},{"_id":"public/archives/2020/index.html","hash":"08ac67495e4f043730c0cfd08dbd105a0ca69b36","modified":1608170243337},{"_id":"public/archives/2020/page/2/index.html","hash":"53f071193d4ea61c8f31c39a1bac38cb848fcbc7","modified":1608170243337},{"_id":"public/archives/2020/page/3/index.html","hash":"e942b3a83f01aca136aa1c1caedc4b95dc5e9502","modified":1608170243337},{"_id":"public/archives/2020/01/index.html","hash":"d3f298dd5803ea5042dc22ef07d37dceaec1d55d","modified":1608170243337},{"_id":"public/archives/2020/02/index.html","hash":"419e8361185d4c16fced07d795a9ab66094f7099","modified":1608170243337},{"_id":"public/archives/2020/03/index.html","hash":"78ef289fef963f910992d533a60077862f9abc31","modified":1608170243337},{"_id":"public/archives/2020/04/index.html","hash":"e984777b5693ac0250c22c1348071fbdb1de8fbe","modified":1608170243337},{"_id":"public/archives/2020/05/index.html","hash":"fc2a0f74c8960a84613d23de9949e4003f9f4e20","modified":1608170243337},{"_id":"public/archives/2020/06/index.html","hash":"c565736ad960021d2d7e66f19da8ffc01ade9064","modified":1608170243337},{"_id":"public/archives/2020/08/index.html","hash":"63f13f7f6e4209f7a3f4ff67a8da402f84d02727","modified":1608170243337},{"_id":"public/archives/2020/09/index.html","hash":"cc574969040002d6087f7496dafa42ea77ae4404","modified":1608170243337},{"_id":"public/archives/2020/10/index.html","hash":"d5dd1a1821acb2b03bcd6aee545760a63bc5bed4","modified":1608170243337},{"_id":"public/archives/2020/12/index.html","hash":"e50b35d07b4f228034393a954ddece31fb5b6c4c","modified":1608170243337},{"_id":"public/categories/Music/index.html","hash":"0fa68dd62cc33c504bce964dd0672b2b67b84461","modified":1608170243337},{"_id":"public/categories/Translation/index.html","hash":"53a5e06c0b0504e48470031e994e938c40e42486","modified":1608170243337},{"_id":"public/categories/Life/index.html","hash":"aae8461be9c43fe34b1ebe1572a204c1bea9615d","modified":1608170243337},{"_id":"public/tags/CSAPP/index.html","hash":"31030269aee6d7bf177b42cf672bf414d7e2b7e9","modified":1608170243337},{"_id":"public/tags/Harmonica/index.html","hash":"978e0a57c03de216631697eb26f7efa5464f1c30","modified":1608170243337},{"_id":"public/tags/Java/page/3/index.html","hash":"76745acffbc5f24e881312b06b1e6b3d46d2430f","modified":1608170243337},{"_id":"public/tags/IO/index.html","hash":"0e02955700828c5c1176b2275737d2327a916d5f","modified":1608170243337},{"_id":"public/tags/Springboot/index.html","hash":"3b1e4606c49a5f9b4f81049f19583afee5184bd8","modified":1608170243337},{"_id":"public/tags/Hexo/index.html","hash":"36e9d72f9ddf22cfa95626c3ceb120dc97348b0d","modified":1608170243337},{"_id":"public/tags/Linux/index.html","hash":"6bb5196fce5f902ce95356349362f8b7c9d0b743","modified":1608170243337},{"_id":"public/tags/Cache/index.html","hash":"04a3fb5b928136b497a7fd88f8e082d3694c96b7","modified":1608170243337},{"_id":"public/tags/GCC/index.html","hash":"b5340c46121a9220998da4d1f5eb2ab8e89d61df","modified":1608170243337},{"_id":"public/tags/ä»£ç ä¼˜åŒ–/index.html","hash":"5b234d74d4d1a64cb119a7ee2b44a777373f1378","modified":1608170243337},{"_id":"public/tags/AI/index.html","hash":"b23c89db5b5d7a62f61c363021a31091d8ac359e","modified":1608170243337},{"_id":"public/tags/APP/index.html","hash":"91329d3de5359521c9ce32d7c7b153aef8c97370","modified":1608170243337},{"_id":"public/tags/Spring-Boot/index.html","hash":"d03c9cafac9509e2f970972b5ed36f90d0af93af","modified":1608170243337},{"_id":"public/tags/Food/index.html","hash":"d5dc5e91b178d8d393e4642ad5703a157f2d8319","modified":1608170243337},{"_id":"public/tags/fastjson/index.html","hash":"ae2cd1cc83ac8aad41b8ef5df33e0786472aaf56","modified":1608170243337},{"_id":"public/tags/ASM/index.html","hash":"a1f3f0b6b89a3869ecf030896b564f16c6ff57cb","modified":1608170243337},{"_id":"public/2020/12/14/åˆ†æ”¯é¢„æµ‹-GCC-builtin-expect/index.html","hash":"387b32c7eb16d65ae41cac365bb1feb2e33b889f","modified":1608170243337},{"_id":"public/2020/12/11/è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è¯»å–-è§£æ/index.html","hash":"d7c95220e98f9256983a3c86b301025e8061950d","modified":1608170243337},{"_id":"public/2020/10/11/CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º/index.html","hash":"4bea0fabd4a7b99a3533a831d449eef58949cacd","modified":1608170243337},{"_id":"public/2020/09/24/linuxæä¾›åŠ è½½ã€å¤„ç†åŠ¨æ€é“¾æ¥åº“çš„ç³»ç»Ÿè°ƒç”¨æ–¹æ³•/index.html","hash":"d19750892a186e2060c5a78da3a4891e98520b9b","modified":1608170243337},{"_id":"public/2020/09/21/æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/index.html","hash":"df00a59c92cf80713cbb2d71c65b7c839c80702f","modified":1608170243337},{"_id":"public/2020/08/17/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/index.html","hash":"a37950f2eccd4073545130a16b2f9099a9307cb8","modified":1608170243337},{"_id":"public/2020/06/13/Harmonica/index.html","hash":"5ac0c9d0974216300077938b9f95fe5fb43826e0","modified":1608170243337},{"_id":"public/2020/05/30/åŸºäºFlinkå®ç°ç®€å•çš„æ—¥å¿—å¼‚å¸¸æ¨é€/index.html","hash":"c81e015c8c70b66a3f78e06e96cb42dfce6d6732","modified":1608170243337},{"_id":"public/2020/05/21/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/index.html","hash":"c26292bc70335b2a4bd77cd3bee3850665ed1120","modified":1608170243337},{"_id":"public/2020/05/16/åŸºäºFlinkè®¾è®¡ç»Ÿä¸€æŠ¥è­¦å¹³å°/index.html","hash":"2443f2e628a0c4052baa5b90f7b897c47f90f075","modified":1608170243337},{"_id":"public/2020/04/18/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»£ç ç¯‡/index.html","hash":"a6de1e317756388afa774824988dc27d431ee9a4","modified":1608170243337},{"_id":"public/2020/04/12/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡3/index.html","hash":"a4edb286287d0ebac9db96b09281bf5ec572f150","modified":1608170243337},{"_id":"public/2020/04/11/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/index.html","hash":"40c2f2c9bc07e43b36e7aa6f065d70616f750336","modified":1608170243337},{"_id":"public/2020/03/24/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡/index.html","hash":"133857a2cc0cf4a2248b6c99bc77cd7ae79ac6c7","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/index.html","hash":"94b22e467c6f57687c967ad8dbefa2717d1c694f","modified":1608170243337},{"_id":"public/2020/03/19/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-èµ·æºç¯‡/index.html","hash":"f0c9d14530e77375f8857988096f24d55f43664c","modified":1608170243337},{"_id":"public/2020/03/01/åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•æ•´ç†/index.html","hash":"f10a0712a7cc9d3d215e79def47cec4c2996315e","modified":1608170243337},{"_id":"public/2020/03/01/åˆ†å¸ƒå¼äº‹åŠ¡æ•´ç†/index.html","hash":"5c9280a24d9c6dc2b562a002a41830cb85a63d3d","modified":1608170243337},{"_id":"public/2020/02/22/JVM-æ•´ç†/index.html","hash":"5127ebe1b824dd37f2b43bfcfa9c7ed2b3377654","modified":1608170243337},{"_id":"public/2020/01/29/Spring-Boot/index.html","hash":"dcadcb74f34e3110150301a744d39bb6140a4ee9","modified":1608170243337},{"_id":"public/2020/01/29/NIO/index.html","hash":"17b194c5c59a71e7213fad8ca680581601dc145f","modified":1608170243337},{"_id":"public/2019/09/26/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4/index.html","hash":"425c6f047910886840f5cf02f4d4206e2b303f63","modified":1608170243337},{"_id":"public/2019/09/24/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜/index.html","hash":"f871c5f3b4ff537561c90206d326fd3ad0804948","modified":1608170243337},{"_id":"public/2019/09/13/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°3/index.html","hash":"1cb9391db2c825e4171787193cae24af1cfa507a","modified":1608170243337},{"_id":"public/2019/09/10/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°2/index.html","hash":"ce6add6fa52d06ca7e0fcadf9f584262f3c16c22","modified":1608170243337},{"_id":"public/2019/09/09/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1/index.html","hash":"43c45d56dbe22f256f8c6b8a3e03d22b969be14d","modified":1608170243337},{"_id":"public/2019/09/06/æœå¯»æµæµªç‹—APP/index.html","hash":"d43cfa298c9356ceccdb072eec957da14ae2214c","modified":1608170243337},{"_id":"public/2019/09/04/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/index.html","hash":"eff0400de92e712cb84d19dd441c526d88827f0d","modified":1608170243337},{"_id":"public/categories/Technology/index.html","hash":"5ff8c6b653a834bc73953ecf5918419bfac2d115","modified":1608170243337},{"_id":"public/categories/Technology/page/2/index.html","hash":"4f0075fe1165fa232e77ea73e55d595ef74a0ff1","modified":1608170243337},{"_id":"public/categories/Technology/page/3/index.html","hash":"5deb83cc7d4ba5e5d01a117112b37a9cc21f1254","modified":1608170243337},{"_id":"public/index.html","hash":"e12eb5d152f9e9e9c395cc5a0a4dbe3079aaf3ba","modified":1608170243337},{"_id":"public/page/2/index.html","hash":"61066b815f20d3453915fbffb987765c294250f8","modified":1608170243337},{"_id":"public/page/3/index.html","hash":"2cf68b2e6e51435bf0153267784d234ffa386705","modified":1608170243337},{"_id":"public/tags/C/index.html","hash":"11876a302e0894ea904a5c85bc38267d19504eba","modified":1608170243337},{"_id":"public/tags/JVM/index.html","hash":"5736f92ffa21db804b7df05c4f4ae521d25abf22","modified":1608170243337},{"_id":"public/tags/Java/index.html","hash":"c9a1ad0c8178180853414260e41801c17627b663","modified":1608170243337},{"_id":"public/tags/Java/page/2/index.html","hash":"3e3e0327e995490e861e5136f8261c0a8e61b9f5","modified":1608170243337},{"_id":"public/tags/Redis/index.html","hash":"4d6e184e2fced4eff90b5ddb4f0a1087ef4b0987","modified":1608170243337},{"_id":"public/tags/Flink/index.html","hash":"f2243ea57faf0df084c90704c3d8d5c71ed6ef71","modified":1608170243337},{"_id":"public/tags/ç›‘æ§/index.html","hash":"5a46173daf728bad9f19420416b453770d07d8be","modified":1608170243337},{"_id":"public/tags/é…ç½®ä¸­å¿ƒ/index.html","hash":"82d08e930c2a30e191c5c9a91586c6b72a058a61","modified":1608170243337},{"_id":"public/tags/Go/index.html","hash":"494e11fd67a3d6972b0a75b51db04c934e97fc02","modified":1608170243337},{"_id":"public/images/check.svg","hash":"029b8b3523b7daa4005983b4463cd93408308aab","modified":1608170243337},{"_id":"public/images/exclamation.svg","hash":"b2db56f2cc13fce73dbea46c7b446d9bcb3bf0fd","modified":1608170243337},{"_id":"public/images/info.svg","hash":"c8aa387e935ba9a7fa72c5dd000b7d46f2e030c4","modified":1608170243337},{"_id":"public/images/logo.png","hash":"4e012d9ba58cb8f87ee775262ef871c158ac5948","modified":1608170243337},{"_id":"public/images/question.svg","hash":"7153fa2a0c21e32da6a1f96a333d8b66a178569d","modified":1608170243337},{"_id":"public/images/quote-left.svg","hash":"d2561fa8d13e63ff196b71232a5968415ec6e372","modified":1608170243337},{"_id":"public/2020/10/11/CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º/pull.png","hash":"75df3bb37ab4153db6a76effdd1f3caa3fd26aae","modified":1608170243337},{"_id":"public/2019/09/07/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘/nolayout.jpg","hash":"b7e6217718a630562255060b224ee116d1caf824","modified":1608170243337},{"_id":"public/2019/09/04/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/springCache.png","hash":"244dfd7e60a2e01dbd8ed66d5f0828db5737c32d","modified":1608170243337},{"_id":"public/2020/05/21/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/flink-local.png","hash":"7b4ba65ffb265a902ba1857a4d9b44b87e780b77","modified":1608170243337},{"_id":"public/2020/05/21/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-dashboard.png","hash":"3992562c00d407b4e57860b7037eb0d8e63e22d8","modified":1608170243337},{"_id":"public/2020/05/21/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-message.png","hash":"71a6a78f475da2a55fae3fc6ae1339e1e9840238","modified":1608170243337},{"_id":"public/2020/05/21/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-topic.png","hash":"8e3049784ffdb24584139f37b5d6aff0943663fe","modified":1608170243337},{"_id":"public/2020/05/21/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/wechat-message.png","hash":"2f4f5d8186da8887cc614bc0941c3a0aa47377d0","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/addGroup.png","hash":"a5b0ba884bb632b2125bee606bf3016966692e4a","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/history.png","hash":"eb8dac42b2ba7119a89b7c74cbb81e56d03410f9","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/instanceConfig.png","hash":"764b4c39797d533ab1195b65f32d06cc32ce819a","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/switch.png","hash":"92060e35ba1f4220ebb8164c07cdf9da2e280fb7","modified":1608170243337},{"_id":"public/2020/04/11/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/CentOS6-Base-163.repo","hash":"c601efdaeb8c55cb0dea2cade8976c5a8de366ac","modified":1608170243337},{"_id":"public/2020/04/11/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/å®¢æˆ·ç«¯å¯åŠ¨å¹¶æ›´æ–°é…ç½®.png","hash":"fbae1f8e0ac320887b72000346d5dd079ed12a06","modified":1608170243337},{"_id":"public/2020/04/11/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/æœåŠ¡ç«¯çƒ­æ›´æ–°é…ç½®.png","hash":"985f1bfbd2bbdf087c49ff3b6f81f51ac5c81afc","modified":1608170243337},{"_id":"public/2019/09/09/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1/gopath.png","hash":"651d1a1fb00e3250828a1e1570d1ee3f842774ca","modified":1608170243337},{"_id":"public/2020/08/17/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/classloadæ–­ç‚¹.png","hash":"b23555690fff99fec7bc4dd33042c62de64194ca","modified":1608170243337},{"_id":"public/2020/08/17/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/idea.png","hash":"e3aa184adced51bc89141426a7e9eae9724dbb55","modified":1608170243337},{"_id":"public/2020/08/17/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/jps.png","hash":"fdaf08415d96c17407a1f77a4c67bd69e218f8ad","modified":1608170243337},{"_id":"public/2020/10/11/CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º/search.png","hash":"315b8aae526635a45d325d6ea6c649cffc3d8043","modified":1608170243337},{"_id":"public/2019/09/04/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/å¤šçº§ç¼“å­˜.png","hash":"22fa4a74b7c688ad6fbb3a3a56c585d2acf0dfef","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/allocateConfigs.png","hash":"a7f351d59d8948559064c6ed1d808e31ef76c91f","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/instance.png","hash":"3a743c6ff182b6f977979beaad06c4d94c4646bc","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/æœåŠ¡éƒ¨ç½²å›¾.png","hash":"04a4f44f1a92e70be92a938141b08baba5105f78","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/æ³¨å†Œ.png","hash":"8adb68e1e6c05139f9fabb380ba6a984e058fbca","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/ç™»å½•.png","hash":"df8b35801e8237cb7eb74a269c1e1c8b1899eeac","modified":1608170243337},{"_id":"public/2019/09/26/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4/è¿è¡Œæ—¶æ•°æ®åŒº.png","hash":"5057a5c3a444bc1720a6bf1951d4d3c373386042","modified":1608170243337},{"_id":"public/2020/08/17/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/BytecodeVerificationJunit.png","hash":"2bd9676494ca25f8c2dd764a699dbc1bc2313f25","modified":1608170243337},{"_id":"public/2020/08/17/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/BytecodeVerificationWithApp.png","hash":"5d99578cc973f9f91e331e522855b49671335fff","modified":1608170243337},{"_id":"public/2020/08/17/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/hdbs_attach.png","hash":"46e16f350e4b03fcdc63c3091fda3ced1df1c6a6","modified":1608170243337},{"_id":"public/2020/09/21/æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/flow.png","hash":"f63f7bc7a865169a4803508758f08ac516202f7c","modified":1608170243337},{"_id":"public/2020/06/13/Harmonica/GodenMelody.jpeg","hash":"1776a2747e1fc0461dd769cb7ec7aa577b973f40","modified":1608170243337},{"_id":"public/2020/06/13/Harmonica/SilverStar.jpeg","hash":"6eb1ea1ca65799a6ed267b9ebc12d34a5ea0c19c","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/processingTask.png","hash":"5c6ee9c2839a24498c22fff99e8e3a5dc6e9b009","modified":1608170243337},{"_id":"public/css/insight.css","hash":"f376dcda6bb50b708f3206c15a49f7530b3c534d","modified":1608170243337},{"_id":"public/css/style.css","hash":"414ec8f0ec0ca697461584b0fec4ec5862ff253d","modified":1608170243337},{"_id":"public/js/insight.js","hash":"eb23c31141784eef7300f1d1c548950e77883f56","modified":1608170243337},{"_id":"public/js/script.js","hash":"6b670ec4f90fb43b21a0bbd750a217af5d8aab6b","modified":1608170243337},{"_id":"public/2019/09/24/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜/wenti.png","hash":"e6843d420e7ad46c852f2f041812eb927fb1399d","modified":1608170243337},{"_id":"public/2020/08/17/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/class_browser.png","hash":"f7e9280fe7d8b713553007e01090c60d647e6642","modified":1608170243337},{"_id":"public/2020/09/21/æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/JVM_start.png","hash":"5b2169fad1184aec8b62f8e544a4fd27b66a9453","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/compare.png","hash":"6b238e8bf72dbef0c21966e8ce06dead8f79e73f","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/completeTask.png","hash":"18c9d03bc8c0aa4819d08f019774a966bfe1f210","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/configs.png","hash":"c238a9fe76aaab46faef9dee3478e0683959f7ad","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/metadata.png","hash":"713f1ece021f460bc8aa35e145464d6ee39b6712","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/pendingTask.png","hash":"7fe73f7083117304989e685121fef0eacf97cd02","modified":1608170243337},{"_id":"public/2020/08/17/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/constantpool.png","hash":"a0154820aa5801757cfaf904dcbe4c857a51ef8b","modified":1608170243337},{"_id":"public/2020/08/17/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/visualVM.png","hash":"fa05315b76c1eeedb588d86dd6d2443e3b3dca57","modified":1608170243337},{"_id":"public/2020/09/21/æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/load_agent_library.png","hash":"50b8fd1d0dd9a7fdd344fed44dbf237acca73451","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/allocate.png","hash":"bcc93b6de9ee67bf69cffa491ba32bacf5882942","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/operationLog.png","hash":"5b01191dd79eedd699843c15bbde293d7fa49a7c","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/role.png","hash":"1a2a190711181260a79e264b5d4cdde5cf3ec50b","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/user.png","hash":"5359c185d0fd367bc7bb02155fb4958c968ea693","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/ä¸»é¡µé¢.png","hash":"db0311a84f696ee037daad0f5615a276e3dd5b45","modified":1608170243337},{"_id":"public/2020/03/20/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/clientLog.png","hash":"c6e768d071372e78d14584fb0c14b2794e5e788f","modified":1608170243337},{"_id":"public/2019/09/05/ğŸ‡/ç‰Œå­.jpeg","hash":"24f95dd5ddc228a74e8ff4887a29431510ec6620","modified":1608170243337},{"_id":"public/2019/09/05/ğŸ‡/å…¨æ™¯.jpeg","hash":"147aba5c942fd21ed61065267d438905756dc1fb","modified":1608170243337}],"Category":[{"name":"Technology","_id":"ckis71ht00004v25299na538q"},{"name":"Music","_id":"ckis71ht5000av252cpwx47dv"},{"name":"Translation","_id":"ckis71htr001mv252fp9k9bwp"},{"name":"Life","_id":"ckis71hu00028v252enjlgu71"}],"Data":[],"Page":[{"title":"about","date":"2019-09-04T03:48:57.000Z","_content":"","source":"about/index.md","raw":"---\ntitle: about\ndate: 2019-09-04 11:48:57\n---\n","updated":"2020-12-14T09:51:24.080Z","path":"about/index.html","comments":1,"layout":"page","_id":"ckis71hsp0000v2526pag8h39","content":"","site":{"data":{}},"_categories":[],"_tags":[],"excerpt":"","more":""},{"title":"categories","date":"2019-09-04T03:49:09.000Z","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2019-09-04 11:49:09\n---\n","updated":"2020-12-14T09:51:24.080Z","path":"categories/index.html","comments":1,"layout":"page","_id":"ckis71hsy0002v2529gck34k8","content":"","site":{"data":{}},"_categories":[],"_tags":[],"excerpt":"","more":""},{"title":"tags","date":"2019-09-04T03:48:44.000Z","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2019-09-04 11:48:44\n---\n","updated":"2020-12-14T09:51:24.172Z","path":"tags/index.html","comments":1,"layout":"page","_id":"ckis71ht20006v2524e2q455n","content":"","site":{"data":{}},"_categories":[],"_tags":[],"excerpt":"","more":""}],"Post":[{"title":"CSAPP Dockerå®éªŒç¯å¢ƒæ­å»º","date":"2020-10-11T09:57:26.000Z","_content":"\nCSAPP çš„Dockerå®éªŒç¯å¢ƒåœ¨windowsä¸‹çš„å®‰è£…è¿‡ç¨‹ï¼ŒMacOSä¸‹ä¸€è‡´ã€‚\n<!-- more -->\n### æœç´¢ubuntué•œåƒ\n``` shell\ndocker search ubuntu\n```\n\n![01](CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º/search.png)\n\n### æ‹‰å–æœ€æ–°é•œåƒ\n``` shell\ndocker pull ubuntu:latest\n```\n\n![02](CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º/pull.png)\n\n### é…ç½®å¹¶å¯åŠ¨ubuntuå®¹å™¨\n1. -it ä¸­æ–­äº¤äº’å¼\n2. -v å…±äº«ç›®å½•æœ€å¥½æŒ‡å®šè‡ªå·±çš„çš„å®éªŒç›®å½• (D:\\work\\workspace_c\\CSAPP_LAB:csapplab)\n3. -name å®¹å™¨åç§°\n4. /bin/bash å®¹å™¨å¯åŠ¨åè¿è¡Œbash\n``` shell\ndocker run -it -v D:\\work\\workspace_c\\CSAPP_LAB:/csapplab --name=csapp_env ubuntu:latest /bin/bash\n```\n\n### é…ç½®ubuntuå®éªŒç¯å¢ƒ\n1. æ›´æ–°aptè½¯ä»¶æº\n``` shell\napt-get update\n```\n\n2. å®‰è£…sudo\n``` shell\napt-get instull sudo\n```\n\n3. å®‰è£…vim\n``` shell\napt-get instull vim\n```\n\n4. å®‰è£…c/c++ç¼–è¯‘ç¯å¢ƒ\n``` shell\nsudo apt-get install build-essential\nsudo apt-get install gcc-multilib\n```\n\n### é€€å‡ºå®¹å™¨\n``` shell\nexit\n```\n\n### åœæ­¢å®¹å™¨\n``` shell\ndocker stop csapp_env\n```\n\n### å¯åŠ¨&è¿›å…¥å®¹å™¨\n``` shell\ndocker start csapp_env\ndocker exec -it csapp_env /bin/bash\n```","source":"_posts/CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º.md","raw":"---\ntitle: CSAPP Dockerå®éªŒç¯å¢ƒæ­å»º\ndate: 2020-10-11 17:57:26\ntags: \n    - CSAPP\n    - C\ncategories :\n    - Technology\n---\n\nCSAPP çš„Dockerå®éªŒç¯å¢ƒåœ¨windowsä¸‹çš„å®‰è£…è¿‡ç¨‹ï¼ŒMacOSä¸‹ä¸€è‡´ã€‚\n<!-- more -->\n### æœç´¢ubuntué•œåƒ\n``` shell\ndocker search ubuntu\n```\n\n![01](CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º/search.png)\n\n### æ‹‰å–æœ€æ–°é•œåƒ\n``` shell\ndocker pull ubuntu:latest\n```\n\n![02](CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º/pull.png)\n\n### é…ç½®å¹¶å¯åŠ¨ubuntuå®¹å™¨\n1. -it ä¸­æ–­äº¤äº’å¼\n2. -v å…±äº«ç›®å½•æœ€å¥½æŒ‡å®šè‡ªå·±çš„çš„å®éªŒç›®å½• (D:\\work\\workspace_c\\CSAPP_LAB:csapplab)\n3. -name å®¹å™¨åç§°\n4. /bin/bash å®¹å™¨å¯åŠ¨åè¿è¡Œbash\n``` shell\ndocker run -it -v D:\\work\\workspace_c\\CSAPP_LAB:/csapplab --name=csapp_env ubuntu:latest /bin/bash\n```\n\n### é…ç½®ubuntuå®éªŒç¯å¢ƒ\n1. æ›´æ–°aptè½¯ä»¶æº\n``` shell\napt-get update\n```\n\n2. å®‰è£…sudo\n``` shell\napt-get instull sudo\n```\n\n3. å®‰è£…vim\n``` shell\napt-get instull vim\n```\n\n4. å®‰è£…c/c++ç¼–è¯‘ç¯å¢ƒ\n``` shell\nsudo apt-get install build-essential\nsudo apt-get install gcc-multilib\n```\n\n### é€€å‡ºå®¹å™¨\n``` shell\nexit\n```\n\n### åœæ­¢å®¹å™¨\n``` shell\ndocker stop csapp_env\n```\n\n### å¯åŠ¨&è¿›å…¥å®¹å™¨\n``` shell\ndocker start csapp_env\ndocker exec -it csapp_env /bin/bash\n```","slug":"CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º","published":1,"updated":"2020-12-14T10:37:40.145Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71hsv0001v252awm830es","content":"<html><head></head><body><p>CSAPP &#x7684;Docker&#x5B9E;&#x9A8C;&#x73AF;&#x5883;&#x5728;windows&#x4E0B;&#x7684;&#x5B89;&#x88C5;&#x8FC7;&#x7A0B;&#xFF0C;MacOS&#x4E0B;&#x4E00;&#x81F4;&#x3002;</p>\n<a id=\"more\"></a>\n<h3 id=\"&#x641C;&#x7D22;ubuntu&#x955C;&#x50CF;\"><a href=\"#&#x641C;&#x7D22;ubuntu&#x955C;&#x50CF;\" class=\"headerlink\" title=\"&#x641C;&#x7D22;ubuntu&#x955C;&#x50CF;\"></a>&#x641C;&#x7D22;ubuntu&#x955C;&#x50CF;</h3><figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker search ubuntu</span><br></pre></td></tr></tbody></table></figure>\n\n<p><img src=\"/2020/10/11/CSAPP-Docker%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/search.png\" alt=\"01\"></p>\n<h3 id=\"&#x62C9;&#x53D6;&#x6700;&#x65B0;&#x955C;&#x50CF;\"><a href=\"#&#x62C9;&#x53D6;&#x6700;&#x65B0;&#x955C;&#x50CF;\" class=\"headerlink\" title=\"&#x62C9;&#x53D6;&#x6700;&#x65B0;&#x955C;&#x50CF;\"></a>&#x62C9;&#x53D6;&#x6700;&#x65B0;&#x955C;&#x50CF;</h3><figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull ubuntu:latest</span><br></pre></td></tr></tbody></table></figure>\n\n<p><img src=\"/2020/10/11/CSAPP-Docker%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/pull.png\" alt=\"02\"></p>\n<h3 id=\"&#x914D;&#x7F6E;&#x5E76;&#x542F;&#x52A8;ubuntu&#x5BB9;&#x5668;\"><a href=\"#&#x914D;&#x7F6E;&#x5E76;&#x542F;&#x52A8;ubuntu&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;&#x5E76;&#x542F;&#x52A8;ubuntu&#x5BB9;&#x5668;\"></a>&#x914D;&#x7F6E;&#x5E76;&#x542F;&#x52A8;ubuntu&#x5BB9;&#x5668;</h3><ol>\n<li>-it &#x4E2D;&#x65AD;&#x4EA4;&#x4E92;&#x5F0F;</li>\n<li>-v &#x5171;&#x4EAB;&#x76EE;&#x5F55;&#x6700;&#x597D;&#x6307;&#x5B9A;&#x81EA;&#x5DF1;&#x7684;&#x7684;&#x5B9E;&#x9A8C;&#x76EE;&#x5F55; (D:\\work\\workspace_c\\CSAPP_LAB:csapplab)</li>\n<li>-name &#x5BB9;&#x5668;&#x540D;&#x79F0;</li>\n<li>/bin/bash &#x5BB9;&#x5668;&#x542F;&#x52A8;&#x540E;&#x8FD0;&#x884C;bash<figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it -v D:\\work\\workspace_c\\CSAPP_LAB:/csapplab --name=csapp_env ubuntu:latest /bin/bash</span><br></pre></td></tr></tbody></table></figure>\n\n</li>\n</ol>\n<h3 id=\"&#x914D;&#x7F6E;ubuntu&#x5B9E;&#x9A8C;&#x73AF;&#x5883;\"><a href=\"#&#x914D;&#x7F6E;ubuntu&#x5B9E;&#x9A8C;&#x73AF;&#x5883;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;ubuntu&#x5B9E;&#x9A8C;&#x73AF;&#x5883;\"></a>&#x914D;&#x7F6E;ubuntu&#x5B9E;&#x9A8C;&#x73AF;&#x5883;</h3><ol>\n<li><p>&#x66F4;&#x65B0;apt&#x8F6F;&#x4EF6;&#x6E90;</p>\n<figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get update</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li><p>&#x5B89;&#x88C5;sudo</p>\n<figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get instull sudo</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li><p>&#x5B89;&#x88C5;vim</p>\n<figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get instull vim</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li><p>&#x5B89;&#x88C5;c/c++&#x7F16;&#x8BD1;&#x73AF;&#x5883;</p>\n<figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install build-essential</span><br><span class=\"line\">sudo apt-get install gcc-multilib</span><br></pre></td></tr></tbody></table></figure>\n\n</li>\n</ol>\n<h3 id=\"&#x9000;&#x51FA;&#x5BB9;&#x5668;\"><a href=\"#&#x9000;&#x51FA;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x9000;&#x51FA;&#x5BB9;&#x5668;\"></a>&#x9000;&#x51FA;&#x5BB9;&#x5668;</h3><figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exit</span><br></pre></td></tr></tbody></table></figure>\n\n<h3 id=\"&#x505C;&#x6B62;&#x5BB9;&#x5668;\"><a href=\"#&#x505C;&#x6B62;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x505C;&#x6B62;&#x5BB9;&#x5668;\"></a>&#x505C;&#x6B62;&#x5BB9;&#x5668;</h3><figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker stop csapp_env</span><br></pre></td></tr></tbody></table></figure>\n\n<h3 id=\"&#x542F;&#x52A8;-amp-&#x8FDB;&#x5165;&#x5BB9;&#x5668;\"><a href=\"#&#x542F;&#x52A8;-amp-&#x8FDB;&#x5165;&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x542F;&#x52A8;&amp;&#x8FDB;&#x5165;&#x5BB9;&#x5668;\"></a>&#x542F;&#x52A8;&amp;&#x8FDB;&#x5165;&#x5BB9;&#x5668;</h3><figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker start csapp_env</span><br><span class=\"line\">docker exec -it csapp_env /bin/bash</span><br></pre></td></tr></tbody></table></figure></body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"CSAPP","path":"tags/CSAPP/"},{"name":"C","path":"tags/C/"}],"excerpt":"<html><head></head><body><p>CSAPP &#x7684;Docker&#x5B9E;&#x9A8C;&#x73AF;&#x5883;&#x5728;windows&#x4E0B;&#x7684;&#x5B89;&#x88C5;&#x8FC7;&#x7A0B;&#xFF0C;MacOS&#x4E0B;&#x4E00;&#x81F4;&#x3002;</p></body></html>","more":"<h3 id=\"æœç´¢ubuntué•œåƒ\"><a href=\"#æœç´¢ubuntué•œåƒ\" class=\"headerlink\" title=\"æœç´¢ubuntué•œåƒ\"></a>æœç´¢ubuntué•œåƒ</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker search ubuntu</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2020/10/11/CSAPP-Docker%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/search.png\" alt=\"01\"></p>\n<h3 id=\"æ‹‰å–æœ€æ–°é•œåƒ\"><a href=\"#æ‹‰å–æœ€æ–°é•œåƒ\" class=\"headerlink\" title=\"æ‹‰å–æœ€æ–°é•œåƒ\"></a>æ‹‰å–æœ€æ–°é•œåƒ</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull ubuntu:latest</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2020/10/11/CSAPP-Docker%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/pull.png\" alt=\"02\"></p>\n<h3 id=\"é…ç½®å¹¶å¯åŠ¨ubuntuå®¹å™¨\"><a href=\"#é…ç½®å¹¶å¯åŠ¨ubuntuå®¹å™¨\" class=\"headerlink\" title=\"é…ç½®å¹¶å¯åŠ¨ubuntuå®¹å™¨\"></a>é…ç½®å¹¶å¯åŠ¨ubuntuå®¹å™¨</h3><ol>\n<li>-it ä¸­æ–­äº¤äº’å¼</li>\n<li>-v å…±äº«ç›®å½•æœ€å¥½æŒ‡å®šè‡ªå·±çš„çš„å®éªŒç›®å½• (D:\\work\\workspace_c\\CSAPP_LAB:csapplab)</li>\n<li>-name å®¹å™¨åç§°</li>\n<li>/bin/bash å®¹å™¨å¯åŠ¨åè¿è¡Œbash<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -it -v D:\\work\\workspace_c\\CSAPP_LAB:/csapplab --name=csapp_env ubuntu:latest /bin/bash</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h3 id=\"é…ç½®ubuntuå®éªŒç¯å¢ƒ\"><a href=\"#é…ç½®ubuntuå®éªŒç¯å¢ƒ\" class=\"headerlink\" title=\"é…ç½®ubuntuå®éªŒç¯å¢ƒ\"></a>é…ç½®ubuntuå®éªŒç¯å¢ƒ</h3><ol>\n<li><p>æ›´æ–°aptè½¯ä»¶æº</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get update</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>å®‰è£…sudo</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get instull sudo</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>å®‰è£…vim</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get instull vim</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>å®‰è£…c/c++ç¼–è¯‘ç¯å¢ƒ</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install build-essential</span><br><span class=\"line\">sudo apt-get install gcc-multilib</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h3 id=\"é€€å‡ºå®¹å™¨\"><a href=\"#é€€å‡ºå®¹å™¨\" class=\"headerlink\" title=\"é€€å‡ºå®¹å™¨\"></a>é€€å‡ºå®¹å™¨</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exit</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"åœæ­¢å®¹å™¨\"><a href=\"#åœæ­¢å®¹å™¨\" class=\"headerlink\" title=\"åœæ­¢å®¹å™¨\"></a>åœæ­¢å®¹å™¨</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker stop csapp_env</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"å¯åŠ¨-amp-è¿›å…¥å®¹å™¨\"><a href=\"#å¯åŠ¨-amp-è¿›å…¥å®¹å™¨\" class=\"headerlink\" title=\"å¯åŠ¨&amp;è¿›å…¥å®¹å™¨\"></a>å¯åŠ¨&amp;è¿›å…¥å®¹å™¨</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker start csapp_env</span><br><span class=\"line\">docker exec -it csapp_env /bin/bash</span><br></pre></td></tr></table></figure>"},{"title":"Harmonica","date":"2020-06-13T02:07:08.000Z","_content":"\nå¼€ä¸ªå‘ï¼Œæ—¶ä¸æ—¶åˆ†äº«ä¸‹è‡ªå·±å’Œå£ç´ï¼Œæƒå½“è®°å½•è‡ªå·±å’ŒéŸ³ä¹é‚£ä»…æœ‰çš„ç¼˜åˆ†äº†ğŸ˜‚ã€‚\n<!-- more -->\néŸ³ä¹ç™½ç—´æƒ³è¦å­¦ä¹å™¨ï¼Œç½‘ä¸Šéšä¾¿ä¸€æœï¼Œå¤§å¤šæ•°äººéƒ½ä¼šæ¨èå‰ä»–ï¼Œå…¶æ¬¡å¯èƒ½æ˜¯ç”µå­ç´ã€‚ç¾å…¶åæ›°å‰ä»–ä¸Šæ‰‹å¿«ï¼Œè€Œä¸”å¯ä»¥ä¼´å¥ã€‚é‚£æˆ‘è¿™ç§äº”éŸ³ä¸å…¨åŠ æœ¨è€³è‚¯å®šç¬¬ä¸€ä¸ªå°±æ·˜æ±°äº†,æ­£å·§è¿™ä¸ªæ—¶å€™åœ¨ç½‘ä¸Šçœ‹åˆ°äº†ä¸€æ®µè§†å± é¾™ç™»æ°æ¼”å¥çš„Flower Danceã€‚\n<iframe src=\"//player.bilibili.com/player.html?aid=27879949&bvid=BV17s411A7bv&cid=48145340&page=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\"> </iframe>\n\nFlower Danceå·²ç»è¢«å„ç§ä¹å™¨å¤§ç¥æ¼”ç»è¿‡äº†ï¼Œä½†é¾™ç™»æ°çš„åŠéŸ³é˜¶çœŸçš„æ˜¯è®©æˆ‘æµ‘èº«é¸¡çš®ç–™ç˜©ã€‚å£ç´è™½ç„¶æ²¡æœ‰é’¢ç´ç‰ˆä¼˜ç¾çš„éŸ³è‰²ï¼Œä¹Ÿæ²¡æœ‰å‰ä»–ç‰ˆçš„è‡ªç„¶ï¼Œä½†æ˜¯ç°åœºçš„æ„ŸæŸ“åŠ›çœŸçš„æ˜¯æ— äººèƒ½æ¯”ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œé’¢ç´é€‚åˆä¸ºä»–äººæ¼”å¥ï¼Œä½†å£ç´æ›´åƒæ˜¯ç»™è‡ªå·±çš„éŸ³ä¹ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå¯¹æˆ‘ä»¬è¿™ç§äº”éŸ³ä¸å…¨çš„æ„å‘³ç€æ ¹æœ¬ä¸ç”¨è€ƒè™‘å”±æ­Œè¿™ä»¶äº‹äº†ğŸ˜‚ã€‚\n\nå£ç´æœ¬èº«ä¹Ÿåˆ†å¾ˆå¤šç§ï¼šåŠéŸ³é˜¶ã€å¤éŸ³ã€å¸ƒé²æ–¯ç­‰ã€‚ä½œä¸ºåˆå­¦è€…çš„è¯ä¸ªäººè®¤ä¸ºå¸ƒé²æ–¯ä¼šæ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚è™½ç„¶ä¸åƒåŠéŸ³é˜¶èƒ½å¹å‡ºå…¨éŸ³ç¬¦ï¼Œä¹Ÿä¸åƒå¤éŸ³éŸ³é˜¶æ¯”è¾ƒå¤šï¼ˆå…¶å®æˆ‘ä»¬å°æ—¶å€™æ¥è§¦çš„å¤§ä¸ç¬¦å£ç´éƒ½æ˜¯å¤éŸ³å£ç´ï¼‰ã€‚ä½†å¸ƒé²æ–¯æœ¬èº«å°å·§ï¼Œåœ¨ä¸æŒæ¡å¤æ‚æŠ€å·§çš„å‰æä¸‹å°±èƒ½å¹å¥å¤§é‡çš„ä¹æ›²ã€‚\nå”¯ä¸€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¸ƒé²æ–¯å°±å¦‚å…¶åï¼Œè¿‡å»æ˜¯é»‘äººä¹æ‰‹å¤§é‡å¹å¥å¸ƒé²æ–¯éŸ³ä¹æ—¶ä½¿ç”¨çš„ã€‚æ‰€ä»¥å®ƒçš„éŸ³è‰²äº¤åŠéŸ³é˜¶ä¸ªäººè§‰å¾—ç¨æ˜¾æµ‘åšã€‚ä¸è¿‡æˆ‘è§‰å¾—è¿™ä¹Ÿæ˜¯å¸ƒé²æ–¯å£ç´æœ€å¤§çš„ç‰¹è‰²ã€‚å¹å¯¹çš„æ­Œï¼Œæˆ–è€…è¯´æŒæ§äº†éŸ³è‰²ï¼Œé‚£æ—¶å€™å°±æ˜¯å¸ƒé²æ–¯æœ€å¼ºçš„æ—¶å€™ã€‚åŒæ—¶æœ€ä¸ºå³å…´ï¼Œå¸ƒé²æ–¯ä¹Ÿæ˜¯æœ€ä¸ºé€‚åˆçš„ï¼Œå½“ç„¶é‚£éƒ½æ˜¯å¤§ç¥ä»¬çš„é¢†åŸŸå°±æ˜¯äº†ã€‚\n\næˆ‘çš„ç¬¬ä¸€æŠŠå¸ƒé²æ–¯å£ç´ï¼š\n\n![01](Harmonica/SilverStar.jpeg)\n\nHohner(èµ«è±)åœ¨å£ç´ç•Œæ˜¯å‡ å¤§å“ç‰Œä¹‹ä¸€ï¼Œæœ€ä¸ºå¾·å›½çš„å“ç‰Œå…¶è´¨é‡ä¸€ç›´æ˜¯å¹¿å¤§ç´å‹å£å£ç›¸ä¼ çš„ã€‚ä½†è¿™å§SilverStarå°±å¦å½“åˆ«è®ºäº†ï¼Œè¦æ¯”å–»çš„è¯å°±ç±»ä¼¼å¾·å›½å®é©¬å’Œå›½äº§å®é©¬çš„åŒºåˆ«ã€‚\n\né¦–å…ˆåšå·¥å°±ä¸ç»å¦‚äººæ„ï¼Œè¿æ°”ä¸å¥½çš„è¯ï¼Œæœ‰äº›éŸ³å£å¯èƒ½ä¼šæœ‰æ°”å¯†æ€§çš„é—®é¢˜ã€‚ç›´æ¥å¯¼è‡´äº†æœ‰äº›éŸ³å¯èƒ½å¾ˆéš¾å¹ã€‚\n\nå…¶æ¬¡ç°§ç‰‡åé¦ˆå¾ˆè¯¡å¼‚ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä¸ªäººçš„æ„Ÿè§‰ã€‚æœ‰äº›éŸ³å¾ˆå®¹æ˜“å°±å¹å‡ºæ¥äº†ï¼Œä½†è¶Šæ˜¯ä½éŸ³æˆ–è€…é«˜éŸ³ï¼Œå¹å¥éš¾åº¦å°±è¶Šé«˜ã€‚å£ç´æ–°æ‰‹æœ€å¤§çš„ä¸€ä¸ªåå°±æ˜¯å‹éŸ³ï¼Œå¦‚æœä¸å·§éœ€è¦å‹éŸ³çš„é‚£å‡ ä¸ªéŸ³å¾ˆéš¾å¹ï¼Œé‚£å¯¹æ–°æ‰‹æ¥è¯´å¯èƒ½æ˜¯æ¯ç­æ€§çš„æ‰“å‡»ã€‚ã€‚ã€‚è®°å¾—æœ€æ—©ç»ƒä¹ å‹éŸ³çš„æ—¶å€™ï¼Œè¿™æŠŠSilverStaræ­»æ´»éƒ½æ²¡æ³•æˆåŠŸï¼Œåªè¦æ¢äº†æŠŠæ›´å¥½çš„åæ‰æ¸æ¸æ‰¾åˆ°å‹éŸ³çš„æ„Ÿè§‰ã€‚æ—¥åå›åˆ°è¿™æŠŠSilverStarä¸Šå±…ç„¶ç¥å¥‡çš„ä¹Ÿæ‰¾åˆ°äº†å‹éŸ³çš„æ„Ÿè§‰ï¼Œè¯´æ¥ä¹Ÿæ˜¯å¥‡å¦™å•Šã€‚\n\nç¬¬äºŒæŠŠå£ç´ï¼š\n\n![02](Harmonica/GodenMelody.jpeg)\n\næˆ‘çš„ç¬¬äºŒæŠŠå£ç´è¿˜æ˜¯Hohnerï¼Œä½†è¿™æŠŠæ˜¯çœŸçœŸåˆ‡åˆ‡çš„åŸå‚å£ç´ã€‚å°300çš„ä»·æ ¼ä¹Ÿç®—å¸ƒé²æ–¯é‡Œçš„åŠ³åŠ›å£«äº†ğŸ˜‚ã€‚\n\nè¿™æŠŠå£ç´çš„é€ å‹å°±éå¸¸æœ‰ç‰¹è‰²ï¼Œæ¢³å­å‹è®¾è®¡éå¸¸åˆ«è‡´ã€‚å’Œå…¶ä»–é«˜ç«¯å£ç´ä¸€æ ·ï¼Œç´å°ºé‡‡ç”¨äº†å…¨åŒ…å›´çš„è®¾è®¡ã€‚ä¸æ—¥å‚é“ƒæœ¨çš„å£è½»ç›¸æ¯”ï¼Œé“ƒæœ¨ç»™äººçš„æ„Ÿè§‰æ›´åŠ åœ†æ¶¦ï¼Œè€Œè¿™æŠŠåœ¨åœ†æ¶¦çš„å‰æä¸‹åˆä¸å¤±è±ªæ”¾çš„è®¾è®¡ã€‚çº¯é“¶è‰²çš„ç´èº«å’Œçº¢è‰²çš„ç´å°ºç›¸å¾—ç›Šå½°ã€‚\n\nå’Œä¹‹å‰ä¸€æŠŠå£ç´å¹èµ·æ¥ï¼Œä¸Šå˜´çš„é‚£ä¸€åˆ¹é‚£ä»¿ä½›æ‹¿åˆ°äº†ä¸€ä¸ªæ–°ä¹å™¨ã€‚ç»å¯¹æ˜¯è¦é€‚åº”ä¸‹æ‰èƒ½æ­£å¸¸æ¼”å¥çš„ï¼Œä¸è¿‡ä¸€æ—¦ä¹ æƒ¯åï¼Œä¸è®ºéŸ³è‰²è¿˜æ˜¯åé¦ˆéƒ½è¿œè¿œå¼ºäºä¹‹å‰çš„é‚£æŠŠè´´ç‰Œè´§ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨è¿™æŠŠå£ç´ä¸Šå­¦ä¼šçš„å¦‚ä½•å‹éŸ³ã€‚å¦‚æœå¯ä»¥ï¼Œä»¥åå†ä¹°ä¸€æŠŠæ”¶è—äº†ã€‚","source":"_posts/Harmonica.md","raw":"---\ntitle: Harmonica\ndate: 2020-06-13 10:07:08\ntags:\n    - Harmonica\ncategories:\n    - Music\n---\n\nå¼€ä¸ªå‘ï¼Œæ—¶ä¸æ—¶åˆ†äº«ä¸‹è‡ªå·±å’Œå£ç´ï¼Œæƒå½“è®°å½•è‡ªå·±å’ŒéŸ³ä¹é‚£ä»…æœ‰çš„ç¼˜åˆ†äº†ğŸ˜‚ã€‚\n<!-- more -->\néŸ³ä¹ç™½ç—´æƒ³è¦å­¦ä¹å™¨ï¼Œç½‘ä¸Šéšä¾¿ä¸€æœï¼Œå¤§å¤šæ•°äººéƒ½ä¼šæ¨èå‰ä»–ï¼Œå…¶æ¬¡å¯èƒ½æ˜¯ç”µå­ç´ã€‚ç¾å…¶åæ›°å‰ä»–ä¸Šæ‰‹å¿«ï¼Œè€Œä¸”å¯ä»¥ä¼´å¥ã€‚é‚£æˆ‘è¿™ç§äº”éŸ³ä¸å…¨åŠ æœ¨è€³è‚¯å®šç¬¬ä¸€ä¸ªå°±æ·˜æ±°äº†,æ­£å·§è¿™ä¸ªæ—¶å€™åœ¨ç½‘ä¸Šçœ‹åˆ°äº†ä¸€æ®µè§†å± é¾™ç™»æ°æ¼”å¥çš„Flower Danceã€‚\n<iframe src=\"//player.bilibili.com/player.html?aid=27879949&bvid=BV17s411A7bv&cid=48145340&page=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\"> </iframe>\n\nFlower Danceå·²ç»è¢«å„ç§ä¹å™¨å¤§ç¥æ¼”ç»è¿‡äº†ï¼Œä½†é¾™ç™»æ°çš„åŠéŸ³é˜¶çœŸçš„æ˜¯è®©æˆ‘æµ‘èº«é¸¡çš®ç–™ç˜©ã€‚å£ç´è™½ç„¶æ²¡æœ‰é’¢ç´ç‰ˆä¼˜ç¾çš„éŸ³è‰²ï¼Œä¹Ÿæ²¡æœ‰å‰ä»–ç‰ˆçš„è‡ªç„¶ï¼Œä½†æ˜¯ç°åœºçš„æ„ŸæŸ“åŠ›çœŸçš„æ˜¯æ— äººèƒ½æ¯”ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œé’¢ç´é€‚åˆä¸ºä»–äººæ¼”å¥ï¼Œä½†å£ç´æ›´åƒæ˜¯ç»™è‡ªå·±çš„éŸ³ä¹ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå¯¹æˆ‘ä»¬è¿™ç§äº”éŸ³ä¸å…¨çš„æ„å‘³ç€æ ¹æœ¬ä¸ç”¨è€ƒè™‘å”±æ­Œè¿™ä»¶äº‹äº†ğŸ˜‚ã€‚\n\nå£ç´æœ¬èº«ä¹Ÿåˆ†å¾ˆå¤šç§ï¼šåŠéŸ³é˜¶ã€å¤éŸ³ã€å¸ƒé²æ–¯ç­‰ã€‚ä½œä¸ºåˆå­¦è€…çš„è¯ä¸ªäººè®¤ä¸ºå¸ƒé²æ–¯ä¼šæ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚è™½ç„¶ä¸åƒåŠéŸ³é˜¶èƒ½å¹å‡ºå…¨éŸ³ç¬¦ï¼Œä¹Ÿä¸åƒå¤éŸ³éŸ³é˜¶æ¯”è¾ƒå¤šï¼ˆå…¶å®æˆ‘ä»¬å°æ—¶å€™æ¥è§¦çš„å¤§ä¸ç¬¦å£ç´éƒ½æ˜¯å¤éŸ³å£ç´ï¼‰ã€‚ä½†å¸ƒé²æ–¯æœ¬èº«å°å·§ï¼Œåœ¨ä¸æŒæ¡å¤æ‚æŠ€å·§çš„å‰æä¸‹å°±èƒ½å¹å¥å¤§é‡çš„ä¹æ›²ã€‚\nå”¯ä¸€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¸ƒé²æ–¯å°±å¦‚å…¶åï¼Œè¿‡å»æ˜¯é»‘äººä¹æ‰‹å¤§é‡å¹å¥å¸ƒé²æ–¯éŸ³ä¹æ—¶ä½¿ç”¨çš„ã€‚æ‰€ä»¥å®ƒçš„éŸ³è‰²äº¤åŠéŸ³é˜¶ä¸ªäººè§‰å¾—ç¨æ˜¾æµ‘åšã€‚ä¸è¿‡æˆ‘è§‰å¾—è¿™ä¹Ÿæ˜¯å¸ƒé²æ–¯å£ç´æœ€å¤§çš„ç‰¹è‰²ã€‚å¹å¯¹çš„æ­Œï¼Œæˆ–è€…è¯´æŒæ§äº†éŸ³è‰²ï¼Œé‚£æ—¶å€™å°±æ˜¯å¸ƒé²æ–¯æœ€å¼ºçš„æ—¶å€™ã€‚åŒæ—¶æœ€ä¸ºå³å…´ï¼Œå¸ƒé²æ–¯ä¹Ÿæ˜¯æœ€ä¸ºé€‚åˆçš„ï¼Œå½“ç„¶é‚£éƒ½æ˜¯å¤§ç¥ä»¬çš„é¢†åŸŸå°±æ˜¯äº†ã€‚\n\næˆ‘çš„ç¬¬ä¸€æŠŠå¸ƒé²æ–¯å£ç´ï¼š\n\n![01](Harmonica/SilverStar.jpeg)\n\nHohner(èµ«è±)åœ¨å£ç´ç•Œæ˜¯å‡ å¤§å“ç‰Œä¹‹ä¸€ï¼Œæœ€ä¸ºå¾·å›½çš„å“ç‰Œå…¶è´¨é‡ä¸€ç›´æ˜¯å¹¿å¤§ç´å‹å£å£ç›¸ä¼ çš„ã€‚ä½†è¿™å§SilverStarå°±å¦å½“åˆ«è®ºäº†ï¼Œè¦æ¯”å–»çš„è¯å°±ç±»ä¼¼å¾·å›½å®é©¬å’Œå›½äº§å®é©¬çš„åŒºåˆ«ã€‚\n\né¦–å…ˆåšå·¥å°±ä¸ç»å¦‚äººæ„ï¼Œè¿æ°”ä¸å¥½çš„è¯ï¼Œæœ‰äº›éŸ³å£å¯èƒ½ä¼šæœ‰æ°”å¯†æ€§çš„é—®é¢˜ã€‚ç›´æ¥å¯¼è‡´äº†æœ‰äº›éŸ³å¯èƒ½å¾ˆéš¾å¹ã€‚\n\nå…¶æ¬¡ç°§ç‰‡åé¦ˆå¾ˆè¯¡å¼‚ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä¸ªäººçš„æ„Ÿè§‰ã€‚æœ‰äº›éŸ³å¾ˆå®¹æ˜“å°±å¹å‡ºæ¥äº†ï¼Œä½†è¶Šæ˜¯ä½éŸ³æˆ–è€…é«˜éŸ³ï¼Œå¹å¥éš¾åº¦å°±è¶Šé«˜ã€‚å£ç´æ–°æ‰‹æœ€å¤§çš„ä¸€ä¸ªåå°±æ˜¯å‹éŸ³ï¼Œå¦‚æœä¸å·§éœ€è¦å‹éŸ³çš„é‚£å‡ ä¸ªéŸ³å¾ˆéš¾å¹ï¼Œé‚£å¯¹æ–°æ‰‹æ¥è¯´å¯èƒ½æ˜¯æ¯ç­æ€§çš„æ‰“å‡»ã€‚ã€‚ã€‚è®°å¾—æœ€æ—©ç»ƒä¹ å‹éŸ³çš„æ—¶å€™ï¼Œè¿™æŠŠSilverStaræ­»æ´»éƒ½æ²¡æ³•æˆåŠŸï¼Œåªè¦æ¢äº†æŠŠæ›´å¥½çš„åæ‰æ¸æ¸æ‰¾åˆ°å‹éŸ³çš„æ„Ÿè§‰ã€‚æ—¥åå›åˆ°è¿™æŠŠSilverStarä¸Šå±…ç„¶ç¥å¥‡çš„ä¹Ÿæ‰¾åˆ°äº†å‹éŸ³çš„æ„Ÿè§‰ï¼Œè¯´æ¥ä¹Ÿæ˜¯å¥‡å¦™å•Šã€‚\n\nç¬¬äºŒæŠŠå£ç´ï¼š\n\n![02](Harmonica/GodenMelody.jpeg)\n\næˆ‘çš„ç¬¬äºŒæŠŠå£ç´è¿˜æ˜¯Hohnerï¼Œä½†è¿™æŠŠæ˜¯çœŸçœŸåˆ‡åˆ‡çš„åŸå‚å£ç´ã€‚å°300çš„ä»·æ ¼ä¹Ÿç®—å¸ƒé²æ–¯é‡Œçš„åŠ³åŠ›å£«äº†ğŸ˜‚ã€‚\n\nè¿™æŠŠå£ç´çš„é€ å‹å°±éå¸¸æœ‰ç‰¹è‰²ï¼Œæ¢³å­å‹è®¾è®¡éå¸¸åˆ«è‡´ã€‚å’Œå…¶ä»–é«˜ç«¯å£ç´ä¸€æ ·ï¼Œç´å°ºé‡‡ç”¨äº†å…¨åŒ…å›´çš„è®¾è®¡ã€‚ä¸æ—¥å‚é“ƒæœ¨çš„å£è½»ç›¸æ¯”ï¼Œé“ƒæœ¨ç»™äººçš„æ„Ÿè§‰æ›´åŠ åœ†æ¶¦ï¼Œè€Œè¿™æŠŠåœ¨åœ†æ¶¦çš„å‰æä¸‹åˆä¸å¤±è±ªæ”¾çš„è®¾è®¡ã€‚çº¯é“¶è‰²çš„ç´èº«å’Œçº¢è‰²çš„ç´å°ºç›¸å¾—ç›Šå½°ã€‚\n\nå’Œä¹‹å‰ä¸€æŠŠå£ç´å¹èµ·æ¥ï¼Œä¸Šå˜´çš„é‚£ä¸€åˆ¹é‚£ä»¿ä½›æ‹¿åˆ°äº†ä¸€ä¸ªæ–°ä¹å™¨ã€‚ç»å¯¹æ˜¯è¦é€‚åº”ä¸‹æ‰èƒ½æ­£å¸¸æ¼”å¥çš„ï¼Œä¸è¿‡ä¸€æ—¦ä¹ æƒ¯åï¼Œä¸è®ºéŸ³è‰²è¿˜æ˜¯åé¦ˆéƒ½è¿œè¿œå¼ºäºä¹‹å‰çš„é‚£æŠŠè´´ç‰Œè´§ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨è¿™æŠŠå£ç´ä¸Šå­¦ä¼šçš„å¦‚ä½•å‹éŸ³ã€‚å¦‚æœå¯ä»¥ï¼Œä»¥åå†ä¹°ä¸€æŠŠæ”¶è—äº†ã€‚","slug":"Harmonica","published":1,"updated":"2020-12-14T10:40:34.911Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71hsz0003v2522odqc0cl","content":"<html><head></head><body><p>&#x5F00;&#x4E2A;&#x5751;&#xFF0C;&#x65F6;&#x4E0D;&#x65F6;&#x5206;&#x4EAB;&#x4E0B;&#x81EA;&#x5DF1;&#x548C;&#x53E3;&#x7434;&#xFF0C;&#x6743;&#x5F53;&#x8BB0;&#x5F55;&#x81EA;&#x5DF1;&#x548C;&#x97F3;&#x4E50;&#x90A3;&#x4EC5;&#x6709;&#x7684;&#x7F18;&#x5206;&#x4E86;&#x1F602;&#x3002;</p>\n<a id=\"more\"></a>\n<p>&#x97F3;&#x4E50;&#x767D;&#x75F4;&#x60F3;&#x8981;&#x5B66;&#x4E50;&#x5668;&#xFF0C;&#x7F51;&#x4E0A;&#x968F;&#x4FBF;&#x4E00;&#x641C;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x90FD;&#x4F1A;&#x63A8;&#x8350;&#x5409;&#x4ED6;&#xFF0C;&#x5176;&#x6B21;&#x53EF;&#x80FD;&#x662F;&#x7535;&#x5B50;&#x7434;&#x3002;&#x7F8E;&#x5176;&#x540D;&#x66F0;&#x5409;&#x4ED6;&#x4E0A;&#x624B;&#x5FEB;&#xFF0C;&#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x4F34;&#x594F;&#x3002;&#x90A3;&#x6211;&#x8FD9;&#x79CD;&#x4E94;&#x97F3;&#x4E0D;&#x5168;&#x52A0;&#x6728;&#x8033;&#x80AF;&#x5B9A;&#x7B2C;&#x4E00;&#x4E2A;&#x5C31;&#x6DD8;&#x6C70;&#x4E86;,&#x6B63;&#x5DE7;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x5728;&#x7F51;&#x4E0A;&#x770B;&#x5230;&#x4E86;&#x4E00;&#x6BB5;&#x89C6;&#x5C4F; &#x9F99;&#x767B;&#x6770;&#x6F14;&#x594F;&#x7684;Flower Dance&#x3002;</p>\n<iframe src=\"//player.bilibili.com/player.html?aid=27879949&amp;bvid=BV17s411A7bv&amp;cid=48145340&amp;page=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\"> </iframe>\n\n<p>Flower Dance&#x5DF2;&#x7ECF;&#x88AB;&#x5404;&#x79CD;&#x4E50;&#x5668;&#x5927;&#x795E;&#x6F14;&#x7ECE;&#x8FC7;&#x4E86;&#xFF0C;&#x4F46;&#x9F99;&#x767B;&#x6770;&#x7684;&#x534A;&#x97F3;&#x9636;&#x771F;&#x7684;&#x662F;&#x8BA9;&#x6211;&#x6D51;&#x8EAB;&#x9E21;&#x76AE;&#x7599;&#x7629;&#x3002;&#x53E3;&#x7434;&#x867D;&#x7136;&#x6CA1;&#x6709;&#x94A2;&#x7434;&#x7248;&#x4F18;&#x7F8E;&#x7684;&#x97F3;&#x8272;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x5409;&#x4ED6;&#x7248;&#x7684;&#x81EA;&#x7136;&#xFF0C;&#x4F46;&#x662F;&#x73B0;&#x573A;&#x7684;&#x611F;&#x67D3;&#x529B;&#x771F;&#x7684;&#x662F;&#x65E0;&#x4EBA;&#x80FD;&#x6BD4;&#x3002;&#x6253;&#x4E2A;&#x6BD4;&#x65B9;&#xFF0C;&#x94A2;&#x7434;&#x9002;&#x5408;&#x4E3A;&#x4ED6;&#x4EBA;&#x6F14;&#x594F;&#xFF0C;&#x4F46;&#x53E3;&#x7434;&#x66F4;&#x50CF;&#x662F;&#x7ED9;&#x81EA;&#x5DF1;&#x7684;&#x97F3;&#x4E50;&#x3002;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x5BF9;&#x6211;&#x4EEC;&#x8FD9;&#x79CD;&#x4E94;&#x97F3;&#x4E0D;&#x5168;&#x7684;&#x610F;&#x5473;&#x7740;&#x6839;&#x672C;&#x4E0D;&#x7528;&#x8003;&#x8651;&#x5531;&#x6B4C;&#x8FD9;&#x4EF6;&#x4E8B;&#x4E86;&#x1F602;&#x3002;</p>\n<p>&#x53E3;&#x7434;&#x672C;&#x8EAB;&#x4E5F;&#x5206;&#x5F88;&#x591A;&#x79CD;&#xFF1A;&#x534A;&#x97F3;&#x9636;&#x3001;&#x590D;&#x97F3;&#x3001;&#x5E03;&#x9C81;&#x65AF;&#x7B49;&#x3002;&#x4F5C;&#x4E3A;&#x521D;&#x5B66;&#x8005;&#x7684;&#x8BDD;&#x4E2A;&#x4EBA;&#x8BA4;&#x4E3A;&#x5E03;&#x9C81;&#x65AF;&#x4F1A;&#x662F;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x9009;&#x62E9;&#x3002;&#x867D;&#x7136;&#x4E0D;&#x50CF;&#x534A;&#x97F3;&#x9636;&#x80FD;&#x5439;&#x51FA;&#x5168;&#x97F3;&#x7B26;&#xFF0C;&#x4E5F;&#x4E0D;&#x50CF;&#x590D;&#x97F3;&#x97F3;&#x9636;&#x6BD4;&#x8F83;&#x591A;&#xFF08;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x5C0F;&#x65F6;&#x5019;&#x63A5;&#x89E6;&#x7684;&#x5927;&#x4E0D;&#x7B26;&#x53E3;&#x7434;&#x90FD;&#x662F;&#x590D;&#x97F3;&#x53E3;&#x7434;&#xFF09;&#x3002;&#x4F46;&#x5E03;&#x9C81;&#x65AF;&#x672C;&#x8EAB;&#x5C0F;&#x5DE7;&#xFF0C;&#x5728;&#x4E0D;&#x638C;&#x63E1;&#x590D;&#x6742;&#x6280;&#x5DE7;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x5C31;&#x80FD;&#x5439;&#x594F;&#x5927;&#x91CF;&#x7684;&#x4E50;&#x66F2;&#x3002;<br>&#x552F;&#x4E00;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5E03;&#x9C81;&#x65AF;&#x5C31;&#x5982;&#x5176;&#x540D;&#xFF0C;&#x8FC7;&#x53BB;&#x662F;&#x9ED1;&#x4EBA;&#x4E50;&#x624B;&#x5927;&#x91CF;&#x5439;&#x594F;&#x5E03;&#x9C81;&#x65AF;&#x97F3;&#x4E50;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x5B83;&#x7684;&#x97F3;&#x8272;&#x4EA4;&#x534A;&#x97F3;&#x9636;&#x4E2A;&#x4EBA;&#x89C9;&#x5F97;&#x7A0D;&#x663E;&#x6D51;&#x539A;&#x3002;&#x4E0D;&#x8FC7;&#x6211;&#x89C9;&#x5F97;&#x8FD9;&#x4E5F;&#x662F;&#x5E03;&#x9C81;&#x65AF;&#x53E3;&#x7434;&#x6700;&#x5927;&#x7684;&#x7279;&#x8272;&#x3002;&#x5439;&#x5BF9;&#x7684;&#x6B4C;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x638C;&#x63A7;&#x4E86;&#x97F3;&#x8272;&#xFF0C;&#x90A3;&#x65F6;&#x5019;&#x5C31;&#x662F;&#x5E03;&#x9C81;&#x65AF;&#x6700;&#x5F3A;&#x7684;&#x65F6;&#x5019;&#x3002;&#x540C;&#x65F6;&#x6700;&#x4E3A;&#x5373;&#x5174;&#xFF0C;&#x5E03;&#x9C81;&#x65AF;&#x4E5F;&#x662F;&#x6700;&#x4E3A;&#x9002;&#x5408;&#x7684;&#xFF0C;&#x5F53;&#x7136;&#x90A3;&#x90FD;&#x662F;&#x5927;&#x795E;&#x4EEC;&#x7684;&#x9886;&#x57DF;&#x5C31;&#x662F;&#x4E86;&#x3002;</p>\n<p>&#x6211;&#x7684;&#x7B2C;&#x4E00;&#x628A;&#x5E03;&#x9C81;&#x65AF;&#x53E3;&#x7434;&#xFF1A;</p>\n<p><img src=\"/2020/06/13/Harmonica/SilverStar.jpeg\" alt=\"01\"></p>\n<p>Hohner(&#x8D6B;&#x83B1;)&#x5728;&#x53E3;&#x7434;&#x754C;&#x662F;&#x51E0;&#x5927;&#x54C1;&#x724C;&#x4E4B;&#x4E00;&#xFF0C;&#x6700;&#x4E3A;&#x5FB7;&#x56FD;&#x7684;&#x54C1;&#x724C;&#x5176;&#x8D28;&#x91CF;&#x4E00;&#x76F4;&#x662F;&#x5E7F;&#x5927;&#x7434;&#x53CB;&#x53E3;&#x53E3;&#x76F8;&#x4F20;&#x7684;&#x3002;&#x4F46;&#x8FD9;&#x5427;SilverStar&#x5C31;&#x53E6;&#x5F53;&#x522B;&#x8BBA;&#x4E86;&#xFF0C;&#x8981;&#x6BD4;&#x55BB;&#x7684;&#x8BDD;&#x5C31;&#x7C7B;&#x4F3C;&#x5FB7;&#x56FD;&#x5B9D;&#x9A6C;&#x548C;&#x56FD;&#x4EA7;&#x5B9D;&#x9A6C;&#x7684;&#x533A;&#x522B;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x505A;&#x5DE5;&#x5C31;&#x4E0D;&#x7ECF;&#x5982;&#x4EBA;&#x610F;&#xFF0C;&#x8FD0;&#x6C14;&#x4E0D;&#x597D;&#x7684;&#x8BDD;&#xFF0C;&#x6709;&#x4E9B;&#x97F3;&#x53E3;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x6C14;&#x5BC6;&#x6027;&#x7684;&#x95EE;&#x9898;&#x3002;&#x76F4;&#x63A5;&#x5BFC;&#x81F4;&#x4E86;&#x6709;&#x4E9B;&#x97F3;&#x53EF;&#x80FD;&#x5F88;&#x96BE;&#x5439;&#x3002;</p>\n<p>&#x5176;&#x6B21;&#x7C27;&#x7247;&#x53CD;&#x9988;&#x5F88;&#x8BE1;&#x5F02;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x6211;&#x4E2A;&#x4EBA;&#x7684;&#x611F;&#x89C9;&#x3002;&#x6709;&#x4E9B;&#x97F3;&#x5F88;&#x5BB9;&#x6613;&#x5C31;&#x5439;&#x51FA;&#x6765;&#x4E86;&#xFF0C;&#x4F46;&#x8D8A;&#x662F;&#x4F4E;&#x97F3;&#x6216;&#x8005;&#x9AD8;&#x97F3;&#xFF0C;&#x5439;&#x594F;&#x96BE;&#x5EA6;&#x5C31;&#x8D8A;&#x9AD8;&#x3002;&#x53E3;&#x7434;&#x65B0;&#x624B;&#x6700;&#x5927;&#x7684;&#x4E00;&#x4E2A;&#x574E;&#x5C31;&#x662F;&#x538B;&#x97F3;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x5DE7;&#x9700;&#x8981;&#x538B;&#x97F3;&#x7684;&#x90A3;&#x51E0;&#x4E2A;&#x97F3;&#x5F88;&#x96BE;&#x5439;&#xFF0C;&#x90A3;&#x5BF9;&#x65B0;&#x624B;&#x6765;&#x8BF4;&#x53EF;&#x80FD;&#x662F;&#x6BC1;&#x706D;&#x6027;&#x7684;&#x6253;&#x51FB;&#x3002;&#x3002;&#x3002;&#x8BB0;&#x5F97;&#x6700;&#x65E9;&#x7EC3;&#x4E60;&#x538B;&#x97F3;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD9;&#x628A;SilverStar&#x6B7B;&#x6D3B;&#x90FD;&#x6CA1;&#x6CD5;&#x6210;&#x529F;&#xFF0C;&#x53EA;&#x8981;&#x6362;&#x4E86;&#x628A;&#x66F4;&#x597D;&#x7684;&#x540E;&#x624D;&#x6E10;&#x6E10;&#x627E;&#x5230;&#x538B;&#x97F3;&#x7684;&#x611F;&#x89C9;&#x3002;&#x65E5;&#x540E;&#x56DE;&#x5230;&#x8FD9;&#x628A;SilverStar&#x4E0A;&#x5C45;&#x7136;&#x795E;&#x5947;&#x7684;&#x4E5F;&#x627E;&#x5230;&#x4E86;&#x538B;&#x97F3;&#x7684;&#x611F;&#x89C9;&#xFF0C;&#x8BF4;&#x6765;&#x4E5F;&#x662F;&#x5947;&#x5999;&#x554A;&#x3002;</p>\n<p>&#x7B2C;&#x4E8C;&#x628A;&#x53E3;&#x7434;&#xFF1A;</p>\n<p><img src=\"/2020/06/13/Harmonica/GodenMelody.jpeg\" alt=\"02\"></p>\n<p>&#x6211;&#x7684;&#x7B2C;&#x4E8C;&#x628A;&#x53E3;&#x7434;&#x8FD8;&#x662F;Hohner&#xFF0C;&#x4F46;&#x8FD9;&#x628A;&#x662F;&#x771F;&#x771F;&#x5207;&#x5207;&#x7684;&#x539F;&#x5382;&#x53E3;&#x7434;&#x3002;&#x5C0F;300&#x7684;&#x4EF7;&#x683C;&#x4E5F;&#x7B97;&#x5E03;&#x9C81;&#x65AF;&#x91CC;&#x7684;&#x52B3;&#x529B;&#x58EB;&#x4E86;&#x1F602;&#x3002;</p>\n<p>&#x8FD9;&#x628A;&#x53E3;&#x7434;&#x7684;&#x9020;&#x578B;&#x5C31;&#x975E;&#x5E38;&#x6709;&#x7279;&#x8272;&#xFF0C;&#x68B3;&#x5B50;&#x578B;&#x8BBE;&#x8BA1;&#x975E;&#x5E38;&#x522B;&#x81F4;&#x3002;&#x548C;&#x5176;&#x4ED6;&#x9AD8;&#x7AEF;&#x53E3;&#x7434;&#x4E00;&#x6837;&#xFF0C;&#x7434;&#x5C3A;&#x91C7;&#x7528;&#x4E86;&#x5168;&#x5305;&#x56F4;&#x7684;&#x8BBE;&#x8BA1;&#x3002;&#x4E0E;&#x65E5;&#x5382;&#x94C3;&#x6728;&#x7684;&#x53E3;&#x8F7B;&#x76F8;&#x6BD4;&#xFF0C;&#x94C3;&#x6728;&#x7ED9;&#x4EBA;&#x7684;&#x611F;&#x89C9;&#x66F4;&#x52A0;&#x5706;&#x6DA6;&#xFF0C;&#x800C;&#x8FD9;&#x628A;&#x5728;&#x5706;&#x6DA6;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x53C8;&#x4E0D;&#x5931;&#x8C6A;&#x653E;&#x7684;&#x8BBE;&#x8BA1;&#x3002;&#x7EAF;&#x94F6;&#x8272;&#x7684;&#x7434;&#x8EAB;&#x548C;&#x7EA2;&#x8272;&#x7684;&#x7434;&#x5C3A;&#x76F8;&#x5F97;&#x76CA;&#x5F70;&#x3002;</p>\n<p>&#x548C;&#x4E4B;&#x524D;&#x4E00;&#x628A;&#x53E3;&#x7434;&#x5439;&#x8D77;&#x6765;&#xFF0C;&#x4E0A;&#x5634;&#x7684;&#x90A3;&#x4E00;&#x5239;&#x90A3;&#x4EFF;&#x4F5B;&#x62FF;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x4E50;&#x5668;&#x3002;&#x7EDD;&#x5BF9;&#x662F;&#x8981;&#x9002;&#x5E94;&#x4E0B;&#x624D;&#x80FD;&#x6B63;&#x5E38;&#x6F14;&#x594F;&#x7684;&#xFF0C;&#x4E0D;&#x8FC7;&#x4E00;&#x65E6;&#x4E60;&#x60EF;&#x540E;&#xFF0C;&#x4E0D;&#x8BBA;&#x97F3;&#x8272;&#x8FD8;&#x662F;&#x53CD;&#x9988;&#x90FD;&#x8FDC;&#x8FDC;&#x5F3A;&#x4E8E;&#x4E4B;&#x524D;&#x7684;&#x90A3;&#x628A;&#x8D34;&#x724C;&#x8D27;&#x3002;&#x66F4;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4E5F;&#x662F;&#x5728;&#x8FD9;&#x628A;&#x53E3;&#x7434;&#x4E0A;&#x5B66;&#x4F1A;&#x7684;&#x5982;&#x4F55;&#x538B;&#x97F3;&#x3002;&#x5982;&#x679C;&#x53EF;&#x4EE5;&#xFF0C;&#x4EE5;&#x540E;&#x518D;&#x4E70;&#x4E00;&#x628A;&#x6536;&#x85CF;&#x4E86;&#x3002;</p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Music","path":"categories/Music/"}],"_tags":[{"name":"Harmonica","path":"tags/Harmonica/"}],"excerpt":"<html><head></head><body><p>&#x5F00;&#x4E2A;&#x5751;&#xFF0C;&#x65F6;&#x4E0D;&#x65F6;&#x5206;&#x4EAB;&#x4E0B;&#x81EA;&#x5DF1;&#x548C;&#x53E3;&#x7434;&#xFF0C;&#x6743;&#x5F53;&#x8BB0;&#x5F55;&#x81EA;&#x5DF1;&#x548C;&#x97F3;&#x4E50;&#x90A3;&#x4EC5;&#x6709;&#x7684;&#x7F18;&#x5206;&#x4E86;&#x1F602;&#x3002;</p></body></html>","more":"<p>éŸ³ä¹ç™½ç—´æƒ³è¦å­¦ä¹å™¨ï¼Œç½‘ä¸Šéšä¾¿ä¸€æœï¼Œå¤§å¤šæ•°äººéƒ½ä¼šæ¨èå‰ä»–ï¼Œå…¶æ¬¡å¯èƒ½æ˜¯ç”µå­ç´ã€‚ç¾å…¶åæ›°å‰ä»–ä¸Šæ‰‹å¿«ï¼Œè€Œä¸”å¯ä»¥ä¼´å¥ã€‚é‚£æˆ‘è¿™ç§äº”éŸ³ä¸å…¨åŠ æœ¨è€³è‚¯å®šç¬¬ä¸€ä¸ªå°±æ·˜æ±°äº†,æ­£å·§è¿™ä¸ªæ—¶å€™åœ¨ç½‘ä¸Šçœ‹åˆ°äº†ä¸€æ®µè§†å± é¾™ç™»æ°æ¼”å¥çš„Flower Danceã€‚</p>\n<iframe src=\"//player.bilibili.com/player.html?aid=27879949&bvid=BV17s411A7bv&cid=48145340&page=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\"> </iframe>\n\n<p>Flower Danceå·²ç»è¢«å„ç§ä¹å™¨å¤§ç¥æ¼”ç»è¿‡äº†ï¼Œä½†é¾™ç™»æ°çš„åŠéŸ³é˜¶çœŸçš„æ˜¯è®©æˆ‘æµ‘èº«é¸¡çš®ç–™ç˜©ã€‚å£ç´è™½ç„¶æ²¡æœ‰é’¢ç´ç‰ˆä¼˜ç¾çš„éŸ³è‰²ï¼Œä¹Ÿæ²¡æœ‰å‰ä»–ç‰ˆçš„è‡ªç„¶ï¼Œä½†æ˜¯ç°åœºçš„æ„ŸæŸ“åŠ›çœŸçš„æ˜¯æ— äººèƒ½æ¯”ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œé’¢ç´é€‚åˆä¸ºä»–äººæ¼”å¥ï¼Œä½†å£ç´æ›´åƒæ˜¯ç»™è‡ªå·±çš„éŸ³ä¹ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå¯¹æˆ‘ä»¬è¿™ç§äº”éŸ³ä¸å…¨çš„æ„å‘³ç€æ ¹æœ¬ä¸ç”¨è€ƒè™‘å”±æ­Œè¿™ä»¶äº‹äº†ğŸ˜‚ã€‚</p>\n<p>å£ç´æœ¬èº«ä¹Ÿåˆ†å¾ˆå¤šç§ï¼šåŠéŸ³é˜¶ã€å¤éŸ³ã€å¸ƒé²æ–¯ç­‰ã€‚ä½œä¸ºåˆå­¦è€…çš„è¯ä¸ªäººè®¤ä¸ºå¸ƒé²æ–¯ä¼šæ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚è™½ç„¶ä¸åƒåŠéŸ³é˜¶èƒ½å¹å‡ºå…¨éŸ³ç¬¦ï¼Œä¹Ÿä¸åƒå¤éŸ³éŸ³é˜¶æ¯”è¾ƒå¤šï¼ˆå…¶å®æˆ‘ä»¬å°æ—¶å€™æ¥è§¦çš„å¤§ä¸ç¬¦å£ç´éƒ½æ˜¯å¤éŸ³å£ç´ï¼‰ã€‚ä½†å¸ƒé²æ–¯æœ¬èº«å°å·§ï¼Œåœ¨ä¸æŒæ¡å¤æ‚æŠ€å·§çš„å‰æä¸‹å°±èƒ½å¹å¥å¤§é‡çš„ä¹æ›²ã€‚<br>å”¯ä¸€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¸ƒé²æ–¯å°±å¦‚å…¶åï¼Œè¿‡å»æ˜¯é»‘äººä¹æ‰‹å¤§é‡å¹å¥å¸ƒé²æ–¯éŸ³ä¹æ—¶ä½¿ç”¨çš„ã€‚æ‰€ä»¥å®ƒçš„éŸ³è‰²äº¤åŠéŸ³é˜¶ä¸ªäººè§‰å¾—ç¨æ˜¾æµ‘åšã€‚ä¸è¿‡æˆ‘è§‰å¾—è¿™ä¹Ÿæ˜¯å¸ƒé²æ–¯å£ç´æœ€å¤§çš„ç‰¹è‰²ã€‚å¹å¯¹çš„æ­Œï¼Œæˆ–è€…è¯´æŒæ§äº†éŸ³è‰²ï¼Œé‚£æ—¶å€™å°±æ˜¯å¸ƒé²æ–¯æœ€å¼ºçš„æ—¶å€™ã€‚åŒæ—¶æœ€ä¸ºå³å…´ï¼Œå¸ƒé²æ–¯ä¹Ÿæ˜¯æœ€ä¸ºé€‚åˆçš„ï¼Œå½“ç„¶é‚£éƒ½æ˜¯å¤§ç¥ä»¬çš„é¢†åŸŸå°±æ˜¯äº†ã€‚</p>\n<p>æˆ‘çš„ç¬¬ä¸€æŠŠå¸ƒé²æ–¯å£ç´ï¼š</p>\n<p><img src=\"/2020/06/13/Harmonica/SilverStar.jpeg\" alt=\"01\"></p>\n<p>Hohner(èµ«è±)åœ¨å£ç´ç•Œæ˜¯å‡ å¤§å“ç‰Œä¹‹ä¸€ï¼Œæœ€ä¸ºå¾·å›½çš„å“ç‰Œå…¶è´¨é‡ä¸€ç›´æ˜¯å¹¿å¤§ç´å‹å£å£ç›¸ä¼ çš„ã€‚ä½†è¿™å§SilverStarå°±å¦å½“åˆ«è®ºäº†ï¼Œè¦æ¯”å–»çš„è¯å°±ç±»ä¼¼å¾·å›½å®é©¬å’Œå›½äº§å®é©¬çš„åŒºåˆ«ã€‚</p>\n<p>é¦–å…ˆåšå·¥å°±ä¸ç»å¦‚äººæ„ï¼Œè¿æ°”ä¸å¥½çš„è¯ï¼Œæœ‰äº›éŸ³å£å¯èƒ½ä¼šæœ‰æ°”å¯†æ€§çš„é—®é¢˜ã€‚ç›´æ¥å¯¼è‡´äº†æœ‰äº›éŸ³å¯èƒ½å¾ˆéš¾å¹ã€‚</p>\n<p>å…¶æ¬¡ç°§ç‰‡åé¦ˆå¾ˆè¯¡å¼‚ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä¸ªäººçš„æ„Ÿè§‰ã€‚æœ‰äº›éŸ³å¾ˆå®¹æ˜“å°±å¹å‡ºæ¥äº†ï¼Œä½†è¶Šæ˜¯ä½éŸ³æˆ–è€…é«˜éŸ³ï¼Œå¹å¥éš¾åº¦å°±è¶Šé«˜ã€‚å£ç´æ–°æ‰‹æœ€å¤§çš„ä¸€ä¸ªåå°±æ˜¯å‹éŸ³ï¼Œå¦‚æœä¸å·§éœ€è¦å‹éŸ³çš„é‚£å‡ ä¸ªéŸ³å¾ˆéš¾å¹ï¼Œé‚£å¯¹æ–°æ‰‹æ¥è¯´å¯èƒ½æ˜¯æ¯ç­æ€§çš„æ‰“å‡»ã€‚ã€‚ã€‚è®°å¾—æœ€æ—©ç»ƒä¹ å‹éŸ³çš„æ—¶å€™ï¼Œè¿™æŠŠSilverStaræ­»æ´»éƒ½æ²¡æ³•æˆåŠŸï¼Œåªè¦æ¢äº†æŠŠæ›´å¥½çš„åæ‰æ¸æ¸æ‰¾åˆ°å‹éŸ³çš„æ„Ÿè§‰ã€‚æ—¥åå›åˆ°è¿™æŠŠSilverStarä¸Šå±…ç„¶ç¥å¥‡çš„ä¹Ÿæ‰¾åˆ°äº†å‹éŸ³çš„æ„Ÿè§‰ï¼Œè¯´æ¥ä¹Ÿæ˜¯å¥‡å¦™å•Šã€‚</p>\n<p>ç¬¬äºŒæŠŠå£ç´ï¼š</p>\n<p><img src=\"/2020/06/13/Harmonica/GodenMelody.jpeg\" alt=\"02\"></p>\n<p>æˆ‘çš„ç¬¬äºŒæŠŠå£ç´è¿˜æ˜¯Hohnerï¼Œä½†è¿™æŠŠæ˜¯çœŸçœŸåˆ‡åˆ‡çš„åŸå‚å£ç´ã€‚å°300çš„ä»·æ ¼ä¹Ÿç®—å¸ƒé²æ–¯é‡Œçš„åŠ³åŠ›å£«äº†ğŸ˜‚ã€‚</p>\n<p>è¿™æŠŠå£ç´çš„é€ å‹å°±éå¸¸æœ‰ç‰¹è‰²ï¼Œæ¢³å­å‹è®¾è®¡éå¸¸åˆ«è‡´ã€‚å’Œå…¶ä»–é«˜ç«¯å£ç´ä¸€æ ·ï¼Œç´å°ºé‡‡ç”¨äº†å…¨åŒ…å›´çš„è®¾è®¡ã€‚ä¸æ—¥å‚é“ƒæœ¨çš„å£è½»ç›¸æ¯”ï¼Œé“ƒæœ¨ç»™äººçš„æ„Ÿè§‰æ›´åŠ åœ†æ¶¦ï¼Œè€Œè¿™æŠŠåœ¨åœ†æ¶¦çš„å‰æä¸‹åˆä¸å¤±è±ªæ”¾çš„è®¾è®¡ã€‚çº¯é“¶è‰²çš„ç´èº«å’Œçº¢è‰²çš„ç´å°ºç›¸å¾—ç›Šå½°ã€‚</p>\n<p>å’Œä¹‹å‰ä¸€æŠŠå£ç´å¹èµ·æ¥ï¼Œä¸Šå˜´çš„é‚£ä¸€åˆ¹é‚£ä»¿ä½›æ‹¿åˆ°äº†ä¸€ä¸ªæ–°ä¹å™¨ã€‚ç»å¯¹æ˜¯è¦é€‚åº”ä¸‹æ‰èƒ½æ­£å¸¸æ¼”å¥çš„ï¼Œä¸è¿‡ä¸€æ—¦ä¹ æƒ¯åï¼Œä¸è®ºéŸ³è‰²è¿˜æ˜¯åé¦ˆéƒ½è¿œè¿œå¼ºäºä¹‹å‰çš„é‚£æŠŠè´´ç‰Œè´§ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨è¿™æŠŠå£ç´ä¸Šå­¦ä¼šçš„å¦‚ä½•å‹éŸ³ã€‚å¦‚æœå¯ä»¥ï¼Œä»¥åå†ä¹°ä¸€æŠŠæ”¶è—äº†ã€‚</p>"},{"title":"JVM æ•´ç†","date":"2020-02-22T07:03:19.000Z","_content":"\n# JVM ç›¸å…³çŸ¥è¯†æ•´ç†\n1. å†…å­˜åˆ†é…\n2. åƒåœ¾å›æ”¶å™¨çš„å‚æ•°é…ç½®\n\n## ç±»çš„åŠ è½½\n<!-- more -->\nåŠ è½½->éªŒè¯->å‡†å¤‡->è§£æ->åˆå§‹åŒ–->ä½¿ç”¨->å¸è½½\n\n### åŠ è½½æµç¨‹\n\n- åŠ è½½\n\n  ä»£ç ä¸­ä½¿ç”¨åˆ°è¿™ä¸ªç±»çš„æ—¶å€™ï¼Œ.classå­—èŠ‚ç æ–‡ä»¶å°±ä¼šåŠ è½½è¿™ä¸ªç±»åˆ°JVMå†…å­˜ä¸­ã€‚\n\n- é“¾æ¥\n\n\t- éªŒè¯\n\n\t  æ ¹æ®JVMè§„èŒƒï¼Œæ ¡éªŒ.classæ–‡ä»¶ã€‚\n\n\t- å‡†å¤‡\n\n\t  ç»™åŠ è½½çš„ç±»åˆ†é…å†…å­˜ç©ºé—´ï¼ŒåŒæ—¶ç»™ç±»çš„staticå˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå¹¶è®¾ç½®é»˜è®¤å€¼0ã€‚\n\t  clint()\n\n\t- è§£æ\n\n\t  æŠŠç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚\n\n- åˆå§‹åŒ–\n\n  ä¸ºç±»å˜é‡èµ‹å€¼ï¼šé™æ€æ–¹æ³•ï¼Œé™æ€å˜é‡ï¼Œé™æ€å—ã€‚\n  åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æœ‰çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–ä»–çš„çˆ¶ç±»ã€‚\n\n### ç±»åŠ è½½å™¨\n\n- åŠ è½½å™¨\n\n\t- BootStrap ClassLoader\n\n\t  åŠ è½½libç›®å½•ä¸‹çš„ç±»åº“\n\n\t- Extension ClassLoader\n\n\t  åŠ è½½lib\\extç›®å½•ä¸‹çš„ç±»åº“\n\n\t- Application ClassLoader\n\n\t  åŠ è½½ClassPathä¸‹çš„ç±»\n\n\t- è‡ªå®šä¹‰åŠ è½½å™¨\n\n- åŒäº²å§”æ´¾æœºåˆ¶\n\n  å…ˆæ‰¾çˆ¶äº²åŠ è½½ï¼ŒåŠ è½½ä¸äº†å†æ‰¾å„¿å­åŠ è½½\n\n## å†…å­˜ç»“æ„\n\n### æ–¹æ³•åŒºã€å…ƒç©ºé—´ã€æ°¸ä¹…ä»£\n\nå­˜æ”¾ç±»çš„å®šä¹‰ï¼Œå¸¸é‡æ± ç­‰ã€‚\nmatespaceæ»¡åä¼šè§¦å‘Full GCã€‚\næ–¹æ³•åŒºåƒåœ¾å›æ”¶ï¼š\n1.è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹å·²ç»è¢«å›æ”¶\n2.åŠ è½½è¯¥ç±»çš„ClassLoaderå·²ç»è¢«å›æ”¶\n3.è¯¥ç±»çš„Classå¯¹è±¡æ²¡æœ‰è¢«ä»»ä½•å¼•ç”¨\n\n### ç¨‹åºæŠ€æœ¯å™¨\n\nè®°å½•å½“å‰æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ä½ç½®ã€‚\nçº¿ç¨‹ç§æœ‰ã€‚\n\n### Javaè™šæ‹Ÿæœºæ ˆ\n\nä¿å­˜æ–¹æ³•ä¿¡æ¯ã€‚\nçº¿ç¨‹ç§æœ‰ã€‚\n\n- æ ˆå¸§\n\n\t- å±€éƒ¨å˜é‡è¡¨\n\t- æ“ä½œæ•°æ ˆ\n\t- åŠ¨æ€é“¾æ¥\n\t- æ–¹æ³•è¿”å›åœ°å€\n\t- å…¶ä»–\n\n### Javaå †å†…å­˜\n\nå­˜æ”¾ç±»çš„å®ä¾‹å¯¹è±¡ã€‚\n\n- åˆ†ä»£\n\n\t- å¹´è½»ä»£\n\n\t  æ–°ç”Ÿä»£è¿›å…¥è€å¹´ä»£ï¼šé»˜è®¤15æ¬¡\n\n\t\t- EdenåŒº\n\n\t\t  é»˜è®¤æ–°ç”Ÿä»£80%ç©ºé—´ã€‚\n\t\t  æ–°å»ºå¯¹è±¡äº§ç”Ÿåœ¨EdenåŒºã€‚\n\t\t  EdenåŒºæ»¡åä¼šå‘ç”ŸMinor GCã€‚\n\n\t\t- Survivor0,1åŒº\n\n\t\t  é»˜è®¤å¹´è½»ä»£20%ã€‚Survivor 0:10%  Survivor 1:10%ã€‚\n\t\t  é»˜è®¤å¯¹è±¡å¹¸å­˜15æ¬¡åï¼Œä¼šè¿›å…¥è€å¹´åŒºã€‚\n\n\t\t\t- åŠ¨æ€å¹´é¾„åˆ¤æ–­\n\n\t\t\t  å½“ä¸€æ‰¹å¯¹è±¡çš„å¤§å°å¤§äºSurvivoråŒºå¤§å°çš„50%ï¼Œè¿™æ‰¹å¯¹è±¡å°†ä¸è¯¢é—®å¹´é¾„ï¼Œç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚\n\n\t- è€å¹´ä»£\n\n\t\t- è¿›å…¥è€å¹´ä»£çš„è§„åˆ™\n\n\t\t\t- å¹´é¾„è¶…è¿‡MaxTenuring\n\t\t\t- åŠ¨æ€å¹´é¾„åˆ¤æ–­\n\t\t\t- è¶…è¿‡PretenureSizeçš„å¤§å¯¹è±¡\n\t\t\t- EdenåŒºå¹¸å­˜å¯¹è±¡è¶…è¿‡SurvivoråŒºå¤§å°\n\n- JVMå‚æ•°\n\n\t- -Xms\n\n\t  Javaå †å†…å­˜çš„å¤§å°\n\n\t- -Xmx\n\n\t  Javaå †å†…å­˜çš„æœ€å¤§å¤§å°\n\n\t- -Xmn\n\n\t  Javaå¯¹å†…å­˜ä¸­çš„æ–°ç”Ÿä»£å¤§å°ã€‚\n\t  è€å¹´ä»£=æ€»å¤§å°-æ–°ç”Ÿä»£\n\n\t- -XX:PermSize\n\n\t  æ°¸ä¹…ä»£å¤§å°\n\n\t- -XX:MaxPermSize\n\n\t  æ°¸ä¹…ä»£æœ€å¤§å¤§å°\n\n\t- -XX:MetaspaceSize\n\n\t  å…ƒç©ºé—´å¤§å°\n\n\t- -XX:MaxMetaspaceSize\n\n\t  å…ƒç©ºé—´æœ€å¤§å¤§å°\n\n\t- -Xss\n\n\t  Javaæ ˆå†…å­˜å¤§å°\n\n\t- -XX:MaxTenuringThreshold\n\n\t  å¯¹è±¡åœ¨å¹´è½»ä»£ä¸­å¹¸å­˜çš„æœ€å¤§è½®æ•°ã€‚\n\t  é»˜è®¤15ï¼Œä¸”ä¸èƒ½è¶…è¿‡15.\n\n\t- -XX:PretenureSizeThreshold\n\n\t  å½“å¯¹è±¡å¤§å°è¶…è¿‡è¯¥å€¼æ—¶ï¼Œå¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œä¸ä¼šè¿›è¿‡å¹´è½»ä»£ã€‚\n\t  é¿å…å¤§å¯¹è±¡åœ¨Survivorä¸­å¤šæ¬¡å¤åˆ¶ï¼Œå‡å°‘æ— è°“çš„æ“ä½œã€‚\n\n\t- -XX:-HandlePromotionFailure\n\n\t  åˆ¤æ–­è€å¹´ä»£å†…å­˜å¤§å°æ˜¯å¦å¤§äºä¹‹å‰æ¯ä¸€æ¬¡Minor GCåè¿›å…¥è€å¹´ä»£çš„å¯¹è±¡çš„å¹³å‡å¤§å°ã€‚\n\t  åˆ¤æ–­å¤±è´¥è¿›è¡ŒFull GCï¼Œå†æ‰§è¡ŒMinor GCã€‚\n\n\t- -XX:SurvivorRatio\n\n\t  è°ƒæ•´EdenåŒºå’ŒSurvivoråŒºå†…å­˜æ¯”ç‡\n\t  - XX:SurvivorRatio=8  ï¼š Eden 80%\n\n\t- -XX:+PrintGCDetils\n\n\t  æ‰“å°è¯¦ç»†çš„GCæ—¥å¿—ã€‚\n\n\t- -XX:+PrintGCTimeStamps\n\n\t  æ‰“å°GCå‘ç”Ÿçš„æ—¶é—´ã€‚\n\n\t- -Xloggc:gc.log\n\n\t  å°†CGæ—¥å¿—è¾“å…¥åˆ°æ–‡ä»¶ã€‚\n\n\t- -XX:TraceClassLoading\n\n\t  è¿½è¸ªåŠ è½½çš„ç±»\n\n\t- -XX:TraceClassUnloading\n\n\t  è¿½è¸ªå¸è½½çš„ç±»\n\n\t- -XX:+HeapDumpOnOutOfMemoryError  \n\n\t  OOMæ—¶è‡ªåŠ¨dumpå¿«ç…§\n\n\t- -XX:HeapDumpPath=/usr/local/app/oom\n\n\t  å°†å¿«ç…§å­˜æ”¾è‡³æŒ‡å®šç›®å½•\n\n\t- CMS\n\n\t\t- -XX:CMSInitiatingOccupancyFaction\n\n\t\t  è®¾ç½®è€å¹´ä»£å ç”¨å¤šå°‘æ¯”ä¾‹æ—¶è§¦å‘CMS\n\n\t\t- -XX:+UseCMSCompactAtFullCollection\n\n\t\t  Full GCåSTWï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ã€‚\n\n\t\t- -XX:CMSFullGCsBeforeCompaction\n\n\t\t  é»˜è®¤0ï¼Œè®¾ç½®å¤šå°‘æ¬¡Full GCåè¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†ã€‚\n\n\t\t- -XX:+CMSParallelInitialMarkEnabled\n\n\t\t  åˆå§‹æ ‡è®°é˜¶æ®µå¼€å¯å¹¶å‘æ‰§è¡Œ\n\n\t- G1\n\n\t\t- -XX:+UseG1GC\n\n\t\t  æŒ‡å®šG1åƒåœ¾å›æ”¶å™¨ã€‚\n\n\t\t- -XX:G1HeapRegionSize\n\n\t\t  æ‰‹åŠ¨æŒ‡å®šG1çš„Regionçš„å¤§å°ã€‚\n\n\t\t- -XX:G1NewSizePercent\n\n\t\t  è°ƒæ•´æ–°ç”Ÿä»£åœ¨å †ä¸­çš„å æ¯”ã€‚\n\t\t  é»˜è®¤5%ã€‚\n\n\t\t- -XX:G1MaxNewSizePercent\n\n\t\t  æ–°ç”Ÿä»£å æ¯”å †ç©ºé—´çš„æœ€å¤§å¤§å°ã€‚\n\n\t\t- -XX:MaxGCPauseMills\n\n\t\t  é»˜è®¤200msã€‚\n\t\t  è®¾ç½®G1åƒåœ¾å›æ”¶å™¨GCæ—¶çš„æœ€å¤§åœé¡¿æ—¶é—´ã€‚\n\n\t\t- -XX:InitiatingHeapOccupancyPercent\n\n\t\t  é»˜è®¤45%ã€‚\n\t\t  è€å¹´ä»£å æ®çš„å †å†…å­˜è¶…å¤šè¯¥å€¼ï¼Œå°†ä¼šè¿›è¡Œæ–°è€ç”Ÿä»£çš„æ··åˆå›æ”¶ã€‚\n\n\t\t- -XX:G1MixedGCCountTarget\n\n\t\t  ä¸€æ¬¡G1æ··åˆå›æ”¶è¿‡ç¨‹ä¸­ï¼Œæœ€åé˜¶æ®µæ··åˆå›æ”¶é˜¶æ®µåˆ†å‡ æ¬¡å®Œæˆã€‚\n\t\t  é»˜è®¤8ã€‚\n\n\t\t- -XX:G1HeapWastePercent\n\n\t\t  é»˜è®¤å€¼5%ã€‚\n\t\t  æ··åˆå›æ”¶é˜¶æ®µä¸­ï¼Œç©ºé—´Regionå æ¯”å †ç©ºé—´è¶…å¤šè¯¥å€¼ï¼Œä¼šåœæ­¢æ··åˆå›æ”¶ã€‚\n\n\t\t- -XX:G1MixedGCLiveThresholdPercent\n\n\t\t  é»˜è®¤å€¼85%ã€‚\n\t\t  ä¸€ä¸ªRegionä¸­çš„å­˜æ´»å¯¹è±¡ä½äºè¯¥å€¼æ—¶æ‰ä¼šè¢«å›æ”¶ã€‚\n\n\t\t- -XX:+CMSScavengeBeforeRemark\n\n\t\t  é‡æ–°æ ‡è®°å‰ï¼Œå°½é‡æ‰§è¡Œä¸€æ¬¡Young GCã€‚\n\t\t  æå‰å›æ”¶å¹´è½»ä»£æ²¡æœ‰å¼•ç”¨çš„å¯¹è±¡ï¼Œå‡å°‘é‡æ–°æ ‡è®°æ‰«æçš„å¯¹è±¡æ•°ï¼Œæé«˜æ•ˆç‡ã€‚\n\n- åƒåœ¾å›æ”¶\n\n\t- å¯è¾¾æ€§åˆ†æ\n\n\t  å¯¹ä¸€ä¸ªå¯¹è±¡å±‚å±‚å‘ä¸Šåˆ†æï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ä¸€ä¸ªGC Rootã€‚\n\n\t\t- GC Root\n\n\t\t\t- æœ¬åœ°å˜é‡è¡¨ä¸­çš„å±€éƒ¨å˜é‡\n\t\t\t- æ–¹æ³•åŒºå†…çš„é™æ€å˜é‡\n\n\t- java å¼•ç”¨ç±»å‹\n\n\t\t- å¼ºå¼•ç”¨\n\n\t\t  GCä¸ä¼šå›æ”¶å¼ºå¼•ç”¨\n\n\t\t- è½¯å¼•ç”¨\n\n\t\t  å†…å­˜ç©ºé—´è¶³å¤Ÿæ—¶ï¼ŒGCä¸ä¼šå›æ”¶è½¯å¼•ç”¨\n\n\t\t- å¼±å¼•ç”¨\n\n\t\t  GCæ—¶å¿…å®šå›æ”¶å¼±å¼•ç”¨\n\n\t\t- è™šå¼•ç”¨\n\n\t\t  ç»§æ‰¿Objectçš„finalize()æ–¹æ³•ï¼Œåœ¨è¯¥å¯¹è±¡è¢«å›æ”¶çš„æ—¶å€™é€šçŸ¥è‡ªå·±ã€‚\n\n\t- åƒåœ¾å›æ”¶ç®—æ³•\n\n\t\t- å¹´è½»ä»£\n\n\t\t\t- å¤åˆ¶\n\n\t\t\t  åœ¨æ–°ç”Ÿä»£å¹¸å­˜è€…0,1åŒºä½¿ç”¨ã€‚å°†æ ‡è®°ä¸ºå¯ç”¨çš„å†…å­˜å¤åˆ¶åˆ°å¦å¤–ä¸€ç‰‡è¿ç»­çš„å†…å­˜åŒºåŸŸä¸­ï¼Œå¹¶åˆ é™¤å½“å‰å†…å­˜åŒºåŸŸä¸­çš„å…¨éƒ¨æ•°æ®ã€‚\n\n\t\t\t\t- ä¼˜ç‚¹\n\n\t\t\t\t  ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡\n\n\t\t\t\t- ç¼ºç‚¹\n\n\t\t\t\t  å¢åŠ å†…å­˜çš„æ¶ˆè€—\n\n\t\t- è€å¹´ä»£\n\n\t\t\t- æ ‡è®°æ•´ç†\n\n\t\t\t  æ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œåˆ é™¤æ­»äº¡å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ã€‚\n\n\t\t\t\t- ä¼˜ç‚¹\n\n\t\t\t\t  ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚å†…å­˜åˆ©ç”¨ç‡é«˜ã€‚\n\n\t\t\t\t- ç¼ºç‚¹\n\n\t\t\t\t  æ¯”èµ·æ ‡è®°æ¸…æ¥šï¼Œæ‰§è¡Œæ•ˆç‡æ…¢ã€‚\n\n\t- JVMåƒåœ¾å›æ”¶å™¨\n\n\t\t- å¹´è½»ä»£\n\n\t\t\t- ParNew\n\n\t\t\t  å¤šçº¿ç¨‹ï¼Œå¤åˆ¶ç®—æ³•ã€‚\n\t\t\t  å¼€å¯ï¼š-XX:+UseParNewGC\n\t\t\t  è°ƒæ•´å›æ”¶çº¿ç¨‹æ•°ï¼š-XX:ParallelGCThreads\n\n\t\t- è€å¹´ä»£\n\n\t\t\t- CMS\n\n\t\t\t  æ ‡è®°æ¸…ç†ç®—æ³•\n\n\t\t\t\t- å›æ”¶è¿‡ç¨‹\n\n\t\t\t\t\t- åˆå§‹æ ‡è®°\n\n\t\t\t\t\t  STWã€‚\n\t\t\t\t\t  æ ‡è®°æ‰€æœ‰GC Rootsç›´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼Œè¢«ç›´æ¥å¼•ç”¨çš„å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«æ ‡è®°ã€‚\n\n\t\t\t\t\t- å¹¶å‘æ ‡è®°\n\n\t\t\t\t\t  å¯»æ‰¾è¢«GC Rootsé—´æ¥å¼•ç”¨çš„å¯¹è±¡ã€‚\n\n\t\t\t\t\t- é‡æ–°æ ‡è®°\n\n\t\t\t\t\t  STWã€‚\n\t\t\t\t\t  é‡æ–°æ ‡è®°å¹¶å‘æ ‡è®°æ—¶äº§ç”Ÿçš„æ–°å¯¹è±¡ã€‚\n\n\t\t\t\t\t- å¹¶å‘æ¸…é™¤\n\n\t\t\t\t\t  æ¸…ç†æ ‡è®°çš„å¯¹è±¡ã€‚\n\n\t\t\t\t- ç¼ºç‚¹\n\n\t\t\t\t  é»˜è®¤å¯åŠ¨åƒåœ¾å›æ”¶çº¿ç¨‹ï¼šï¼ˆCPUæ ¸æ•° +3ï¼‰/4ã€‚\n\t\t\t\t  æœ¬èº«ä¼šæ¶ˆè€—CPUèµ„æºã€‚\n\t\t\t\t  é’ˆå¯¹æµ®åŠ¨åƒåœ¾ï¼Œåˆå§‹æ ‡è®°åäº§ç”Ÿçš„åƒåœ¾æ²¡æ³•å›æ”¶ã€‚\n\t\t\t\t  CMSå›æ”¶æœŸé—´ï¼Œæ–°ç”Ÿä»£è¿›å…¥è€å¹´ä»£å¯¹è±¡å¤§äºå¯ç”¨ç©ºé—´æ—¶ï¼Œä¼šå‘ç”ŸConcurrent Mode Failure ï¼Œå¹¶è‡ªåŠ¨ä½¿ç”¨Serial Oldå›æ”¶å™¨æ›¿ä»£CMSå·¥ä½œã€‚\n\n\t\t- G1\n\n\t\t  åŸºäºå¤åˆ¶ç®—æ³•ã€‚\n\t\t  æŠŠJavaå †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„Regionã€‚\n\t\t  å¯ä»¥è®¾ç½®STWçš„æ—¶é—´ï¼Œè¿½è¸ªæ¯ä¸ªRegioné‡Œå¯å›æ”¶å¯¹è±¡çš„é¢„ä¼°æ—¶é—´ã€‚\n\t\t  G1ä¸­çš„åˆ†ä»£æ˜¯é€»è¾‘ä¸Šçš„åˆ†ä»£ï¼ŒåŒä¸€ä¸ªRegionä¼šéšç€åˆ†é…çš„å†…å­˜å¯¹è±¡ä¸åŒï¼Œè€Œå±äºä¸åŒåˆ†ä»£ã€‚\n\t\t  æ¯ä¸ªRegionçš„å¤§å°ï¼šå †å¤§å°/2048ã€‚\n\t\t  æ–°ç”Ÿä»£çš„RegionåŒæ—¶åˆ†Edenå’ŒSurvivorï¼Œå¯é€šè¿‡-XX:SurvivorRatioè°ƒæ•´å æ¯”ã€‚\n\t\t  é€‚åˆå¤§å†…å­˜çš„æœºå™¨ï¼ŒG1å¯ä»¥è®¾ç½®åœé¡¿æ—¶é—´ï¼Œæ¥ç¡®ä¿å¯¹æœåŠ¡ä¸ä¼šæœ‰è¾ƒå¤§çš„å½±å“ã€‚\n\n\t\t\t- å¤§å¯¹è±¡\n\n\t\t\t  è¶…å¤šRegionå¤§å°50%å³ä¸ºå¤§å¯¹è±¡ã€‚\n\t\t\t  å¤§å¯¹è±¡å¯èƒ½æ¨ªè·¨å¤šä¸ªRegionã€‚\n\t\t\t  ç©ºçš„Regionéƒ½å¯ä»¥å­˜æ”¾å¤§å¯¹è±¡ã€‚\n\t\t\t  æ–°è€ç”Ÿä»£GCæ—¶éƒ½ä¼šå›æ”¶å¤§å¯¹è±¡ã€‚\n\n\t\t\t- å›æ”¶è¿‡ç¨‹\n\n\t\t\t\t- åˆå§‹æ ‡è®°\n\n\t\t\t\t  STWã€‚\n\t\t\t\t  æ ‡è®°æ‰€æœ‰GC Rootsç›´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼Œè¢«ç›´æ¥å¼•ç”¨çš„å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«æ ‡è®°ã€‚\n\n\t\t\t\t- å¹¶å‘æ ‡è®°\n\n\t\t\t\t  è¿›è¡ŒGC Rootsçš„è¿½è¸ªï¼Œè¿½è¸ªæ‰€æœ‰å­˜æ´»å¯¹è±¡ã€‚\n\t\t\t\t  åŒæ—¶JVMä¼šè®°å½•è¯¥é˜¶æ®µä¸­æ–°å»ºæˆ–å¤±å»å¼•ç”¨çš„å¯¹è±¡ã€‚\n\n\t\t\t\t- æœ€ç»ˆæ ‡è®°\n\n\t\t\t\t  STWã€‚\n\t\t\t\t  é€šè¿‡å¤šå¹¶å‘æ ‡è®°ä¸­JVMå †æ–°å¢æˆ–å¤±å»å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿›è¡Œé‡æ–°æ ‡è®°ã€‚\n\n\t\t\t\t- æ··åˆå›æ”¶\n\n\t\t\t\t  åˆ†æRegionå¤§å°ï¼Œæ‰§è¡Œæ•ˆç‡ã€‚\n\t\t\t\t  STWã€‚\n\t\t\t\t  åœ¨æŒ‡å®šæ—¶é—´å†…è¿›è¡Œå›æ”¶ã€‚\n\n\t\t\t- é—®é¢˜\n\n\t\t\t  å›æ”¶ä¸­å‘ç°Regionç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå°†ä¼šSWTï¼Œå¹¶å•çº¿ç¨‹è¿›è¡Œæ ‡è®°ã€æ¸…é™¤ã€æ•´ç†ï¼Œæ•ˆç‡å¾ˆä½ã€‚\n\n\t- CGè§¦å‘æ—¶é—´\n\n\t\t- Minor GC\n\n\t\t  EdenåŒºæ»¡æ—¶é‡‡ç”¨å¤åˆ¶ç®—æ³•ã€‚\n\n\t\t- Old GC\n\n\t\t  1.è€å¹´ä»£è¿ç»­å¯ç”¨ç©ºé—´ < æ–°ç”Ÿä»£å†æ¬¡GCåå‡å…¥è€å¹´ä»£å¯¹è±¡å†…å­˜å’Œçš„å¹³å‡å¤§å°ã€‚\n\t\t  2.è€å¹´ä»£ä¸å¤Ÿå­˜æ”¾ï¼ŒMinor GCåå‡å…¥è€å¹´ä»£çš„å¯¹è±¡æ—¶ã€‚\n\t\t  3.è€å¹´ä»£å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡92%æ—¶ï¼ˆå¯è®¾ç½®ï¼‰ã€‚\n\n\t\t- æ°¸ä¹…ä»£GC\n\n\t\t  æ°¸ä¹…ä»£ä¸å¤Ÿä½¿äº§ç”ŸFull GCã€‚\n\n### æœ¬åœ°æ–¹æ³•æ ˆ\n\nå­˜æ”¾nativeæ–¹æ³•ã€‚\n\n### å †å¤–å†…å­˜ç©ºé—´\n\né€šè¿‡è°ƒç”¨æ“ä½œç³»ç»Ÿæ¥å£ï¼Œç›´æ¥åˆ†é…å¯¹å¤–å†…å­˜ç©ºé—´ã€‚\nNIO->allocateDirect(DirectByteBuffer)\n\n## å·¥å…·\n\n### jstat\n\né€šè¿‡jpsæŸ¥æ‰¾javaè¿›ç¨‹ï¼Œå†ç”¨jstat -gc PIDæŸ¥çœ‹GCçŠ¶å†µã€‚\n\n- æŒ‡æ ‡\n\n\t- S0C\n\n\t  From SurvivoråŒºå¤§å°\n\n\t- S1C\n\n\t  To SurvivoråŒºå¤§å°\n\n\t- S0U\n\n\t  From SurvivoråŒºå½“å‰ä½¿ç”¨å¤§å°\n\n\t- S1U\n\n\t  To SurvivoråŒºå½“å‰ä½¿ç”¨å¤§å°\n\n\t- EC\n\n\t  EdenåŒºå¤§å°\n\n\t- EU\n\n\t  EdenåŒºå½“å‰ä½¿ç”¨çš„å¤§å°\n\n\t- OC\n\n\t  è€å¹´ä»£çš„å¤§å°\n\n\t- OU\n\n\t  è€å¹´ä»£å½“å‰ä½¿ç”¨çš„å¤§å°\n\n\t- MC\n\n\t  æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ã€å…ƒç©ºé—´ï¼‰çš„å¤§å°\n\n\t- MU\n\n\t  æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ã€å…ƒç©ºé—´ï¼‰å½“å‰ä½¿ç”¨çš„å¤§å°\n\n\t- YGC\n\n\t  ç³»ç»Ÿè¿„ä»Šä¸ºæ­¢Young GCçš„æ¬¡æ•°\n\n\t- YGCT\n\n\t  Young GCè€—æ—¶\n\n\t- FGC\n\n\t  ç³»ç»Ÿè¿„ä»Šä¸ºæ­¢Full GCçš„æ¬¡æ•°\n\n\t- FGCT\n\n\t  Full GCçš„è€—æ—¶\n\n\t- GCT\n\n\t  æ‰€æœ‰GCçš„æ€»è€—æ—¶\n\n- å‘½ä»¤\n\n\t- jstat -gc PID\n\n\t  æŸ¥çœ‹GCçŠ¶å†µ\n\n\t- jstat -gccapacity PID\n\n\t  å †å†…å­˜åˆ†æ\n\n\t- jstat -gcnew PID\n\n\t  æ–°ç”Ÿä»£åˆ†æ\n\n\t- jstat -gcnewcapacity PID\n\n\t  å¹´è½»ä»£å†…å­˜åˆ†æ\n\n\t- jstat -gcold PID\n\n\t  è€å¹´ä»£GCåˆ†æ\n\n\t- jstat -gcoldcapacity PID\n\n\t  è€å¹´ä»£å†…å­˜åˆ†æ\n\n\t- jstat -gcmetacapacity PID\n\n\t  å…ƒæ•°æ®å†…å­˜åˆ†æ\n\n### jmap\n\näº†è§£è¿è¡Œæ—¶çš„å†…å­˜åŒºåŸŸ\n\n- å‘½ä»¤\n\n\t- jmap -heap PID\n\n\t  æ‰“å°å †å†…å­˜ç›¸å…³å‚æ•°è®¾ç½®ã€‚\n\t  å½“å‰å †å†…å„ä¸ªåŒºçš„åŸºæœ¬æƒ…å†µã€‚\n\n\t- jmap -histo PID\n\n\t  æŒ‰ç…§å¯¹è±¡åœ¨å†…å­˜ä¸­å ç”¨å¤§å°æ’åºï¼Œé™åºã€‚\n\t  å¯ä»¥äº†è§£å“ªä¸ªå¯¹è±¡åœ¨å †ä¸­å ç”¨äº†å¤§é‡çš„ç©ºé—´ã€‚\n\n\t- jmap -dump:live,format=b,file=dump.hprof PID\n\n\t  ç”Ÿæˆå†…å­˜å¿«ç…§å¹¶è¾“å‡ºåˆ°æ–‡ä»¶ã€‚\n\n### jhat\n\nåˆ†æå †å†…å­˜å¿«ç…§ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·å†…ç½®çš„æµè§ˆå™¨æŸ¥çœ‹ã€‚\n\n- å‘½ä»¤\n\n\t- jhat dump.hprof -port 7000\n\n\t  åˆ†æå¿«ç…§æ–‡ä»¶dump.hprof ï¼Œè®¿é—®ç«¯å£7000ã€‚\n\n### MAT\n\nå†…å­˜åˆ†æå·¥å…·\n\n## JVMä¼˜åŒ–æ€»ç»“\n\n### è°ƒæ•´æ–°ç”Ÿä»£çš„å¤§å°\n\nå°½é‡è®©æ¯æ¬¡Young GCåçš„å­˜æ´»å¯¹è±¡â¼©äºSurvivoråŒºåŸŸçš„50%ï¼Œéƒ½ç•™å­˜åœ¨å¹´è½»ä»£â¾¥ã€‚å°½é‡åˆ«è®©å¯¹è±¡è¿› â¼Šâ½¼å¹´ä»£ã€‚å°½é‡å‡å°‘Full GCçš„é¢‘ç‡ï¼Œé¿å…é¢‘ç¹Full GCå¯¹JVMæ€§èƒ½çš„å½±å“\n\n### è°ƒæ•´è€å¹´ä»£ç¢ç‰‡å›æ”¶çš„é¢‘ç‡\n\nCMSä¸€æ¬¡Full GCä¼šäº§ç”Ÿå†…å­˜éšä¾¿ï¼Œè°ƒæ•´ç¢ç‰‡æ•´ç†çš„è§¦å‘è½®æ•°ï¼Œå¯ä»¥æœ‰æ•ˆçš„é™ä½Full  GCäº§ç”Ÿçš„ç¢ç‰‡ä»è€Œé™ä½Full GCçš„é¢‘æ¬¡ã€‚\n\n### JVMå‚æ•°æ¨¡æ¿\n\n-Xms4096M -Xmx4096M -Xmn3072M -Xss1MÂ -XX:MetaspaceSize=256M -XX:MaxMetaspaceSize=256M -XX:+UseParNewGC - XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFaction=92 -XX:+UseCMSCompactAtFullCollection - XX:CMSFullGCsBeforeCompaction=0 -XX:+CMSParallelInitialMarkEnabled -XX:+CMSScavengeBeforeRemark - XX:+DisableExplicitGC -XX:+PrintGCDetails -Xloggc:gc.log -XX:+HeapDumpOnOutOfMemoryErrorÂ - XX:HeapDumpPath=/usr/local/app/oom\n\n### -XX:SoftRefLRUPolicyMSPerMB\n\nåœ¨æœ‰å¤§é‡åå°„çš„æƒ…å†µä¸‹å»ºè®®å¢å¤§è¯¥å€¼ï¼Œä¿è¯è½¯å¼•ç”¨ä¸ä¼šè¢«é©¬ä¸Šå›æ”¶\n\n### -XX:+DisableExplicitGC\n\nç¦æ­¢æ˜¾ç¤ºæ‰§è¡ŒGC\næ€§è´¨System.gc()\n\n### ä½¿ç”¨ç¼“å­˜æ·˜æ±°æœºåˆ¶\n\né¿å…æœ¬åœ°ç¼“å­˜æ— é™å¢å¤§ï¼Œä½¿å¾—è€å¹´ä»£å¸¸é©»å¯¹è±¡æ— æ³•å›æ”¶ï¼Œä»è€Œå¯¼è‡´çš„å†…å­˜æº¢å‡ºå’Œé¢‘ç¹çš„Full GCã€‚\n\n### é¢‘ç¹Full GCçš„å¯èƒ½åŸå› \n\n1.ç³»ç»Ÿå‹åŠ›å¤§ï¼Œé¢‘ç¹Young GCåå­˜æ´»å¯¹è±¡å¤§äºSurvivoråŒºï¼Œå¯¼è‡´ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚\n2.é¢‘ç¹äº§ç”Ÿå¤§å¯¹è±¡ã€‚\n3.å¯¹è±¡å§‹ç»ˆä¸é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚\n4.æ–¹æ³•åŒºé¢‘ç¹æœ‰ç±»åå°„åŠ è½½ã€‚\n5.é”™è¯¯ä½¿ç”¨System.gc()ã€‚\n\n*XMind: ZEN - Trial Version*","source":"_posts/JVM-æ•´ç†.md","raw":"---\ntitle: JVM æ•´ç†\ndate: 2020-02-22 15:03:19\ntags: \n    - JVM\n    - Java\ncategories :\n    - Technology\n---\n\n# JVM ç›¸å…³çŸ¥è¯†æ•´ç†\n1. å†…å­˜åˆ†é…\n2. åƒåœ¾å›æ”¶å™¨çš„å‚æ•°é…ç½®\n\n## ç±»çš„åŠ è½½\n<!-- more -->\nåŠ è½½->éªŒè¯->å‡†å¤‡->è§£æ->åˆå§‹åŒ–->ä½¿ç”¨->å¸è½½\n\n### åŠ è½½æµç¨‹\n\n- åŠ è½½\n\n  ä»£ç ä¸­ä½¿ç”¨åˆ°è¿™ä¸ªç±»çš„æ—¶å€™ï¼Œ.classå­—èŠ‚ç æ–‡ä»¶å°±ä¼šåŠ è½½è¿™ä¸ªç±»åˆ°JVMå†…å­˜ä¸­ã€‚\n\n- é“¾æ¥\n\n\t- éªŒè¯\n\n\t  æ ¹æ®JVMè§„èŒƒï¼Œæ ¡éªŒ.classæ–‡ä»¶ã€‚\n\n\t- å‡†å¤‡\n\n\t  ç»™åŠ è½½çš„ç±»åˆ†é…å†…å­˜ç©ºé—´ï¼ŒåŒæ—¶ç»™ç±»çš„staticå˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå¹¶è®¾ç½®é»˜è®¤å€¼0ã€‚\n\t  clint()\n\n\t- è§£æ\n\n\t  æŠŠç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚\n\n- åˆå§‹åŒ–\n\n  ä¸ºç±»å˜é‡èµ‹å€¼ï¼šé™æ€æ–¹æ³•ï¼Œé™æ€å˜é‡ï¼Œé™æ€å—ã€‚\n  åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æœ‰çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–ä»–çš„çˆ¶ç±»ã€‚\n\n### ç±»åŠ è½½å™¨\n\n- åŠ è½½å™¨\n\n\t- BootStrap ClassLoader\n\n\t  åŠ è½½libç›®å½•ä¸‹çš„ç±»åº“\n\n\t- Extension ClassLoader\n\n\t  åŠ è½½lib\\extç›®å½•ä¸‹çš„ç±»åº“\n\n\t- Application ClassLoader\n\n\t  åŠ è½½ClassPathä¸‹çš„ç±»\n\n\t- è‡ªå®šä¹‰åŠ è½½å™¨\n\n- åŒäº²å§”æ´¾æœºåˆ¶\n\n  å…ˆæ‰¾çˆ¶äº²åŠ è½½ï¼ŒåŠ è½½ä¸äº†å†æ‰¾å„¿å­åŠ è½½\n\n## å†…å­˜ç»“æ„\n\n### æ–¹æ³•åŒºã€å…ƒç©ºé—´ã€æ°¸ä¹…ä»£\n\nå­˜æ”¾ç±»çš„å®šä¹‰ï¼Œå¸¸é‡æ± ç­‰ã€‚\nmatespaceæ»¡åä¼šè§¦å‘Full GCã€‚\næ–¹æ³•åŒºåƒåœ¾å›æ”¶ï¼š\n1.è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹å·²ç»è¢«å›æ”¶\n2.åŠ è½½è¯¥ç±»çš„ClassLoaderå·²ç»è¢«å›æ”¶\n3.è¯¥ç±»çš„Classå¯¹è±¡æ²¡æœ‰è¢«ä»»ä½•å¼•ç”¨\n\n### ç¨‹åºæŠ€æœ¯å™¨\n\nè®°å½•å½“å‰æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ä½ç½®ã€‚\nçº¿ç¨‹ç§æœ‰ã€‚\n\n### Javaè™šæ‹Ÿæœºæ ˆ\n\nä¿å­˜æ–¹æ³•ä¿¡æ¯ã€‚\nçº¿ç¨‹ç§æœ‰ã€‚\n\n- æ ˆå¸§\n\n\t- å±€éƒ¨å˜é‡è¡¨\n\t- æ“ä½œæ•°æ ˆ\n\t- åŠ¨æ€é“¾æ¥\n\t- æ–¹æ³•è¿”å›åœ°å€\n\t- å…¶ä»–\n\n### Javaå †å†…å­˜\n\nå­˜æ”¾ç±»çš„å®ä¾‹å¯¹è±¡ã€‚\n\n- åˆ†ä»£\n\n\t- å¹´è½»ä»£\n\n\t  æ–°ç”Ÿä»£è¿›å…¥è€å¹´ä»£ï¼šé»˜è®¤15æ¬¡\n\n\t\t- EdenåŒº\n\n\t\t  é»˜è®¤æ–°ç”Ÿä»£80%ç©ºé—´ã€‚\n\t\t  æ–°å»ºå¯¹è±¡äº§ç”Ÿåœ¨EdenåŒºã€‚\n\t\t  EdenåŒºæ»¡åä¼šå‘ç”ŸMinor GCã€‚\n\n\t\t- Survivor0,1åŒº\n\n\t\t  é»˜è®¤å¹´è½»ä»£20%ã€‚Survivor 0:10%  Survivor 1:10%ã€‚\n\t\t  é»˜è®¤å¯¹è±¡å¹¸å­˜15æ¬¡åï¼Œä¼šè¿›å…¥è€å¹´åŒºã€‚\n\n\t\t\t- åŠ¨æ€å¹´é¾„åˆ¤æ–­\n\n\t\t\t  å½“ä¸€æ‰¹å¯¹è±¡çš„å¤§å°å¤§äºSurvivoråŒºå¤§å°çš„50%ï¼Œè¿™æ‰¹å¯¹è±¡å°†ä¸è¯¢é—®å¹´é¾„ï¼Œç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚\n\n\t- è€å¹´ä»£\n\n\t\t- è¿›å…¥è€å¹´ä»£çš„è§„åˆ™\n\n\t\t\t- å¹´é¾„è¶…è¿‡MaxTenuring\n\t\t\t- åŠ¨æ€å¹´é¾„åˆ¤æ–­\n\t\t\t- è¶…è¿‡PretenureSizeçš„å¤§å¯¹è±¡\n\t\t\t- EdenåŒºå¹¸å­˜å¯¹è±¡è¶…è¿‡SurvivoråŒºå¤§å°\n\n- JVMå‚æ•°\n\n\t- -Xms\n\n\t  Javaå †å†…å­˜çš„å¤§å°\n\n\t- -Xmx\n\n\t  Javaå †å†…å­˜çš„æœ€å¤§å¤§å°\n\n\t- -Xmn\n\n\t  Javaå¯¹å†…å­˜ä¸­çš„æ–°ç”Ÿä»£å¤§å°ã€‚\n\t  è€å¹´ä»£=æ€»å¤§å°-æ–°ç”Ÿä»£\n\n\t- -XX:PermSize\n\n\t  æ°¸ä¹…ä»£å¤§å°\n\n\t- -XX:MaxPermSize\n\n\t  æ°¸ä¹…ä»£æœ€å¤§å¤§å°\n\n\t- -XX:MetaspaceSize\n\n\t  å…ƒç©ºé—´å¤§å°\n\n\t- -XX:MaxMetaspaceSize\n\n\t  å…ƒç©ºé—´æœ€å¤§å¤§å°\n\n\t- -Xss\n\n\t  Javaæ ˆå†…å­˜å¤§å°\n\n\t- -XX:MaxTenuringThreshold\n\n\t  å¯¹è±¡åœ¨å¹´è½»ä»£ä¸­å¹¸å­˜çš„æœ€å¤§è½®æ•°ã€‚\n\t  é»˜è®¤15ï¼Œä¸”ä¸èƒ½è¶…è¿‡15.\n\n\t- -XX:PretenureSizeThreshold\n\n\t  å½“å¯¹è±¡å¤§å°è¶…è¿‡è¯¥å€¼æ—¶ï¼Œå¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œä¸ä¼šè¿›è¿‡å¹´è½»ä»£ã€‚\n\t  é¿å…å¤§å¯¹è±¡åœ¨Survivorä¸­å¤šæ¬¡å¤åˆ¶ï¼Œå‡å°‘æ— è°“çš„æ“ä½œã€‚\n\n\t- -XX:-HandlePromotionFailure\n\n\t  åˆ¤æ–­è€å¹´ä»£å†…å­˜å¤§å°æ˜¯å¦å¤§äºä¹‹å‰æ¯ä¸€æ¬¡Minor GCåè¿›å…¥è€å¹´ä»£çš„å¯¹è±¡çš„å¹³å‡å¤§å°ã€‚\n\t  åˆ¤æ–­å¤±è´¥è¿›è¡ŒFull GCï¼Œå†æ‰§è¡ŒMinor GCã€‚\n\n\t- -XX:SurvivorRatio\n\n\t  è°ƒæ•´EdenåŒºå’ŒSurvivoråŒºå†…å­˜æ¯”ç‡\n\t  - XX:SurvivorRatio=8  ï¼š Eden 80%\n\n\t- -XX:+PrintGCDetils\n\n\t  æ‰“å°è¯¦ç»†çš„GCæ—¥å¿—ã€‚\n\n\t- -XX:+PrintGCTimeStamps\n\n\t  æ‰“å°GCå‘ç”Ÿçš„æ—¶é—´ã€‚\n\n\t- -Xloggc:gc.log\n\n\t  å°†CGæ—¥å¿—è¾“å…¥åˆ°æ–‡ä»¶ã€‚\n\n\t- -XX:TraceClassLoading\n\n\t  è¿½è¸ªåŠ è½½çš„ç±»\n\n\t- -XX:TraceClassUnloading\n\n\t  è¿½è¸ªå¸è½½çš„ç±»\n\n\t- -XX:+HeapDumpOnOutOfMemoryError  \n\n\t  OOMæ—¶è‡ªåŠ¨dumpå¿«ç…§\n\n\t- -XX:HeapDumpPath=/usr/local/app/oom\n\n\t  å°†å¿«ç…§å­˜æ”¾è‡³æŒ‡å®šç›®å½•\n\n\t- CMS\n\n\t\t- -XX:CMSInitiatingOccupancyFaction\n\n\t\t  è®¾ç½®è€å¹´ä»£å ç”¨å¤šå°‘æ¯”ä¾‹æ—¶è§¦å‘CMS\n\n\t\t- -XX:+UseCMSCompactAtFullCollection\n\n\t\t  Full GCåSTWï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ã€‚\n\n\t\t- -XX:CMSFullGCsBeforeCompaction\n\n\t\t  é»˜è®¤0ï¼Œè®¾ç½®å¤šå°‘æ¬¡Full GCåè¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†ã€‚\n\n\t\t- -XX:+CMSParallelInitialMarkEnabled\n\n\t\t  åˆå§‹æ ‡è®°é˜¶æ®µå¼€å¯å¹¶å‘æ‰§è¡Œ\n\n\t- G1\n\n\t\t- -XX:+UseG1GC\n\n\t\t  æŒ‡å®šG1åƒåœ¾å›æ”¶å™¨ã€‚\n\n\t\t- -XX:G1HeapRegionSize\n\n\t\t  æ‰‹åŠ¨æŒ‡å®šG1çš„Regionçš„å¤§å°ã€‚\n\n\t\t- -XX:G1NewSizePercent\n\n\t\t  è°ƒæ•´æ–°ç”Ÿä»£åœ¨å †ä¸­çš„å æ¯”ã€‚\n\t\t  é»˜è®¤5%ã€‚\n\n\t\t- -XX:G1MaxNewSizePercent\n\n\t\t  æ–°ç”Ÿä»£å æ¯”å †ç©ºé—´çš„æœ€å¤§å¤§å°ã€‚\n\n\t\t- -XX:MaxGCPauseMills\n\n\t\t  é»˜è®¤200msã€‚\n\t\t  è®¾ç½®G1åƒåœ¾å›æ”¶å™¨GCæ—¶çš„æœ€å¤§åœé¡¿æ—¶é—´ã€‚\n\n\t\t- -XX:InitiatingHeapOccupancyPercent\n\n\t\t  é»˜è®¤45%ã€‚\n\t\t  è€å¹´ä»£å æ®çš„å †å†…å­˜è¶…å¤šè¯¥å€¼ï¼Œå°†ä¼šè¿›è¡Œæ–°è€ç”Ÿä»£çš„æ··åˆå›æ”¶ã€‚\n\n\t\t- -XX:G1MixedGCCountTarget\n\n\t\t  ä¸€æ¬¡G1æ··åˆå›æ”¶è¿‡ç¨‹ä¸­ï¼Œæœ€åé˜¶æ®µæ··åˆå›æ”¶é˜¶æ®µåˆ†å‡ æ¬¡å®Œæˆã€‚\n\t\t  é»˜è®¤8ã€‚\n\n\t\t- -XX:G1HeapWastePercent\n\n\t\t  é»˜è®¤å€¼5%ã€‚\n\t\t  æ··åˆå›æ”¶é˜¶æ®µä¸­ï¼Œç©ºé—´Regionå æ¯”å †ç©ºé—´è¶…å¤šè¯¥å€¼ï¼Œä¼šåœæ­¢æ··åˆå›æ”¶ã€‚\n\n\t\t- -XX:G1MixedGCLiveThresholdPercent\n\n\t\t  é»˜è®¤å€¼85%ã€‚\n\t\t  ä¸€ä¸ªRegionä¸­çš„å­˜æ´»å¯¹è±¡ä½äºè¯¥å€¼æ—¶æ‰ä¼šè¢«å›æ”¶ã€‚\n\n\t\t- -XX:+CMSScavengeBeforeRemark\n\n\t\t  é‡æ–°æ ‡è®°å‰ï¼Œå°½é‡æ‰§è¡Œä¸€æ¬¡Young GCã€‚\n\t\t  æå‰å›æ”¶å¹´è½»ä»£æ²¡æœ‰å¼•ç”¨çš„å¯¹è±¡ï¼Œå‡å°‘é‡æ–°æ ‡è®°æ‰«æçš„å¯¹è±¡æ•°ï¼Œæé«˜æ•ˆç‡ã€‚\n\n- åƒåœ¾å›æ”¶\n\n\t- å¯è¾¾æ€§åˆ†æ\n\n\t  å¯¹ä¸€ä¸ªå¯¹è±¡å±‚å±‚å‘ä¸Šåˆ†æï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ä¸€ä¸ªGC Rootã€‚\n\n\t\t- GC Root\n\n\t\t\t- æœ¬åœ°å˜é‡è¡¨ä¸­çš„å±€éƒ¨å˜é‡\n\t\t\t- æ–¹æ³•åŒºå†…çš„é™æ€å˜é‡\n\n\t- java å¼•ç”¨ç±»å‹\n\n\t\t- å¼ºå¼•ç”¨\n\n\t\t  GCä¸ä¼šå›æ”¶å¼ºå¼•ç”¨\n\n\t\t- è½¯å¼•ç”¨\n\n\t\t  å†…å­˜ç©ºé—´è¶³å¤Ÿæ—¶ï¼ŒGCä¸ä¼šå›æ”¶è½¯å¼•ç”¨\n\n\t\t- å¼±å¼•ç”¨\n\n\t\t  GCæ—¶å¿…å®šå›æ”¶å¼±å¼•ç”¨\n\n\t\t- è™šå¼•ç”¨\n\n\t\t  ç»§æ‰¿Objectçš„finalize()æ–¹æ³•ï¼Œåœ¨è¯¥å¯¹è±¡è¢«å›æ”¶çš„æ—¶å€™é€šçŸ¥è‡ªå·±ã€‚\n\n\t- åƒåœ¾å›æ”¶ç®—æ³•\n\n\t\t- å¹´è½»ä»£\n\n\t\t\t- å¤åˆ¶\n\n\t\t\t  åœ¨æ–°ç”Ÿä»£å¹¸å­˜è€…0,1åŒºä½¿ç”¨ã€‚å°†æ ‡è®°ä¸ºå¯ç”¨çš„å†…å­˜å¤åˆ¶åˆ°å¦å¤–ä¸€ç‰‡è¿ç»­çš„å†…å­˜åŒºåŸŸä¸­ï¼Œå¹¶åˆ é™¤å½“å‰å†…å­˜åŒºåŸŸä¸­çš„å…¨éƒ¨æ•°æ®ã€‚\n\n\t\t\t\t- ä¼˜ç‚¹\n\n\t\t\t\t  ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡\n\n\t\t\t\t- ç¼ºç‚¹\n\n\t\t\t\t  å¢åŠ å†…å­˜çš„æ¶ˆè€—\n\n\t\t- è€å¹´ä»£\n\n\t\t\t- æ ‡è®°æ•´ç†\n\n\t\t\t  æ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œåˆ é™¤æ­»äº¡å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ã€‚\n\n\t\t\t\t- ä¼˜ç‚¹\n\n\t\t\t\t  ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚å†…å­˜åˆ©ç”¨ç‡é«˜ã€‚\n\n\t\t\t\t- ç¼ºç‚¹\n\n\t\t\t\t  æ¯”èµ·æ ‡è®°æ¸…æ¥šï¼Œæ‰§è¡Œæ•ˆç‡æ…¢ã€‚\n\n\t- JVMåƒåœ¾å›æ”¶å™¨\n\n\t\t- å¹´è½»ä»£\n\n\t\t\t- ParNew\n\n\t\t\t  å¤šçº¿ç¨‹ï¼Œå¤åˆ¶ç®—æ³•ã€‚\n\t\t\t  å¼€å¯ï¼š-XX:+UseParNewGC\n\t\t\t  è°ƒæ•´å›æ”¶çº¿ç¨‹æ•°ï¼š-XX:ParallelGCThreads\n\n\t\t- è€å¹´ä»£\n\n\t\t\t- CMS\n\n\t\t\t  æ ‡è®°æ¸…ç†ç®—æ³•\n\n\t\t\t\t- å›æ”¶è¿‡ç¨‹\n\n\t\t\t\t\t- åˆå§‹æ ‡è®°\n\n\t\t\t\t\t  STWã€‚\n\t\t\t\t\t  æ ‡è®°æ‰€æœ‰GC Rootsç›´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼Œè¢«ç›´æ¥å¼•ç”¨çš„å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«æ ‡è®°ã€‚\n\n\t\t\t\t\t- å¹¶å‘æ ‡è®°\n\n\t\t\t\t\t  å¯»æ‰¾è¢«GC Rootsé—´æ¥å¼•ç”¨çš„å¯¹è±¡ã€‚\n\n\t\t\t\t\t- é‡æ–°æ ‡è®°\n\n\t\t\t\t\t  STWã€‚\n\t\t\t\t\t  é‡æ–°æ ‡è®°å¹¶å‘æ ‡è®°æ—¶äº§ç”Ÿçš„æ–°å¯¹è±¡ã€‚\n\n\t\t\t\t\t- å¹¶å‘æ¸…é™¤\n\n\t\t\t\t\t  æ¸…ç†æ ‡è®°çš„å¯¹è±¡ã€‚\n\n\t\t\t\t- ç¼ºç‚¹\n\n\t\t\t\t  é»˜è®¤å¯åŠ¨åƒåœ¾å›æ”¶çº¿ç¨‹ï¼šï¼ˆCPUæ ¸æ•° +3ï¼‰/4ã€‚\n\t\t\t\t  æœ¬èº«ä¼šæ¶ˆè€—CPUèµ„æºã€‚\n\t\t\t\t  é’ˆå¯¹æµ®åŠ¨åƒåœ¾ï¼Œåˆå§‹æ ‡è®°åäº§ç”Ÿçš„åƒåœ¾æ²¡æ³•å›æ”¶ã€‚\n\t\t\t\t  CMSå›æ”¶æœŸé—´ï¼Œæ–°ç”Ÿä»£è¿›å…¥è€å¹´ä»£å¯¹è±¡å¤§äºå¯ç”¨ç©ºé—´æ—¶ï¼Œä¼šå‘ç”ŸConcurrent Mode Failure ï¼Œå¹¶è‡ªåŠ¨ä½¿ç”¨Serial Oldå›æ”¶å™¨æ›¿ä»£CMSå·¥ä½œã€‚\n\n\t\t- G1\n\n\t\t  åŸºäºå¤åˆ¶ç®—æ³•ã€‚\n\t\t  æŠŠJavaå †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„Regionã€‚\n\t\t  å¯ä»¥è®¾ç½®STWçš„æ—¶é—´ï¼Œè¿½è¸ªæ¯ä¸ªRegioné‡Œå¯å›æ”¶å¯¹è±¡çš„é¢„ä¼°æ—¶é—´ã€‚\n\t\t  G1ä¸­çš„åˆ†ä»£æ˜¯é€»è¾‘ä¸Šçš„åˆ†ä»£ï¼ŒåŒä¸€ä¸ªRegionä¼šéšç€åˆ†é…çš„å†…å­˜å¯¹è±¡ä¸åŒï¼Œè€Œå±äºä¸åŒåˆ†ä»£ã€‚\n\t\t  æ¯ä¸ªRegionçš„å¤§å°ï¼šå †å¤§å°/2048ã€‚\n\t\t  æ–°ç”Ÿä»£çš„RegionåŒæ—¶åˆ†Edenå’ŒSurvivorï¼Œå¯é€šè¿‡-XX:SurvivorRatioè°ƒæ•´å æ¯”ã€‚\n\t\t  é€‚åˆå¤§å†…å­˜çš„æœºå™¨ï¼ŒG1å¯ä»¥è®¾ç½®åœé¡¿æ—¶é—´ï¼Œæ¥ç¡®ä¿å¯¹æœåŠ¡ä¸ä¼šæœ‰è¾ƒå¤§çš„å½±å“ã€‚\n\n\t\t\t- å¤§å¯¹è±¡\n\n\t\t\t  è¶…å¤šRegionå¤§å°50%å³ä¸ºå¤§å¯¹è±¡ã€‚\n\t\t\t  å¤§å¯¹è±¡å¯èƒ½æ¨ªè·¨å¤šä¸ªRegionã€‚\n\t\t\t  ç©ºçš„Regionéƒ½å¯ä»¥å­˜æ”¾å¤§å¯¹è±¡ã€‚\n\t\t\t  æ–°è€ç”Ÿä»£GCæ—¶éƒ½ä¼šå›æ”¶å¤§å¯¹è±¡ã€‚\n\n\t\t\t- å›æ”¶è¿‡ç¨‹\n\n\t\t\t\t- åˆå§‹æ ‡è®°\n\n\t\t\t\t  STWã€‚\n\t\t\t\t  æ ‡è®°æ‰€æœ‰GC Rootsç›´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼Œè¢«ç›´æ¥å¼•ç”¨çš„å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«æ ‡è®°ã€‚\n\n\t\t\t\t- å¹¶å‘æ ‡è®°\n\n\t\t\t\t  è¿›è¡ŒGC Rootsçš„è¿½è¸ªï¼Œè¿½è¸ªæ‰€æœ‰å­˜æ´»å¯¹è±¡ã€‚\n\t\t\t\t  åŒæ—¶JVMä¼šè®°å½•è¯¥é˜¶æ®µä¸­æ–°å»ºæˆ–å¤±å»å¼•ç”¨çš„å¯¹è±¡ã€‚\n\n\t\t\t\t- æœ€ç»ˆæ ‡è®°\n\n\t\t\t\t  STWã€‚\n\t\t\t\t  é€šè¿‡å¤šå¹¶å‘æ ‡è®°ä¸­JVMå †æ–°å¢æˆ–å¤±å»å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿›è¡Œé‡æ–°æ ‡è®°ã€‚\n\n\t\t\t\t- æ··åˆå›æ”¶\n\n\t\t\t\t  åˆ†æRegionå¤§å°ï¼Œæ‰§è¡Œæ•ˆç‡ã€‚\n\t\t\t\t  STWã€‚\n\t\t\t\t  åœ¨æŒ‡å®šæ—¶é—´å†…è¿›è¡Œå›æ”¶ã€‚\n\n\t\t\t- é—®é¢˜\n\n\t\t\t  å›æ”¶ä¸­å‘ç°Regionç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå°†ä¼šSWTï¼Œå¹¶å•çº¿ç¨‹è¿›è¡Œæ ‡è®°ã€æ¸…é™¤ã€æ•´ç†ï¼Œæ•ˆç‡å¾ˆä½ã€‚\n\n\t- CGè§¦å‘æ—¶é—´\n\n\t\t- Minor GC\n\n\t\t  EdenåŒºæ»¡æ—¶é‡‡ç”¨å¤åˆ¶ç®—æ³•ã€‚\n\n\t\t- Old GC\n\n\t\t  1.è€å¹´ä»£è¿ç»­å¯ç”¨ç©ºé—´ < æ–°ç”Ÿä»£å†æ¬¡GCåå‡å…¥è€å¹´ä»£å¯¹è±¡å†…å­˜å’Œçš„å¹³å‡å¤§å°ã€‚\n\t\t  2.è€å¹´ä»£ä¸å¤Ÿå­˜æ”¾ï¼ŒMinor GCåå‡å…¥è€å¹´ä»£çš„å¯¹è±¡æ—¶ã€‚\n\t\t  3.è€å¹´ä»£å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡92%æ—¶ï¼ˆå¯è®¾ç½®ï¼‰ã€‚\n\n\t\t- æ°¸ä¹…ä»£GC\n\n\t\t  æ°¸ä¹…ä»£ä¸å¤Ÿä½¿äº§ç”ŸFull GCã€‚\n\n### æœ¬åœ°æ–¹æ³•æ ˆ\n\nå­˜æ”¾nativeæ–¹æ³•ã€‚\n\n### å †å¤–å†…å­˜ç©ºé—´\n\né€šè¿‡è°ƒç”¨æ“ä½œç³»ç»Ÿæ¥å£ï¼Œç›´æ¥åˆ†é…å¯¹å¤–å†…å­˜ç©ºé—´ã€‚\nNIO->allocateDirect(DirectByteBuffer)\n\n## å·¥å…·\n\n### jstat\n\né€šè¿‡jpsæŸ¥æ‰¾javaè¿›ç¨‹ï¼Œå†ç”¨jstat -gc PIDæŸ¥çœ‹GCçŠ¶å†µã€‚\n\n- æŒ‡æ ‡\n\n\t- S0C\n\n\t  From SurvivoråŒºå¤§å°\n\n\t- S1C\n\n\t  To SurvivoråŒºå¤§å°\n\n\t- S0U\n\n\t  From SurvivoråŒºå½“å‰ä½¿ç”¨å¤§å°\n\n\t- S1U\n\n\t  To SurvivoråŒºå½“å‰ä½¿ç”¨å¤§å°\n\n\t- EC\n\n\t  EdenåŒºå¤§å°\n\n\t- EU\n\n\t  EdenåŒºå½“å‰ä½¿ç”¨çš„å¤§å°\n\n\t- OC\n\n\t  è€å¹´ä»£çš„å¤§å°\n\n\t- OU\n\n\t  è€å¹´ä»£å½“å‰ä½¿ç”¨çš„å¤§å°\n\n\t- MC\n\n\t  æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ã€å…ƒç©ºé—´ï¼‰çš„å¤§å°\n\n\t- MU\n\n\t  æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ã€å…ƒç©ºé—´ï¼‰å½“å‰ä½¿ç”¨çš„å¤§å°\n\n\t- YGC\n\n\t  ç³»ç»Ÿè¿„ä»Šä¸ºæ­¢Young GCçš„æ¬¡æ•°\n\n\t- YGCT\n\n\t  Young GCè€—æ—¶\n\n\t- FGC\n\n\t  ç³»ç»Ÿè¿„ä»Šä¸ºæ­¢Full GCçš„æ¬¡æ•°\n\n\t- FGCT\n\n\t  Full GCçš„è€—æ—¶\n\n\t- GCT\n\n\t  æ‰€æœ‰GCçš„æ€»è€—æ—¶\n\n- å‘½ä»¤\n\n\t- jstat -gc PID\n\n\t  æŸ¥çœ‹GCçŠ¶å†µ\n\n\t- jstat -gccapacity PID\n\n\t  å †å†…å­˜åˆ†æ\n\n\t- jstat -gcnew PID\n\n\t  æ–°ç”Ÿä»£åˆ†æ\n\n\t- jstat -gcnewcapacity PID\n\n\t  å¹´è½»ä»£å†…å­˜åˆ†æ\n\n\t- jstat -gcold PID\n\n\t  è€å¹´ä»£GCåˆ†æ\n\n\t- jstat -gcoldcapacity PID\n\n\t  è€å¹´ä»£å†…å­˜åˆ†æ\n\n\t- jstat -gcmetacapacity PID\n\n\t  å…ƒæ•°æ®å†…å­˜åˆ†æ\n\n### jmap\n\näº†è§£è¿è¡Œæ—¶çš„å†…å­˜åŒºåŸŸ\n\n- å‘½ä»¤\n\n\t- jmap -heap PID\n\n\t  æ‰“å°å †å†…å­˜ç›¸å…³å‚æ•°è®¾ç½®ã€‚\n\t  å½“å‰å †å†…å„ä¸ªåŒºçš„åŸºæœ¬æƒ…å†µã€‚\n\n\t- jmap -histo PID\n\n\t  æŒ‰ç…§å¯¹è±¡åœ¨å†…å­˜ä¸­å ç”¨å¤§å°æ’åºï¼Œé™åºã€‚\n\t  å¯ä»¥äº†è§£å“ªä¸ªå¯¹è±¡åœ¨å †ä¸­å ç”¨äº†å¤§é‡çš„ç©ºé—´ã€‚\n\n\t- jmap -dump:live,format=b,file=dump.hprof PID\n\n\t  ç”Ÿæˆå†…å­˜å¿«ç…§å¹¶è¾“å‡ºåˆ°æ–‡ä»¶ã€‚\n\n### jhat\n\nåˆ†æå †å†…å­˜å¿«ç…§ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·å†…ç½®çš„æµè§ˆå™¨æŸ¥çœ‹ã€‚\n\n- å‘½ä»¤\n\n\t- jhat dump.hprof -port 7000\n\n\t  åˆ†æå¿«ç…§æ–‡ä»¶dump.hprof ï¼Œè®¿é—®ç«¯å£7000ã€‚\n\n### MAT\n\nå†…å­˜åˆ†æå·¥å…·\n\n## JVMä¼˜åŒ–æ€»ç»“\n\n### è°ƒæ•´æ–°ç”Ÿä»£çš„å¤§å°\n\nå°½é‡è®©æ¯æ¬¡Young GCåçš„å­˜æ´»å¯¹è±¡â¼©äºSurvivoråŒºåŸŸçš„50%ï¼Œéƒ½ç•™å­˜åœ¨å¹´è½»ä»£â¾¥ã€‚å°½é‡åˆ«è®©å¯¹è±¡è¿› â¼Šâ½¼å¹´ä»£ã€‚å°½é‡å‡å°‘Full GCçš„é¢‘ç‡ï¼Œé¿å…é¢‘ç¹Full GCå¯¹JVMæ€§èƒ½çš„å½±å“\n\n### è°ƒæ•´è€å¹´ä»£ç¢ç‰‡å›æ”¶çš„é¢‘ç‡\n\nCMSä¸€æ¬¡Full GCä¼šäº§ç”Ÿå†…å­˜éšä¾¿ï¼Œè°ƒæ•´ç¢ç‰‡æ•´ç†çš„è§¦å‘è½®æ•°ï¼Œå¯ä»¥æœ‰æ•ˆçš„é™ä½Full  GCäº§ç”Ÿçš„ç¢ç‰‡ä»è€Œé™ä½Full GCçš„é¢‘æ¬¡ã€‚\n\n### JVMå‚æ•°æ¨¡æ¿\n\n-Xms4096M -Xmx4096M -Xmn3072M -Xss1MÂ -XX:MetaspaceSize=256M -XX:MaxMetaspaceSize=256M -XX:+UseParNewGC - XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFaction=92 -XX:+UseCMSCompactAtFullCollection - XX:CMSFullGCsBeforeCompaction=0 -XX:+CMSParallelInitialMarkEnabled -XX:+CMSScavengeBeforeRemark - XX:+DisableExplicitGC -XX:+PrintGCDetails -Xloggc:gc.log -XX:+HeapDumpOnOutOfMemoryErrorÂ - XX:HeapDumpPath=/usr/local/app/oom\n\n### -XX:SoftRefLRUPolicyMSPerMB\n\nåœ¨æœ‰å¤§é‡åå°„çš„æƒ…å†µä¸‹å»ºè®®å¢å¤§è¯¥å€¼ï¼Œä¿è¯è½¯å¼•ç”¨ä¸ä¼šè¢«é©¬ä¸Šå›æ”¶\n\n### -XX:+DisableExplicitGC\n\nç¦æ­¢æ˜¾ç¤ºæ‰§è¡ŒGC\næ€§è´¨System.gc()\n\n### ä½¿ç”¨ç¼“å­˜æ·˜æ±°æœºåˆ¶\n\né¿å…æœ¬åœ°ç¼“å­˜æ— é™å¢å¤§ï¼Œä½¿å¾—è€å¹´ä»£å¸¸é©»å¯¹è±¡æ— æ³•å›æ”¶ï¼Œä»è€Œå¯¼è‡´çš„å†…å­˜æº¢å‡ºå’Œé¢‘ç¹çš„Full GCã€‚\n\n### é¢‘ç¹Full GCçš„å¯èƒ½åŸå› \n\n1.ç³»ç»Ÿå‹åŠ›å¤§ï¼Œé¢‘ç¹Young GCåå­˜æ´»å¯¹è±¡å¤§äºSurvivoråŒºï¼Œå¯¼è‡´ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚\n2.é¢‘ç¹äº§ç”Ÿå¤§å¯¹è±¡ã€‚\n3.å¯¹è±¡å§‹ç»ˆä¸é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚\n4.æ–¹æ³•åŒºé¢‘ç¹æœ‰ç±»åå°„åŠ è½½ã€‚\n5.é”™è¯¯ä½¿ç”¨System.gc()ã€‚\n\n*XMind: ZEN - Trial Version*","slug":"JVM-æ•´ç†","published":1,"updated":"2020-12-14T09:51:24.008Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71ht20007v252axr85fg5","content":"<html><head></head><body><h1 id=\"JVM-&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x6574;&#x7406;\"><a href=\"#JVM-&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x6574;&#x7406;\" class=\"headerlink\" title=\"JVM &#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x6574;&#x7406;\"></a>JVM &#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x6574;&#x7406;</h1><ol>\n<li>&#x5185;&#x5B58;&#x5206;&#x914D;</li>\n<li>&#x5783;&#x573E;&#x56DE;&#x6536;&#x5668;&#x7684;&#x53C2;&#x6570;&#x914D;&#x7F6E;</li>\n</ol>\n<h2 id=\"&#x7C7B;&#x7684;&#x52A0;&#x8F7D;\"><a href=\"#&#x7C7B;&#x7684;&#x52A0;&#x8F7D;\" class=\"headerlink\" title=\"&#x7C7B;&#x7684;&#x52A0;&#x8F7D;\"></a>&#x7C7B;&#x7684;&#x52A0;&#x8F7D;</h2><a id=\"more\"></a>\n<p>&#x52A0;&#x8F7D;-&gt;&#x9A8C;&#x8BC1;-&gt;&#x51C6;&#x5907;-&gt;&#x89E3;&#x6790;-&gt;&#x521D;&#x59CB;&#x5316;-&gt;&#x4F7F;&#x7528;-&gt;&#x5378;&#x8F7D;</p>\n<h3 id=\"&#x52A0;&#x8F7D;&#x6D41;&#x7A0B;\"><a href=\"#&#x52A0;&#x8F7D;&#x6D41;&#x7A0B;\" class=\"headerlink\" title=\"&#x52A0;&#x8F7D;&#x6D41;&#x7A0B;\"></a>&#x52A0;&#x8F7D;&#x6D41;&#x7A0B;</h3><ul>\n<li><p>&#x52A0;&#x8F7D;</p>\n<p>&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x5230;&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x65F6;&#x5019;&#xFF0C;.class&#x5B57;&#x8282;&#x7801;&#x6587;&#x4EF6;&#x5C31;&#x4F1A;&#x52A0;&#x8F7D;&#x8FD9;&#x4E2A;&#x7C7B;&#x5230;JVM&#x5185;&#x5B58;&#x4E2D;&#x3002;</p>\n</li>\n<li><p>&#x94FE;&#x63A5;</p>\n<ul>\n<li><p>&#x9A8C;&#x8BC1;</p>\n<p>&#x6839;&#x636E;JVM&#x89C4;&#x8303;&#xFF0C;&#x6821;&#x9A8C;.class&#x6587;&#x4EF6;&#x3002;</p>\n</li>\n<li><p>&#x51C6;&#x5907;</p>\n<p>&#x7ED9;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x540C;&#x65F6;&#x7ED9;&#x7C7B;&#x7684;static&#x53D8;&#x91CF;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#xFF0C;&#x5E76;&#x8BBE;&#x7F6E;&#x9ED8;&#x8BA4;&#x503C;0&#x3002;<br>clint()</p>\n</li>\n<li><p>&#x89E3;&#x6790;</p>\n<p>&#x628A;&#x7B26;&#x53F7;&#x5F15;&#x7528;&#x66FF;&#x6362;&#x4E3A;&#x76F4;&#x63A5;&#x5F15;&#x7528;&#x3002;</p>\n</li>\n</ul>\n</li>\n<li><p>&#x521D;&#x59CB;&#x5316;</p>\n<p>&#x4E3A;&#x7C7B;&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#xFF1A;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#xFF0C;&#x9759;&#x6001;&#x53D8;&#x91CF;&#xFF0C;&#x9759;&#x6001;&#x5757;&#x3002;<br>&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x6709;&#x7236;&#x7C7B;&#x8FD8;&#x6CA1;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4F1A;&#x5148;&#x521D;&#x59CB;&#x5316;&#x4ED6;&#x7684;&#x7236;&#x7C7B;&#x3002;</p>\n</li>\n</ul>\n<h3 id=\"&#x7C7B;&#x52A0;&#x8F7D;&#x5668;\"><a href=\"#&#x7C7B;&#x52A0;&#x8F7D;&#x5668;\" class=\"headerlink\" title=\"&#x7C7B;&#x52A0;&#x8F7D;&#x5668;\"></a>&#x7C7B;&#x52A0;&#x8F7D;&#x5668;</h3><ul>\n<li><p>&#x52A0;&#x8F7D;&#x5668;</p>\n<ul>\n<li><p>BootStrap ClassLoader</p>\n<p>&#x52A0;&#x8F7D;lib&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x7C7B;&#x5E93;</p>\n</li>\n<li><p>Extension ClassLoader</p>\n<p>&#x52A0;&#x8F7D;lib\\ext&#x76EE;&#x5F55;&#x4E0B;&#x7684;&#x7C7B;&#x5E93;</p>\n</li>\n<li><p>Application ClassLoader</p>\n<p>&#x52A0;&#x8F7D;ClassPath&#x4E0B;&#x7684;&#x7C7B;</p>\n</li>\n<li><p>&#x81EA;&#x5B9A;&#x4E49;&#x52A0;&#x8F7D;&#x5668;</p>\n</li>\n</ul>\n</li>\n<li><p>&#x53CC;&#x4EB2;&#x59D4;&#x6D3E;&#x673A;&#x5236;</p>\n<p>&#x5148;&#x627E;&#x7236;&#x4EB2;&#x52A0;&#x8F7D;&#xFF0C;&#x52A0;&#x8F7D;&#x4E0D;&#x4E86;&#x518D;&#x627E;&#x513F;&#x5B50;&#x52A0;&#x8F7D;</p>\n</li>\n</ul>\n<h2 id=\"&#x5185;&#x5B58;&#x7ED3;&#x6784;\"><a href=\"#&#x5185;&#x5B58;&#x7ED3;&#x6784;\" class=\"headerlink\" title=\"&#x5185;&#x5B58;&#x7ED3;&#x6784;\"></a>&#x5185;&#x5B58;&#x7ED3;&#x6784;</h2><h3 id=\"&#x65B9;&#x6CD5;&#x533A;&#x3001;&#x5143;&#x7A7A;&#x95F4;&#x3001;&#x6C38;&#x4E45;&#x4EE3;\"><a href=\"#&#x65B9;&#x6CD5;&#x533A;&#x3001;&#x5143;&#x7A7A;&#x95F4;&#x3001;&#x6C38;&#x4E45;&#x4EE3;\" class=\"headerlink\" title=\"&#x65B9;&#x6CD5;&#x533A;&#x3001;&#x5143;&#x7A7A;&#x95F4;&#x3001;&#x6C38;&#x4E45;&#x4EE3;\"></a>&#x65B9;&#x6CD5;&#x533A;&#x3001;&#x5143;&#x7A7A;&#x95F4;&#x3001;&#x6C38;&#x4E45;&#x4EE3;</h3><p>&#x5B58;&#x653E;&#x7C7B;&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x5E38;&#x91CF;&#x6C60;&#x7B49;&#x3002;<br>matespace&#x6EE1;&#x540E;&#x4F1A;&#x89E6;&#x53D1;Full GC&#x3002;<br>&#x65B9;&#x6CD5;&#x533A;&#x5783;&#x573E;&#x56DE;&#x6536;&#xFF1A;<br>1.&#x8BE5;&#x7C7B;&#x7684;&#x6240;&#x6709;&#x5B9E;&#x4F8B;&#x5DF2;&#x7ECF;&#x88AB;&#x56DE;&#x6536;<br>2.&#x52A0;&#x8F7D;&#x8BE5;&#x7C7B;&#x7684;ClassLoader&#x5DF2;&#x7ECF;&#x88AB;&#x56DE;&#x6536;<br>3.&#x8BE5;&#x7C7B;&#x7684;Class&#x5BF9;&#x8C61;&#x6CA1;&#x6709;&#x88AB;&#x4EFB;&#x4F55;&#x5F15;&#x7528;</p>\n<h3 id=\"&#x7A0B;&#x5E8F;&#x6280;&#x672F;&#x5668;\"><a href=\"#&#x7A0B;&#x5E8F;&#x6280;&#x672F;&#x5668;\" class=\"headerlink\" title=\"&#x7A0B;&#x5E8F;&#x6280;&#x672F;&#x5668;\"></a>&#x7A0B;&#x5E8F;&#x6280;&#x672F;&#x5668;</h3><p>&#x8BB0;&#x5F55;&#x5F53;&#x524D;&#x6267;&#x884C;&#x7684;&#x5B57;&#x8282;&#x7801;&#x6307;&#x4EE4;&#x7684;&#x4F4D;&#x7F6E;&#x3002;<br>&#x7EBF;&#x7A0B;&#x79C1;&#x6709;&#x3002;</p>\n<h3 id=\"Java&#x865A;&#x62DF;&#x673A;&#x6808;\"><a href=\"#Java&#x865A;&#x62DF;&#x673A;&#x6808;\" class=\"headerlink\" title=\"Java&#x865A;&#x62DF;&#x673A;&#x6808;\"></a>Java&#x865A;&#x62DF;&#x673A;&#x6808;</h3><p>&#x4FDD;&#x5B58;&#x65B9;&#x6CD5;&#x4FE1;&#x606F;&#x3002;<br>&#x7EBF;&#x7A0B;&#x79C1;&#x6709;&#x3002;</p>\n<ul>\n<li><p>&#x6808;&#x5E27;</p>\n<ul>\n<li>&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x8868;</li>\n<li>&#x64CD;&#x4F5C;&#x6570;&#x6808;</li>\n<li>&#x52A8;&#x6001;&#x94FE;&#x63A5;</li>\n<li>&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x5730;&#x5740;</li>\n<li>&#x5176;&#x4ED6;</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Java&#x5806;&#x5185;&#x5B58;\"><a href=\"#Java&#x5806;&#x5185;&#x5B58;\" class=\"headerlink\" title=\"Java&#x5806;&#x5185;&#x5B58;\"></a>Java&#x5806;&#x5185;&#x5B58;</h3><p>&#x5B58;&#x653E;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x3002;</p>\n<ul>\n<li><p>&#x5206;&#x4EE3;</p>\n<ul>\n<li><p>&#x5E74;&#x8F7B;&#x4EE3;</p>\n<p>&#x65B0;&#x751F;&#x4EE3;&#x8FDB;&#x5165;&#x8001;&#x5E74;&#x4EE3;&#xFF1A;&#x9ED8;&#x8BA4;15&#x6B21;</p>\n<ul>\n<li><p>Eden&#x533A;</p>\n<p>&#x9ED8;&#x8BA4;&#x65B0;&#x751F;&#x4EE3;80%&#x7A7A;&#x95F4;&#x3002;<br>&#x65B0;&#x5EFA;&#x5BF9;&#x8C61;&#x4EA7;&#x751F;&#x5728;Eden&#x533A;&#x3002;<br>Eden&#x533A;&#x6EE1;&#x540E;&#x4F1A;&#x53D1;&#x751F;Minor GC&#x3002;</p>\n</li>\n<li><p>Survivor0,1&#x533A;</p>\n<p>&#x9ED8;&#x8BA4;&#x5E74;&#x8F7B;&#x4EE3;20%&#x3002;Survivor 0:10%  Survivor 1:10%&#x3002;<br>&#x9ED8;&#x8BA4;&#x5BF9;&#x8C61;&#x5E78;&#x5B58;15&#x6B21;&#x540E;&#xFF0C;&#x4F1A;&#x8FDB;&#x5165;&#x8001;&#x5E74;&#x533A;&#x3002;</p>\n<ul>\n<li><p>&#x52A8;&#x6001;&#x5E74;&#x9F84;&#x5224;&#x65AD;</p>\n<p>&#x5F53;&#x4E00;&#x6279;&#x5BF9;&#x8C61;&#x7684;&#x5927;&#x5C0F;&#x5927;&#x4E8E;Survivor&#x533A;&#x5927;&#x5C0F;&#x7684;50%&#xFF0C;&#x8FD9;&#x6279;&#x5BF9;&#x8C61;&#x5C06;&#x4E0D;&#x8BE2;&#x95EE;&#x5E74;&#x9F84;&#xFF0C;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x8001;&#x5E74;&#x4EE3;&#x3002;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>&#x8001;&#x5E74;&#x4EE3;</p>\n<ul>\n<li><p>&#x8FDB;&#x5165;&#x8001;&#x5E74;&#x4EE3;&#x7684;&#x89C4;&#x5219;</p>\n<ul>\n<li>&#x5E74;&#x9F84;&#x8D85;&#x8FC7;MaxTenuring</li>\n<li>&#x52A8;&#x6001;&#x5E74;&#x9F84;&#x5224;&#x65AD;</li>\n<li>&#x8D85;&#x8FC7;PretenureSize&#x7684;&#x5927;&#x5BF9;&#x8C61;</li>\n<li>Eden&#x533A;&#x5E78;&#x5B58;&#x5BF9;&#x8C61;&#x8D85;&#x8FC7;Survivor&#x533A;&#x5927;&#x5C0F;</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>JVM&#x53C2;&#x6570;</p>\n<ul>\n<li><p>-Xms</p>\n<p>Java&#x5806;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>-Xmx</p>\n<p>Java&#x5806;&#x5185;&#x5B58;&#x7684;&#x6700;&#x5927;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>-Xmn</p>\n<p>Java&#x5BF9;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x65B0;&#x751F;&#x4EE3;&#x5927;&#x5C0F;&#x3002;<br>&#x8001;&#x5E74;&#x4EE3;=&#x603B;&#x5927;&#x5C0F;-&#x65B0;&#x751F;&#x4EE3;</p>\n</li>\n<li><p>-XX:PermSize</p>\n<p>&#x6C38;&#x4E45;&#x4EE3;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>-XX:MaxPermSize</p>\n<p>&#x6C38;&#x4E45;&#x4EE3;&#x6700;&#x5927;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>-XX:MetaspaceSize</p>\n<p>&#x5143;&#x7A7A;&#x95F4;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>-XX:MaxMetaspaceSize</p>\n<p>&#x5143;&#x7A7A;&#x95F4;&#x6700;&#x5927;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>-Xss</p>\n<p>Java&#x6808;&#x5185;&#x5B58;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>-XX:MaxTenuringThreshold</p>\n<p>&#x5BF9;&#x8C61;&#x5728;&#x5E74;&#x8F7B;&#x4EE3;&#x4E2D;&#x5E78;&#x5B58;&#x7684;&#x6700;&#x5927;&#x8F6E;&#x6570;&#x3002;<br>&#x9ED8;&#x8BA4;15&#xFF0C;&#x4E14;&#x4E0D;&#x80FD;&#x8D85;&#x8FC7;15.</p>\n</li>\n<li><p>-XX:PretenureSizeThreshold</p>\n<p>&#x5F53;&#x5BF9;&#x8C61;&#x5927;&#x5C0F;&#x8D85;&#x8FC7;&#x8BE5;&#x503C;&#x65F6;&#xFF0C;&#x5BF9;&#x8C61;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x8001;&#x5E74;&#x4EE3;&#xFF0C;&#x4E0D;&#x4F1A;&#x8FDB;&#x8FC7;&#x5E74;&#x8F7B;&#x4EE3;&#x3002;<br>&#x907F;&#x514D;&#x5927;&#x5BF9;&#x8C61;&#x5728;Survivor&#x4E2D;&#x591A;&#x6B21;&#x590D;&#x5236;&#xFF0C;&#x51CF;&#x5C11;&#x65E0;&#x8C13;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>\n</li>\n<li><p>-XX:-HandlePromotionFailure</p>\n<p>&#x5224;&#x65AD;&#x8001;&#x5E74;&#x4EE3;&#x5185;&#x5B58;&#x5927;&#x5C0F;&#x662F;&#x5426;&#x5927;&#x4E8E;&#x4E4B;&#x524D;&#x6BCF;&#x4E00;&#x6B21;Minor GC&#x540E;&#x8FDB;&#x5165;&#x8001;&#x5E74;&#x4EE3;&#x7684;&#x5BF9;&#x8C61;&#x7684;&#x5E73;&#x5747;&#x5927;&#x5C0F;&#x3002;<br>&#x5224;&#x65AD;&#x5931;&#x8D25;&#x8FDB;&#x884C;Full GC&#xFF0C;&#x518D;&#x6267;&#x884C;Minor GC&#x3002;</p>\n</li>\n<li><p>-XX:SurvivorRatio</p>\n<p>&#x8C03;&#x6574;Eden&#x533A;&#x548C;Survivor&#x533A;&#x5185;&#x5B58;&#x6BD4;&#x7387;</p>\n<ul>\n<li>XX:SurvivorRatio=8  &#xFF1A; Eden 80%</li>\n</ul>\n</li>\n<li><p>-XX:+PrintGCDetils</p>\n<p>&#x6253;&#x5370;&#x8BE6;&#x7EC6;&#x7684;GC&#x65E5;&#x5FD7;&#x3002;</p>\n</li>\n<li><p>-XX:+PrintGCTimeStamps</p>\n<p>&#x6253;&#x5370;GC&#x53D1;&#x751F;&#x7684;&#x65F6;&#x95F4;&#x3002;</p>\n</li>\n<li><p>-Xloggc:gc.log</p>\n<p>&#x5C06;CG&#x65E5;&#x5FD7;&#x8F93;&#x5165;&#x5230;&#x6587;&#x4EF6;&#x3002;</p>\n</li>\n<li><p>-XX:TraceClassLoading</p>\n<p>&#x8FFD;&#x8E2A;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;</p>\n</li>\n<li><p>-XX:TraceClassUnloading</p>\n<p>&#x8FFD;&#x8E2A;&#x5378;&#x8F7D;&#x7684;&#x7C7B;</p>\n</li>\n<li><p>-XX:+HeapDumpOnOutOfMemoryError  </p>\n<p>OOM&#x65F6;&#x81EA;&#x52A8;dump&#x5FEB;&#x7167;</p>\n</li>\n<li><p>-XX:HeapDumpPath=/usr/local/app/oom</p>\n<p>&#x5C06;&#x5FEB;&#x7167;&#x5B58;&#x653E;&#x81F3;&#x6307;&#x5B9A;&#x76EE;&#x5F55;</p>\n</li>\n<li><p>CMS</p>\n<ul>\n<li><p>-XX:CMSInitiatingOccupancyFaction</p>\n<p>&#x8BBE;&#x7F6E;&#x8001;&#x5E74;&#x4EE3;&#x5360;&#x7528;&#x591A;&#x5C11;&#x6BD4;&#x4F8B;&#x65F6;&#x89E6;&#x53D1;CMS</p>\n</li>\n<li><p>-XX:+UseCMSCompactAtFullCollection</p>\n<p>Full GC&#x540E;STW&#xFF0C;&#x6574;&#x7406;&#x5185;&#x5B58;&#x788E;&#x7247;&#x3002;</p>\n</li>\n<li><p>-XX:CMSFullGCsBeforeCompaction</p>\n<p>&#x9ED8;&#x8BA4;0&#xFF0C;&#x8BBE;&#x7F6E;&#x591A;&#x5C11;&#x6B21;Full GC&#x540E;&#x8FDB;&#x884C;&#x5185;&#x5B58;&#x788E;&#x7247;&#x6574;&#x7406;&#x3002;</p>\n</li>\n<li><p>-XX:+CMSParallelInitialMarkEnabled</p>\n<p>&#x521D;&#x59CB;&#x6807;&#x8BB0;&#x9636;&#x6BB5;&#x5F00;&#x542F;&#x5E76;&#x53D1;&#x6267;&#x884C;</p>\n</li>\n</ul>\n</li>\n<li><p>G1</p>\n<ul>\n<li><p>-XX:+UseG1GC</p>\n<p>&#x6307;&#x5B9A;G1&#x5783;&#x573E;&#x56DE;&#x6536;&#x5668;&#x3002;</p>\n</li>\n<li><p>-XX:G1HeapRegionSize</p>\n<p>&#x624B;&#x52A8;&#x6307;&#x5B9A;G1&#x7684;Region&#x7684;&#x5927;&#x5C0F;&#x3002;</p>\n</li>\n<li><p>-XX:G1NewSizePercent</p>\n<p>&#x8C03;&#x6574;&#x65B0;&#x751F;&#x4EE3;&#x5728;&#x5806;&#x4E2D;&#x7684;&#x5360;&#x6BD4;&#x3002;<br>&#x9ED8;&#x8BA4;5%&#x3002;</p>\n</li>\n<li><p>-XX:G1MaxNewSizePercent</p>\n<p>&#x65B0;&#x751F;&#x4EE3;&#x5360;&#x6BD4;&#x5806;&#x7A7A;&#x95F4;&#x7684;&#x6700;&#x5927;&#x5927;&#x5C0F;&#x3002;</p>\n</li>\n<li><p>-XX:MaxGCPauseMills</p>\n<p>&#x9ED8;&#x8BA4;200ms&#x3002;<br>&#x8BBE;&#x7F6E;G1&#x5783;&#x573E;&#x56DE;&#x6536;&#x5668;GC&#x65F6;&#x7684;&#x6700;&#x5927;&#x505C;&#x987F;&#x65F6;&#x95F4;&#x3002;</p>\n</li>\n<li><p>-XX:InitiatingHeapOccupancyPercent</p>\n<p>&#x9ED8;&#x8BA4;45%&#x3002;<br>&#x8001;&#x5E74;&#x4EE3;&#x5360;&#x636E;&#x7684;&#x5806;&#x5185;&#x5B58;&#x8D85;&#x591A;&#x8BE5;&#x503C;&#xFF0C;&#x5C06;&#x4F1A;&#x8FDB;&#x884C;&#x65B0;&#x8001;&#x751F;&#x4EE3;&#x7684;&#x6DF7;&#x5408;&#x56DE;&#x6536;&#x3002;</p>\n</li>\n<li><p>-XX:G1MixedGCCountTarget</p>\n<p>&#x4E00;&#x6B21;G1&#x6DF7;&#x5408;&#x56DE;&#x6536;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6700;&#x540E;&#x9636;&#x6BB5;&#x6DF7;&#x5408;&#x56DE;&#x6536;&#x9636;&#x6BB5;&#x5206;&#x51E0;&#x6B21;&#x5B8C;&#x6210;&#x3002;<br>&#x9ED8;&#x8BA4;8&#x3002;</p>\n</li>\n<li><p>-XX:G1HeapWastePercent</p>\n<p>&#x9ED8;&#x8BA4;&#x503C;5%&#x3002;<br>&#x6DF7;&#x5408;&#x56DE;&#x6536;&#x9636;&#x6BB5;&#x4E2D;&#xFF0C;&#x7A7A;&#x95F4;Region&#x5360;&#x6BD4;&#x5806;&#x7A7A;&#x95F4;&#x8D85;&#x591A;&#x8BE5;&#x503C;&#xFF0C;&#x4F1A;&#x505C;&#x6B62;&#x6DF7;&#x5408;&#x56DE;&#x6536;&#x3002;</p>\n</li>\n<li><p>-XX:G1MixedGCLiveThresholdPercent</p>\n<p>&#x9ED8;&#x8BA4;&#x503C;85%&#x3002;<br>&#x4E00;&#x4E2A;Region&#x4E2D;&#x7684;&#x5B58;&#x6D3B;&#x5BF9;&#x8C61;&#x4F4E;&#x4E8E;&#x8BE5;&#x503C;&#x65F6;&#x624D;&#x4F1A;&#x88AB;&#x56DE;&#x6536;&#x3002;</p>\n</li>\n<li><p>-XX:+CMSScavengeBeforeRemark</p>\n<p>&#x91CD;&#x65B0;&#x6807;&#x8BB0;&#x524D;&#xFF0C;&#x5C3D;&#x91CF;&#x6267;&#x884C;&#x4E00;&#x6B21;Young GC&#x3002;<br>&#x63D0;&#x524D;&#x56DE;&#x6536;&#x5E74;&#x8F7B;&#x4EE3;&#x6CA1;&#x6709;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x51CF;&#x5C11;&#x91CD;&#x65B0;&#x6807;&#x8BB0;&#x626B;&#x63CF;&#x7684;&#x5BF9;&#x8C61;&#x6570;&#xFF0C;&#x63D0;&#x9AD8;&#x6548;&#x7387;&#x3002;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>&#x5783;&#x573E;&#x56DE;&#x6536;</p>\n<ul>\n<li><p>&#x53EF;&#x8FBE;&#x6027;&#x5206;&#x6790;</p>\n<p>&#x5BF9;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5C42;&#x5C42;&#x5411;&#x4E0A;&#x5206;&#x6790;&#xFF0C;&#x5224;&#x65AD;&#x662F;&#x5426;&#x6709;&#x4E00;&#x4E2A;GC Root&#x3002;</p>\n<ul>\n<li><p>GC Root</p>\n<ul>\n<li>&#x672C;&#x5730;&#x53D8;&#x91CF;&#x8868;&#x4E2D;&#x7684;&#x5C40;&#x90E8;&#x53D8;&#x91CF;</li>\n<li>&#x65B9;&#x6CD5;&#x533A;&#x5185;&#x7684;&#x9759;&#x6001;&#x53D8;&#x91CF;</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>java &#x5F15;&#x7528;&#x7C7B;&#x578B;</p>\n<ul>\n<li><p>&#x5F3A;&#x5F15;&#x7528;</p>\n<p>GC&#x4E0D;&#x4F1A;&#x56DE;&#x6536;&#x5F3A;&#x5F15;&#x7528;</p>\n</li>\n<li><p>&#x8F6F;&#x5F15;&#x7528;</p>\n<p>&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x8DB3;&#x591F;&#x65F6;&#xFF0C;GC&#x4E0D;&#x4F1A;&#x56DE;&#x6536;&#x8F6F;&#x5F15;&#x7528;</p>\n</li>\n<li><p>&#x5F31;&#x5F15;&#x7528;</p>\n<p>GC&#x65F6;&#x5FC5;&#x5B9A;&#x56DE;&#x6536;&#x5F31;&#x5F15;&#x7528;</p>\n</li>\n<li><p>&#x865A;&#x5F15;&#x7528;</p>\n<p>&#x7EE7;&#x627F;Object&#x7684;finalize()&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x8BE5;&#x5BF9;&#x8C61;&#x88AB;&#x56DE;&#x6536;&#x7684;&#x65F6;&#x5019;&#x901A;&#x77E5;&#x81EA;&#x5DF1;&#x3002;</p>\n</li>\n</ul>\n</li>\n<li><p>&#x5783;&#x573E;&#x56DE;&#x6536;&#x7B97;&#x6CD5;</p>\n<ul>\n<li><p>&#x5E74;&#x8F7B;&#x4EE3;</p>\n<ul>\n<li><p>&#x590D;&#x5236;</p>\n<p>&#x5728;&#x65B0;&#x751F;&#x4EE3;&#x5E78;&#x5B58;&#x8005;0,1&#x533A;&#x4F7F;&#x7528;&#x3002;&#x5C06;&#x6807;&#x8BB0;&#x4E3A;&#x53EF;&#x7528;&#x7684;&#x5185;&#x5B58;&#x590D;&#x5236;&#x5230;&#x53E6;&#x5916;&#x4E00;&#x7247;&#x8FDE;&#x7EED;&#x7684;&#x5185;&#x5B58;&#x533A;&#x57DF;&#x4E2D;&#xFF0C;&#x5E76;&#x5220;&#x9664;&#x5F53;&#x524D;&#x5185;&#x5B58;&#x533A;&#x57DF;&#x4E2D;&#x7684;&#x5168;&#x90E8;&#x6570;&#x636E;&#x3002;</p>\n<ul>\n<li><p>&#x4F18;&#x70B9;</p>\n<p>&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x5185;&#x5B58;&#x788E;&#x7247;</p>\n</li>\n<li><p>&#x7F3A;&#x70B9;</p>\n<p>&#x589E;&#x52A0;&#x5185;&#x5B58;&#x7684;&#x6D88;&#x8017;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>&#x8001;&#x5E74;&#x4EE3;</p>\n<ul>\n<li><p>&#x6807;&#x8BB0;&#x6574;&#x7406;</p>\n<p>&#x6807;&#x8BB0;&#x5B58;&#x6D3B;&#x5BF9;&#x8C61;&#xFF0C;&#x5220;&#x9664;&#x6B7B;&#x4EA1;&#x5BF9;&#x8C61;&#xFF0C;&#x6574;&#x7406;&#x5185;&#x5B58;&#x788E;&#x7247;&#x3002;</p>\n<ul>\n<li><p>&#x4F18;&#x70B9;</p>\n<p>&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x5185;&#x5B58;&#x788E;&#x7247;&#x3002;&#x5185;&#x5B58;&#x5229;&#x7528;&#x7387;&#x9AD8;&#x3002;</p>\n</li>\n<li><p>&#x7F3A;&#x70B9;</p>\n<p>&#x6BD4;&#x8D77;&#x6807;&#x8BB0;&#x6E05;&#x695A;&#xFF0C;&#x6267;&#x884C;&#x6548;&#x7387;&#x6162;&#x3002;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>JVM&#x5783;&#x573E;&#x56DE;&#x6536;&#x5668;</p>\n<ul>\n<li><p>&#x5E74;&#x8F7B;&#x4EE3;</p>\n<ul>\n<li><p>ParNew</p>\n<p>&#x591A;&#x7EBF;&#x7A0B;&#xFF0C;&#x590D;&#x5236;&#x7B97;&#x6CD5;&#x3002;<br>&#x5F00;&#x542F;&#xFF1A;-XX:+UseParNewGC<br>&#x8C03;&#x6574;&#x56DE;&#x6536;&#x7EBF;&#x7A0B;&#x6570;&#xFF1A;-XX:ParallelGCThreads</p>\n</li>\n</ul>\n</li>\n<li><p>&#x8001;&#x5E74;&#x4EE3;</p>\n<ul>\n<li><p>CMS</p>\n<p>&#x6807;&#x8BB0;&#x6E05;&#x7406;&#x7B97;&#x6CD5;</p>\n<ul>\n<li><p>&#x56DE;&#x6536;&#x8FC7;&#x7A0B;</p>\n<ul>\n<li><p>&#x521D;&#x59CB;&#x6807;&#x8BB0;</p>\n<p>STW&#x3002;<br>&#x6807;&#x8BB0;&#x6240;&#x6709;GC Roots&#x76F4;&#x63A5;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x88AB;&#x76F4;&#x63A5;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x6240;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x4E0D;&#x4F1A;&#x88AB;&#x6807;&#x8BB0;&#x3002;</p>\n</li>\n<li><p>&#x5E76;&#x53D1;&#x6807;&#x8BB0;</p>\n<p>&#x5BFB;&#x627E;&#x88AB;GC Roots&#x95F4;&#x63A5;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>\n</li>\n<li><p>&#x91CD;&#x65B0;&#x6807;&#x8BB0;</p>\n<p>STW&#x3002;<br>&#x91CD;&#x65B0;&#x6807;&#x8BB0;&#x5E76;&#x53D1;&#x6807;&#x8BB0;&#x65F6;&#x4EA7;&#x751F;&#x7684;&#x65B0;&#x5BF9;&#x8C61;&#x3002;</p>\n</li>\n<li><p>&#x5E76;&#x53D1;&#x6E05;&#x9664;</p>\n<p>&#x6E05;&#x7406;&#x6807;&#x8BB0;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>\n</li>\n</ul>\n</li>\n<li><p>&#x7F3A;&#x70B9;</p>\n<p>&#x9ED8;&#x8BA4;&#x542F;&#x52A8;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7EBF;&#x7A0B;&#xFF1A;&#xFF08;CPU&#x6838;&#x6570; +3&#xFF09;/4&#x3002;<br>&#x672C;&#x8EAB;&#x4F1A;&#x6D88;&#x8017;CPU&#x8D44;&#x6E90;&#x3002;<br>&#x9488;&#x5BF9;&#x6D6E;&#x52A8;&#x5783;&#x573E;&#xFF0C;&#x521D;&#x59CB;&#x6807;&#x8BB0;&#x540E;&#x4EA7;&#x751F;&#x7684;&#x5783;&#x573E;&#x6CA1;&#x6CD5;&#x56DE;&#x6536;&#x3002;<br>CMS&#x56DE;&#x6536;&#x671F;&#x95F4;&#xFF0C;&#x65B0;&#x751F;&#x4EE3;&#x8FDB;&#x5165;&#x8001;&#x5E74;&#x4EE3;&#x5BF9;&#x8C61;&#x5927;&#x4E8E;&#x53EF;&#x7528;&#x7A7A;&#x95F4;&#x65F6;&#xFF0C;&#x4F1A;&#x53D1;&#x751F;Concurrent Mode Failure &#xFF0C;&#x5E76;&#x81EA;&#x52A8;&#x4F7F;&#x7528;Serial Old&#x56DE;&#x6536;&#x5668;&#x66FF;&#x4EE3;CMS&#x5DE5;&#x4F5C;&#x3002;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>G1</p>\n<p>&#x57FA;&#x4E8E;&#x590D;&#x5236;&#x7B97;&#x6CD5;&#x3002;<br>&#x628A;Java&#x5806;&#x5185;&#x5B58;&#x5212;&#x5206;&#x4E3A;&#x591A;&#x4E2A;&#x5927;&#x5C0F;&#x76F8;&#x7B49;&#x7684;Region&#x3002;<br>&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;STW&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x8FFD;&#x8E2A;&#x6BCF;&#x4E2A;Region&#x91CC;&#x53EF;&#x56DE;&#x6536;&#x5BF9;&#x8C61;&#x7684;&#x9884;&#x4F30;&#x65F6;&#x95F4;&#x3002;<br>G1&#x4E2D;&#x7684;&#x5206;&#x4EE3;&#x662F;&#x903B;&#x8F91;&#x4E0A;&#x7684;&#x5206;&#x4EE3;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;Region&#x4F1A;&#x968F;&#x7740;&#x5206;&#x914D;&#x7684;&#x5185;&#x5B58;&#x5BF9;&#x8C61;&#x4E0D;&#x540C;&#xFF0C;&#x800C;&#x5C5E;&#x4E8E;&#x4E0D;&#x540C;&#x5206;&#x4EE3;&#x3002;<br>&#x6BCF;&#x4E2A;Region&#x7684;&#x5927;&#x5C0F;&#xFF1A;&#x5806;&#x5927;&#x5C0F;/2048&#x3002;<br>&#x65B0;&#x751F;&#x4EE3;&#x7684;Region&#x540C;&#x65F6;&#x5206;Eden&#x548C;Survivor&#xFF0C;&#x53EF;&#x901A;&#x8FC7;-XX:SurvivorRatio&#x8C03;&#x6574;&#x5360;&#x6BD4;&#x3002;<br>&#x9002;&#x5408;&#x5927;&#x5185;&#x5B58;&#x7684;&#x673A;&#x5668;&#xFF0C;G1&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x505C;&#x987F;&#x65F6;&#x95F4;&#xFF0C;&#x6765;&#x786E;&#x4FDD;&#x5BF9;&#x670D;&#x52A1;&#x4E0D;&#x4F1A;&#x6709;&#x8F83;&#x5927;&#x7684;&#x5F71;&#x54CD;&#x3002;</p>\n<ul>\n<li><p>&#x5927;&#x5BF9;&#x8C61;</p>\n<p>&#x8D85;&#x591A;Region&#x5927;&#x5C0F;50%&#x5373;&#x4E3A;&#x5927;&#x5BF9;&#x8C61;&#x3002;<br>&#x5927;&#x5BF9;&#x8C61;&#x53EF;&#x80FD;&#x6A2A;&#x8DE8;&#x591A;&#x4E2A;Region&#x3002;<br>&#x7A7A;&#x7684;Region&#x90FD;&#x53EF;&#x4EE5;&#x5B58;&#x653E;&#x5927;&#x5BF9;&#x8C61;&#x3002;<br>&#x65B0;&#x8001;&#x751F;&#x4EE3;GC&#x65F6;&#x90FD;&#x4F1A;&#x56DE;&#x6536;&#x5927;&#x5BF9;&#x8C61;&#x3002;</p>\n</li>\n<li><p>&#x56DE;&#x6536;&#x8FC7;&#x7A0B;</p>\n<ul>\n<li><p>&#x521D;&#x59CB;&#x6807;&#x8BB0;</p>\n<p>STW&#x3002;<br>&#x6807;&#x8BB0;&#x6240;&#x6709;GC Roots&#x76F4;&#x63A5;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x88AB;&#x76F4;&#x63A5;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x6240;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x4E0D;&#x4F1A;&#x88AB;&#x6807;&#x8BB0;&#x3002;</p>\n</li>\n<li><p>&#x5E76;&#x53D1;&#x6807;&#x8BB0;</p>\n<p>&#x8FDB;&#x884C;GC Roots&#x7684;&#x8FFD;&#x8E2A;&#xFF0C;&#x8FFD;&#x8E2A;&#x6240;&#x6709;&#x5B58;&#x6D3B;&#x5BF9;&#x8C61;&#x3002;<br>&#x540C;&#x65F6;JVM&#x4F1A;&#x8BB0;&#x5F55;&#x8BE5;&#x9636;&#x6BB5;&#x4E2D;&#x65B0;&#x5EFA;&#x6216;&#x5931;&#x53BB;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>\n</li>\n<li><p>&#x6700;&#x7EC8;&#x6807;&#x8BB0;</p>\n<p>STW&#x3002;<br>&#x901A;&#x8FC7;&#x591A;&#x5E76;&#x53D1;&#x6807;&#x8BB0;&#x4E2D;JVM&#x5806;&#x65B0;&#x589E;&#x6216;&#x5931;&#x53BB;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x8FDB;&#x884C;&#x91CD;&#x65B0;&#x6807;&#x8BB0;&#x3002;</p>\n</li>\n<li><p>&#x6DF7;&#x5408;&#x56DE;&#x6536;</p>\n<p>&#x5206;&#x6790;Region&#x5927;&#x5C0F;&#xFF0C;&#x6267;&#x884C;&#x6548;&#x7387;&#x3002;<br>STW&#x3002;<br>&#x5728;&#x6307;&#x5B9A;&#x65F6;&#x95F4;&#x5185;&#x8FDB;&#x884C;&#x56DE;&#x6536;&#x3002;</p>\n</li>\n</ul>\n</li>\n<li><p>&#x95EE;&#x9898;</p>\n<p>&#x56DE;&#x6536;&#x4E2D;&#x53D1;&#x73B0;Region&#x7A7A;&#x95F4;&#x4E0D;&#x591F;&#x65F6;&#xFF0C;&#x5C06;&#x4F1A;SWT&#xFF0C;&#x5E76;&#x5355;&#x7EBF;&#x7A0B;&#x8FDB;&#x884C;&#x6807;&#x8BB0;&#x3001;&#x6E05;&#x9664;&#x3001;&#x6574;&#x7406;&#xFF0C;&#x6548;&#x7387;&#x5F88;&#x4F4E;&#x3002;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>CG&#x89E6;&#x53D1;&#x65F6;&#x95F4;</p>\n<ul>\n<li><p>Minor GC</p>\n<p>Eden&#x533A;&#x6EE1;&#x65F6;&#x91C7;&#x7528;&#x590D;&#x5236;&#x7B97;&#x6CD5;&#x3002;</p>\n</li>\n<li><p>Old GC</p>\n<p>1.&#x8001;&#x5E74;&#x4EE3;&#x8FDE;&#x7EED;&#x53EF;&#x7528;&#x7A7A;&#x95F4; &lt; &#x65B0;&#x751F;&#x4EE3;&#x5386;&#x6B21;GC&#x540E;&#x5347;&#x5165;&#x8001;&#x5E74;&#x4EE3;&#x5BF9;&#x8C61;&#x5185;&#x5B58;&#x548C;&#x7684;&#x5E73;&#x5747;&#x5927;&#x5C0F;&#x3002;<br>2.&#x8001;&#x5E74;&#x4EE3;&#x4E0D;&#x591F;&#x5B58;&#x653E;&#xFF0C;Minor GC&#x540E;&#x5347;&#x5165;&#x8001;&#x5E74;&#x4EE3;&#x7684;&#x5BF9;&#x8C61;&#x65F6;&#x3002;<br>3.&#x8001;&#x5E74;&#x4EE3;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x7387;&#x8D85;&#x8FC7;92%&#x65F6;&#xFF08;&#x53EF;&#x8BBE;&#x7F6E;&#xFF09;&#x3002;</p>\n</li>\n<li><p>&#x6C38;&#x4E45;&#x4EE3;GC</p>\n<p>&#x6C38;&#x4E45;&#x4EE3;&#x4E0D;&#x591F;&#x4F7F;&#x4EA7;&#x751F;Full GC&#x3002;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x6808;\"><a href=\"#&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x6808;\" class=\"headerlink\" title=\"&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x6808;\"></a>&#x672C;&#x5730;&#x65B9;&#x6CD5;&#x6808;</h3><p>&#x5B58;&#x653E;native&#x65B9;&#x6CD5;&#x3002;</p>\n<h3 id=\"&#x5806;&#x5916;&#x5185;&#x5B58;&#x7A7A;&#x95F4;\"><a href=\"#&#x5806;&#x5916;&#x5185;&#x5B58;&#x7A7A;&#x95F4;\" class=\"headerlink\" title=\"&#x5806;&#x5916;&#x5185;&#x5B58;&#x7A7A;&#x95F4;\"></a>&#x5806;&#x5916;&#x5185;&#x5B58;&#x7A7A;&#x95F4;</h3><p>&#x901A;&#x8FC7;&#x8C03;&#x7528;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x63A5;&#x53E3;&#xFF0C;&#x76F4;&#x63A5;&#x5206;&#x914D;&#x5BF9;&#x5916;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x3002;<br>NIO-&gt;allocateDirect(DirectByteBuffer)</p>\n<h2 id=\"&#x5DE5;&#x5177;\"><a href=\"#&#x5DE5;&#x5177;\" class=\"headerlink\" title=\"&#x5DE5;&#x5177;\"></a>&#x5DE5;&#x5177;</h2><h3 id=\"jstat\"><a href=\"#jstat\" class=\"headerlink\" title=\"jstat\"></a>jstat</h3><p>&#x901A;&#x8FC7;jps&#x67E5;&#x627E;java&#x8FDB;&#x7A0B;&#xFF0C;&#x518D;&#x7528;jstat -gc PID&#x67E5;&#x770B;GC&#x72B6;&#x51B5;&#x3002;</p>\n<ul>\n<li><p>&#x6307;&#x6807;</p>\n<ul>\n<li><p>S0C</p>\n<p>From Survivor&#x533A;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>S1C</p>\n<p>To Survivor&#x533A;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>S0U</p>\n<p>From Survivor&#x533A;&#x5F53;&#x524D;&#x4F7F;&#x7528;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>S1U</p>\n<p>To Survivor&#x533A;&#x5F53;&#x524D;&#x4F7F;&#x7528;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>EC</p>\n<p>Eden&#x533A;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>EU</p>\n<p>Eden&#x533A;&#x5F53;&#x524D;&#x4F7F;&#x7528;&#x7684;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>OC</p>\n<p>&#x8001;&#x5E74;&#x4EE3;&#x7684;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>OU</p>\n<p>&#x8001;&#x5E74;&#x4EE3;&#x5F53;&#x524D;&#x4F7F;&#x7528;&#x7684;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>MC</p>\n<p>&#x65B9;&#x6CD5;&#x533A;&#xFF08;&#x6C38;&#x4E45;&#x4EE3;&#x3001;&#x5143;&#x7A7A;&#x95F4;&#xFF09;&#x7684;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>MU</p>\n<p>&#x65B9;&#x6CD5;&#x533A;&#xFF08;&#x6C38;&#x4E45;&#x4EE3;&#x3001;&#x5143;&#x7A7A;&#x95F4;&#xFF09;&#x5F53;&#x524D;&#x4F7F;&#x7528;&#x7684;&#x5927;&#x5C0F;</p>\n</li>\n<li><p>YGC</p>\n<p>&#x7CFB;&#x7EDF;&#x8FC4;&#x4ECA;&#x4E3A;&#x6B62;Young GC&#x7684;&#x6B21;&#x6570;</p>\n</li>\n<li><p>YGCT</p>\n<p>Young GC&#x8017;&#x65F6;</p>\n</li>\n<li><p>FGC</p>\n<p>&#x7CFB;&#x7EDF;&#x8FC4;&#x4ECA;&#x4E3A;&#x6B62;Full GC&#x7684;&#x6B21;&#x6570;</p>\n</li>\n<li><p>FGCT</p>\n<p>Full GC&#x7684;&#x8017;&#x65F6;</p>\n</li>\n<li><p>GCT</p>\n<p>&#x6240;&#x6709;GC&#x7684;&#x603B;&#x8017;&#x65F6;</p>\n</li>\n</ul>\n</li>\n<li><p>&#x547D;&#x4EE4;</p>\n<ul>\n<li><p>jstat -gc PID</p>\n<p>&#x67E5;&#x770B;GC&#x72B6;&#x51B5;</p>\n</li>\n<li><p>jstat -gccapacity PID</p>\n<p>&#x5806;&#x5185;&#x5B58;&#x5206;&#x6790;</p>\n</li>\n<li><p>jstat -gcnew PID</p>\n<p>&#x65B0;&#x751F;&#x4EE3;&#x5206;&#x6790;</p>\n</li>\n<li><p>jstat -gcnewcapacity PID</p>\n<p>&#x5E74;&#x8F7B;&#x4EE3;&#x5185;&#x5B58;&#x5206;&#x6790;</p>\n</li>\n<li><p>jstat -gcold PID</p>\n<p>&#x8001;&#x5E74;&#x4EE3;GC&#x5206;&#x6790;</p>\n</li>\n<li><p>jstat -gcoldcapacity PID</p>\n<p>&#x8001;&#x5E74;&#x4EE3;&#x5185;&#x5B58;&#x5206;&#x6790;</p>\n</li>\n<li><p>jstat -gcmetacapacity PID</p>\n<p>&#x5143;&#x6570;&#x636E;&#x5185;&#x5B58;&#x5206;&#x6790;</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"jmap\"><a href=\"#jmap\" class=\"headerlink\" title=\"jmap\"></a>jmap</h3><p>&#x4E86;&#x89E3;&#x8FD0;&#x884C;&#x65F6;&#x7684;&#x5185;&#x5B58;&#x533A;&#x57DF;</p>\n<ul>\n<li><p>&#x547D;&#x4EE4;</p>\n<ul>\n<li><p>jmap -heap PID</p>\n<p>&#x6253;&#x5370;&#x5806;&#x5185;&#x5B58;&#x76F8;&#x5173;&#x53C2;&#x6570;&#x8BBE;&#x7F6E;&#x3002;<br>&#x5F53;&#x524D;&#x5806;&#x5185;&#x5404;&#x4E2A;&#x533A;&#x7684;&#x57FA;&#x672C;&#x60C5;&#x51B5;&#x3002;</p>\n</li>\n<li><p>jmap -histo PID</p>\n<p>&#x6309;&#x7167;&#x5BF9;&#x8C61;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x5360;&#x7528;&#x5927;&#x5C0F;&#x6392;&#x5E8F;&#xFF0C;&#x964D;&#x5E8F;&#x3002;<br>&#x53EF;&#x4EE5;&#x4E86;&#x89E3;&#x54EA;&#x4E2A;&#x5BF9;&#x8C61;&#x5728;&#x5806;&#x4E2D;&#x5360;&#x7528;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x7A7A;&#x95F4;&#x3002;</p>\n</li>\n<li><p>jmap -dump:live,format=b,file=dump.hprof PID</p>\n<p>&#x751F;&#x6210;&#x5185;&#x5B58;&#x5FEB;&#x7167;&#x5E76;&#x8F93;&#x51FA;&#x5230;&#x6587;&#x4EF6;&#x3002;</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"jhat\"><a href=\"#jhat\" class=\"headerlink\" title=\"jhat\"></a>jhat</h3><p>&#x5206;&#x6790;&#x5806;&#x5185;&#x5B58;&#x5FEB;&#x7167;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5DE5;&#x5177;&#x5185;&#x7F6E;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x67E5;&#x770B;&#x3002;</p>\n<ul>\n<li><p>&#x547D;&#x4EE4;</p>\n<ul>\n<li><p>jhat dump.hprof -port 7000</p>\n<p>&#x5206;&#x6790;&#x5FEB;&#x7167;&#x6587;&#x4EF6;dump.hprof &#xFF0C;&#x8BBF;&#x95EE;&#x7AEF;&#x53E3;7000&#x3002;</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"MAT\"><a href=\"#MAT\" class=\"headerlink\" title=\"MAT\"></a>MAT</h3><p>&#x5185;&#x5B58;&#x5206;&#x6790;&#x5DE5;&#x5177;</p>\n<h2 id=\"JVM&#x4F18;&#x5316;&#x603B;&#x7ED3;\"><a href=\"#JVM&#x4F18;&#x5316;&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"JVM&#x4F18;&#x5316;&#x603B;&#x7ED3;\"></a>JVM&#x4F18;&#x5316;&#x603B;&#x7ED3;</h2><h3 id=\"&#x8C03;&#x6574;&#x65B0;&#x751F;&#x4EE3;&#x7684;&#x5927;&#x5C0F;\"><a href=\"#&#x8C03;&#x6574;&#x65B0;&#x751F;&#x4EE3;&#x7684;&#x5927;&#x5C0F;\" class=\"headerlink\" title=\"&#x8C03;&#x6574;&#x65B0;&#x751F;&#x4EE3;&#x7684;&#x5927;&#x5C0F;\"></a>&#x8C03;&#x6574;&#x65B0;&#x751F;&#x4EE3;&#x7684;&#x5927;&#x5C0F;</h3><p>&#x5C3D;&#x91CF;&#x8BA9;&#x6BCF;&#x6B21;Young GC&#x540E;&#x7684;&#x5B58;&#x6D3B;&#x5BF9;&#x8C61;&#x2F29;&#x4E8E;Survivor&#x533A;&#x57DF;&#x7684;50%&#xFF0C;&#x90FD;&#x7559;&#x5B58;&#x5728;&#x5E74;&#x8F7B;&#x4EE3;&#x2FA5;&#x3002;&#x5C3D;&#x91CF;&#x522B;&#x8BA9;&#x5BF9;&#x8C61;&#x8FDB; &#x2F0A;&#x2F7C;&#x5E74;&#x4EE3;&#x3002;&#x5C3D;&#x91CF;&#x51CF;&#x5C11;Full GC&#x7684;&#x9891;&#x7387;&#xFF0C;&#x907F;&#x514D;&#x9891;&#x7E41;Full GC&#x5BF9;JVM&#x6027;&#x80FD;&#x7684;&#x5F71;&#x54CD;</p>\n<h3 id=\"&#x8C03;&#x6574;&#x8001;&#x5E74;&#x4EE3;&#x788E;&#x7247;&#x56DE;&#x6536;&#x7684;&#x9891;&#x7387;\"><a href=\"#&#x8C03;&#x6574;&#x8001;&#x5E74;&#x4EE3;&#x788E;&#x7247;&#x56DE;&#x6536;&#x7684;&#x9891;&#x7387;\" class=\"headerlink\" title=\"&#x8C03;&#x6574;&#x8001;&#x5E74;&#x4EE3;&#x788E;&#x7247;&#x56DE;&#x6536;&#x7684;&#x9891;&#x7387;\"></a>&#x8C03;&#x6574;&#x8001;&#x5E74;&#x4EE3;&#x788E;&#x7247;&#x56DE;&#x6536;&#x7684;&#x9891;&#x7387;</h3><p>CMS&#x4E00;&#x6B21;Full GC&#x4F1A;&#x4EA7;&#x751F;&#x5185;&#x5B58;&#x968F;&#x4FBF;&#xFF0C;&#x8C03;&#x6574;&#x788E;&#x7247;&#x6574;&#x7406;&#x7684;&#x89E6;&#x53D1;&#x8F6E;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x7684;&#x964D;&#x4F4E;Full  GC&#x4EA7;&#x751F;&#x7684;&#x788E;&#x7247;&#x4ECE;&#x800C;&#x964D;&#x4F4E;Full GC&#x7684;&#x9891;&#x6B21;&#x3002;</p>\n<h3 id=\"JVM&#x53C2;&#x6570;&#x6A21;&#x677F;\"><a href=\"#JVM&#x53C2;&#x6570;&#x6A21;&#x677F;\" class=\"headerlink\" title=\"JVM&#x53C2;&#x6570;&#x6A21;&#x677F;\"></a>JVM&#x53C2;&#x6570;&#x6A21;&#x677F;</h3><p>-Xms4096M -Xmx4096M -Xmn3072M -Xss1M&#xA0;-XX:MetaspaceSize=256M -XX:MaxMetaspaceSize=256M -XX:+UseParNewGC - XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFaction=92 -XX:+UseCMSCompactAtFullCollection - XX:CMSFullGCsBeforeCompaction=0 -XX:+CMSParallelInitialMarkEnabled -XX:+CMSScavengeBeforeRemark - XX:+DisableExplicitGC -XX:+PrintGCDetails -Xloggc:gc.log -XX:+HeapDumpOnOutOfMemoryError&#xA0;- XX:HeapDumpPath=/usr/local/app/oom</p>\n<h3 id=\"XX-SoftRefLRUPolicyMSPerMB\"><a href=\"#XX-SoftRefLRUPolicyMSPerMB\" class=\"headerlink\" title=\"-XX:SoftRefLRUPolicyMSPerMB\"></a>-XX:SoftRefLRUPolicyMSPerMB</h3><p>&#x5728;&#x6709;&#x5927;&#x91CF;&#x53CD;&#x5C04;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5EFA;&#x8BAE;&#x589E;&#x5927;&#x8BE5;&#x503C;&#xFF0C;&#x4FDD;&#x8BC1;&#x8F6F;&#x5F15;&#x7528;&#x4E0D;&#x4F1A;&#x88AB;&#x9A6C;&#x4E0A;&#x56DE;&#x6536;</p>\n<h3 id=\"XX-DisableExplicitGC\"><a href=\"#XX-DisableExplicitGC\" class=\"headerlink\" title=\"-XX:+DisableExplicitGC\"></a>-XX:+DisableExplicitGC</h3><p>&#x7981;&#x6B62;&#x663E;&#x793A;&#x6267;&#x884C;GC<br>&#x6027;&#x8D28;System.gc()</p>\n<h3 id=\"&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x6DD8;&#x6C70;&#x673A;&#x5236;\"><a href=\"#&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x6DD8;&#x6C70;&#x673A;&#x5236;\" class=\"headerlink\" title=\"&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x6DD8;&#x6C70;&#x673A;&#x5236;\"></a>&#x4F7F;&#x7528;&#x7F13;&#x5B58;&#x6DD8;&#x6C70;&#x673A;&#x5236;</h3><p>&#x907F;&#x514D;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x65E0;&#x9650;&#x589E;&#x5927;&#xFF0C;&#x4F7F;&#x5F97;&#x8001;&#x5E74;&#x4EE3;&#x5E38;&#x9A7B;&#x5BF9;&#x8C61;&#x65E0;&#x6CD5;&#x56DE;&#x6536;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x7684;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#x548C;&#x9891;&#x7E41;&#x7684;Full GC&#x3002;</p>\n<h3 id=\"&#x9891;&#x7E41;Full-GC&#x7684;&#x53EF;&#x80FD;&#x539F;&#x56E0;\"><a href=\"#&#x9891;&#x7E41;Full-GC&#x7684;&#x53EF;&#x80FD;&#x539F;&#x56E0;\" class=\"headerlink\" title=\"&#x9891;&#x7E41;Full GC&#x7684;&#x53EF;&#x80FD;&#x539F;&#x56E0;\"></a>&#x9891;&#x7E41;Full GC&#x7684;&#x53EF;&#x80FD;&#x539F;&#x56E0;</h3><p>1.&#x7CFB;&#x7EDF;&#x538B;&#x529B;&#x5927;&#xFF0C;&#x9891;&#x7E41;Young GC&#x540E;&#x5B58;&#x6D3B;&#x5BF9;&#x8C61;&#x5927;&#x4E8E;Survivor&#x533A;&#xFF0C;&#x5BFC;&#x81F4;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x8001;&#x5E74;&#x4EE3;&#x3002;<br>2.&#x9891;&#x7E41;&#x4EA7;&#x751F;&#x5927;&#x5BF9;&#x8C61;&#x3002;<br>3.&#x5BF9;&#x8C61;&#x59CB;&#x7EC8;&#x4E0D;&#x91CA;&#x653E;&#xFF0C;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x3002;<br>4.&#x65B9;&#x6CD5;&#x533A;&#x9891;&#x7E41;&#x6709;&#x7C7B;&#x53CD;&#x5C04;&#x52A0;&#x8F7D;&#x3002;<br>5.&#x9519;&#x8BEF;&#x4F7F;&#x7528;System.gc()&#x3002;</p>\n<p><em>XMind: ZEN - Trial Version</em></p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"JVM","path":"tags/JVM/"},{"name":"Java","path":"tags/Java/"}],"excerpt":"<html><head></head><body><h1 id=\"JVM-&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x6574;&#x7406;\"><a href=\"#JVM-&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x6574;&#x7406;\" class=\"headerlink\" title=\"JVM &#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x6574;&#x7406;\"></a>JVM &#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x6574;&#x7406;</h1><ol>\n<li>&#x5185;&#x5B58;&#x5206;&#x914D;</li>\n<li>&#x5783;&#x573E;&#x56DE;&#x6536;&#x5668;&#x7684;&#x53C2;&#x6570;&#x914D;&#x7F6E;</li>\n</ol>\n<h2 id=\"&#x7C7B;&#x7684;&#x52A0;&#x8F7D;\"><a href=\"#&#x7C7B;&#x7684;&#x52A0;&#x8F7D;\" class=\"headerlink\" title=\"&#x7C7B;&#x7684;&#x52A0;&#x8F7D;\"></a>&#x7C7B;&#x7684;&#x52A0;&#x8F7D;</h2></body></html>","more":"<p>åŠ è½½-&gt;éªŒè¯-&gt;å‡†å¤‡-&gt;è§£æ-&gt;åˆå§‹åŒ–-&gt;ä½¿ç”¨-&gt;å¸è½½</p>\n<h3 id=\"åŠ è½½æµç¨‹\"><a href=\"#åŠ è½½æµç¨‹\" class=\"headerlink\" title=\"åŠ è½½æµç¨‹\"></a>åŠ è½½æµç¨‹</h3><ul>\n<li><p>åŠ è½½</p>\n<p>ä»£ç ä¸­ä½¿ç”¨åˆ°è¿™ä¸ªç±»çš„æ—¶å€™ï¼Œ.classå­—èŠ‚ç æ–‡ä»¶å°±ä¼šåŠ è½½è¿™ä¸ªç±»åˆ°JVMå†…å­˜ä¸­ã€‚</p>\n</li>\n<li><p>é“¾æ¥</p>\n<ul>\n<li><p>éªŒè¯</p>\n<p>æ ¹æ®JVMè§„èŒƒï¼Œæ ¡éªŒ.classæ–‡ä»¶ã€‚</p>\n</li>\n<li><p>å‡†å¤‡</p>\n<p>ç»™åŠ è½½çš„ç±»åˆ†é…å†…å­˜ç©ºé—´ï¼ŒåŒæ—¶ç»™ç±»çš„staticå˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå¹¶è®¾ç½®é»˜è®¤å€¼0ã€‚<br>clint()</p>\n</li>\n<li><p>è§£æ</p>\n<p>æŠŠç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚</p>\n</li>\n</ul>\n</li>\n<li><p>åˆå§‹åŒ–</p>\n<p>ä¸ºç±»å˜é‡èµ‹å€¼ï¼šé™æ€æ–¹æ³•ï¼Œé™æ€å˜é‡ï¼Œé™æ€å—ã€‚<br>åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æœ‰çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå…ˆåˆå§‹åŒ–ä»–çš„çˆ¶ç±»ã€‚</p>\n</li>\n</ul>\n<h3 id=\"ç±»åŠ è½½å™¨\"><a href=\"#ç±»åŠ è½½å™¨\" class=\"headerlink\" title=\"ç±»åŠ è½½å™¨\"></a>ç±»åŠ è½½å™¨</h3><ul>\n<li><p>åŠ è½½å™¨</p>\n<ul>\n<li><p>BootStrap ClassLoader</p>\n<p>åŠ è½½libç›®å½•ä¸‹çš„ç±»åº“</p>\n</li>\n<li><p>Extension ClassLoader</p>\n<p>åŠ è½½lib\\extç›®å½•ä¸‹çš„ç±»åº“</p>\n</li>\n<li><p>Application ClassLoader</p>\n<p>åŠ è½½ClassPathä¸‹çš„ç±»</p>\n</li>\n<li><p>è‡ªå®šä¹‰åŠ è½½å™¨</p>\n</li>\n</ul>\n</li>\n<li><p>åŒäº²å§”æ´¾æœºåˆ¶</p>\n<p>å…ˆæ‰¾çˆ¶äº²åŠ è½½ï¼ŒåŠ è½½ä¸äº†å†æ‰¾å„¿å­åŠ è½½</p>\n</li>\n</ul>\n<h2 id=\"å†…å­˜ç»“æ„\"><a href=\"#å†…å­˜ç»“æ„\" class=\"headerlink\" title=\"å†…å­˜ç»“æ„\"></a>å†…å­˜ç»“æ„</h2><h3 id=\"æ–¹æ³•åŒºã€å…ƒç©ºé—´ã€æ°¸ä¹…ä»£\"><a href=\"#æ–¹æ³•åŒºã€å…ƒç©ºé—´ã€æ°¸ä¹…ä»£\" class=\"headerlink\" title=\"æ–¹æ³•åŒºã€å…ƒç©ºé—´ã€æ°¸ä¹…ä»£\"></a>æ–¹æ³•åŒºã€å…ƒç©ºé—´ã€æ°¸ä¹…ä»£</h3><p>å­˜æ”¾ç±»çš„å®šä¹‰ï¼Œå¸¸é‡æ± ç­‰ã€‚<br>matespaceæ»¡åä¼šè§¦å‘Full GCã€‚<br>æ–¹æ³•åŒºåƒåœ¾å›æ”¶ï¼š<br>1.è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹å·²ç»è¢«å›æ”¶<br>2.åŠ è½½è¯¥ç±»çš„ClassLoaderå·²ç»è¢«å›æ”¶<br>3.è¯¥ç±»çš„Classå¯¹è±¡æ²¡æœ‰è¢«ä»»ä½•å¼•ç”¨</p>\n<h3 id=\"ç¨‹åºæŠ€æœ¯å™¨\"><a href=\"#ç¨‹åºæŠ€æœ¯å™¨\" class=\"headerlink\" title=\"ç¨‹åºæŠ€æœ¯å™¨\"></a>ç¨‹åºæŠ€æœ¯å™¨</h3><p>è®°å½•å½“å‰æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ä½ç½®ã€‚<br>çº¿ç¨‹ç§æœ‰ã€‚</p>\n<h3 id=\"Javaè™šæ‹Ÿæœºæ ˆ\"><a href=\"#Javaè™šæ‹Ÿæœºæ ˆ\" class=\"headerlink\" title=\"Javaè™šæ‹Ÿæœºæ ˆ\"></a>Javaè™šæ‹Ÿæœºæ ˆ</h3><p>ä¿å­˜æ–¹æ³•ä¿¡æ¯ã€‚<br>çº¿ç¨‹ç§æœ‰ã€‚</p>\n<ul>\n<li><p>æ ˆå¸§</p>\n<ul>\n<li>å±€éƒ¨å˜é‡è¡¨</li>\n<li>æ“ä½œæ•°æ ˆ</li>\n<li>åŠ¨æ€é“¾æ¥</li>\n<li>æ–¹æ³•è¿”å›åœ°å€</li>\n<li>å…¶ä»–</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Javaå †å†…å­˜\"><a href=\"#Javaå †å†…å­˜\" class=\"headerlink\" title=\"Javaå †å†…å­˜\"></a>Javaå †å†…å­˜</h3><p>å­˜æ”¾ç±»çš„å®ä¾‹å¯¹è±¡ã€‚</p>\n<ul>\n<li><p>åˆ†ä»£</p>\n<ul>\n<li><p>å¹´è½»ä»£</p>\n<p>æ–°ç”Ÿä»£è¿›å…¥è€å¹´ä»£ï¼šé»˜è®¤15æ¬¡</p>\n<ul>\n<li><p>EdenåŒº</p>\n<p>é»˜è®¤æ–°ç”Ÿä»£80%ç©ºé—´ã€‚<br>æ–°å»ºå¯¹è±¡äº§ç”Ÿåœ¨EdenåŒºã€‚<br>EdenåŒºæ»¡åä¼šå‘ç”ŸMinor GCã€‚</p>\n</li>\n<li><p>Survivor0,1åŒº</p>\n<p>é»˜è®¤å¹´è½»ä»£20%ã€‚Survivor 0:10%  Survivor 1:10%ã€‚<br>é»˜è®¤å¯¹è±¡å¹¸å­˜15æ¬¡åï¼Œä¼šè¿›å…¥è€å¹´åŒºã€‚</p>\n<ul>\n<li><p>åŠ¨æ€å¹´é¾„åˆ¤æ–­</p>\n<p>å½“ä¸€æ‰¹å¯¹è±¡çš„å¤§å°å¤§äºSurvivoråŒºå¤§å°çš„50%ï¼Œè¿™æ‰¹å¯¹è±¡å°†ä¸è¯¢é—®å¹´é¾„ï¼Œç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>è€å¹´ä»£</p>\n<ul>\n<li><p>è¿›å…¥è€å¹´ä»£çš„è§„åˆ™</p>\n<ul>\n<li>å¹´é¾„è¶…è¿‡MaxTenuring</li>\n<li>åŠ¨æ€å¹´é¾„åˆ¤æ–­</li>\n<li>è¶…è¿‡PretenureSizeçš„å¤§å¯¹è±¡</li>\n<li>EdenåŒºå¹¸å­˜å¯¹è±¡è¶…è¿‡SurvivoråŒºå¤§å°</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>JVMå‚æ•°</p>\n<ul>\n<li><p>-Xms</p>\n<p>Javaå †å†…å­˜çš„å¤§å°</p>\n</li>\n<li><p>-Xmx</p>\n<p>Javaå †å†…å­˜çš„æœ€å¤§å¤§å°</p>\n</li>\n<li><p>-Xmn</p>\n<p>Javaå¯¹å†…å­˜ä¸­çš„æ–°ç”Ÿä»£å¤§å°ã€‚<br>è€å¹´ä»£=æ€»å¤§å°-æ–°ç”Ÿä»£</p>\n</li>\n<li><p>-XX:PermSize</p>\n<p>æ°¸ä¹…ä»£å¤§å°</p>\n</li>\n<li><p>-XX:MaxPermSize</p>\n<p>æ°¸ä¹…ä»£æœ€å¤§å¤§å°</p>\n</li>\n<li><p>-XX:MetaspaceSize</p>\n<p>å…ƒç©ºé—´å¤§å°</p>\n</li>\n<li><p>-XX:MaxMetaspaceSize</p>\n<p>å…ƒç©ºé—´æœ€å¤§å¤§å°</p>\n</li>\n<li><p>-Xss</p>\n<p>Javaæ ˆå†…å­˜å¤§å°</p>\n</li>\n<li><p>-XX:MaxTenuringThreshold</p>\n<p>å¯¹è±¡åœ¨å¹´è½»ä»£ä¸­å¹¸å­˜çš„æœ€å¤§è½®æ•°ã€‚<br>é»˜è®¤15ï¼Œä¸”ä¸èƒ½è¶…è¿‡15.</p>\n</li>\n<li><p>-XX:PretenureSizeThreshold</p>\n<p>å½“å¯¹è±¡å¤§å°è¶…è¿‡è¯¥å€¼æ—¶ï¼Œå¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œä¸ä¼šè¿›è¿‡å¹´è½»ä»£ã€‚<br>é¿å…å¤§å¯¹è±¡åœ¨Survivorä¸­å¤šæ¬¡å¤åˆ¶ï¼Œå‡å°‘æ— è°“çš„æ“ä½œã€‚</p>\n</li>\n<li><p>-XX:-HandlePromotionFailure</p>\n<p>åˆ¤æ–­è€å¹´ä»£å†…å­˜å¤§å°æ˜¯å¦å¤§äºä¹‹å‰æ¯ä¸€æ¬¡Minor GCåè¿›å…¥è€å¹´ä»£çš„å¯¹è±¡çš„å¹³å‡å¤§å°ã€‚<br>åˆ¤æ–­å¤±è´¥è¿›è¡ŒFull GCï¼Œå†æ‰§è¡ŒMinor GCã€‚</p>\n</li>\n<li><p>-XX:SurvivorRatio</p>\n<p>è°ƒæ•´EdenåŒºå’ŒSurvivoråŒºå†…å­˜æ¯”ç‡</p>\n<ul>\n<li>XX:SurvivorRatio=8  ï¼š Eden 80%</li>\n</ul>\n</li>\n<li><p>-XX:+PrintGCDetils</p>\n<p>æ‰“å°è¯¦ç»†çš„GCæ—¥å¿—ã€‚</p>\n</li>\n<li><p>-XX:+PrintGCTimeStamps</p>\n<p>æ‰“å°GCå‘ç”Ÿçš„æ—¶é—´ã€‚</p>\n</li>\n<li><p>-Xloggc:gc.log</p>\n<p>å°†CGæ—¥å¿—è¾“å…¥åˆ°æ–‡ä»¶ã€‚</p>\n</li>\n<li><p>-XX:TraceClassLoading</p>\n<p>è¿½è¸ªåŠ è½½çš„ç±»</p>\n</li>\n<li><p>-XX:TraceClassUnloading</p>\n<p>è¿½è¸ªå¸è½½çš„ç±»</p>\n</li>\n<li><p>-XX:+HeapDumpOnOutOfMemoryError  </p>\n<p>OOMæ—¶è‡ªåŠ¨dumpå¿«ç…§</p>\n</li>\n<li><p>-XX:HeapDumpPath=/usr/local/app/oom</p>\n<p>å°†å¿«ç…§å­˜æ”¾è‡³æŒ‡å®šç›®å½•</p>\n</li>\n<li><p>CMS</p>\n<ul>\n<li><p>-XX:CMSInitiatingOccupancyFaction</p>\n<p>è®¾ç½®è€å¹´ä»£å ç”¨å¤šå°‘æ¯”ä¾‹æ—¶è§¦å‘CMS</p>\n</li>\n<li><p>-XX:+UseCMSCompactAtFullCollection</p>\n<p>Full GCåSTWï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ã€‚</p>\n</li>\n<li><p>-XX:CMSFullGCsBeforeCompaction</p>\n<p>é»˜è®¤0ï¼Œè®¾ç½®å¤šå°‘æ¬¡Full GCåè¿›è¡Œå†…å­˜ç¢ç‰‡æ•´ç†ã€‚</p>\n</li>\n<li><p>-XX:+CMSParallelInitialMarkEnabled</p>\n<p>åˆå§‹æ ‡è®°é˜¶æ®µå¼€å¯å¹¶å‘æ‰§è¡Œ</p>\n</li>\n</ul>\n</li>\n<li><p>G1</p>\n<ul>\n<li><p>-XX:+UseG1GC</p>\n<p>æŒ‡å®šG1åƒåœ¾å›æ”¶å™¨ã€‚</p>\n</li>\n<li><p>-XX:G1HeapRegionSize</p>\n<p>æ‰‹åŠ¨æŒ‡å®šG1çš„Regionçš„å¤§å°ã€‚</p>\n</li>\n<li><p>-XX:G1NewSizePercent</p>\n<p>è°ƒæ•´æ–°ç”Ÿä»£åœ¨å †ä¸­çš„å æ¯”ã€‚<br>é»˜è®¤5%ã€‚</p>\n</li>\n<li><p>-XX:G1MaxNewSizePercent</p>\n<p>æ–°ç”Ÿä»£å æ¯”å †ç©ºé—´çš„æœ€å¤§å¤§å°ã€‚</p>\n</li>\n<li><p>-XX:MaxGCPauseMills</p>\n<p>é»˜è®¤200msã€‚<br>è®¾ç½®G1åƒåœ¾å›æ”¶å™¨GCæ—¶çš„æœ€å¤§åœé¡¿æ—¶é—´ã€‚</p>\n</li>\n<li><p>-XX:InitiatingHeapOccupancyPercent</p>\n<p>é»˜è®¤45%ã€‚<br>è€å¹´ä»£å æ®çš„å †å†…å­˜è¶…å¤šè¯¥å€¼ï¼Œå°†ä¼šè¿›è¡Œæ–°è€ç”Ÿä»£çš„æ··åˆå›æ”¶ã€‚</p>\n</li>\n<li><p>-XX:G1MixedGCCountTarget</p>\n<p>ä¸€æ¬¡G1æ··åˆå›æ”¶è¿‡ç¨‹ä¸­ï¼Œæœ€åé˜¶æ®µæ··åˆå›æ”¶é˜¶æ®µåˆ†å‡ æ¬¡å®Œæˆã€‚<br>é»˜è®¤8ã€‚</p>\n</li>\n<li><p>-XX:G1HeapWastePercent</p>\n<p>é»˜è®¤å€¼5%ã€‚<br>æ··åˆå›æ”¶é˜¶æ®µä¸­ï¼Œç©ºé—´Regionå æ¯”å †ç©ºé—´è¶…å¤šè¯¥å€¼ï¼Œä¼šåœæ­¢æ··åˆå›æ”¶ã€‚</p>\n</li>\n<li><p>-XX:G1MixedGCLiveThresholdPercent</p>\n<p>é»˜è®¤å€¼85%ã€‚<br>ä¸€ä¸ªRegionä¸­çš„å­˜æ´»å¯¹è±¡ä½äºè¯¥å€¼æ—¶æ‰ä¼šè¢«å›æ”¶ã€‚</p>\n</li>\n<li><p>-XX:+CMSScavengeBeforeRemark</p>\n<p>é‡æ–°æ ‡è®°å‰ï¼Œå°½é‡æ‰§è¡Œä¸€æ¬¡Young GCã€‚<br>æå‰å›æ”¶å¹´è½»ä»£æ²¡æœ‰å¼•ç”¨çš„å¯¹è±¡ï¼Œå‡å°‘é‡æ–°æ ‡è®°æ‰«æçš„å¯¹è±¡æ•°ï¼Œæé«˜æ•ˆç‡ã€‚</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>åƒåœ¾å›æ”¶</p>\n<ul>\n<li><p>å¯è¾¾æ€§åˆ†æ</p>\n<p>å¯¹ä¸€ä¸ªå¯¹è±¡å±‚å±‚å‘ä¸Šåˆ†æï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ä¸€ä¸ªGC Rootã€‚</p>\n<ul>\n<li><p>GC Root</p>\n<ul>\n<li>æœ¬åœ°å˜é‡è¡¨ä¸­çš„å±€éƒ¨å˜é‡</li>\n<li>æ–¹æ³•åŒºå†…çš„é™æ€å˜é‡</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>java å¼•ç”¨ç±»å‹</p>\n<ul>\n<li><p>å¼ºå¼•ç”¨</p>\n<p>GCä¸ä¼šå›æ”¶å¼ºå¼•ç”¨</p>\n</li>\n<li><p>è½¯å¼•ç”¨</p>\n<p>å†…å­˜ç©ºé—´è¶³å¤Ÿæ—¶ï¼ŒGCä¸ä¼šå›æ”¶è½¯å¼•ç”¨</p>\n</li>\n<li><p>å¼±å¼•ç”¨</p>\n<p>GCæ—¶å¿…å®šå›æ”¶å¼±å¼•ç”¨</p>\n</li>\n<li><p>è™šå¼•ç”¨</p>\n<p>ç»§æ‰¿Objectçš„finalize()æ–¹æ³•ï¼Œåœ¨è¯¥å¯¹è±¡è¢«å›æ”¶çš„æ—¶å€™é€šçŸ¥è‡ªå·±ã€‚</p>\n</li>\n</ul>\n</li>\n<li><p>åƒåœ¾å›æ”¶ç®—æ³•</p>\n<ul>\n<li><p>å¹´è½»ä»£</p>\n<ul>\n<li><p>å¤åˆ¶</p>\n<p>åœ¨æ–°ç”Ÿä»£å¹¸å­˜è€…0,1åŒºä½¿ç”¨ã€‚å°†æ ‡è®°ä¸ºå¯ç”¨çš„å†…å­˜å¤åˆ¶åˆ°å¦å¤–ä¸€ç‰‡è¿ç»­çš„å†…å­˜åŒºåŸŸä¸­ï¼Œå¹¶åˆ é™¤å½“å‰å†…å­˜åŒºåŸŸä¸­çš„å…¨éƒ¨æ•°æ®ã€‚</p>\n<ul>\n<li><p>ä¼˜ç‚¹</p>\n<p>ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</p>\n</li>\n<li><p>ç¼ºç‚¹</p>\n<p>å¢åŠ å†…å­˜çš„æ¶ˆè€—</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>è€å¹´ä»£</p>\n<ul>\n<li><p>æ ‡è®°æ•´ç†</p>\n<p>æ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œåˆ é™¤æ­»äº¡å¯¹è±¡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ã€‚</p>\n<ul>\n<li><p>ä¼˜ç‚¹</p>\n<p>ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚å†…å­˜åˆ©ç”¨ç‡é«˜ã€‚</p>\n</li>\n<li><p>ç¼ºç‚¹</p>\n<p>æ¯”èµ·æ ‡è®°æ¸…æ¥šï¼Œæ‰§è¡Œæ•ˆç‡æ…¢ã€‚</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>JVMåƒåœ¾å›æ”¶å™¨</p>\n<ul>\n<li><p>å¹´è½»ä»£</p>\n<ul>\n<li><p>ParNew</p>\n<p>å¤šçº¿ç¨‹ï¼Œå¤åˆ¶ç®—æ³•ã€‚<br>å¼€å¯ï¼š-XX:+UseParNewGC<br>è°ƒæ•´å›æ”¶çº¿ç¨‹æ•°ï¼š-XX:ParallelGCThreads</p>\n</li>\n</ul>\n</li>\n<li><p>è€å¹´ä»£</p>\n<ul>\n<li><p>CMS</p>\n<p>æ ‡è®°æ¸…ç†ç®—æ³•</p>\n<ul>\n<li><p>å›æ”¶è¿‡ç¨‹</p>\n<ul>\n<li><p>åˆå§‹æ ‡è®°</p>\n<p>STWã€‚<br>æ ‡è®°æ‰€æœ‰GC Rootsç›´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼Œè¢«ç›´æ¥å¼•ç”¨çš„å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«æ ‡è®°ã€‚</p>\n</li>\n<li><p>å¹¶å‘æ ‡è®°</p>\n<p>å¯»æ‰¾è¢«GC Rootsé—´æ¥å¼•ç”¨çš„å¯¹è±¡ã€‚</p>\n</li>\n<li><p>é‡æ–°æ ‡è®°</p>\n<p>STWã€‚<br>é‡æ–°æ ‡è®°å¹¶å‘æ ‡è®°æ—¶äº§ç”Ÿçš„æ–°å¯¹è±¡ã€‚</p>\n</li>\n<li><p>å¹¶å‘æ¸…é™¤</p>\n<p>æ¸…ç†æ ‡è®°çš„å¯¹è±¡ã€‚</p>\n</li>\n</ul>\n</li>\n<li><p>ç¼ºç‚¹</p>\n<p>é»˜è®¤å¯åŠ¨åƒåœ¾å›æ”¶çº¿ç¨‹ï¼šï¼ˆCPUæ ¸æ•° +3ï¼‰/4ã€‚<br>æœ¬èº«ä¼šæ¶ˆè€—CPUèµ„æºã€‚<br>é’ˆå¯¹æµ®åŠ¨åƒåœ¾ï¼Œåˆå§‹æ ‡è®°åäº§ç”Ÿçš„åƒåœ¾æ²¡æ³•å›æ”¶ã€‚<br>CMSå›æ”¶æœŸé—´ï¼Œæ–°ç”Ÿä»£è¿›å…¥è€å¹´ä»£å¯¹è±¡å¤§äºå¯ç”¨ç©ºé—´æ—¶ï¼Œä¼šå‘ç”ŸConcurrent Mode Failure ï¼Œå¹¶è‡ªåŠ¨ä½¿ç”¨Serial Oldå›æ”¶å™¨æ›¿ä»£CMSå·¥ä½œã€‚</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>G1</p>\n<p>åŸºäºå¤åˆ¶ç®—æ³•ã€‚<br>æŠŠJavaå †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„Regionã€‚<br>å¯ä»¥è®¾ç½®STWçš„æ—¶é—´ï¼Œè¿½è¸ªæ¯ä¸ªRegioné‡Œå¯å›æ”¶å¯¹è±¡çš„é¢„ä¼°æ—¶é—´ã€‚<br>G1ä¸­çš„åˆ†ä»£æ˜¯é€»è¾‘ä¸Šçš„åˆ†ä»£ï¼ŒåŒä¸€ä¸ªRegionä¼šéšç€åˆ†é…çš„å†…å­˜å¯¹è±¡ä¸åŒï¼Œè€Œå±äºä¸åŒåˆ†ä»£ã€‚<br>æ¯ä¸ªRegionçš„å¤§å°ï¼šå †å¤§å°/2048ã€‚<br>æ–°ç”Ÿä»£çš„RegionåŒæ—¶åˆ†Edenå’ŒSurvivorï¼Œå¯é€šè¿‡-XX:SurvivorRatioè°ƒæ•´å æ¯”ã€‚<br>é€‚åˆå¤§å†…å­˜çš„æœºå™¨ï¼ŒG1å¯ä»¥è®¾ç½®åœé¡¿æ—¶é—´ï¼Œæ¥ç¡®ä¿å¯¹æœåŠ¡ä¸ä¼šæœ‰è¾ƒå¤§çš„å½±å“ã€‚</p>\n<ul>\n<li><p>å¤§å¯¹è±¡</p>\n<p>è¶…å¤šRegionå¤§å°50%å³ä¸ºå¤§å¯¹è±¡ã€‚<br>å¤§å¯¹è±¡å¯èƒ½æ¨ªè·¨å¤šä¸ªRegionã€‚<br>ç©ºçš„Regionéƒ½å¯ä»¥å­˜æ”¾å¤§å¯¹è±¡ã€‚<br>æ–°è€ç”Ÿä»£GCæ—¶éƒ½ä¼šå›æ”¶å¤§å¯¹è±¡ã€‚</p>\n</li>\n<li><p>å›æ”¶è¿‡ç¨‹</p>\n<ul>\n<li><p>åˆå§‹æ ‡è®°</p>\n<p>STWã€‚<br>æ ‡è®°æ‰€æœ‰GC Rootsç›´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼Œè¢«ç›´æ¥å¼•ç”¨çš„å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«æ ‡è®°ã€‚</p>\n</li>\n<li><p>å¹¶å‘æ ‡è®°</p>\n<p>è¿›è¡ŒGC Rootsçš„è¿½è¸ªï¼Œè¿½è¸ªæ‰€æœ‰å­˜æ´»å¯¹è±¡ã€‚<br>åŒæ—¶JVMä¼šè®°å½•è¯¥é˜¶æ®µä¸­æ–°å»ºæˆ–å¤±å»å¼•ç”¨çš„å¯¹è±¡ã€‚</p>\n</li>\n<li><p>æœ€ç»ˆæ ‡è®°</p>\n<p>STWã€‚<br>é€šè¿‡å¤šå¹¶å‘æ ‡è®°ä¸­JVMå †æ–°å¢æˆ–å¤±å»å¼•ç”¨çš„å¯¹è±¡ï¼Œè¿›è¡Œé‡æ–°æ ‡è®°ã€‚</p>\n</li>\n<li><p>æ··åˆå›æ”¶</p>\n<p>åˆ†æRegionå¤§å°ï¼Œæ‰§è¡Œæ•ˆç‡ã€‚<br>STWã€‚<br>åœ¨æŒ‡å®šæ—¶é—´å†…è¿›è¡Œå›æ”¶ã€‚</p>\n</li>\n</ul>\n</li>\n<li><p>é—®é¢˜</p>\n<p>å›æ”¶ä¸­å‘ç°Regionç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå°†ä¼šSWTï¼Œå¹¶å•çº¿ç¨‹è¿›è¡Œæ ‡è®°ã€æ¸…é™¤ã€æ•´ç†ï¼Œæ•ˆç‡å¾ˆä½ã€‚</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>CGè§¦å‘æ—¶é—´</p>\n<ul>\n<li><p>Minor GC</p>\n<p>EdenåŒºæ»¡æ—¶é‡‡ç”¨å¤åˆ¶ç®—æ³•ã€‚</p>\n</li>\n<li><p>Old GC</p>\n<p>1.è€å¹´ä»£è¿ç»­å¯ç”¨ç©ºé—´ &lt; æ–°ç”Ÿä»£å†æ¬¡GCåå‡å…¥è€å¹´ä»£å¯¹è±¡å†…å­˜å’Œçš„å¹³å‡å¤§å°ã€‚<br>2.è€å¹´ä»£ä¸å¤Ÿå­˜æ”¾ï¼ŒMinor GCåå‡å…¥è€å¹´ä»£çš„å¯¹è±¡æ—¶ã€‚<br>3.è€å¹´ä»£å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡92%æ—¶ï¼ˆå¯è®¾ç½®ï¼‰ã€‚</p>\n</li>\n<li><p>æ°¸ä¹…ä»£GC</p>\n<p>æ°¸ä¹…ä»£ä¸å¤Ÿä½¿äº§ç”ŸFull GCã€‚</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"æœ¬åœ°æ–¹æ³•æ ˆ\"><a href=\"#æœ¬åœ°æ–¹æ³•æ ˆ\" class=\"headerlink\" title=\"æœ¬åœ°æ–¹æ³•æ ˆ\"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h3><p>å­˜æ”¾nativeæ–¹æ³•ã€‚</p>\n<h3 id=\"å †å¤–å†…å­˜ç©ºé—´\"><a href=\"#å †å¤–å†…å­˜ç©ºé—´\" class=\"headerlink\" title=\"å †å¤–å†…å­˜ç©ºé—´\"></a>å †å¤–å†…å­˜ç©ºé—´</h3><p>é€šè¿‡è°ƒç”¨æ“ä½œç³»ç»Ÿæ¥å£ï¼Œç›´æ¥åˆ†é…å¯¹å¤–å†…å­˜ç©ºé—´ã€‚<br>NIO-&gt;allocateDirect(DirectByteBuffer)</p>\n<h2 id=\"å·¥å…·\"><a href=\"#å·¥å…·\" class=\"headerlink\" title=\"å·¥å…·\"></a>å·¥å…·</h2><h3 id=\"jstat\"><a href=\"#jstat\" class=\"headerlink\" title=\"jstat\"></a>jstat</h3><p>é€šè¿‡jpsæŸ¥æ‰¾javaè¿›ç¨‹ï¼Œå†ç”¨jstat -gc PIDæŸ¥çœ‹GCçŠ¶å†µã€‚</p>\n<ul>\n<li><p>æŒ‡æ ‡</p>\n<ul>\n<li><p>S0C</p>\n<p>From SurvivoråŒºå¤§å°</p>\n</li>\n<li><p>S1C</p>\n<p>To SurvivoråŒºå¤§å°</p>\n</li>\n<li><p>S0U</p>\n<p>From SurvivoråŒºå½“å‰ä½¿ç”¨å¤§å°</p>\n</li>\n<li><p>S1U</p>\n<p>To SurvivoråŒºå½“å‰ä½¿ç”¨å¤§å°</p>\n</li>\n<li><p>EC</p>\n<p>EdenåŒºå¤§å°</p>\n</li>\n<li><p>EU</p>\n<p>EdenåŒºå½“å‰ä½¿ç”¨çš„å¤§å°</p>\n</li>\n<li><p>OC</p>\n<p>è€å¹´ä»£çš„å¤§å°</p>\n</li>\n<li><p>OU</p>\n<p>è€å¹´ä»£å½“å‰ä½¿ç”¨çš„å¤§å°</p>\n</li>\n<li><p>MC</p>\n<p>æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ã€å…ƒç©ºé—´ï¼‰çš„å¤§å°</p>\n</li>\n<li><p>MU</p>\n<p>æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ã€å…ƒç©ºé—´ï¼‰å½“å‰ä½¿ç”¨çš„å¤§å°</p>\n</li>\n<li><p>YGC</p>\n<p>ç³»ç»Ÿè¿„ä»Šä¸ºæ­¢Young GCçš„æ¬¡æ•°</p>\n</li>\n<li><p>YGCT</p>\n<p>Young GCè€—æ—¶</p>\n</li>\n<li><p>FGC</p>\n<p>ç³»ç»Ÿè¿„ä»Šä¸ºæ­¢Full GCçš„æ¬¡æ•°</p>\n</li>\n<li><p>FGCT</p>\n<p>Full GCçš„è€—æ—¶</p>\n</li>\n<li><p>GCT</p>\n<p>æ‰€æœ‰GCçš„æ€»è€—æ—¶</p>\n</li>\n</ul>\n</li>\n<li><p>å‘½ä»¤</p>\n<ul>\n<li><p>jstat -gc PID</p>\n<p>æŸ¥çœ‹GCçŠ¶å†µ</p>\n</li>\n<li><p>jstat -gccapacity PID</p>\n<p>å †å†…å­˜åˆ†æ</p>\n</li>\n<li><p>jstat -gcnew PID</p>\n<p>æ–°ç”Ÿä»£åˆ†æ</p>\n</li>\n<li><p>jstat -gcnewcapacity PID</p>\n<p>å¹´è½»ä»£å†…å­˜åˆ†æ</p>\n</li>\n<li><p>jstat -gcold PID</p>\n<p>è€å¹´ä»£GCåˆ†æ</p>\n</li>\n<li><p>jstat -gcoldcapacity PID</p>\n<p>è€å¹´ä»£å†…å­˜åˆ†æ</p>\n</li>\n<li><p>jstat -gcmetacapacity PID</p>\n<p>å…ƒæ•°æ®å†…å­˜åˆ†æ</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"jmap\"><a href=\"#jmap\" class=\"headerlink\" title=\"jmap\"></a>jmap</h3><p>äº†è§£è¿è¡Œæ—¶çš„å†…å­˜åŒºåŸŸ</p>\n<ul>\n<li><p>å‘½ä»¤</p>\n<ul>\n<li><p>jmap -heap PID</p>\n<p>æ‰“å°å †å†…å­˜ç›¸å…³å‚æ•°è®¾ç½®ã€‚<br>å½“å‰å †å†…å„ä¸ªåŒºçš„åŸºæœ¬æƒ…å†µã€‚</p>\n</li>\n<li><p>jmap -histo PID</p>\n<p>æŒ‰ç…§å¯¹è±¡åœ¨å†…å­˜ä¸­å ç”¨å¤§å°æ’åºï¼Œé™åºã€‚<br>å¯ä»¥äº†è§£å“ªä¸ªå¯¹è±¡åœ¨å †ä¸­å ç”¨äº†å¤§é‡çš„ç©ºé—´ã€‚</p>\n</li>\n<li><p>jmap -dump:live,format=b,file=dump.hprof PID</p>\n<p>ç”Ÿæˆå†…å­˜å¿«ç…§å¹¶è¾“å‡ºåˆ°æ–‡ä»¶ã€‚</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"jhat\"><a href=\"#jhat\" class=\"headerlink\" title=\"jhat\"></a>jhat</h3><p>åˆ†æå †å†…å­˜å¿«ç…§ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·å†…ç½®çš„æµè§ˆå™¨æŸ¥çœ‹ã€‚</p>\n<ul>\n<li><p>å‘½ä»¤</p>\n<ul>\n<li><p>jhat dump.hprof -port 7000</p>\n<p>åˆ†æå¿«ç…§æ–‡ä»¶dump.hprof ï¼Œè®¿é—®ç«¯å£7000ã€‚</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"MAT\"><a href=\"#MAT\" class=\"headerlink\" title=\"MAT\"></a>MAT</h3><p>å†…å­˜åˆ†æå·¥å…·</p>\n<h2 id=\"JVMä¼˜åŒ–æ€»ç»“\"><a href=\"#JVMä¼˜åŒ–æ€»ç»“\" class=\"headerlink\" title=\"JVMä¼˜åŒ–æ€»ç»“\"></a>JVMä¼˜åŒ–æ€»ç»“</h2><h3 id=\"è°ƒæ•´æ–°ç”Ÿä»£çš„å¤§å°\"><a href=\"#è°ƒæ•´æ–°ç”Ÿä»£çš„å¤§å°\" class=\"headerlink\" title=\"è°ƒæ•´æ–°ç”Ÿä»£çš„å¤§å°\"></a>è°ƒæ•´æ–°ç”Ÿä»£çš„å¤§å°</h3><p>å°½é‡è®©æ¯æ¬¡Young GCåçš„å­˜æ´»å¯¹è±¡â¼©äºSurvivoråŒºåŸŸçš„50%ï¼Œéƒ½ç•™å­˜åœ¨å¹´è½»ä»£â¾¥ã€‚å°½é‡åˆ«è®©å¯¹è±¡è¿› â¼Šâ½¼å¹´ä»£ã€‚å°½é‡å‡å°‘Full GCçš„é¢‘ç‡ï¼Œé¿å…é¢‘ç¹Full GCå¯¹JVMæ€§èƒ½çš„å½±å“</p>\n<h3 id=\"è°ƒæ•´è€å¹´ä»£ç¢ç‰‡å›æ”¶çš„é¢‘ç‡\"><a href=\"#è°ƒæ•´è€å¹´ä»£ç¢ç‰‡å›æ”¶çš„é¢‘ç‡\" class=\"headerlink\" title=\"è°ƒæ•´è€å¹´ä»£ç¢ç‰‡å›æ”¶çš„é¢‘ç‡\"></a>è°ƒæ•´è€å¹´ä»£ç¢ç‰‡å›æ”¶çš„é¢‘ç‡</h3><p>CMSä¸€æ¬¡Full GCä¼šäº§ç”Ÿå†…å­˜éšä¾¿ï¼Œè°ƒæ•´ç¢ç‰‡æ•´ç†çš„è§¦å‘è½®æ•°ï¼Œå¯ä»¥æœ‰æ•ˆçš„é™ä½Full  GCäº§ç”Ÿçš„ç¢ç‰‡ä»è€Œé™ä½Full GCçš„é¢‘æ¬¡ã€‚</p>\n<h3 id=\"JVMå‚æ•°æ¨¡æ¿\"><a href=\"#JVMå‚æ•°æ¨¡æ¿\" class=\"headerlink\" title=\"JVMå‚æ•°æ¨¡æ¿\"></a>JVMå‚æ•°æ¨¡æ¿</h3><p>-Xms4096M -Xmx4096M -Xmn3072M -Xss1MÂ -XX:MetaspaceSize=256M -XX:MaxMetaspaceSize=256M -XX:+UseParNewGC - XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFaction=92 -XX:+UseCMSCompactAtFullCollection - XX:CMSFullGCsBeforeCompaction=0 -XX:+CMSParallelInitialMarkEnabled -XX:+CMSScavengeBeforeRemark - XX:+DisableExplicitGC -XX:+PrintGCDetails -Xloggc:gc.log -XX:+HeapDumpOnOutOfMemoryErrorÂ - XX:HeapDumpPath=/usr/local/app/oom</p>\n<h3 id=\"XX-SoftRefLRUPolicyMSPerMB\"><a href=\"#XX-SoftRefLRUPolicyMSPerMB\" class=\"headerlink\" title=\"-XX:SoftRefLRUPolicyMSPerMB\"></a>-XX:SoftRefLRUPolicyMSPerMB</h3><p>åœ¨æœ‰å¤§é‡åå°„çš„æƒ…å†µä¸‹å»ºè®®å¢å¤§è¯¥å€¼ï¼Œä¿è¯è½¯å¼•ç”¨ä¸ä¼šè¢«é©¬ä¸Šå›æ”¶</p>\n<h3 id=\"XX-DisableExplicitGC\"><a href=\"#XX-DisableExplicitGC\" class=\"headerlink\" title=\"-XX:+DisableExplicitGC\"></a>-XX:+DisableExplicitGC</h3><p>ç¦æ­¢æ˜¾ç¤ºæ‰§è¡ŒGC<br>æ€§è´¨System.gc()</p>\n<h3 id=\"ä½¿ç”¨ç¼“å­˜æ·˜æ±°æœºåˆ¶\"><a href=\"#ä½¿ç”¨ç¼“å­˜æ·˜æ±°æœºåˆ¶\" class=\"headerlink\" title=\"ä½¿ç”¨ç¼“å­˜æ·˜æ±°æœºåˆ¶\"></a>ä½¿ç”¨ç¼“å­˜æ·˜æ±°æœºåˆ¶</h3><p>é¿å…æœ¬åœ°ç¼“å­˜æ— é™å¢å¤§ï¼Œä½¿å¾—è€å¹´ä»£å¸¸é©»å¯¹è±¡æ— æ³•å›æ”¶ï¼Œä»è€Œå¯¼è‡´çš„å†…å­˜æº¢å‡ºå’Œé¢‘ç¹çš„Full GCã€‚</p>\n<h3 id=\"é¢‘ç¹Full-GCçš„å¯èƒ½åŸå› \"><a href=\"#é¢‘ç¹Full-GCçš„å¯èƒ½åŸå› \" class=\"headerlink\" title=\"é¢‘ç¹Full GCçš„å¯èƒ½åŸå› \"></a>é¢‘ç¹Full GCçš„å¯èƒ½åŸå› </h3><p>1.ç³»ç»Ÿå‹åŠ›å¤§ï¼Œé¢‘ç¹Young GCåå­˜æ´»å¯¹è±¡å¤§äºSurvivoråŒºï¼Œå¯¼è‡´ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚<br>2.é¢‘ç¹äº§ç”Ÿå¤§å¯¹è±¡ã€‚<br>3.å¯¹è±¡å§‹ç»ˆä¸é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚<br>4.æ–¹æ³•åŒºé¢‘ç¹æœ‰ç±»åå°„åŠ è½½ã€‚<br>5.é”™è¯¯ä½¿ç”¨System.gc()ã€‚</p>\n<p><em>XMind: ZEN - Trial Version</em></p>"},{"title":"NIO","date":"2020-01-29T12:52:57.000Z","_content":"\n## Buffer\n\nè´Ÿè´£æ•°æ®çš„å­˜å–ã€‚ç¼“å†²åŒºåŠæ—¶æ•°ç»„ã€‚ç”¨äºå­˜å‚¨ä¸åŒæ•°æ®ç±»å‹çš„æ•°æ®ã€‚ï¼ˆbooleané™¤å¤–ï¼‰\né€šè¿‡allocate()è·å–ç¼“å†²åŒº\nput()ï¼Œget()\nç¼“å†²åŒºä¸­çš„æ ¸å¿ƒå±æ€§\ncapacity:å®¹é‡ï¼Œè¡¨ç¤ºç¼“å†²åŒºä¸­æœ€å¤§å­˜å‚¨æ•°æ®çš„å®¹é‡ã€‚ä¸€æ—¦ç”³æ˜ä¸èƒ½æ”¹å˜ã€‚\nlimit:ç•Œé™ï¼Œè¡¨ç¤ºç¼“å†²åŒºä¸­å¯ä»¥æ“ä½œæ•°æ®çš„å¤§å°ã€‚limitåç«¯çš„æ•°æ®ä¸èƒ½è¿›è¡Œè¯»å†™ã€‚\nposition:ä½ç½®ï¼Œè¡¨ç¤ºç¼“å†²åŒºä¸­æ­£åœ¨æ“ä½œçš„ä½ç½®ã€‚\n0<=mark<=posiotion<=limit<=capacity\nflip() åˆ‡æ¢è¯»å–æ•°æ®æ¨¡å¼\nrewind() å¯é‡å¤è¯»\nclear()æ¸…ç©ºç¼“å†²åŒºï¼Œæ•°æ®å¹¶æ²¡æœ‰è¢«æ¸…ç©º\nmark:æ ‡è®°ï¼Œè¡¨ç¤ºè®°å½•å½“å‰positionçš„ä½ç½®ã€‚å¯ä»¥é€šè¿‡reset()æ¢å¤åˆ°markçš„ä½ç½®ã€‚\nhasRemaining()ï¼šç¼“å†²åŒºä¸­æ˜¯å¦è¿˜æœ‰å‰©ä½™çš„æ•°æ®\n<!-- more -->\n### å®ç°ç±»\n\n- ByteBuffer\n- CharBuffer\n- ShortBuffer\n- IntBuffer\n- LongBuffer\n- FloatBuffer\n- DoubleBuffer\n\n### ç›´æ¥ç¼“å†²åŒº&éç›´æ¥ç¼“å†²åŒº\n\nå¯ä»¥é€šè¿‡isDirect()åˆ¤æ–­æ˜¯å¦ä¸ºç›´æ¥ç¼“å†²åŒº&éç›´æ¥ç¼“å†²åŒº\n\n- ç›´æ¥ç¼“å†²åŒº(ç‰©ç†å†…å­˜æ˜ å°„æ–‡ä»¶)\n\n  é€šè¿‡allocateDirec()æ–¹æ³•åˆ†é…ç›´æ¥ç¼“å†²åŒºï¼Œå°†ç¼“å†²åŒºå»ºç«‹åœ¨ç‰©ç†å†…å­˜ä¸­ã€‚\n  å¯ä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚\n  \n  ç‰©ç†ç£ç›˜-å†…æ ¸åœ°å€ç©ºé—´-ç‰©ç†å†…å­˜æ˜ å°„æ–‡ä»¶-ç”¨æˆ·åœ°å€ç©ºé—´-åº”ç”¨ç¨‹åº\n\n- éç›´æ¥ç¼“å†²åŒº\n\n  é€šè¿‡allocatie()æ–¹æ³•åˆ†é…ç¼“å†²åŒºï¼Œå°†ç¼“å†²åŒºå»ºç«‹åœ¨JVMçš„å†…å­˜ä¸­ã€‚\n  \n  ç£ç›˜-å†…æ ¸åœ°å€ç©ºé—´-ç”¨æˆ·åœ°å€ç©ºé—´-åº”ç”¨ç¨‹åº\n\n## Channel\n\nè´Ÿè´£ç¼“å†²åŒºä¸­çš„æ•°æ®ä¼ è¾“ã€‚Channelæœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œå› æ­¤éœ€è¦é…åˆç¼“å†²åŒºè¿›è¡Œä¼ è¾“ã€‚ \né’ˆå¯¹æ”¯æŒé€šé“çš„æ³ªæä¾›äº†getChannel()æ–¹æ³•ï¼š\næœ¬åœ°IOï¼š\nFileInputStream/FileOutputStream\nRandomAccessFile\nç½‘è·¯IOï¼š\nSocket\nSeverSocket\nDatagramSocket\n\nåœ¨JDK1.7ä¸­çš„NIO.2é’ˆå¯¹å„ä¸ªé€šé“æä¾›äº†é™æ€æ–¹æ³•open()\nå’‹JDK1.7ä¸­çš„NIO.2çš„Fileså·¥å…·ç±»çš„newByteChannel()\n\n### å®ç°ç±»\n\n- FileChannel\n- SocketChannel\n- ServerSocketChannel\n- DatagramChannel\n\n### é€šé“ä¹‹é—´çš„æ•°æ®ä¼ è¾“\n\n- transferFrom()\n- transferTo()\n\n### åˆ†æ•£ä¸èšé›†\n\n- åˆ†æ•£(Scatter)\n\n  åˆ†æ•£è¯»å–(Scattering Reads)ï¼šå°†é€šé“ä¸­çš„æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªç¼“å†²åŒºä¸­\n\n- èšé›†(Gather)\n\n  èšé›†å†™å…¥(Gathering Writes)ï¼šå°†å¤šä¸ªç¼“å†²åŒºä¸­çš„æ•°æ®èšé›†åˆ°é€šé“ä¸­\n\n### å­—ç¬¦é›†(Charest)\n\n- ç¼–ç \n\n  å­—ç¬¦ä¸² -> å­—èŠ‚æ•°ç»„\n\n- è§£ç \n\n  å­—èŠ‚æ•°ç»„ -> å­—ç¬¦ä¸²\n\n## Selector","source":"_posts/NIO.md","raw":"---\ntitle: NIO\ndate: 2020-01-29 20:52:57\ntags:\n    - Java\n    - IO\ncategories:\n    - Technology\n---\n\n## Buffer\n\nè´Ÿè´£æ•°æ®çš„å­˜å–ã€‚ç¼“å†²åŒºåŠæ—¶æ•°ç»„ã€‚ç”¨äºå­˜å‚¨ä¸åŒæ•°æ®ç±»å‹çš„æ•°æ®ã€‚ï¼ˆbooleané™¤å¤–ï¼‰\né€šè¿‡allocate()è·å–ç¼“å†²åŒº\nput()ï¼Œget()\nç¼“å†²åŒºä¸­çš„æ ¸å¿ƒå±æ€§\ncapacity:å®¹é‡ï¼Œè¡¨ç¤ºç¼“å†²åŒºä¸­æœ€å¤§å­˜å‚¨æ•°æ®çš„å®¹é‡ã€‚ä¸€æ—¦ç”³æ˜ä¸èƒ½æ”¹å˜ã€‚\nlimit:ç•Œé™ï¼Œè¡¨ç¤ºç¼“å†²åŒºä¸­å¯ä»¥æ“ä½œæ•°æ®çš„å¤§å°ã€‚limitåç«¯çš„æ•°æ®ä¸èƒ½è¿›è¡Œè¯»å†™ã€‚\nposition:ä½ç½®ï¼Œè¡¨ç¤ºç¼“å†²åŒºä¸­æ­£åœ¨æ“ä½œçš„ä½ç½®ã€‚\n0<=mark<=posiotion<=limit<=capacity\nflip() åˆ‡æ¢è¯»å–æ•°æ®æ¨¡å¼\nrewind() å¯é‡å¤è¯»\nclear()æ¸…ç©ºç¼“å†²åŒºï¼Œæ•°æ®å¹¶æ²¡æœ‰è¢«æ¸…ç©º\nmark:æ ‡è®°ï¼Œè¡¨ç¤ºè®°å½•å½“å‰positionçš„ä½ç½®ã€‚å¯ä»¥é€šè¿‡reset()æ¢å¤åˆ°markçš„ä½ç½®ã€‚\nhasRemaining()ï¼šç¼“å†²åŒºä¸­æ˜¯å¦è¿˜æœ‰å‰©ä½™çš„æ•°æ®\n<!-- more -->\n### å®ç°ç±»\n\n- ByteBuffer\n- CharBuffer\n- ShortBuffer\n- IntBuffer\n- LongBuffer\n- FloatBuffer\n- DoubleBuffer\n\n### ç›´æ¥ç¼“å†²åŒº&éç›´æ¥ç¼“å†²åŒº\n\nå¯ä»¥é€šè¿‡isDirect()åˆ¤æ–­æ˜¯å¦ä¸ºç›´æ¥ç¼“å†²åŒº&éç›´æ¥ç¼“å†²åŒº\n\n- ç›´æ¥ç¼“å†²åŒº(ç‰©ç†å†…å­˜æ˜ å°„æ–‡ä»¶)\n\n  é€šè¿‡allocateDirec()æ–¹æ³•åˆ†é…ç›´æ¥ç¼“å†²åŒºï¼Œå°†ç¼“å†²åŒºå»ºç«‹åœ¨ç‰©ç†å†…å­˜ä¸­ã€‚\n  å¯ä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚\n  \n  ç‰©ç†ç£ç›˜-å†…æ ¸åœ°å€ç©ºé—´-ç‰©ç†å†…å­˜æ˜ å°„æ–‡ä»¶-ç”¨æˆ·åœ°å€ç©ºé—´-åº”ç”¨ç¨‹åº\n\n- éç›´æ¥ç¼“å†²åŒº\n\n  é€šè¿‡allocatie()æ–¹æ³•åˆ†é…ç¼“å†²åŒºï¼Œå°†ç¼“å†²åŒºå»ºç«‹åœ¨JVMçš„å†…å­˜ä¸­ã€‚\n  \n  ç£ç›˜-å†…æ ¸åœ°å€ç©ºé—´-ç”¨æˆ·åœ°å€ç©ºé—´-åº”ç”¨ç¨‹åº\n\n## Channel\n\nè´Ÿè´£ç¼“å†²åŒºä¸­çš„æ•°æ®ä¼ è¾“ã€‚Channelæœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œå› æ­¤éœ€è¦é…åˆç¼“å†²åŒºè¿›è¡Œä¼ è¾“ã€‚ \né’ˆå¯¹æ”¯æŒé€šé“çš„æ³ªæä¾›äº†getChannel()æ–¹æ³•ï¼š\næœ¬åœ°IOï¼š\nFileInputStream/FileOutputStream\nRandomAccessFile\nç½‘è·¯IOï¼š\nSocket\nSeverSocket\nDatagramSocket\n\nåœ¨JDK1.7ä¸­çš„NIO.2é’ˆå¯¹å„ä¸ªé€šé“æä¾›äº†é™æ€æ–¹æ³•open()\nå’‹JDK1.7ä¸­çš„NIO.2çš„Fileså·¥å…·ç±»çš„newByteChannel()\n\n### å®ç°ç±»\n\n- FileChannel\n- SocketChannel\n- ServerSocketChannel\n- DatagramChannel\n\n### é€šé“ä¹‹é—´çš„æ•°æ®ä¼ è¾“\n\n- transferFrom()\n- transferTo()\n\n### åˆ†æ•£ä¸èšé›†\n\n- åˆ†æ•£(Scatter)\n\n  åˆ†æ•£è¯»å–(Scattering Reads)ï¼šå°†é€šé“ä¸­çš„æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªç¼“å†²åŒºä¸­\n\n- èšé›†(Gather)\n\n  èšé›†å†™å…¥(Gathering Writes)ï¼šå°†å¤šä¸ªç¼“å†²åŒºä¸­çš„æ•°æ®èšé›†åˆ°é€šé“ä¸­\n\n### å­—ç¬¦é›†(Charest)\n\n- ç¼–ç \n\n  å­—ç¬¦ä¸² -> å­—èŠ‚æ•°ç»„\n\n- è§£ç \n\n  å­—èŠ‚æ•°ç»„ -> å­—ç¬¦ä¸²\n\n## Selector","slug":"NIO","published":1,"updated":"2020-12-14T09:51:24.008Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71ht30008v252fd3b0ipn","content":"<html><head></head><body><h2 id=\"Buffer\"><a href=\"#Buffer\" class=\"headerlink\" title=\"Buffer\"></a>Buffer</h2><p>&#x8D1F;&#x8D23;&#x6570;&#x636E;&#x7684;&#x5B58;&#x53D6;&#x3002;&#x7F13;&#x51B2;&#x533A;&#x53CA;&#x65F6;&#x6570;&#x7EC4;&#x3002;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x4E0D;&#x540C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x3002;&#xFF08;boolean&#x9664;&#x5916;&#xFF09;<br>&#x901A;&#x8FC7;allocate()&#x83B7;&#x53D6;&#x7F13;&#x51B2;&#x533A;<br>put()&#xFF0C;get()<br>&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x7684;&#x6838;&#x5FC3;&#x5C5E;&#x6027;<br>capacity:&#x5BB9;&#x91CF;&#xFF0C;&#x8868;&#x793A;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x6700;&#x5927;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x7684;&#x5BB9;&#x91CF;&#x3002;&#x4E00;&#x65E6;&#x7533;&#x660E;&#x4E0D;&#x80FD;&#x6539;&#x53D8;&#x3002;<br>limit:&#x754C;&#x9650;&#xFF0C;&#x8868;&#x793A;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x53EF;&#x4EE5;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x7684;&#x5927;&#x5C0F;&#x3002;limit&#x540E;&#x7AEF;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x80FD;&#x8FDB;&#x884C;&#x8BFB;&#x5199;&#x3002;<br>position:&#x4F4D;&#x7F6E;&#xFF0C;&#x8868;&#x793A;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x6B63;&#x5728;&#x64CD;&#x4F5C;&#x7684;&#x4F4D;&#x7F6E;&#x3002;<br>0&lt;=mark&lt;=posiotion&lt;=limit&lt;=capacity<br>flip() &#x5207;&#x6362;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x6A21;&#x5F0F;<br>rewind() &#x53EF;&#x91CD;&#x590D;&#x8BFB;<br>clear()&#x6E05;&#x7A7A;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x6570;&#x636E;&#x5E76;&#x6CA1;&#x6709;&#x88AB;&#x6E05;&#x7A7A;<br>mark:&#x6807;&#x8BB0;&#xFF0C;&#x8868;&#x793A;&#x8BB0;&#x5F55;&#x5F53;&#x524D;position&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;reset()&#x6062;&#x590D;&#x5230;mark&#x7684;&#x4F4D;&#x7F6E;&#x3002;<br>hasRemaining()&#xFF1A;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x662F;&#x5426;&#x8FD8;&#x6709;&#x5269;&#x4F59;&#x7684;&#x6570;&#x636E;</p>\n<a id=\"more\"></a>\n<h3 id=\"&#x5B9E;&#x73B0;&#x7C7B;\"><a href=\"#&#x5B9E;&#x73B0;&#x7C7B;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;&#x7C7B;\"></a>&#x5B9E;&#x73B0;&#x7C7B;</h3><ul>\n<li>ByteBuffer</li>\n<li>CharBuffer</li>\n<li>ShortBuffer</li>\n<li>IntBuffer</li>\n<li>LongBuffer</li>\n<li>FloatBuffer</li>\n<li>DoubleBuffer</li>\n</ul>\n<h3 id=\"&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;-amp-&#x975E;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;\"><a href=\"#&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;-amp-&#x975E;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;\" class=\"headerlink\" title=\"&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;&amp;&#x975E;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;\"></a>&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;&amp;&#x975E;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;</h3><p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;isDirect()&#x5224;&#x65AD;&#x662F;&#x5426;&#x4E3A;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;&amp;&#x975E;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;</p>\n<ul>\n<li><p>&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;(&#x7269;&#x7406;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x6587;&#x4EF6;)</p>\n<p>&#x901A;&#x8FC7;allocateDirec()&#x65B9;&#x6CD5;&#x5206;&#x914D;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x5C06;&#x7F13;&#x51B2;&#x533A;&#x5EFA;&#x7ACB;&#x5728;&#x7269;&#x7406;&#x5185;&#x5B58;&#x4E2D;&#x3002;<br>&#x53EF;&#x4EE5;&#x63D0;&#x9AD8;&#x6267;&#x884C;&#x6548;&#x7387;&#x3002;</p>\n<p>&#x7269;&#x7406;&#x78C1;&#x76D8;-&#x5185;&#x6838;&#x5730;&#x5740;&#x7A7A;&#x95F4;-&#x7269;&#x7406;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x6587;&#x4EF6;-&#x7528;&#x6237;&#x5730;&#x5740;&#x7A7A;&#x95F4;-&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</p>\n</li>\n<li><p>&#x975E;&#x76F4;&#x63A5;&#x7F13;&#x51B2;&#x533A;</p>\n<p>&#x901A;&#x8FC7;allocatie()&#x65B9;&#x6CD5;&#x5206;&#x914D;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x5C06;&#x7F13;&#x51B2;&#x533A;&#x5EFA;&#x7ACB;&#x5728;JVM&#x7684;&#x5185;&#x5B58;&#x4E2D;&#x3002;</p>\n<p>&#x78C1;&#x76D8;-&#x5185;&#x6838;&#x5730;&#x5740;&#x7A7A;&#x95F4;-&#x7528;&#x6237;&#x5730;&#x5740;&#x7A7A;&#x95F4;-&#x5E94;&#x7528;&#x7A0B;&#x5E8F;</p>\n</li>\n</ul>\n<h2 id=\"Channel\"><a href=\"#Channel\" class=\"headerlink\" title=\"Channel\"></a>Channel</h2><p>&#x8D1F;&#x8D23;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x4F20;&#x8F93;&#x3002;Channel&#x672C;&#x8EAB;&#x4E0D;&#x5B58;&#x50A8;&#x6570;&#x636E;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x914D;&#x5408;&#x7F13;&#x51B2;&#x533A;&#x8FDB;&#x884C;&#x4F20;&#x8F93;&#x3002;<br>&#x9488;&#x5BF9;&#x652F;&#x6301;&#x901A;&#x9053;&#x7684;&#x6CEA;&#x63D0;&#x4F9B;&#x4E86;getChannel()&#x65B9;&#x6CD5;&#xFF1A;<br>&#x672C;&#x5730;IO&#xFF1A;<br>FileInputStream/FileOutputStream<br>RandomAccessFile<br>&#x7F51;&#x8DEF;IO&#xFF1A;<br>Socket<br>SeverSocket<br>DatagramSocket</p>\n<p>&#x5728;JDK1.7&#x4E2D;&#x7684;NIO.2&#x9488;&#x5BF9;&#x5404;&#x4E2A;&#x901A;&#x9053;&#x63D0;&#x4F9B;&#x4E86;&#x9759;&#x6001;&#x65B9;&#x6CD5;open()<br>&#x548B;JDK1.7&#x4E2D;&#x7684;NIO.2&#x7684;Files&#x5DE5;&#x5177;&#x7C7B;&#x7684;newByteChannel()</p>\n<h3 id=\"&#x5B9E;&#x73B0;&#x7C7B;-1\"><a href=\"#&#x5B9E;&#x73B0;&#x7C7B;-1\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;&#x7C7B;\"></a>&#x5B9E;&#x73B0;&#x7C7B;</h3><ul>\n<li>FileChannel</li>\n<li>SocketChannel</li>\n<li>ServerSocketChannel</li>\n<li>DatagramChannel</li>\n</ul>\n<h3 id=\"&#x901A;&#x9053;&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4F20;&#x8F93;\"><a href=\"#&#x901A;&#x9053;&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4F20;&#x8F93;\" class=\"headerlink\" title=\"&#x901A;&#x9053;&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4F20;&#x8F93;\"></a>&#x901A;&#x9053;&#x4E4B;&#x95F4;&#x7684;&#x6570;&#x636E;&#x4F20;&#x8F93;</h3><ul>\n<li>transferFrom()</li>\n<li>transferTo()</li>\n</ul>\n<h3 id=\"&#x5206;&#x6563;&#x4E0E;&#x805A;&#x96C6;\"><a href=\"#&#x5206;&#x6563;&#x4E0E;&#x805A;&#x96C6;\" class=\"headerlink\" title=\"&#x5206;&#x6563;&#x4E0E;&#x805A;&#x96C6;\"></a>&#x5206;&#x6563;&#x4E0E;&#x805A;&#x96C6;</h3><ul>\n<li><p>&#x5206;&#x6563;(Scatter)</p>\n<p>&#x5206;&#x6563;&#x8BFB;&#x53D6;(Scattering Reads)&#xFF1A;&#x5C06;&#x901A;&#x9053;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5206;&#x6563;&#x5230;&#x591A;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#x4E2D;</p>\n</li>\n<li><p>&#x805A;&#x96C6;(Gather)</p>\n<p>&#x805A;&#x96C6;&#x5199;&#x5165;(Gathering Writes)&#xFF1A;&#x5C06;&#x591A;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x805A;&#x96C6;&#x5230;&#x901A;&#x9053;&#x4E2D;</p>\n</li>\n</ul>\n<h3 id=\"&#x5B57;&#x7B26;&#x96C6;-Charest\"><a href=\"#&#x5B57;&#x7B26;&#x96C6;-Charest\" class=\"headerlink\" title=\"&#x5B57;&#x7B26;&#x96C6;(Charest)\"></a>&#x5B57;&#x7B26;&#x96C6;(Charest)</h3><ul>\n<li><p>&#x7F16;&#x7801;</p>\n<p>&#x5B57;&#x7B26;&#x4E32; -&gt; &#x5B57;&#x8282;&#x6570;&#x7EC4;</p>\n</li>\n<li><p>&#x89E3;&#x7801;</p>\n<p>&#x5B57;&#x8282;&#x6570;&#x7EC4; -&gt; &#x5B57;&#x7B26;&#x4E32;</p>\n</li>\n</ul>\n<h2 id=\"Selector\"><a href=\"#Selector\" class=\"headerlink\" title=\"Selector\"></a>Selector</h2></body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"IO","path":"tags/IO/"}],"excerpt":"<html><head></head><body><h2 id=\"Buffer\"><a href=\"#Buffer\" class=\"headerlink\" title=\"Buffer\"></a>Buffer</h2><p>&#x8D1F;&#x8D23;&#x6570;&#x636E;&#x7684;&#x5B58;&#x53D6;&#x3002;&#x7F13;&#x51B2;&#x533A;&#x53CA;&#x65F6;&#x6570;&#x7EC4;&#x3002;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x4E0D;&#x540C;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x3002;&#xFF08;boolean&#x9664;&#x5916;&#xFF09;<br>&#x901A;&#x8FC7;allocate()&#x83B7;&#x53D6;&#x7F13;&#x51B2;&#x533A;<br>put()&#xFF0C;get()<br>&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x7684;&#x6838;&#x5FC3;&#x5C5E;&#x6027;<br>capacity:&#x5BB9;&#x91CF;&#xFF0C;&#x8868;&#x793A;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x6700;&#x5927;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x7684;&#x5BB9;&#x91CF;&#x3002;&#x4E00;&#x65E6;&#x7533;&#x660E;&#x4E0D;&#x80FD;&#x6539;&#x53D8;&#x3002;<br>limit:&#x754C;&#x9650;&#xFF0C;&#x8868;&#x793A;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x53EF;&#x4EE5;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x7684;&#x5927;&#x5C0F;&#x3002;limit&#x540E;&#x7AEF;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x80FD;&#x8FDB;&#x884C;&#x8BFB;&#x5199;&#x3002;<br>position:&#x4F4D;&#x7F6E;&#xFF0C;&#x8868;&#x793A;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x6B63;&#x5728;&#x64CD;&#x4F5C;&#x7684;&#x4F4D;&#x7F6E;&#x3002;<br>0&lt;=mark&lt;=posiotion&lt;=limit&lt;=capacity<br>flip() &#x5207;&#x6362;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x6A21;&#x5F0F;<br>rewind() &#x53EF;&#x91CD;&#x590D;&#x8BFB;<br>clear()&#x6E05;&#x7A7A;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x6570;&#x636E;&#x5E76;&#x6CA1;&#x6709;&#x88AB;&#x6E05;&#x7A7A;<br>mark:&#x6807;&#x8BB0;&#xFF0C;&#x8868;&#x793A;&#x8BB0;&#x5F55;&#x5F53;&#x524D;position&#x7684;&#x4F4D;&#x7F6E;&#x3002;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;reset()&#x6062;&#x590D;&#x5230;mark&#x7684;&#x4F4D;&#x7F6E;&#x3002;<br>hasRemaining()&#xFF1A;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x662F;&#x5426;&#x8FD8;&#x6709;&#x5269;&#x4F59;&#x7684;&#x6570;&#x636E;</p></body></html>","more":"<h3 id=\"å®ç°ç±»\"><a href=\"#å®ç°ç±»\" class=\"headerlink\" title=\"å®ç°ç±»\"></a>å®ç°ç±»</h3><ul>\n<li>ByteBuffer</li>\n<li>CharBuffer</li>\n<li>ShortBuffer</li>\n<li>IntBuffer</li>\n<li>LongBuffer</li>\n<li>FloatBuffer</li>\n<li>DoubleBuffer</li>\n</ul>\n<h3 id=\"ç›´æ¥ç¼“å†²åŒº-amp-éç›´æ¥ç¼“å†²åŒº\"><a href=\"#ç›´æ¥ç¼“å†²åŒº-amp-éç›´æ¥ç¼“å†²åŒº\" class=\"headerlink\" title=\"ç›´æ¥ç¼“å†²åŒº&amp;éç›´æ¥ç¼“å†²åŒº\"></a>ç›´æ¥ç¼“å†²åŒº&amp;éç›´æ¥ç¼“å†²åŒº</h3><p>å¯ä»¥é€šè¿‡isDirect()åˆ¤æ–­æ˜¯å¦ä¸ºç›´æ¥ç¼“å†²åŒº&amp;éç›´æ¥ç¼“å†²åŒº</p>\n<ul>\n<li><p>ç›´æ¥ç¼“å†²åŒº(ç‰©ç†å†…å­˜æ˜ å°„æ–‡ä»¶)</p>\n<p>é€šè¿‡allocateDirec()æ–¹æ³•åˆ†é…ç›´æ¥ç¼“å†²åŒºï¼Œå°†ç¼“å†²åŒºå»ºç«‹åœ¨ç‰©ç†å†…å­˜ä¸­ã€‚<br>å¯ä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚</p>\n<p>ç‰©ç†ç£ç›˜-å†…æ ¸åœ°å€ç©ºé—´-ç‰©ç†å†…å­˜æ˜ å°„æ–‡ä»¶-ç”¨æˆ·åœ°å€ç©ºé—´-åº”ç”¨ç¨‹åº</p>\n</li>\n<li><p>éç›´æ¥ç¼“å†²åŒº</p>\n<p>é€šè¿‡allocatie()æ–¹æ³•åˆ†é…ç¼“å†²åŒºï¼Œå°†ç¼“å†²åŒºå»ºç«‹åœ¨JVMçš„å†…å­˜ä¸­ã€‚</p>\n<p>ç£ç›˜-å†…æ ¸åœ°å€ç©ºé—´-ç”¨æˆ·åœ°å€ç©ºé—´-åº”ç”¨ç¨‹åº</p>\n</li>\n</ul>\n<h2 id=\"Channel\"><a href=\"#Channel\" class=\"headerlink\" title=\"Channel\"></a>Channel</h2><p>è´Ÿè´£ç¼“å†²åŒºä¸­çš„æ•°æ®ä¼ è¾“ã€‚Channelæœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œå› æ­¤éœ€è¦é…åˆç¼“å†²åŒºè¿›è¡Œä¼ è¾“ã€‚<br>é’ˆå¯¹æ”¯æŒé€šé“çš„æ³ªæä¾›äº†getChannel()æ–¹æ³•ï¼š<br>æœ¬åœ°IOï¼š<br>FileInputStream/FileOutputStream<br>RandomAccessFile<br>ç½‘è·¯IOï¼š<br>Socket<br>SeverSocket<br>DatagramSocket</p>\n<p>åœ¨JDK1.7ä¸­çš„NIO.2é’ˆå¯¹å„ä¸ªé€šé“æä¾›äº†é™æ€æ–¹æ³•open()<br>å’‹JDK1.7ä¸­çš„NIO.2çš„Fileså·¥å…·ç±»çš„newByteChannel()</p>\n<h3 id=\"å®ç°ç±»-1\"><a href=\"#å®ç°ç±»-1\" class=\"headerlink\" title=\"å®ç°ç±»\"></a>å®ç°ç±»</h3><ul>\n<li>FileChannel</li>\n<li>SocketChannel</li>\n<li>ServerSocketChannel</li>\n<li>DatagramChannel</li>\n</ul>\n<h3 id=\"é€šé“ä¹‹é—´çš„æ•°æ®ä¼ è¾“\"><a href=\"#é€šé“ä¹‹é—´çš„æ•°æ®ä¼ è¾“\" class=\"headerlink\" title=\"é€šé“ä¹‹é—´çš„æ•°æ®ä¼ è¾“\"></a>é€šé“ä¹‹é—´çš„æ•°æ®ä¼ è¾“</h3><ul>\n<li>transferFrom()</li>\n<li>transferTo()</li>\n</ul>\n<h3 id=\"åˆ†æ•£ä¸èšé›†\"><a href=\"#åˆ†æ•£ä¸èšé›†\" class=\"headerlink\" title=\"åˆ†æ•£ä¸èšé›†\"></a>åˆ†æ•£ä¸èšé›†</h3><ul>\n<li><p>åˆ†æ•£(Scatter)</p>\n<p>åˆ†æ•£è¯»å–(Scattering Reads)ï¼šå°†é€šé“ä¸­çš„æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªç¼“å†²åŒºä¸­</p>\n</li>\n<li><p>èšé›†(Gather)</p>\n<p>èšé›†å†™å…¥(Gathering Writes)ï¼šå°†å¤šä¸ªç¼“å†²åŒºä¸­çš„æ•°æ®èšé›†åˆ°é€šé“ä¸­</p>\n</li>\n</ul>\n<h3 id=\"å­—ç¬¦é›†-Charest\"><a href=\"#å­—ç¬¦é›†-Charest\" class=\"headerlink\" title=\"å­—ç¬¦é›†(Charest)\"></a>å­—ç¬¦é›†(Charest)</h3><ul>\n<li><p>ç¼–ç </p>\n<p>å­—ç¬¦ä¸² -&gt; å­—èŠ‚æ•°ç»„</p>\n</li>\n<li><p>è§£ç </p>\n<p>å­—èŠ‚æ•°ç»„ -&gt; å­—ç¬¦ä¸²</p>\n</li>\n</ul>\n<h2 id=\"Selector\"><a href=\"#Selector\" class=\"headerlink\" title=\"Selector\"></a>Selector</h2>"},{"title":"Spring Boot","date":"2020-01-29T12:57:11.000Z","_content":"\n## å®¹å™¨\n\n### IOC\n<!-- more -->\nspring-context\n\n- @Configuration\n\n  å‘Šè¯‰Springè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»\n\n- @Bean\n\n  ç»™å®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªBeanï¼Œç±»å‹ä¸ºè¿”å›å€¼çš„ç±»å‹ï¼Œidé»˜è®¤æ˜¯ç”¨æ–¹æ³•\n  é»˜è®¤éƒ½æ˜¯å•ä¾‹\n\n- AnnotationConfigApplicationContext\n- @ComponetScanã€@ComponetScans\n\n  valueï¼šæ‰«æ@Service @Controller @Repositroy @Componet\n  excludeFltersï¼šæ’é™¤çš„è§„åˆ™\n  includeFiltersï¼šåªéœ€è¦åŒ…å«çš„è§„åˆ™\n\n\t- FilterType.ANNOTATION\n\n\t  æŒ‰ç…§æ³¨è§£\n\n\t- FilterType.ASSIGNABLE_TYPE\n\n\t  æŒ‰ç…§ç»™å®šç±»å‹\n\n\t- FilterType.ASPECTJ\n\n\t  ä½¿ç”¨ASPECTJè¡¨è¾¾å¼\n\n\t- FilterType.REGEX\n\n\t  ä½¿ç”¨æ­£åˆ™æŒ‡å®š\n\n\t- FilterType.CUSTOM\n\n\t  è‡ªå®šä¹‰è§„åˆ™ï¼Œå¿…é¡»å®ç°TypeFilterç±»\n\n- @Scope\n\n\t- SCOPE_PROTOTPE\n\n\t  å¤šå®ä¾‹\n\t  IOCå®¹å™¨å¯åŠ¨ä¸å›å»è°ƒç”¨æ–¹æ³•åºŠæ¶ä½ å¯¹è±¡ï¼Œè·å–çš„æ—¶å€™åˆ›å»ºå¯¹è±¡\n\n\t- SCOPE_SINGLETON\n\n\t  å•å®ä¾‹ï¼ˆé»˜è®¤å€¼ï¼‰\n\t  IOCå®¹å™¨å¯åŠ¨ä¼šè°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡æ”¾åˆ°IOCå®¹å™¨ä¸­\n\n\t- SCOPE_REQUEST\n\n\t  åŒä¸€æ¬¡è¯·æ±‚åˆ›å»ºä¸€ä¸ªå®ä¾‹\n\n\t- SCOPE_SESSION\n\n\t  åŒä¸€ä¸ªSessionåˆ›å»ºä¸€ä¸ªå®ä¾‹\n\n- @Lazy \n\n  æ‡’åŠ è½½ï¼šå®¹å™¨å¯åŠ¨ä¸åˆ›å»ºå¯¹è±¡ã€‚ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼ˆè·å–ï¼‰Beanå¯¹è±¡æ—¶è°ƒç”¨åˆ›å»ºå¯¹è±¡æ”¾å…¥å®¹å™¨\n\n- @Conditional\n\n  æŒ‰ç…§ä¸€å®šçš„æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œæ»¡è¶³æ¡ä»¶ç»™å®¹å™¨ä¸­æ³¨å†ŒBean\n  éœ€è¦å®ç°Condition æ¥å£ï¼šConditionContext åˆ¤æ–­æ¡ä»¶èƒ½ä½¿ç”¨çš„ä¸Šä¸‹æ–‡ï¼›AnnotatedTypeMetadate æ³¨é‡Šä¿¡æ¯\n\n- @Import\n\n  å¯¼å…¥ç»„ä»¶ï¼Œidé»˜è®¤æ˜¯ç»„ä»¶çš„å…¨ç±»åï¼ˆcom.xxx.xxx.xxï¼‰\n\n\t- ImportSelector\n\n\t  è‡ªå®šä¹‰é€»è¾‘è¿”å›éœ€è¦å¯¼å…¥çš„ç»„ä»¶ã€‚\n\t  è¿”å›å€¼å°±æ˜¯å¯¼å…¥åˆ°å®¹å™¨ä¸­çš„ç»„ä»¶å…¨ç±»åï¼Œæ–¹æ³•ä¸è¦è¿”å›nullã€‚\n\t  AnnotationMetadata å½“å‰æ ‡æ³¨@Importæ³¨è§£çš„ç±»çš„æ‰€æœ‰æ³¨é‡Šä¿¡æ¯ã€‚\n\n\t- ImportBeanDefinitionRegistrar\n\n\t  BeanDefinitionRegistryï¼šBeanDefinitionæ³¨å†Œç±»ã€‚\n\t  è°ƒç”¨registerBeanDefinitionæ‰‹å·¥æ³¨å†ŒBean\n\n- FactoryBean\n\n  å®ç°FactoryBeanæ¥å£\n  1.å·¥å‚Beanè·å–çš„æ˜¯è°ƒç”¨getObjectåˆ›å»ºçš„å¯¹è±¡\n  2.è¦è·å–å·¥ç¨‹Beanæœ¬èº«ï¼Œéœ€è¦ç»™idå‰é¢åŠ ä¸€ä¸ª&\n\n### beançš„ç”Ÿå‘½å‘¨æœŸ\n\n- åˆå§‹åŒ–\n\n\t- @Bean(initMethod)\n\t- InitializingBean\n\n\t  é€šè¿‡è®©Beanå®ç°è¯¥æ¥å£ï¼Œå®ç°Beanåˆå§‹åŒ–é€»è¾‘\n\n\t- @PostConstruct\n\t- BeanPostProcessor\n\n\t  Beanåç½®å¤„ç†å™¨ï¼Œåœ¨Beanåˆå§‹åŒ–å‰åè¿›è¡Œä¸€äº›å¤„ç†å·¥ä½œ\n\n\t\t- postProcessBeforeInitialization\n\n\t\t  åœ¨åˆå§‹åŒ–ä¹‹å‰\n\n\t\t- postProcessAfterInitialization\n\n\t\t  åœ¨åˆå§‹åŒ–å·¥ä½œä¹‹å\n\n\t\t- ApplicationContextAwareProcessor\n\n\t\t  å®ç°è¯¥æ¥å£ï¼ŒSpringå®¹å™¨å¯ä»¥å°†å½“å‰å®¹å™¨ä¼ ç»™å®ç°ç±»\n\n\t\t- InitDestroyAnnotationBeanPostProcessor\n\n\t\t  å¤„ç†@PostConstructï¼Œ@PreDestoryæ³¨è§£\n\n\t\t- AutowiredAnnotationBeanPostProcessor\n\n\t\t  å¤„ç†@Autowiredæ³¨è§£\n\n- é”€æ¯\n\n\t- @Bean(destroyMethod)\n\n\t  å¤šå®ä¾‹çš„beanï¼Œå®¹å™¨ä¸ä¼šè°ƒç”¨é”€æ¯æ–¹æ³•\n\n\t- DisposableBean\n\n\t  é€šè¿‡å®ç°è¯¥æ¥å£ï¼Œå®ç°é”€æ¯é€»è¾‘\n\n\t- @PreDestory\n\n### å±æ€§èµ‹å€¼\n\n- @Value\n\n\t- åŸºæœ¬æ•°å€¼\n\t- SpEL  #{}\n\t- é…ç½®æ–‡ä»¶ ${}\n\n\t  @PropertySource è¯»å–å¤–éƒ¨é…ç½®æ–‡ä»¶ï¼Œä¿å­˜è‡³ç¯å¢ƒå˜é‡ä¸­\n\n### è‡ªåŠ¨è£…é…\n\n- @Autowired\n\n  1.é»˜è®¤æŒ‰ç…§ç±»å‹åœ¨å®¹å™¨ä¸­æ‰¾ç›¸åº”çš„ç»„ä»¶\n  2.å¦‚æœæ‰¾åˆ°å¤šä¸ªç›¸åŒç±»å‹çš„ç»„ä»¶ï¼Œå†å°†å±æ€§çš„åç§°ä½œä¸ºç»„ä»¶çš„idç»„å®¹æ˜“ä¸­å¯»æ‰¾\n  3.ä½¿ç”¨@QualifieræŒ‡å®šéœ€è¦è£…é…çš„ç»„ä»¶çš„id\n  4.è‡ªåŠ¨è£…é…é»˜è®¤ä¸€å®šè¦æŒ‡å®šå­˜åœ¨çš„å±æ€§ï¼ˆå¦‚æœä¸å¼ºåˆ¶æŒ‡å®šï¼Œä½¿ç”¨require=falseï¼‰\n  5.@Primary,è®©Springè¿›è¡Œè‡ªåŠ¨è£…é…çš„æ—¶å€™ï¼Œé»˜è®¤æ˜¯ç”¨é¦–é€‰çš„bean\n\n\t- æ„é€ å™¨\n\n\t  æ„é€ å™¨ç”¨åˆ°çš„è‡ªå®šä¹‰ç±»å‹çš„å€¼ä»IOCå®¹å™¨ä¸­è·å–\n\t  å¦‚æœç»„å»ºåªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨ï¼Œè¿™ä¸ªæœ‰å‚æ„é€ å™¨çš„@Autowiredå¯ä»¥çœç•¥ï¼Œå‚æ•°ä½ç½®çš„ç»„ä»¶è¿˜æ˜¯å¯ä»¥ä»å®¹å™¨ä¸­è·å–\n\n\t- æ–¹æ³•\n\n\t  æ ‡æ³¨åœ¨æ–¹æ³•ï¼ŒSpringå®¹å™¨åˆ›å»ºå½“å‰å¯¹è±¡ï¼Œå°±ä¼šè°ƒç”¨æ–¹æ³•å®Œæˆèµ‹å€¼\n\t  æ–¹æ³•ä½¿ç”¨çš„å‚æ•°ï¼Œè‡ªå®šä¹‰ç±»å‹çš„å€¼ä»IOCå®¹å™¨ä¸­è·å–\n\n\t- å±æ€§\n\n\t  å€¼ä»IOCå®¹å™¨ä¸­è·å–\n\n- @Resource\n\n  å¯ä»¥å’Œ@Autowiredä¸€æ ·å®ç°è‡ªåŠ¨è£…é…ï¼Œé»˜è®¤æŒ‰ç…§å±æ€§åç§°è¿›è¡Œè£…é…\n  æ²¡æœ‰æ”¯æŒ@PrimaryåŠŸèƒ½ï¼Œreqiured=false\n\n- @Inject\n\n  éœ€è¦ä¾èµ–javax.injectåŒ…ï¼Œå’ŒAutowiredä¸€æ ·ï¼Œæ²¡æœ‰reqiured=false\n\n- å®ç°xxxAwareæ¥å£\n\n  åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨æ¥å£çš„å›è°ƒæ–¹æ³•\n  æŠŠSpringåº•å±‚çš„ç»„ä»¶æ³¨å†Œåˆ°è‡ªå®šä¹‰çš„Beanä¸­\n  xxxAwareåŠŸèƒ½ä½¿ç”¨xxxProcessorå¤„ç†çš„\n\n\t- ApplicationContextAware\n\n\t  è·å–ApplicationContext\n\n\t- BeanNameAware\n\t- EmbeddedValueResolverAware\n\n- Profile\n\n  åŠ äº†ç¯å¢ƒè¡¨ç¤ºçš„beanï¼Œåªæœ‰è¿™ä¸ªç¯å¢ƒè¢«æ¿€æ´»çš„æ—¶å€™æ‰èƒ½æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œé»˜è®¤æ˜¯defaultç¯å¢ƒ\n\n\t- å¯åŠ¨å‚æ•°\n\n\t  -Dspring.profiles.active=xxx\n\n\t- ä»£ç \n\n\t  1.åˆ›å»ºä¸€ä¸ªaplicationContext\n\t  2.è®¾ç½®éœ€è¦æ¿€æ´»çš„ç¯å¢ƒ.getEnvironment().setActiveProfiles()\n\t  3.æ³¨å†Œæœ±é…ç½®ç±»  .register()\n\t  4.å¯åŠ¨åˆ·æ–°å®¹å™¨ .refresh()\n\n### AOP\n\nåœ¨ç¨‹åºè¿è¡ŒæœŸé—´åŠ¨æ€çš„å°†æŸæ®µä»£ç åˆ‡å…¥åˆ°æŒ‡å®šæ–¹æ³•æŒ‡å®šä½ç½®è¿›è¡Œè¿è¡Œçš„ç¼–ç¨‹æ–¹å¼\nspring-aspects\nå®¹å™¨ä¸­ä¿å­˜äº†ç»„å»ºçš„ä»£ç†å¯¹è±¡(cglibå¢å¼ºåçš„å¯¹è±¡),è¿™ä¸ªå¯¹è±¡é‡Œé¢ä¿å­˜äº†è¯¦ç»†ä¿¡æ¯(æ¯”å¦‚å¢å¼ºå™¨ï¼Œç›®æ ‡å¯¹è±¡)\n\n- @Before\n\n  åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰åˆ‡å…¥ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ˆæŒ‡å®šåœ¨é‚£ä¸ªæ–¹æ³•åˆ‡å…¥ï¼‰\n\n- @After\n\n  åœ¨ç›®æ ‡æ–¹æ³•ä¹‹ååˆ‡å…¥ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼\n\n- @PointCut\n\n  åˆ‡å…¥ç‚¹è¡¨è¾¾å¼\n\n- @AfterReturning\n\n  å†æ”¾æ ‡æ–¹æ³•æ­£å¸¸è¿”å›ä¹‹åè¿è¡Œ\n\n- @AfterThrowing\n\n  åœ¨ç›®æ ‡æ–¹æ³•å‡ºç°å¼‚å¸¸ä¹‹åè¿è¡Œ\n\n- @Aspect\n\n  å‘Šè¯‰Springå½“å‰ç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»\n\n- @EnableAspectJAutoProxy\n\n  å¼€å¯åŸºäºæ³¨è§£çš„AOP\n  1.ç»™å®¹å™¨ä¸­å¯¼å…¥AspectJAutoProxyRegistrarï¼Œç»™å®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªAnnotationAwareAspectJAutoProxyCreator\n\n\t- AnnotationAwareAspectJAutoProxyCreator\n\n\t\t- AspectJAwareAdvisorAutoProxyCreator\n\n\t\t\t- AbstractAdvisorAutoProxyCreator\n\n\t\t\t\t- AbstractAutoProxyCreator\n\n\t\t\t\t\t- SmartInstantiationAwareBeanPostProcessor\n\t\t\t\t\t- BeanFactroyAware\n\n- JoinPoint\n\n  JoinPointä¸€å®šè¦å‡ºç°åœ¨å‚æ•°è¡¨çš„ç¬¬ä¸€ä½\n\n- ç›®æ ‡æ–¹æ³•æ‰§è¡Œ\n\n  1.CglibAopProxy.intercept()ã€‚æ‹¦æˆªç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œã€‚\n  2.æ ¹æ®PoxyFactoryå¯¹è±¡è·å–å°†è¦æ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•æ‹¦æˆªå™¨é“¾\n  \ta)å¦‚æœæ²¡æœ‰æ‹¦æˆªå™¨é“¾ï¼Œç›´æ¥æ‰§è¡Œç›®æ ‡æ–¹æ³•\n  \tb)å¦‚æœæœ‰æ‹¦æˆªå™¨é“¾ï¼ŒæŠŠéœ€è¦æ‰§è¡Œçš„ç›®æ ‡å¯¹è±¡ï¼Œç›®æ ‡æ–¹æ³•ï¼Œæ‹¦æˆªå™¨é“¾ç­‰ä¿¡æ¯å‡ºå…¥åˆ›å»ºä¸€ä¸ªCglibMethodInvocationï¼Œå¹¶è°ƒç”¨proceed()æ–¹æ³•\n  \tc)æ‹¦æˆªå™¨é“¾è§¦å‘è¿‡ç¨‹\n  \t\t1.å¦‚æœæ²¡æœ‰æ‹¦æˆªå™¨æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œæˆ–è€…æ‡’æœºå™¨çš„ç´¢å¼•å’Œæ‹¦æˆªå™¨æ•°ç»„-1å¤§å°ä¸€æ ·(æŒ‡å®šåˆ°äº†æœ€åä¸€ä¸ªæ‹¦æˆªå™¨)ï¼Œæ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚\n\n### å£°æ˜å¼äº‹åŠ¡\n\n1.å¯¼å…¥ç›¸å…³ä¾èµ–spring-jdbc\n2.é…ç½®æ•°æ®æº JdbcTmplate\n3.ç»™æ–¹æ³•æ ‡æ³¨@Transactional\n4.@EnableTransactionManagement å¼€å¯åŸºäºæ³¨è§£çš„äº‹ç‰©\n5.é…ç½®äº‹ç‰©ç®¡ç†å™¨ç®¡ç†äº‹ç‰©\n\n- @Transactional\n- @EnableTransactionManagement\n\n\t- TransactionManagementConfigurationSelection\n\n\t  ç»™å®¹å™¨ä¸­å¯¼å…¥ç»„ä»¶\n\n\t\t- AutoProxyRegistrar\n\n\t\t  ç»™å®¹å™¨ä¸­æ³¨å†ŒInfrastructureAdvisorAutoProxyCreatorç»„ä»¶\n\n\t\t\t- InfrastructureAdvisorAutoProxyCreator\n\n\t\t\t  åˆ©ç”¨åç½®å¤„ç†å™¨æœºåˆ¶åœ¨å¯¹è±¡åˆ›å»ºåï¼ŒåŒ…è£…å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆå¢å¼ºå™¨ï¼‰ï¼Œä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³•åˆ©ç”¨æ‹¦æˆªå™¨é“¾æ‰§è¡Œæ–¹æ³•\n\n\t\t- ProxyTransactionManagementConfiguration\n\n\t\t  1.ç»™å®¹å™¨ä¸­æ³¨å†Œäº‹ç‰©å¢å¼ºå™¨\n\t\t  \täº‹ç‰©å¢å¼ºå™¨è¦ç”¨äº‹ç‰©æ³¨è§£ä¿¡æ¯\n\t\t  \täº‹ç‰©æ‹¦æˆªå™¨ï¼Œä¿å­˜äº†äº‹ç‰©çš„å±æ€§ä¿¡æ¯ï¼Œäº‹ç‰©ç®¡ç†å™¨ï¼Œæ˜¯ä¸€ä¸ªMethodInterceptorï¼Œåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œæ—¶æ‰§è¡Œæ‹¦æˆªå™¨é“¾\n\n## æ‰©å±•åŸç†\n\n### BeanFactoryPostProcessor\n\nBeanFactoryåç½®å¤„ç†å™¨\n\tåœ¨BeanFactoryæ ‡å‡†åˆå§‹åŒ–ä¹‹åè°ƒç”¨ï¼Œæ‰€æœ‰çš„beanå®šä¹‰ä»¥ä¿å­˜åœ¨é­åˆ°beanFactoryï¼Œä½†æ˜¯beanè¿˜æœªåˆ›å»º\n\n- BeanDefinitionRegistryPostProcessor\n\n  åœ¨æ‰€æœ‰beanå®šä¹‰ä¿¡æ¯å°†è¦è¢«åŠ è½½ï¼Œbeanå®åŠ›è¿˜æœªè¢«åˆ›å»ºæ—¶æ‰§è¡Œ\n\n### ApplicationListener\n\nç›‘å¬å®¹å™¨ä¸­å‘å¸ƒçš„äº‹ä»¶\n\t1.å†™ä¸€ä¸ªç›‘å¬å™¨ï¼ŒApplicationListenerå®ç°ç±»ï¼Œæ¥ç›‘å¬æŸä¸ªäº‹ä»¶ApplicationEventæœºå™¨å­ç±»\n\t2.æŠŠç›‘å¬å™¨åŠ å…¥åˆ°å®¹å™¨\n\t3.åªè¦å®¹å™¨ä¸­æœ‰ç›¸å…³äº‹ä»¶çš„è…¹éƒ¨ï¼Œæˆ‘ä»¬å°±èƒ½ç›‘å¬åˆ°è¿™ä¸ªäº‹ä»¶ï¼š\n\t\tContextRefreshedEventï¼šå®¹å™¨èˆ’å¿ƒå®Œæˆ(æ‰€æœ‰beanéƒ½å®Œå…¨åˆ›å»º)ä¼šå‘å¸ƒè¿™ä¸ªäº‹ä»¶ï¼›\n\t\tContextClosedEventï¼šå…³é—­å®¹å™¨ä¼šå‘å¸ƒè¿™ä¸ªäº‹ä»¶\n\t4.å‘å¸ƒä¸€ä¸ªäº‹ä»¶ï¼ŒapplicationContext.publishEvent()\n\n### å®¹å™¨çš„åˆ›å»º\n\n1.Springå®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå…ˆä¼šä¿å­˜æ‰€æœ‰æ³¨å†Œè¿›æ¥çš„Beançš„å®šä¹‰ä¿¡æ¯\n\txml\n\tæ³¨è§£\n2.Springå®¹å™¨ä¼šåˆé€‚çš„æ—¶æœºåˆ›å»ºè¿™äº›Bean\n\tç”¨åˆ°è¿™ä¸ªbeançš„æ—¶å€™ï¼Œåˆ©ç”¨getBeanåˆ›å»ºbeanï¼Œåˆ›å»ºå¥½ä»¥åä¿å­˜åœ¨å®¹å™¨ä¸­\n\tç»Ÿä¸€åˆ›å»ºå‰©ä¸‹æ‰€æœ‰çš„beançš„æ—¶å€™ï¼ŒfinshBeanFactoryInitialization()\n3.åç½®å¤„ç†å™¨\n\tæ¯ä¸ªbeanåˆ›å»ºå®Œæˆï¼Œéƒ½ä¼šä½¿ç”¨å„ç§åç½®å¤„ç†å™¨ï¼Œæ¥å¢å¼ºbeançš„åŠŸèƒ½\n4.äº‹ä»¶é©±åŠ¨æ¨¡å‹\n\tApplicationListenerï¼Œäº‹ä»¶ç›‘å¬\näº‹ä»¶æ´¾å‘ï¼ŒApplicationEvenMulticator\n\n- refresh()\n\n\t- prepareRefresh()\n\n\t  åˆ·æ–°é¢„å¤„ç†å·¥ä½œ:\n\t  æ¸…ç¼“å­˜\n\t  ç½®çŠ¶æ€\n\n\t\t- initPropertySources()\n\n\t\t  åˆå§‹åŒ–å±æ€§è®¾ç½®ï¼Œå­ç±»è‡ªå®šä¹‰ä¸ªæ€§åŒ–çš„å±æ€§è®¾ç½®æ–¹æ³•ã€‚\n\n\t\t- getEnvironment().validateRequiredProperties()\n\n\t\t  æ£€éªŒå±æ€§çš„åˆæ³•\n\n\t\t- earlyApplicationEvents\n\n\t\t  ä¿å­˜å®¹å™¨ä¸­çš„ä¸€èµ·æ—©èµ·äº‹ä»¶\n\n\t- obtainFreshBeanFactory()\n\n\t  è·å–BeanFactory\n\n\t\t- refreshBeanFactory()\n\n\t\t  åˆ·æ–°BeanFactoryå·¥å‚ï¼Œåˆ›å»ºBeanFactoryå¯¹è±¡ã€‚\n\n\t\t- getBeanFactory()ã€DefaultListableBeanFactoryã€‘\n\n\t\t  è·å–ä¹‹å‰åˆ›å»ºå¥½çš„BeanFactory\n\n\t\t- prepareBeanFactory()\n\n\t\t  BeanFactoryçš„é¢„å‡†å¤‡å·¥ä½œï¼ˆBeanFactoryè¿›è¡Œä¸€äº›è®¾ç½®ï¼‰\n\t\t  1.è®¾ç½®BeanFactoryçš„ç±»åŠ è½½å™¨ï¼Œæ”¯æŒè¡¨è¾¾å¼è§£æå™¨ã€‚ã€‚ã€‚\n\t\t  2.æ·»åŠ éƒ¨åˆ†BeanPostProcessorã€ApplicationContextAwareProcessorã€‘\n\t\t  3.è®¾ç½®å¿½ç•¥çš„è‡ªåŠ¨è£…é…çš„æ¥å£ï¼ŒEnvironmentAwareã€EmbeddedValueResolverAwareã€‚ã€‚ã€‚\n\t\t  4.æ³¨å†Œå¯ä»¥è§£æçš„è‡ªåŠ¨è£…é…ï¼Œæˆ‘ä»¬èƒ½ç›´æ¥åœ¨ä»å’Œç»„ä»¶ä¸­è‡ªåŠ¨æ³¨å…¥ï¼šBeanFactoryã€ResourceLoaderã€ApplicationEventPublisherã€ApplicationContext\n\t\t  5.æ·»åŠ BeanPostProcessorã€ApplicationListenerDetectorã€‘\n\t\t  6.æ·»åŠ ç¼–è¯‘æ˜¯çš„AspectJæ”¯æŒ\n\t\t  7.ç»™BeanFactoryä¸­æ³¨å†Œä¸€äº›èƒ½ç”¨çš„ç»„ä»¶ï¼šenvironmentã€ConfigurableEnvironmentã€‘ã€systemPropertiesã€Mapã€‘\n\n\t\t- postProcessBeanFactory()\n\n\t\t  BeanFactoryå‡†å¤‡å®Œæˆåçš„åç½®å¤„ç†å·¥ä½œï¼Œå­ç±»ç”¨è¿‡é‡å†™è¿™ä¸ªå‘æ–¹æ³•æ¥åœ¨BeanFactoryåˆå§‹åŒ–å®Œæˆåè¿›è¡Œæ›´è¿›ä¸€æ­¥çš„å·¥ä½œ\n\n\t\t- invokeBeanFactoryPostProcessors()\n\n\t\t  æ‰§è¡ŒBeanFactoryPostProcessorï¼šBeanFactoryçš„åç½®å¤„ç†å™¨ï¼Œåœ¨BeanFactoryæ ‡å‡†åˆå§‹åŒ–ä¹‹åæ‰§è¡Œ\n\t\t  \n\t\t  æ‰§è¡ŒBeanFactoryPostProcessorçš„æ–¹æ³•ï¼š\n\t\t  1.å…ˆæ‰§è¡ŒBeanDefinitonRegistryPostProcessor\n\t\t  \tè·å–æ‰€æœ‰çš„BeanDefinitonRegistryPostProcessor\n\t\t  \tå…ˆæ‰§è¡Œå®ç°äº†PriorityOrderedæ¥å£çš„\n\t\t  \tå†æ‰§è¡Œå®ç°äº†Orderedæ¥å£çš„\n\t\t  \tæœ€åæ‰§è¡Œå‰©ä¸‹çš„\n\t\t  2.å†æ‰§è¡ŒBeanFactoryPostProcessorçš„æ–¹æ³•\n\t\t  \tå…ˆæ‰§è¡Œå®ç°äº†PriorityOrderedæ¥å£çš„\n\t\t  \tå†æ‰§è¡Œå®ç°äº†Orderedæ¥å£çš„\n\t\t  \tæœ€åæ‰§è¡Œå‰©ä¸‹çš„\n\n\t- registerBeanPostProcessors()\n\n\t  æ³¨å†ŒBeanPostProcessorï¼ŒBeançš„åç½®å¤„ç†å™¨ã€‚\n\t  1.è·å–æ‰€æœ‰çš„BeanPostProcessorï¼Œä¸åŒæ¥å£ç±»å‹çš„BeanPostProcessorï¼Œåœ¨Beanèˆ¹èˆ°å‰åçš„æ‰§è¡Œå®é™…æ˜¯ä¸ä¸€æ ·çš„ã€‚\n\t  \tBeanPostProcessor\n\t  \tDestructionAwareBeanPostProcessor\n\t  \tInstantiationAwareBeanPostProcessor\n\t  \tSmartInstantiationAwareBeanPostProcessor\n\t  \tMergedBeanDefinitionPostProcessor\n\n\t- initMessageSource()\n\n\t  åˆå§‹åŒ–MessageSourceç»„ä»¶ï¼ˆåšå›½é™…åŒ–åŠŸèƒ½ï¼Œæ¶ˆæ¯ç»‘å®šã€è§£æï¼‰\n\t  1.è·å–BeanFactory\n\t  2.çœ‹å®¹å™¨ä¸­æ˜¯å¦æœ‰idä¸ºmessageSourceçš„ç»„ä»¶\n\t  \tå¦‚æœæœ‰èµ‹å€¼ç»™messageSourceï¼Œå¦‚æœæ²¡æœ‰è‡ªå·±åˆ›å»ºã€DelegatingMessageSourceã€‘\n\t  3.æŠŠåˆ›å»ºå¥½çš„MessageSourceæ³¨å†Œåœ¨å®¹å™¨ä¸­\n\n\t- initApplicationEventMulticaster()\n\n\t  åˆå§‹åŒ–äº‹ä»¶æ´¾å‘å™¨\n\t  1.ä»BeanFactoryä¸­è·å–applicationEventMulticasterçš„ApplicationEventMulticaster\n\t  2.å¦‚æœæ²¡æœ‰é…ç½®ï¼Œåˆ›å»ºSimpleApplicationEventMulticaster\n\t  3.æ³¨å†Œåˆ°å®¹å™¨ä¸­\n\n\t- onRefresh()\n\n\t  ç•™ç»™å­å®¹å™¨çš„ï¼ˆå­ç±»ï¼‰\n\t  1.å­ç±»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨å®¹å™¨åˆ·æ–°çš„æ—¶å€™å¯ä»¥è‡ªå®šä¹‰é€»è¾‘\n\n\t- registerLiseners()\n\n\t  ç»™å®¹å™¨ä¸­å°†æ‰€æœ‰çš„é¡¹ç›®çš„ApplicationListeneræ³¨å†Œè¿›æ¥ã€‚\n\t  1.ä»å®¹å™¨ä¸­æ‹¿åˆ°æ‰€æœ‰ApplicationListenerç»„ä»¶\n\t  2.å°†æ¯ä¸ªç›‘å¬å™¨æ·»åŠ åˆ°äº‹ä»¶æ´¾å‘å™¨ä¸­\n\t  3.æ´¾å‘ä¹‹å‰æ­¥éª¤äº§ç”Ÿçš„äº‹ä»¶\n\n\t- finishBeanFactoryInitialization()\n\n\t  åˆå§‹åŒ–å‰©ä¸‹çš„æ‰€æœ‰å•å®ä¾‹bean\n\n\t\t- beanFactory.preInstantiateSingletons()\n\n\t\t  åˆå§‹åŒ–å‰©ä¸‹çš„å•å®ä¾‹bean\n\t\t  1.è·å–å®¹å™¨ä¸­æ‰€æœ‰çš„Beanå®šä¹‰\n\t\t  2.æ‹¿åˆ°Beançš„å®šä¹‰ä¿¡æ¯\n\t\t  3.Beanä¸æ˜¯æŠ½è±¡çš„ï¼Œæ˜¯å•å®ä¾‹çš„ï¼Œä¸æ˜¯æ‡’åŠ è½½çš„\n\t\t  \t1.åˆ¤æ–­æ˜¯å¦æ˜¯FactoryBeanï¼Œæ˜¯å¦æ˜¯å®ç°FactoryBeanæ¥å£çš„Bean\n\t\t  \t2.ä¸æ˜¯FactoryBeanï¼Œç”¨getBeanåˆ›å»ºå¯¹è±¡\n\t\t  \t3.doGetBean()\n\t\t  \t4.å…ˆè·å–ç¼“å­˜ä¸­ä¿å­˜çš„å•å®ä¾‹Beanã€‚å¦‚æœè·å–åˆ°ï¼Œè¯´æ˜è¿™ä¸ªBeanä¹‹å‰è¢«åˆ›å»ºå›½ï¼ˆæ‰€æœ‰åˆ›å»ºå›½çš„å•å®ä¾‹Beanéƒ½æ˜¯ä¼šè¢«ç¼“å­˜èµ·æ¥çš„ï¼‰\n\t\t  \t5.æ¢ç§ç§è·å–ä¸åˆ°ï¼Œå¼€å§‹Beançš„åˆ›å»ºå¯¹è±¡æµç¨‹\n\t\t  \t6.æ ‡è®°å½“å‰beanå·²ç»è¢«åˆ›å»º\n\t\t  \t7.è·å–Beançš„å®šä¹‰ä¿¡æ¯\n\t\t  \t8.è·å–å½“å‰Beanä¾èµ–çš„å…¶ä»–Beanï¼Œå¦‚æœæœ‰å°±æŒ‰ç…§getBean()æŠŠä»¥æ¥çš„Beanå…ˆåˆ›å»ºå‡ºæ¥ã€‚\n\t\t  \t9.å¯åŠ¨å•å®ä¾‹Beançš„åˆ›å»ºæµç¨‹\n\t\t  \t\t1.createBean()\n\t\t  \t\t2.resolveBeforeInstantiation()è®©BeanPostProcessorå…ˆæ‹¦æˆªè¿”å›ä»£ç†å¯¹è±¡ã€InstantiationAwareBeanPostProcessorsã€‘æå‰æ‰§è¡Œ\n\t\t  \t\t3.å¦‚æœå‰é¢çš„InstantiationAwareBeanPostProcessorsæ²¡æœ‰è¿”å›ä»£ç†å¯¹è±¡\n\t\t  \t\t4.doCreateBean()åˆ›å»ºBean\n\t\t  \t\t\t1.åˆ›å»ºBeanå®ä¾‹ï¼ŒcreateBeanInstance()åˆ©ç”¨å·¥å‚æ–¹æ³•æˆ–è€…å¯¹è±¡çš„æ„é€ å™¨åˆ›å»ºå‡ºBeanå®ä¾‹\n\t\t  \t\t\t2.applyMergedBeanDefinitionPostProcessors()ï¼Œè°ƒç”¨ã€MergedBeanDefinitionPostProcessorsã€‘\n\t\t  \t\t\t3.populateBean() Beanå±æ€§èµ‹å€¼\n\n\t- finishRefresh()\n\n\t  å®ŒæˆBeanFactoryçš„åˆå§‹åŒ–åˆ›å»ºå·¥ä½œï¼ŒIOCå®¹å™¨å°±åˆ›å»ºå®Œæˆ\n\n\t\t- initLifecycleProcessor()\n\n\t\t  åˆå§‹åŒ–å’Œç”Ÿå‘½å‘¨æœŸæœ‰å…³çš„åç½®å¤„ç†å™¨ï¼šLifecycleProcessorã€‚\n\t\t  å†™ä¸€ä¸ªLifecycleProcessorçš„å®ç°ç±»ï¼Œå¯ä»¥åœ¨BeanFactoryçš„onRefresh(),onClose()è¿›è¡Œæ‹¦æˆª\n\n\t\t- getLifecycleProcessor().onRefresh()\n\n\t\t  æ‹¿åˆ°å‰é¢å®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨ï¼Œå›è°ƒonRefresh()\n\n\t\t- publishEvent()\n\n\t\t  å‘å¸ƒå®¹å™¨å®Œæˆäº‹ä»¶","source":"_posts/Spring-Boot.md","raw":"---\ntitle: Spring Boot\ndate: 2020-01-29 20:57:11\ntags:\n    - Java\n    - Springboot\ncategories:\n    - Technology\n---\n\n## å®¹å™¨\n\n### IOC\n<!-- more -->\nspring-context\n\n- @Configuration\n\n  å‘Šè¯‰Springè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»\n\n- @Bean\n\n  ç»™å®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªBeanï¼Œç±»å‹ä¸ºè¿”å›å€¼çš„ç±»å‹ï¼Œidé»˜è®¤æ˜¯ç”¨æ–¹æ³•\n  é»˜è®¤éƒ½æ˜¯å•ä¾‹\n\n- AnnotationConfigApplicationContext\n- @ComponetScanã€@ComponetScans\n\n  valueï¼šæ‰«æ@Service @Controller @Repositroy @Componet\n  excludeFltersï¼šæ’é™¤çš„è§„åˆ™\n  includeFiltersï¼šåªéœ€è¦åŒ…å«çš„è§„åˆ™\n\n\t- FilterType.ANNOTATION\n\n\t  æŒ‰ç…§æ³¨è§£\n\n\t- FilterType.ASSIGNABLE_TYPE\n\n\t  æŒ‰ç…§ç»™å®šç±»å‹\n\n\t- FilterType.ASPECTJ\n\n\t  ä½¿ç”¨ASPECTJè¡¨è¾¾å¼\n\n\t- FilterType.REGEX\n\n\t  ä½¿ç”¨æ­£åˆ™æŒ‡å®š\n\n\t- FilterType.CUSTOM\n\n\t  è‡ªå®šä¹‰è§„åˆ™ï¼Œå¿…é¡»å®ç°TypeFilterç±»\n\n- @Scope\n\n\t- SCOPE_PROTOTPE\n\n\t  å¤šå®ä¾‹\n\t  IOCå®¹å™¨å¯åŠ¨ä¸å›å»è°ƒç”¨æ–¹æ³•åºŠæ¶ä½ å¯¹è±¡ï¼Œè·å–çš„æ—¶å€™åˆ›å»ºå¯¹è±¡\n\n\t- SCOPE_SINGLETON\n\n\t  å•å®ä¾‹ï¼ˆé»˜è®¤å€¼ï¼‰\n\t  IOCå®¹å™¨å¯åŠ¨ä¼šè°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡æ”¾åˆ°IOCå®¹å™¨ä¸­\n\n\t- SCOPE_REQUEST\n\n\t  åŒä¸€æ¬¡è¯·æ±‚åˆ›å»ºä¸€ä¸ªå®ä¾‹\n\n\t- SCOPE_SESSION\n\n\t  åŒä¸€ä¸ªSessionåˆ›å»ºä¸€ä¸ªå®ä¾‹\n\n- @Lazy \n\n  æ‡’åŠ è½½ï¼šå®¹å™¨å¯åŠ¨ä¸åˆ›å»ºå¯¹è±¡ã€‚ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼ˆè·å–ï¼‰Beanå¯¹è±¡æ—¶è°ƒç”¨åˆ›å»ºå¯¹è±¡æ”¾å…¥å®¹å™¨\n\n- @Conditional\n\n  æŒ‰ç…§ä¸€å®šçš„æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œæ»¡è¶³æ¡ä»¶ç»™å®¹å™¨ä¸­æ³¨å†ŒBean\n  éœ€è¦å®ç°Condition æ¥å£ï¼šConditionContext åˆ¤æ–­æ¡ä»¶èƒ½ä½¿ç”¨çš„ä¸Šä¸‹æ–‡ï¼›AnnotatedTypeMetadate æ³¨é‡Šä¿¡æ¯\n\n- @Import\n\n  å¯¼å…¥ç»„ä»¶ï¼Œidé»˜è®¤æ˜¯ç»„ä»¶çš„å…¨ç±»åï¼ˆcom.xxx.xxx.xxï¼‰\n\n\t- ImportSelector\n\n\t  è‡ªå®šä¹‰é€»è¾‘è¿”å›éœ€è¦å¯¼å…¥çš„ç»„ä»¶ã€‚\n\t  è¿”å›å€¼å°±æ˜¯å¯¼å…¥åˆ°å®¹å™¨ä¸­çš„ç»„ä»¶å…¨ç±»åï¼Œæ–¹æ³•ä¸è¦è¿”å›nullã€‚\n\t  AnnotationMetadata å½“å‰æ ‡æ³¨@Importæ³¨è§£çš„ç±»çš„æ‰€æœ‰æ³¨é‡Šä¿¡æ¯ã€‚\n\n\t- ImportBeanDefinitionRegistrar\n\n\t  BeanDefinitionRegistryï¼šBeanDefinitionæ³¨å†Œç±»ã€‚\n\t  è°ƒç”¨registerBeanDefinitionæ‰‹å·¥æ³¨å†ŒBean\n\n- FactoryBean\n\n  å®ç°FactoryBeanæ¥å£\n  1.å·¥å‚Beanè·å–çš„æ˜¯è°ƒç”¨getObjectåˆ›å»ºçš„å¯¹è±¡\n  2.è¦è·å–å·¥ç¨‹Beanæœ¬èº«ï¼Œéœ€è¦ç»™idå‰é¢åŠ ä¸€ä¸ª&\n\n### beançš„ç”Ÿå‘½å‘¨æœŸ\n\n- åˆå§‹åŒ–\n\n\t- @Bean(initMethod)\n\t- InitializingBean\n\n\t  é€šè¿‡è®©Beanå®ç°è¯¥æ¥å£ï¼Œå®ç°Beanåˆå§‹åŒ–é€»è¾‘\n\n\t- @PostConstruct\n\t- BeanPostProcessor\n\n\t  Beanåç½®å¤„ç†å™¨ï¼Œåœ¨Beanåˆå§‹åŒ–å‰åè¿›è¡Œä¸€äº›å¤„ç†å·¥ä½œ\n\n\t\t- postProcessBeforeInitialization\n\n\t\t  åœ¨åˆå§‹åŒ–ä¹‹å‰\n\n\t\t- postProcessAfterInitialization\n\n\t\t  åœ¨åˆå§‹åŒ–å·¥ä½œä¹‹å\n\n\t\t- ApplicationContextAwareProcessor\n\n\t\t  å®ç°è¯¥æ¥å£ï¼ŒSpringå®¹å™¨å¯ä»¥å°†å½“å‰å®¹å™¨ä¼ ç»™å®ç°ç±»\n\n\t\t- InitDestroyAnnotationBeanPostProcessor\n\n\t\t  å¤„ç†@PostConstructï¼Œ@PreDestoryæ³¨è§£\n\n\t\t- AutowiredAnnotationBeanPostProcessor\n\n\t\t  å¤„ç†@Autowiredæ³¨è§£\n\n- é”€æ¯\n\n\t- @Bean(destroyMethod)\n\n\t  å¤šå®ä¾‹çš„beanï¼Œå®¹å™¨ä¸ä¼šè°ƒç”¨é”€æ¯æ–¹æ³•\n\n\t- DisposableBean\n\n\t  é€šè¿‡å®ç°è¯¥æ¥å£ï¼Œå®ç°é”€æ¯é€»è¾‘\n\n\t- @PreDestory\n\n### å±æ€§èµ‹å€¼\n\n- @Value\n\n\t- åŸºæœ¬æ•°å€¼\n\t- SpEL  #{}\n\t- é…ç½®æ–‡ä»¶ ${}\n\n\t  @PropertySource è¯»å–å¤–éƒ¨é…ç½®æ–‡ä»¶ï¼Œä¿å­˜è‡³ç¯å¢ƒå˜é‡ä¸­\n\n### è‡ªåŠ¨è£…é…\n\n- @Autowired\n\n  1.é»˜è®¤æŒ‰ç…§ç±»å‹åœ¨å®¹å™¨ä¸­æ‰¾ç›¸åº”çš„ç»„ä»¶\n  2.å¦‚æœæ‰¾åˆ°å¤šä¸ªç›¸åŒç±»å‹çš„ç»„ä»¶ï¼Œå†å°†å±æ€§çš„åç§°ä½œä¸ºç»„ä»¶çš„idç»„å®¹æ˜“ä¸­å¯»æ‰¾\n  3.ä½¿ç”¨@QualifieræŒ‡å®šéœ€è¦è£…é…çš„ç»„ä»¶çš„id\n  4.è‡ªåŠ¨è£…é…é»˜è®¤ä¸€å®šè¦æŒ‡å®šå­˜åœ¨çš„å±æ€§ï¼ˆå¦‚æœä¸å¼ºåˆ¶æŒ‡å®šï¼Œä½¿ç”¨require=falseï¼‰\n  5.@Primary,è®©Springè¿›è¡Œè‡ªåŠ¨è£…é…çš„æ—¶å€™ï¼Œé»˜è®¤æ˜¯ç”¨é¦–é€‰çš„bean\n\n\t- æ„é€ å™¨\n\n\t  æ„é€ å™¨ç”¨åˆ°çš„è‡ªå®šä¹‰ç±»å‹çš„å€¼ä»IOCå®¹å™¨ä¸­è·å–\n\t  å¦‚æœç»„å»ºåªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨ï¼Œè¿™ä¸ªæœ‰å‚æ„é€ å™¨çš„@Autowiredå¯ä»¥çœç•¥ï¼Œå‚æ•°ä½ç½®çš„ç»„ä»¶è¿˜æ˜¯å¯ä»¥ä»å®¹å™¨ä¸­è·å–\n\n\t- æ–¹æ³•\n\n\t  æ ‡æ³¨åœ¨æ–¹æ³•ï¼ŒSpringå®¹å™¨åˆ›å»ºå½“å‰å¯¹è±¡ï¼Œå°±ä¼šè°ƒç”¨æ–¹æ³•å®Œæˆèµ‹å€¼\n\t  æ–¹æ³•ä½¿ç”¨çš„å‚æ•°ï¼Œè‡ªå®šä¹‰ç±»å‹çš„å€¼ä»IOCå®¹å™¨ä¸­è·å–\n\n\t- å±æ€§\n\n\t  å€¼ä»IOCå®¹å™¨ä¸­è·å–\n\n- @Resource\n\n  å¯ä»¥å’Œ@Autowiredä¸€æ ·å®ç°è‡ªåŠ¨è£…é…ï¼Œé»˜è®¤æŒ‰ç…§å±æ€§åç§°è¿›è¡Œè£…é…\n  æ²¡æœ‰æ”¯æŒ@PrimaryåŠŸèƒ½ï¼Œreqiured=false\n\n- @Inject\n\n  éœ€è¦ä¾èµ–javax.injectåŒ…ï¼Œå’ŒAutowiredä¸€æ ·ï¼Œæ²¡æœ‰reqiured=false\n\n- å®ç°xxxAwareæ¥å£\n\n  åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨æ¥å£çš„å›è°ƒæ–¹æ³•\n  æŠŠSpringåº•å±‚çš„ç»„ä»¶æ³¨å†Œåˆ°è‡ªå®šä¹‰çš„Beanä¸­\n  xxxAwareåŠŸèƒ½ä½¿ç”¨xxxProcessorå¤„ç†çš„\n\n\t- ApplicationContextAware\n\n\t  è·å–ApplicationContext\n\n\t- BeanNameAware\n\t- EmbeddedValueResolverAware\n\n- Profile\n\n  åŠ äº†ç¯å¢ƒè¡¨ç¤ºçš„beanï¼Œåªæœ‰è¿™ä¸ªç¯å¢ƒè¢«æ¿€æ´»çš„æ—¶å€™æ‰èƒ½æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œé»˜è®¤æ˜¯defaultç¯å¢ƒ\n\n\t- å¯åŠ¨å‚æ•°\n\n\t  -Dspring.profiles.active=xxx\n\n\t- ä»£ç \n\n\t  1.åˆ›å»ºä¸€ä¸ªaplicationContext\n\t  2.è®¾ç½®éœ€è¦æ¿€æ´»çš„ç¯å¢ƒ.getEnvironment().setActiveProfiles()\n\t  3.æ³¨å†Œæœ±é…ç½®ç±»  .register()\n\t  4.å¯åŠ¨åˆ·æ–°å®¹å™¨ .refresh()\n\n### AOP\n\nåœ¨ç¨‹åºè¿è¡ŒæœŸé—´åŠ¨æ€çš„å°†æŸæ®µä»£ç åˆ‡å…¥åˆ°æŒ‡å®šæ–¹æ³•æŒ‡å®šä½ç½®è¿›è¡Œè¿è¡Œçš„ç¼–ç¨‹æ–¹å¼\nspring-aspects\nå®¹å™¨ä¸­ä¿å­˜äº†ç»„å»ºçš„ä»£ç†å¯¹è±¡(cglibå¢å¼ºåçš„å¯¹è±¡),è¿™ä¸ªå¯¹è±¡é‡Œé¢ä¿å­˜äº†è¯¦ç»†ä¿¡æ¯(æ¯”å¦‚å¢å¼ºå™¨ï¼Œç›®æ ‡å¯¹è±¡)\n\n- @Before\n\n  åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰åˆ‡å…¥ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ˆæŒ‡å®šåœ¨é‚£ä¸ªæ–¹æ³•åˆ‡å…¥ï¼‰\n\n- @After\n\n  åœ¨ç›®æ ‡æ–¹æ³•ä¹‹ååˆ‡å…¥ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼\n\n- @PointCut\n\n  åˆ‡å…¥ç‚¹è¡¨è¾¾å¼\n\n- @AfterReturning\n\n  å†æ”¾æ ‡æ–¹æ³•æ­£å¸¸è¿”å›ä¹‹åè¿è¡Œ\n\n- @AfterThrowing\n\n  åœ¨ç›®æ ‡æ–¹æ³•å‡ºç°å¼‚å¸¸ä¹‹åè¿è¡Œ\n\n- @Aspect\n\n  å‘Šè¯‰Springå½“å‰ç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»\n\n- @EnableAspectJAutoProxy\n\n  å¼€å¯åŸºäºæ³¨è§£çš„AOP\n  1.ç»™å®¹å™¨ä¸­å¯¼å…¥AspectJAutoProxyRegistrarï¼Œç»™å®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªAnnotationAwareAspectJAutoProxyCreator\n\n\t- AnnotationAwareAspectJAutoProxyCreator\n\n\t\t- AspectJAwareAdvisorAutoProxyCreator\n\n\t\t\t- AbstractAdvisorAutoProxyCreator\n\n\t\t\t\t- AbstractAutoProxyCreator\n\n\t\t\t\t\t- SmartInstantiationAwareBeanPostProcessor\n\t\t\t\t\t- BeanFactroyAware\n\n- JoinPoint\n\n  JoinPointä¸€å®šè¦å‡ºç°åœ¨å‚æ•°è¡¨çš„ç¬¬ä¸€ä½\n\n- ç›®æ ‡æ–¹æ³•æ‰§è¡Œ\n\n  1.CglibAopProxy.intercept()ã€‚æ‹¦æˆªç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œã€‚\n  2.æ ¹æ®PoxyFactoryå¯¹è±¡è·å–å°†è¦æ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•æ‹¦æˆªå™¨é“¾\n  \ta)å¦‚æœæ²¡æœ‰æ‹¦æˆªå™¨é“¾ï¼Œç›´æ¥æ‰§è¡Œç›®æ ‡æ–¹æ³•\n  \tb)å¦‚æœæœ‰æ‹¦æˆªå™¨é“¾ï¼ŒæŠŠéœ€è¦æ‰§è¡Œçš„ç›®æ ‡å¯¹è±¡ï¼Œç›®æ ‡æ–¹æ³•ï¼Œæ‹¦æˆªå™¨é“¾ç­‰ä¿¡æ¯å‡ºå…¥åˆ›å»ºä¸€ä¸ªCglibMethodInvocationï¼Œå¹¶è°ƒç”¨proceed()æ–¹æ³•\n  \tc)æ‹¦æˆªå™¨é“¾è§¦å‘è¿‡ç¨‹\n  \t\t1.å¦‚æœæ²¡æœ‰æ‹¦æˆªå™¨æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œæˆ–è€…æ‡’æœºå™¨çš„ç´¢å¼•å’Œæ‹¦æˆªå™¨æ•°ç»„-1å¤§å°ä¸€æ ·(æŒ‡å®šåˆ°äº†æœ€åä¸€ä¸ªæ‹¦æˆªå™¨)ï¼Œæ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚\n\n### å£°æ˜å¼äº‹åŠ¡\n\n1.å¯¼å…¥ç›¸å…³ä¾èµ–spring-jdbc\n2.é…ç½®æ•°æ®æº JdbcTmplate\n3.ç»™æ–¹æ³•æ ‡æ³¨@Transactional\n4.@EnableTransactionManagement å¼€å¯åŸºäºæ³¨è§£çš„äº‹ç‰©\n5.é…ç½®äº‹ç‰©ç®¡ç†å™¨ç®¡ç†äº‹ç‰©\n\n- @Transactional\n- @EnableTransactionManagement\n\n\t- TransactionManagementConfigurationSelection\n\n\t  ç»™å®¹å™¨ä¸­å¯¼å…¥ç»„ä»¶\n\n\t\t- AutoProxyRegistrar\n\n\t\t  ç»™å®¹å™¨ä¸­æ³¨å†ŒInfrastructureAdvisorAutoProxyCreatorç»„ä»¶\n\n\t\t\t- InfrastructureAdvisorAutoProxyCreator\n\n\t\t\t  åˆ©ç”¨åç½®å¤„ç†å™¨æœºåˆ¶åœ¨å¯¹è±¡åˆ›å»ºåï¼ŒåŒ…è£…å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆå¢å¼ºå™¨ï¼‰ï¼Œä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³•åˆ©ç”¨æ‹¦æˆªå™¨é“¾æ‰§è¡Œæ–¹æ³•\n\n\t\t- ProxyTransactionManagementConfiguration\n\n\t\t  1.ç»™å®¹å™¨ä¸­æ³¨å†Œäº‹ç‰©å¢å¼ºå™¨\n\t\t  \täº‹ç‰©å¢å¼ºå™¨è¦ç”¨äº‹ç‰©æ³¨è§£ä¿¡æ¯\n\t\t  \täº‹ç‰©æ‹¦æˆªå™¨ï¼Œä¿å­˜äº†äº‹ç‰©çš„å±æ€§ä¿¡æ¯ï¼Œäº‹ç‰©ç®¡ç†å™¨ï¼Œæ˜¯ä¸€ä¸ªMethodInterceptorï¼Œåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œæ—¶æ‰§è¡Œæ‹¦æˆªå™¨é“¾\n\n## æ‰©å±•åŸç†\n\n### BeanFactoryPostProcessor\n\nBeanFactoryåç½®å¤„ç†å™¨\n\tåœ¨BeanFactoryæ ‡å‡†åˆå§‹åŒ–ä¹‹åè°ƒç”¨ï¼Œæ‰€æœ‰çš„beanå®šä¹‰ä»¥ä¿å­˜åœ¨é­åˆ°beanFactoryï¼Œä½†æ˜¯beanè¿˜æœªåˆ›å»º\n\n- BeanDefinitionRegistryPostProcessor\n\n  åœ¨æ‰€æœ‰beanå®šä¹‰ä¿¡æ¯å°†è¦è¢«åŠ è½½ï¼Œbeanå®åŠ›è¿˜æœªè¢«åˆ›å»ºæ—¶æ‰§è¡Œ\n\n### ApplicationListener\n\nç›‘å¬å®¹å™¨ä¸­å‘å¸ƒçš„äº‹ä»¶\n\t1.å†™ä¸€ä¸ªç›‘å¬å™¨ï¼ŒApplicationListenerå®ç°ç±»ï¼Œæ¥ç›‘å¬æŸä¸ªäº‹ä»¶ApplicationEventæœºå™¨å­ç±»\n\t2.æŠŠç›‘å¬å™¨åŠ å…¥åˆ°å®¹å™¨\n\t3.åªè¦å®¹å™¨ä¸­æœ‰ç›¸å…³äº‹ä»¶çš„è…¹éƒ¨ï¼Œæˆ‘ä»¬å°±èƒ½ç›‘å¬åˆ°è¿™ä¸ªäº‹ä»¶ï¼š\n\t\tContextRefreshedEventï¼šå®¹å™¨èˆ’å¿ƒå®Œæˆ(æ‰€æœ‰beanéƒ½å®Œå…¨åˆ›å»º)ä¼šå‘å¸ƒè¿™ä¸ªäº‹ä»¶ï¼›\n\t\tContextClosedEventï¼šå…³é—­å®¹å™¨ä¼šå‘å¸ƒè¿™ä¸ªäº‹ä»¶\n\t4.å‘å¸ƒä¸€ä¸ªäº‹ä»¶ï¼ŒapplicationContext.publishEvent()\n\n### å®¹å™¨çš„åˆ›å»º\n\n1.Springå®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå…ˆä¼šä¿å­˜æ‰€æœ‰æ³¨å†Œè¿›æ¥çš„Beançš„å®šä¹‰ä¿¡æ¯\n\txml\n\tæ³¨è§£\n2.Springå®¹å™¨ä¼šåˆé€‚çš„æ—¶æœºåˆ›å»ºè¿™äº›Bean\n\tç”¨åˆ°è¿™ä¸ªbeançš„æ—¶å€™ï¼Œåˆ©ç”¨getBeanåˆ›å»ºbeanï¼Œåˆ›å»ºå¥½ä»¥åä¿å­˜åœ¨å®¹å™¨ä¸­\n\tç»Ÿä¸€åˆ›å»ºå‰©ä¸‹æ‰€æœ‰çš„beançš„æ—¶å€™ï¼ŒfinshBeanFactoryInitialization()\n3.åç½®å¤„ç†å™¨\n\tæ¯ä¸ªbeanåˆ›å»ºå®Œæˆï¼Œéƒ½ä¼šä½¿ç”¨å„ç§åç½®å¤„ç†å™¨ï¼Œæ¥å¢å¼ºbeançš„åŠŸèƒ½\n4.äº‹ä»¶é©±åŠ¨æ¨¡å‹\n\tApplicationListenerï¼Œäº‹ä»¶ç›‘å¬\näº‹ä»¶æ´¾å‘ï¼ŒApplicationEvenMulticator\n\n- refresh()\n\n\t- prepareRefresh()\n\n\t  åˆ·æ–°é¢„å¤„ç†å·¥ä½œ:\n\t  æ¸…ç¼“å­˜\n\t  ç½®çŠ¶æ€\n\n\t\t- initPropertySources()\n\n\t\t  åˆå§‹åŒ–å±æ€§è®¾ç½®ï¼Œå­ç±»è‡ªå®šä¹‰ä¸ªæ€§åŒ–çš„å±æ€§è®¾ç½®æ–¹æ³•ã€‚\n\n\t\t- getEnvironment().validateRequiredProperties()\n\n\t\t  æ£€éªŒå±æ€§çš„åˆæ³•\n\n\t\t- earlyApplicationEvents\n\n\t\t  ä¿å­˜å®¹å™¨ä¸­çš„ä¸€èµ·æ—©èµ·äº‹ä»¶\n\n\t- obtainFreshBeanFactory()\n\n\t  è·å–BeanFactory\n\n\t\t- refreshBeanFactory()\n\n\t\t  åˆ·æ–°BeanFactoryå·¥å‚ï¼Œåˆ›å»ºBeanFactoryå¯¹è±¡ã€‚\n\n\t\t- getBeanFactory()ã€DefaultListableBeanFactoryã€‘\n\n\t\t  è·å–ä¹‹å‰åˆ›å»ºå¥½çš„BeanFactory\n\n\t\t- prepareBeanFactory()\n\n\t\t  BeanFactoryçš„é¢„å‡†å¤‡å·¥ä½œï¼ˆBeanFactoryè¿›è¡Œä¸€äº›è®¾ç½®ï¼‰\n\t\t  1.è®¾ç½®BeanFactoryçš„ç±»åŠ è½½å™¨ï¼Œæ”¯æŒè¡¨è¾¾å¼è§£æå™¨ã€‚ã€‚ã€‚\n\t\t  2.æ·»åŠ éƒ¨åˆ†BeanPostProcessorã€ApplicationContextAwareProcessorã€‘\n\t\t  3.è®¾ç½®å¿½ç•¥çš„è‡ªåŠ¨è£…é…çš„æ¥å£ï¼ŒEnvironmentAwareã€EmbeddedValueResolverAwareã€‚ã€‚ã€‚\n\t\t  4.æ³¨å†Œå¯ä»¥è§£æçš„è‡ªåŠ¨è£…é…ï¼Œæˆ‘ä»¬èƒ½ç›´æ¥åœ¨ä»å’Œç»„ä»¶ä¸­è‡ªåŠ¨æ³¨å…¥ï¼šBeanFactoryã€ResourceLoaderã€ApplicationEventPublisherã€ApplicationContext\n\t\t  5.æ·»åŠ BeanPostProcessorã€ApplicationListenerDetectorã€‘\n\t\t  6.æ·»åŠ ç¼–è¯‘æ˜¯çš„AspectJæ”¯æŒ\n\t\t  7.ç»™BeanFactoryä¸­æ³¨å†Œä¸€äº›èƒ½ç”¨çš„ç»„ä»¶ï¼šenvironmentã€ConfigurableEnvironmentã€‘ã€systemPropertiesã€Mapã€‘\n\n\t\t- postProcessBeanFactory()\n\n\t\t  BeanFactoryå‡†å¤‡å®Œæˆåçš„åç½®å¤„ç†å·¥ä½œï¼Œå­ç±»ç”¨è¿‡é‡å†™è¿™ä¸ªå‘æ–¹æ³•æ¥åœ¨BeanFactoryåˆå§‹åŒ–å®Œæˆåè¿›è¡Œæ›´è¿›ä¸€æ­¥çš„å·¥ä½œ\n\n\t\t- invokeBeanFactoryPostProcessors()\n\n\t\t  æ‰§è¡ŒBeanFactoryPostProcessorï¼šBeanFactoryçš„åç½®å¤„ç†å™¨ï¼Œåœ¨BeanFactoryæ ‡å‡†åˆå§‹åŒ–ä¹‹åæ‰§è¡Œ\n\t\t  \n\t\t  æ‰§è¡ŒBeanFactoryPostProcessorçš„æ–¹æ³•ï¼š\n\t\t  1.å…ˆæ‰§è¡ŒBeanDefinitonRegistryPostProcessor\n\t\t  \tè·å–æ‰€æœ‰çš„BeanDefinitonRegistryPostProcessor\n\t\t  \tå…ˆæ‰§è¡Œå®ç°äº†PriorityOrderedæ¥å£çš„\n\t\t  \tå†æ‰§è¡Œå®ç°äº†Orderedæ¥å£çš„\n\t\t  \tæœ€åæ‰§è¡Œå‰©ä¸‹çš„\n\t\t  2.å†æ‰§è¡ŒBeanFactoryPostProcessorçš„æ–¹æ³•\n\t\t  \tå…ˆæ‰§è¡Œå®ç°äº†PriorityOrderedæ¥å£çš„\n\t\t  \tå†æ‰§è¡Œå®ç°äº†Orderedæ¥å£çš„\n\t\t  \tæœ€åæ‰§è¡Œå‰©ä¸‹çš„\n\n\t- registerBeanPostProcessors()\n\n\t  æ³¨å†ŒBeanPostProcessorï¼ŒBeançš„åç½®å¤„ç†å™¨ã€‚\n\t  1.è·å–æ‰€æœ‰çš„BeanPostProcessorï¼Œä¸åŒæ¥å£ç±»å‹çš„BeanPostProcessorï¼Œåœ¨Beanèˆ¹èˆ°å‰åçš„æ‰§è¡Œå®é™…æ˜¯ä¸ä¸€æ ·çš„ã€‚\n\t  \tBeanPostProcessor\n\t  \tDestructionAwareBeanPostProcessor\n\t  \tInstantiationAwareBeanPostProcessor\n\t  \tSmartInstantiationAwareBeanPostProcessor\n\t  \tMergedBeanDefinitionPostProcessor\n\n\t- initMessageSource()\n\n\t  åˆå§‹åŒ–MessageSourceç»„ä»¶ï¼ˆåšå›½é™…åŒ–åŠŸèƒ½ï¼Œæ¶ˆæ¯ç»‘å®šã€è§£æï¼‰\n\t  1.è·å–BeanFactory\n\t  2.çœ‹å®¹å™¨ä¸­æ˜¯å¦æœ‰idä¸ºmessageSourceçš„ç»„ä»¶\n\t  \tå¦‚æœæœ‰èµ‹å€¼ç»™messageSourceï¼Œå¦‚æœæ²¡æœ‰è‡ªå·±åˆ›å»ºã€DelegatingMessageSourceã€‘\n\t  3.æŠŠåˆ›å»ºå¥½çš„MessageSourceæ³¨å†Œåœ¨å®¹å™¨ä¸­\n\n\t- initApplicationEventMulticaster()\n\n\t  åˆå§‹åŒ–äº‹ä»¶æ´¾å‘å™¨\n\t  1.ä»BeanFactoryä¸­è·å–applicationEventMulticasterçš„ApplicationEventMulticaster\n\t  2.å¦‚æœæ²¡æœ‰é…ç½®ï¼Œåˆ›å»ºSimpleApplicationEventMulticaster\n\t  3.æ³¨å†Œåˆ°å®¹å™¨ä¸­\n\n\t- onRefresh()\n\n\t  ç•™ç»™å­å®¹å™¨çš„ï¼ˆå­ç±»ï¼‰\n\t  1.å­ç±»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨å®¹å™¨åˆ·æ–°çš„æ—¶å€™å¯ä»¥è‡ªå®šä¹‰é€»è¾‘\n\n\t- registerLiseners()\n\n\t  ç»™å®¹å™¨ä¸­å°†æ‰€æœ‰çš„é¡¹ç›®çš„ApplicationListeneræ³¨å†Œè¿›æ¥ã€‚\n\t  1.ä»å®¹å™¨ä¸­æ‹¿åˆ°æ‰€æœ‰ApplicationListenerç»„ä»¶\n\t  2.å°†æ¯ä¸ªç›‘å¬å™¨æ·»åŠ åˆ°äº‹ä»¶æ´¾å‘å™¨ä¸­\n\t  3.æ´¾å‘ä¹‹å‰æ­¥éª¤äº§ç”Ÿçš„äº‹ä»¶\n\n\t- finishBeanFactoryInitialization()\n\n\t  åˆå§‹åŒ–å‰©ä¸‹çš„æ‰€æœ‰å•å®ä¾‹bean\n\n\t\t- beanFactory.preInstantiateSingletons()\n\n\t\t  åˆå§‹åŒ–å‰©ä¸‹çš„å•å®ä¾‹bean\n\t\t  1.è·å–å®¹å™¨ä¸­æ‰€æœ‰çš„Beanå®šä¹‰\n\t\t  2.æ‹¿åˆ°Beançš„å®šä¹‰ä¿¡æ¯\n\t\t  3.Beanä¸æ˜¯æŠ½è±¡çš„ï¼Œæ˜¯å•å®ä¾‹çš„ï¼Œä¸æ˜¯æ‡’åŠ è½½çš„\n\t\t  \t1.åˆ¤æ–­æ˜¯å¦æ˜¯FactoryBeanï¼Œæ˜¯å¦æ˜¯å®ç°FactoryBeanæ¥å£çš„Bean\n\t\t  \t2.ä¸æ˜¯FactoryBeanï¼Œç”¨getBeanåˆ›å»ºå¯¹è±¡\n\t\t  \t3.doGetBean()\n\t\t  \t4.å…ˆè·å–ç¼“å­˜ä¸­ä¿å­˜çš„å•å®ä¾‹Beanã€‚å¦‚æœè·å–åˆ°ï¼Œè¯´æ˜è¿™ä¸ªBeanä¹‹å‰è¢«åˆ›å»ºå›½ï¼ˆæ‰€æœ‰åˆ›å»ºå›½çš„å•å®ä¾‹Beanéƒ½æ˜¯ä¼šè¢«ç¼“å­˜èµ·æ¥çš„ï¼‰\n\t\t  \t5.æ¢ç§ç§è·å–ä¸åˆ°ï¼Œå¼€å§‹Beançš„åˆ›å»ºå¯¹è±¡æµç¨‹\n\t\t  \t6.æ ‡è®°å½“å‰beanå·²ç»è¢«åˆ›å»º\n\t\t  \t7.è·å–Beançš„å®šä¹‰ä¿¡æ¯\n\t\t  \t8.è·å–å½“å‰Beanä¾èµ–çš„å…¶ä»–Beanï¼Œå¦‚æœæœ‰å°±æŒ‰ç…§getBean()æŠŠä»¥æ¥çš„Beanå…ˆåˆ›å»ºå‡ºæ¥ã€‚\n\t\t  \t9.å¯åŠ¨å•å®ä¾‹Beançš„åˆ›å»ºæµç¨‹\n\t\t  \t\t1.createBean()\n\t\t  \t\t2.resolveBeforeInstantiation()è®©BeanPostProcessorå…ˆæ‹¦æˆªè¿”å›ä»£ç†å¯¹è±¡ã€InstantiationAwareBeanPostProcessorsã€‘æå‰æ‰§è¡Œ\n\t\t  \t\t3.å¦‚æœå‰é¢çš„InstantiationAwareBeanPostProcessorsæ²¡æœ‰è¿”å›ä»£ç†å¯¹è±¡\n\t\t  \t\t4.doCreateBean()åˆ›å»ºBean\n\t\t  \t\t\t1.åˆ›å»ºBeanå®ä¾‹ï¼ŒcreateBeanInstance()åˆ©ç”¨å·¥å‚æ–¹æ³•æˆ–è€…å¯¹è±¡çš„æ„é€ å™¨åˆ›å»ºå‡ºBeanå®ä¾‹\n\t\t  \t\t\t2.applyMergedBeanDefinitionPostProcessors()ï¼Œè°ƒç”¨ã€MergedBeanDefinitionPostProcessorsã€‘\n\t\t  \t\t\t3.populateBean() Beanå±æ€§èµ‹å€¼\n\n\t- finishRefresh()\n\n\t  å®ŒæˆBeanFactoryçš„åˆå§‹åŒ–åˆ›å»ºå·¥ä½œï¼ŒIOCå®¹å™¨å°±åˆ›å»ºå®Œæˆ\n\n\t\t- initLifecycleProcessor()\n\n\t\t  åˆå§‹åŒ–å’Œç”Ÿå‘½å‘¨æœŸæœ‰å…³çš„åç½®å¤„ç†å™¨ï¼šLifecycleProcessorã€‚\n\t\t  å†™ä¸€ä¸ªLifecycleProcessorçš„å®ç°ç±»ï¼Œå¯ä»¥åœ¨BeanFactoryçš„onRefresh(),onClose()è¿›è¡Œæ‹¦æˆª\n\n\t\t- getLifecycleProcessor().onRefresh()\n\n\t\t  æ‹¿åˆ°å‰é¢å®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨ï¼Œå›è°ƒonRefresh()\n\n\t\t- publishEvent()\n\n\t\t  å‘å¸ƒå®¹å™¨å®Œæˆäº‹ä»¶","slug":"Spring-Boot","published":1,"updated":"2020-12-14T09:51:24.008Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71ht40009v252hkw3edgq","content":"<html><head></head><body><h2 id=\"&#x5BB9;&#x5668;\"><a href=\"#&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x5BB9;&#x5668;\"></a>&#x5BB9;&#x5668;</h2><h3 id=\"IOC\"><a href=\"#IOC\" class=\"headerlink\" title=\"IOC\"></a>IOC</h3><a id=\"more\"></a>\n<p>spring-context</p>\n<ul>\n<li><p>@Configuration</p>\n<p>&#x544A;&#x8BC9;Spring&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x7C7B;</p>\n</li>\n<li><p>@Bean</p>\n<p>&#x7ED9;&#x5BB9;&#x5668;&#x4E2D;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;Bean&#xFF0C;&#x7C7B;&#x578B;&#x4E3A;&#x8FD4;&#x56DE;&#x503C;&#x7684;&#x7C7B;&#x578B;&#xFF0C;id&#x9ED8;&#x8BA4;&#x662F;&#x7528;&#x65B9;&#x6CD5;<br>&#x9ED8;&#x8BA4;&#x90FD;&#x662F;&#x5355;&#x4F8B;</p>\n</li>\n<li><p>AnnotationConfigApplicationContext</p>\n</li>\n<li><p>@ComponetScan&#x3001;@ComponetScans</p>\n<p>value&#xFF1A;&#x626B;&#x63CF;@Service @Controller @Repositroy @Componet<br>excludeFlters&#xFF1A;&#x6392;&#x9664;&#x7684;&#x89C4;&#x5219;<br>includeFilters&#xFF1A;&#x53EA;&#x9700;&#x8981;&#x5305;&#x542B;&#x7684;&#x89C4;&#x5219;</p>\n<ul>\n<li><p>FilterType.ANNOTATION</p>\n<p>&#x6309;&#x7167;&#x6CE8;&#x89E3;</p>\n</li>\n<li><p>FilterType.ASSIGNABLE_TYPE</p>\n<p>&#x6309;&#x7167;&#x7ED9;&#x5B9A;&#x7C7B;&#x578B;</p>\n</li>\n<li><p>FilterType.ASPECTJ</p>\n<p>&#x4F7F;&#x7528;ASPECTJ&#x8868;&#x8FBE;&#x5F0F;</p>\n</li>\n<li><p>FilterType.REGEX</p>\n<p>&#x4F7F;&#x7528;&#x6B63;&#x5219;&#x6307;&#x5B9A;</p>\n</li>\n<li><p>FilterType.CUSTOM</p>\n<p>&#x81EA;&#x5B9A;&#x4E49;&#x89C4;&#x5219;&#xFF0C;&#x5FC5;&#x987B;&#x5B9E;&#x73B0;TypeFilter&#x7C7B;</p>\n</li>\n</ul>\n</li>\n<li><p>@Scope</p>\n<ul>\n<li><p>SCOPE_PROTOTPE</p>\n<p>&#x591A;&#x5B9E;&#x4F8B;<br>IOC&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x4E0D;&#x56DE;&#x53BB;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x5E8A;&#x67B6;&#x4F60;&#x5BF9;&#x8C61;&#xFF0C;&#x83B7;&#x53D6;&#x7684;&#x65F6;&#x5019;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;</p>\n</li>\n<li><p>SCOPE_SINGLETON</p>\n<p>&#x5355;&#x5B9E;&#x4F8B;&#xFF08;&#x9ED8;&#x8BA4;&#x503C;&#xFF09;<br>IOC&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x4F1A;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x653E;&#x5230;IOC&#x5BB9;&#x5668;&#x4E2D;</p>\n</li>\n<li><p>SCOPE_REQUEST</p>\n<p>&#x540C;&#x4E00;&#x6B21;&#x8BF7;&#x6C42;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;</p>\n</li>\n<li><p>SCOPE_SESSION</p>\n<p>&#x540C;&#x4E00;&#x4E2A;Session&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;</p>\n</li>\n</ul>\n</li>\n<li><p>@Lazy </p>\n<p>&#x61D2;&#x52A0;&#x8F7D;&#xFF1A;&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x4E0D;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x3002;&#x7B2C;&#x4E00;&#x6B21;&#x4F7F;&#x7528;&#xFF08;&#x83B7;&#x53D6;&#xFF09;Bean&#x5BF9;&#x8C61;&#x65F6;&#x8C03;&#x7528;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x653E;&#x5165;&#x5BB9;&#x5668;</p>\n</li>\n<li><p>@Conditional</p>\n<p>&#x6309;&#x7167;&#x4E00;&#x5B9A;&#x7684;&#x6761;&#x4EF6;&#x8FDB;&#x884C;&#x5224;&#x65AD;&#xFF0C;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7ED9;&#x5BB9;&#x5668;&#x4E2D;&#x6CE8;&#x518C;Bean<br>&#x9700;&#x8981;&#x5B9E;&#x73B0;Condition &#x63A5;&#x53E3;&#xFF1A;ConditionContext &#x5224;&#x65AD;&#x6761;&#x4EF6;&#x80FD;&#x4F7F;&#x7528;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#xFF1B;AnnotatedTypeMetadate &#x6CE8;&#x91CA;&#x4FE1;&#x606F;</p>\n</li>\n<li><p>@Import</p>\n<p>&#x5BFC;&#x5165;&#x7EC4;&#x4EF6;&#xFF0C;id&#x9ED8;&#x8BA4;&#x662F;&#x7EC4;&#x4EF6;&#x7684;&#x5168;&#x7C7B;&#x540D;&#xFF08;com.xxx.xxx.xx&#xFF09;</p>\n<ul>\n<li><p>ImportSelector</p>\n<p>&#x81EA;&#x5B9A;&#x4E49;&#x903B;&#x8F91;&#x8FD4;&#x56DE;&#x9700;&#x8981;&#x5BFC;&#x5165;&#x7684;&#x7EC4;&#x4EF6;&#x3002;<br>&#x8FD4;&#x56DE;&#x503C;&#x5C31;&#x662F;&#x5BFC;&#x5165;&#x5230;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x7EC4;&#x4EF6;&#x5168;&#x7C7B;&#x540D;&#xFF0C;&#x65B9;&#x6CD5;&#x4E0D;&#x8981;&#x8FD4;&#x56DE;null&#x3002;<br>AnnotationMetadata &#x5F53;&#x524D;&#x6807;&#x6CE8;@Import&#x6CE8;&#x89E3;&#x7684;&#x7C7B;&#x7684;&#x6240;&#x6709;&#x6CE8;&#x91CA;&#x4FE1;&#x606F;&#x3002;</p>\n</li>\n<li><p>ImportBeanDefinitionRegistrar</p>\n<p>BeanDefinitionRegistry&#xFF1A;BeanDefinition&#x6CE8;&#x518C;&#x7C7B;&#x3002;<br>&#x8C03;&#x7528;registerBeanDefinition&#x624B;&#x5DE5;&#x6CE8;&#x518C;Bean</p>\n</li>\n</ul>\n</li>\n<li><p>FactoryBean</p>\n<p>&#x5B9E;&#x73B0;FactoryBean&#x63A5;&#x53E3;<br>1.&#x5DE5;&#x5382;Bean&#x83B7;&#x53D6;&#x7684;&#x662F;&#x8C03;&#x7528;getObject&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;<br>2.&#x8981;&#x83B7;&#x53D6;&#x5DE5;&#x7A0B;Bean&#x672C;&#x8EAB;&#xFF0C;&#x9700;&#x8981;&#x7ED9;id&#x524D;&#x9762;&#x52A0;&#x4E00;&#x4E2A;&amp;</p>\n</li>\n</ul>\n<h3 id=\"bean&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;\"><a href=\"#bean&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;\" class=\"headerlink\" title=\"bean&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;\"></a>bean&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;</h3><ul>\n<li><p>&#x521D;&#x59CB;&#x5316;</p>\n<ul>\n<li><p>@Bean(initMethod)</p>\n</li>\n<li><p>InitializingBean</p>\n<p>&#x901A;&#x8FC7;&#x8BA9;Bean&#x5B9E;&#x73B0;&#x8BE5;&#x63A5;&#x53E3;&#xFF0C;&#x5B9E;&#x73B0;Bean&#x521D;&#x59CB;&#x5316;&#x903B;&#x8F91;</p>\n</li>\n<li><p>@PostConstruct</p>\n</li>\n<li><p>BeanPostProcessor</p>\n<p>Bean&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x5728;Bean&#x521D;&#x59CB;&#x5316;&#x524D;&#x540E;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x5904;&#x7406;&#x5DE5;&#x4F5C;</p>\n<ul>\n<li><p>postProcessBeforeInitialization</p>\n<p>&#x5728;&#x521D;&#x59CB;&#x5316;&#x4E4B;&#x524D;</p>\n</li>\n<li><p>postProcessAfterInitialization</p>\n<p>&#x5728;&#x521D;&#x59CB;&#x5316;&#x5DE5;&#x4F5C;&#x4E4B;&#x540E;</p>\n</li>\n<li><p>ApplicationContextAwareProcessor</p>\n<p>&#x5B9E;&#x73B0;&#x8BE5;&#x63A5;&#x53E3;&#xFF0C;Spring&#x5BB9;&#x5668;&#x53EF;&#x4EE5;&#x5C06;&#x5F53;&#x524D;&#x5BB9;&#x5668;&#x4F20;&#x7ED9;&#x5B9E;&#x73B0;&#x7C7B;</p>\n</li>\n<li><p>InitDestroyAnnotationBeanPostProcessor</p>\n<p>&#x5904;&#x7406;@PostConstruct&#xFF0C;@PreDestory&#x6CE8;&#x89E3;</p>\n</li>\n<li><p>AutowiredAnnotationBeanPostProcessor</p>\n<p>&#x5904;&#x7406;@Autowired&#x6CE8;&#x89E3;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>&#x9500;&#x6BC1;</p>\n<ul>\n<li><p>@Bean(destroyMethod)</p>\n<p>&#x591A;&#x5B9E;&#x4F8B;&#x7684;bean&#xFF0C;&#x5BB9;&#x5668;&#x4E0D;&#x4F1A;&#x8C03;&#x7528;&#x9500;&#x6BC1;&#x65B9;&#x6CD5;</p>\n</li>\n<li><p>DisposableBean</p>\n<p>&#x901A;&#x8FC7;&#x5B9E;&#x73B0;&#x8BE5;&#x63A5;&#x53E3;&#xFF0C;&#x5B9E;&#x73B0;&#x9500;&#x6BC1;&#x903B;&#x8F91;</p>\n</li>\n<li><p>@PreDestory</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"&#x5C5E;&#x6027;&#x8D4B;&#x503C;\"><a href=\"#&#x5C5E;&#x6027;&#x8D4B;&#x503C;\" class=\"headerlink\" title=\"&#x5C5E;&#x6027;&#x8D4B;&#x503C;\"></a>&#x5C5E;&#x6027;&#x8D4B;&#x503C;</h3><ul>\n<li><p>@Value</p>\n<ul>\n<li><p>&#x57FA;&#x672C;&#x6570;&#x503C;</p>\n</li>\n<li><p>SpEL  #{}</p>\n</li>\n<li><p>&#x914D;&#x7F6E;&#x6587;&#x4EF6; ${}</p>\n<p>@PropertySource &#x8BFB;&#x53D6;&#x5916;&#x90E8;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x4FDD;&#x5B58;&#x81F3;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x4E2D;</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"&#x81EA;&#x52A8;&#x88C5;&#x914D;\"><a href=\"#&#x81EA;&#x52A8;&#x88C5;&#x914D;\" class=\"headerlink\" title=\"&#x81EA;&#x52A8;&#x88C5;&#x914D;\"></a>&#x81EA;&#x52A8;&#x88C5;&#x914D;</h3><ul>\n<li><p>@Autowired</p>\n<p>1.&#x9ED8;&#x8BA4;&#x6309;&#x7167;&#x7C7B;&#x578B;&#x5728;&#x5BB9;&#x5668;&#x4E2D;&#x627E;&#x76F8;&#x5E94;&#x7684;&#x7EC4;&#x4EF6;<br>2.&#x5982;&#x679C;&#x627E;&#x5230;&#x591A;&#x4E2A;&#x76F8;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x518D;&#x5C06;&#x5C5E;&#x6027;&#x7684;&#x540D;&#x79F0;&#x4F5C;&#x4E3A;&#x7EC4;&#x4EF6;&#x7684;id&#x7EC4;&#x5BB9;&#x6613;&#x4E2D;&#x5BFB;&#x627E;<br>3.&#x4F7F;&#x7528;@Qualifier&#x6307;&#x5B9A;&#x9700;&#x8981;&#x88C5;&#x914D;&#x7684;&#x7EC4;&#x4EF6;&#x7684;id<br>4.&#x81EA;&#x52A8;&#x88C5;&#x914D;&#x9ED8;&#x8BA4;&#x4E00;&#x5B9A;&#x8981;&#x6307;&#x5B9A;&#x5B58;&#x5728;&#x7684;&#x5C5E;&#x6027;&#xFF08;&#x5982;&#x679C;&#x4E0D;&#x5F3A;&#x5236;&#x6307;&#x5B9A;&#xFF0C;&#x4F7F;&#x7528;require=false&#xFF09;<br>5.@Primary,&#x8BA9;Spring&#x8FDB;&#x884C;&#x81EA;&#x52A8;&#x88C5;&#x914D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x7528;&#x9996;&#x9009;&#x7684;bean</p>\n<ul>\n<li><p>&#x6784;&#x9020;&#x5668;</p>\n<p>&#x6784;&#x9020;&#x5668;&#x7528;&#x5230;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x7684;&#x503C;&#x4ECE;IOC&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x53D6;<br>&#x5982;&#x679C;&#x7EC4;&#x5EFA;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x6709;&#x53C2;&#x6784;&#x9020;&#x5668;&#xFF0C;&#x8FD9;&#x4E2A;&#x6709;&#x53C2;&#x6784;&#x9020;&#x5668;&#x7684;@Autowired&#x53EF;&#x4EE5;&#x7701;&#x7565;&#xFF0C;&#x53C2;&#x6570;&#x4F4D;&#x7F6E;&#x7684;&#x7EC4;&#x4EF6;&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x4ECE;&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x53D6;</p>\n</li>\n<li><p>&#x65B9;&#x6CD5;</p>\n<p>&#x6807;&#x6CE8;&#x5728;&#x65B9;&#x6CD5;&#xFF0C;Spring&#x5BB9;&#x5668;&#x521B;&#x5EFA;&#x5F53;&#x524D;&#x5BF9;&#x8C61;&#xFF0C;&#x5C31;&#x4F1A;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x5B8C;&#x6210;&#x8D4B;&#x503C;<br>&#x65B9;&#x6CD5;&#x4F7F;&#x7528;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x7684;&#x503C;&#x4ECE;IOC&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x53D6;</p>\n</li>\n<li><p>&#x5C5E;&#x6027;</p>\n<p>&#x503C;&#x4ECE;IOC&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x53D6;</p>\n</li>\n</ul>\n</li>\n<li><p>@Resource</p>\n<p>&#x53EF;&#x4EE5;&#x548C;@Autowired&#x4E00;&#x6837;&#x5B9E;&#x73B0;&#x81EA;&#x52A8;&#x88C5;&#x914D;&#xFF0C;&#x9ED8;&#x8BA4;&#x6309;&#x7167;&#x5C5E;&#x6027;&#x540D;&#x79F0;&#x8FDB;&#x884C;&#x88C5;&#x914D;<br>&#x6CA1;&#x6709;&#x652F;&#x6301;@Primary&#x529F;&#x80FD;&#xFF0C;reqiured=false</p>\n</li>\n<li><p>@Inject</p>\n<p>&#x9700;&#x8981;&#x4F9D;&#x8D56;javax.inject&#x5305;&#xFF0C;&#x548C;Autowired&#x4E00;&#x6837;&#xFF0C;&#x6CA1;&#x6709;reqiured=false</p>\n</li>\n<li><p>&#x5B9E;&#x73B0;xxxAware&#x63A5;&#x53E3;</p>\n<p>&#x5728;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4F1A;&#x8C03;&#x7528;&#x63A5;&#x53E3;&#x7684;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;<br>&#x628A;Spring&#x5E95;&#x5C42;&#x7684;&#x7EC4;&#x4EF6;&#x6CE8;&#x518C;&#x5230;&#x81EA;&#x5B9A;&#x4E49;&#x7684;Bean&#x4E2D;<br>xxxAware&#x529F;&#x80FD;&#x4F7F;&#x7528;xxxProcessor&#x5904;&#x7406;&#x7684;</p>\n<ul>\n<li><p>ApplicationContextAware</p>\n<p>&#x83B7;&#x53D6;ApplicationContext</p>\n</li>\n<li><p>BeanNameAware</p>\n</li>\n<li><p>EmbeddedValueResolverAware</p>\n</li>\n</ul>\n</li>\n<li><p>Profile</p>\n<p>&#x52A0;&#x4E86;&#x73AF;&#x5883;&#x8868;&#x793A;&#x7684;bean&#xFF0C;&#x53EA;&#x6709;&#x8FD9;&#x4E2A;&#x73AF;&#x5883;&#x88AB;&#x6FC0;&#x6D3B;&#x7684;&#x65F6;&#x5019;&#x624D;&#x80FD;&#x6CE8;&#x518C;&#x5230;&#x5BB9;&#x5668;&#x4E2D;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;default&#x73AF;&#x5883;</p>\n<ul>\n<li><p>&#x542F;&#x52A8;&#x53C2;&#x6570;</p>\n<p>-Dspring.profiles.active=xxx</p>\n</li>\n<li><p>&#x4EE3;&#x7801;</p>\n<p>1.&#x521B;&#x5EFA;&#x4E00;&#x4E2A;aplicationContext<br>2.&#x8BBE;&#x7F6E;&#x9700;&#x8981;&#x6FC0;&#x6D3B;&#x7684;&#x73AF;&#x5883;.getEnvironment().setActiveProfiles()<br>3.&#x6CE8;&#x518C;&#x6731;&#x914D;&#x7F6E;&#x7C7B;  .register()<br>4.&#x542F;&#x52A8;&#x5237;&#x65B0;&#x5BB9;&#x5668; .refresh()</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"AOP\"><a href=\"#AOP\" class=\"headerlink\" title=\"AOP\"></a>AOP</h3><p>&#x5728;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x671F;&#x95F4;&#x52A8;&#x6001;&#x7684;&#x5C06;&#x67D0;&#x6BB5;&#x4EE3;&#x7801;&#x5207;&#x5165;&#x5230;&#x6307;&#x5B9A;&#x65B9;&#x6CD5;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x8FD0;&#x884C;&#x7684;&#x7F16;&#x7A0B;&#x65B9;&#x5F0F;<br>spring-aspects<br>&#x5BB9;&#x5668;&#x4E2D;&#x4FDD;&#x5B58;&#x4E86;&#x7EC4;&#x5EFA;&#x7684;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;(cglib&#x589E;&#x5F3A;&#x540E;&#x7684;&#x5BF9;&#x8C61;),&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x91CC;&#x9762;&#x4FDD;&#x5B58;&#x4E86;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;(&#x6BD4;&#x5982;&#x589E;&#x5F3A;&#x5668;&#xFF0C;&#x76EE;&#x6807;&#x5BF9;&#x8C61;)</p>\n<ul>\n<li><p>@Before</p>\n<p>&#x5728;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#x4E4B;&#x524D;&#x5207;&#x5165;&#xFF1A;&#x5207;&#x5165;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;&#xFF08;&#x6307;&#x5B9A;&#x5728;&#x90A3;&#x4E2A;&#x65B9;&#x6CD5;&#x5207;&#x5165;&#xFF09;</p>\n</li>\n<li><p>@After</p>\n<p>&#x5728;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#x4E4B;&#x540E;&#x5207;&#x5165;&#xFF1A;&#x5207;&#x5165;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;</p>\n</li>\n<li><p>@PointCut</p>\n<p>&#x5207;&#x5165;&#x70B9;&#x8868;&#x8FBE;&#x5F0F;</p>\n</li>\n<li><p>@AfterReturning</p>\n<p>&#x518D;&#x653E;&#x6807;&#x65B9;&#x6CD5;&#x6B63;&#x5E38;&#x8FD4;&#x56DE;&#x4E4B;&#x540E;&#x8FD0;&#x884C;</p>\n</li>\n<li><p>@AfterThrowing</p>\n<p>&#x5728;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x4E4B;&#x540E;&#x8FD0;&#x884C;</p>\n</li>\n<li><p>@Aspect</p>\n<p>&#x544A;&#x8BC9;Spring&#x5F53;&#x524D;&#x7C7B;&#x662F;&#x4E00;&#x4E2A;&#x5207;&#x9762;&#x7C7B;</p>\n</li>\n<li><p>@EnableAspectJAutoProxy</p>\n<p>&#x5F00;&#x542F;&#x57FA;&#x4E8E;&#x6CE8;&#x89E3;&#x7684;AOP<br>1.&#x7ED9;&#x5BB9;&#x5668;&#x4E2D;&#x5BFC;&#x5165;AspectJAutoProxyRegistrar&#xFF0C;&#x7ED9;&#x5BB9;&#x5668;&#x4E2D;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;AnnotationAwareAspectJAutoProxyCreator</p>\n<ul>\n<li><p>AnnotationAwareAspectJAutoProxyCreator</p>\n<ul>\n<li><p>AspectJAwareAdvisorAutoProxyCreator</p>\n<ul>\n<li><p>AbstractAdvisorAutoProxyCreator</p>\n<ul>\n<li><p>AbstractAutoProxyCreator</p>\n<ul>\n<li>SmartInstantiationAwareBeanPostProcessor</li>\n<li>BeanFactroyAware</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>JoinPoint</p>\n<p>JoinPoint&#x4E00;&#x5B9A;&#x8981;&#x51FA;&#x73B0;&#x5728;&#x53C2;&#x6570;&#x8868;&#x7684;&#x7B2C;&#x4E00;&#x4F4D;</p>\n</li>\n<li><p>&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#x6267;&#x884C;</p>\n<p>1.CglibAopProxy.intercept()&#x3002;&#x62E6;&#x622A;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#x7684;&#x6267;&#x884C;&#x3002;<br>2.&#x6839;&#x636E;PoxyFactory&#x5BF9;&#x8C61;&#x83B7;&#x53D6;&#x5C06;&#x8981;&#x6267;&#x884C;&#x7684;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#x62E6;&#x622A;&#x5668;&#x94FE;</p>\n<pre><code>a)&#x5982;&#x679C;&#x6CA1;&#x6709;&#x62E6;&#x622A;&#x5668;&#x94FE;&#xFF0C;&#x76F4;&#x63A5;&#x6267;&#x884C;&#x76EE;&#x6807;&#x65B9;&#x6CD5;\nb)&#x5982;&#x679C;&#x6709;&#x62E6;&#x622A;&#x5668;&#x94FE;&#xFF0C;&#x628A;&#x9700;&#x8981;&#x6267;&#x884C;&#x7684;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#xFF0C;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#xFF0C;&#x62E6;&#x622A;&#x5668;&#x94FE;&#x7B49;&#x4FE1;&#x606F;&#x51FA;&#x5165;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;CglibMethodInvocation&#xFF0C;&#x5E76;&#x8C03;&#x7528;proceed()&#x65B9;&#x6CD5;\nc)&#x62E6;&#x622A;&#x5668;&#x94FE;&#x89E6;&#x53D1;&#x8FC7;&#x7A0B;\n    1.&#x5982;&#x679C;&#x6CA1;&#x6709;&#x62E6;&#x622A;&#x5668;&#x6267;&#x884C;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#xFF0C;&#x6216;&#x8005;&#x61D2;&#x673A;&#x5668;&#x7684;&#x7D22;&#x5F15;&#x548C;&#x62E6;&#x622A;&#x5668;&#x6570;&#x7EC4;-1&#x5927;&#x5C0F;&#x4E00;&#x6837;(&#x6307;&#x5B9A;&#x5230;&#x4E86;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x62E6;&#x622A;&#x5668;)&#xFF0C;&#x6267;&#x884C;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#x3002;</code></pre>\n</li>\n</ul>\n<h3 id=\"&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;\"><a href=\"#&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;\" class=\"headerlink\" title=\"&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;\"></a>&#x58F0;&#x660E;&#x5F0F;&#x4E8B;&#x52A1;</h3><p>1.&#x5BFC;&#x5165;&#x76F8;&#x5173;&#x4F9D;&#x8D56;spring-jdbc<br>2.&#x914D;&#x7F6E;&#x6570;&#x636E;&#x6E90; JdbcTmplate<br>3.&#x7ED9;&#x65B9;&#x6CD5;&#x6807;&#x6CE8;@Transactional<br>4.@EnableTransactionManagement &#x5F00;&#x542F;&#x57FA;&#x4E8E;&#x6CE8;&#x89E3;&#x7684;&#x4E8B;&#x7269;<br>5.&#x914D;&#x7F6E;&#x4E8B;&#x7269;&#x7BA1;&#x7406;&#x5668;&#x7BA1;&#x7406;&#x4E8B;&#x7269;</p>\n<ul>\n<li><p>@Transactional</p>\n</li>\n<li><p>@EnableTransactionManagement</p>\n<ul>\n<li><p>TransactionManagementConfigurationSelection</p>\n<p>&#x7ED9;&#x5BB9;&#x5668;&#x4E2D;&#x5BFC;&#x5165;&#x7EC4;&#x4EF6;</p>\n<ul>\n<li><p>AutoProxyRegistrar</p>\n<p>&#x7ED9;&#x5BB9;&#x5668;&#x4E2D;&#x6CE8;&#x518C;InfrastructureAdvisorAutoProxyCreator&#x7EC4;&#x4EF6;</p>\n<ul>\n<li><p>InfrastructureAdvisorAutoProxyCreator</p>\n<p>&#x5229;&#x7528;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;&#x673A;&#x5236;&#x5728;&#x5BF9;&#x8C61;&#x521B;&#x5EFA;&#x540E;&#xFF0C;&#x5305;&#x88C5;&#x5BF9;&#x8C61;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#xFF08;&#x589E;&#x5F3A;&#x5668;&#xFF09;&#xFF0C;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x6267;&#x884C;&#x65B9;&#x6CD5;&#x5229;&#x7528;&#x62E6;&#x622A;&#x5668;&#x94FE;&#x6267;&#x884C;&#x65B9;&#x6CD5;</p>\n</li>\n</ul>\n</li>\n<li><p>ProxyTransactionManagementConfiguration</p>\n<p>1.&#x7ED9;&#x5BB9;&#x5668;&#x4E2D;&#x6CE8;&#x518C;&#x4E8B;&#x7269;&#x589E;&#x5F3A;&#x5668;</p>\n<pre><code>&#x4E8B;&#x7269;&#x589E;&#x5F3A;&#x5668;&#x8981;&#x7528;&#x4E8B;&#x7269;&#x6CE8;&#x89E3;&#x4FE1;&#x606F;\n&#x4E8B;&#x7269;&#x62E6;&#x622A;&#x5668;&#xFF0C;&#x4FDD;&#x5B58;&#x4E86;&#x4E8B;&#x7269;&#x7684;&#x5C5E;&#x6027;&#x4FE1;&#x606F;&#xFF0C;&#x4E8B;&#x7269;&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x662F;&#x4E00;&#x4E2A;MethodInterceptor&#xFF0C;&#x5728;&#x76EE;&#x6807;&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x65F6;&#x6267;&#x884C;&#x62E6;&#x622A;&#x5668;&#x94FE;</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"&#x6269;&#x5C55;&#x539F;&#x7406;\"><a href=\"#&#x6269;&#x5C55;&#x539F;&#x7406;\" class=\"headerlink\" title=\"&#x6269;&#x5C55;&#x539F;&#x7406;\"></a>&#x6269;&#x5C55;&#x539F;&#x7406;</h2><h3 id=\"BeanFactoryPostProcessor\"><a href=\"#BeanFactoryPostProcessor\" class=\"headerlink\" title=\"BeanFactoryPostProcessor\"></a>BeanFactoryPostProcessor</h3><p>BeanFactory&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;<br>    &#x5728;BeanFactory&#x6807;&#x51C6;&#x521D;&#x59CB;&#x5316;&#x4E4B;&#x540E;&#x8C03;&#x7528;&#xFF0C;&#x6240;&#x6709;&#x7684;bean&#x5B9A;&#x4E49;&#x4EE5;&#x4FDD;&#x5B58;&#x5728;&#x906D;&#x5230;beanFactory&#xFF0C;&#x4F46;&#x662F;bean&#x8FD8;&#x672A;&#x521B;&#x5EFA;</p>\n<ul>\n<li><p>BeanDefinitionRegistryPostProcessor</p>\n<p>&#x5728;&#x6240;&#x6709;bean&#x5B9A;&#x4E49;&#x4FE1;&#x606F;&#x5C06;&#x8981;&#x88AB;&#x52A0;&#x8F7D;&#xFF0C;bean&#x5B9E;&#x529B;&#x8FD8;&#x672A;&#x88AB;&#x521B;&#x5EFA;&#x65F6;&#x6267;&#x884C;</p>\n</li>\n</ul>\n<h3 id=\"ApplicationListener\"><a href=\"#ApplicationListener\" class=\"headerlink\" title=\"ApplicationListener\"></a>ApplicationListener</h3><p>&#x76D1;&#x542C;&#x5BB9;&#x5668;&#x4E2D;&#x53D1;&#x5E03;&#x7684;&#x4E8B;&#x4EF6;<br>    1.&#x5199;&#x4E00;&#x4E2A;&#x76D1;&#x542C;&#x5668;&#xFF0C;ApplicationListener&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x6765;&#x76D1;&#x542C;&#x67D0;&#x4E2A;&#x4E8B;&#x4EF6;ApplicationEvent&#x673A;&#x5668;&#x5B50;&#x7C7B;<br>    2.&#x628A;&#x76D1;&#x542C;&#x5668;&#x52A0;&#x5165;&#x5230;&#x5BB9;&#x5668;<br>    3.&#x53EA;&#x8981;&#x5BB9;&#x5668;&#x4E2D;&#x6709;&#x76F8;&#x5173;&#x4E8B;&#x4EF6;&#x7684;&#x8179;&#x90E8;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x80FD;&#x76D1;&#x542C;&#x5230;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;&#xFF1A;<br>        ContextRefreshedEvent&#xFF1A;&#x5BB9;&#x5668;&#x8212;&#x5FC3;&#x5B8C;&#x6210;(&#x6240;&#x6709;bean&#x90FD;&#x5B8C;&#x5168;&#x521B;&#x5EFA;)&#x4F1A;&#x53D1;&#x5E03;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;&#xFF1B;<br>        ContextClosedEvent&#xFF1A;&#x5173;&#x95ED;&#x5BB9;&#x5668;&#x4F1A;&#x53D1;&#x5E03;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;<br>    4.&#x53D1;&#x5E03;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;&#xFF0C;applicationContext.publishEvent()</p>\n<h3 id=\"&#x5BB9;&#x5668;&#x7684;&#x521B;&#x5EFA;\"><a href=\"#&#x5BB9;&#x5668;&#x7684;&#x521B;&#x5EFA;\" class=\"headerlink\" title=\"&#x5BB9;&#x5668;&#x7684;&#x521B;&#x5EFA;\"></a>&#x5BB9;&#x5668;&#x7684;&#x521B;&#x5EFA;</h3><p>1.Spring&#x5BB9;&#x5668;&#x5728;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5148;&#x4F1A;&#x4FDD;&#x5B58;&#x6240;&#x6709;&#x6CE8;&#x518C;&#x8FDB;&#x6765;&#x7684;Bean&#x7684;&#x5B9A;&#x4E49;&#x4FE1;&#x606F;<br>    xml<br>    &#x6CE8;&#x89E3;<br>2.Spring&#x5BB9;&#x5668;&#x4F1A;&#x5408;&#x9002;&#x7684;&#x65F6;&#x673A;&#x521B;&#x5EFA;&#x8FD9;&#x4E9B;Bean<br>    &#x7528;&#x5230;&#x8FD9;&#x4E2A;bean&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5229;&#x7528;getBean&#x521B;&#x5EFA;bean&#xFF0C;&#x521B;&#x5EFA;&#x597D;&#x4EE5;&#x540E;&#x4FDD;&#x5B58;&#x5728;&#x5BB9;&#x5668;&#x4E2D;<br>    &#x7EDF;&#x4E00;&#x521B;&#x5EFA;&#x5269;&#x4E0B;&#x6240;&#x6709;&#x7684;bean&#x7684;&#x65F6;&#x5019;&#xFF0C;finshBeanFactoryInitialization()<br>3.&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;<br>    &#x6BCF;&#x4E2A;bean&#x521B;&#x5EFA;&#x5B8C;&#x6210;&#xFF0C;&#x90FD;&#x4F1A;&#x4F7F;&#x7528;&#x5404;&#x79CD;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x6765;&#x589E;&#x5F3A;bean&#x7684;&#x529F;&#x80FD;<br>4.&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;&#x6A21;&#x578B;<br>    ApplicationListener&#xFF0C;&#x4E8B;&#x4EF6;&#x76D1;&#x542C;<br>&#x4E8B;&#x4EF6;&#x6D3E;&#x53D1;&#xFF0C;ApplicationEvenMulticator</p>\n<ul>\n<li><p>refresh()</p>\n<ul>\n<li><p>prepareRefresh()</p>\n<p>&#x5237;&#x65B0;&#x9884;&#x5904;&#x7406;&#x5DE5;&#x4F5C;:<br>&#x6E05;&#x7F13;&#x5B58;<br>&#x7F6E;&#x72B6;&#x6001;</p>\n<ul>\n<li><p>initPropertySources()</p>\n<p>&#x521D;&#x59CB;&#x5316;&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#xFF0C;&#x5B50;&#x7C7B;&#x81EA;&#x5B9A;&#x4E49;&#x4E2A;&#x6027;&#x5316;&#x7684;&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#x65B9;&#x6CD5;&#x3002;</p>\n</li>\n<li><p>getEnvironment().validateRequiredProperties()</p>\n<p>&#x68C0;&#x9A8C;&#x5C5E;&#x6027;&#x7684;&#x5408;&#x6CD5;</p>\n</li>\n<li><p>earlyApplicationEvents</p>\n<p>&#x4FDD;&#x5B58;&#x5BB9;&#x5668;&#x4E2D;&#x7684;&#x4E00;&#x8D77;&#x65E9;&#x8D77;&#x4E8B;&#x4EF6;</p>\n</li>\n</ul>\n</li>\n<li><p>obtainFreshBeanFactory()</p>\n<p>&#x83B7;&#x53D6;BeanFactory</p>\n<ul>\n<li><p>refreshBeanFactory()</p>\n<p>&#x5237;&#x65B0;BeanFactory&#x5DE5;&#x5382;&#xFF0C;&#x521B;&#x5EFA;BeanFactory&#x5BF9;&#x8C61;&#x3002;</p>\n</li>\n<li><p>getBeanFactory()&#x3010;DefaultListableBeanFactory&#x3011;</p>\n<p>&#x83B7;&#x53D6;&#x4E4B;&#x524D;&#x521B;&#x5EFA;&#x597D;&#x7684;BeanFactory</p>\n</li>\n<li><p>prepareBeanFactory()</p>\n<p>BeanFactory&#x7684;&#x9884;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#xFF08;BeanFactory&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x8BBE;&#x7F6E;&#xFF09;<br>1.&#x8BBE;&#x7F6E;BeanFactory&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#xFF0C;&#x652F;&#x6301;&#x8868;&#x8FBE;&#x5F0F;&#x89E3;&#x6790;&#x5668;&#x3002;&#x3002;&#x3002;<br>2.&#x6DFB;&#x52A0;&#x90E8;&#x5206;BeanPostProcessor&#x3010;ApplicationContextAwareProcessor&#x3011;<br>3.&#x8BBE;&#x7F6E;&#x5FFD;&#x7565;&#x7684;&#x81EA;&#x52A8;&#x88C5;&#x914D;&#x7684;&#x63A5;&#x53E3;&#xFF0C;EnvironmentAware&#x3001;EmbeddedValueResolverAware&#x3002;&#x3002;&#x3002;<br>4.&#x6CE8;&#x518C;&#x53EF;&#x4EE5;&#x89E3;&#x6790;&#x7684;&#x81EA;&#x52A8;&#x88C5;&#x914D;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x76F4;&#x63A5;&#x5728;&#x4ECD;&#x548C;&#x7EC4;&#x4EF6;&#x4E2D;&#x81EA;&#x52A8;&#x6CE8;&#x5165;&#xFF1A;BeanFactory&#x3001;ResourceLoader&#x3001;ApplicationEventPublisher&#x3001;ApplicationContext<br>5.&#x6DFB;&#x52A0;BeanPostProcessor&#x3010;ApplicationListenerDetector&#x3011;<br>6.&#x6DFB;&#x52A0;&#x7F16;&#x8BD1;&#x662F;&#x7684;AspectJ&#x652F;&#x6301;<br>7.&#x7ED9;BeanFactory&#x4E2D;&#x6CE8;&#x518C;&#x4E00;&#x4E9B;&#x80FD;&#x7528;&#x7684;&#x7EC4;&#x4EF6;&#xFF1A;environment&#x3010;ConfigurableEnvironment&#x3011;&#x3001;systemProperties&#x3010;Map&#x3011;</p>\n</li>\n<li><p>postProcessBeanFactory()</p>\n<p>BeanFactory&#x51C6;&#x5907;&#x5B8C;&#x6210;&#x540E;&#x7684;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5DE5;&#x4F5C;&#xFF0C;&#x5B50;&#x7C7B;&#x7528;&#x8FC7;&#x91CD;&#x5199;&#x8FD9;&#x4E2A;&#x53D1;&#x65B9;&#x6CD5;&#x6765;&#x5728;BeanFactory&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6210;&#x540E;&#x8FDB;&#x884C;&#x66F4;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x5DE5;&#x4F5C;</p>\n</li>\n<li><p>invokeBeanFactoryPostProcessors()</p>\n<p>&#x6267;&#x884C;BeanFactoryPostProcessor&#xFF1A;BeanFactory&#x7684;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x5728;BeanFactory&#x6807;&#x51C6;&#x521D;&#x59CB;&#x5316;&#x4E4B;&#x540E;&#x6267;&#x884C;</p>\n<p>&#x6267;&#x884C;BeanFactoryPostProcessor&#x7684;&#x65B9;&#x6CD5;&#xFF1A;<br>1.&#x5148;&#x6267;&#x884C;BeanDefinitonRegistryPostProcessor</p>\n<pre><code>&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;BeanDefinitonRegistryPostProcessor\n&#x5148;&#x6267;&#x884C;&#x5B9E;&#x73B0;&#x4E86;PriorityOrdered&#x63A5;&#x53E3;&#x7684;\n&#x518D;&#x6267;&#x884C;&#x5B9E;&#x73B0;&#x4E86;Ordered&#x63A5;&#x53E3;&#x7684;\n&#x6700;&#x540E;&#x6267;&#x884C;&#x5269;&#x4E0B;&#x7684;</code></pre>\n<p>2.&#x518D;&#x6267;&#x884C;BeanFactoryPostProcessor&#x7684;&#x65B9;&#x6CD5;</p>\n<pre><code>&#x5148;&#x6267;&#x884C;&#x5B9E;&#x73B0;&#x4E86;PriorityOrdered&#x63A5;&#x53E3;&#x7684;\n&#x518D;&#x6267;&#x884C;&#x5B9E;&#x73B0;&#x4E86;Ordered&#x63A5;&#x53E3;&#x7684;\n&#x6700;&#x540E;&#x6267;&#x884C;&#x5269;&#x4E0B;&#x7684;</code></pre>\n</li>\n</ul>\n</li>\n<li><p>registerBeanPostProcessors()</p>\n<p>&#x6CE8;&#x518C;BeanPostProcessor&#xFF0C;Bean&#x7684;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;&#x3002;<br>1.&#x83B7;&#x53D6;&#x6240;&#x6709;&#x7684;BeanPostProcessor&#xFF0C;&#x4E0D;&#x540C;&#x63A5;&#x53E3;&#x7C7B;&#x578B;&#x7684;BeanPostProcessor&#xFF0C;&#x5728;Bean&#x8239;&#x8230;&#x524D;&#x540E;&#x7684;&#x6267;&#x884C;&#x5B9E;&#x9645;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x3002;</p>\n<pre><code>BeanPostProcessor\nDestructionAwareBeanPostProcessor\nInstantiationAwareBeanPostProcessor\nSmartInstantiationAwareBeanPostProcessor\nMergedBeanDefinitionPostProcessor</code></pre>\n</li>\n<li><p>initMessageSource()</p>\n<p>&#x521D;&#x59CB;&#x5316;MessageSource&#x7EC4;&#x4EF6;&#xFF08;&#x505A;&#x56FD;&#x9645;&#x5316;&#x529F;&#x80FD;&#xFF0C;&#x6D88;&#x606F;&#x7ED1;&#x5B9A;&#x3001;&#x89E3;&#x6790;&#xFF09;<br>1.&#x83B7;&#x53D6;BeanFactory<br>2.&#x770B;&#x5BB9;&#x5668;&#x4E2D;&#x662F;&#x5426;&#x6709;id&#x4E3A;messageSource&#x7684;&#x7EC4;&#x4EF6;</p>\n<pre><code>&#x5982;&#x679C;&#x6709;&#x8D4B;&#x503C;&#x7ED9;messageSource&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x3010;DelegatingMessageSource&#x3011;</code></pre>\n<p>3.&#x628A;&#x521B;&#x5EFA;&#x597D;&#x7684;MessageSource&#x6CE8;&#x518C;&#x5728;&#x5BB9;&#x5668;&#x4E2D;</p>\n</li>\n<li><p>initApplicationEventMulticaster()</p>\n<p>&#x521D;&#x59CB;&#x5316;&#x4E8B;&#x4EF6;&#x6D3E;&#x53D1;&#x5668;<br>1.&#x4ECE;BeanFactory&#x4E2D;&#x83B7;&#x53D6;applicationEventMulticaster&#x7684;ApplicationEventMulticaster<br>2.&#x5982;&#x679C;&#x6CA1;&#x6709;&#x914D;&#x7F6E;&#xFF0C;&#x521B;&#x5EFA;SimpleApplicationEventMulticaster<br>3.&#x6CE8;&#x518C;&#x5230;&#x5BB9;&#x5668;&#x4E2D;</p>\n</li>\n<li><p>onRefresh()</p>\n<p>&#x7559;&#x7ED9;&#x5B50;&#x5BB9;&#x5668;&#x7684;&#xFF08;&#x5B50;&#x7C7B;&#xFF09;<br>1.&#x5B50;&#x7C7B;&#x91CD;&#x5199;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x5BB9;&#x5668;&#x5237;&#x65B0;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x903B;&#x8F91;</p>\n</li>\n<li><p>registerLiseners()</p>\n<p>&#x7ED9;&#x5BB9;&#x5668;&#x4E2D;&#x5C06;&#x6240;&#x6709;&#x7684;&#x9879;&#x76EE;&#x7684;ApplicationListener&#x6CE8;&#x518C;&#x8FDB;&#x6765;&#x3002;<br>1.&#x4ECE;&#x5BB9;&#x5668;&#x4E2D;&#x62FF;&#x5230;&#x6240;&#x6709;ApplicationListener&#x7EC4;&#x4EF6;<br>2.&#x5C06;&#x6BCF;&#x4E2A;&#x76D1;&#x542C;&#x5668;&#x6DFB;&#x52A0;&#x5230;&#x4E8B;&#x4EF6;&#x6D3E;&#x53D1;&#x5668;&#x4E2D;<br>3.&#x6D3E;&#x53D1;&#x4E4B;&#x524D;&#x6B65;&#x9AA4;&#x4EA7;&#x751F;&#x7684;&#x4E8B;&#x4EF6;</p>\n</li>\n<li><p>finishBeanFactoryInitialization()</p>\n<p>&#x521D;&#x59CB;&#x5316;&#x5269;&#x4E0B;&#x7684;&#x6240;&#x6709;&#x5355;&#x5B9E;&#x4F8B;bean</p>\n<ul>\n<li><p>beanFactory.preInstantiateSingletons()</p>\n<p>&#x521D;&#x59CB;&#x5316;&#x5269;&#x4E0B;&#x7684;&#x5355;&#x5B9E;&#x4F8B;bean<br>1.&#x83B7;&#x53D6;&#x5BB9;&#x5668;&#x4E2D;&#x6240;&#x6709;&#x7684;Bean&#x5B9A;&#x4E49;<br>2.&#x62FF;&#x5230;Bean&#x7684;&#x5B9A;&#x4E49;&#x4FE1;&#x606F;<br>3.Bean&#x4E0D;&#x662F;&#x62BD;&#x8C61;&#x7684;&#xFF0C;&#x662F;&#x5355;&#x5B9E;&#x4F8B;&#x7684;&#xFF0C;&#x4E0D;&#x662F;&#x61D2;&#x52A0;&#x8F7D;&#x7684;</p>\n<pre><code>1.&#x5224;&#x65AD;&#x662F;&#x5426;&#x662F;FactoryBean&#xFF0C;&#x662F;&#x5426;&#x662F;&#x5B9E;&#x73B0;FactoryBean&#x63A5;&#x53E3;&#x7684;Bean\n2.&#x4E0D;&#x662F;FactoryBean&#xFF0C;&#x7528;getBean&#x521B;&#x5EFA;&#x5BF9;&#x8C61;\n3.doGetBean()\n4.&#x5148;&#x83B7;&#x53D6;&#x7F13;&#x5B58;&#x4E2D;&#x4FDD;&#x5B58;&#x7684;&#x5355;&#x5B9E;&#x4F8B;Bean&#x3002;&#x5982;&#x679C;&#x83B7;&#x53D6;&#x5230;&#xFF0C;&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;Bean&#x4E4B;&#x524D;&#x88AB;&#x521B;&#x5EFA;&#x56FD;&#xFF08;&#x6240;&#x6709;&#x521B;&#x5EFA;&#x56FD;&#x7684;&#x5355;&#x5B9E;&#x4F8B;Bean&#x90FD;&#x662F;&#x4F1A;&#x88AB;&#x7F13;&#x5B58;&#x8D77;&#x6765;&#x7684;&#xFF09;\n5.&#x6362;&#x79CD;&#x79CD;&#x83B7;&#x53D6;&#x4E0D;&#x5230;&#xFF0C;&#x5F00;&#x59CB;Bean&#x7684;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x6D41;&#x7A0B;\n6.&#x6807;&#x8BB0;&#x5F53;&#x524D;bean&#x5DF2;&#x7ECF;&#x88AB;&#x521B;&#x5EFA;\n7.&#x83B7;&#x53D6;Bean&#x7684;&#x5B9A;&#x4E49;&#x4FE1;&#x606F;\n8.&#x83B7;&#x53D6;&#x5F53;&#x524D;Bean&#x4F9D;&#x8D56;&#x7684;&#x5176;&#x4ED6;Bean&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5C31;&#x6309;&#x7167;getBean()&#x628A;&#x4EE5;&#x6765;&#x7684;Bean&#x5148;&#x521B;&#x5EFA;&#x51FA;&#x6765;&#x3002;\n9.&#x542F;&#x52A8;&#x5355;&#x5B9E;&#x4F8B;Bean&#x7684;&#x521B;&#x5EFA;&#x6D41;&#x7A0B;\n    1.createBean()\n    2.resolveBeforeInstantiation()&#x8BA9;BeanPostProcessor&#x5148;&#x62E6;&#x622A;&#x8FD4;&#x56DE;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x3010;InstantiationAwareBeanPostProcessors&#x3011;&#x63D0;&#x524D;&#x6267;&#x884C;\n    3.&#x5982;&#x679C;&#x524D;&#x9762;&#x7684;InstantiationAwareBeanPostProcessors&#x6CA1;&#x6709;&#x8FD4;&#x56DE;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;\n    4.doCreateBean()&#x521B;&#x5EFA;Bean\n        1.&#x521B;&#x5EFA;Bean&#x5B9E;&#x4F8B;&#xFF0C;createBeanInstance()&#x5229;&#x7528;&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#x6216;&#x8005;&#x5BF9;&#x8C61;&#x7684;&#x6784;&#x9020;&#x5668;&#x521B;&#x5EFA;&#x51FA;Bean&#x5B9E;&#x4F8B;\n        2.applyMergedBeanDefinitionPostProcessors()&#xFF0C;&#x8C03;&#x7528;&#x3010;MergedBeanDefinitionPostProcessors&#x3011;\n        3.populateBean() Bean&#x5C5E;&#x6027;&#x8D4B;&#x503C;</code></pre>\n</li>\n</ul>\n</li>\n<li><p>finishRefresh()</p>\n<p>&#x5B8C;&#x6210;BeanFactory&#x7684;&#x521D;&#x59CB;&#x5316;&#x521B;&#x5EFA;&#x5DE5;&#x4F5C;&#xFF0C;IOC&#x5BB9;&#x5668;&#x5C31;&#x521B;&#x5EFA;&#x5B8C;&#x6210;</p>\n<ul>\n<li><p>initLifecycleProcessor()</p>\n<p>&#x521D;&#x59CB;&#x5316;&#x548C;&#x751F;&#x547D;&#x5468;&#x671F;&#x6709;&#x5173;&#x7684;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;&#xFF1A;LifecycleProcessor&#x3002;<br>&#x5199;&#x4E00;&#x4E2A;LifecycleProcessor&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;BeanFactory&#x7684;onRefresh(),onClose()&#x8FDB;&#x884C;&#x62E6;&#x622A;</p>\n</li>\n<li><p>getLifecycleProcessor().onRefresh()</p>\n<p>&#x62FF;&#x5230;&#x524D;&#x9762;&#x5B9A;&#x4E49;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x56DE;&#x8C03;onRefresh()</p>\n</li>\n<li><p>publishEvent()</p>\n<p>&#x53D1;&#x5E03;&#x5BB9;&#x5668;&#x5B8C;&#x6210;&#x4E8B;&#x4EF6;</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Springboot","path":"tags/Springboot/"}],"excerpt":"<html><head></head><body><h2 id=\"&#x5BB9;&#x5668;\"><a href=\"#&#x5BB9;&#x5668;\" class=\"headerlink\" title=\"&#x5BB9;&#x5668;\"></a>&#x5BB9;&#x5668;</h2><h3 id=\"IOC\"><a href=\"#IOC\" class=\"headerlink\" title=\"IOC\"></a>IOC</h3></body></html>","more":"<p>spring-context</p>\n<ul>\n<li><p>@Configuration</p>\n<p>å‘Šè¯‰Springè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»</p>\n</li>\n<li><p>@Bean</p>\n<p>ç»™å®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªBeanï¼Œç±»å‹ä¸ºè¿”å›å€¼çš„ç±»å‹ï¼Œidé»˜è®¤æ˜¯ç”¨æ–¹æ³•<br>é»˜è®¤éƒ½æ˜¯å•ä¾‹</p>\n</li>\n<li><p>AnnotationConfigApplicationContext</p>\n</li>\n<li><p>@ComponetScanã€@ComponetScans</p>\n<p>valueï¼šæ‰«æ@Service @Controller @Repositroy @Componet<br>excludeFltersï¼šæ’é™¤çš„è§„åˆ™<br>includeFiltersï¼šåªéœ€è¦åŒ…å«çš„è§„åˆ™</p>\n<ul>\n<li><p>FilterType.ANNOTATION</p>\n<p>æŒ‰ç…§æ³¨è§£</p>\n</li>\n<li><p>FilterType.ASSIGNABLE_TYPE</p>\n<p>æŒ‰ç…§ç»™å®šç±»å‹</p>\n</li>\n<li><p>FilterType.ASPECTJ</p>\n<p>ä½¿ç”¨ASPECTJè¡¨è¾¾å¼</p>\n</li>\n<li><p>FilterType.REGEX</p>\n<p>ä½¿ç”¨æ­£åˆ™æŒ‡å®š</p>\n</li>\n<li><p>FilterType.CUSTOM</p>\n<p>è‡ªå®šä¹‰è§„åˆ™ï¼Œå¿…é¡»å®ç°TypeFilterç±»</p>\n</li>\n</ul>\n</li>\n<li><p>@Scope</p>\n<ul>\n<li><p>SCOPE_PROTOTPE</p>\n<p>å¤šå®ä¾‹<br>IOCå®¹å™¨å¯åŠ¨ä¸å›å»è°ƒç”¨æ–¹æ³•åºŠæ¶ä½ å¯¹è±¡ï¼Œè·å–çš„æ—¶å€™åˆ›å»ºå¯¹è±¡</p>\n</li>\n<li><p>SCOPE_SINGLETON</p>\n<p>å•å®ä¾‹ï¼ˆé»˜è®¤å€¼ï¼‰<br>IOCå®¹å™¨å¯åŠ¨ä¼šè°ƒç”¨æ–¹æ³•åˆ›å»ºå¯¹è±¡æ”¾åˆ°IOCå®¹å™¨ä¸­</p>\n</li>\n<li><p>SCOPE_REQUEST</p>\n<p>åŒä¸€æ¬¡è¯·æ±‚åˆ›å»ºä¸€ä¸ªå®ä¾‹</p>\n</li>\n<li><p>SCOPE_SESSION</p>\n<p>åŒä¸€ä¸ªSessionåˆ›å»ºä¸€ä¸ªå®ä¾‹</p>\n</li>\n</ul>\n</li>\n<li><p>@Lazy </p>\n<p>æ‡’åŠ è½½ï¼šå®¹å™¨å¯åŠ¨ä¸åˆ›å»ºå¯¹è±¡ã€‚ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼ˆè·å–ï¼‰Beanå¯¹è±¡æ—¶è°ƒç”¨åˆ›å»ºå¯¹è±¡æ”¾å…¥å®¹å™¨</p>\n</li>\n<li><p>@Conditional</p>\n<p>æŒ‰ç…§ä¸€å®šçš„æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼Œæ»¡è¶³æ¡ä»¶ç»™å®¹å™¨ä¸­æ³¨å†ŒBean<br>éœ€è¦å®ç°Condition æ¥å£ï¼šConditionContext åˆ¤æ–­æ¡ä»¶èƒ½ä½¿ç”¨çš„ä¸Šä¸‹æ–‡ï¼›AnnotatedTypeMetadate æ³¨é‡Šä¿¡æ¯</p>\n</li>\n<li><p>@Import</p>\n<p>å¯¼å…¥ç»„ä»¶ï¼Œidé»˜è®¤æ˜¯ç»„ä»¶çš„å…¨ç±»åï¼ˆcom.xxx.xxx.xxï¼‰</p>\n<ul>\n<li><p>ImportSelector</p>\n<p>è‡ªå®šä¹‰é€»è¾‘è¿”å›éœ€è¦å¯¼å…¥çš„ç»„ä»¶ã€‚<br>è¿”å›å€¼å°±æ˜¯å¯¼å…¥åˆ°å®¹å™¨ä¸­çš„ç»„ä»¶å…¨ç±»åï¼Œæ–¹æ³•ä¸è¦è¿”å›nullã€‚<br>AnnotationMetadata å½“å‰æ ‡æ³¨@Importæ³¨è§£çš„ç±»çš„æ‰€æœ‰æ³¨é‡Šä¿¡æ¯ã€‚</p>\n</li>\n<li><p>ImportBeanDefinitionRegistrar</p>\n<p>BeanDefinitionRegistryï¼šBeanDefinitionæ³¨å†Œç±»ã€‚<br>è°ƒç”¨registerBeanDefinitionæ‰‹å·¥æ³¨å†ŒBean</p>\n</li>\n</ul>\n</li>\n<li><p>FactoryBean</p>\n<p>å®ç°FactoryBeanæ¥å£<br>1.å·¥å‚Beanè·å–çš„æ˜¯è°ƒç”¨getObjectåˆ›å»ºçš„å¯¹è±¡<br>2.è¦è·å–å·¥ç¨‹Beanæœ¬èº«ï¼Œéœ€è¦ç»™idå‰é¢åŠ ä¸€ä¸ª&amp;</p>\n</li>\n</ul>\n<h3 id=\"beançš„ç”Ÿå‘½å‘¨æœŸ\"><a href=\"#beançš„ç”Ÿå‘½å‘¨æœŸ\" class=\"headerlink\" title=\"beançš„ç”Ÿå‘½å‘¨æœŸ\"></a>beançš„ç”Ÿå‘½å‘¨æœŸ</h3><ul>\n<li><p>åˆå§‹åŒ–</p>\n<ul>\n<li><p>@Bean(initMethod)</p>\n</li>\n<li><p>InitializingBean</p>\n<p>é€šè¿‡è®©Beanå®ç°è¯¥æ¥å£ï¼Œå®ç°Beanåˆå§‹åŒ–é€»è¾‘</p>\n</li>\n<li><p>@PostConstruct</p>\n</li>\n<li><p>BeanPostProcessor</p>\n<p>Beanåç½®å¤„ç†å™¨ï¼Œåœ¨Beanåˆå§‹åŒ–å‰åè¿›è¡Œä¸€äº›å¤„ç†å·¥ä½œ</p>\n<ul>\n<li><p>postProcessBeforeInitialization</p>\n<p>åœ¨åˆå§‹åŒ–ä¹‹å‰</p>\n</li>\n<li><p>postProcessAfterInitialization</p>\n<p>åœ¨åˆå§‹åŒ–å·¥ä½œä¹‹å</p>\n</li>\n<li><p>ApplicationContextAwareProcessor</p>\n<p>å®ç°è¯¥æ¥å£ï¼ŒSpringå®¹å™¨å¯ä»¥å°†å½“å‰å®¹å™¨ä¼ ç»™å®ç°ç±»</p>\n</li>\n<li><p>InitDestroyAnnotationBeanPostProcessor</p>\n<p>å¤„ç†@PostConstructï¼Œ@PreDestoryæ³¨è§£</p>\n</li>\n<li><p>AutowiredAnnotationBeanPostProcessor</p>\n<p>å¤„ç†@Autowiredæ³¨è§£</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>é”€æ¯</p>\n<ul>\n<li><p>@Bean(destroyMethod)</p>\n<p>å¤šå®ä¾‹çš„beanï¼Œå®¹å™¨ä¸ä¼šè°ƒç”¨é”€æ¯æ–¹æ³•</p>\n</li>\n<li><p>DisposableBean</p>\n<p>é€šè¿‡å®ç°è¯¥æ¥å£ï¼Œå®ç°é”€æ¯é€»è¾‘</p>\n</li>\n<li><p>@PreDestory</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"å±æ€§èµ‹å€¼\"><a href=\"#å±æ€§èµ‹å€¼\" class=\"headerlink\" title=\"å±æ€§èµ‹å€¼\"></a>å±æ€§èµ‹å€¼</h3><ul>\n<li><p>@Value</p>\n<ul>\n<li><p>åŸºæœ¬æ•°å€¼</p>\n</li>\n<li><p>SpEL  #{}</p>\n</li>\n<li><p>é…ç½®æ–‡ä»¶ ${}</p>\n<p>@PropertySource è¯»å–å¤–éƒ¨é…ç½®æ–‡ä»¶ï¼Œä¿å­˜è‡³ç¯å¢ƒå˜é‡ä¸­</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"è‡ªåŠ¨è£…é…\"><a href=\"#è‡ªåŠ¨è£…é…\" class=\"headerlink\" title=\"è‡ªåŠ¨è£…é…\"></a>è‡ªåŠ¨è£…é…</h3><ul>\n<li><p>@Autowired</p>\n<p>1.é»˜è®¤æŒ‰ç…§ç±»å‹åœ¨å®¹å™¨ä¸­æ‰¾ç›¸åº”çš„ç»„ä»¶<br>2.å¦‚æœæ‰¾åˆ°å¤šä¸ªç›¸åŒç±»å‹çš„ç»„ä»¶ï¼Œå†å°†å±æ€§çš„åç§°ä½œä¸ºç»„ä»¶çš„idç»„å®¹æ˜“ä¸­å¯»æ‰¾<br>3.ä½¿ç”¨@QualifieræŒ‡å®šéœ€è¦è£…é…çš„ç»„ä»¶çš„id<br>4.è‡ªåŠ¨è£…é…é»˜è®¤ä¸€å®šè¦æŒ‡å®šå­˜åœ¨çš„å±æ€§ï¼ˆå¦‚æœä¸å¼ºåˆ¶æŒ‡å®šï¼Œä½¿ç”¨require=falseï¼‰<br>5.@Primary,è®©Springè¿›è¡Œè‡ªåŠ¨è£…é…çš„æ—¶å€™ï¼Œé»˜è®¤æ˜¯ç”¨é¦–é€‰çš„bean</p>\n<ul>\n<li><p>æ„é€ å™¨</p>\n<p>æ„é€ å™¨ç”¨åˆ°çš„è‡ªå®šä¹‰ç±»å‹çš„å€¼ä»IOCå®¹å™¨ä¸­è·å–<br>å¦‚æœç»„å»ºåªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨ï¼Œè¿™ä¸ªæœ‰å‚æ„é€ å™¨çš„@Autowiredå¯ä»¥çœç•¥ï¼Œå‚æ•°ä½ç½®çš„ç»„ä»¶è¿˜æ˜¯å¯ä»¥ä»å®¹å™¨ä¸­è·å–</p>\n</li>\n<li><p>æ–¹æ³•</p>\n<p>æ ‡æ³¨åœ¨æ–¹æ³•ï¼ŒSpringå®¹å™¨åˆ›å»ºå½“å‰å¯¹è±¡ï¼Œå°±ä¼šè°ƒç”¨æ–¹æ³•å®Œæˆèµ‹å€¼<br>æ–¹æ³•ä½¿ç”¨çš„å‚æ•°ï¼Œè‡ªå®šä¹‰ç±»å‹çš„å€¼ä»IOCå®¹å™¨ä¸­è·å–</p>\n</li>\n<li><p>å±æ€§</p>\n<p>å€¼ä»IOCå®¹å™¨ä¸­è·å–</p>\n</li>\n</ul>\n</li>\n<li><p>@Resource</p>\n<p>å¯ä»¥å’Œ@Autowiredä¸€æ ·å®ç°è‡ªåŠ¨è£…é…ï¼Œé»˜è®¤æŒ‰ç…§å±æ€§åç§°è¿›è¡Œè£…é…<br>æ²¡æœ‰æ”¯æŒ@PrimaryåŠŸèƒ½ï¼Œreqiured=false</p>\n</li>\n<li><p>@Inject</p>\n<p>éœ€è¦ä¾èµ–javax.injectåŒ…ï¼Œå’ŒAutowiredä¸€æ ·ï¼Œæ²¡æœ‰reqiured=false</p>\n</li>\n<li><p>å®ç°xxxAwareæ¥å£</p>\n<p>åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨æ¥å£çš„å›è°ƒæ–¹æ³•<br>æŠŠSpringåº•å±‚çš„ç»„ä»¶æ³¨å†Œåˆ°è‡ªå®šä¹‰çš„Beanä¸­<br>xxxAwareåŠŸèƒ½ä½¿ç”¨xxxProcessorå¤„ç†çš„</p>\n<ul>\n<li><p>ApplicationContextAware</p>\n<p>è·å–ApplicationContext</p>\n</li>\n<li><p>BeanNameAware</p>\n</li>\n<li><p>EmbeddedValueResolverAware</p>\n</li>\n</ul>\n</li>\n<li><p>Profile</p>\n<p>åŠ äº†ç¯å¢ƒè¡¨ç¤ºçš„beanï¼Œåªæœ‰è¿™ä¸ªç¯å¢ƒè¢«æ¿€æ´»çš„æ—¶å€™æ‰èƒ½æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œé»˜è®¤æ˜¯defaultç¯å¢ƒ</p>\n<ul>\n<li><p>å¯åŠ¨å‚æ•°</p>\n<p>-Dspring.profiles.active=xxx</p>\n</li>\n<li><p>ä»£ç </p>\n<p>1.åˆ›å»ºä¸€ä¸ªaplicationContext<br>2.è®¾ç½®éœ€è¦æ¿€æ´»çš„ç¯å¢ƒ.getEnvironment().setActiveProfiles()<br>3.æ³¨å†Œæœ±é…ç½®ç±»  .register()<br>4.å¯åŠ¨åˆ·æ–°å®¹å™¨ .refresh()</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"AOP\"><a href=\"#AOP\" class=\"headerlink\" title=\"AOP\"></a>AOP</h3><p>åœ¨ç¨‹åºè¿è¡ŒæœŸé—´åŠ¨æ€çš„å°†æŸæ®µä»£ç åˆ‡å…¥åˆ°æŒ‡å®šæ–¹æ³•æŒ‡å®šä½ç½®è¿›è¡Œè¿è¡Œçš„ç¼–ç¨‹æ–¹å¼<br>spring-aspects<br>å®¹å™¨ä¸­ä¿å­˜äº†ç»„å»ºçš„ä»£ç†å¯¹è±¡(cglibå¢å¼ºåçš„å¯¹è±¡),è¿™ä¸ªå¯¹è±¡é‡Œé¢ä¿å­˜äº†è¯¦ç»†ä¿¡æ¯(æ¯”å¦‚å¢å¼ºå™¨ï¼Œç›®æ ‡å¯¹è±¡)</p>\n<ul>\n<li><p>@Before</p>\n<p>åœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰åˆ‡å…¥ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ˆæŒ‡å®šåœ¨é‚£ä¸ªæ–¹æ³•åˆ‡å…¥ï¼‰</p>\n</li>\n<li><p>@After</p>\n<p>åœ¨ç›®æ ‡æ–¹æ³•ä¹‹ååˆ‡å…¥ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼</p>\n</li>\n<li><p>@PointCut</p>\n<p>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</p>\n</li>\n<li><p>@AfterReturning</p>\n<p>å†æ”¾æ ‡æ–¹æ³•æ­£å¸¸è¿”å›ä¹‹åè¿è¡Œ</p>\n</li>\n<li><p>@AfterThrowing</p>\n<p>åœ¨ç›®æ ‡æ–¹æ³•å‡ºç°å¼‚å¸¸ä¹‹åè¿è¡Œ</p>\n</li>\n<li><p>@Aspect</p>\n<p>å‘Šè¯‰Springå½“å‰ç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»</p>\n</li>\n<li><p>@EnableAspectJAutoProxy</p>\n<p>å¼€å¯åŸºäºæ³¨è§£çš„AOP<br>1.ç»™å®¹å™¨ä¸­å¯¼å…¥AspectJAutoProxyRegistrarï¼Œç»™å®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªAnnotationAwareAspectJAutoProxyCreator</p>\n<ul>\n<li><p>AnnotationAwareAspectJAutoProxyCreator</p>\n<ul>\n<li><p>AspectJAwareAdvisorAutoProxyCreator</p>\n<ul>\n<li><p>AbstractAdvisorAutoProxyCreator</p>\n<ul>\n<li><p>AbstractAutoProxyCreator</p>\n<ul>\n<li>SmartInstantiationAwareBeanPostProcessor</li>\n<li>BeanFactroyAware</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>JoinPoint</p>\n<p>JoinPointä¸€å®šè¦å‡ºç°åœ¨å‚æ•°è¡¨çš„ç¬¬ä¸€ä½</p>\n</li>\n<li><p>ç›®æ ‡æ–¹æ³•æ‰§è¡Œ</p>\n<p>1.CglibAopProxy.intercept()ã€‚æ‹¦æˆªç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œã€‚<br>2.æ ¹æ®PoxyFactoryå¯¹è±¡è·å–å°†è¦æ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•æ‹¦æˆªå™¨é“¾</p>\n<pre><code>a)å¦‚æœæ²¡æœ‰æ‹¦æˆªå™¨é“¾ï¼Œç›´æ¥æ‰§è¡Œç›®æ ‡æ–¹æ³•\nb)å¦‚æœæœ‰æ‹¦æˆªå™¨é“¾ï¼ŒæŠŠéœ€è¦æ‰§è¡Œçš„ç›®æ ‡å¯¹è±¡ï¼Œç›®æ ‡æ–¹æ³•ï¼Œæ‹¦æˆªå™¨é“¾ç­‰ä¿¡æ¯å‡ºå…¥åˆ›å»ºä¸€ä¸ªCglibMethodInvocationï¼Œå¹¶è°ƒç”¨proceed()æ–¹æ³•\nc)æ‹¦æˆªå™¨é“¾è§¦å‘è¿‡ç¨‹\n    1.å¦‚æœæ²¡æœ‰æ‹¦æˆªå™¨æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œæˆ–è€…æ‡’æœºå™¨çš„ç´¢å¼•å’Œæ‹¦æˆªå™¨æ•°ç»„-1å¤§å°ä¸€æ ·(æŒ‡å®šåˆ°äº†æœ€åä¸€ä¸ªæ‹¦æˆªå™¨)ï¼Œæ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‚</code></pre>\n</li>\n</ul>\n<h3 id=\"å£°æ˜å¼äº‹åŠ¡\"><a href=\"#å£°æ˜å¼äº‹åŠ¡\" class=\"headerlink\" title=\"å£°æ˜å¼äº‹åŠ¡\"></a>å£°æ˜å¼äº‹åŠ¡</h3><p>1.å¯¼å…¥ç›¸å…³ä¾èµ–spring-jdbc<br>2.é…ç½®æ•°æ®æº JdbcTmplate<br>3.ç»™æ–¹æ³•æ ‡æ³¨@Transactional<br>4.@EnableTransactionManagement å¼€å¯åŸºäºæ³¨è§£çš„äº‹ç‰©<br>5.é…ç½®äº‹ç‰©ç®¡ç†å™¨ç®¡ç†äº‹ç‰©</p>\n<ul>\n<li><p>@Transactional</p>\n</li>\n<li><p>@EnableTransactionManagement</p>\n<ul>\n<li><p>TransactionManagementConfigurationSelection</p>\n<p>ç»™å®¹å™¨ä¸­å¯¼å…¥ç»„ä»¶</p>\n<ul>\n<li><p>AutoProxyRegistrar</p>\n<p>ç»™å®¹å™¨ä¸­æ³¨å†ŒInfrastructureAdvisorAutoProxyCreatorç»„ä»¶</p>\n<ul>\n<li><p>InfrastructureAdvisorAutoProxyCreator</p>\n<p>åˆ©ç”¨åç½®å¤„ç†å™¨æœºåˆ¶åœ¨å¯¹è±¡åˆ›å»ºåï¼ŒåŒ…è£…å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆå¢å¼ºå™¨ï¼‰ï¼Œä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³•åˆ©ç”¨æ‹¦æˆªå™¨é“¾æ‰§è¡Œæ–¹æ³•</p>\n</li>\n</ul>\n</li>\n<li><p>ProxyTransactionManagementConfiguration</p>\n<p>1.ç»™å®¹å™¨ä¸­æ³¨å†Œäº‹ç‰©å¢å¼ºå™¨</p>\n<pre><code>äº‹ç‰©å¢å¼ºå™¨è¦ç”¨äº‹ç‰©æ³¨è§£ä¿¡æ¯\näº‹ç‰©æ‹¦æˆªå™¨ï¼Œä¿å­˜äº†äº‹ç‰©çš„å±æ€§ä¿¡æ¯ï¼Œäº‹ç‰©ç®¡ç†å™¨ï¼Œæ˜¯ä¸€ä¸ªMethodInterceptorï¼Œåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œæ—¶æ‰§è¡Œæ‹¦æˆªå™¨é“¾</code></pre>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"æ‰©å±•åŸç†\"><a href=\"#æ‰©å±•åŸç†\" class=\"headerlink\" title=\"æ‰©å±•åŸç†\"></a>æ‰©å±•åŸç†</h2><h3 id=\"BeanFactoryPostProcessor\"><a href=\"#BeanFactoryPostProcessor\" class=\"headerlink\" title=\"BeanFactoryPostProcessor\"></a>BeanFactoryPostProcessor</h3><p>BeanFactoryåç½®å¤„ç†å™¨<br>    åœ¨BeanFactoryæ ‡å‡†åˆå§‹åŒ–ä¹‹åè°ƒç”¨ï¼Œæ‰€æœ‰çš„beanå®šä¹‰ä»¥ä¿å­˜åœ¨é­åˆ°beanFactoryï¼Œä½†æ˜¯beanè¿˜æœªåˆ›å»º</p>\n<ul>\n<li><p>BeanDefinitionRegistryPostProcessor</p>\n<p>åœ¨æ‰€æœ‰beanå®šä¹‰ä¿¡æ¯å°†è¦è¢«åŠ è½½ï¼Œbeanå®åŠ›è¿˜æœªè¢«åˆ›å»ºæ—¶æ‰§è¡Œ</p>\n</li>\n</ul>\n<h3 id=\"ApplicationListener\"><a href=\"#ApplicationListener\" class=\"headerlink\" title=\"ApplicationListener\"></a>ApplicationListener</h3><p>ç›‘å¬å®¹å™¨ä¸­å‘å¸ƒçš„äº‹ä»¶<br>    1.å†™ä¸€ä¸ªç›‘å¬å™¨ï¼ŒApplicationListenerå®ç°ç±»ï¼Œæ¥ç›‘å¬æŸä¸ªäº‹ä»¶ApplicationEventæœºå™¨å­ç±»<br>    2.æŠŠç›‘å¬å™¨åŠ å…¥åˆ°å®¹å™¨<br>    3.åªè¦å®¹å™¨ä¸­æœ‰ç›¸å…³äº‹ä»¶çš„è…¹éƒ¨ï¼Œæˆ‘ä»¬å°±èƒ½ç›‘å¬åˆ°è¿™ä¸ªäº‹ä»¶ï¼š<br>        ContextRefreshedEventï¼šå®¹å™¨èˆ’å¿ƒå®Œæˆ(æ‰€æœ‰beanéƒ½å®Œå…¨åˆ›å»º)ä¼šå‘å¸ƒè¿™ä¸ªäº‹ä»¶ï¼›<br>        ContextClosedEventï¼šå…³é—­å®¹å™¨ä¼šå‘å¸ƒè¿™ä¸ªäº‹ä»¶<br>    4.å‘å¸ƒä¸€ä¸ªäº‹ä»¶ï¼ŒapplicationContext.publishEvent()</p>\n<h3 id=\"å®¹å™¨çš„åˆ›å»º\"><a href=\"#å®¹å™¨çš„åˆ›å»º\" class=\"headerlink\" title=\"å®¹å™¨çš„åˆ›å»º\"></a>å®¹å™¨çš„åˆ›å»º</h3><p>1.Springå®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå…ˆä¼šä¿å­˜æ‰€æœ‰æ³¨å†Œè¿›æ¥çš„Beançš„å®šä¹‰ä¿¡æ¯<br>    xml<br>    æ³¨è§£<br>2.Springå®¹å™¨ä¼šåˆé€‚çš„æ—¶æœºåˆ›å»ºè¿™äº›Bean<br>    ç”¨åˆ°è¿™ä¸ªbeançš„æ—¶å€™ï¼Œåˆ©ç”¨getBeanåˆ›å»ºbeanï¼Œåˆ›å»ºå¥½ä»¥åä¿å­˜åœ¨å®¹å™¨ä¸­<br>    ç»Ÿä¸€åˆ›å»ºå‰©ä¸‹æ‰€æœ‰çš„beançš„æ—¶å€™ï¼ŒfinshBeanFactoryInitialization()<br>3.åç½®å¤„ç†å™¨<br>    æ¯ä¸ªbeanåˆ›å»ºå®Œæˆï¼Œéƒ½ä¼šä½¿ç”¨å„ç§åç½®å¤„ç†å™¨ï¼Œæ¥å¢å¼ºbeançš„åŠŸèƒ½<br>4.äº‹ä»¶é©±åŠ¨æ¨¡å‹<br>    ApplicationListenerï¼Œäº‹ä»¶ç›‘å¬<br>äº‹ä»¶æ´¾å‘ï¼ŒApplicationEvenMulticator</p>\n<ul>\n<li><p>refresh()</p>\n<ul>\n<li><p>prepareRefresh()</p>\n<p>åˆ·æ–°é¢„å¤„ç†å·¥ä½œ:<br>æ¸…ç¼“å­˜<br>ç½®çŠ¶æ€</p>\n<ul>\n<li><p>initPropertySources()</p>\n<p>åˆå§‹åŒ–å±æ€§è®¾ç½®ï¼Œå­ç±»è‡ªå®šä¹‰ä¸ªæ€§åŒ–çš„å±æ€§è®¾ç½®æ–¹æ³•ã€‚</p>\n</li>\n<li><p>getEnvironment().validateRequiredProperties()</p>\n<p>æ£€éªŒå±æ€§çš„åˆæ³•</p>\n</li>\n<li><p>earlyApplicationEvents</p>\n<p>ä¿å­˜å®¹å™¨ä¸­çš„ä¸€èµ·æ—©èµ·äº‹ä»¶</p>\n</li>\n</ul>\n</li>\n<li><p>obtainFreshBeanFactory()</p>\n<p>è·å–BeanFactory</p>\n<ul>\n<li><p>refreshBeanFactory()</p>\n<p>åˆ·æ–°BeanFactoryå·¥å‚ï¼Œåˆ›å»ºBeanFactoryå¯¹è±¡ã€‚</p>\n</li>\n<li><p>getBeanFactory()ã€DefaultListableBeanFactoryã€‘</p>\n<p>è·å–ä¹‹å‰åˆ›å»ºå¥½çš„BeanFactory</p>\n</li>\n<li><p>prepareBeanFactory()</p>\n<p>BeanFactoryçš„é¢„å‡†å¤‡å·¥ä½œï¼ˆBeanFactoryè¿›è¡Œä¸€äº›è®¾ç½®ï¼‰<br>1.è®¾ç½®BeanFactoryçš„ç±»åŠ è½½å™¨ï¼Œæ”¯æŒè¡¨è¾¾å¼è§£æå™¨ã€‚ã€‚ã€‚<br>2.æ·»åŠ éƒ¨åˆ†BeanPostProcessorã€ApplicationContextAwareProcessorã€‘<br>3.è®¾ç½®å¿½ç•¥çš„è‡ªåŠ¨è£…é…çš„æ¥å£ï¼ŒEnvironmentAwareã€EmbeddedValueResolverAwareã€‚ã€‚ã€‚<br>4.æ³¨å†Œå¯ä»¥è§£æçš„è‡ªåŠ¨è£…é…ï¼Œæˆ‘ä»¬èƒ½ç›´æ¥åœ¨ä»å’Œç»„ä»¶ä¸­è‡ªåŠ¨æ³¨å…¥ï¼šBeanFactoryã€ResourceLoaderã€ApplicationEventPublisherã€ApplicationContext<br>5.æ·»åŠ BeanPostProcessorã€ApplicationListenerDetectorã€‘<br>6.æ·»åŠ ç¼–è¯‘æ˜¯çš„AspectJæ”¯æŒ<br>7.ç»™BeanFactoryä¸­æ³¨å†Œä¸€äº›èƒ½ç”¨çš„ç»„ä»¶ï¼šenvironmentã€ConfigurableEnvironmentã€‘ã€systemPropertiesã€Mapã€‘</p>\n</li>\n<li><p>postProcessBeanFactory()</p>\n<p>BeanFactoryå‡†å¤‡å®Œæˆåçš„åç½®å¤„ç†å·¥ä½œï¼Œå­ç±»ç”¨è¿‡é‡å†™è¿™ä¸ªå‘æ–¹æ³•æ¥åœ¨BeanFactoryåˆå§‹åŒ–å®Œæˆåè¿›è¡Œæ›´è¿›ä¸€æ­¥çš„å·¥ä½œ</p>\n</li>\n<li><p>invokeBeanFactoryPostProcessors()</p>\n<p>æ‰§è¡ŒBeanFactoryPostProcessorï¼šBeanFactoryçš„åç½®å¤„ç†å™¨ï¼Œåœ¨BeanFactoryæ ‡å‡†åˆå§‹åŒ–ä¹‹åæ‰§è¡Œ</p>\n<p>æ‰§è¡ŒBeanFactoryPostProcessorçš„æ–¹æ³•ï¼š<br>1.å…ˆæ‰§è¡ŒBeanDefinitonRegistryPostProcessor</p>\n<pre><code>è·å–æ‰€æœ‰çš„BeanDefinitonRegistryPostProcessor\nå…ˆæ‰§è¡Œå®ç°äº†PriorityOrderedæ¥å£çš„\nå†æ‰§è¡Œå®ç°äº†Orderedæ¥å£çš„\næœ€åæ‰§è¡Œå‰©ä¸‹çš„</code></pre>\n<p>2.å†æ‰§è¡ŒBeanFactoryPostProcessorçš„æ–¹æ³•</p>\n<pre><code>å…ˆæ‰§è¡Œå®ç°äº†PriorityOrderedæ¥å£çš„\nå†æ‰§è¡Œå®ç°äº†Orderedæ¥å£çš„\næœ€åæ‰§è¡Œå‰©ä¸‹çš„</code></pre>\n</li>\n</ul>\n</li>\n<li><p>registerBeanPostProcessors()</p>\n<p>æ³¨å†ŒBeanPostProcessorï¼ŒBeançš„åç½®å¤„ç†å™¨ã€‚<br>1.è·å–æ‰€æœ‰çš„BeanPostProcessorï¼Œä¸åŒæ¥å£ç±»å‹çš„BeanPostProcessorï¼Œåœ¨Beanèˆ¹èˆ°å‰åçš„æ‰§è¡Œå®é™…æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>\n<pre><code>BeanPostProcessor\nDestructionAwareBeanPostProcessor\nInstantiationAwareBeanPostProcessor\nSmartInstantiationAwareBeanPostProcessor\nMergedBeanDefinitionPostProcessor</code></pre>\n</li>\n<li><p>initMessageSource()</p>\n<p>åˆå§‹åŒ–MessageSourceç»„ä»¶ï¼ˆåšå›½é™…åŒ–åŠŸèƒ½ï¼Œæ¶ˆæ¯ç»‘å®šã€è§£æï¼‰<br>1.è·å–BeanFactory<br>2.çœ‹å®¹å™¨ä¸­æ˜¯å¦æœ‰idä¸ºmessageSourceçš„ç»„ä»¶</p>\n<pre><code>å¦‚æœæœ‰èµ‹å€¼ç»™messageSourceï¼Œå¦‚æœæ²¡æœ‰è‡ªå·±åˆ›å»ºã€DelegatingMessageSourceã€‘</code></pre>\n<p>3.æŠŠåˆ›å»ºå¥½çš„MessageSourceæ³¨å†Œåœ¨å®¹å™¨ä¸­</p>\n</li>\n<li><p>initApplicationEventMulticaster()</p>\n<p>åˆå§‹åŒ–äº‹ä»¶æ´¾å‘å™¨<br>1.ä»BeanFactoryä¸­è·å–applicationEventMulticasterçš„ApplicationEventMulticaster<br>2.å¦‚æœæ²¡æœ‰é…ç½®ï¼Œåˆ›å»ºSimpleApplicationEventMulticaster<br>3.æ³¨å†Œåˆ°å®¹å™¨ä¸­</p>\n</li>\n<li><p>onRefresh()</p>\n<p>ç•™ç»™å­å®¹å™¨çš„ï¼ˆå­ç±»ï¼‰<br>1.å­ç±»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨å®¹å™¨åˆ·æ–°çš„æ—¶å€™å¯ä»¥è‡ªå®šä¹‰é€»è¾‘</p>\n</li>\n<li><p>registerLiseners()</p>\n<p>ç»™å®¹å™¨ä¸­å°†æ‰€æœ‰çš„é¡¹ç›®çš„ApplicationListeneræ³¨å†Œè¿›æ¥ã€‚<br>1.ä»å®¹å™¨ä¸­æ‹¿åˆ°æ‰€æœ‰ApplicationListenerç»„ä»¶<br>2.å°†æ¯ä¸ªç›‘å¬å™¨æ·»åŠ åˆ°äº‹ä»¶æ´¾å‘å™¨ä¸­<br>3.æ´¾å‘ä¹‹å‰æ­¥éª¤äº§ç”Ÿçš„äº‹ä»¶</p>\n</li>\n<li><p>finishBeanFactoryInitialization()</p>\n<p>åˆå§‹åŒ–å‰©ä¸‹çš„æ‰€æœ‰å•å®ä¾‹bean</p>\n<ul>\n<li><p>beanFactory.preInstantiateSingletons()</p>\n<p>åˆå§‹åŒ–å‰©ä¸‹çš„å•å®ä¾‹bean<br>1.è·å–å®¹å™¨ä¸­æ‰€æœ‰çš„Beanå®šä¹‰<br>2.æ‹¿åˆ°Beançš„å®šä¹‰ä¿¡æ¯<br>3.Beanä¸æ˜¯æŠ½è±¡çš„ï¼Œæ˜¯å•å®ä¾‹çš„ï¼Œä¸æ˜¯æ‡’åŠ è½½çš„</p>\n<pre><code>1.åˆ¤æ–­æ˜¯å¦æ˜¯FactoryBeanï¼Œæ˜¯å¦æ˜¯å®ç°FactoryBeanæ¥å£çš„Bean\n2.ä¸æ˜¯FactoryBeanï¼Œç”¨getBeanåˆ›å»ºå¯¹è±¡\n3.doGetBean()\n4.å…ˆè·å–ç¼“å­˜ä¸­ä¿å­˜çš„å•å®ä¾‹Beanã€‚å¦‚æœè·å–åˆ°ï¼Œè¯´æ˜è¿™ä¸ªBeanä¹‹å‰è¢«åˆ›å»ºå›½ï¼ˆæ‰€æœ‰åˆ›å»ºå›½çš„å•å®ä¾‹Beanéƒ½æ˜¯ä¼šè¢«ç¼“å­˜èµ·æ¥çš„ï¼‰\n5.æ¢ç§ç§è·å–ä¸åˆ°ï¼Œå¼€å§‹Beançš„åˆ›å»ºå¯¹è±¡æµç¨‹\n6.æ ‡è®°å½“å‰beanå·²ç»è¢«åˆ›å»º\n7.è·å–Beançš„å®šä¹‰ä¿¡æ¯\n8.è·å–å½“å‰Beanä¾èµ–çš„å…¶ä»–Beanï¼Œå¦‚æœæœ‰å°±æŒ‰ç…§getBean()æŠŠä»¥æ¥çš„Beanå…ˆåˆ›å»ºå‡ºæ¥ã€‚\n9.å¯åŠ¨å•å®ä¾‹Beançš„åˆ›å»ºæµç¨‹\n    1.createBean()\n    2.resolveBeforeInstantiation()è®©BeanPostProcessorå…ˆæ‹¦æˆªè¿”å›ä»£ç†å¯¹è±¡ã€InstantiationAwareBeanPostProcessorsã€‘æå‰æ‰§è¡Œ\n    3.å¦‚æœå‰é¢çš„InstantiationAwareBeanPostProcessorsæ²¡æœ‰è¿”å›ä»£ç†å¯¹è±¡\n    4.doCreateBean()åˆ›å»ºBean\n        1.åˆ›å»ºBeanå®ä¾‹ï¼ŒcreateBeanInstance()åˆ©ç”¨å·¥å‚æ–¹æ³•æˆ–è€…å¯¹è±¡çš„æ„é€ å™¨åˆ›å»ºå‡ºBeanå®ä¾‹\n        2.applyMergedBeanDefinitionPostProcessors()ï¼Œè°ƒç”¨ã€MergedBeanDefinitionPostProcessorsã€‘\n        3.populateBean() Beanå±æ€§èµ‹å€¼</code></pre>\n</li>\n</ul>\n</li>\n<li><p>finishRefresh()</p>\n<p>å®ŒæˆBeanFactoryçš„åˆå§‹åŒ–åˆ›å»ºå·¥ä½œï¼ŒIOCå®¹å™¨å°±åˆ›å»ºå®Œæˆ</p>\n<ul>\n<li><p>initLifecycleProcessor()</p>\n<p>åˆå§‹åŒ–å’Œç”Ÿå‘½å‘¨æœŸæœ‰å…³çš„åç½®å¤„ç†å™¨ï¼šLifecycleProcessorã€‚<br>å†™ä¸€ä¸ªLifecycleProcessorçš„å®ç°ç±»ï¼Œå¯ä»¥åœ¨BeanFactoryçš„onRefresh(),onClose()è¿›è¡Œæ‹¦æˆª</p>\n</li>\n<li><p>getLifecycleProcessor().onRefresh()</p>\n<p>æ‹¿åˆ°å‰é¢å®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨ï¼Œå›è°ƒonRefresh()</p>\n</li>\n<li><p>publishEvent()</p>\n<p>å‘å¸ƒå®¹å™¨å®Œæˆäº‹ä»¶</p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>"},{"title":"hexoæ­å»ºé—®é¢˜ã€ no layout: index.htmlã€‘","date":"2019-09-07T08:03:18.000Z","_content":"\nç”±äºåœ¨å…¬å¸éƒ½æ˜¯ç”¨MACå†™åšå®¢ï¼Œå›åˆ°å®¶æƒ³ç”¨Windowsæ­ä¸€å¥—ç¯å¢ƒã€‚\n\nä½†æ˜¯å¯åŠ¨çš„æ—¶å€™æ€»æ˜¯æç¤ºno layout: index.html çš„é”™è¯¯ã€‚\n\næ‰¾äº†åŠå¤©åŸå› åŸæ¥æ˜¯ä¸ªå¾ˆå‚»çš„é—®é¢˜ï¼Œè¿™é‡Œmarkä¸‹ä»¥å…ä¸‹æ¬¡å†çŠ¯ã€‚\n\n![01](hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘/nolayout.jpg)\n\næ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼","source":"_posts/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘.md","raw":"---\ntitle: 'hexoæ­å»ºé—®é¢˜ã€ no layout: index.htmlã€‘'\ndate: 2019-09-07 16:03:18\ntags: \n    - Hexo\ncategories :\n    - Technology\n---\n\nç”±äºåœ¨å…¬å¸éƒ½æ˜¯ç”¨MACå†™åšå®¢ï¼Œå›åˆ°å®¶æƒ³ç”¨Windowsæ­ä¸€å¥—ç¯å¢ƒã€‚\n\nä½†æ˜¯å¯åŠ¨çš„æ—¶å€™æ€»æ˜¯æç¤ºno layout: index.html çš„é”™è¯¯ã€‚\n\næ‰¾äº†åŠå¤©åŸå› åŸæ¥æ˜¯ä¸ªå¾ˆå‚»çš„é—®é¢˜ï¼Œè¿™é‡Œmarkä¸‹ä»¥å…ä¸‹æ¬¡å†çŠ¯ã€‚\n\n![01](hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘/nolayout.jpg)\n\næ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼","slug":"hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘","published":1,"updated":"2020-12-14T10:40:39.272Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71ht6000cv2526aao0clh","content":"<html><head></head><body><p>&#x7531;&#x4E8E;&#x5728;&#x516C;&#x53F8;&#x90FD;&#x662F;&#x7528;MAC&#x5199;&#x535A;&#x5BA2;&#xFF0C;&#x56DE;&#x5230;&#x5BB6;&#x60F3;&#x7528;Windows&#x642D;&#x4E00;&#x5957;&#x73AF;&#x5883;&#x3002;</p>\n<p>&#x4F46;&#x662F;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x603B;&#x662F;&#x63D0;&#x793A;no layout: index.html &#x7684;&#x9519;&#x8BEF;&#x3002;</p>\n<p>&#x627E;&#x4E86;&#x534A;&#x5929;&#x539F;&#x56E0;&#x539F;&#x6765;&#x662F;&#x4E2A;&#x5F88;&#x50BB;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x91CC;mark&#x4E0B;&#x4EE5;&#x514D;&#x4E0B;&#x6B21;&#x518D;&#x72AF;&#x3002;</p>\n<p><img src=\"/2019/09/07/hexo%E6%90%AD%E5%BB%BA%E9%97%AE%E9%A2%98%E3%80%90-no-layout-index-html%E3%80%91/nolayout.jpg\" alt=\"01\"></p>\n<p>&#x6A21;&#x677F;&#x662F;&#x7A7A;&#x7684;&#xFF01;&#xFF01;&#xFF01;&#x6A21;&#x677F;&#x662F;&#x7A7A;&#x7684;&#xFF01;&#xFF01;&#xFF01;&#x6A21;&#x677F;&#x662F;&#x7A7A;&#x7684;&#xFF01;&#xFF01;&#xFF01;</p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Hexo","path":"tags/Hexo/"}],"excerpt":"","more":"<p>ç”±äºåœ¨å…¬å¸éƒ½æ˜¯ç”¨MACå†™åšå®¢ï¼Œå›åˆ°å®¶æƒ³ç”¨Windowsæ­ä¸€å¥—ç¯å¢ƒã€‚</p>\n<p>ä½†æ˜¯å¯åŠ¨çš„æ—¶å€™æ€»æ˜¯æç¤ºno layout: index.html çš„é”™è¯¯ã€‚</p>\n<p>æ‰¾äº†åŠå¤©åŸå› åŸæ¥æ˜¯ä¸ªå¾ˆå‚»çš„é—®é¢˜ï¼Œè¿™é‡Œmarkä¸‹ä»¥å…ä¸‹æ¬¡å†çŠ¯ã€‚</p>\n<p><img src=\"/2019/09/07/hexo%E6%90%AD%E5%BB%BA%E9%97%AE%E9%A2%98%E3%80%90-no-layout-index-html%E3%80%91/nolayout.jpg\" alt=\"01\"></p>\n<p>æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼æ¨¡æ¿æ˜¯ç©ºçš„ï¼ï¼ï¼</p>\n"},{"title":"linuxæä¾›åŠ è½½ã€å¤„ç†åŠ¨æ€é“¾æ¥åº“çš„ç³»ç»Ÿè°ƒç”¨æ–¹æ³•","date":"2020-09-24T06:44:08.000Z","_content":"\næˆ‘ä»¬çŸ¥é“ç›®å‰Javaæä¾›çš„å·¥å…·å¦‚javacã€jpsã€jstatã€jmapç­‰éƒ½æ˜¯é€šè¿‡Javaçš„è‡ªä¸¾å®ç°çš„ã€‚ç„¶è€Œå¯åŠ¨JVMçš„å‘½ä»¤çš„javaå´æ˜¯ç”±Cè¯­è¨€å¼€å‘çš„ã€‚è‡³äºåŸå› é€šè¿‡ç¿»é˜…OpenJdkæºç æˆ‘çŒœæµ‹ï¼šæ˜¯ä¸ºäº†ä¸æä¾›JNIæ¥å£çš„å‰æä¸‹ï¼Œéœ€è¦åŠ¨æ€é“¾æ¥è°ƒç”¨JVMåº“æ‰€å¯¼è‡´çš„ã€‚\n<!-- more -->\n\n### java.cä¸­åŠ¨æ€é“¾æ¥jvmåº“ç›¸å…³ä»£ç \n\n>ä»£ç æ¸…å•ï¼šsrc/solaris/bin/java_md_solinux.c\n```C\njboolean\nLoadJavaVM(const char *jvmpath, InvocationFunctions *ifn)\n{\n    void *libjvm;\n\n    JLI_TraceLauncher(\"JVM path is %s\\n\", jvmpath);\n\n    libjvm = dlopen(jvmpath, RTLD_NOW + RTLD_GLOBAL);\n    if (libjvm == NULL) {\n#if defined(__solaris__) && defined(__sparc) && !defined(_LP64) /* i.e. 32-bit sparc */\n      FILE * fp;\n      Elf32_Ehdr elf_head;\n      int count;\n      int location;\n\n      fp = fopen(jvmpath, \"r\");\n      if (fp == NULL) {\n        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());\n        return JNI_FALSE;\n      }\n\n      /* read in elf header */\n      count = fread((void*)(&elf_head), sizeof(Elf32_Ehdr), 1, fp);\n      fclose(fp);\n      if (count < 1) {\n        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());\n        return JNI_FALSE;\n      }\n\n      /*\n       * Check for running a server vm (compiled with -xarch=v8plus)\n       * on a stock v8 processor.  In this case, the machine type in\n       * the elf header would not be included the architecture list\n       * provided by the isalist command, which is turn is gotten from\n       * sysinfo.  This case cannot occur on 64-bit hardware and thus\n       * does not have to be checked for in binaries with an LP64 data\n       * model.\n       */\n      if (elf_head.e_machine == EM_SPARC32PLUS) {\n        char buf[257];  /* recommended buffer size from sysinfo man\n                           page */\n        long length;\n        char* location;\n\n        length = sysinfo(SI_ISALIST, buf, 257);\n        if (length > 0) {\n            location = JLI_StrStr(buf, \"sparcv8plus \");\n          if (location == NULL) {\n            JLI_ReportErrorMessage(JVM_ERROR3);\n            return JNI_FALSE;\n          }\n        }\n      }\n#endif\n        JLI_ReportErrorMessage(DLL_ERROR1, __LINE__);\n        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());\n        return JNI_FALSE;\n    }\n\n    ifn->CreateJavaVM = (CreateJavaVM_t)\n        dlsym(libjvm, \"JNI_CreateJavaVM\");\n    if (ifn->CreateJavaVM == NULL) {\n        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());\n        return JNI_FALSE;\n    }\n\n    ifn->GetDefaultJavaVMInitArgs = (GetDefaultJavaVMInitArgs_t)\n        dlsym(libjvm, \"JNI_GetDefaultJavaVMInitArgs\");\n    if (ifn->GetDefaultJavaVMInitArgs == NULL) {\n        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());\n        return JNI_FALSE;\n    }\n\n    ifn->GetCreatedJavaVMs = (GetCreatedJavaVMs_t)\n        dlsym(libjvm, \"JNI_GetCreatedJavaVMs\");\n    if (ifn->GetCreatedJavaVMs == NULL) {\n        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());\n        return JNI_FALSE;\n    }\n\n    return JNI_TRUE;\n}\n```\n\n### æ€»ç»“ä¸‹Linuxä¸‹åŠ¨æ€é“¾æ¥çš„ä½¿ç”¨\n\n1. dlopen\nä»¥æŒ‡å®šæ¨¡å¼æ‰“å¼€æŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¥æŸ„ç»™è°ƒç”¨è¿›ç¨‹\n\n##### æ–¹æ³•å®šä¹‰\n```C\nvoid *dlopen(const char *filename, int flag);\n```\n\n- filename æ–‡ä»¶è·¯å¾„\n- flag \n    1. RTLD_LAZY æš‚ç¼“å†³å®šï¼Œç­‰æœ‰éœ€è¦æ˜¯å†è§£å‡ºç¬¦å·\n    2. RTLD_NOW ç«‹å³å†³å®šï¼Œè¿”å›å‰è§£é™¤æ‰€æœ‰æœªå†³å®šçš„ç¬¦å·\n    \n##### æ–¹æ³•ä½¿ç”¨\n```c\nvoid *handle;\nhandle = dlopen(åŠ¨æ€é“¾æ¥åº“è·¯å¾„, RTLD_LAZY);\n```\n\n2. dlsym\né€šè¿‡å¥æŸ„å’Œè¿æ¥ç¬¦åç§°è·å–å‡½æ•°åæˆ–è€…å˜é‡å\n\n##### æ–¹æ³•å®šä¹‰\n```C\nvoid *dlsym(void *handle, const char *symbol);\n```\n\n##### æ–¹æ³•ä½¿ç”¨\n```C\nifn->CreateJavaVM = (CreateJavaVM_t)\n        dlsym(libjvm, \"JNI_CreateJavaVM\");\n```\n\n\n3. dlclose\nå¸è½½æ‰“å¼€çš„åº“\n\n##### æ–¹æ³•å®šä¹‰\n```C\nint dlclose(void *handle);\n```\n\n##### æ–¹æ³•ä½¿ç”¨\n```C\ndlclose(handle);\n```","source":"_posts/linuxæä¾›åŠ è½½ã€å¤„ç†åŠ¨æ€é“¾æ¥åº“çš„ç³»ç»Ÿè°ƒç”¨æ–¹æ³•.md","raw":"---\ntitle: linuxæä¾›åŠ è½½ã€å¤„ç†åŠ¨æ€é“¾æ¥åº“çš„ç³»ç»Ÿè°ƒç”¨æ–¹æ³•\ndate: 2020-09-24 14:44:08\ntags: \n    - Linux\n    - C\ncategories :\n    - Technology\n---\n\næˆ‘ä»¬çŸ¥é“ç›®å‰Javaæä¾›çš„å·¥å…·å¦‚javacã€jpsã€jstatã€jmapç­‰éƒ½æ˜¯é€šè¿‡Javaçš„è‡ªä¸¾å®ç°çš„ã€‚ç„¶è€Œå¯åŠ¨JVMçš„å‘½ä»¤çš„javaå´æ˜¯ç”±Cè¯­è¨€å¼€å‘çš„ã€‚è‡³äºåŸå› é€šè¿‡ç¿»é˜…OpenJdkæºç æˆ‘çŒœæµ‹ï¼šæ˜¯ä¸ºäº†ä¸æä¾›JNIæ¥å£çš„å‰æä¸‹ï¼Œéœ€è¦åŠ¨æ€é“¾æ¥è°ƒç”¨JVMåº“æ‰€å¯¼è‡´çš„ã€‚\n<!-- more -->\n\n### java.cä¸­åŠ¨æ€é“¾æ¥jvmåº“ç›¸å…³ä»£ç \n\n>ä»£ç æ¸…å•ï¼šsrc/solaris/bin/java_md_solinux.c\n```C\njboolean\nLoadJavaVM(const char *jvmpath, InvocationFunctions *ifn)\n{\n    void *libjvm;\n\n    JLI_TraceLauncher(\"JVM path is %s\\n\", jvmpath);\n\n    libjvm = dlopen(jvmpath, RTLD_NOW + RTLD_GLOBAL);\n    if (libjvm == NULL) {\n#if defined(__solaris__) && defined(__sparc) && !defined(_LP64) /* i.e. 32-bit sparc */\n      FILE * fp;\n      Elf32_Ehdr elf_head;\n      int count;\n      int location;\n\n      fp = fopen(jvmpath, \"r\");\n      if (fp == NULL) {\n        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());\n        return JNI_FALSE;\n      }\n\n      /* read in elf header */\n      count = fread((void*)(&elf_head), sizeof(Elf32_Ehdr), 1, fp);\n      fclose(fp);\n      if (count < 1) {\n        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());\n        return JNI_FALSE;\n      }\n\n      /*\n       * Check for running a server vm (compiled with -xarch=v8plus)\n       * on a stock v8 processor.  In this case, the machine type in\n       * the elf header would not be included the architecture list\n       * provided by the isalist command, which is turn is gotten from\n       * sysinfo.  This case cannot occur on 64-bit hardware and thus\n       * does not have to be checked for in binaries with an LP64 data\n       * model.\n       */\n      if (elf_head.e_machine == EM_SPARC32PLUS) {\n        char buf[257];  /* recommended buffer size from sysinfo man\n                           page */\n        long length;\n        char* location;\n\n        length = sysinfo(SI_ISALIST, buf, 257);\n        if (length > 0) {\n            location = JLI_StrStr(buf, \"sparcv8plus \");\n          if (location == NULL) {\n            JLI_ReportErrorMessage(JVM_ERROR3);\n            return JNI_FALSE;\n          }\n        }\n      }\n#endif\n        JLI_ReportErrorMessage(DLL_ERROR1, __LINE__);\n        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());\n        return JNI_FALSE;\n    }\n\n    ifn->CreateJavaVM = (CreateJavaVM_t)\n        dlsym(libjvm, \"JNI_CreateJavaVM\");\n    if (ifn->CreateJavaVM == NULL) {\n        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());\n        return JNI_FALSE;\n    }\n\n    ifn->GetDefaultJavaVMInitArgs = (GetDefaultJavaVMInitArgs_t)\n        dlsym(libjvm, \"JNI_GetDefaultJavaVMInitArgs\");\n    if (ifn->GetDefaultJavaVMInitArgs == NULL) {\n        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());\n        return JNI_FALSE;\n    }\n\n    ifn->GetCreatedJavaVMs = (GetCreatedJavaVMs_t)\n        dlsym(libjvm, \"JNI_GetCreatedJavaVMs\");\n    if (ifn->GetCreatedJavaVMs == NULL) {\n        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());\n        return JNI_FALSE;\n    }\n\n    return JNI_TRUE;\n}\n```\n\n### æ€»ç»“ä¸‹Linuxä¸‹åŠ¨æ€é“¾æ¥çš„ä½¿ç”¨\n\n1. dlopen\nä»¥æŒ‡å®šæ¨¡å¼æ‰“å¼€æŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¥æŸ„ç»™è°ƒç”¨è¿›ç¨‹\n\n##### æ–¹æ³•å®šä¹‰\n```C\nvoid *dlopen(const char *filename, int flag);\n```\n\n- filename æ–‡ä»¶è·¯å¾„\n- flag \n    1. RTLD_LAZY æš‚ç¼“å†³å®šï¼Œç­‰æœ‰éœ€è¦æ˜¯å†è§£å‡ºç¬¦å·\n    2. RTLD_NOW ç«‹å³å†³å®šï¼Œè¿”å›å‰è§£é™¤æ‰€æœ‰æœªå†³å®šçš„ç¬¦å·\n    \n##### æ–¹æ³•ä½¿ç”¨\n```c\nvoid *handle;\nhandle = dlopen(åŠ¨æ€é“¾æ¥åº“è·¯å¾„, RTLD_LAZY);\n```\n\n2. dlsym\né€šè¿‡å¥æŸ„å’Œè¿æ¥ç¬¦åç§°è·å–å‡½æ•°åæˆ–è€…å˜é‡å\n\n##### æ–¹æ³•å®šä¹‰\n```C\nvoid *dlsym(void *handle, const char *symbol);\n```\n\n##### æ–¹æ³•ä½¿ç”¨\n```C\nifn->CreateJavaVM = (CreateJavaVM_t)\n        dlsym(libjvm, \"JNI_CreateJavaVM\");\n```\n\n\n3. dlclose\nå¸è½½æ‰“å¼€çš„åº“\n\n##### æ–¹æ³•å®šä¹‰\n```C\nint dlclose(void *handle);\n```\n\n##### æ–¹æ³•ä½¿ç”¨\n```C\ndlclose(handle);\n```","slug":"linuxæä¾›åŠ è½½ã€å¤„ç†åŠ¨æ€é“¾æ¥åº“çš„ç³»ç»Ÿè°ƒç”¨æ–¹æ³•","published":1,"updated":"2020-12-14T09:51:24.016Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71ht7000dv2527ey8fo8p","content":"<html><head></head><body><p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x76EE;&#x524D;Java&#x63D0;&#x4F9B;&#x7684;&#x5DE5;&#x5177;&#x5982;javac&#x3001;jps&#x3001;jstat&#x3001;jmap&#x7B49;&#x90FD;&#x662F;&#x901A;&#x8FC7;Java&#x7684;&#x81EA;&#x4E3E;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x7136;&#x800C;&#x542F;&#x52A8;JVM&#x7684;&#x547D;&#x4EE4;&#x7684;java&#x5374;&#x662F;&#x7531;C&#x8BED;&#x8A00;&#x5F00;&#x53D1;&#x7684;&#x3002;&#x81F3;&#x4E8E;&#x539F;&#x56E0;&#x901A;&#x8FC7;&#x7FFB;&#x9605;OpenJdk&#x6E90;&#x7801;&#x6211;&#x731C;&#x6D4B;&#xFF1A;&#x662F;&#x4E3A;&#x4E86;&#x4E0D;&#x63D0;&#x4F9B;JNI&#x63A5;&#x53E3;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x9700;&#x8981;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x8C03;&#x7528;JVM&#x5E93;&#x6240;&#x5BFC;&#x81F4;&#x7684;&#x3002;</p>\n<a id=\"more\"></a>\n\n<h3 id=\"java-c&#x4E2D;&#x52A8;&#x6001;&#x94FE;&#x63A5;jvm&#x5E93;&#x76F8;&#x5173;&#x4EE3;&#x7801;\"><a href=\"#java-c&#x4E2D;&#x52A8;&#x6001;&#x94FE;&#x63A5;jvm&#x5E93;&#x76F8;&#x5173;&#x4EE3;&#x7801;\" class=\"headerlink\" title=\"java.c&#x4E2D;&#x52A8;&#x6001;&#x94FE;&#x63A5;jvm&#x5E93;&#x76F8;&#x5173;&#x4EE3;&#x7801;\"></a>java.c&#x4E2D;&#x52A8;&#x6001;&#x94FE;&#x63A5;jvm&#x5E93;&#x76F8;&#x5173;&#x4EE3;&#x7801;</h3><blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/solaris/bin/java_md_solinux.c</p>\n</blockquote>\n<figure class=\"highlight c hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jboolean</span><br><span class=\"line\">LoadJavaVM(<span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">char</span> *jvmpath, InvocationFunctions *ifn)</span><br><span class=\"line\">{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">void</span> *libjvm;</span><br><span class=\"line\"></span><br><span class=\"line\">    JLI_TraceLauncher(<span class=\"hljs-string\">&quot;JVM path is %s\\n&quot;</span>, jvmpath);</span><br><span class=\"line\"></span><br><span class=\"line\">    libjvm = dlopen(jvmpath, RTLD_NOW + RTLD_GLOBAL);</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (libjvm == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">if</span> defined(__solaris__) &amp;&amp; defined(__sparc) &amp;&amp; !defined(_LP64) <span class=\"hljs-comment\">/* i.e. 32-bit sparc */</span></span></span><br><span class=\"line\">      FILE * fp;</span><br><span class=\"line\">      Elf32_Ehdr elf_head;</span><br><span class=\"line\">      <span class=\"hljs-keyword\">int</span> count;</span><br><span class=\"line\">      <span class=\"hljs-keyword\">int</span> location;</span><br><span class=\"line\"></span><br><span class=\"line\">      fp = fopen(jvmpath, <span class=\"hljs-string\">&quot;r&quot;</span>);</span><br><span class=\"line\">      <span class=\"hljs-keyword\">if</span> (fp == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">      }</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"hljs-comment\">/* read in elf header */</span></span><br><span class=\"line\">      count = fread((<span class=\"hljs-keyword\">void</span>*)(&amp;elf_head), <span class=\"hljs-keyword\">sizeof</span>(Elf32_Ehdr), <span class=\"hljs-number\">1</span>, fp);</span><br><span class=\"line\">      fclose(fp);</span><br><span class=\"line\">      <span class=\"hljs-keyword\">if</span> (count &lt; <span class=\"hljs-number\">1</span>) {</span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">      }</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"hljs-comment\">/*</span></span><br><span class=\"line\"><span class=\"hljs-comment\">       * Check for running a server vm (compiled with -xarch=v8plus)</span></span><br><span class=\"line\"><span class=\"hljs-comment\">       * on a stock v8 processor.  In this case, the machine type in</span></span><br><span class=\"line\"><span class=\"hljs-comment\">       * the elf header would not be included the architecture list</span></span><br><span class=\"line\"><span class=\"hljs-comment\">       * provided by the isalist command, which is turn is gotten from</span></span><br><span class=\"line\"><span class=\"hljs-comment\">       * sysinfo.  This case cannot occur on 64-bit hardware and thus</span></span><br><span class=\"line\"><span class=\"hljs-comment\">       * does not have to be checked for in binaries with an LP64 data</span></span><br><span class=\"line\"><span class=\"hljs-comment\">       * model.</span></span><br><span class=\"line\"><span class=\"hljs-comment\">       */</span></span><br><span class=\"line\">      <span class=\"hljs-keyword\">if</span> (elf_head.e_machine == EM_SPARC32PLUS) {</span><br><span class=\"line\">        <span class=\"hljs-keyword\">char</span> buf[<span class=\"hljs-number\">257</span>];  <span class=\"hljs-comment\">/* recommended buffer size from sysinfo man</span></span><br><span class=\"line\"><span class=\"hljs-comment\">                           page */</span></span><br><span class=\"line\">        <span class=\"hljs-keyword\">long</span> length;</span><br><span class=\"line\">        <span class=\"hljs-keyword\">char</span>* location;</span><br><span class=\"line\"></span><br><span class=\"line\">        length = sysinfo(SI_ISALIST, buf, <span class=\"hljs-number\">257</span>);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (length &gt; <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">            location = JLI_StrStr(buf, <span class=\"hljs-string\">&quot;sparcv8plus &quot;</span>);</span><br><span class=\"line\">          <span class=\"hljs-keyword\">if</span> (location == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">            JLI_ReportErrorMessage(JVM_ERROR3);</span><br><span class=\"line\">            <span class=\"hljs-keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">          }</span><br><span class=\"line\">        }</span><br><span class=\"line\">      }</span><br><span class=\"line\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">endif</span></span></span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR1, __LINE__);</span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    ifn-&gt;CreateJavaVM = (CreateJavaVM_t)</span><br><span class=\"line\">        dlsym(libjvm, <span class=\"hljs-string\">&quot;JNI_CreateJavaVM&quot;</span>);</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (ifn-&gt;CreateJavaVM == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    ifn-&gt;GetDefaultJavaVMInitArgs = (GetDefaultJavaVMInitArgs_t)</span><br><span class=\"line\">        dlsym(libjvm, <span class=\"hljs-string\">&quot;JNI_GetDefaultJavaVMInitArgs&quot;</span>);</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (ifn-&gt;GetDefaultJavaVMInitArgs == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    ifn-&gt;GetCreatedJavaVMs = (GetCreatedJavaVMs_t)</span><br><span class=\"line\">        dlsym(libjvm, <span class=\"hljs-string\">&quot;JNI_GetCreatedJavaVMs&quot;</span>);</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (ifn-&gt;GetCreatedJavaVMs == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">return</span> JNI_TRUE;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<h3 id=\"&#x603B;&#x7ED3;&#x4E0B;Linux&#x4E0B;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x4F7F;&#x7528;\"><a href=\"#&#x603B;&#x7ED3;&#x4E0B;Linux&#x4E0B;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;&#x4E0B;Linux&#x4E0B;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x4F7F;&#x7528;\"></a>&#x603B;&#x7ED3;&#x4E0B;Linux&#x4E0B;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x7684;&#x4F7F;&#x7528;</h3><ol>\n<li>dlopen<br>&#x4EE5;&#x6307;&#x5B9A;&#x6A21;&#x5F0F;&#x6253;&#x5F00;&#x6307;&#x5B9A;&#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x53E5;&#x67C4;&#x7ED9;&#x8C03;&#x7528;&#x8FDB;&#x7A0B;</li>\n</ol>\n<h5 id=\"&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;\"><a href=\"#&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;\" class=\"headerlink\" title=\"&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;\"></a>&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;</h5><figure class=\"highlight c hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> *<span class=\"hljs-title\">dlopen</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">char</span> *filename, <span class=\"hljs-keyword\">int</span> flag)</span></span>;</span><br></pre></td></tr></tbody></table></figure>\n\n<ul>\n<li>filename &#x6587;&#x4EF6;&#x8DEF;&#x5F84;</li>\n<li>flag <ol>\n<li>RTLD_LAZY &#x6682;&#x7F13;&#x51B3;&#x5B9A;&#xFF0C;&#x7B49;&#x6709;&#x9700;&#x8981;&#x662F;&#x518D;&#x89E3;&#x51FA;&#x7B26;&#x53F7;</li>\n<li>RTLD_NOW &#x7ACB;&#x5373;&#x51B3;&#x5B9A;&#xFF0C;&#x8FD4;&#x56DE;&#x524D;&#x89E3;&#x9664;&#x6240;&#x6709;&#x672A;&#x51B3;&#x5B9A;&#x7684;&#x7B26;&#x53F7;</li>\n</ol>\n</li>\n</ul>\n<h5 id=\"&#x65B9;&#x6CD5;&#x4F7F;&#x7528;\"><a href=\"#&#x65B9;&#x6CD5;&#x4F7F;&#x7528;\" class=\"headerlink\" title=\"&#x65B9;&#x6CD5;&#x4F7F;&#x7528;\"></a>&#x65B9;&#x6CD5;&#x4F7F;&#x7528;</h5><figure class=\"highlight c hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">void</span> *handle;</span><br><span class=\"line\">handle = dlopen(&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#x8DEF;&#x5F84;, RTLD_LAZY);</span><br></pre></td></tr></tbody></table></figure>\n\n<ol start=\"2\">\n<li>dlsym<br>&#x901A;&#x8FC7;&#x53E5;&#x67C4;&#x548C;&#x8FDE;&#x63A5;&#x7B26;&#x540D;&#x79F0;&#x83B7;&#x53D6;&#x51FD;&#x6570;&#x540D;&#x6216;&#x8005;&#x53D8;&#x91CF;&#x540D;</li>\n</ol>\n<h5 id=\"&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;-1\"><a href=\"#&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;-1\" class=\"headerlink\" title=\"&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;\"></a>&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;</h5><figure class=\"highlight c hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> *<span class=\"hljs-title\">dlsym</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">void</span> *handle, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">char</span> *symbol)</span></span>;</span><br></pre></td></tr></tbody></table></figure>\n\n<h5 id=\"&#x65B9;&#x6CD5;&#x4F7F;&#x7528;-1\"><a href=\"#&#x65B9;&#x6CD5;&#x4F7F;&#x7528;-1\" class=\"headerlink\" title=\"&#x65B9;&#x6CD5;&#x4F7F;&#x7528;\"></a>&#x65B9;&#x6CD5;&#x4F7F;&#x7528;</h5><figure class=\"highlight c hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ifn-&gt;CreateJavaVM = (CreateJavaVM_t)</span><br><span class=\"line\">        dlsym(libjvm, <span class=\"hljs-string\">&quot;JNI_CreateJavaVM&quot;</span>);</span><br></pre></td></tr></tbody></table></figure>\n\n\n<ol start=\"3\">\n<li>dlclose<br>&#x5378;&#x8F7D;&#x6253;&#x5F00;&#x7684;&#x5E93;</li>\n</ol>\n<h5 id=\"&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;-2\"><a href=\"#&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;-2\" class=\"headerlink\" title=\"&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;\"></a>&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;</h5><figure class=\"highlight c hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">dlclose</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">void</span> *handle)</span></span>;</span><br></pre></td></tr></tbody></table></figure>\n\n<h5 id=\"&#x65B9;&#x6CD5;&#x4F7F;&#x7528;-2\"><a href=\"#&#x65B9;&#x6CD5;&#x4F7F;&#x7528;-2\" class=\"headerlink\" title=\"&#x65B9;&#x6CD5;&#x4F7F;&#x7528;\"></a>&#x65B9;&#x6CD5;&#x4F7F;&#x7528;</h5><figure class=\"highlight c hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dlclose(handle);</span><br></pre></td></tr></tbody></table></figure></body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"C","path":"tags/C/"},{"name":"Linux","path":"tags/Linux/"}],"excerpt":"<html><head></head><body><p>&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x76EE;&#x524D;Java&#x63D0;&#x4F9B;&#x7684;&#x5DE5;&#x5177;&#x5982;javac&#x3001;jps&#x3001;jstat&#x3001;jmap&#x7B49;&#x90FD;&#x662F;&#x901A;&#x8FC7;Java&#x7684;&#x81EA;&#x4E3E;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x7136;&#x800C;&#x542F;&#x52A8;JVM&#x7684;&#x547D;&#x4EE4;&#x7684;java&#x5374;&#x662F;&#x7531;C&#x8BED;&#x8A00;&#x5F00;&#x53D1;&#x7684;&#x3002;&#x81F3;&#x4E8E;&#x539F;&#x56E0;&#x901A;&#x8FC7;&#x7FFB;&#x9605;OpenJdk&#x6E90;&#x7801;&#x6211;&#x731C;&#x6D4B;&#xFF1A;&#x662F;&#x4E3A;&#x4E86;&#x4E0D;&#x63D0;&#x4F9B;JNI&#x63A5;&#x53E3;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x9700;&#x8981;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x8C03;&#x7528;JVM&#x5E93;&#x6240;&#x5BFC;&#x81F4;&#x7684;&#x3002;</p></body></html>","more":"<h3 id=\"java-cä¸­åŠ¨æ€é“¾æ¥jvmåº“ç›¸å…³ä»£ç \"><a href=\"#java-cä¸­åŠ¨æ€é“¾æ¥jvmåº“ç›¸å…³ä»£ç \" class=\"headerlink\" title=\"java.cä¸­åŠ¨æ€é“¾æ¥jvmåº“ç›¸å…³ä»£ç \"></a>java.cä¸­åŠ¨æ€é“¾æ¥jvmåº“ç›¸å…³ä»£ç </h3><blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/solaris/bin/java_md_solinux.c</p>\n</blockquote>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jboolean</span><br><span class=\"line\">LoadJavaVM(<span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *jvmpath, InvocationFunctions *ifn)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> *libjvm;</span><br><span class=\"line\"></span><br><span class=\"line\">    JLI_TraceLauncher(<span class=\"string\">&quot;JVM path is %s\\n&quot;</span>, jvmpath);</span><br><span class=\"line\"></span><br><span class=\"line\">    libjvm = dlopen(jvmpath, RTLD_NOW + RTLD_GLOBAL);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (libjvm == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> defined(__solaris__) &amp;&amp; defined(__sparc) &amp;&amp; !defined(_LP64) <span class=\"comment\">/* i.e. 32-bit sparc */</span></span></span><br><span class=\"line\">      FILE * fp;</span><br><span class=\"line\">      Elf32_Ehdr elf_head;</span><br><span class=\"line\">      <span class=\"keyword\">int</span> count;</span><br><span class=\"line\">      <span class=\"keyword\">int</span> location;</span><br><span class=\"line\"></span><br><span class=\"line\">      fp = fopen(jvmpath, <span class=\"string\">&quot;r&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (fp == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">/* read in elf header */</span></span><br><span class=\"line\">      count = fread((<span class=\"keyword\">void</span>*)(&amp;elf_head), <span class=\"keyword\">sizeof</span>(Elf32_Ehdr), <span class=\"number\">1</span>, fp);</span><br><span class=\"line\">      fclose(fp);</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (count &lt; <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">       * Check for running a server vm (compiled with -xarch=v8plus)</span></span><br><span class=\"line\"><span class=\"comment\">       * on a stock v8 processor.  In this case, the machine type in</span></span><br><span class=\"line\"><span class=\"comment\">       * the elf header would not be included the architecture list</span></span><br><span class=\"line\"><span class=\"comment\">       * provided by the isalist command, which is turn is gotten from</span></span><br><span class=\"line\"><span class=\"comment\">       * sysinfo.  This case cannot occur on 64-bit hardware and thus</span></span><br><span class=\"line\"><span class=\"comment\">       * does not have to be checked for in binaries with an LP64 data</span></span><br><span class=\"line\"><span class=\"comment\">       * model.</span></span><br><span class=\"line\"><span class=\"comment\">       */</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (elf_head.e_machine == EM_SPARC32PLUS) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">char</span> buf[<span class=\"number\">257</span>];  <span class=\"comment\">/* recommended buffer size from sysinfo man</span></span><br><span class=\"line\"><span class=\"comment\">                           page */</span></span><br><span class=\"line\">        <span class=\"keyword\">long</span> length;</span><br><span class=\"line\">        <span class=\"keyword\">char</span>* location;</span><br><span class=\"line\"></span><br><span class=\"line\">        length = sysinfo(SI_ISALIST, buf, <span class=\"number\">257</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            location = JLI_StrStr(buf, <span class=\"string\">&quot;sparcv8plus &quot;</span>);</span><br><span class=\"line\">          <span class=\"keyword\">if</span> (location == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">            JLI_ReportErrorMessage(JVM_ERROR3);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR1, __LINE__);</span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ifn-&gt;CreateJavaVM = (CreateJavaVM_t)</span><br><span class=\"line\">        dlsym(libjvm, <span class=\"string\">&quot;JNI_CreateJavaVM&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ifn-&gt;CreateJavaVM == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ifn-&gt;GetDefaultJavaVMInitArgs = (GetDefaultJavaVMInitArgs_t)</span><br><span class=\"line\">        dlsym(libjvm, <span class=\"string\">&quot;JNI_GetDefaultJavaVMInitArgs&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ifn-&gt;GetDefaultJavaVMInitArgs == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ifn-&gt;GetCreatedJavaVMs = (GetCreatedJavaVMs_t)</span><br><span class=\"line\">        dlsym(libjvm, <span class=\"string\">&quot;JNI_GetCreatedJavaVMs&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (ifn-&gt;GetCreatedJavaVMs == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        JLI_ReportErrorMessage(DLL_ERROR2, jvmpath, dlerror());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JNI_FALSE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> JNI_TRUE;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æ€»ç»“ä¸‹Linuxä¸‹åŠ¨æ€é“¾æ¥çš„ä½¿ç”¨\"><a href=\"#æ€»ç»“ä¸‹Linuxä¸‹åŠ¨æ€é“¾æ¥çš„ä½¿ç”¨\" class=\"headerlink\" title=\"æ€»ç»“ä¸‹Linuxä¸‹åŠ¨æ€é“¾æ¥çš„ä½¿ç”¨\"></a>æ€»ç»“ä¸‹Linuxä¸‹åŠ¨æ€é“¾æ¥çš„ä½¿ç”¨</h3><ol>\n<li>dlopen<br>ä»¥æŒ‡å®šæ¨¡å¼æ‰“å¼€æŒ‡å®šçš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¥æŸ„ç»™è°ƒç”¨è¿›ç¨‹</li>\n</ol>\n<h5 id=\"æ–¹æ³•å®šä¹‰\"><a href=\"#æ–¹æ³•å®šä¹‰\" class=\"headerlink\" title=\"æ–¹æ³•å®šä¹‰\"></a>æ–¹æ³•å®šä¹‰</h5><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> *<span class=\"title\">dlopen</span><span class=\"params\">(<span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *filename, <span class=\"keyword\">int</span> flag)</span></span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>filename æ–‡ä»¶è·¯å¾„</li>\n<li>flag <ol>\n<li>RTLD_LAZY æš‚ç¼“å†³å®šï¼Œç­‰æœ‰éœ€è¦æ˜¯å†è§£å‡ºç¬¦å·</li>\n<li>RTLD_NOW ç«‹å³å†³å®šï¼Œè¿”å›å‰è§£é™¤æ‰€æœ‰æœªå†³å®šçš„ç¬¦å·</li>\n</ol>\n</li>\n</ul>\n<h5 id=\"æ–¹æ³•ä½¿ç”¨\"><a href=\"#æ–¹æ³•ä½¿ç”¨\" class=\"headerlink\" title=\"æ–¹æ³•ä½¿ç”¨\"></a>æ–¹æ³•ä½¿ç”¨</h5><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> *handle;</span><br><span class=\"line\">handle = dlopen(åŠ¨æ€é“¾æ¥åº“è·¯å¾„, RTLD_LAZY);</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>dlsym<br>é€šè¿‡å¥æŸ„å’Œè¿æ¥ç¬¦åç§°è·å–å‡½æ•°åæˆ–è€…å˜é‡å</li>\n</ol>\n<h5 id=\"æ–¹æ³•å®šä¹‰-1\"><a href=\"#æ–¹æ³•å®šä¹‰-1\" class=\"headerlink\" title=\"æ–¹æ³•å®šä¹‰\"></a>æ–¹æ³•å®šä¹‰</h5><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> *<span class=\"title\">dlsym</span><span class=\"params\">(<span class=\"keyword\">void</span> *handle, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *symbol)</span></span>;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"æ–¹æ³•ä½¿ç”¨-1\"><a href=\"#æ–¹æ³•ä½¿ç”¨-1\" class=\"headerlink\" title=\"æ–¹æ³•ä½¿ç”¨\"></a>æ–¹æ³•ä½¿ç”¨</h5><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ifn-&gt;CreateJavaVM = (CreateJavaVM_t)</span><br><span class=\"line\">        dlsym(libjvm, <span class=\"string\">&quot;JNI_CreateJavaVM&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"3\">\n<li>dlclose<br>å¸è½½æ‰“å¼€çš„åº“</li>\n</ol>\n<h5 id=\"æ–¹æ³•å®šä¹‰-2\"><a href=\"#æ–¹æ³•å®šä¹‰-2\" class=\"headerlink\" title=\"æ–¹æ³•å®šä¹‰\"></a>æ–¹æ³•å®šä¹‰</h5><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">dlclose</span><span class=\"params\">(<span class=\"keyword\">void</span> *handle)</span></span>;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"æ–¹æ³•ä½¿ç”¨-2\"><a href=\"#æ–¹æ³•ä½¿ç”¨-2\" class=\"headerlink\" title=\"æ–¹æ³•ä½¿ç”¨\"></a>æ–¹æ³•ä½¿ç”¨</h5><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dlclose(handle);</span><br></pre></td></tr></table></figure>"},{"title":"å¤šçº§ç¼“å­˜","date":"2019-09-04T07:35:11.000Z","_content":"### èµ·å› \né¡¹ç›®å¹³ç¨³çš„å·²ç»è¿è¡Œå¿«ä¸€å¹´äº†ï¼ŒæŸå¤©æ—©ä¸Šç›‘æ§çªç„¶å‘Šè­¦å¤§é‡æ ¸å¿ƒæœåŠ¡ä¸å¯èƒ½ï¼Œè™½ç„¶è¿ç»´ç´§æ€¥å¤„ç†å¹¶é‡å¯äº†æœåŠ¡ã€‚ä½†è¿™ç§éæ­£å¸¸çš„æœåŠ¡å®•æœºç€å®è®©äººæäº†æŠŠå†·æ±—ï¼ˆè¿˜å¥½åˆ›ä¸šå…¬å¸è¿˜æ²¡æœ‰ç”Ÿäº§äº‹æ•…æƒ©ç½šæœºåˆ¶ï¼‰ã€‚\n\néšåæˆ‘ä»¬Dumpä¸‹äº†æœåŠ¡èµ·çš„æ—¥å¿—ï¼Œå‘ç°äº‹æ•…æœŸé—´JVMå­˜åœ¨å¤§é‡çš„Full GCï¼Œé…åˆCATçš„ç›‘æ§æŒ‡æ ‡å‘ç°æŸå‡ ä¸ªæ¥å£çš„è°ƒç”¨é‡å‰§å¢ã€‚ã€‚ã€‚ã€‚å¤§æ¦‚æˆ‘ä»¬æ˜¯è¢«åˆ·æ¥å£äº†ã€‚\n\næŸ¥çœ‹å…·ä½“æ¥å£ï¼Œå‘ç°å‰ç«¯åå¤æŸ¥è¯¢é…ç½®ä¿¡æ¯è€Œä¸”æ²¡æœ‰åšç¼“å­˜ï¼Œå¤§é‡çš„å¤§å¯¹è±¡å †ç§¯ä¸é¢‘ç¹Full GCæ‰æ€ªã€‚ã€‚ã€‚ã€‚çŸ¥é“é—®é¢˜é‚£æˆ‘ä»¬å°±å¼€å§‹ä¼˜åŒ–å§\n\n<!-- more -->\n\n### ç¼“å­˜\n\n### Spring Cache\n\n\næ³¨è§£|åŠŸèƒ½\n---|---\nCacheable|\nCacheEvict|\nCachePut|\nCaching|\n\n#### spring boot cache æµç¨‹\n\n![01](ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/springCache.png)\n\n\n#### å¤šçº§ç¼“å­˜æµç¨‹\n\n![02](ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/å¤šçº§ç¼“å­˜.png)\n\n\n\n#### springboot å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\n1. ä¾èµ–org.springframework.boot:spring-boot-starter-cache\n2. åœ¨å¯åŠ¨ç±»å¢åŠ æ³¨è§£@EnableCaching\n3. åœ¨æƒ³è¦å¢åŠ ç¼“å­˜çš„æ–¹æ³•æˆ–è€…æˆå‘˜å˜é‡ä¸Šå¢åŠ ä»¥ä¸‹æ³¨è§£\n\n#### å¯ç”¨å¤šçº§ç¼“å­˜\n1. å¼•å…¥ç»„ä»¶\n\n```gradle \n\n``` \n\n2. å¼€å¯ç¼“å­˜\n   \n###### æ— å‚ç¼“å­˜\n```java\n\n``` \n\n###### å¸¦å‚ç¼“å­˜1\n```java\n\n``` \n\n###### å¸¦å‚ç¼“å­˜2\n```java\n\n``` \n\n###### ç»„åˆå‚æ•°ç¼“å­˜\n```java\n\n``` ","source":"_posts/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜.md","raw":"---\ntitle: å¤šçº§ç¼“å­˜\ndate: 2019-09-04 15:35:11\ntags: \n    - Java\n    - Redis\n    - Cache\ncategories :\n    - Technology\n---\n### èµ·å› \né¡¹ç›®å¹³ç¨³çš„å·²ç»è¿è¡Œå¿«ä¸€å¹´äº†ï¼ŒæŸå¤©æ—©ä¸Šç›‘æ§çªç„¶å‘Šè­¦å¤§é‡æ ¸å¿ƒæœåŠ¡ä¸å¯èƒ½ï¼Œè™½ç„¶è¿ç»´ç´§æ€¥å¤„ç†å¹¶é‡å¯äº†æœåŠ¡ã€‚ä½†è¿™ç§éæ­£å¸¸çš„æœåŠ¡å®•æœºç€å®è®©äººæäº†æŠŠå†·æ±—ï¼ˆè¿˜å¥½åˆ›ä¸šå…¬å¸è¿˜æ²¡æœ‰ç”Ÿäº§äº‹æ•…æƒ©ç½šæœºåˆ¶ï¼‰ã€‚\n\néšåæˆ‘ä»¬Dumpä¸‹äº†æœåŠ¡èµ·çš„æ—¥å¿—ï¼Œå‘ç°äº‹æ•…æœŸé—´JVMå­˜åœ¨å¤§é‡çš„Full GCï¼Œé…åˆCATçš„ç›‘æ§æŒ‡æ ‡å‘ç°æŸå‡ ä¸ªæ¥å£çš„è°ƒç”¨é‡å‰§å¢ã€‚ã€‚ã€‚ã€‚å¤§æ¦‚æˆ‘ä»¬æ˜¯è¢«åˆ·æ¥å£äº†ã€‚\n\næŸ¥çœ‹å…·ä½“æ¥å£ï¼Œå‘ç°å‰ç«¯åå¤æŸ¥è¯¢é…ç½®ä¿¡æ¯è€Œä¸”æ²¡æœ‰åšç¼“å­˜ï¼Œå¤§é‡çš„å¤§å¯¹è±¡å †ç§¯ä¸é¢‘ç¹Full GCæ‰æ€ªã€‚ã€‚ã€‚ã€‚çŸ¥é“é—®é¢˜é‚£æˆ‘ä»¬å°±å¼€å§‹ä¼˜åŒ–å§\n\n<!-- more -->\n\n### ç¼“å­˜\n\n### Spring Cache\n\n\næ³¨è§£|åŠŸèƒ½\n---|---\nCacheable|\nCacheEvict|\nCachePut|\nCaching|\n\n#### spring boot cache æµç¨‹\n\n![01](ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/springCache.png)\n\n\n#### å¤šçº§ç¼“å­˜æµç¨‹\n\n![02](ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/å¤šçº§ç¼“å­˜.png)\n\n\n\n#### springboot å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\n1. ä¾èµ–org.springframework.boot:spring-boot-starter-cache\n2. åœ¨å¯åŠ¨ç±»å¢åŠ æ³¨è§£@EnableCaching\n3. åœ¨æƒ³è¦å¢åŠ ç¼“å­˜çš„æ–¹æ³•æˆ–è€…æˆå‘˜å˜é‡ä¸Šå¢åŠ ä»¥ä¸‹æ³¨è§£\n\n#### å¯ç”¨å¤šçº§ç¼“å­˜\n1. å¼•å…¥ç»„ä»¶\n\n```gradle \n\n``` \n\n2. å¼€å¯ç¼“å­˜\n   \n###### æ— å‚ç¼“å­˜\n```java\n\n``` \n\n###### å¸¦å‚ç¼“å­˜1\n```java\n\n``` \n\n###### å¸¦å‚ç¼“å­˜2\n```java\n\n``` \n\n###### ç»„åˆå‚æ•°ç¼“å­˜\n```java\n\n``` ","slug":"ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜","published":1,"updated":"2020-12-14T10:35:23.746Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71hta000hv252gby12mkn","content":"<html><head></head><body><h3 id=\"&#x8D77;&#x56E0;\"><a href=\"#&#x8D77;&#x56E0;\" class=\"headerlink\" title=\"&#x8D77;&#x56E0;\"></a>&#x8D77;&#x56E0;</h3><p>&#x9879;&#x76EE;&#x5E73;&#x7A33;&#x7684;&#x5DF2;&#x7ECF;&#x8FD0;&#x884C;&#x5FEB;&#x4E00;&#x5E74;&#x4E86;&#xFF0C;&#x67D0;&#x5929;&#x65E9;&#x4E0A;&#x76D1;&#x63A7;&#x7A81;&#x7136;&#x544A;&#x8B66;&#x5927;&#x91CF;&#x6838;&#x5FC3;&#x670D;&#x52A1;&#x4E0D;&#x53EF;&#x80FD;&#xFF0C;&#x867D;&#x7136;&#x8FD0;&#x7EF4;&#x7D27;&#x6025;&#x5904;&#x7406;&#x5E76;&#x91CD;&#x542F;&#x4E86;&#x670D;&#x52A1;&#x3002;&#x4F46;&#x8FD9;&#x79CD;&#x975E;&#x6B63;&#x5E38;&#x7684;&#x670D;&#x52A1;&#x5B95;&#x673A;&#x7740;&#x5B9E;&#x8BA9;&#x4EBA;&#x634F;&#x4E86;&#x628A;&#x51B7;&#x6C57;&#xFF08;&#x8FD8;&#x597D;&#x521B;&#x4E1A;&#x516C;&#x53F8;&#x8FD8;&#x6CA1;&#x6709;&#x751F;&#x4EA7;&#x4E8B;&#x6545;&#x60E9;&#x7F5A;&#x673A;&#x5236;&#xFF09;&#x3002;</p>\n<p>&#x968F;&#x540E;&#x6211;&#x4EEC;Dump&#x4E0B;&#x4E86;&#x670D;&#x52A1;&#x8D77;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x53D1;&#x73B0;&#x4E8B;&#x6545;&#x671F;&#x95F4;JVM&#x5B58;&#x5728;&#x5927;&#x91CF;&#x7684;Full GC&#xFF0C;&#x914D;&#x5408;CAT&#x7684;&#x76D1;&#x63A7;&#x6307;&#x6807;&#x53D1;&#x73B0;&#x67D0;&#x51E0;&#x4E2A;&#x63A5;&#x53E3;&#x7684;&#x8C03;&#x7528;&#x91CF;&#x5267;&#x589E;&#x3002;&#x3002;&#x3002;&#x3002;&#x5927;&#x6982;&#x6211;&#x4EEC;&#x662F;&#x88AB;&#x5237;&#x63A5;&#x53E3;&#x4E86;&#x3002;</p>\n<p>&#x67E5;&#x770B;&#x5177;&#x4F53;&#x63A5;&#x53E3;&#xFF0C;&#x53D1;&#x73B0;&#x524D;&#x7AEF;&#x53CD;&#x590D;&#x67E5;&#x8BE2;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x800C;&#x4E14;&#x6CA1;&#x6709;&#x505A;&#x7F13;&#x5B58;&#xFF0C;&#x5927;&#x91CF;&#x7684;&#x5927;&#x5BF9;&#x8C61;&#x5806;&#x79EF;&#x4E0D;&#x9891;&#x7E41;Full GC&#x624D;&#x602A;&#x3002;&#x3002;&#x3002;&#x3002;&#x77E5;&#x9053;&#x95EE;&#x9898;&#x90A3;&#x6211;&#x4EEC;&#x5C31;&#x5F00;&#x59CB;&#x4F18;&#x5316;&#x5427;</p>\n<a id=\"more\"></a>\n\n<h3 id=\"&#x7F13;&#x5B58;\"><a href=\"#&#x7F13;&#x5B58;\" class=\"headerlink\" title=\"&#x7F13;&#x5B58;\"></a>&#x7F13;&#x5B58;</h3><h3 id=\"Spring-Cache\"><a href=\"#Spring-Cache\" class=\"headerlink\" title=\"Spring Cache\"></a>Spring Cache</h3><table>\n<thead>\n<tr>\n<th>&#x6CE8;&#x89E3;</th>\n<th>&#x529F;&#x80FD;</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Cacheable</td>\n<td></td>\n</tr>\n<tr>\n<td>CacheEvict</td>\n<td></td>\n</tr>\n<tr>\n<td>CachePut</td>\n<td></td>\n</tr>\n<tr>\n<td>Caching</td>\n<td></td>\n</tr>\n</tbody></table>\n<h4 id=\"spring-boot-cache-&#x6D41;&#x7A0B;\"><a href=\"#spring-boot-cache-&#x6D41;&#x7A0B;\" class=\"headerlink\" title=\"spring boot cache &#x6D41;&#x7A0B;\"></a>spring boot cache &#x6D41;&#x7A0B;</h4><p><img src=\"/2019/09/04/%E4%B8%80%E4%B8%AA%E4%BA%8B%E6%95%85%E5%BC%95%E8%B5%B7%E7%9A%84%E7%BC%93%E5%AD%98/springCache.png\" alt=\"01\"></p>\n<h4 id=\"&#x591A;&#x7EA7;&#x7F13;&#x5B58;&#x6D41;&#x7A0B;\"><a href=\"#&#x591A;&#x7EA7;&#x7F13;&#x5B58;&#x6D41;&#x7A0B;\" class=\"headerlink\" title=\"&#x591A;&#x7EA7;&#x7F13;&#x5B58;&#x6D41;&#x7A0B;\"></a>&#x591A;&#x7EA7;&#x7F13;&#x5B58;&#x6D41;&#x7A0B;</h4><p><img src=\"/2019/09/04/%E4%B8%80%E4%B8%AA%E4%BA%8B%E6%95%85%E5%BC%95%E8%B5%B7%E7%9A%84%E7%BC%93%E5%AD%98/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98.png\" alt=\"02\"></p>\n<h4 id=\"springboot-&#x5F00;&#x542F;&#x7F13;&#x5B58;&#x5F88;&#x65B9;&#x4FBF;\"><a href=\"#springboot-&#x5F00;&#x542F;&#x7F13;&#x5B58;&#x5F88;&#x65B9;&#x4FBF;\" class=\"headerlink\" title=\"springboot &#x5F00;&#x542F;&#x7F13;&#x5B58;&#x5F88;&#x65B9;&#x4FBF;\"></a>springboot &#x5F00;&#x542F;&#x7F13;&#x5B58;&#x5F88;&#x65B9;&#x4FBF;</h4><ol>\n<li>&#x4F9D;&#x8D56;org.springframework.boot:spring-boot-starter-cache</li>\n<li>&#x5728;&#x542F;&#x52A8;&#x7C7B;&#x589E;&#x52A0;&#x6CE8;&#x89E3;@EnableCaching</li>\n<li>&#x5728;&#x60F3;&#x8981;&#x589E;&#x52A0;&#x7F13;&#x5B58;&#x7684;&#x65B9;&#x6CD5;&#x6216;&#x8005;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x4E0A;&#x589E;&#x52A0;&#x4EE5;&#x4E0B;&#x6CE8;&#x89E3;</li>\n</ol>\n<h4 id=\"&#x542F;&#x7528;&#x591A;&#x7EA7;&#x7F13;&#x5B58;\"><a href=\"#&#x542F;&#x7528;&#x591A;&#x7EA7;&#x7F13;&#x5B58;\" class=\"headerlink\" title=\"&#x542F;&#x7528;&#x591A;&#x7EA7;&#x7F13;&#x5B58;\"></a>&#x542F;&#x7528;&#x591A;&#x7EA7;&#x7F13;&#x5B58;</h4><ol>\n<li>&#x5F15;&#x5165;&#x7EC4;&#x4EF6;</li>\n</ol>\n<pre><code class=\"gradle\"></code></pre>\n<ol start=\"2\">\n<li>&#x5F00;&#x542F;&#x7F13;&#x5B58;</li>\n</ol>\n<h6 id=\"&#x65E0;&#x53C2;&#x7F13;&#x5B58;\"><a href=\"#&#x65E0;&#x53C2;&#x7F13;&#x5B58;\" class=\"headerlink\" title=\"&#x65E0;&#x53C2;&#x7F13;&#x5B58;\"></a>&#x65E0;&#x53C2;&#x7F13;&#x5B58;</h6><pre><code class=\"java\"></code></pre>\n<h6 id=\"&#x5E26;&#x53C2;&#x7F13;&#x5B58;1\"><a href=\"#&#x5E26;&#x53C2;&#x7F13;&#x5B58;1\" class=\"headerlink\" title=\"&#x5E26;&#x53C2;&#x7F13;&#x5B58;1\"></a>&#x5E26;&#x53C2;&#x7F13;&#x5B58;1</h6><pre><code class=\"java\"></code></pre>\n<h6 id=\"&#x5E26;&#x53C2;&#x7F13;&#x5B58;2\"><a href=\"#&#x5E26;&#x53C2;&#x7F13;&#x5B58;2\" class=\"headerlink\" title=\"&#x5E26;&#x53C2;&#x7F13;&#x5B58;2\"></a>&#x5E26;&#x53C2;&#x7F13;&#x5B58;2</h6><pre><code class=\"java\"></code></pre>\n<h6 id=\"&#x7EC4;&#x5408;&#x53C2;&#x6570;&#x7F13;&#x5B58;\"><a href=\"#&#x7EC4;&#x5408;&#x53C2;&#x6570;&#x7F13;&#x5B58;\" class=\"headerlink\" title=\"&#x7EC4;&#x5408;&#x53C2;&#x6570;&#x7F13;&#x5B58;\"></a>&#x7EC4;&#x5408;&#x53C2;&#x6570;&#x7F13;&#x5B58;</h6><pre><code class=\"java\"></code></pre>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Redis","path":"tags/Redis/"},{"name":"Cache","path":"tags/Cache/"}],"excerpt":"<html><head></head><body><h3 id=\"&#x8D77;&#x56E0;\"><a href=\"#&#x8D77;&#x56E0;\" class=\"headerlink\" title=\"&#x8D77;&#x56E0;\"></a>&#x8D77;&#x56E0;</h3><p>&#x9879;&#x76EE;&#x5E73;&#x7A33;&#x7684;&#x5DF2;&#x7ECF;&#x8FD0;&#x884C;&#x5FEB;&#x4E00;&#x5E74;&#x4E86;&#xFF0C;&#x67D0;&#x5929;&#x65E9;&#x4E0A;&#x76D1;&#x63A7;&#x7A81;&#x7136;&#x544A;&#x8B66;&#x5927;&#x91CF;&#x6838;&#x5FC3;&#x670D;&#x52A1;&#x4E0D;&#x53EF;&#x80FD;&#xFF0C;&#x867D;&#x7136;&#x8FD0;&#x7EF4;&#x7D27;&#x6025;&#x5904;&#x7406;&#x5E76;&#x91CD;&#x542F;&#x4E86;&#x670D;&#x52A1;&#x3002;&#x4F46;&#x8FD9;&#x79CD;&#x975E;&#x6B63;&#x5E38;&#x7684;&#x670D;&#x52A1;&#x5B95;&#x673A;&#x7740;&#x5B9E;&#x8BA9;&#x4EBA;&#x634F;&#x4E86;&#x628A;&#x51B7;&#x6C57;&#xFF08;&#x8FD8;&#x597D;&#x521B;&#x4E1A;&#x516C;&#x53F8;&#x8FD8;&#x6CA1;&#x6709;&#x751F;&#x4EA7;&#x4E8B;&#x6545;&#x60E9;&#x7F5A;&#x673A;&#x5236;&#xFF09;&#x3002;</p>\n<p>&#x968F;&#x540E;&#x6211;&#x4EEC;Dump&#x4E0B;&#x4E86;&#x670D;&#x52A1;&#x8D77;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x53D1;&#x73B0;&#x4E8B;&#x6545;&#x671F;&#x95F4;JVM&#x5B58;&#x5728;&#x5927;&#x91CF;&#x7684;Full GC&#xFF0C;&#x914D;&#x5408;CAT&#x7684;&#x76D1;&#x63A7;&#x6307;&#x6807;&#x53D1;&#x73B0;&#x67D0;&#x51E0;&#x4E2A;&#x63A5;&#x53E3;&#x7684;&#x8C03;&#x7528;&#x91CF;&#x5267;&#x589E;&#x3002;&#x3002;&#x3002;&#x3002;&#x5927;&#x6982;&#x6211;&#x4EEC;&#x662F;&#x88AB;&#x5237;&#x63A5;&#x53E3;&#x4E86;&#x3002;</p>\n<p>&#x67E5;&#x770B;&#x5177;&#x4F53;&#x63A5;&#x53E3;&#xFF0C;&#x53D1;&#x73B0;&#x524D;&#x7AEF;&#x53CD;&#x590D;&#x67E5;&#x8BE2;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x800C;&#x4E14;&#x6CA1;&#x6709;&#x505A;&#x7F13;&#x5B58;&#xFF0C;&#x5927;&#x91CF;&#x7684;&#x5927;&#x5BF9;&#x8C61;&#x5806;&#x79EF;&#x4E0D;&#x9891;&#x7E41;Full GC&#x624D;&#x602A;&#x3002;&#x3002;&#x3002;&#x3002;&#x77E5;&#x9053;&#x95EE;&#x9898;&#x90A3;&#x6211;&#x4EEC;&#x5C31;&#x5F00;&#x59CB;&#x4F18;&#x5316;&#x5427;</p></body></html>","more":"<h3 id=\"ç¼“å­˜\"><a href=\"#ç¼“å­˜\" class=\"headerlink\" title=\"ç¼“å­˜\"></a>ç¼“å­˜</h3><h3 id=\"Spring-Cache\"><a href=\"#Spring-Cache\" class=\"headerlink\" title=\"Spring Cache\"></a>Spring Cache</h3><table>\n<thead>\n<tr>\n<th>æ³¨è§£</th>\n<th>åŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Cacheable</td>\n<td></td>\n</tr>\n<tr>\n<td>CacheEvict</td>\n<td></td>\n</tr>\n<tr>\n<td>CachePut</td>\n<td></td>\n</tr>\n<tr>\n<td>Caching</td>\n<td></td>\n</tr>\n</tbody></table>\n<h4 id=\"spring-boot-cache-æµç¨‹\"><a href=\"#spring-boot-cache-æµç¨‹\" class=\"headerlink\" title=\"spring boot cache æµç¨‹\"></a>spring boot cache æµç¨‹</h4><p><img src=\"/2019/09/04/%E4%B8%80%E4%B8%AA%E4%BA%8B%E6%95%85%E5%BC%95%E8%B5%B7%E7%9A%84%E7%BC%93%E5%AD%98/springCache.png\" alt=\"01\"></p>\n<h4 id=\"å¤šçº§ç¼“å­˜æµç¨‹\"><a href=\"#å¤šçº§ç¼“å­˜æµç¨‹\" class=\"headerlink\" title=\"å¤šçº§ç¼“å­˜æµç¨‹\"></a>å¤šçº§ç¼“å­˜æµç¨‹</h4><p><img src=\"/2019/09/04/%E4%B8%80%E4%B8%AA%E4%BA%8B%E6%95%85%E5%BC%95%E8%B5%B7%E7%9A%84%E7%BC%93%E5%AD%98/%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98.png\" alt=\"02\"></p>\n<h4 id=\"springboot-å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\"><a href=\"#springboot-å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\" class=\"headerlink\" title=\"springboot å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿\"></a>springboot å¼€å¯ç¼“å­˜å¾ˆæ–¹ä¾¿</h4><ol>\n<li>ä¾èµ–org.springframework.boot:spring-boot-starter-cache</li>\n<li>åœ¨å¯åŠ¨ç±»å¢åŠ æ³¨è§£@EnableCaching</li>\n<li>åœ¨æƒ³è¦å¢åŠ ç¼“å­˜çš„æ–¹æ³•æˆ–è€…æˆå‘˜å˜é‡ä¸Šå¢åŠ ä»¥ä¸‹æ³¨è§£</li>\n</ol>\n<h4 id=\"å¯ç”¨å¤šçº§ç¼“å­˜\"><a href=\"#å¯ç”¨å¤šçº§ç¼“å­˜\" class=\"headerlink\" title=\"å¯ç”¨å¤šçº§ç¼“å­˜\"></a>å¯ç”¨å¤šçº§ç¼“å­˜</h4><ol>\n<li>å¼•å…¥ç»„ä»¶</li>\n</ol>\n<pre><code class=\"gradle\"></code></pre>\n<ol start=\"2\">\n<li>å¼€å¯ç¼“å­˜</li>\n</ol>\n<h6 id=\"æ— å‚ç¼“å­˜\"><a href=\"#æ— å‚ç¼“å­˜\" class=\"headerlink\" title=\"æ— å‚ç¼“å­˜\"></a>æ— å‚ç¼“å­˜</h6><pre><code class=\"java\"></code></pre>\n<h6 id=\"å¸¦å‚ç¼“å­˜1\"><a href=\"#å¸¦å‚ç¼“å­˜1\" class=\"headerlink\" title=\"å¸¦å‚ç¼“å­˜1\"></a>å¸¦å‚ç¼“å­˜1</h6><pre><code class=\"java\"></code></pre>\n<h6 id=\"å¸¦å‚ç¼“å­˜2\"><a href=\"#å¸¦å‚ç¼“å­˜2\" class=\"headerlink\" title=\"å¸¦å‚ç¼“å­˜2\"></a>å¸¦å‚ç¼“å­˜2</h6><pre><code class=\"java\"></code></pre>\n<h6 id=\"ç»„åˆå‚æ•°ç¼“å­˜\"><a href=\"#ç»„åˆå‚æ•°ç¼“å­˜\" class=\"headerlink\" title=\"ç»„åˆå‚æ•°ç¼“å­˜\"></a>ç»„åˆå‚æ•°ç¼“å­˜</h6><pre><code class=\"java\"></code></pre>"},{"title":"åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•æ•´ç†","date":"2020-03-01T12:56:56.000Z","_content":"\n# åˆ†å¸ƒå¼ç®—æ³•ç›¸å…³çŸ¥è¯†æ€»ç»“ï¼ˆæ–½å·¥ä¸­ï¼‰\næ€»ç»“å½“å‰ä½¿ç”¨è¾ƒå¤šçš„ä¸€ç§åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•çš„åŸç†åŠå…¶è¿ç”¨ã€‚\n\n## Raft\n<!-- more -->\n### è§’è‰²\n\næœ€å¤šåªæœ‰ä¸€ä¸ªLeaderï¼Œæ­£å¸¸å·¥ä½œæ—¶æœŸåªæœ‰Leaderå’ŒFollower\n\n- æˆå‘˜\n\n\t- Leader\n\n\t  æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶å‘FolloweråŒæ­¥è¯·æ±‚æ—¥å¿—ï¼Œå½“æ—¥å¿—åŒæ­¥åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šåå‘Šè¯‰Followeræäº¤æ—¥å¿—ã€‚\n\n\t- Follower\n\n\t  æ¥å—å¹¶æŒä¹…åŒ–LeaderåŒæ­¥çš„æ—¥å¿—ï¼Œåœ¨Leaderå‘Šä¹‹æ—¥å¿—å¯ä»¥æäº¤ä¹‹åï¼Œæäº¤æ—¥å¿—ã€‚\n\n\t- Candidate\n\n\t  Leaderé€‰ä¸¾è¿‡ç¨‹ä¸­çš„ä¸´æ—¶è§’è‰²ã€‚\n\n- è§’è‰²å˜åŒ–\n\n\t- Leader\n\n\t  Leaderåœ¨å½“å‰ä»»æœŸtermä¸­å¤±å»æœåŠ¡é“¾æ¥ï¼Œå°†ä¼šå˜ä¸ºCandidateã€‚\n\n\t- Follower\n\n\t  1.èŠ‚ç‚¹åˆå§‹çŠ¶æ€ä¸ºFollowerã€‚\n\t  2.Followerè¶…æ—¶æ²¡æœ‰æ”¶åˆ°Leaderçš„æ¶ˆæ¯ï¼Œä¼šè½¬å˜ä¸ºCandidateï¼Œå¹¶å¼€å§‹é€‰ä¸¾ã€‚\n\n\t- Candidate\n\n\t  1.é€‰ä¸¾æˆåŠŸæˆä¸ºLeaderã€‚\n\t  2.é€‰ä¸¾å¤±è´¥æˆä¸ºFollowerã€‚\n\t  3.è¶…æ—¶é‡æ–°é€‰ä¸¾ï¼Œè¿˜æ˜¯Candidateã€‚\n\n### Leaderé€‰ä¸¾\n\n1.Followerè¶…æ—¶æ²¡æœ‰æ”¶åˆ°Leaderçš„å¿ƒè·³æ—¶ä¼šå‘èµ·é€‰ä¸¾ï¼Œé€‰ä¸¾æ—¶ä¼šå°†è‡ªå·±çš„term+1ï¼Œå¹¶è½¬åŒ–ä¸ºCandidateä¸”æŠ•ç¥¨ç»™è‡ªå·±ï¼Œå¹¶å‘é›†ç¾¤å†…å‘é€RequestVote RPCã€‚\n\n- èµ¢å¾—æœ€å¤šé€‰ç¥¨æˆä¸ºLeader\n- æ”¶åˆ°å…¶ä»–Leaderä¿¡æ¯ï¼Œè¢«æŠ¢å…ˆé€‰ä¸¾\n- æ²¡æœ‰æœåŠ¡è·å¾—æœ€å¤šé€‰ç¥¨ï¼Œç­‰å¾…é‡æ–°å‘èµ·é€‰ä¸¾\n\n### æ—¥å¿—åŒæ­¥\n\n1.Leaderæ¥å—å®¢æˆ·ç«¯ä¿¡æ¯ã€‚\n2.Leaderå‘Followerå‘èµ·æ—¥å¿—å¤åˆ¶ï¼ŒAppendEntries RPCã€‚\n3.FolloweræœªæˆåŠŸæ¥å—æ—¶ï¼ŒLeaderä¼šæŒç»­å‘Followerå‘èµ·AppendEntries RPCã€‚\n4.å¤§éƒ¨åˆ†Followerè¿”å›æˆåŠŸæ—¶ï¼ŒLeaderå‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸç»“æœï¼Œå¹¶å…è®¸æ”¹æ¡æ—¥å¿—commitã€‚\n\n- æ—¥å¿—\n\n  æ—¥å¿—åŒ…å«ç´¢å¼•ï¼Œå½“å‰termå·ï¼Œå’ŒçŠ¶æ€æœºçš„æ‰§è¡Œå‘½ä»¤ã€‚\n\n- åŒæ­¥\n\n  1.ç›¸åŒç´¢å¼•å’Œtermå·çš„å‘½ä»¤æ˜¯ç›¸åŒçš„ã€‚\n  2.ç›¸åŒç´¢å¼•å’Œtermå·ä¹‹å‰çš„æ—¥å¿—éƒ½æ˜¯ç›¸åŒçš„ã€‚\n  \n  Leaderä¸ºäº†ä½¿Followersçš„æ—¥å¿—åŒè‡ªå·±çš„ä¸€è‡´ï¼ŒLeaderéœ€è¦æ‰¾åˆ°FollowersåŒå®ƒçš„æ—¥å¿—ä¸€è‡´çš„åœ°æ–¹ï¼Œç„¶åè¦†ç›–Followersåœ¨è¯¥ä½ç½®ä¹‹åçš„æ¡ç›®\n\n### å®‰å…¨æ€§\n\n1.æ‹¥æœ‰æœ€æ–°çš„å·²æäº¤çš„log entryçš„Followeræ‰æœ‰èµ„æ ¼æˆä¸ºLeaderã€‚\n2.Leaderåªèƒ½æ¨è¿›commit indexæ¥æäº¤å½“å‰termçš„å·²ç»å¤åˆ¶åˆ°å¤§å¤šæ•°æœåŠ¡å™¨ä¸Šçš„æ—¥å¿—ï¼Œæ—§termæ—¥å¿—çš„æäº¤è¦ç­‰åˆ°æäº¤å½“å‰termçš„æ—¥å¿—æ¥é—´æ¥æäº¤ï¼ˆlog index å°äº commit indexçš„æ—¥å¿—è¢«é—´æ¥æäº¤ï¼‰ã€‚\n\n### æ—¥å¿—å‹ç¼©\n\nRafté‡‡ç”¨å¯¹æ•´ä¸ªç³»ç»Ÿè¿›è¡Œsnapshotæ¥è§£å†³ï¼Œsnapshotä¹‹å‰çš„æ—¥å¿—éƒ½å¯ä»¥ä¸¢å¼ƒã€‚\næ¯ä¸ªå‰¯æœ¬ç‹¬ç«‹çš„å¯¹è‡ªå·±çš„ç³»ç»ŸçŠ¶æ€è¿›è¡Œsnapshotï¼Œå¹¶ä¸”åªèƒ½å¯¹å·²ç»æäº¤çš„æ—¥å¿—è®°å½•è¿›è¡Œsnapshotã€‚\n\n- Snapshot\n\n  1.æ—¥å¿—å…ƒæ•°æ®ã€‚æœ€åä¸€æ¡å·²æäº¤çš„ log entryçš„ log indexå’Œtermã€‚è¿™ä¸¤ä¸ªå€¼åœ¨snapshotä¹‹åçš„ç¬¬ä¸€æ¡log entryçš„AppendEntries RPCçš„å®Œæ•´æ€§æ£€æŸ¥çš„æ—¶å€™ä¼šè¢«ç”¨ä¸Šã€‚\n  2.ç³»ç»Ÿå½“å‰çŠ¶æ€ã€‚\n  \n  Leaderä¼šä»¥Snapshotçš„å½¢å¼å‘ç»™æ—¥å¿—è½åå¤ªå¤šæˆ–æ–°ä¸Šçº¿çš„Followerï¼Œä½¿ç”¨InstalledSnapshot RPCã€‚\n\n## Paxos\n\n*XMind: ZEN - Trial Version*","source":"_posts/åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•æ•´ç†.md","raw":"---\ntitle: åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•æ•´ç†\ndate: 2020-03-01 20:56:56\ntags: \n    - Java\ncategories :\n    - Technology\n---\n\n# åˆ†å¸ƒå¼ç®—æ³•ç›¸å…³çŸ¥è¯†æ€»ç»“ï¼ˆæ–½å·¥ä¸­ï¼‰\næ€»ç»“å½“å‰ä½¿ç”¨è¾ƒå¤šçš„ä¸€ç§åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•çš„åŸç†åŠå…¶è¿ç”¨ã€‚\n\n## Raft\n<!-- more -->\n### è§’è‰²\n\næœ€å¤šåªæœ‰ä¸€ä¸ªLeaderï¼Œæ­£å¸¸å·¥ä½œæ—¶æœŸåªæœ‰Leaderå’ŒFollower\n\n- æˆå‘˜\n\n\t- Leader\n\n\t  æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶å‘FolloweråŒæ­¥è¯·æ±‚æ—¥å¿—ï¼Œå½“æ—¥å¿—åŒæ­¥åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šåå‘Šè¯‰Followeræäº¤æ—¥å¿—ã€‚\n\n\t- Follower\n\n\t  æ¥å—å¹¶æŒä¹…åŒ–LeaderåŒæ­¥çš„æ—¥å¿—ï¼Œåœ¨Leaderå‘Šä¹‹æ—¥å¿—å¯ä»¥æäº¤ä¹‹åï¼Œæäº¤æ—¥å¿—ã€‚\n\n\t- Candidate\n\n\t  Leaderé€‰ä¸¾è¿‡ç¨‹ä¸­çš„ä¸´æ—¶è§’è‰²ã€‚\n\n- è§’è‰²å˜åŒ–\n\n\t- Leader\n\n\t  Leaderåœ¨å½“å‰ä»»æœŸtermä¸­å¤±å»æœåŠ¡é“¾æ¥ï¼Œå°†ä¼šå˜ä¸ºCandidateã€‚\n\n\t- Follower\n\n\t  1.èŠ‚ç‚¹åˆå§‹çŠ¶æ€ä¸ºFollowerã€‚\n\t  2.Followerè¶…æ—¶æ²¡æœ‰æ”¶åˆ°Leaderçš„æ¶ˆæ¯ï¼Œä¼šè½¬å˜ä¸ºCandidateï¼Œå¹¶å¼€å§‹é€‰ä¸¾ã€‚\n\n\t- Candidate\n\n\t  1.é€‰ä¸¾æˆåŠŸæˆä¸ºLeaderã€‚\n\t  2.é€‰ä¸¾å¤±è´¥æˆä¸ºFollowerã€‚\n\t  3.è¶…æ—¶é‡æ–°é€‰ä¸¾ï¼Œè¿˜æ˜¯Candidateã€‚\n\n### Leaderé€‰ä¸¾\n\n1.Followerè¶…æ—¶æ²¡æœ‰æ”¶åˆ°Leaderçš„å¿ƒè·³æ—¶ä¼šå‘èµ·é€‰ä¸¾ï¼Œé€‰ä¸¾æ—¶ä¼šå°†è‡ªå·±çš„term+1ï¼Œå¹¶è½¬åŒ–ä¸ºCandidateä¸”æŠ•ç¥¨ç»™è‡ªå·±ï¼Œå¹¶å‘é›†ç¾¤å†…å‘é€RequestVote RPCã€‚\n\n- èµ¢å¾—æœ€å¤šé€‰ç¥¨æˆä¸ºLeader\n- æ”¶åˆ°å…¶ä»–Leaderä¿¡æ¯ï¼Œè¢«æŠ¢å…ˆé€‰ä¸¾\n- æ²¡æœ‰æœåŠ¡è·å¾—æœ€å¤šé€‰ç¥¨ï¼Œç­‰å¾…é‡æ–°å‘èµ·é€‰ä¸¾\n\n### æ—¥å¿—åŒæ­¥\n\n1.Leaderæ¥å—å®¢æˆ·ç«¯ä¿¡æ¯ã€‚\n2.Leaderå‘Followerå‘èµ·æ—¥å¿—å¤åˆ¶ï¼ŒAppendEntries RPCã€‚\n3.FolloweræœªæˆåŠŸæ¥å—æ—¶ï¼ŒLeaderä¼šæŒç»­å‘Followerå‘èµ·AppendEntries RPCã€‚\n4.å¤§éƒ¨åˆ†Followerè¿”å›æˆåŠŸæ—¶ï¼ŒLeaderå‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸç»“æœï¼Œå¹¶å…è®¸æ”¹æ¡æ—¥å¿—commitã€‚\n\n- æ—¥å¿—\n\n  æ—¥å¿—åŒ…å«ç´¢å¼•ï¼Œå½“å‰termå·ï¼Œå’ŒçŠ¶æ€æœºçš„æ‰§è¡Œå‘½ä»¤ã€‚\n\n- åŒæ­¥\n\n  1.ç›¸åŒç´¢å¼•å’Œtermå·çš„å‘½ä»¤æ˜¯ç›¸åŒçš„ã€‚\n  2.ç›¸åŒç´¢å¼•å’Œtermå·ä¹‹å‰çš„æ—¥å¿—éƒ½æ˜¯ç›¸åŒçš„ã€‚\n  \n  Leaderä¸ºäº†ä½¿Followersçš„æ—¥å¿—åŒè‡ªå·±çš„ä¸€è‡´ï¼ŒLeaderéœ€è¦æ‰¾åˆ°FollowersåŒå®ƒçš„æ—¥å¿—ä¸€è‡´çš„åœ°æ–¹ï¼Œç„¶åè¦†ç›–Followersåœ¨è¯¥ä½ç½®ä¹‹åçš„æ¡ç›®\n\n### å®‰å…¨æ€§\n\n1.æ‹¥æœ‰æœ€æ–°çš„å·²æäº¤çš„log entryçš„Followeræ‰æœ‰èµ„æ ¼æˆä¸ºLeaderã€‚\n2.Leaderåªèƒ½æ¨è¿›commit indexæ¥æäº¤å½“å‰termçš„å·²ç»å¤åˆ¶åˆ°å¤§å¤šæ•°æœåŠ¡å™¨ä¸Šçš„æ—¥å¿—ï¼Œæ—§termæ—¥å¿—çš„æäº¤è¦ç­‰åˆ°æäº¤å½“å‰termçš„æ—¥å¿—æ¥é—´æ¥æäº¤ï¼ˆlog index å°äº commit indexçš„æ—¥å¿—è¢«é—´æ¥æäº¤ï¼‰ã€‚\n\n### æ—¥å¿—å‹ç¼©\n\nRafté‡‡ç”¨å¯¹æ•´ä¸ªç³»ç»Ÿè¿›è¡Œsnapshotæ¥è§£å†³ï¼Œsnapshotä¹‹å‰çš„æ—¥å¿—éƒ½å¯ä»¥ä¸¢å¼ƒã€‚\næ¯ä¸ªå‰¯æœ¬ç‹¬ç«‹çš„å¯¹è‡ªå·±çš„ç³»ç»ŸçŠ¶æ€è¿›è¡Œsnapshotï¼Œå¹¶ä¸”åªèƒ½å¯¹å·²ç»æäº¤çš„æ—¥å¿—è®°å½•è¿›è¡Œsnapshotã€‚\n\n- Snapshot\n\n  1.æ—¥å¿—å…ƒæ•°æ®ã€‚æœ€åä¸€æ¡å·²æäº¤çš„ log entryçš„ log indexå’Œtermã€‚è¿™ä¸¤ä¸ªå€¼åœ¨snapshotä¹‹åçš„ç¬¬ä¸€æ¡log entryçš„AppendEntries RPCçš„å®Œæ•´æ€§æ£€æŸ¥çš„æ—¶å€™ä¼šè¢«ç”¨ä¸Šã€‚\n  2.ç³»ç»Ÿå½“å‰çŠ¶æ€ã€‚\n  \n  Leaderä¼šä»¥Snapshotçš„å½¢å¼å‘ç»™æ—¥å¿—è½åå¤ªå¤šæˆ–æ–°ä¸Šçº¿çš„Followerï¼Œä½¿ç”¨InstalledSnapshot RPCã€‚\n\n## Paxos\n\n*XMind: ZEN - Trial Version*","slug":"åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•æ•´ç†","published":1,"updated":"2020-12-14T09:51:24.018Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htc000kv25248magx16","content":"<html><head></head><body><h1 id=\"&#x5206;&#x5E03;&#x5F0F;&#x7B97;&#x6CD5;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x603B;&#x7ED3;&#xFF08;&#x65BD;&#x5DE5;&#x4E2D;&#xFF09;\"><a href=\"#&#x5206;&#x5E03;&#x5F0F;&#x7B97;&#x6CD5;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x603B;&#x7ED3;&#xFF08;&#x65BD;&#x5DE5;&#x4E2D;&#xFF09;\" class=\"headerlink\" title=\"&#x5206;&#x5E03;&#x5F0F;&#x7B97;&#x6CD5;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x603B;&#x7ED3;&#xFF08;&#x65BD;&#x5DE5;&#x4E2D;&#xFF09;\"></a>&#x5206;&#x5E03;&#x5F0F;&#x7B97;&#x6CD5;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x603B;&#x7ED3;&#xFF08;&#x65BD;&#x5DE5;&#x4E2D;&#xFF09;</h1><p>&#x603B;&#x7ED3;&#x5F53;&#x524D;&#x4F7F;&#x7528;&#x8F83;&#x591A;&#x7684;&#x4E00;&#x79CD;&#x5206;&#x5E03;&#x5F0F;&#x4E00;&#x81F4;&#x6027;&#x7B97;&#x6CD5;&#x7684;&#x539F;&#x7406;&#x53CA;&#x5176;&#x8FD0;&#x7528;&#x3002;</p>\n<h2 id=\"Raft\"><a href=\"#Raft\" class=\"headerlink\" title=\"Raft\"></a>Raft</h2><a id=\"more\"></a>\n<h3 id=\"&#x89D2;&#x8272;\"><a href=\"#&#x89D2;&#x8272;\" class=\"headerlink\" title=\"&#x89D2;&#x8272;\"></a>&#x89D2;&#x8272;</h3><p>&#x6700;&#x591A;&#x53EA;&#x6709;&#x4E00;&#x4E2A;Leader&#xFF0C;&#x6B63;&#x5E38;&#x5DE5;&#x4F5C;&#x65F6;&#x671F;&#x53EA;&#x6709;Leader&#x548C;Follower</p>\n<ul>\n<li><p>&#x6210;&#x5458;</p>\n<ul>\n<li><p>Leader</p>\n<p>&#x63A5;&#x53D7;&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x5411;Follower&#x540C;&#x6B65;&#x8BF7;&#x6C42;&#x65E5;&#x5FD7;&#xFF0C;&#x5F53;&#x65E5;&#x5FD7;&#x540C;&#x6B65;&#x5230;&#x5927;&#x591A;&#x6570;&#x8282;&#x70B9;&#x4E0A;&#x540E;&#x544A;&#x8BC9;Follower&#x63D0;&#x4EA4;&#x65E5;&#x5FD7;&#x3002;</p>\n</li>\n<li><p>Follower</p>\n<p>&#x63A5;&#x53D7;&#x5E76;&#x6301;&#x4E45;&#x5316;Leader&#x540C;&#x6B65;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x5728;Leader&#x544A;&#x4E4B;&#x65E5;&#x5FD7;&#x53EF;&#x4EE5;&#x63D0;&#x4EA4;&#x4E4B;&#x540E;&#xFF0C;&#x63D0;&#x4EA4;&#x65E5;&#x5FD7;&#x3002;</p>\n</li>\n<li><p>Candidate</p>\n<p>Leader&#x9009;&#x4E3E;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x4E34;&#x65F6;&#x89D2;&#x8272;&#x3002;</p>\n</li>\n</ul>\n</li>\n<li><p>&#x89D2;&#x8272;&#x53D8;&#x5316;</p>\n<ul>\n<li><p>Leader</p>\n<p>Leader&#x5728;&#x5F53;&#x524D;&#x4EFB;&#x671F;term&#x4E2D;&#x5931;&#x53BB;&#x670D;&#x52A1;&#x94FE;&#x63A5;&#xFF0C;&#x5C06;&#x4F1A;&#x53D8;&#x4E3A;Candidate&#x3002;</p>\n</li>\n<li><p>Follower</p>\n<p>1.&#x8282;&#x70B9;&#x521D;&#x59CB;&#x72B6;&#x6001;&#x4E3A;Follower&#x3002;<br>2.Follower&#x8D85;&#x65F6;&#x6CA1;&#x6709;&#x6536;&#x5230;Leader&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x4F1A;&#x8F6C;&#x53D8;&#x4E3A;Candidate&#xFF0C;&#x5E76;&#x5F00;&#x59CB;&#x9009;&#x4E3E;&#x3002;</p>\n</li>\n<li><p>Candidate</p>\n<p>1.&#x9009;&#x4E3E;&#x6210;&#x529F;&#x6210;&#x4E3A;Leader&#x3002;<br>2.&#x9009;&#x4E3E;&#x5931;&#x8D25;&#x6210;&#x4E3A;Follower&#x3002;<br>3.&#x8D85;&#x65F6;&#x91CD;&#x65B0;&#x9009;&#x4E3E;&#xFF0C;&#x8FD8;&#x662F;Candidate&#x3002;</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Leader&#x9009;&#x4E3E;\"><a href=\"#Leader&#x9009;&#x4E3E;\" class=\"headerlink\" title=\"Leader&#x9009;&#x4E3E;\"></a>Leader&#x9009;&#x4E3E;</h3><p>1.Follower&#x8D85;&#x65F6;&#x6CA1;&#x6709;&#x6536;&#x5230;Leader&#x7684;&#x5FC3;&#x8DF3;&#x65F6;&#x4F1A;&#x53D1;&#x8D77;&#x9009;&#x4E3E;&#xFF0C;&#x9009;&#x4E3E;&#x65F6;&#x4F1A;&#x5C06;&#x81EA;&#x5DF1;&#x7684;term+1&#xFF0C;&#x5E76;&#x8F6C;&#x5316;&#x4E3A;Candidate&#x4E14;&#x6295;&#x7968;&#x7ED9;&#x81EA;&#x5DF1;&#xFF0C;&#x5E76;&#x5411;&#x96C6;&#x7FA4;&#x5185;&#x53D1;&#x9001;RequestVote RPC&#x3002;</p>\n<ul>\n<li>&#x8D62;&#x5F97;&#x6700;&#x591A;&#x9009;&#x7968;&#x6210;&#x4E3A;Leader</li>\n<li>&#x6536;&#x5230;&#x5176;&#x4ED6;Leader&#x4FE1;&#x606F;&#xFF0C;&#x88AB;&#x62A2;&#x5148;&#x9009;&#x4E3E;</li>\n<li>&#x6CA1;&#x6709;&#x670D;&#x52A1;&#x83B7;&#x5F97;&#x6700;&#x591A;&#x9009;&#x7968;&#xFF0C;&#x7B49;&#x5F85;&#x91CD;&#x65B0;&#x53D1;&#x8D77;&#x9009;&#x4E3E;</li>\n</ul>\n<h3 id=\"&#x65E5;&#x5FD7;&#x540C;&#x6B65;\"><a href=\"#&#x65E5;&#x5FD7;&#x540C;&#x6B65;\" class=\"headerlink\" title=\"&#x65E5;&#x5FD7;&#x540C;&#x6B65;\"></a>&#x65E5;&#x5FD7;&#x540C;&#x6B65;</h3><p>1.Leader&#x63A5;&#x53D7;&#x5BA2;&#x6237;&#x7AEF;&#x4FE1;&#x606F;&#x3002;<br>2.Leader&#x5411;Follower&#x53D1;&#x8D77;&#x65E5;&#x5FD7;&#x590D;&#x5236;&#xFF0C;AppendEntries RPC&#x3002;<br>3.Follower&#x672A;&#x6210;&#x529F;&#x63A5;&#x53D7;&#x65F6;&#xFF0C;Leader&#x4F1A;&#x6301;&#x7EED;&#x5411;Follower&#x53D1;&#x8D77;AppendEntries RPC&#x3002;<br>4.&#x5927;&#x90E8;&#x5206;Follower&#x8FD4;&#x56DE;&#x6210;&#x529F;&#x65F6;&#xFF0C;Leader&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x8FD4;&#x56DE;&#x6210;&#x529F;&#x7ED3;&#x679C;&#xFF0C;&#x5E76;&#x5141;&#x8BB8;&#x6539;&#x6761;&#x65E5;&#x5FD7;commit&#x3002;</p>\n<ul>\n<li><p>&#x65E5;&#x5FD7;</p>\n<p>&#x65E5;&#x5FD7;&#x5305;&#x542B;&#x7D22;&#x5F15;&#xFF0C;&#x5F53;&#x524D;term&#x53F7;&#xFF0C;&#x548C;&#x72B6;&#x6001;&#x673A;&#x7684;&#x6267;&#x884C;&#x547D;&#x4EE4;&#x3002;</p>\n</li>\n<li><p>&#x540C;&#x6B65;</p>\n<p>1.&#x76F8;&#x540C;&#x7D22;&#x5F15;&#x548C;term&#x53F7;&#x7684;&#x547D;&#x4EE4;&#x662F;&#x76F8;&#x540C;&#x7684;&#x3002;<br>2.&#x76F8;&#x540C;&#x7D22;&#x5F15;&#x548C;term&#x53F7;&#x4E4B;&#x524D;&#x7684;&#x65E5;&#x5FD7;&#x90FD;&#x662F;&#x76F8;&#x540C;&#x7684;&#x3002;</p>\n<p>Leader&#x4E3A;&#x4E86;&#x4F7F;Followers&#x7684;&#x65E5;&#x5FD7;&#x540C;&#x81EA;&#x5DF1;&#x7684;&#x4E00;&#x81F4;&#xFF0C;Leader&#x9700;&#x8981;&#x627E;&#x5230;Followers&#x540C;&#x5B83;&#x7684;&#x65E5;&#x5FD7;&#x4E00;&#x81F4;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x7136;&#x540E;&#x8986;&#x76D6;Followers&#x5728;&#x8BE5;&#x4F4D;&#x7F6E;&#x4E4B;&#x540E;&#x7684;&#x6761;&#x76EE;</p>\n</li>\n</ul>\n<h3 id=\"&#x5B89;&#x5168;&#x6027;\"><a href=\"#&#x5B89;&#x5168;&#x6027;\" class=\"headerlink\" title=\"&#x5B89;&#x5168;&#x6027;\"></a>&#x5B89;&#x5168;&#x6027;</h3><p>1.&#x62E5;&#x6709;&#x6700;&#x65B0;&#x7684;&#x5DF2;&#x63D0;&#x4EA4;&#x7684;log entry&#x7684;Follower&#x624D;&#x6709;&#x8D44;&#x683C;&#x6210;&#x4E3A;Leader&#x3002;<br>2.Leader&#x53EA;&#x80FD;&#x63A8;&#x8FDB;commit index&#x6765;&#x63D0;&#x4EA4;&#x5F53;&#x524D;term&#x7684;&#x5DF2;&#x7ECF;&#x590D;&#x5236;&#x5230;&#x5927;&#x591A;&#x6570;&#x670D;&#x52A1;&#x5668;&#x4E0A;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x65E7;term&#x65E5;&#x5FD7;&#x7684;&#x63D0;&#x4EA4;&#x8981;&#x7B49;&#x5230;&#x63D0;&#x4EA4;&#x5F53;&#x524D;term&#x7684;&#x65E5;&#x5FD7;&#x6765;&#x95F4;&#x63A5;&#x63D0;&#x4EA4;&#xFF08;log index &#x5C0F;&#x4E8E; commit index&#x7684;&#x65E5;&#x5FD7;&#x88AB;&#x95F4;&#x63A5;&#x63D0;&#x4EA4;&#xFF09;&#x3002;</p>\n<h3 id=\"&#x65E5;&#x5FD7;&#x538B;&#x7F29;\"><a href=\"#&#x65E5;&#x5FD7;&#x538B;&#x7F29;\" class=\"headerlink\" title=\"&#x65E5;&#x5FD7;&#x538B;&#x7F29;\"></a>&#x65E5;&#x5FD7;&#x538B;&#x7F29;</h3><p>Raft&#x91C7;&#x7528;&#x5BF9;&#x6574;&#x4E2A;&#x7CFB;&#x7EDF;&#x8FDB;&#x884C;snapshot&#x6765;&#x89E3;&#x51B3;&#xFF0C;snapshot&#x4E4B;&#x524D;&#x7684;&#x65E5;&#x5FD7;&#x90FD;&#x53EF;&#x4EE5;&#x4E22;&#x5F03;&#x3002;<br>&#x6BCF;&#x4E2A;&#x526F;&#x672C;&#x72EC;&#x7ACB;&#x7684;&#x5BF9;&#x81EA;&#x5DF1;&#x7684;&#x7CFB;&#x7EDF;&#x72B6;&#x6001;&#x8FDB;&#x884C;snapshot&#xFF0C;&#x5E76;&#x4E14;&#x53EA;&#x80FD;&#x5BF9;&#x5DF2;&#x7ECF;&#x63D0;&#x4EA4;&#x7684;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x8FDB;&#x884C;snapshot&#x3002;</p>\n<ul>\n<li><p>Snapshot</p>\n<p>1.&#x65E5;&#x5FD7;&#x5143;&#x6570;&#x636E;&#x3002;&#x6700;&#x540E;&#x4E00;&#x6761;&#x5DF2;&#x63D0;&#x4EA4;&#x7684; log entry&#x7684; log index&#x548C;term&#x3002;&#x8FD9;&#x4E24;&#x4E2A;&#x503C;&#x5728;snapshot&#x4E4B;&#x540E;&#x7684;&#x7B2C;&#x4E00;&#x6761;log entry&#x7684;AppendEntries RPC&#x7684;&#x5B8C;&#x6574;&#x6027;&#x68C0;&#x67E5;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x88AB;&#x7528;&#x4E0A;&#x3002;<br>2.&#x7CFB;&#x7EDF;&#x5F53;&#x524D;&#x72B6;&#x6001;&#x3002;</p>\n<p>Leader&#x4F1A;&#x4EE5;Snapshot&#x7684;&#x5F62;&#x5F0F;&#x53D1;&#x7ED9;&#x65E5;&#x5FD7;&#x843D;&#x540E;&#x592A;&#x591A;&#x6216;&#x65B0;&#x4E0A;&#x7EBF;&#x7684;Follower&#xFF0C;&#x4F7F;&#x7528;InstalledSnapshot RPC&#x3002;</p>\n</li>\n</ul>\n<h2 id=\"Paxos\"><a href=\"#Paxos\" class=\"headerlink\" title=\"Paxos\"></a>Paxos</h2><p><em>XMind: ZEN - Trial Version</em></p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"}],"excerpt":"<html><head></head><body><h1 id=\"&#x5206;&#x5E03;&#x5F0F;&#x7B97;&#x6CD5;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x603B;&#x7ED3;&#xFF08;&#x65BD;&#x5DE5;&#x4E2D;&#xFF09;\"><a href=\"#&#x5206;&#x5E03;&#x5F0F;&#x7B97;&#x6CD5;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x603B;&#x7ED3;&#xFF08;&#x65BD;&#x5DE5;&#x4E2D;&#xFF09;\" class=\"headerlink\" title=\"&#x5206;&#x5E03;&#x5F0F;&#x7B97;&#x6CD5;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x603B;&#x7ED3;&#xFF08;&#x65BD;&#x5DE5;&#x4E2D;&#xFF09;\"></a>&#x5206;&#x5E03;&#x5F0F;&#x7B97;&#x6CD5;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x603B;&#x7ED3;&#xFF08;&#x65BD;&#x5DE5;&#x4E2D;&#xFF09;</h1><p>&#x603B;&#x7ED3;&#x5F53;&#x524D;&#x4F7F;&#x7528;&#x8F83;&#x591A;&#x7684;&#x4E00;&#x79CD;&#x5206;&#x5E03;&#x5F0F;&#x4E00;&#x81F4;&#x6027;&#x7B97;&#x6CD5;&#x7684;&#x539F;&#x7406;&#x53CA;&#x5176;&#x8FD0;&#x7528;&#x3002;</p>\n<h2 id=\"Raft\"><a href=\"#Raft\" class=\"headerlink\" title=\"Raft\"></a>Raft</h2></body></html>","more":"<h3 id=\"è§’è‰²\"><a href=\"#è§’è‰²\" class=\"headerlink\" title=\"è§’è‰²\"></a>è§’è‰²</h3><p>æœ€å¤šåªæœ‰ä¸€ä¸ªLeaderï¼Œæ­£å¸¸å·¥ä½œæ—¶æœŸåªæœ‰Leaderå’ŒFollower</p>\n<ul>\n<li><p>æˆå‘˜</p>\n<ul>\n<li><p>Leader</p>\n<p>æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶å‘FolloweråŒæ­¥è¯·æ±‚æ—¥å¿—ï¼Œå½“æ—¥å¿—åŒæ­¥åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šåå‘Šè¯‰Followeræäº¤æ—¥å¿—ã€‚</p>\n</li>\n<li><p>Follower</p>\n<p>æ¥å—å¹¶æŒä¹…åŒ–LeaderåŒæ­¥çš„æ—¥å¿—ï¼Œåœ¨Leaderå‘Šä¹‹æ—¥å¿—å¯ä»¥æäº¤ä¹‹åï¼Œæäº¤æ—¥å¿—ã€‚</p>\n</li>\n<li><p>Candidate</p>\n<p>Leaderé€‰ä¸¾è¿‡ç¨‹ä¸­çš„ä¸´æ—¶è§’è‰²ã€‚</p>\n</li>\n</ul>\n</li>\n<li><p>è§’è‰²å˜åŒ–</p>\n<ul>\n<li><p>Leader</p>\n<p>Leaderåœ¨å½“å‰ä»»æœŸtermä¸­å¤±å»æœåŠ¡é“¾æ¥ï¼Œå°†ä¼šå˜ä¸ºCandidateã€‚</p>\n</li>\n<li><p>Follower</p>\n<p>1.èŠ‚ç‚¹åˆå§‹çŠ¶æ€ä¸ºFollowerã€‚<br>2.Followerè¶…æ—¶æ²¡æœ‰æ”¶åˆ°Leaderçš„æ¶ˆæ¯ï¼Œä¼šè½¬å˜ä¸ºCandidateï¼Œå¹¶å¼€å§‹é€‰ä¸¾ã€‚</p>\n</li>\n<li><p>Candidate</p>\n<p>1.é€‰ä¸¾æˆåŠŸæˆä¸ºLeaderã€‚<br>2.é€‰ä¸¾å¤±è´¥æˆä¸ºFollowerã€‚<br>3.è¶…æ—¶é‡æ–°é€‰ä¸¾ï¼Œè¿˜æ˜¯Candidateã€‚</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"Leaderé€‰ä¸¾\"><a href=\"#Leaderé€‰ä¸¾\" class=\"headerlink\" title=\"Leaderé€‰ä¸¾\"></a>Leaderé€‰ä¸¾</h3><p>1.Followerè¶…æ—¶æ²¡æœ‰æ”¶åˆ°Leaderçš„å¿ƒè·³æ—¶ä¼šå‘èµ·é€‰ä¸¾ï¼Œé€‰ä¸¾æ—¶ä¼šå°†è‡ªå·±çš„term+1ï¼Œå¹¶è½¬åŒ–ä¸ºCandidateä¸”æŠ•ç¥¨ç»™è‡ªå·±ï¼Œå¹¶å‘é›†ç¾¤å†…å‘é€RequestVote RPCã€‚</p>\n<ul>\n<li>èµ¢å¾—æœ€å¤šé€‰ç¥¨æˆä¸ºLeader</li>\n<li>æ”¶åˆ°å…¶ä»–Leaderä¿¡æ¯ï¼Œè¢«æŠ¢å…ˆé€‰ä¸¾</li>\n<li>æ²¡æœ‰æœåŠ¡è·å¾—æœ€å¤šé€‰ç¥¨ï¼Œç­‰å¾…é‡æ–°å‘èµ·é€‰ä¸¾</li>\n</ul>\n<h3 id=\"æ—¥å¿—åŒæ­¥\"><a href=\"#æ—¥å¿—åŒæ­¥\" class=\"headerlink\" title=\"æ—¥å¿—åŒæ­¥\"></a>æ—¥å¿—åŒæ­¥</h3><p>1.Leaderæ¥å—å®¢æˆ·ç«¯ä¿¡æ¯ã€‚<br>2.Leaderå‘Followerå‘èµ·æ—¥å¿—å¤åˆ¶ï¼ŒAppendEntries RPCã€‚<br>3.FolloweræœªæˆåŠŸæ¥å—æ—¶ï¼ŒLeaderä¼šæŒç»­å‘Followerå‘èµ·AppendEntries RPCã€‚<br>4.å¤§éƒ¨åˆ†Followerè¿”å›æˆåŠŸæ—¶ï¼ŒLeaderå‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸç»“æœï¼Œå¹¶å…è®¸æ”¹æ¡æ—¥å¿—commitã€‚</p>\n<ul>\n<li><p>æ—¥å¿—</p>\n<p>æ—¥å¿—åŒ…å«ç´¢å¼•ï¼Œå½“å‰termå·ï¼Œå’ŒçŠ¶æ€æœºçš„æ‰§è¡Œå‘½ä»¤ã€‚</p>\n</li>\n<li><p>åŒæ­¥</p>\n<p>1.ç›¸åŒç´¢å¼•å’Œtermå·çš„å‘½ä»¤æ˜¯ç›¸åŒçš„ã€‚<br>2.ç›¸åŒç´¢å¼•å’Œtermå·ä¹‹å‰çš„æ—¥å¿—éƒ½æ˜¯ç›¸åŒçš„ã€‚</p>\n<p>Leaderä¸ºäº†ä½¿Followersçš„æ—¥å¿—åŒè‡ªå·±çš„ä¸€è‡´ï¼ŒLeaderéœ€è¦æ‰¾åˆ°FollowersåŒå®ƒçš„æ—¥å¿—ä¸€è‡´çš„åœ°æ–¹ï¼Œç„¶åè¦†ç›–Followersåœ¨è¯¥ä½ç½®ä¹‹åçš„æ¡ç›®</p>\n</li>\n</ul>\n<h3 id=\"å®‰å…¨æ€§\"><a href=\"#å®‰å…¨æ€§\" class=\"headerlink\" title=\"å®‰å…¨æ€§\"></a>å®‰å…¨æ€§</h3><p>1.æ‹¥æœ‰æœ€æ–°çš„å·²æäº¤çš„log entryçš„Followeræ‰æœ‰èµ„æ ¼æˆä¸ºLeaderã€‚<br>2.Leaderåªèƒ½æ¨è¿›commit indexæ¥æäº¤å½“å‰termçš„å·²ç»å¤åˆ¶åˆ°å¤§å¤šæ•°æœåŠ¡å™¨ä¸Šçš„æ—¥å¿—ï¼Œæ—§termæ—¥å¿—çš„æäº¤è¦ç­‰åˆ°æäº¤å½“å‰termçš„æ—¥å¿—æ¥é—´æ¥æäº¤ï¼ˆlog index å°äº commit indexçš„æ—¥å¿—è¢«é—´æ¥æäº¤ï¼‰ã€‚</p>\n<h3 id=\"æ—¥å¿—å‹ç¼©\"><a href=\"#æ—¥å¿—å‹ç¼©\" class=\"headerlink\" title=\"æ—¥å¿—å‹ç¼©\"></a>æ—¥å¿—å‹ç¼©</h3><p>Rafté‡‡ç”¨å¯¹æ•´ä¸ªç³»ç»Ÿè¿›è¡Œsnapshotæ¥è§£å†³ï¼Œsnapshotä¹‹å‰çš„æ—¥å¿—éƒ½å¯ä»¥ä¸¢å¼ƒã€‚<br>æ¯ä¸ªå‰¯æœ¬ç‹¬ç«‹çš„å¯¹è‡ªå·±çš„ç³»ç»ŸçŠ¶æ€è¿›è¡Œsnapshotï¼Œå¹¶ä¸”åªèƒ½å¯¹å·²ç»æäº¤çš„æ—¥å¿—è®°å½•è¿›è¡Œsnapshotã€‚</p>\n<ul>\n<li><p>Snapshot</p>\n<p>1.æ—¥å¿—å…ƒæ•°æ®ã€‚æœ€åä¸€æ¡å·²æäº¤çš„ log entryçš„ log indexå’Œtermã€‚è¿™ä¸¤ä¸ªå€¼åœ¨snapshotä¹‹åçš„ç¬¬ä¸€æ¡log entryçš„AppendEntries RPCçš„å®Œæ•´æ€§æ£€æŸ¥çš„æ—¶å€™ä¼šè¢«ç”¨ä¸Šã€‚<br>2.ç³»ç»Ÿå½“å‰çŠ¶æ€ã€‚</p>\n<p>Leaderä¼šä»¥Snapshotçš„å½¢å¼å‘ç»™æ—¥å¿—è½åå¤ªå¤šæˆ–æ–°ä¸Šçº¿çš„Followerï¼Œä½¿ç”¨InstalledSnapshot RPCã€‚</p>\n</li>\n</ul>\n<h2 id=\"Paxos\"><a href=\"#Paxos\" class=\"headerlink\" title=\"Paxos\"></a>Paxos</h2><p><em>XMind: ZEN - Trial Version</em></p>"},{"title":"åˆ†å¸ƒå¼äº‹åŠ¡å…¶å®å¾ˆç®€å•","date":"2020-03-01T12:54:06.000Z","_content":"\n# ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æœ‰åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ\n\n## å…ˆèŠèŠæˆ‘ä»¬çš„é¡¹ç›®å¼€å‘\nå·¥ä½œä¸­éšç€ä¸šåŠ¡çš„é€æ¸æ‰©å±•ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡ç³»ç»Ÿä¹Ÿä¼šæ…¢æ…¢å˜å¾—åºå¤§ã€‚\næ‹¿å€Ÿè´·ç³»ç»Ÿæ¥è¯´ï¼Œä»é‡‘èå€Ÿè´·äº§å“çš„ä¸Šæ¶ï¼Œå•†æˆ·çš„ç”³è¯·ã€å®¡æ ¸ï¼Œè´·æ¬¾çš„è¿›ä»¶ã€KYCã€æ”¾è´·ï¼Œå†åˆ°ç”¨æˆ·çš„è¿˜æ¬¾ç”šè‡³å‚¬æ”¶ã€‚\nè€Œä¸šåŠ¡å¾€å¾€ä¸ºäº†å¿«é€Ÿè½åœ°ï¼Œæˆ‘ä»¬ä¼šå°†æ‰€æœ‰ä¸šåŠ¡èå…¥åˆ°ä¸€ä¸ªæœåŠ¡ä¸­ï¼Œå¿«é€Ÿå¼€å‘ã€å¿«é€Ÿä¸Šçº¿ã€‚\nå¥½å¤„è‡ªç„¶æ˜¯å…¬å¸ä¸šåŠ¡è¹­è¹­å¾€ä¸Šèµ°ï¼Œä¸šåŠ¡æå‡ºçš„éœ€æ±‚ä¹Ÿèƒ½å¿«é€Ÿè½åœ°å¹¶æŠ•æ”¾è‡³å¸‚åœºï¼Œä½†é•¿æ­¤ä»¥å¾€å¼€å‘æµ‹è¯•äººå‘˜ä¼šå˜å¾—ç–²æƒ«ä¸å ªã€‚\nè¿™é‡Œæˆ‘ä»¬å°±è¦èŠåˆ°æœåŠ¡çš„æ‹†åˆ†ï¼Œç”±äºè¿™æ¬¡ä¸»è¦è®²çš„æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæˆ‘ä»¬ä¸‹æ¬¡æœ‰æ—¶é—´å†æ¥è®¨è®ºè®¨è®ºå¾®æœåŠ¡çš„æ‹†åˆ†å’Œç°åœ¨å¤§çƒ­é—¨çš„DDDé¢†åŸŸæ¨¡å‹ã€‚\n\n## æœåŠ¡æ‹†åˆ†åã€‚ã€‚ã€‚\nåœ¨äº’è”ç½‘å…¬å¸å·¥ä½œçš„è¯ï¼Œå¤§å®¶åº”è¯¥éƒ½ç»å†è¿‡ä¸€ä¸ªå¤§ç³»ç»Ÿï¼Œç»è¿‡ä¸åœçš„è¿­ä»£ï¼Œæœ€åæ‹†æˆæ•°ä¸ªå¾®æœåŠ¡çš„è¿‡ç¨‹ã€‚\nå…¶ä¸­çš„å¥½å¤„è‡ªç„¶ä¸ç”¨è¯´ï¼Œç³»ç»Ÿè§£è€¦ã€ä¸šåŠ¡è§£è€¦ã€å¿«é€Ÿå‘ç‰ˆã€æ›´å°‘çš„ç»´æŠ¤ç­‰ç­‰ç­‰ç­‰ã€‚\nä½†æ˜¯ä¸€æ—¦æ‹†å‡ºå¤šä¸ªå¾®æœåŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿä¼šé‡åˆ°ä¸€ä¸ªæ£˜æ‰‹é—®é¢˜ã€‚\n<!-- more -->\n## ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æœ‰åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿè¿™ä¸ªé—®é¢˜å‡¸æ˜¾äº†å‡ºæ¥\nå‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªä¸šåŠ¡ï¼šå®¢æˆ·ç”³è¯·äº†ä¸€ä¸ªè´·æ¬¾ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åšçš„æ˜¯\n1. æ”¶é›†ç”¨æˆ·ä¿¡æ¯\n2. å®¡æ ¸ç”¨æˆ·ä¿¡æ¯\n3. åˆ›å»ºè´·æ¬¾è®¢å•åŠåˆ†æœŸè®¢å•ç­‰\n4. é€‰å–æŠ•èµ„äºº\n5. æ”¾æ¬¾\n   \nå…¶ä¸­æ”¶é›†ç”¨æˆ·ä¿¡æ¯å’Œå®¡æ ¸ç”¨æˆ·ä¿¡æ¯å¹¶ä¸æ˜¯ä¸€ä¸ªå®æ—¶æ“ä½œï¼Œæˆ‘ä»¬å¯èƒ½ä¼šäº¤ç”±æ¶ˆæ¯å»å¼‚æ­¥å¤„ç†ã€‚\nä½†æ˜¯ç¬¬ä¸‰ã€å››ã€äº”æ­¥æ˜¯å®¡æ ¸é€šè¿‡åä¸€ä¸€æ‰§è¡Œçš„ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥äº¤ç”±æ¶ˆæ¯å¼‚æ­¥å¤„ç†ï¼Œä½†æ˜¯è¯•æƒ³ä¸€ä¸ªåœºæ™¯ã€‚ç”¨æˆ·å†åˆ†æœŸè´­ä¹°äº§å“çš„æ—¶å€™è™½ç„¶å¯¹ç”¨æˆ·åªæ˜¯ä¸€æ¬¡äº¤æ˜“æ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬åå°å¯èƒ½å·²ç»æŠŠè¿™ç¬”äº¤æ˜“ä½œä¸ºä¸€ç¬”åˆ†æœŸå€Ÿæ¬¾è¿›è¡Œäº†è½æ¬¾ã€‚ä½†æ˜¯å®¢æˆ·ä¸çŸ¥é“ï¼Œä¸æ˜¯è¯´å¼‚æ­¥å¤„ç†ä¸å¥½ï¼Œä½†å¦‚æœèƒ½å®æ—¶çš„å‘Šè¯‰ç”¨æˆ·æ”¯ä»˜ç»“æœï¼Œæ˜¯ä¸æ˜¯èƒ½æé«˜ç”¨æˆ·ä½“éªŒå’Œè½¬æ¢ç‡å‘¢ã€‚\nå›å¤´çœ‹ä¸‹æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œå·²ç»è¢«æ‹†æˆè®¢å•æœåŠ¡ã€ç”¨æˆ·ä½“ç³»æœåŠ¡ã€æ”¾æ¬¾æœåŠ¡äº†ï¼Œéšä¹‹å¸¦æ¥çš„æ˜¯æ¯ä¸ªå¾®æœåŠ¡æœ‰è‡ªå·±å¯¹åº”çš„æ•°æ®åº“ï¼Œåˆ†åˆ«ä¿å­˜çš„æ˜¯è®¢å•ä¿¡æ¯ã€æŠ•èµ„äºº|å€Ÿæ¬¾äººä¿¡æ¯ã€æ”¾æ¬¾ä¿¡æ¯ã€‚\nä¸€ä¸åšäºŒä¸ä¼‘ï¼Œæˆ‘ä»¬æŠŠä»¥å‰åŒä¸€ä¸ªæœåŠ¡å†…çš„æ–¹æ³•è°ƒç”¨æ”¹æˆä¸åŒæœåŠ¡ä¹‹é—´çš„å¼‚æ­¥è°ƒç”¨ï¼Œä½†éšä¹‹è€Œæ¥çš„æ˜¯ç”Ÿäº§ä¸Šä¸æ—¶ä¼šå‡ºç°æ¼æ•°æ®æˆ–è®¢å•æ— æ³•æ­£å¸¸å®Œæˆçš„é—®é¢˜ã€‚\nèªæ˜çš„å°ä¼™ä¼´åº”è¯¥æ—©å°±å‘ç°äº†ï¼Œä¸ºäº†ä¿è¯åˆ†å¸ƒå¼æœåŠ¡é—´è°ƒç”¨çš„äº‹åŠ¡æ€§ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å°±å­•è‚²è€Œç”Ÿäº†ã€‚\n\n\n## ä¸¤é˜¶æ®µæäº¤/XA\n\nå¸¸è§äºå•ç³»ç»Ÿæ“ä½œå¤šæ•°æ®æºã€‚\nç”±äºä¾èµ–æ•°æ®åº“çš„äº‹åŠ¡ï¼Œå¯¼è‡´æ•ˆç‡ä½ï¼Œä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚\n\n### äº‹åŠ¡ç®¡ç†å™¨\n\n### æµç¨‹\n\n- ç¬¬ä¸€é˜¶æ®µ\n\n\t- å‘èµ·äº‹åŠ¡\n\t- å–æ¶ˆäº‹åŠ¡\n\n- ç¬¬äºŒé˜¶æ®µ\n\n\t- é€šçŸ¥æ‰§è¡Œæ¯ä¸€ä¸ªä»»åŠ¡\n\n## TCC\n\né€‚åˆå¯¹åˆ†å¸ƒå¼ä¸€è‡´æ€§è¦æ±‚è¦çš„ç³»ç»Ÿï¼Œå¦‚æ”¯ä»˜ã€äº¤æ˜“ç­‰\n\n### æµç¨‹\n\n- Try\n\n  å¯¹å„ä¸ªæœåŠ¡çš„èµ„æºè¿›è¡Œæ£€æŸ¥ï¼Œä¸šåŠ¡æ ¡éªŒç­‰ã€‚\n\n- Confirm\n\n  è¿›è¡Œå®é™…çš„æ“ä½œ\n\n- Cancel\n\n  é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå¯¹ä¹‹å‰çš„æ“ä½œè¿›è¡Œå›æ»š\n\n### é—®é¢˜\n\nä¸šåŠ¡è€¦åˆæ¯”è¾ƒå¤§ï¼Œéœ€è¦å¤§é‡çš„ä¸šåŠ¡ä»£ç æ”¯æŒ\n\n## æœ¬åœ°æ¶ˆæ¯è¡¨\n\nå¯ä»¥ä¿è¯äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œä½†ä¸é€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯\n\n### æµç¨‹\n\n- Aç³»ç»Ÿä¸šåŠ¡æ“ä½œåè½æ¶ˆæ¯è¡¨å¹¶MQé€šçŸ¥Bç³»ç»Ÿ\n- Bç³»ç»Ÿæ¥æ”¶æ¶ˆæ¯åæ‰§è¡Œä¸šåŠ¡æ“ä½œï¼Œå¹¶æ›´æ–°Aã€Bä¿¡æ¯æ¶ˆæ¯çŠ¶æ€\n- Bç³»ç»ŸæœªæˆåŠŸæ—¶ï¼ŒAç³»ç»Ÿä¼šä¸€ç›´é‡è¯•åˆ°æˆåŠŸ\n\n## å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§\n\nä¾èµ–RMQçš„æ¶ˆæ¯äº‹åŠ¡ï¼Œå’Œé«˜å¯ç”¨ï¼Œä¿è¯æ¶ˆæ¯ä¸€å®šé€šçŸ¥åˆ°ï¼Œå¹¶æœ€ç»ˆä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§\n\n### æµç¨‹\n\n- Aç³»ç»Ÿå‘é€prepareæ¶ˆæ¯è‡³MQï¼Œå¹¶å¤„ç†ä¸šåŠ¡\n- Aç³»ç»Ÿå¤„ç†ä¸šåŠ¡æˆåŠŸåå‘é€Confirmæ¶ˆæ¯è‡³MQ\n- Bç³»ç»Ÿæ”¶åˆ°Confirmæ¶ˆæ¯åæ‰§è¡Œä¸šåŠ¡\n\n## æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ\n\nå¯ä»¥å…è®¸ä¸€å®šç¨‹åº¦ä¸Šçš„äº‹åŠ¡å¤±è´¥ï¼Œä¸€èˆ¬ç”¨åœ¨å¯¹åˆ†å¸ƒå¼äº‹åŠ¡ä¸è¦ä¸ªçš„ç³»ç»Ÿï¼Œæ¯”å¦‚æ—¥å¿—æ”¶é›†ç­‰\n\n### Aç³»ç»Ÿå‘é€æ¶ˆæ¯è‡³MQ\n\n### æœ€å¤§åŠªåŠ›ç³»ç»Ÿæ¥æ”¶MQé€šçŸ¥å¹¶è°ƒç”¨Bç³»ç»Ÿ\n\n*XMind: ZEN - Trial Version*","source":"_posts/åˆ†å¸ƒå¼äº‹åŠ¡æ•´ç†.md","raw":"---\ntitle: åˆ†å¸ƒå¼äº‹åŠ¡å…¶å®å¾ˆç®€å•\ndate: 2020-03-01 20:54:06\ntags: \n    - Java\ncategories :\n    - Technology\n---\n\n# ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æœ‰åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ\n\n## å…ˆèŠèŠæˆ‘ä»¬çš„é¡¹ç›®å¼€å‘\nå·¥ä½œä¸­éšç€ä¸šåŠ¡çš„é€æ¸æ‰©å±•ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡ç³»ç»Ÿä¹Ÿä¼šæ…¢æ…¢å˜å¾—åºå¤§ã€‚\næ‹¿å€Ÿè´·ç³»ç»Ÿæ¥è¯´ï¼Œä»é‡‘èå€Ÿè´·äº§å“çš„ä¸Šæ¶ï¼Œå•†æˆ·çš„ç”³è¯·ã€å®¡æ ¸ï¼Œè´·æ¬¾çš„è¿›ä»¶ã€KYCã€æ”¾è´·ï¼Œå†åˆ°ç”¨æˆ·çš„è¿˜æ¬¾ç”šè‡³å‚¬æ”¶ã€‚\nè€Œä¸šåŠ¡å¾€å¾€ä¸ºäº†å¿«é€Ÿè½åœ°ï¼Œæˆ‘ä»¬ä¼šå°†æ‰€æœ‰ä¸šåŠ¡èå…¥åˆ°ä¸€ä¸ªæœåŠ¡ä¸­ï¼Œå¿«é€Ÿå¼€å‘ã€å¿«é€Ÿä¸Šçº¿ã€‚\nå¥½å¤„è‡ªç„¶æ˜¯å…¬å¸ä¸šåŠ¡è¹­è¹­å¾€ä¸Šèµ°ï¼Œä¸šåŠ¡æå‡ºçš„éœ€æ±‚ä¹Ÿèƒ½å¿«é€Ÿè½åœ°å¹¶æŠ•æ”¾è‡³å¸‚åœºï¼Œä½†é•¿æ­¤ä»¥å¾€å¼€å‘æµ‹è¯•äººå‘˜ä¼šå˜å¾—ç–²æƒ«ä¸å ªã€‚\nè¿™é‡Œæˆ‘ä»¬å°±è¦èŠåˆ°æœåŠ¡çš„æ‹†åˆ†ï¼Œç”±äºè¿™æ¬¡ä¸»è¦è®²çš„æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæˆ‘ä»¬ä¸‹æ¬¡æœ‰æ—¶é—´å†æ¥è®¨è®ºè®¨è®ºå¾®æœåŠ¡çš„æ‹†åˆ†å’Œç°åœ¨å¤§çƒ­é—¨çš„DDDé¢†åŸŸæ¨¡å‹ã€‚\n\n## æœåŠ¡æ‹†åˆ†åã€‚ã€‚ã€‚\nåœ¨äº’è”ç½‘å…¬å¸å·¥ä½œçš„è¯ï¼Œå¤§å®¶åº”è¯¥éƒ½ç»å†è¿‡ä¸€ä¸ªå¤§ç³»ç»Ÿï¼Œç»è¿‡ä¸åœçš„è¿­ä»£ï¼Œæœ€åæ‹†æˆæ•°ä¸ªå¾®æœåŠ¡çš„è¿‡ç¨‹ã€‚\nå…¶ä¸­çš„å¥½å¤„è‡ªç„¶ä¸ç”¨è¯´ï¼Œç³»ç»Ÿè§£è€¦ã€ä¸šåŠ¡è§£è€¦ã€å¿«é€Ÿå‘ç‰ˆã€æ›´å°‘çš„ç»´æŠ¤ç­‰ç­‰ç­‰ç­‰ã€‚\nä½†æ˜¯ä¸€æ—¦æ‹†å‡ºå¤šä¸ªå¾®æœåŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿä¼šé‡åˆ°ä¸€ä¸ªæ£˜æ‰‹é—®é¢˜ã€‚\n<!-- more -->\n## ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æœ‰åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿè¿™ä¸ªé—®é¢˜å‡¸æ˜¾äº†å‡ºæ¥\nå‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªä¸šåŠ¡ï¼šå®¢æˆ·ç”³è¯·äº†ä¸€ä¸ªè´·æ¬¾ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åšçš„æ˜¯\n1. æ”¶é›†ç”¨æˆ·ä¿¡æ¯\n2. å®¡æ ¸ç”¨æˆ·ä¿¡æ¯\n3. åˆ›å»ºè´·æ¬¾è®¢å•åŠåˆ†æœŸè®¢å•ç­‰\n4. é€‰å–æŠ•èµ„äºº\n5. æ”¾æ¬¾\n   \nå…¶ä¸­æ”¶é›†ç”¨æˆ·ä¿¡æ¯å’Œå®¡æ ¸ç”¨æˆ·ä¿¡æ¯å¹¶ä¸æ˜¯ä¸€ä¸ªå®æ—¶æ“ä½œï¼Œæˆ‘ä»¬å¯èƒ½ä¼šäº¤ç”±æ¶ˆæ¯å»å¼‚æ­¥å¤„ç†ã€‚\nä½†æ˜¯ç¬¬ä¸‰ã€å››ã€äº”æ­¥æ˜¯å®¡æ ¸é€šè¿‡åä¸€ä¸€æ‰§è¡Œçš„ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥äº¤ç”±æ¶ˆæ¯å¼‚æ­¥å¤„ç†ï¼Œä½†æ˜¯è¯•æƒ³ä¸€ä¸ªåœºæ™¯ã€‚ç”¨æˆ·å†åˆ†æœŸè´­ä¹°äº§å“çš„æ—¶å€™è™½ç„¶å¯¹ç”¨æˆ·åªæ˜¯ä¸€æ¬¡äº¤æ˜“æ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬åå°å¯èƒ½å·²ç»æŠŠè¿™ç¬”äº¤æ˜“ä½œä¸ºä¸€ç¬”åˆ†æœŸå€Ÿæ¬¾è¿›è¡Œäº†è½æ¬¾ã€‚ä½†æ˜¯å®¢æˆ·ä¸çŸ¥é“ï¼Œä¸æ˜¯è¯´å¼‚æ­¥å¤„ç†ä¸å¥½ï¼Œä½†å¦‚æœèƒ½å®æ—¶çš„å‘Šè¯‰ç”¨æˆ·æ”¯ä»˜ç»“æœï¼Œæ˜¯ä¸æ˜¯èƒ½æé«˜ç”¨æˆ·ä½“éªŒå’Œè½¬æ¢ç‡å‘¢ã€‚\nå›å¤´çœ‹ä¸‹æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œå·²ç»è¢«æ‹†æˆè®¢å•æœåŠ¡ã€ç”¨æˆ·ä½“ç³»æœåŠ¡ã€æ”¾æ¬¾æœåŠ¡äº†ï¼Œéšä¹‹å¸¦æ¥çš„æ˜¯æ¯ä¸ªå¾®æœåŠ¡æœ‰è‡ªå·±å¯¹åº”çš„æ•°æ®åº“ï¼Œåˆ†åˆ«ä¿å­˜çš„æ˜¯è®¢å•ä¿¡æ¯ã€æŠ•èµ„äºº|å€Ÿæ¬¾äººä¿¡æ¯ã€æ”¾æ¬¾ä¿¡æ¯ã€‚\nä¸€ä¸åšäºŒä¸ä¼‘ï¼Œæˆ‘ä»¬æŠŠä»¥å‰åŒä¸€ä¸ªæœåŠ¡å†…çš„æ–¹æ³•è°ƒç”¨æ”¹æˆä¸åŒæœåŠ¡ä¹‹é—´çš„å¼‚æ­¥è°ƒç”¨ï¼Œä½†éšä¹‹è€Œæ¥çš„æ˜¯ç”Ÿäº§ä¸Šä¸æ—¶ä¼šå‡ºç°æ¼æ•°æ®æˆ–è®¢å•æ— æ³•æ­£å¸¸å®Œæˆçš„é—®é¢˜ã€‚\nèªæ˜çš„å°ä¼™ä¼´åº”è¯¥æ—©å°±å‘ç°äº†ï¼Œä¸ºäº†ä¿è¯åˆ†å¸ƒå¼æœåŠ¡é—´è°ƒç”¨çš„äº‹åŠ¡æ€§ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å°±å­•è‚²è€Œç”Ÿäº†ã€‚\n\n\n## ä¸¤é˜¶æ®µæäº¤/XA\n\nå¸¸è§äºå•ç³»ç»Ÿæ“ä½œå¤šæ•°æ®æºã€‚\nç”±äºä¾èµ–æ•°æ®åº“çš„äº‹åŠ¡ï¼Œå¯¼è‡´æ•ˆç‡ä½ï¼Œä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚\n\n### äº‹åŠ¡ç®¡ç†å™¨\n\n### æµç¨‹\n\n- ç¬¬ä¸€é˜¶æ®µ\n\n\t- å‘èµ·äº‹åŠ¡\n\t- å–æ¶ˆäº‹åŠ¡\n\n- ç¬¬äºŒé˜¶æ®µ\n\n\t- é€šçŸ¥æ‰§è¡Œæ¯ä¸€ä¸ªä»»åŠ¡\n\n## TCC\n\né€‚åˆå¯¹åˆ†å¸ƒå¼ä¸€è‡´æ€§è¦æ±‚è¦çš„ç³»ç»Ÿï¼Œå¦‚æ”¯ä»˜ã€äº¤æ˜“ç­‰\n\n### æµç¨‹\n\n- Try\n\n  å¯¹å„ä¸ªæœåŠ¡çš„èµ„æºè¿›è¡Œæ£€æŸ¥ï¼Œä¸šåŠ¡æ ¡éªŒç­‰ã€‚\n\n- Confirm\n\n  è¿›è¡Œå®é™…çš„æ“ä½œ\n\n- Cancel\n\n  é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå¯¹ä¹‹å‰çš„æ“ä½œè¿›è¡Œå›æ»š\n\n### é—®é¢˜\n\nä¸šåŠ¡è€¦åˆæ¯”è¾ƒå¤§ï¼Œéœ€è¦å¤§é‡çš„ä¸šåŠ¡ä»£ç æ”¯æŒ\n\n## æœ¬åœ°æ¶ˆæ¯è¡¨\n\nå¯ä»¥ä¿è¯äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œä½†ä¸é€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯\n\n### æµç¨‹\n\n- Aç³»ç»Ÿä¸šåŠ¡æ“ä½œåè½æ¶ˆæ¯è¡¨å¹¶MQé€šçŸ¥Bç³»ç»Ÿ\n- Bç³»ç»Ÿæ¥æ”¶æ¶ˆæ¯åæ‰§è¡Œä¸šåŠ¡æ“ä½œï¼Œå¹¶æ›´æ–°Aã€Bä¿¡æ¯æ¶ˆæ¯çŠ¶æ€\n- Bç³»ç»ŸæœªæˆåŠŸæ—¶ï¼ŒAç³»ç»Ÿä¼šä¸€ç›´é‡è¯•åˆ°æˆåŠŸ\n\n## å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§\n\nä¾èµ–RMQçš„æ¶ˆæ¯äº‹åŠ¡ï¼Œå’Œé«˜å¯ç”¨ï¼Œä¿è¯æ¶ˆæ¯ä¸€å®šé€šçŸ¥åˆ°ï¼Œå¹¶æœ€ç»ˆä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§\n\n### æµç¨‹\n\n- Aç³»ç»Ÿå‘é€prepareæ¶ˆæ¯è‡³MQï¼Œå¹¶å¤„ç†ä¸šåŠ¡\n- Aç³»ç»Ÿå¤„ç†ä¸šåŠ¡æˆåŠŸåå‘é€Confirmæ¶ˆæ¯è‡³MQ\n- Bç³»ç»Ÿæ”¶åˆ°Confirmæ¶ˆæ¯åæ‰§è¡Œä¸šåŠ¡\n\n## æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ\n\nå¯ä»¥å…è®¸ä¸€å®šç¨‹åº¦ä¸Šçš„äº‹åŠ¡å¤±è´¥ï¼Œä¸€èˆ¬ç”¨åœ¨å¯¹åˆ†å¸ƒå¼äº‹åŠ¡ä¸è¦ä¸ªçš„ç³»ç»Ÿï¼Œæ¯”å¦‚æ—¥å¿—æ”¶é›†ç­‰\n\n### Aç³»ç»Ÿå‘é€æ¶ˆæ¯è‡³MQ\n\n### æœ€å¤§åŠªåŠ›ç³»ç»Ÿæ¥æ”¶MQé€šçŸ¥å¹¶è°ƒç”¨Bç³»ç»Ÿ\n\n*XMind: ZEN - Trial Version*","slug":"åˆ†å¸ƒå¼äº‹åŠ¡æ•´ç†","published":1,"updated":"2020-12-14T09:51:24.018Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htd000ov2529oao6um7","content":"<html><head></head><body><h1 id=\"&#x4EC0;&#x4E48;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;\"></a>&#x4EC0;&#x4E48;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;</h1><h2 id=\"&#x5148;&#x804A;&#x804A;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x5F00;&#x53D1;\"><a href=\"#&#x5148;&#x804A;&#x804A;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x5F00;&#x53D1;\" class=\"headerlink\" title=\"&#x5148;&#x804A;&#x804A;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x5F00;&#x53D1;\"></a>&#x5148;&#x804A;&#x804A;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x5F00;&#x53D1;</h2><p>&#x5DE5;&#x4F5C;&#x4E2D;&#x968F;&#x7740;&#x4E1A;&#x52A1;&#x7684;&#x9010;&#x6E10;&#x6269;&#x5C55;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x4E1A;&#x52A1;&#x7CFB;&#x7EDF;&#x4E5F;&#x4F1A;&#x6162;&#x6162;&#x53D8;&#x5F97;&#x5E9E;&#x5927;&#x3002;<br>&#x62FF;&#x501F;&#x8D37;&#x7CFB;&#x7EDF;&#x6765;&#x8BF4;&#xFF0C;&#x4ECE;&#x91D1;&#x878D;&#x501F;&#x8D37;&#x4EA7;&#x54C1;&#x7684;&#x4E0A;&#x67B6;&#xFF0C;&#x5546;&#x6237;&#x7684;&#x7533;&#x8BF7;&#x3001;&#x5BA1;&#x6838;&#xFF0C;&#x8D37;&#x6B3E;&#x7684;&#x8FDB;&#x4EF6;&#x3001;KYC&#x3001;&#x653E;&#x8D37;&#xFF0C;&#x518D;&#x5230;&#x7528;&#x6237;&#x7684;&#x8FD8;&#x6B3E;&#x751A;&#x81F3;&#x50AC;&#x6536;&#x3002;<br>&#x800C;&#x4E1A;&#x52A1;&#x5F80;&#x5F80;&#x4E3A;&#x4E86;&#x5FEB;&#x901F;&#x843D;&#x5730;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5C06;&#x6240;&#x6709;&#x4E1A;&#x52A1;&#x878D;&#x5165;&#x5230;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x4E2D;&#xFF0C;&#x5FEB;&#x901F;&#x5F00;&#x53D1;&#x3001;&#x5FEB;&#x901F;&#x4E0A;&#x7EBF;&#x3002;<br>&#x597D;&#x5904;&#x81EA;&#x7136;&#x662F;&#x516C;&#x53F8;&#x4E1A;&#x52A1;&#x8E6D;&#x8E6D;&#x5F80;&#x4E0A;&#x8D70;&#xFF0C;&#x4E1A;&#x52A1;&#x63D0;&#x51FA;&#x7684;&#x9700;&#x6C42;&#x4E5F;&#x80FD;&#x5FEB;&#x901F;&#x843D;&#x5730;&#x5E76;&#x6295;&#x653E;&#x81F3;&#x5E02;&#x573A;&#xFF0C;&#x4F46;&#x957F;&#x6B64;&#x4EE5;&#x5F80;&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x4EBA;&#x5458;&#x4F1A;&#x53D8;&#x5F97;&#x75B2;&#x60EB;&#x4E0D;&#x582A;&#x3002;<br>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x804A;&#x5230;&#x670D;&#x52A1;&#x7684;&#x62C6;&#x5206;&#xFF0C;&#x7531;&#x4E8E;&#x8FD9;&#x6B21;&#x4E3B;&#x8981;&#x8BB2;&#x7684;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF0C;&#x6211;&#x4EEC;&#x4E0B;&#x6B21;&#x6709;&#x65F6;&#x95F4;&#x518D;&#x6765;&#x8BA8;&#x8BBA;&#x8BA8;&#x8BBA;&#x5FAE;&#x670D;&#x52A1;&#x7684;&#x62C6;&#x5206;&#x548C;&#x73B0;&#x5728;&#x5927;&#x70ED;&#x95E8;&#x7684;DDD&#x9886;&#x57DF;&#x6A21;&#x578B;&#x3002;</p>\n<h2 id=\"&#x670D;&#x52A1;&#x62C6;&#x5206;&#x540E;&#x3002;&#x3002;&#x3002;\"><a href=\"#&#x670D;&#x52A1;&#x62C6;&#x5206;&#x540E;&#x3002;&#x3002;&#x3002;\" class=\"headerlink\" title=\"&#x670D;&#x52A1;&#x62C6;&#x5206;&#x540E;&#x3002;&#x3002;&#x3002;\"></a>&#x670D;&#x52A1;&#x62C6;&#x5206;&#x540E;&#x3002;&#x3002;&#x3002;</h2><p>&#x5728;&#x4E92;&#x8054;&#x7F51;&#x516C;&#x53F8;&#x5DE5;&#x4F5C;&#x7684;&#x8BDD;&#xFF0C;&#x5927;&#x5BB6;&#x5E94;&#x8BE5;&#x90FD;&#x7ECF;&#x5386;&#x8FC7;&#x4E00;&#x4E2A;&#x5927;&#x7CFB;&#x7EDF;&#xFF0C;&#x7ECF;&#x8FC7;&#x4E0D;&#x505C;&#x7684;&#x8FED;&#x4EE3;&#xFF0C;&#x6700;&#x540E;&#x62C6;&#x6210;&#x6570;&#x4E2A;&#x5FAE;&#x670D;&#x52A1;&#x7684;&#x8FC7;&#x7A0B;&#x3002;<br>&#x5176;&#x4E2D;&#x7684;&#x597D;&#x5904;&#x81EA;&#x7136;&#x4E0D;&#x7528;&#x8BF4;&#xFF0C;&#x7CFB;&#x7EDF;&#x89E3;&#x8026;&#x3001;&#x4E1A;&#x52A1;&#x89E3;&#x8026;&#x3001;&#x5FEB;&#x901F;&#x53D1;&#x7248;&#x3001;&#x66F4;&#x5C11;&#x7684;&#x7EF4;&#x62A4;&#x7B49;&#x7B49;&#x7B49;&#x7B49;&#x3002;<br>&#x4F46;&#x662F;&#x4E00;&#x65E6;&#x62C6;&#x51FA;&#x591A;&#x4E2A;&#x5FAE;&#x670D;&#x52A1;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x4F1A;&#x9047;&#x5230;&#x4E00;&#x4E2A;&#x68D8;&#x624B;&#x95EE;&#x9898;&#x3002;</p>\n<a id=\"more\"></a>\n<h2 id=\"&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x51F8;&#x663E;&#x4E86;&#x51FA;&#x6765;\"><a href=\"#&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x51F8;&#x663E;&#x4E86;&#x51FA;&#x6765;\" class=\"headerlink\" title=\"&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x51F8;&#x663E;&#x4E86;&#x51FA;&#x6765;\"></a>&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x51F8;&#x663E;&#x4E86;&#x51FA;&#x6765;</h2><p>&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6709;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x4E1A;&#x52A1;&#xFF1A;&#x5BA2;&#x6237;&#x7533;&#x8BF7;&#x4E86;&#x4E00;&#x4E2A;&#x8D37;&#x6B3E;&#xFF0C;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x7684;&#x662F;</p>\n<ol>\n<li>&#x6536;&#x96C6;&#x7528;&#x6237;&#x4FE1;&#x606F;</li>\n<li>&#x5BA1;&#x6838;&#x7528;&#x6237;&#x4FE1;&#x606F;</li>\n<li>&#x521B;&#x5EFA;&#x8D37;&#x6B3E;&#x8BA2;&#x5355;&#x53CA;&#x5206;&#x671F;&#x8BA2;&#x5355;&#x7B49;</li>\n<li>&#x9009;&#x53D6;&#x6295;&#x8D44;&#x4EBA;</li>\n<li>&#x653E;&#x6B3E;</li>\n</ol>\n<p>&#x5176;&#x4E2D;&#x6536;&#x96C6;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x548C;&#x5BA1;&#x6838;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5B9E;&#x65F6;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x80FD;&#x4F1A;&#x4EA4;&#x7531;&#x6D88;&#x606F;&#x53BB;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x3002;<br>&#x4F46;&#x662F;&#x7B2C;&#x4E09;&#x3001;&#x56DB;&#x3001;&#x4E94;&#x6B65;&#x662F;&#x5BA1;&#x6838;&#x901A;&#x8FC7;&#x540E;&#x4E00;&#x4E00;&#x6267;&#x884C;&#x7684;&#xFF0C;&#x5F53;&#x7136;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x4EA4;&#x7531;&#x6D88;&#x606F;&#x5F02;&#x6B65;&#x5904;&#x7406;&#xFF0C;&#x4F46;&#x662F;&#x8BD5;&#x60F3;&#x4E00;&#x4E2A;&#x573A;&#x666F;&#x3002;&#x7528;&#x6237;&#x518D;&#x5206;&#x671F;&#x8D2D;&#x4E70;&#x4EA7;&#x54C1;&#x7684;&#x65F6;&#x5019;&#x867D;&#x7136;&#x5BF9;&#x7528;&#x6237;&#x53EA;&#x662F;&#x4E00;&#x6B21;&#x4EA4;&#x6613;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x540E;&#x53F0;&#x53EF;&#x80FD;&#x5DF2;&#x7ECF;&#x628A;&#x8FD9;&#x7B14;&#x4EA4;&#x6613;&#x4F5C;&#x4E3A;&#x4E00;&#x7B14;&#x5206;&#x671F;&#x501F;&#x6B3E;&#x8FDB;&#x884C;&#x4E86;&#x843D;&#x6B3E;&#x3002;&#x4F46;&#x662F;&#x5BA2;&#x6237;&#x4E0D;&#x77E5;&#x9053;&#xFF0C;&#x4E0D;&#x662F;&#x8BF4;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x4E0D;&#x597D;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x80FD;&#x5B9E;&#x65F6;&#x7684;&#x544A;&#x8BC9;&#x7528;&#x6237;&#x652F;&#x4ED8;&#x7ED3;&#x679C;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x80FD;&#x63D0;&#x9AD8;&#x7528;&#x6237;&#x4F53;&#x9A8C;&#x548C;&#x8F6C;&#x6362;&#x7387;&#x5462;&#x3002;<br>&#x56DE;&#x5934;&#x770B;&#x4E0B;&#x6211;&#x4EEC;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x5DF2;&#x7ECF;&#x88AB;&#x62C6;&#x6210;&#x8BA2;&#x5355;&#x670D;&#x52A1;&#x3001;&#x7528;&#x6237;&#x4F53;&#x7CFB;&#x670D;&#x52A1;&#x3001;&#x653E;&#x6B3E;&#x670D;&#x52A1;&#x4E86;&#xFF0C;&#x968F;&#x4E4B;&#x5E26;&#x6765;&#x7684;&#x662F;&#x6BCF;&#x4E2A;&#x5FAE;&#x670D;&#x52A1;&#x6709;&#x81EA;&#x5DF1;&#x5BF9;&#x5E94;&#x7684;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5206;&#x522B;&#x4FDD;&#x5B58;&#x7684;&#x662F;&#x8BA2;&#x5355;&#x4FE1;&#x606F;&#x3001;&#x6295;&#x8D44;&#x4EBA;|&#x501F;&#x6B3E;&#x4EBA;&#x4FE1;&#x606F;&#x3001;&#x653E;&#x6B3E;&#x4FE1;&#x606F;&#x3002;<br>&#x4E00;&#x4E0D;&#x505A;&#x4E8C;&#x4E0D;&#x4F11;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x4EE5;&#x524D;&#x540C;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x5185;&#x7684;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x6539;&#x6210;&#x4E0D;&#x540C;&#x670D;&#x52A1;&#x4E4B;&#x95F4;&#x7684;&#x5F02;&#x6B65;&#x8C03;&#x7528;&#xFF0C;&#x4F46;&#x968F;&#x4E4B;&#x800C;&#x6765;&#x7684;&#x662F;&#x751F;&#x4EA7;&#x4E0A;&#x4E0D;&#x65F6;&#x4F1A;&#x51FA;&#x73B0;&#x6F0F;&#x6570;&#x636E;&#x6216;&#x8BA2;&#x5355;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x5B8C;&#x6210;&#x7684;&#x95EE;&#x9898;&#x3002;<br>&#x806A;&#x660E;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x5E94;&#x8BE5;&#x65E9;&#x5C31;&#x53D1;&#x73B0;&#x4E86;&#xFF0C;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x5206;&#x5E03;&#x5F0F;&#x670D;&#x52A1;&#x95F4;&#x8C03;&#x7528;&#x7684;&#x4E8B;&#x52A1;&#x6027;&#xFF0C;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#x5C31;&#x5B55;&#x80B2;&#x800C;&#x751F;&#x4E86;&#x3002;</p>\n<h2 id=\"&#x4E24;&#x9636;&#x6BB5;&#x63D0;&#x4EA4;-XA\"><a href=\"#&#x4E24;&#x9636;&#x6BB5;&#x63D0;&#x4EA4;-XA\" class=\"headerlink\" title=\"&#x4E24;&#x9636;&#x6BB5;&#x63D0;&#x4EA4;/XA\"></a>&#x4E24;&#x9636;&#x6BB5;&#x63D0;&#x4EA4;/XA</h2><p>&#x5E38;&#x89C1;&#x4E8E;&#x5355;&#x7CFB;&#x7EDF;&#x64CD;&#x4F5C;&#x591A;&#x6570;&#x636E;&#x6E90;&#x3002;<br>&#x7531;&#x4E8E;&#x4F9D;&#x8D56;&#x6570;&#x636E;&#x5E93;&#x7684;&#x4E8B;&#x52A1;&#xFF0C;&#x5BFC;&#x81F4;&#x6548;&#x7387;&#x4F4E;&#xFF0C;&#x4E0D;&#x9002;&#x5408;&#x9AD8;&#x5E76;&#x53D1;&#x573A;&#x666F;&#x3002;</p>\n<h3 id=\"&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x5668;\"><a href=\"#&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x5668;\" class=\"headerlink\" title=\"&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x5668;\"></a>&#x4E8B;&#x52A1;&#x7BA1;&#x7406;&#x5668;</h3><h3 id=\"&#x6D41;&#x7A0B;\"><a href=\"#&#x6D41;&#x7A0B;\" class=\"headerlink\" title=\"&#x6D41;&#x7A0B;\"></a>&#x6D41;&#x7A0B;</h3><ul>\n<li><p>&#x7B2C;&#x4E00;&#x9636;&#x6BB5;</p>\n<ul>\n<li>&#x53D1;&#x8D77;&#x4E8B;&#x52A1;</li>\n<li>&#x53D6;&#x6D88;&#x4E8B;&#x52A1;</li>\n</ul>\n</li>\n<li><p>&#x7B2C;&#x4E8C;&#x9636;&#x6BB5;</p>\n<ul>\n<li>&#x901A;&#x77E5;&#x6267;&#x884C;&#x6BCF;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"TCC\"><a href=\"#TCC\" class=\"headerlink\" title=\"TCC\"></a>TCC</h2><p>&#x9002;&#x5408;&#x5BF9;&#x5206;&#x5E03;&#x5F0F;&#x4E00;&#x81F4;&#x6027;&#x8981;&#x6C42;&#x8981;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x5982;&#x652F;&#x4ED8;&#x3001;&#x4EA4;&#x6613;&#x7B49;</p>\n<h3 id=\"&#x6D41;&#x7A0B;-1\"><a href=\"#&#x6D41;&#x7A0B;-1\" class=\"headerlink\" title=\"&#x6D41;&#x7A0B;\"></a>&#x6D41;&#x7A0B;</h3><ul>\n<li><p>Try</p>\n<p>&#x5BF9;&#x5404;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x8D44;&#x6E90;&#x8FDB;&#x884C;&#x68C0;&#x67E5;&#xFF0C;&#x4E1A;&#x52A1;&#x6821;&#x9A8C;&#x7B49;&#x3002;</p>\n</li>\n<li><p>Confirm</p>\n<p>&#x8FDB;&#x884C;&#x5B9E;&#x9645;&#x7684;&#x64CD;&#x4F5C;</p>\n</li>\n<li><p>Cancel</p>\n<p>&#x9519;&#x8BEF;&#x53D1;&#x751F;&#x65F6;&#xFF0C;&#x5BF9;&#x4E4B;&#x524D;&#x7684;&#x64CD;&#x4F5C;&#x8FDB;&#x884C;&#x56DE;&#x6EDA;</p>\n</li>\n</ul>\n<h3 id=\"&#x95EE;&#x9898;\"><a href=\"#&#x95EE;&#x9898;\" class=\"headerlink\" title=\"&#x95EE;&#x9898;\"></a>&#x95EE;&#x9898;</h3><p>&#x4E1A;&#x52A1;&#x8026;&#x5408;&#x6BD4;&#x8F83;&#x5927;&#xFF0C;&#x9700;&#x8981;&#x5927;&#x91CF;&#x7684;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x652F;&#x6301;</p>\n<h2 id=\"&#x672C;&#x5730;&#x6D88;&#x606F;&#x8868;\"><a href=\"#&#x672C;&#x5730;&#x6D88;&#x606F;&#x8868;\" class=\"headerlink\" title=\"&#x672C;&#x5730;&#x6D88;&#x606F;&#x8868;\"></a>&#x672C;&#x5730;&#x6D88;&#x606F;&#x8868;</h2><p>&#x53EF;&#x4EE5;&#x4FDD;&#x8BC1;&#x4E8B;&#x52A1;&#x7684;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x4F46;&#x4E0D;&#x9002;&#x7528;&#x4E8E;&#x9AD8;&#x5E76;&#x53D1;&#x573A;&#x666F;</p>\n<h3 id=\"&#x6D41;&#x7A0B;-2\"><a href=\"#&#x6D41;&#x7A0B;-2\" class=\"headerlink\" title=\"&#x6D41;&#x7A0B;\"></a>&#x6D41;&#x7A0B;</h3><ul>\n<li>A&#x7CFB;&#x7EDF;&#x4E1A;&#x52A1;&#x64CD;&#x4F5C;&#x540E;&#x843D;&#x6D88;&#x606F;&#x8868;&#x5E76;MQ&#x901A;&#x77E5;B&#x7CFB;&#x7EDF;</li>\n<li>B&#x7CFB;&#x7EDF;&#x63A5;&#x6536;&#x6D88;&#x606F;&#x540E;&#x6267;&#x884C;&#x4E1A;&#x52A1;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x66F4;&#x65B0;A&#x3001;B&#x4FE1;&#x606F;&#x6D88;&#x606F;&#x72B6;&#x6001;</li>\n<li>B&#x7CFB;&#x7EDF;&#x672A;&#x6210;&#x529F;&#x65F6;&#xFF0C;A&#x7CFB;&#x7EDF;&#x4F1A;&#x4E00;&#x76F4;&#x91CD;&#x8BD5;&#x5230;&#x6210;&#x529F;</li>\n</ul>\n<h2 id=\"&#x53EF;&#x9760;&#x6D88;&#x606F;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x6027;\"><a href=\"#&#x53EF;&#x9760;&#x6D88;&#x606F;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x6027;\" class=\"headerlink\" title=\"&#x53EF;&#x9760;&#x6D88;&#x606F;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x6027;\"></a>&#x53EF;&#x9760;&#x6D88;&#x606F;&#x6700;&#x7EC8;&#x4E00;&#x81F4;&#x6027;</h2><p>&#x4F9D;&#x8D56;RMQ&#x7684;&#x6D88;&#x606F;&#x4E8B;&#x52A1;&#xFF0C;&#x548C;&#x9AD8;&#x53EF;&#x7528;&#xFF0C;&#x4FDD;&#x8BC1;&#x6D88;&#x606F;&#x4E00;&#x5B9A;&#x901A;&#x77E5;&#x5230;&#xFF0C;&#x5E76;&#x6700;&#x7EC8;&#x4FDD;&#x8BC1;&#x4E8B;&#x52A1;&#x7684;&#x4E00;&#x81F4;&#x6027;</p>\n<h3 id=\"&#x6D41;&#x7A0B;-3\"><a href=\"#&#x6D41;&#x7A0B;-3\" class=\"headerlink\" title=\"&#x6D41;&#x7A0B;\"></a>&#x6D41;&#x7A0B;</h3><ul>\n<li>A&#x7CFB;&#x7EDF;&#x53D1;&#x9001;prepare&#x6D88;&#x606F;&#x81F3;MQ&#xFF0C;&#x5E76;&#x5904;&#x7406;&#x4E1A;&#x52A1;</li>\n<li>A&#x7CFB;&#x7EDF;&#x5904;&#x7406;&#x4E1A;&#x52A1;&#x6210;&#x529F;&#x540E;&#x53D1;&#x9001;Confirm&#x6D88;&#x606F;&#x81F3;MQ</li>\n<li>B&#x7CFB;&#x7EDF;&#x6536;&#x5230;Confirm&#x6D88;&#x606F;&#x540E;&#x6267;&#x884C;&#x4E1A;&#x52A1;</li>\n</ul>\n<h2 id=\"&#x6700;&#x5927;&#x52AA;&#x529B;&#x901A;&#x77E5;&#x65B9;&#x6848;\"><a href=\"#&#x6700;&#x5927;&#x52AA;&#x529B;&#x901A;&#x77E5;&#x65B9;&#x6848;\" class=\"headerlink\" title=\"&#x6700;&#x5927;&#x52AA;&#x529B;&#x901A;&#x77E5;&#x65B9;&#x6848;\"></a>&#x6700;&#x5927;&#x52AA;&#x529B;&#x901A;&#x77E5;&#x65B9;&#x6848;</h2><p>&#x53EF;&#x4EE5;&#x5141;&#x8BB8;&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x7684;&#x4E8B;&#x52A1;&#x5931;&#x8D25;&#xFF0C;&#x4E00;&#x822C;&#x7528;&#x5728;&#x5BF9;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#x4E0D;&#x8981;&#x4E2A;&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x6BD4;&#x5982;&#x65E5;&#x5FD7;&#x6536;&#x96C6;&#x7B49;</p>\n<h3 id=\"A&#x7CFB;&#x7EDF;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x81F3;MQ\"><a href=\"#A&#x7CFB;&#x7EDF;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x81F3;MQ\" class=\"headerlink\" title=\"A&#x7CFB;&#x7EDF;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x81F3;MQ\"></a>A&#x7CFB;&#x7EDF;&#x53D1;&#x9001;&#x6D88;&#x606F;&#x81F3;MQ</h3><h3 id=\"&#x6700;&#x5927;&#x52AA;&#x529B;&#x7CFB;&#x7EDF;&#x63A5;&#x6536;MQ&#x901A;&#x77E5;&#x5E76;&#x8C03;&#x7528;B&#x7CFB;&#x7EDF;\"><a href=\"#&#x6700;&#x5927;&#x52AA;&#x529B;&#x7CFB;&#x7EDF;&#x63A5;&#x6536;MQ&#x901A;&#x77E5;&#x5E76;&#x8C03;&#x7528;B&#x7CFB;&#x7EDF;\" class=\"headerlink\" title=\"&#x6700;&#x5927;&#x52AA;&#x529B;&#x7CFB;&#x7EDF;&#x63A5;&#x6536;MQ&#x901A;&#x77E5;&#x5E76;&#x8C03;&#x7528;B&#x7CFB;&#x7EDF;\"></a>&#x6700;&#x5927;&#x52AA;&#x529B;&#x7CFB;&#x7EDF;&#x63A5;&#x6536;MQ&#x901A;&#x77E5;&#x5E76;&#x8C03;&#x7528;B&#x7CFB;&#x7EDF;</h3><p><em>XMind: ZEN - Trial Version</em></p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"}],"excerpt":"<html><head></head><body><h1 id=\"&#x4EC0;&#x4E48;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;\"><a href=\"#&#x4EC0;&#x4E48;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;\" class=\"headerlink\" title=\"&#x4EC0;&#x4E48;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;\"></a>&#x4EC0;&#x4E48;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x6211;&#x4EEC;&#x8981;&#x6709;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF1F;</h1><h2 id=\"&#x5148;&#x804A;&#x804A;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x5F00;&#x53D1;\"><a href=\"#&#x5148;&#x804A;&#x804A;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x5F00;&#x53D1;\" class=\"headerlink\" title=\"&#x5148;&#x804A;&#x804A;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x5F00;&#x53D1;\"></a>&#x5148;&#x804A;&#x804A;&#x6211;&#x4EEC;&#x7684;&#x9879;&#x76EE;&#x5F00;&#x53D1;</h2><p>&#x5DE5;&#x4F5C;&#x4E2D;&#x968F;&#x7740;&#x4E1A;&#x52A1;&#x7684;&#x9010;&#x6E10;&#x6269;&#x5C55;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x4E1A;&#x52A1;&#x7CFB;&#x7EDF;&#x4E5F;&#x4F1A;&#x6162;&#x6162;&#x53D8;&#x5F97;&#x5E9E;&#x5927;&#x3002;<br>&#x62FF;&#x501F;&#x8D37;&#x7CFB;&#x7EDF;&#x6765;&#x8BF4;&#xFF0C;&#x4ECE;&#x91D1;&#x878D;&#x501F;&#x8D37;&#x4EA7;&#x54C1;&#x7684;&#x4E0A;&#x67B6;&#xFF0C;&#x5546;&#x6237;&#x7684;&#x7533;&#x8BF7;&#x3001;&#x5BA1;&#x6838;&#xFF0C;&#x8D37;&#x6B3E;&#x7684;&#x8FDB;&#x4EF6;&#x3001;KYC&#x3001;&#x653E;&#x8D37;&#xFF0C;&#x518D;&#x5230;&#x7528;&#x6237;&#x7684;&#x8FD8;&#x6B3E;&#x751A;&#x81F3;&#x50AC;&#x6536;&#x3002;<br>&#x800C;&#x4E1A;&#x52A1;&#x5F80;&#x5F80;&#x4E3A;&#x4E86;&#x5FEB;&#x901F;&#x843D;&#x5730;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x5C06;&#x6240;&#x6709;&#x4E1A;&#x52A1;&#x878D;&#x5165;&#x5230;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x4E2D;&#xFF0C;&#x5FEB;&#x901F;&#x5F00;&#x53D1;&#x3001;&#x5FEB;&#x901F;&#x4E0A;&#x7EBF;&#x3002;<br>&#x597D;&#x5904;&#x81EA;&#x7136;&#x662F;&#x516C;&#x53F8;&#x4E1A;&#x52A1;&#x8E6D;&#x8E6D;&#x5F80;&#x4E0A;&#x8D70;&#xFF0C;&#x4E1A;&#x52A1;&#x63D0;&#x51FA;&#x7684;&#x9700;&#x6C42;&#x4E5F;&#x80FD;&#x5FEB;&#x901F;&#x843D;&#x5730;&#x5E76;&#x6295;&#x653E;&#x81F3;&#x5E02;&#x573A;&#xFF0C;&#x4F46;&#x957F;&#x6B64;&#x4EE5;&#x5F80;&#x5F00;&#x53D1;&#x6D4B;&#x8BD5;&#x4EBA;&#x5458;&#x4F1A;&#x53D8;&#x5F97;&#x75B2;&#x60EB;&#x4E0D;&#x582A;&#x3002;<br>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5C31;&#x8981;&#x804A;&#x5230;&#x670D;&#x52A1;&#x7684;&#x62C6;&#x5206;&#xFF0C;&#x7531;&#x4E8E;&#x8FD9;&#x6B21;&#x4E3B;&#x8981;&#x8BB2;&#x7684;&#x662F;&#x5206;&#x5E03;&#x5F0F;&#x4E8B;&#x52A1;&#xFF0C;&#x6211;&#x4EEC;&#x4E0B;&#x6B21;&#x6709;&#x65F6;&#x95F4;&#x518D;&#x6765;&#x8BA8;&#x8BBA;&#x8BA8;&#x8BBA;&#x5FAE;&#x670D;&#x52A1;&#x7684;&#x62C6;&#x5206;&#x548C;&#x73B0;&#x5728;&#x5927;&#x70ED;&#x95E8;&#x7684;DDD&#x9886;&#x57DF;&#x6A21;&#x578B;&#x3002;</p>\n<h2 id=\"&#x670D;&#x52A1;&#x62C6;&#x5206;&#x540E;&#x3002;&#x3002;&#x3002;\"><a href=\"#&#x670D;&#x52A1;&#x62C6;&#x5206;&#x540E;&#x3002;&#x3002;&#x3002;\" class=\"headerlink\" title=\"&#x670D;&#x52A1;&#x62C6;&#x5206;&#x540E;&#x3002;&#x3002;&#x3002;\"></a>&#x670D;&#x52A1;&#x62C6;&#x5206;&#x540E;&#x3002;&#x3002;&#x3002;</h2><p>&#x5728;&#x4E92;&#x8054;&#x7F51;&#x516C;&#x53F8;&#x5DE5;&#x4F5C;&#x7684;&#x8BDD;&#xFF0C;&#x5927;&#x5BB6;&#x5E94;&#x8BE5;&#x90FD;&#x7ECF;&#x5386;&#x8FC7;&#x4E00;&#x4E2A;&#x5927;&#x7CFB;&#x7EDF;&#xFF0C;&#x7ECF;&#x8FC7;&#x4E0D;&#x505C;&#x7684;&#x8FED;&#x4EE3;&#xFF0C;&#x6700;&#x540E;&#x62C6;&#x6210;&#x6570;&#x4E2A;&#x5FAE;&#x670D;&#x52A1;&#x7684;&#x8FC7;&#x7A0B;&#x3002;<br>&#x5176;&#x4E2D;&#x7684;&#x597D;&#x5904;&#x81EA;&#x7136;&#x4E0D;&#x7528;&#x8BF4;&#xFF0C;&#x7CFB;&#x7EDF;&#x89E3;&#x8026;&#x3001;&#x4E1A;&#x52A1;&#x89E3;&#x8026;&#x3001;&#x5FEB;&#x901F;&#x53D1;&#x7248;&#x3001;&#x66F4;&#x5C11;&#x7684;&#x7EF4;&#x62A4;&#x7B49;&#x7B49;&#x7B49;&#x7B49;&#x3002;<br>&#x4F46;&#x662F;&#x4E00;&#x65E6;&#x62C6;&#x51FA;&#x591A;&#x4E2A;&#x5FAE;&#x670D;&#x52A1;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x4F1A;&#x9047;&#x5230;&#x4E00;&#x4E2A;&#x68D8;&#x624B;&#x95EE;&#x9898;&#x3002;</p></body></html>","more":"<h2 id=\"ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æœ‰åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿè¿™ä¸ªé—®é¢˜å‡¸æ˜¾äº†å‡ºæ¥\"><a href=\"#ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æœ‰åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿè¿™ä¸ªé—®é¢˜å‡¸æ˜¾äº†å‡ºæ¥\" class=\"headerlink\" title=\"ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æœ‰åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿè¿™ä¸ªé—®é¢˜å‡¸æ˜¾äº†å‡ºæ¥\"></a>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æœ‰åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿè¿™ä¸ªé—®é¢˜å‡¸æ˜¾äº†å‡ºæ¥</h2><p>å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªä¸šåŠ¡ï¼šå®¢æˆ·ç”³è¯·äº†ä¸€ä¸ªè´·æ¬¾ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åšçš„æ˜¯</p>\n<ol>\n<li>æ”¶é›†ç”¨æˆ·ä¿¡æ¯</li>\n<li>å®¡æ ¸ç”¨æˆ·ä¿¡æ¯</li>\n<li>åˆ›å»ºè´·æ¬¾è®¢å•åŠåˆ†æœŸè®¢å•ç­‰</li>\n<li>é€‰å–æŠ•èµ„äºº</li>\n<li>æ”¾æ¬¾</li>\n</ol>\n<p>å…¶ä¸­æ”¶é›†ç”¨æˆ·ä¿¡æ¯å’Œå®¡æ ¸ç”¨æˆ·ä¿¡æ¯å¹¶ä¸æ˜¯ä¸€ä¸ªå®æ—¶æ“ä½œï¼Œæˆ‘ä»¬å¯èƒ½ä¼šäº¤ç”±æ¶ˆæ¯å»å¼‚æ­¥å¤„ç†ã€‚<br>ä½†æ˜¯ç¬¬ä¸‰ã€å››ã€äº”æ­¥æ˜¯å®¡æ ¸é€šè¿‡åä¸€ä¸€æ‰§è¡Œçš„ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥äº¤ç”±æ¶ˆæ¯å¼‚æ­¥å¤„ç†ï¼Œä½†æ˜¯è¯•æƒ³ä¸€ä¸ªåœºæ™¯ã€‚ç”¨æˆ·å†åˆ†æœŸè´­ä¹°äº§å“çš„æ—¶å€™è™½ç„¶å¯¹ç”¨æˆ·åªæ˜¯ä¸€æ¬¡äº¤æ˜“æ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬åå°å¯èƒ½å·²ç»æŠŠè¿™ç¬”äº¤æ˜“ä½œä¸ºä¸€ç¬”åˆ†æœŸå€Ÿæ¬¾è¿›è¡Œäº†è½æ¬¾ã€‚ä½†æ˜¯å®¢æˆ·ä¸çŸ¥é“ï¼Œä¸æ˜¯è¯´å¼‚æ­¥å¤„ç†ä¸å¥½ï¼Œä½†å¦‚æœèƒ½å®æ—¶çš„å‘Šè¯‰ç”¨æˆ·æ”¯ä»˜ç»“æœï¼Œæ˜¯ä¸æ˜¯èƒ½æé«˜ç”¨æˆ·ä½“éªŒå’Œè½¬æ¢ç‡å‘¢ã€‚<br>å›å¤´çœ‹ä¸‹æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œå·²ç»è¢«æ‹†æˆè®¢å•æœåŠ¡ã€ç”¨æˆ·ä½“ç³»æœåŠ¡ã€æ”¾æ¬¾æœåŠ¡äº†ï¼Œéšä¹‹å¸¦æ¥çš„æ˜¯æ¯ä¸ªå¾®æœåŠ¡æœ‰è‡ªå·±å¯¹åº”çš„æ•°æ®åº“ï¼Œåˆ†åˆ«ä¿å­˜çš„æ˜¯è®¢å•ä¿¡æ¯ã€æŠ•èµ„äºº|å€Ÿæ¬¾äººä¿¡æ¯ã€æ”¾æ¬¾ä¿¡æ¯ã€‚<br>ä¸€ä¸åšäºŒä¸ä¼‘ï¼Œæˆ‘ä»¬æŠŠä»¥å‰åŒä¸€ä¸ªæœåŠ¡å†…çš„æ–¹æ³•è°ƒç”¨æ”¹æˆä¸åŒæœåŠ¡ä¹‹é—´çš„å¼‚æ­¥è°ƒç”¨ï¼Œä½†éšä¹‹è€Œæ¥çš„æ˜¯ç”Ÿäº§ä¸Šä¸æ—¶ä¼šå‡ºç°æ¼æ•°æ®æˆ–è®¢å•æ— æ³•æ­£å¸¸å®Œæˆçš„é—®é¢˜ã€‚<br>èªæ˜çš„å°ä¼™ä¼´åº”è¯¥æ—©å°±å‘ç°äº†ï¼Œä¸ºäº†ä¿è¯åˆ†å¸ƒå¼æœåŠ¡é—´è°ƒç”¨çš„äº‹åŠ¡æ€§ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å°±å­•è‚²è€Œç”Ÿäº†ã€‚</p>\n<h2 id=\"ä¸¤é˜¶æ®µæäº¤-XA\"><a href=\"#ä¸¤é˜¶æ®µæäº¤-XA\" class=\"headerlink\" title=\"ä¸¤é˜¶æ®µæäº¤/XA\"></a>ä¸¤é˜¶æ®µæäº¤/XA</h2><p>å¸¸è§äºå•ç³»ç»Ÿæ“ä½œå¤šæ•°æ®æºã€‚<br>ç”±äºä¾èµ–æ•°æ®åº“çš„äº‹åŠ¡ï¼Œå¯¼è‡´æ•ˆç‡ä½ï¼Œä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚</p>\n<h3 id=\"äº‹åŠ¡ç®¡ç†å™¨\"><a href=\"#äº‹åŠ¡ç®¡ç†å™¨\" class=\"headerlink\" title=\"äº‹åŠ¡ç®¡ç†å™¨\"></a>äº‹åŠ¡ç®¡ç†å™¨</h3><h3 id=\"æµç¨‹\"><a href=\"#æµç¨‹\" class=\"headerlink\" title=\"æµç¨‹\"></a>æµç¨‹</h3><ul>\n<li><p>ç¬¬ä¸€é˜¶æ®µ</p>\n<ul>\n<li>å‘èµ·äº‹åŠ¡</li>\n<li>å–æ¶ˆäº‹åŠ¡</li>\n</ul>\n</li>\n<li><p>ç¬¬äºŒé˜¶æ®µ</p>\n<ul>\n<li>é€šçŸ¥æ‰§è¡Œæ¯ä¸€ä¸ªä»»åŠ¡</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"TCC\"><a href=\"#TCC\" class=\"headerlink\" title=\"TCC\"></a>TCC</h2><p>é€‚åˆå¯¹åˆ†å¸ƒå¼ä¸€è‡´æ€§è¦æ±‚è¦çš„ç³»ç»Ÿï¼Œå¦‚æ”¯ä»˜ã€äº¤æ˜“ç­‰</p>\n<h3 id=\"æµç¨‹-1\"><a href=\"#æµç¨‹-1\" class=\"headerlink\" title=\"æµç¨‹\"></a>æµç¨‹</h3><ul>\n<li><p>Try</p>\n<p>å¯¹å„ä¸ªæœåŠ¡çš„èµ„æºè¿›è¡Œæ£€æŸ¥ï¼Œä¸šåŠ¡æ ¡éªŒç­‰ã€‚</p>\n</li>\n<li><p>Confirm</p>\n<p>è¿›è¡Œå®é™…çš„æ“ä½œ</p>\n</li>\n<li><p>Cancel</p>\n<p>é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå¯¹ä¹‹å‰çš„æ“ä½œè¿›è¡Œå›æ»š</p>\n</li>\n</ul>\n<h3 id=\"é—®é¢˜\"><a href=\"#é—®é¢˜\" class=\"headerlink\" title=\"é—®é¢˜\"></a>é—®é¢˜</h3><p>ä¸šåŠ¡è€¦åˆæ¯”è¾ƒå¤§ï¼Œéœ€è¦å¤§é‡çš„ä¸šåŠ¡ä»£ç æ”¯æŒ</p>\n<h2 id=\"æœ¬åœ°æ¶ˆæ¯è¡¨\"><a href=\"#æœ¬åœ°æ¶ˆæ¯è¡¨\" class=\"headerlink\" title=\"æœ¬åœ°æ¶ˆæ¯è¡¨\"></a>æœ¬åœ°æ¶ˆæ¯è¡¨</h2><p>å¯ä»¥ä¿è¯äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§ï¼Œä½†ä¸é€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯</p>\n<h3 id=\"æµç¨‹-2\"><a href=\"#æµç¨‹-2\" class=\"headerlink\" title=\"æµç¨‹\"></a>æµç¨‹</h3><ul>\n<li>Aç³»ç»Ÿä¸šåŠ¡æ“ä½œåè½æ¶ˆæ¯è¡¨å¹¶MQé€šçŸ¥Bç³»ç»Ÿ</li>\n<li>Bç³»ç»Ÿæ¥æ”¶æ¶ˆæ¯åæ‰§è¡Œä¸šåŠ¡æ“ä½œï¼Œå¹¶æ›´æ–°Aã€Bä¿¡æ¯æ¶ˆæ¯çŠ¶æ€</li>\n<li>Bç³»ç»ŸæœªæˆåŠŸæ—¶ï¼ŒAç³»ç»Ÿä¼šä¸€ç›´é‡è¯•åˆ°æˆåŠŸ</li>\n</ul>\n<h2 id=\"å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§\"><a href=\"#å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§\" class=\"headerlink\" title=\"å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§\"></a>å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§</h2><p>ä¾èµ–RMQçš„æ¶ˆæ¯äº‹åŠ¡ï¼Œå’Œé«˜å¯ç”¨ï¼Œä¿è¯æ¶ˆæ¯ä¸€å®šé€šçŸ¥åˆ°ï¼Œå¹¶æœ€ç»ˆä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§</p>\n<h3 id=\"æµç¨‹-3\"><a href=\"#æµç¨‹-3\" class=\"headerlink\" title=\"æµç¨‹\"></a>æµç¨‹</h3><ul>\n<li>Aç³»ç»Ÿå‘é€prepareæ¶ˆæ¯è‡³MQï¼Œå¹¶å¤„ç†ä¸šåŠ¡</li>\n<li>Aç³»ç»Ÿå¤„ç†ä¸šåŠ¡æˆåŠŸåå‘é€Confirmæ¶ˆæ¯è‡³MQ</li>\n<li>Bç³»ç»Ÿæ”¶åˆ°Confirmæ¶ˆæ¯åæ‰§è¡Œä¸šåŠ¡</li>\n</ul>\n<h2 id=\"æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ\"><a href=\"#æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ\" class=\"headerlink\" title=\"æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ\"></a>æœ€å¤§åŠªåŠ›é€šçŸ¥æ–¹æ¡ˆ</h2><p>å¯ä»¥å…è®¸ä¸€å®šç¨‹åº¦ä¸Šçš„äº‹åŠ¡å¤±è´¥ï¼Œä¸€èˆ¬ç”¨åœ¨å¯¹åˆ†å¸ƒå¼äº‹åŠ¡ä¸è¦ä¸ªçš„ç³»ç»Ÿï¼Œæ¯”å¦‚æ—¥å¿—æ”¶é›†ç­‰</p>\n<h3 id=\"Aç³»ç»Ÿå‘é€æ¶ˆæ¯è‡³MQ\"><a href=\"#Aç³»ç»Ÿå‘é€æ¶ˆæ¯è‡³MQ\" class=\"headerlink\" title=\"Aç³»ç»Ÿå‘é€æ¶ˆæ¯è‡³MQ\"></a>Aç³»ç»Ÿå‘é€æ¶ˆæ¯è‡³MQ</h3><h3 id=\"æœ€å¤§åŠªåŠ›ç³»ç»Ÿæ¥æ”¶MQé€šçŸ¥å¹¶è°ƒç”¨Bç³»ç»Ÿ\"><a href=\"#æœ€å¤§åŠªåŠ›ç³»ç»Ÿæ¥æ”¶MQé€šçŸ¥å¹¶è°ƒç”¨Bç³»ç»Ÿ\" class=\"headerlink\" title=\"æœ€å¤§åŠªåŠ›ç³»ç»Ÿæ¥æ”¶MQé€šçŸ¥å¹¶è°ƒç”¨Bç³»ç»Ÿ\"></a>æœ€å¤§åŠªåŠ›ç³»ç»Ÿæ¥æ”¶MQé€šçŸ¥å¹¶è°ƒç”¨Bç³»ç»Ÿ</h3><p><em>XMind: ZEN - Trial Version</em></p>"},{"title":"åˆ†æ”¯é¢„æµ‹ GCC __builtin_expect æœ‰ç”¨å—ï¼Ÿ","date":"2020-12-14T14:57:18.000Z","_content":"\næˆ‘ä»¬æ—¥å¸¸ç¼–å†™çš„ä»£ç ä¸­å¸¸è§çš„åˆ†æ”¯è¯­å¥ï¼Œè§£é‡Šè¡Œè¯­è¨€èƒ½å¤Ÿæ ¹æ®ä»£ç è¿è¡ŒæœŸé—´æ”¶é›†åˆ†æ”¯çš„è·³è½¬çš„è¶‹åŠ¿åŠ¨æ€ä¼˜åŒ–åˆ†æ”¯è·³è½¬ã€‚è€Œç¼–è¯‘è¨€è¯­ç”±äºç¼–è¯‘åç›´æ¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› æ­¤å¾ˆéš¾åœ¨ç¼–è¯‘æœŸæ¨æ–­å‡ºæœ€å¥½çš„ä¼˜åŒ–æ¡ä»¶ã€‚GCCä¸ºå¼€å‘è€…æä¾›äº†æ‰‹åŠ¨ä¼˜åŒ–åˆ†æ”¯é¢„æµ‹çš„æ–¹æ³•__builtin_expectï¼Œé€šè¿‡æ˜¾ç¤ºç¼–ç¨‹å‘ç¼–è¯‘å™¨æä¾›ä¼˜åŒ–å»ºè®®ä»è€Œä¼˜åŒ–åˆ†æ”¯çš„èµ°å‘ã€‚\n<!-- more -->\nç¼–è¯‘å™¨æ˜¯å¦‚ä½•å¤„ç†åˆ†æ”¯æ¡ä»¶çš„ï¼Ÿä½¿ç”¨__builtin_expectçš„åˆ†æ”¯æ˜¯å¦‚ä½•å¾—åˆ°ä¼˜åŒ–çš„ï¼Ÿä½¿ç”¨GCCé»˜è®¤çš„ä¼˜åŒ–çº§åˆ«ä¼šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ\n\nä¸ºäº†è§£å¼€è¿™äº›ç–‘æƒ‘ï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šä»£ç ã€‚\n\n* å¹³å° Ubuntu 20.04.1 LTS\n* å†…æ ¸ Linux b13a1870ebc6 5.4.39-linuxkit #1 SMP Fri May 8 23:03:06 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\n* ç¼–è¯‘å·¥å…· gcc (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0\n\n``` C\n#include <stdio.h>\n#include <stdlib.h>\n\n//xå¾ˆå¯èƒ½ä¸ºtrue\n#define likely(x) __builtin_expect(!!(x), 1)  \n//xå¾ˆå¯èƒ½ä¸ºfalse\n#define unlikely(x) __builtin_expect(!!(x), 0)\n\nvoid foo(){\n    printf(\"foo\\n\");\n}\nvoid foo1(){\n    printf(\"foo1\\n\");\n}\n\nvoid doLikely(int a){\n    \n    if(likely(a)){\n        foo();    \n    }else {\n        foo1();\n    }\n}\n\nvoid doLikelyNocall(int a){\n    int x;\n    if(likely(a)){\n        x = a*a;\n    }else {\n        x = a+a;\n    }\n}\n\nvoid doUnlikely(int a){\n    \n    if(unlikely(a)){\n        foo();\n    }else {\n        foo1();\n    }\n}\n\nvoid doUnlikelyNocall(int a){\n    int x;\n    if(unlikely(a)){\n        x = a*a;\n    }else {\n        x = a+a;\n    }\n}\n\nvoid normal(int a){\n    \n    if(a){\n        foo();\n    }else {\n        foo1();\n    }\n}\n\nvoid normalNocall(int a){\n    int x;\n    if(a){\n        x = a*a;\n    }else {\n        x = a+a;\n    }\n}\n\n\nint main(int argc, char **argv){\n    //ä¸ºäº†æ’é™¤å¸¸é‡å¯¼è‡´ç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œè¿™é‡Œä½¿ç”¨ä¸å®šå‚æ•°ä½œä¸ºå…¥å‚ï¼Œé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–ç›¸å…³ä»£ç \n    int a = atoi(argv[1]);\n    doLikely(a);\n    doUnlikely(a);\n    normal(a);\n    doLikelyNocall(a);\n    doUnlikelyNocall(a);\n    normalNocall(a);\n    return 0;\n}\n```\n\nå¼€å§‹ç¼–è¾‘ï¼Œè¿™é‡Œæ˜¾ç¤ºçš„æŒ‡å®š-O0 -O1 -O2 -O3è¿™å››ä¸ªä¼˜åŒ–ç­‰çº§ã€‚\n``` bash\nroot@b13a1870ebc6:/workspace_c/builtin_expect# gcc -O0 -o test_0 builtin_expect.c\nroot@b13a1870ebc6:/workspace_c/builtin_expect# gcc -O1 -o test_1 builtin_expect.c\nroot@b13a1870ebc6:/workspace_c/builtin_expect# gcc -O2 -o test_2 builtin_expect.c\nroot@b13a1870ebc6:/workspace_c/builtin_expect# gcc -O3 -o test_3 builtin_expect.c\n```\n\nå°†ç¼–è¯‘åçš„ç›®æ ‡æ–‡ä»¶åæ±‡ç¼–\n``` bash\nroot@b13a1870ebc6:/workspace_c/builtin_expect# objdump -d test_0 >test_0.a\nroot@b13a1870ebc6:/workspace_c/builtin_expect# objdump -d test_1 >test_1.a\nroot@b13a1870ebc6:/workspace_c/builtin_expect# objdump -d test_2 >test_2.a\nroot@b13a1870ebc6:/workspace_c/builtin_expect# objdump -d test_3 >test_3.a\n```\n\næœ€ç»ˆæˆ‘ä»¬å¾—åˆ°äº†4ä¸ªä¼˜åŒ–ç­‰çº§ä¸åŒçš„æ±‡ç¼–ä»£ç ï¼Œå¹¶ä¾æ¬¡å¯¹æ¯”ç›¸å…³é€»è¾‘ã€‚\n\n1.-O0ç­‰çº§ä¸‹ï¼Œç¼–è¯‘å™¨é»˜è®¤ä¸æ‰§è¡Œä»»ä½•ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯¹æ¯”åŸå§‹åˆ†æ”¯ä»£ç å’Œç»è¿‡__builtin_expectä¼˜åŒ–åçš„ä»£ç åœ¨æ±‡ç¼–ç ä¸Šæœ‰ä½•åŒºåˆ«ã€‚\n\n``` x86asm\n0000000000001197 <doLikely>:\n    1197:\tf3 0f 1e fa          \tendbr64 \n    119b:\t55                   \tpush   %rbp\n    119c:\t48 89 e5             \tmov    %rsp,%rbp\n    119f:\t48 83 ec 10          \tsub    $0x10,%rsp\n    11a3:\t89 7d fc             \tmov    %edi,-0x4(%rbp)      #å‚æ•°aå­˜æ”¾è‡³-0x4(%rbp)å¤„\n    11a6:\t83 7d fc 00          \tcmpl   $0x0,-0x4(%rbp)      #å‚æ•°aå’Œ0æ¯”è¾ƒ\n    11aa:\t0f 95 c0             \tsetne  %al                  #æ¡ä»¶è®¾ç½®ï¼Œalä¸­ä¿å­˜~ZFã€‚if a = 1 then al = 1 ; if a = 0 then al = 0\n    11ad:\t0f b6 c0             \tmovzbl %al,%eax             #eax = 0000000000000000 -> 00000000000000000000000000000000 or 0000000000000001 -> 00000000000000000000000000000001\n    11b0:\t48 85 c0             \ttest   %rax,%rax            #åˆ¤æ–­eaxæ˜¯å¦ä¸º0\n    11b3:\t74 0c                \tje     11c1 <doLikely+0x2a> #eax = 0(a = 0)æ—¶ï¼Œè·³è½¬è‡³11c1ï¼Œcall foo1\n    11b5:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    11ba:\te8 aa ff ff ff       \tcallq  1169 <foo>           #eax!=0(a = 0)æ—¶ï¼Œcall foo\n    11bf:\teb 0a                \tjmp    11cb <doLikely+0x34> #è·³è½¬è‡³11cbï¼Œç»“æŸ\n    11c1:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    11c6:\te8 b5 ff ff ff       \tcallq  1180 <foo1>\n    11cb:\t90                   \tnop\n    11cc:\tc9                   \tleaveq \n    11cd:\tc3                   \tretq   \n\n\n0000000000001265 <normal>:\n    1265:\tf3 0f 1e fa          \tendbr64 \n    1269:\t55                   \tpush   %rbp\n    126a:\t48 89 e5             \tmov    %rsp,%rbp\n    126d:\t48 83 ec 10          \tsub    $0x10,%rsp\n    1271:\t89 7d fc             \tmov    %edi,-0x4(%rbp)      #å‚æ•°aå­˜æ”¾è‡³-0x4(%rbp)å¤„\n    1274:\t83 7d fc 00          \tcmpl   $0x0,-0x4(%rbp)      #å‚æ•°aå’Œ0æ¯”è¾ƒ\n    1278:\t74 0c                \tje     1286 <normal+0x21>   #å¦‚æœa=0ï¼Œåˆ™è·³è½¬è‡³1286ï¼Œæ‰§è¡Œfoo1\n    127a:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    127f:\te8 e5 fe ff ff       \tcallq  1169 <foo>           #å¦‚æœa!=0,åˆ™æ‰§è¡Œfoo\n    1284:\teb 0a                \tjmp    1290 <normal+0x2b>   #è·³è½¬è‡³1290ï¼Œç»“æŸ\n    1286:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    128b:\te8 f0 fe ff ff       \tcallq  1180 <foo1>\n    1290:\t90                   \tnop\n    1291:\tc9                   \tleaveq \n    1292:\tc3                   \tretq   \n```\n\né€šè¿‡å¯¹æ¯”ï¼Œç»“æœä»¤äººæƒŠè®¶ã€‚è™½ç„¶æ‰§è¡Œç»“æœä¸€ç›´ï¼Œä½†æ˜¯æ²¡æœ‰ç»è¿‡_builtin_expectä¼˜åŒ–çš„åˆ†æ”¯åˆ¤æ–­ï¼Œåè€Œæ¯”æ ‡è¯†_builtin_expectçš„æ±‡ç¼–ä»£ç æ›´åŠ ç®€æ´ã€‚\n\nåˆ†æUnlikelyçš„æ±‡ç¼–ä»£ç ï¼Œä¹Ÿå­˜åœ¨åŒæ ·çš„é—®é¢˜ï¼Œç¼–è¯‘å™¨è²Œä¼¼ä¼šå¤šæ­¤ä¸€ä¸¾å¢åŠ ä¸€æ­¥çš„åˆ¤æ–­\n``` x86asm\n00000000000011fe <doUnlikely>:\n    11fe:\tf3 0f 1e fa          \tendbr64 \n    1202:\t55                   \tpush   %rbp\n    1203:\t48 89 e5             \tmov    %rsp,%rbp\n    1206:\t48 83 ec 10          \tsub    $0x10,%rsp\n    120a:\t89 7d fc             \tmov    %edi,-0x4(%rbp)\n    120d:\t83 7d fc 00          \tcmpl   $0x0,-0x4(%rbp)\n    1211:\t0f 95 c0             \tsetne  %al\n    1214:\t0f b6 c0             \tmovzbl %al,%eax\n    1217:\t48 85 c0             \ttest   %rax,%rax\n    121a:\t74 0c                \tje     1228 <doUnlikely+0x2a>\n    121c:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    1221:\te8 43 ff ff ff       \tcallq  1169 <foo>\n    1226:\teb 0a                \tjmp    1232 <doUnlikely+0x34>\n    1228:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    122d:\te8 4e ff ff ff       \tcallq  1180 <foo1>\n    1232:\t90                   \tnop\n    1233:\tc9                   \tleaveq \n    1234:\tc3                   \tretq   \n```\n\næ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå†™äº†ä¸ªéå†…éƒ¨è°ƒç”¨çš„ç‰ˆæœ¬ï¼Œç»“æœä¹Ÿæ˜¯åŒæ ·ã€‚ç¼–è¯‘å™¨æ²¡æœ‰å¯¹_builtin_expectåšå‡ºä¸ä¸€æ ·çš„ä¼˜åŒ–ã€‚\n\n``` x86asm\n00000000000011ce <doLikelyNocall>:\n    11ce:\tf3 0f 1e fa          \tendbr64 \n    11d2:\t55                   \tpush   %rbp\n    11d3:\t48 89 e5             \tmov    %rsp,%rbp\n    11d6:\t89 7d ec             \tmov    %edi,-0x14(%rbp)\n    11d9:\t83 7d ec 00          \tcmpl   $0x0,-0x14(%rbp)\n    11dd:\t0f 95 c0             \tsetne  %al\n    11e0:\t0f b6 c0             \tmovzbl %al,%eax\n    11e3:\t48 85 c0             \ttest   %rax,%rax\n    11e6:\t74 0b                \tje     11f3 <doLikelyNocall+0x25>\n    11e8:\t8b 45 ec             \tmov    -0x14(%rbp),%eax\n    11eb:\t0f af c0             \timul   %eax,%eax\n    11ee:\t89 45 fc             \tmov    %eax,-0x4(%rbp)\n    11f1:\teb 08                \tjmp    11fb <doLikelyNocall+0x2d>\n    11f3:\t8b 45 ec             \tmov    -0x14(%rbp),%eax\n    11f6:\t01 c0                \tadd    %eax,%eax\n    11f8:\t89 45 fc             \tmov    %eax,-0x4(%rbp)\n    11fb:\t90                   \tnop\n    11fc:\t5d                   \tpop    %rbp\n    11fd:\tc3                   \tretq   \n```\n\n2.ä¸ºäº†äº†è§£_builtin_expectæ˜¯å¦çœŸçš„æœ‰ç”¨ï¼Œæˆ‘ä»¬å†çœ‹çœ‹å…¶ä»–ä¼˜åŒ–ç­‰çº§ -O1ã€‚\n\n``` x86asm\n000000000000119b <doLikely>:\n    119b:\tf3 0f 1e fa          \tendbr64 \n    119f:\t48 83 ec 08          \tsub    $0x8,%rsp\n    11a3:\t85 ff                \ttest   %edi,%edi\n    11a5:\t74 0f                \tje     11b6 <doLikely+0x1b>\n    11a7:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    11ac:\te8 b8 ff ff ff       \tcallq  1169 <foo>\n    11b1:\t48 83 c4 08          \tadd    $0x8,%rsp\n    11b5:\tc3                   \tretq   \n    11b6:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    11bb:\te8 c2 ff ff ff       \tcallq  1182 <foo1>\n    11c0:\teb ef                \tjmp    11b1 <doLikely+0x16>\n\n00000000000011f3 <normal>:\n    11f3:\tf3 0f 1e fa          \tendbr64 \n    11f7:\t48 83 ec 08          \tsub    $0x8,%rsp\n    11fb:\t85 ff                \ttest   %edi,%edi\n    11fd:\t74 0f                \tje     120e <normal+0x1b>\n    11ff:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    1204:\te8 60 ff ff ff       \tcallq  1169 <foo>\n    1209:\t48 83 c4 08          \tadd    $0x8,%rsp\n    120d:\tc3                   \tretq   \n    120e:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    1213:\te8 6a ff ff ff       \tcallq  1182 <foo1>\n    1218:\teb ef                \tjmp    1209 <normal+0x16>\n\n00000000000011ee <doUnlikelyNocall>:\n    11ee:\tf3 0f 1e fa          \tendbr64 \n    11f2:\tc3                   \tretq   \n```\n\nè§‚å¯Ÿ-O1ä¼˜åŒ–åçš„æ±‡ç¼–ä»£ç ï¼Œä»£ç é£æ ¼æœ‰äº†è´¨çš„é£è¶Šã€‚å»é™¤äº†å…¬å¼åŒ–çš„å‚æ•°ä¼ é€’ï¼Œè´¹åŠ²çš„å€¼æ¯”è¾ƒã€‚ä½†æ˜¯ä¾ç„¶æ²¡æœ‰ä½“ç°å‡º_builtin_expectæœ‰æ²¡æœ‰çš„åŒºåˆ«ã€‚\nåŒæ ·çš„ï¼Œæˆ‘ä»¬çš„éè°ƒç”¨ç‰ˆæœ¬ç”±äºæ— è¿”å›å€¼ï¼Œå·²ç»è¢«ç¼–è¯‘å™¨å®Œå…¨ä¼˜åŒ–æ‰äº†ã€‚\n\næˆ‘ä»¬å†çœ‹çœ‹-O2ã€‚\n\n``` x86asm\n0000000000001210 <doLikely>:\n    1210:\tf3 0f 1e fa          \tendbr64 \n    1214:\t85 ff                \ttest   %edi,%edi\n    1216:\t74 10                \tje     1228 <doLikely+0x18>\n    1218:\t48 8d 3d e5 0d 00 00 \tlea    0xde5(%rip),%rdi        # 2004 <_IO_stdin_used+0x4>\n    121f:\te9 3c fe ff ff       \tjmpq   1060 <puts@plt>\n    1224:\t0f 1f 40 00          \tnopl   0x0(%rax)\n    1228:\t48 8d 3d d9 0d 00 00 \tlea    0xdd9(%rip),%rdi        # 2008 <_IO_stdin_used+0x8>\n    122f:\te9 2c fe ff ff       \tjmpq   1060 <puts@plt>\n    1234:\t66 66 2e 0f 1f 84 00 \tdata16 nopw %cs:0x0(%rax,%rax,1)\n    123b:\t00 00 00 00 \n    123f:\t90                   \tnop\n\n0000000000001290 <normal>:\n    1290:\tf3 0f 1e fa          \tendbr64 \n    1294:\t85 ff                \ttest   %edi,%edi\n    1296:\t74 10                \tje     12a8 <normal+0x18>\n    1298:\t48 8d 3d 65 0d 00 00 \tlea    0xd65(%rip),%rdi        # 2004 <_IO_stdin_used+0x4>\n    129f:\te9 bc fd ff ff       \tjmpq   1060 <puts@plt>\n    12a4:\t0f 1f 40 00          \tnopl   0x0(%rax)\n    12a8:\t48 8d 3d 59 0d 00 00 \tlea    0xd59(%rip),%rdi        # 2008 <_IO_stdin_used+0x8>\n    12af:\te9 ac fd ff ff       \tjmpq   1060 <puts@plt>\n    12b4:\t66 66 2e 0f 1f 84 00 \tdata16 nopw %cs:0x0(%rax,%rax,1)\n    12bb:\t00 00 00 00 \n    12bf:\t90                   \tnop\n```\n\nä»£ç è¿›ä¸€æ­¥çš„è¢«ä¼˜åŒ–ï¼Œä»æ±‡ç¼–ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ–¹æ³•è°ƒç”¨å®Œå…¨ä¼˜åŒ–æ‰äº†æ ˆä¸Šè°ƒç”¨ã€‚å»é™¤äº†æ ˆä¸Šä¼ é€’ï¼Œå°†callæŒ‡ä»¤å˜ä¸ºäº†jmpæŒ‡ä»¤ï¼Œè¿›ä¸€æ­¥å‡å°‘äº†æŒ‡ä»¤ä¸Šçš„å¼€é”€ã€‚\nä½†ç»“æœä»ç„¶æ²¡æœ‰æ”¹å˜ï¼Œ_builtin_expectä¾ç„¶æ²¡æœ‰å‘å…‰å‘çƒ­ã€‚\n\næœ€åæˆ‘ä»¬åªèƒ½æŠŠå¸Œæœ›å¯„æ‰˜äº-O3ä¸Šçœ‹çœ‹äº†ã€‚\n\n``` x86asm\n0000000000001210 <doLikely>:\n    1210:\tf3 0f 1e fa          \tendbr64 \n    1214:\t85 ff                \ttest   %edi,%edi\n    1216:\t74 10                \tje     1228 <doLikely+0x18>\n    1218:\t48 8d 3d e5 0d 00 00 \tlea    0xde5(%rip),%rdi        # 2004 <_IO_stdin_used+0x4>\n    121f:\te9 3c fe ff ff       \tjmpq   1060 <puts@plt>\n    1224:\t0f 1f 40 00          \tnopl   0x0(%rax)\n    1228:\t48 8d 3d d9 0d 00 00 \tlea    0xdd9(%rip),%rdi        # 2008 <_IO_stdin_used+0x8>\n    122f:\te9 2c fe ff ff       \tjmpq   1060 <puts@plt>\n    1234:\t66 66 2e 0f 1f 84 00 \tdata16 nopw %cs:0x0(%rax,%rax,1)\n    123b:\t00 00 00 00 \n    123f:\t90                   \tnop\n\n0000000000001290 <normal>:\n    1290:\tf3 0f 1e fa          \tendbr64 \n    1294:\t85 ff                \ttest   %edi,%edi\n    1296:\t74 10                \tje     12a8 <normal+0x18>\n    1298:\t48 8d 3d 65 0d 00 00 \tlea    0xd65(%rip),%rdi        # 2004 <_IO_stdin_used+0x4>\n    129f:\te9 bc fd ff ff       \tjmpq   1060 <puts@plt>\n    12a4:\t0f 1f 40 00          \tnopl   0x0(%rax)\n    12a8:\t48 8d 3d 59 0d 00 00 \tlea    0xd59(%rip),%rdi        # 2008 <_IO_stdin_used+0x8>\n    12af:\te9 ac fd ff ff       \tjmpq   1060 <puts@plt>\n    12b4:\t66 66 2e 0f 1f 84 00 \tdata16 nopw %cs:0x0(%rax,%rax,1)\n    12bb:\t00 00 00 00 \n    12bf:\t90                   \tnop\n```\n\nå¯è§ï¼ŒO3å·²ç»æ²¡æœ‰ä»»ä½•ä¼˜åŒ–ç©ºé—´äº†ï¼Œ_builtin_expectçš„å­˜åœ¨æ„Ÿä¹Ÿå·²ç„¶æ˜¯0ã€‚\n\nè¿™æ¬¡çš„å®éªŒæ˜¯å¦å¤±è´¥å‘¢ï¼Œç»“æœä¸Šçœ‹èµ·æ¥çš„ç¡®å¦‚æ­¤ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰å°è¯•æ›´å¤šçš„å¹³å°ï¼ŒåŒæ—¶å„ä¸ªå¹³å°çš„ç‰ˆæœ¬æˆ–GCCçš„ç‰ˆæœ¬éƒ½å¯èƒ½å¯¹ç¼–è¯‘çš„ç»“æœé€ æˆä¸åŒçš„å½±å“ã€‚\n_builtin_expectåˆ°åº•æœ‰æ²¡æœ‰ç”¨ï¼Ÿæˆ‘èƒ½ç¡®ä¿¡çš„æ˜¯ï¼Œå†æ›´åŠ æ¿€è¿›çš„ä¼˜åŒ–ç­‰çº§ä¸‹ï¼Œ_builtin_expectçš„å­˜åœ¨æ„Ÿå¿…ç„¶æ˜¯ç¨€è–„çš„ã€‚ä½†æ˜¯GCCåœ¨é‡åˆ°_builtin_expectæ—¶å…·ä½“åšäº†äº›ä»€ä¹ˆï¼Œå¸Œæœ›æŸä¸€å¤©é˜…è¯»å®ŒGCCç›¸å…³çš„æºç åæ‰¾åˆ°ä¸€ä¸ªæ»¡æ„çš„ç­”æ¡ˆå§ï¼~\n","source":"_posts/åˆ†æ”¯é¢„æµ‹-GCC-builtin-expect.md","raw":"---\ntitle: åˆ†æ”¯é¢„æµ‹ GCC __builtin_expect æœ‰ç”¨å—ï¼Ÿ\ndate: 2020-12-14 22:57:18\ntags: \n    - C\n    - GCC\n    - ä»£ç ä¼˜åŒ–\ncategories :\n    - Technology\n---\n\næˆ‘ä»¬æ—¥å¸¸ç¼–å†™çš„ä»£ç ä¸­å¸¸è§çš„åˆ†æ”¯è¯­å¥ï¼Œè§£é‡Šè¡Œè¯­è¨€èƒ½å¤Ÿæ ¹æ®ä»£ç è¿è¡ŒæœŸé—´æ”¶é›†åˆ†æ”¯çš„è·³è½¬çš„è¶‹åŠ¿åŠ¨æ€ä¼˜åŒ–åˆ†æ”¯è·³è½¬ã€‚è€Œç¼–è¯‘è¨€è¯­ç”±äºç¼–è¯‘åç›´æ¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› æ­¤å¾ˆéš¾åœ¨ç¼–è¯‘æœŸæ¨æ–­å‡ºæœ€å¥½çš„ä¼˜åŒ–æ¡ä»¶ã€‚GCCä¸ºå¼€å‘è€…æä¾›äº†æ‰‹åŠ¨ä¼˜åŒ–åˆ†æ”¯é¢„æµ‹çš„æ–¹æ³•__builtin_expectï¼Œé€šè¿‡æ˜¾ç¤ºç¼–ç¨‹å‘ç¼–è¯‘å™¨æä¾›ä¼˜åŒ–å»ºè®®ä»è€Œä¼˜åŒ–åˆ†æ”¯çš„èµ°å‘ã€‚\n<!-- more -->\nç¼–è¯‘å™¨æ˜¯å¦‚ä½•å¤„ç†åˆ†æ”¯æ¡ä»¶çš„ï¼Ÿä½¿ç”¨__builtin_expectçš„åˆ†æ”¯æ˜¯å¦‚ä½•å¾—åˆ°ä¼˜åŒ–çš„ï¼Ÿä½¿ç”¨GCCé»˜è®¤çš„ä¼˜åŒ–çº§åˆ«ä¼šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ\n\nä¸ºäº†è§£å¼€è¿™äº›ç–‘æƒ‘ï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šä»£ç ã€‚\n\n* å¹³å° Ubuntu 20.04.1 LTS\n* å†…æ ¸ Linux b13a1870ebc6 5.4.39-linuxkit #1 SMP Fri May 8 23:03:06 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\n* ç¼–è¯‘å·¥å…· gcc (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0\n\n``` C\n#include <stdio.h>\n#include <stdlib.h>\n\n//xå¾ˆå¯èƒ½ä¸ºtrue\n#define likely(x) __builtin_expect(!!(x), 1)  \n//xå¾ˆå¯èƒ½ä¸ºfalse\n#define unlikely(x) __builtin_expect(!!(x), 0)\n\nvoid foo(){\n    printf(\"foo\\n\");\n}\nvoid foo1(){\n    printf(\"foo1\\n\");\n}\n\nvoid doLikely(int a){\n    \n    if(likely(a)){\n        foo();    \n    }else {\n        foo1();\n    }\n}\n\nvoid doLikelyNocall(int a){\n    int x;\n    if(likely(a)){\n        x = a*a;\n    }else {\n        x = a+a;\n    }\n}\n\nvoid doUnlikely(int a){\n    \n    if(unlikely(a)){\n        foo();\n    }else {\n        foo1();\n    }\n}\n\nvoid doUnlikelyNocall(int a){\n    int x;\n    if(unlikely(a)){\n        x = a*a;\n    }else {\n        x = a+a;\n    }\n}\n\nvoid normal(int a){\n    \n    if(a){\n        foo();\n    }else {\n        foo1();\n    }\n}\n\nvoid normalNocall(int a){\n    int x;\n    if(a){\n        x = a*a;\n    }else {\n        x = a+a;\n    }\n}\n\n\nint main(int argc, char **argv){\n    //ä¸ºäº†æ’é™¤å¸¸é‡å¯¼è‡´ç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œè¿™é‡Œä½¿ç”¨ä¸å®šå‚æ•°ä½œä¸ºå…¥å‚ï¼Œé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–ç›¸å…³ä»£ç \n    int a = atoi(argv[1]);\n    doLikely(a);\n    doUnlikely(a);\n    normal(a);\n    doLikelyNocall(a);\n    doUnlikelyNocall(a);\n    normalNocall(a);\n    return 0;\n}\n```\n\nå¼€å§‹ç¼–è¾‘ï¼Œè¿™é‡Œæ˜¾ç¤ºçš„æŒ‡å®š-O0 -O1 -O2 -O3è¿™å››ä¸ªä¼˜åŒ–ç­‰çº§ã€‚\n``` bash\nroot@b13a1870ebc6:/workspace_c/builtin_expect# gcc -O0 -o test_0 builtin_expect.c\nroot@b13a1870ebc6:/workspace_c/builtin_expect# gcc -O1 -o test_1 builtin_expect.c\nroot@b13a1870ebc6:/workspace_c/builtin_expect# gcc -O2 -o test_2 builtin_expect.c\nroot@b13a1870ebc6:/workspace_c/builtin_expect# gcc -O3 -o test_3 builtin_expect.c\n```\n\nå°†ç¼–è¯‘åçš„ç›®æ ‡æ–‡ä»¶åæ±‡ç¼–\n``` bash\nroot@b13a1870ebc6:/workspace_c/builtin_expect# objdump -d test_0 >test_0.a\nroot@b13a1870ebc6:/workspace_c/builtin_expect# objdump -d test_1 >test_1.a\nroot@b13a1870ebc6:/workspace_c/builtin_expect# objdump -d test_2 >test_2.a\nroot@b13a1870ebc6:/workspace_c/builtin_expect# objdump -d test_3 >test_3.a\n```\n\næœ€ç»ˆæˆ‘ä»¬å¾—åˆ°äº†4ä¸ªä¼˜åŒ–ç­‰çº§ä¸åŒçš„æ±‡ç¼–ä»£ç ï¼Œå¹¶ä¾æ¬¡å¯¹æ¯”ç›¸å…³é€»è¾‘ã€‚\n\n1.-O0ç­‰çº§ä¸‹ï¼Œç¼–è¯‘å™¨é»˜è®¤ä¸æ‰§è¡Œä»»ä½•ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯¹æ¯”åŸå§‹åˆ†æ”¯ä»£ç å’Œç»è¿‡__builtin_expectä¼˜åŒ–åçš„ä»£ç åœ¨æ±‡ç¼–ç ä¸Šæœ‰ä½•åŒºåˆ«ã€‚\n\n``` x86asm\n0000000000001197 <doLikely>:\n    1197:\tf3 0f 1e fa          \tendbr64 \n    119b:\t55                   \tpush   %rbp\n    119c:\t48 89 e5             \tmov    %rsp,%rbp\n    119f:\t48 83 ec 10          \tsub    $0x10,%rsp\n    11a3:\t89 7d fc             \tmov    %edi,-0x4(%rbp)      #å‚æ•°aå­˜æ”¾è‡³-0x4(%rbp)å¤„\n    11a6:\t83 7d fc 00          \tcmpl   $0x0,-0x4(%rbp)      #å‚æ•°aå’Œ0æ¯”è¾ƒ\n    11aa:\t0f 95 c0             \tsetne  %al                  #æ¡ä»¶è®¾ç½®ï¼Œalä¸­ä¿å­˜~ZFã€‚if a = 1 then al = 1 ; if a = 0 then al = 0\n    11ad:\t0f b6 c0             \tmovzbl %al,%eax             #eax = 0000000000000000 -> 00000000000000000000000000000000 or 0000000000000001 -> 00000000000000000000000000000001\n    11b0:\t48 85 c0             \ttest   %rax,%rax            #åˆ¤æ–­eaxæ˜¯å¦ä¸º0\n    11b3:\t74 0c                \tje     11c1 <doLikely+0x2a> #eax = 0(a = 0)æ—¶ï¼Œè·³è½¬è‡³11c1ï¼Œcall foo1\n    11b5:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    11ba:\te8 aa ff ff ff       \tcallq  1169 <foo>           #eax!=0(a = 0)æ—¶ï¼Œcall foo\n    11bf:\teb 0a                \tjmp    11cb <doLikely+0x34> #è·³è½¬è‡³11cbï¼Œç»“æŸ\n    11c1:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    11c6:\te8 b5 ff ff ff       \tcallq  1180 <foo1>\n    11cb:\t90                   \tnop\n    11cc:\tc9                   \tleaveq \n    11cd:\tc3                   \tretq   \n\n\n0000000000001265 <normal>:\n    1265:\tf3 0f 1e fa          \tendbr64 \n    1269:\t55                   \tpush   %rbp\n    126a:\t48 89 e5             \tmov    %rsp,%rbp\n    126d:\t48 83 ec 10          \tsub    $0x10,%rsp\n    1271:\t89 7d fc             \tmov    %edi,-0x4(%rbp)      #å‚æ•°aå­˜æ”¾è‡³-0x4(%rbp)å¤„\n    1274:\t83 7d fc 00          \tcmpl   $0x0,-0x4(%rbp)      #å‚æ•°aå’Œ0æ¯”è¾ƒ\n    1278:\t74 0c                \tje     1286 <normal+0x21>   #å¦‚æœa=0ï¼Œåˆ™è·³è½¬è‡³1286ï¼Œæ‰§è¡Œfoo1\n    127a:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    127f:\te8 e5 fe ff ff       \tcallq  1169 <foo>           #å¦‚æœa!=0,åˆ™æ‰§è¡Œfoo\n    1284:\teb 0a                \tjmp    1290 <normal+0x2b>   #è·³è½¬è‡³1290ï¼Œç»“æŸ\n    1286:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    128b:\te8 f0 fe ff ff       \tcallq  1180 <foo1>\n    1290:\t90                   \tnop\n    1291:\tc9                   \tleaveq \n    1292:\tc3                   \tretq   \n```\n\né€šè¿‡å¯¹æ¯”ï¼Œç»“æœä»¤äººæƒŠè®¶ã€‚è™½ç„¶æ‰§è¡Œç»“æœä¸€ç›´ï¼Œä½†æ˜¯æ²¡æœ‰ç»è¿‡_builtin_expectä¼˜åŒ–çš„åˆ†æ”¯åˆ¤æ–­ï¼Œåè€Œæ¯”æ ‡è¯†_builtin_expectçš„æ±‡ç¼–ä»£ç æ›´åŠ ç®€æ´ã€‚\n\nåˆ†æUnlikelyçš„æ±‡ç¼–ä»£ç ï¼Œä¹Ÿå­˜åœ¨åŒæ ·çš„é—®é¢˜ï¼Œç¼–è¯‘å™¨è²Œä¼¼ä¼šå¤šæ­¤ä¸€ä¸¾å¢åŠ ä¸€æ­¥çš„åˆ¤æ–­\n``` x86asm\n00000000000011fe <doUnlikely>:\n    11fe:\tf3 0f 1e fa          \tendbr64 \n    1202:\t55                   \tpush   %rbp\n    1203:\t48 89 e5             \tmov    %rsp,%rbp\n    1206:\t48 83 ec 10          \tsub    $0x10,%rsp\n    120a:\t89 7d fc             \tmov    %edi,-0x4(%rbp)\n    120d:\t83 7d fc 00          \tcmpl   $0x0,-0x4(%rbp)\n    1211:\t0f 95 c0             \tsetne  %al\n    1214:\t0f b6 c0             \tmovzbl %al,%eax\n    1217:\t48 85 c0             \ttest   %rax,%rax\n    121a:\t74 0c                \tje     1228 <doUnlikely+0x2a>\n    121c:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    1221:\te8 43 ff ff ff       \tcallq  1169 <foo>\n    1226:\teb 0a                \tjmp    1232 <doUnlikely+0x34>\n    1228:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    122d:\te8 4e ff ff ff       \tcallq  1180 <foo1>\n    1232:\t90                   \tnop\n    1233:\tc9                   \tleaveq \n    1234:\tc3                   \tretq   \n```\n\næ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå†™äº†ä¸ªéå†…éƒ¨è°ƒç”¨çš„ç‰ˆæœ¬ï¼Œç»“æœä¹Ÿæ˜¯åŒæ ·ã€‚ç¼–è¯‘å™¨æ²¡æœ‰å¯¹_builtin_expectåšå‡ºä¸ä¸€æ ·çš„ä¼˜åŒ–ã€‚\n\n``` x86asm\n00000000000011ce <doLikelyNocall>:\n    11ce:\tf3 0f 1e fa          \tendbr64 \n    11d2:\t55                   \tpush   %rbp\n    11d3:\t48 89 e5             \tmov    %rsp,%rbp\n    11d6:\t89 7d ec             \tmov    %edi,-0x14(%rbp)\n    11d9:\t83 7d ec 00          \tcmpl   $0x0,-0x14(%rbp)\n    11dd:\t0f 95 c0             \tsetne  %al\n    11e0:\t0f b6 c0             \tmovzbl %al,%eax\n    11e3:\t48 85 c0             \ttest   %rax,%rax\n    11e6:\t74 0b                \tje     11f3 <doLikelyNocall+0x25>\n    11e8:\t8b 45 ec             \tmov    -0x14(%rbp),%eax\n    11eb:\t0f af c0             \timul   %eax,%eax\n    11ee:\t89 45 fc             \tmov    %eax,-0x4(%rbp)\n    11f1:\teb 08                \tjmp    11fb <doLikelyNocall+0x2d>\n    11f3:\t8b 45 ec             \tmov    -0x14(%rbp),%eax\n    11f6:\t01 c0                \tadd    %eax,%eax\n    11f8:\t89 45 fc             \tmov    %eax,-0x4(%rbp)\n    11fb:\t90                   \tnop\n    11fc:\t5d                   \tpop    %rbp\n    11fd:\tc3                   \tretq   \n```\n\n2.ä¸ºäº†äº†è§£_builtin_expectæ˜¯å¦çœŸçš„æœ‰ç”¨ï¼Œæˆ‘ä»¬å†çœ‹çœ‹å…¶ä»–ä¼˜åŒ–ç­‰çº§ -O1ã€‚\n\n``` x86asm\n000000000000119b <doLikely>:\n    119b:\tf3 0f 1e fa          \tendbr64 \n    119f:\t48 83 ec 08          \tsub    $0x8,%rsp\n    11a3:\t85 ff                \ttest   %edi,%edi\n    11a5:\t74 0f                \tje     11b6 <doLikely+0x1b>\n    11a7:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    11ac:\te8 b8 ff ff ff       \tcallq  1169 <foo>\n    11b1:\t48 83 c4 08          \tadd    $0x8,%rsp\n    11b5:\tc3                   \tretq   \n    11b6:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    11bb:\te8 c2 ff ff ff       \tcallq  1182 <foo1>\n    11c0:\teb ef                \tjmp    11b1 <doLikely+0x16>\n\n00000000000011f3 <normal>:\n    11f3:\tf3 0f 1e fa          \tendbr64 \n    11f7:\t48 83 ec 08          \tsub    $0x8,%rsp\n    11fb:\t85 ff                \ttest   %edi,%edi\n    11fd:\t74 0f                \tje     120e <normal+0x1b>\n    11ff:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    1204:\te8 60 ff ff ff       \tcallq  1169 <foo>\n    1209:\t48 83 c4 08          \tadd    $0x8,%rsp\n    120d:\tc3                   \tretq   \n    120e:\tb8 00 00 00 00       \tmov    $0x0,%eax\n    1213:\te8 6a ff ff ff       \tcallq  1182 <foo1>\n    1218:\teb ef                \tjmp    1209 <normal+0x16>\n\n00000000000011ee <doUnlikelyNocall>:\n    11ee:\tf3 0f 1e fa          \tendbr64 \n    11f2:\tc3                   \tretq   \n```\n\nè§‚å¯Ÿ-O1ä¼˜åŒ–åçš„æ±‡ç¼–ä»£ç ï¼Œä»£ç é£æ ¼æœ‰äº†è´¨çš„é£è¶Šã€‚å»é™¤äº†å…¬å¼åŒ–çš„å‚æ•°ä¼ é€’ï¼Œè´¹åŠ²çš„å€¼æ¯”è¾ƒã€‚ä½†æ˜¯ä¾ç„¶æ²¡æœ‰ä½“ç°å‡º_builtin_expectæœ‰æ²¡æœ‰çš„åŒºåˆ«ã€‚\nåŒæ ·çš„ï¼Œæˆ‘ä»¬çš„éè°ƒç”¨ç‰ˆæœ¬ç”±äºæ— è¿”å›å€¼ï¼Œå·²ç»è¢«ç¼–è¯‘å™¨å®Œå…¨ä¼˜åŒ–æ‰äº†ã€‚\n\næˆ‘ä»¬å†çœ‹çœ‹-O2ã€‚\n\n``` x86asm\n0000000000001210 <doLikely>:\n    1210:\tf3 0f 1e fa          \tendbr64 \n    1214:\t85 ff                \ttest   %edi,%edi\n    1216:\t74 10                \tje     1228 <doLikely+0x18>\n    1218:\t48 8d 3d e5 0d 00 00 \tlea    0xde5(%rip),%rdi        # 2004 <_IO_stdin_used+0x4>\n    121f:\te9 3c fe ff ff       \tjmpq   1060 <puts@plt>\n    1224:\t0f 1f 40 00          \tnopl   0x0(%rax)\n    1228:\t48 8d 3d d9 0d 00 00 \tlea    0xdd9(%rip),%rdi        # 2008 <_IO_stdin_used+0x8>\n    122f:\te9 2c fe ff ff       \tjmpq   1060 <puts@plt>\n    1234:\t66 66 2e 0f 1f 84 00 \tdata16 nopw %cs:0x0(%rax,%rax,1)\n    123b:\t00 00 00 00 \n    123f:\t90                   \tnop\n\n0000000000001290 <normal>:\n    1290:\tf3 0f 1e fa          \tendbr64 \n    1294:\t85 ff                \ttest   %edi,%edi\n    1296:\t74 10                \tje     12a8 <normal+0x18>\n    1298:\t48 8d 3d 65 0d 00 00 \tlea    0xd65(%rip),%rdi        # 2004 <_IO_stdin_used+0x4>\n    129f:\te9 bc fd ff ff       \tjmpq   1060 <puts@plt>\n    12a4:\t0f 1f 40 00          \tnopl   0x0(%rax)\n    12a8:\t48 8d 3d 59 0d 00 00 \tlea    0xd59(%rip),%rdi        # 2008 <_IO_stdin_used+0x8>\n    12af:\te9 ac fd ff ff       \tjmpq   1060 <puts@plt>\n    12b4:\t66 66 2e 0f 1f 84 00 \tdata16 nopw %cs:0x0(%rax,%rax,1)\n    12bb:\t00 00 00 00 \n    12bf:\t90                   \tnop\n```\n\nä»£ç è¿›ä¸€æ­¥çš„è¢«ä¼˜åŒ–ï¼Œä»æ±‡ç¼–ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ–¹æ³•è°ƒç”¨å®Œå…¨ä¼˜åŒ–æ‰äº†æ ˆä¸Šè°ƒç”¨ã€‚å»é™¤äº†æ ˆä¸Šä¼ é€’ï¼Œå°†callæŒ‡ä»¤å˜ä¸ºäº†jmpæŒ‡ä»¤ï¼Œè¿›ä¸€æ­¥å‡å°‘äº†æŒ‡ä»¤ä¸Šçš„å¼€é”€ã€‚\nä½†ç»“æœä»ç„¶æ²¡æœ‰æ”¹å˜ï¼Œ_builtin_expectä¾ç„¶æ²¡æœ‰å‘å…‰å‘çƒ­ã€‚\n\næœ€åæˆ‘ä»¬åªèƒ½æŠŠå¸Œæœ›å¯„æ‰˜äº-O3ä¸Šçœ‹çœ‹äº†ã€‚\n\n``` x86asm\n0000000000001210 <doLikely>:\n    1210:\tf3 0f 1e fa          \tendbr64 \n    1214:\t85 ff                \ttest   %edi,%edi\n    1216:\t74 10                \tje     1228 <doLikely+0x18>\n    1218:\t48 8d 3d e5 0d 00 00 \tlea    0xde5(%rip),%rdi        # 2004 <_IO_stdin_used+0x4>\n    121f:\te9 3c fe ff ff       \tjmpq   1060 <puts@plt>\n    1224:\t0f 1f 40 00          \tnopl   0x0(%rax)\n    1228:\t48 8d 3d d9 0d 00 00 \tlea    0xdd9(%rip),%rdi        # 2008 <_IO_stdin_used+0x8>\n    122f:\te9 2c fe ff ff       \tjmpq   1060 <puts@plt>\n    1234:\t66 66 2e 0f 1f 84 00 \tdata16 nopw %cs:0x0(%rax,%rax,1)\n    123b:\t00 00 00 00 \n    123f:\t90                   \tnop\n\n0000000000001290 <normal>:\n    1290:\tf3 0f 1e fa          \tendbr64 \n    1294:\t85 ff                \ttest   %edi,%edi\n    1296:\t74 10                \tje     12a8 <normal+0x18>\n    1298:\t48 8d 3d 65 0d 00 00 \tlea    0xd65(%rip),%rdi        # 2004 <_IO_stdin_used+0x4>\n    129f:\te9 bc fd ff ff       \tjmpq   1060 <puts@plt>\n    12a4:\t0f 1f 40 00          \tnopl   0x0(%rax)\n    12a8:\t48 8d 3d 59 0d 00 00 \tlea    0xd59(%rip),%rdi        # 2008 <_IO_stdin_used+0x8>\n    12af:\te9 ac fd ff ff       \tjmpq   1060 <puts@plt>\n    12b4:\t66 66 2e 0f 1f 84 00 \tdata16 nopw %cs:0x0(%rax,%rax,1)\n    12bb:\t00 00 00 00 \n    12bf:\t90                   \tnop\n```\n\nå¯è§ï¼ŒO3å·²ç»æ²¡æœ‰ä»»ä½•ä¼˜åŒ–ç©ºé—´äº†ï¼Œ_builtin_expectçš„å­˜åœ¨æ„Ÿä¹Ÿå·²ç„¶æ˜¯0ã€‚\n\nè¿™æ¬¡çš„å®éªŒæ˜¯å¦å¤±è´¥å‘¢ï¼Œç»“æœä¸Šçœ‹èµ·æ¥çš„ç¡®å¦‚æ­¤ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰å°è¯•æ›´å¤šçš„å¹³å°ï¼ŒåŒæ—¶å„ä¸ªå¹³å°çš„ç‰ˆæœ¬æˆ–GCCçš„ç‰ˆæœ¬éƒ½å¯èƒ½å¯¹ç¼–è¯‘çš„ç»“æœé€ æˆä¸åŒçš„å½±å“ã€‚\n_builtin_expectåˆ°åº•æœ‰æ²¡æœ‰ç”¨ï¼Ÿæˆ‘èƒ½ç¡®ä¿¡çš„æ˜¯ï¼Œå†æ›´åŠ æ¿€è¿›çš„ä¼˜åŒ–ç­‰çº§ä¸‹ï¼Œ_builtin_expectçš„å­˜åœ¨æ„Ÿå¿…ç„¶æ˜¯ç¨€è–„çš„ã€‚ä½†æ˜¯GCCåœ¨é‡åˆ°_builtin_expectæ—¶å…·ä½“åšäº†äº›ä»€ä¹ˆï¼Œå¸Œæœ›æŸä¸€å¤©é˜…è¯»å®ŒGCCç›¸å…³çš„æºç åæ‰¾åˆ°ä¸€ä¸ªæ»¡æ„çš„ç­”æ¡ˆå§ï¼~\n","slug":"åˆ†æ”¯é¢„æµ‹-GCC-builtin-expect","published":1,"updated":"2020-12-17T01:55:53.102Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htf000rv2524z0l9tfk","content":"<html><head></head><body><p>&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x7F16;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x5E38;&#x89C1;&#x7684;&#x5206;&#x652F;&#x8BED;&#x53E5;&#xFF0C;&#x89E3;&#x91CA;&#x884C;&#x8BED;&#x8A00;&#x80FD;&#x591F;&#x6839;&#x636E;&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x671F;&#x95F4;&#x6536;&#x96C6;&#x5206;&#x652F;&#x7684;&#x8DF3;&#x8F6C;&#x7684;&#x8D8B;&#x52BF;&#x52A8;&#x6001;&#x4F18;&#x5316;&#x5206;&#x652F;&#x8DF3;&#x8F6C;&#x3002;&#x800C;&#x7F16;&#x8BD1;&#x8A00;&#x8BED;&#x7531;&#x4E8E;&#x7F16;&#x8BD1;&#x540E;&#x76F4;&#x63A5;&#x751F;&#x6210;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x5F88;&#x96BE;&#x5728;&#x7F16;&#x8BD1;&#x671F;&#x63A8;&#x65AD;&#x51FA;&#x6700;&#x597D;&#x7684;&#x4F18;&#x5316;&#x6761;&#x4EF6;&#x3002;GCC&#x4E3A;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x4F9B;&#x4E86;&#x624B;&#x52A8;&#x4F18;&#x5316;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x7684;&#x65B9;&#x6CD5;__builtin_expect&#xFF0C;&#x901A;&#x8FC7;&#x663E;&#x793A;&#x7F16;&#x7A0B;&#x5411;&#x7F16;&#x8BD1;&#x5668;&#x63D0;&#x4F9B;&#x4F18;&#x5316;&#x5EFA;&#x8BAE;&#x4ECE;&#x800C;&#x4F18;&#x5316;&#x5206;&#x652F;&#x7684;&#x8D70;&#x5411;&#x3002;</p>\n<a id=\"more\"></a>\n<p>&#x7F16;&#x8BD1;&#x5668;&#x662F;&#x5982;&#x4F55;&#x5904;&#x7406;&#x5206;&#x652F;&#x6761;&#x4EF6;&#x7684;&#xFF1F;&#x4F7F;&#x7528;__builtin_expect&#x7684;&#x5206;&#x652F;&#x662F;&#x5982;&#x4F55;&#x5F97;&#x5230;&#x4F18;&#x5316;&#x7684;&#xFF1F;&#x4F7F;&#x7528;GCC&#x9ED8;&#x8BA4;&#x7684;&#x4F18;&#x5316;&#x7EA7;&#x522B;&#x4F1A;&#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;</p>\n<p>&#x4E3A;&#x4E86;&#x89E3;&#x5F00;&#x8FD9;&#x4E9B;&#x7591;&#x60D1;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x4E0A;&#x4EE3;&#x7801;&#x3002;</p>\n<ul>\n<li>&#x5E73;&#x53F0; Ubuntu 20.04.1 LTS</li>\n<li>&#x5185;&#x6838; Linux b13a1870ebc6 5.4.39-linuxkit #1 SMP Fri May 8 23:03:06 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</li>\n<li>&#x7F16;&#x8BD1;&#x5DE5;&#x5177; gcc (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0</li>\n</ul>\n<figure class=\"highlight c hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">include</span> <span class=\"hljs-meta-string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//x&#x5F88;&#x53EF;&#x80FD;&#x4E3A;true</span></span><br><span class=\"line\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">define</span> likely(x) __builtin_expect(!!(x), 1)  </span></span><br><span class=\"line\"><span class=\"hljs-comment\">//x&#x5F88;&#x53EF;&#x80FD;&#x4E3A;false</span></span><br><span class=\"line\"><span class=\"hljs-meta\">#<span class=\"hljs-meta-keyword\">define</span> unlikely(x) __builtin_expect(!!(x), 0)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">foo</span><span class=\"hljs-params\">()</span></span>{</span><br><span class=\"line\">    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;foo\\n&quot;</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">foo1</span><span class=\"hljs-params\">()</span></span>{</span><br><span class=\"line\">    <span class=\"hljs-built_in\">printf</span>(<span class=\"hljs-string\">&quot;foo1\\n&quot;</span>);</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">doLikely</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> a)</span></span>{</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span>(likely(a)){</span><br><span class=\"line\">        foo();    </span><br><span class=\"line\">    }<span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">        foo1();</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">doLikelyNocall</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> a)</span></span>{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">int</span> x;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span>(likely(a)){</span><br><span class=\"line\">        x = a*a;</span><br><span class=\"line\">    }<span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">        x = a+a;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">doUnlikely</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> a)</span></span>{</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span>(unlikely(a)){</span><br><span class=\"line\">        foo();</span><br><span class=\"line\">    }<span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">        foo1();</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">doUnlikelyNocall</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> a)</span></span>{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">int</span> x;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span>(unlikely(a)){</span><br><span class=\"line\">        x = a*a;</span><br><span class=\"line\">    }<span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">        x = a+a;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">normal</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> a)</span></span>{</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span>(a){</span><br><span class=\"line\">        foo();</span><br><span class=\"line\">    }<span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">        foo1();</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">normalNocall</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> a)</span></span>{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">int</span> x;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span>(a){</span><br><span class=\"line\">        x = a*a;</span><br><span class=\"line\">    }<span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">        x = a+a;</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> argc, <span class=\"hljs-keyword\">char</span> **argv)</span></span>{</span><br><span class=\"line\">    <span class=\"hljs-comment\">//&#x4E3A;&#x4E86;&#x6392;&#x9664;&#x5E38;&#x91CF;&#x5BFC;&#x81F4;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x4F18;&#x5316;&#xFF0C;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E0D;&#x5B9A;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x5165;&#x53C2;&#xFF0C;&#x9632;&#x6B62;&#x7F16;&#x8BD1;&#x5668;&#x4F18;&#x5316;&#x76F8;&#x5173;&#x4EE3;&#x7801;</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">int</span> a = atoi(argv[<span class=\"hljs-number\">1</span>]);</span><br><span class=\"line\">    doLikely(a);</span><br><span class=\"line\">    doUnlikely(a);</span><br><span class=\"line\">    normal(a);</span><br><span class=\"line\">    doLikelyNocall(a);</span><br><span class=\"line\">    doUnlikelyNocall(a);</span><br><span class=\"line\">    normalNocall(a);</span><br><span class=\"line\">    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x5F00;&#x59CB;&#x7F16;&#x8F91;&#xFF0C;&#x8FD9;&#x91CC;&#x663E;&#x793A;&#x7684;&#x6307;&#x5B9A;-O0 -O1 -O2 -O3&#x8FD9;&#x56DB;&#x4E2A;&#x4F18;&#x5316;&#x7B49;&#x7EA7;&#x3002;</p>\n<figure class=\"highlight bash hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"hljs-comment\"># gcc -O0 -o test_0 builtin_expect.c</span></span><br><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"hljs-comment\"># gcc -O1 -o test_1 builtin_expect.c</span></span><br><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"hljs-comment\"># gcc -O2 -o test_2 builtin_expect.c</span></span><br><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"hljs-comment\"># gcc -O3 -o test_3 builtin_expect.c</span></span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x5C06;&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x76EE;&#x6807;&#x6587;&#x4EF6;&#x53CD;&#x6C47;&#x7F16;</p>\n<figure class=\"highlight bash hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"hljs-comment\"># objdump -d test_0 &gt;test_0.a</span></span><br><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"hljs-comment\"># objdump -d test_1 &gt;test_1.a</span></span><br><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"hljs-comment\"># objdump -d test_2 &gt;test_2.a</span></span><br><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"hljs-comment\"># objdump -d test_3 &gt;test_3.a</span></span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x6700;&#x7EC8;&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x4E86;4&#x4E2A;&#x4F18;&#x5316;&#x7B49;&#x7EA7;&#x4E0D;&#x540C;&#x7684;&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#xFF0C;&#x5E76;&#x4F9D;&#x6B21;&#x5BF9;&#x6BD4;&#x76F8;&#x5173;&#x903B;&#x8F91;&#x3002;</p>\n<p>1.-O0&#x7B49;&#x7EA7;&#x4E0B;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x9ED8;&#x8BA4;&#x4E0D;&#x6267;&#x884C;&#x4EFB;&#x4F55;&#x4F18;&#x5316;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x6BD4;&#x539F;&#x59CB;&#x5206;&#x652F;&#x4EE3;&#x7801;&#x548C;&#x7ECF;&#x8FC7;__builtin_expect&#x4F18;&#x5316;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x5728;&#x6C47;&#x7F16;&#x7801;&#x4E0A;&#x6709;&#x4F55;&#x533A;&#x522B;&#x3002;</p>\n<figure class=\"highlight x86asm hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-number\">0000000000001197</span> &lt;doLikely&gt;:</span><br><span class=\"line\">    <span class=\"hljs-number\">1197</span>:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    119b:\t<span class=\"hljs-number\">55</span>                   \t<span class=\"hljs-keyword\">push</span>   %rbp</span><br><span class=\"line\">    119c:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">89</span> e5             \t<span class=\"hljs-keyword\">mov</span>    %rsp,%rbp</span><br><span class=\"line\">    119f:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">83</span> ec <span class=\"hljs-number\">10</span>          \t<span class=\"hljs-keyword\">sub</span>    <span class=\"hljs-number\">$0</span>x10,%rsp</span><br><span class=\"line\">    11a3:\t<span class=\"hljs-number\">89</span> <span class=\"hljs-number\">7d</span> fc             \t<span class=\"hljs-keyword\">mov</span>    %edi,-<span class=\"hljs-number\">0x4</span>(%rbp)      #&#x53C2;&#x6570;a&#x5B58;&#x653E;&#x81F3;-<span class=\"hljs-number\">0x4</span>(%rbp)&#x5904;</span><br><span class=\"line\">    11a6:\t<span class=\"hljs-number\">83</span> <span class=\"hljs-number\">7d</span> fc <span class=\"hljs-number\">00</span>          \tcmpl   <span class=\"hljs-number\">$0</span>x0,-<span class=\"hljs-number\">0x4</span>(%rbp)      #&#x53C2;&#x6570;a&#x548C;<span class=\"hljs-number\">0</span>&#x6BD4;&#x8F83;</span><br><span class=\"line\">    11aa:\t0f <span class=\"hljs-number\">95</span> c0             \t<span class=\"hljs-keyword\">setne</span>  %al                  #&#x6761;&#x4EF6;&#x8BBE;&#x7F6E;&#xFF0C;<span class=\"hljs-built_in\">al</span>&#x4E2D;&#x4FDD;&#x5B58;~ZF&#x3002;if a = <span class=\"hljs-number\">1</span> then <span class=\"hljs-built_in\">al</span> = <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">; if a = 0 then al = 0</span></span><br><span class=\"line\">    11ad:\t0f b6 c0             \tmovzbl %al,%eax             #<span class=\"hljs-built_in\">eax</span> = <span class=\"hljs-number\">0000000000000000</span> -&gt; <span class=\"hljs-number\">00000000000000000000000000000000</span> <span class=\"hljs-keyword\">or</span> <span class=\"hljs-number\">0000000000000001</span> -&gt; <span class=\"hljs-number\">00000000000000000000000000000001</span></span><br><span class=\"line\">    11b0:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">85</span> c0             \t<span class=\"hljs-keyword\">test</span>   %rax,%rax            #&#x5224;&#x65AD;<span class=\"hljs-built_in\">eax</span>&#x662F;&#x5426;&#x4E3A;<span class=\"hljs-number\">0</span></span><br><span class=\"line\">    11b3:\t<span class=\"hljs-number\">74</span> 0c                \t<span class=\"hljs-keyword\">je</span>     11c1 &lt;doLikely+<span class=\"hljs-number\">0x2a</span>&gt; #<span class=\"hljs-built_in\">eax</span> = <span class=\"hljs-number\">0</span>(a = <span class=\"hljs-number\">0</span>)&#x65F6;&#xFF0C;&#x8DF3;&#x8F6C;&#x81F3;11c1&#xFF0C;<span class=\"hljs-keyword\">call</span> foo1</span><br><span class=\"line\">    11b5:\tb8 <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       \t<span class=\"hljs-keyword\">mov</span>    <span class=\"hljs-number\">$0</span>x0,%eax</span><br><span class=\"line\">    11ba:\te8 aa ff ff ff       \tcallq  <span class=\"hljs-number\">1169</span> &lt;foo&gt;           #<span class=\"hljs-built_in\">eax</span>!=<span class=\"hljs-number\">0</span>(a = <span class=\"hljs-number\">0</span>)&#x65F6;&#xFF0C;<span class=\"hljs-keyword\">call</span> foo</span><br><span class=\"line\">    11bf:\teb 0a                \t<span class=\"hljs-keyword\">jmp</span>    11cb &lt;doLikely+<span class=\"hljs-number\">0x34</span>&gt; #&#x8DF3;&#x8F6C;&#x81F3;11cb&#xFF0C;&#x7ED3;&#x675F;</span><br><span class=\"line\">    11c1:\tb8 <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       \t<span class=\"hljs-keyword\">mov</span>    <span class=\"hljs-number\">$0</span>x0,%eax</span><br><span class=\"line\">    11c6:\te8 b5 ff ff ff       \tcallq  <span class=\"hljs-number\">1180</span> &lt;foo1&gt;</span><br><span class=\"line\">    11cb:\t<span class=\"hljs-number\">90</span>                   \t<span class=\"hljs-keyword\">nop</span></span><br><span class=\"line\">    11cc:\tc9                   \tleaveq </span><br><span class=\"line\">    11cd:\tc3                   \tretq   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-number\">0000000000001265</span> &lt;normal&gt;:</span><br><span class=\"line\">    <span class=\"hljs-number\">1265</span>:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    <span class=\"hljs-number\">1269</span>:\t<span class=\"hljs-number\">55</span>                   \t<span class=\"hljs-keyword\">push</span>   %rbp</span><br><span class=\"line\">    126a:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">89</span> e5             \t<span class=\"hljs-keyword\">mov</span>    %rsp,%rbp</span><br><span class=\"line\">    <span class=\"hljs-number\">126d</span>:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">83</span> ec <span class=\"hljs-number\">10</span>          \t<span class=\"hljs-keyword\">sub</span>    <span class=\"hljs-number\">$0</span>x10,%rsp</span><br><span class=\"line\">    <span class=\"hljs-number\">1271</span>:\t<span class=\"hljs-number\">89</span> <span class=\"hljs-number\">7d</span> fc             \t<span class=\"hljs-keyword\">mov</span>    %edi,-<span class=\"hljs-number\">0x4</span>(%rbp)      #&#x53C2;&#x6570;a&#x5B58;&#x653E;&#x81F3;-<span class=\"hljs-number\">0x4</span>(%rbp)&#x5904;</span><br><span class=\"line\">    <span class=\"hljs-number\">1274</span>:\t<span class=\"hljs-number\">83</span> <span class=\"hljs-number\">7d</span> fc <span class=\"hljs-number\">00</span>          \tcmpl   <span class=\"hljs-number\">$0</span>x0,-<span class=\"hljs-number\">0x4</span>(%rbp)      #&#x53C2;&#x6570;a&#x548C;<span class=\"hljs-number\">0</span>&#x6BD4;&#x8F83;</span><br><span class=\"line\">    <span class=\"hljs-number\">1278</span>:\t<span class=\"hljs-number\">74</span> 0c                \t<span class=\"hljs-keyword\">je</span>     <span class=\"hljs-number\">1286</span> &lt;normal+<span class=\"hljs-number\">0x21</span>&gt;   #&#x5982;&#x679C;a=<span class=\"hljs-number\">0</span>&#xFF0C;&#x5219;&#x8DF3;&#x8F6C;&#x81F3;<span class=\"hljs-number\">1286</span>&#xFF0C;&#x6267;&#x884C;foo1</span><br><span class=\"line\">    127a:\tb8 <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       \t<span class=\"hljs-keyword\">mov</span>    <span class=\"hljs-number\">$0</span>x0,%eax</span><br><span class=\"line\">    127f:\te8 e5 fe ff ff       \tcallq  <span class=\"hljs-number\">1169</span> &lt;foo&gt;           #&#x5982;&#x679C;a!=<span class=\"hljs-number\">0</span>,&#x5219;&#x6267;&#x884C;foo</span><br><span class=\"line\">    <span class=\"hljs-number\">1284</span>:\teb 0a                \t<span class=\"hljs-keyword\">jmp</span>    <span class=\"hljs-number\">1290</span> &lt;normal+<span class=\"hljs-number\">0x2b</span>&gt;   #&#x8DF3;&#x8F6C;&#x81F3;<span class=\"hljs-number\">1290</span>&#xFF0C;&#x7ED3;&#x675F;</span><br><span class=\"line\">    <span class=\"hljs-number\">1286</span>:\tb8 <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       \t<span class=\"hljs-keyword\">mov</span>    <span class=\"hljs-number\">$0</span>x0,%eax</span><br><span class=\"line\">    128b:\te8 f0 fe ff ff       \tcallq  <span class=\"hljs-number\">1180</span> &lt;foo1&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1290</span>:\t<span class=\"hljs-number\">90</span>                   \t<span class=\"hljs-keyword\">nop</span></span><br><span class=\"line\">    <span class=\"hljs-number\">1291</span>:\tc9                   \tleaveq </span><br><span class=\"line\">    <span class=\"hljs-number\">1292</span>:\tc3                   \tretq   </span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x901A;&#x8FC7;&#x5BF9;&#x6BD4;&#xFF0C;&#x7ED3;&#x679C;&#x4EE4;&#x4EBA;&#x60CA;&#x8BB6;&#x3002;&#x867D;&#x7136;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x4E00;&#x76F4;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x7ECF;&#x8FC7;_builtin_expect&#x4F18;&#x5316;&#x7684;&#x5206;&#x652F;&#x5224;&#x65AD;&#xFF0C;&#x53CD;&#x800C;&#x6BD4;&#x6807;&#x8BC6;_builtin_expect&#x7684;&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#x66F4;&#x52A0;&#x7B80;&#x6D01;&#x3002;</p>\n<p>&#x5206;&#x6790;Unlikely&#x7684;&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#xFF0C;&#x4E5F;&#x5B58;&#x5728;&#x540C;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x8C8C;&#x4F3C;&#x4F1A;&#x591A;&#x6B64;&#x4E00;&#x4E3E;&#x589E;&#x52A0;&#x4E00;&#x6B65;&#x7684;&#x5224;&#x65AD;</p>\n<figure class=\"highlight x86asm hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00000000000011fe &lt;doUnlikely&gt;:</span><br><span class=\"line\">    11fe:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    <span class=\"hljs-number\">1202</span>:\t<span class=\"hljs-number\">55</span>                   \t<span class=\"hljs-keyword\">push</span>   %rbp</span><br><span class=\"line\">    <span class=\"hljs-number\">1203</span>:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">89</span> e5             \t<span class=\"hljs-keyword\">mov</span>    %rsp,%rbp</span><br><span class=\"line\">    <span class=\"hljs-number\">1206</span>:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">83</span> ec <span class=\"hljs-number\">10</span>          \t<span class=\"hljs-keyword\">sub</span>    <span class=\"hljs-number\">$0</span>x10,%rsp</span><br><span class=\"line\">    120a:\t<span class=\"hljs-number\">89</span> <span class=\"hljs-number\">7d</span> fc             \t<span class=\"hljs-keyword\">mov</span>    %edi,-<span class=\"hljs-number\">0x4</span>(%rbp)</span><br><span class=\"line\">    <span class=\"hljs-number\">120d</span>:\t<span class=\"hljs-number\">83</span> <span class=\"hljs-number\">7d</span> fc <span class=\"hljs-number\">00</span>          \tcmpl   <span class=\"hljs-number\">$0</span>x0,-<span class=\"hljs-number\">0x4</span>(%rbp)</span><br><span class=\"line\">    <span class=\"hljs-number\">1211</span>:\t0f <span class=\"hljs-number\">95</span> c0             \t<span class=\"hljs-keyword\">setne</span>  %al</span><br><span class=\"line\">    <span class=\"hljs-number\">1214</span>:\t0f b6 c0             \tmovzbl %al,%eax</span><br><span class=\"line\">    <span class=\"hljs-number\">1217</span>:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">85</span> c0             \t<span class=\"hljs-keyword\">test</span>   %rax,%rax</span><br><span class=\"line\">    121a:\t<span class=\"hljs-number\">74</span> 0c                \t<span class=\"hljs-keyword\">je</span>     <span class=\"hljs-number\">1228</span> &lt;doUnlikely+<span class=\"hljs-number\">0x2a</span>&gt;</span><br><span class=\"line\">    121c:\tb8 <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       \t<span class=\"hljs-keyword\">mov</span>    <span class=\"hljs-number\">$0</span>x0,%eax</span><br><span class=\"line\">    <span class=\"hljs-number\">1221</span>:\te8 <span class=\"hljs-number\">43</span> ff ff ff       \tcallq  <span class=\"hljs-number\">1169</span> &lt;foo&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1226</span>:\teb 0a                \t<span class=\"hljs-keyword\">jmp</span>    <span class=\"hljs-number\">1232</span> &lt;doUnlikely+<span class=\"hljs-number\">0x34</span>&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1228</span>:\tb8 <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       \t<span class=\"hljs-keyword\">mov</span>    <span class=\"hljs-number\">$0</span>x0,%eax</span><br><span class=\"line\">    <span class=\"hljs-number\">122d</span>:\te8 4e ff ff ff       \tcallq  <span class=\"hljs-number\">1180</span> &lt;foo1&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1232</span>:\t<span class=\"hljs-number\">90</span>                   \t<span class=\"hljs-keyword\">nop</span></span><br><span class=\"line\">    <span class=\"hljs-number\">1233</span>:\tc9                   \tleaveq </span><br><span class=\"line\">    <span class=\"hljs-number\">1234</span>:\tc3                   \tretq   </span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x6B64;&#x5916;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x5199;&#x4E86;&#x4E2A;&#x975E;&#x5185;&#x90E8;&#x8C03;&#x7528;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x7ED3;&#x679C;&#x4E5F;&#x662F;&#x540C;&#x6837;&#x3002;&#x7F16;&#x8BD1;&#x5668;&#x6CA1;&#x6709;&#x5BF9;_builtin_expect&#x505A;&#x51FA;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x4F18;&#x5316;&#x3002;</p>\n<figure class=\"highlight x86asm hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00000000000011ce &lt;doLikelyNocall&gt;:</span><br><span class=\"line\">    11ce:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    11d2:\t<span class=\"hljs-number\">55</span>                   \t<span class=\"hljs-keyword\">push</span>   %rbp</span><br><span class=\"line\">    11d3:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">89</span> e5             \t<span class=\"hljs-keyword\">mov</span>    %rsp,%rbp</span><br><span class=\"line\">    11d6:\t<span class=\"hljs-number\">89</span> <span class=\"hljs-number\">7d</span> ec             \t<span class=\"hljs-keyword\">mov</span>    %edi,-<span class=\"hljs-number\">0x14</span>(%rbp)</span><br><span class=\"line\">    11d9:\t<span class=\"hljs-number\">83</span> <span class=\"hljs-number\">7d</span> ec <span class=\"hljs-number\">00</span>          \tcmpl   <span class=\"hljs-number\">$0</span>x0,-<span class=\"hljs-number\">0x14</span>(%rbp)</span><br><span class=\"line\">    11<span class=\"hljs-built_in\">dd</span>:\t0f <span class=\"hljs-number\">95</span> c0             \t<span class=\"hljs-keyword\">setne</span>  %al</span><br><span class=\"line\">    11e0:\t0f b6 c0             \tmovzbl %al,%eax</span><br><span class=\"line\">    11e3:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">85</span> c0             \t<span class=\"hljs-keyword\">test</span>   %rax,%rax</span><br><span class=\"line\">    11e6:\t<span class=\"hljs-number\">74</span> <span class=\"hljs-number\">0b</span>                \t<span class=\"hljs-keyword\">je</span>     11f3 &lt;doLikelyNocall+<span class=\"hljs-number\">0x25</span>&gt;</span><br><span class=\"line\">    11e8:\t8b <span class=\"hljs-number\">45</span> ec             \t<span class=\"hljs-keyword\">mov</span>    -<span class=\"hljs-number\">0x14</span>(%rbp),%eax</span><br><span class=\"line\">    11eb:\t0f af c0             \t<span class=\"hljs-keyword\">imul</span>   %eax,%eax</span><br><span class=\"line\">    11ee:\t<span class=\"hljs-number\">89</span> <span class=\"hljs-number\">45</span> fc             \t<span class=\"hljs-keyword\">mov</span>    %eax,-<span class=\"hljs-number\">0x4</span>(%rbp)</span><br><span class=\"line\">    11f1:\teb <span class=\"hljs-number\">08</span>                \t<span class=\"hljs-keyword\">jmp</span>    11fb &lt;doLikelyNocall+<span class=\"hljs-number\">0x2d</span>&gt;</span><br><span class=\"line\">    11f3:\t8b <span class=\"hljs-number\">45</span> ec             \t<span class=\"hljs-keyword\">mov</span>    -<span class=\"hljs-number\">0x14</span>(%rbp),%eax</span><br><span class=\"line\">    11f6:\t<span class=\"hljs-number\">01</span> c0                \t<span class=\"hljs-keyword\">add</span>    %eax,%eax</span><br><span class=\"line\">    11f8:\t<span class=\"hljs-number\">89</span> <span class=\"hljs-number\">45</span> fc             \t<span class=\"hljs-keyword\">mov</span>    %eax,-<span class=\"hljs-number\">0x4</span>(%rbp)</span><br><span class=\"line\">    11fb:\t<span class=\"hljs-number\">90</span>                   \t<span class=\"hljs-keyword\">nop</span></span><br><span class=\"line\">    11fc:\t<span class=\"hljs-number\">5d</span>                   \t<span class=\"hljs-keyword\">pop</span>    %rbp</span><br><span class=\"line\">    11fd:\tc3                   \tretq   </span><br></pre></td></tr></tbody></table></figure>\n\n<p>2.&#x4E3A;&#x4E86;&#x4E86;&#x89E3;_builtin_expect&#x662F;&#x5426;&#x771F;&#x7684;&#x6709;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x770B;&#x770B;&#x5176;&#x4ED6;&#x4F18;&#x5316;&#x7B49;&#x7EA7; -O1&#x3002;</p>\n<figure class=\"highlight x86asm hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000000000000119b &lt;doLikely&gt;:</span><br><span class=\"line\">    119b:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    119f:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">83</span> ec <span class=\"hljs-number\">08</span>          \t<span class=\"hljs-keyword\">sub</span>    <span class=\"hljs-number\">$0</span>x8,%rsp</span><br><span class=\"line\">    11a3:\t<span class=\"hljs-number\">85</span> ff                \t<span class=\"hljs-keyword\">test</span>   %edi,%edi</span><br><span class=\"line\">    11a5:\t<span class=\"hljs-number\">74</span> 0f                \t<span class=\"hljs-keyword\">je</span>     11b6 &lt;doLikely+<span class=\"hljs-number\">0x1b</span>&gt;</span><br><span class=\"line\">    11a7:\tb8 <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       \t<span class=\"hljs-keyword\">mov</span>    <span class=\"hljs-number\">$0</span>x0,%eax</span><br><span class=\"line\">    11ac:\te8 b8 ff ff ff       \tcallq  <span class=\"hljs-number\">1169</span> &lt;foo&gt;</span><br><span class=\"line\">    11b1:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">83</span> c4 <span class=\"hljs-number\">08</span>          \t<span class=\"hljs-keyword\">add</span>    <span class=\"hljs-number\">$0</span>x8,%rsp</span><br><span class=\"line\">    11b5:\tc3                   \tretq   </span><br><span class=\"line\">    11b6:\tb8 <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       \t<span class=\"hljs-keyword\">mov</span>    <span class=\"hljs-number\">$0</span>x0,%eax</span><br><span class=\"line\">    11bb:\te8 c2 ff ff ff       \tcallq  <span class=\"hljs-number\">1182</span> &lt;foo1&gt;</span><br><span class=\"line\">    11c0:\teb ef                \t<span class=\"hljs-keyword\">jmp</span>    11b1 &lt;doLikely+<span class=\"hljs-number\">0x16</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">00000000000011f3 &lt;normal&gt;:</span><br><span class=\"line\">    11f3:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    11f7:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">83</span> ec <span class=\"hljs-number\">08</span>          \t<span class=\"hljs-keyword\">sub</span>    <span class=\"hljs-number\">$0</span>x8,%rsp</span><br><span class=\"line\">    11fb:\t<span class=\"hljs-number\">85</span> ff                \t<span class=\"hljs-keyword\">test</span>   %edi,%edi</span><br><span class=\"line\">    11fd:\t<span class=\"hljs-number\">74</span> 0f                \t<span class=\"hljs-keyword\">je</span>     120e &lt;normal+<span class=\"hljs-number\">0x1b</span>&gt;</span><br><span class=\"line\">    11ff:\tb8 <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       \t<span class=\"hljs-keyword\">mov</span>    <span class=\"hljs-number\">$0</span>x0,%eax</span><br><span class=\"line\">    <span class=\"hljs-number\">1204</span>:\te8 <span class=\"hljs-number\">60</span> ff ff ff       \tcallq  <span class=\"hljs-number\">1169</span> &lt;foo&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1209</span>:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">83</span> c4 <span class=\"hljs-number\">08</span>          \t<span class=\"hljs-keyword\">add</span>    <span class=\"hljs-number\">$0</span>x8,%rsp</span><br><span class=\"line\">    <span class=\"hljs-number\">120d</span>:\tc3                   \tretq   </span><br><span class=\"line\">    120e:\tb8 <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span>       \t<span class=\"hljs-keyword\">mov</span>    <span class=\"hljs-number\">$0</span>x0,%eax</span><br><span class=\"line\">    <span class=\"hljs-number\">1213</span>:\te8 6a ff ff ff       \tcallq  <span class=\"hljs-number\">1182</span> &lt;foo1&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1218</span>:\teb ef                \t<span class=\"hljs-keyword\">jmp</span>    <span class=\"hljs-number\">1209</span> &lt;normal+<span class=\"hljs-number\">0x16</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">00000000000011ee &lt;doUnlikelyNocall&gt;:</span><br><span class=\"line\">    11ee:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    11f2:\tc3                   \tretq   </span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x89C2;&#x5BDF;-O1&#x4F18;&#x5316;&#x540E;&#x7684;&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#xFF0C;&#x4EE3;&#x7801;&#x98CE;&#x683C;&#x6709;&#x4E86;&#x8D28;&#x7684;&#x98DE;&#x8D8A;&#x3002;&#x53BB;&#x9664;&#x4E86;&#x516C;&#x5F0F;&#x5316;&#x7684;&#x53C2;&#x6570;&#x4F20;&#x9012;&#xFF0C;&#x8D39;&#x52B2;&#x7684;&#x503C;&#x6BD4;&#x8F83;&#x3002;&#x4F46;&#x662F;&#x4F9D;&#x7136;&#x6CA1;&#x6709;&#x4F53;&#x73B0;&#x51FA;_builtin_expect&#x6709;&#x6CA1;&#x6709;&#x7684;&#x533A;&#x522B;&#x3002;<br>&#x540C;&#x6837;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x975E;&#x8C03;&#x7528;&#x7248;&#x672C;&#x7531;&#x4E8E;&#x65E0;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x5DF2;&#x7ECF;&#x88AB;&#x7F16;&#x8BD1;&#x5668;&#x5B8C;&#x5168;&#x4F18;&#x5316;&#x6389;&#x4E86;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x518D;&#x770B;&#x770B;-O2&#x3002;</p>\n<figure class=\"highlight x86asm hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-number\">0000000000001210</span> &lt;doLikely&gt;:</span><br><span class=\"line\">    <span class=\"hljs-number\">1210</span>:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    <span class=\"hljs-number\">1214</span>:\t<span class=\"hljs-number\">85</span> ff                \t<span class=\"hljs-keyword\">test</span>   %edi,%edi</span><br><span class=\"line\">    <span class=\"hljs-number\">1216</span>:\t<span class=\"hljs-number\">74</span> <span class=\"hljs-number\">10</span>                \t<span class=\"hljs-keyword\">je</span>     <span class=\"hljs-number\">1228</span> &lt;doLikely+<span class=\"hljs-number\">0x18</span>&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1218</span>:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">8d</span> <span class=\"hljs-number\">3d</span> e5 <span class=\"hljs-number\">0d</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> \t<span class=\"hljs-keyword\">lea</span>    <span class=\"hljs-number\">0xde5</span>(%rip),%rdi        # <span class=\"hljs-number\">2004</span> &lt;_IO_stdin_used+<span class=\"hljs-number\">0x4</span>&gt;</span><br><span class=\"line\">    121f:\te9 3c fe ff ff       \tjmpq   <span class=\"hljs-number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1224</span>:\t0f 1f <span class=\"hljs-number\">40</span> <span class=\"hljs-number\">00</span>          \tnopl   <span class=\"hljs-number\">0x0</span>(%rax)</span><br><span class=\"line\">    <span class=\"hljs-number\">1228</span>:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">8d</span> <span class=\"hljs-number\">3d</span> d9 <span class=\"hljs-number\">0d</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> \t<span class=\"hljs-keyword\">lea</span>    <span class=\"hljs-number\">0xdd9</span>(%rip),%rdi        # <span class=\"hljs-number\">2008</span> &lt;_IO_stdin_used+<span class=\"hljs-number\">0x8</span>&gt;</span><br><span class=\"line\">    122f:\te9 2c fe ff ff       \tjmpq   <span class=\"hljs-number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1234</span>:\t<span class=\"hljs-number\">66</span> <span class=\"hljs-number\">66</span> 2e 0f 1f <span class=\"hljs-number\">84</span> <span class=\"hljs-number\">00</span> \tdata16 nopw %cs:<span class=\"hljs-number\">0x0</span>(%rax,%rax,<span class=\"hljs-number\">1</span>)</span><br><span class=\"line\">    123b:\t<span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> </span><br><span class=\"line\">    123f:\t<span class=\"hljs-number\">90</span>                   \t<span class=\"hljs-keyword\">nop</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-number\">0000000000001290</span> &lt;normal&gt;:</span><br><span class=\"line\">    <span class=\"hljs-number\">1290</span>:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    <span class=\"hljs-number\">1294</span>:\t<span class=\"hljs-number\">85</span> ff                \t<span class=\"hljs-keyword\">test</span>   %edi,%edi</span><br><span class=\"line\">    <span class=\"hljs-number\">1296</span>:\t<span class=\"hljs-number\">74</span> <span class=\"hljs-number\">10</span>                \t<span class=\"hljs-keyword\">je</span>     12a8 &lt;normal+<span class=\"hljs-number\">0x18</span>&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1298</span>:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">8d</span> <span class=\"hljs-number\">3d</span> <span class=\"hljs-number\">65</span> <span class=\"hljs-number\">0d</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> \t<span class=\"hljs-keyword\">lea</span>    <span class=\"hljs-number\">0xd65</span>(%rip),%rdi        # <span class=\"hljs-number\">2004</span> &lt;_IO_stdin_used+<span class=\"hljs-number\">0x4</span>&gt;</span><br><span class=\"line\">    129f:\te9 bc fd ff ff       \tjmpq   <span class=\"hljs-number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    12a4:\t0f 1f <span class=\"hljs-number\">40</span> <span class=\"hljs-number\">00</span>          \tnopl   <span class=\"hljs-number\">0x0</span>(%rax)</span><br><span class=\"line\">    12a8:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">8d</span> <span class=\"hljs-number\">3d</span> <span class=\"hljs-number\">59</span> <span class=\"hljs-number\">0d</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> \t<span class=\"hljs-keyword\">lea</span>    <span class=\"hljs-number\">0xd59</span>(%rip),%rdi        # <span class=\"hljs-number\">2008</span> &lt;_IO_stdin_used+<span class=\"hljs-number\">0x8</span>&gt;</span><br><span class=\"line\">    12af:\te9 ac fd ff ff       \tjmpq   <span class=\"hljs-number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    12b4:\t<span class=\"hljs-number\">66</span> <span class=\"hljs-number\">66</span> 2e 0f 1f <span class=\"hljs-number\">84</span> <span class=\"hljs-number\">00</span> \tdata16 nopw %cs:<span class=\"hljs-number\">0x0</span>(%rax,%rax,<span class=\"hljs-number\">1</span>)</span><br><span class=\"line\">    12bb:\t<span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> </span><br><span class=\"line\">    12bf:\t<span class=\"hljs-number\">90</span>                   \t<span class=\"hljs-keyword\">nop</span></span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x4EE3;&#x7801;&#x8FDB;&#x4E00;&#x6B65;&#x7684;&#x88AB;&#x4F18;&#x5316;&#xFF0C;&#x4ECE;&#x6C47;&#x7F16;&#x4EE3;&#x7801;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x5B8C;&#x5168;&#x4F18;&#x5316;&#x6389;&#x4E86;&#x6808;&#x4E0A;&#x8C03;&#x7528;&#x3002;&#x53BB;&#x9664;&#x4E86;&#x6808;&#x4E0A;&#x4F20;&#x9012;&#xFF0C;&#x5C06;call&#x6307;&#x4EE4;&#x53D8;&#x4E3A;&#x4E86;jmp&#x6307;&#x4EE4;&#xFF0C;&#x8FDB;&#x4E00;&#x6B65;&#x51CF;&#x5C11;&#x4E86;&#x6307;&#x4EE4;&#x4E0A;&#x7684;&#x5F00;&#x9500;&#x3002;<br>&#x4F46;&#x7ED3;&#x679C;&#x4ECD;&#x7136;&#x6CA1;&#x6709;&#x6539;&#x53D8;&#xFF0C;_builtin_expect&#x4F9D;&#x7136;&#x6CA1;&#x6709;&#x53D1;&#x5149;&#x53D1;&#x70ED;&#x3002;</p>\n<p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x628A;&#x5E0C;&#x671B;&#x5BC4;&#x6258;&#x4E8E;-O3&#x4E0A;&#x770B;&#x770B;&#x4E86;&#x3002;</p>\n<figure class=\"highlight x86asm hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-number\">0000000000001210</span> &lt;doLikely&gt;:</span><br><span class=\"line\">    <span class=\"hljs-number\">1210</span>:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    <span class=\"hljs-number\">1214</span>:\t<span class=\"hljs-number\">85</span> ff                \t<span class=\"hljs-keyword\">test</span>   %edi,%edi</span><br><span class=\"line\">    <span class=\"hljs-number\">1216</span>:\t<span class=\"hljs-number\">74</span> <span class=\"hljs-number\">10</span>                \t<span class=\"hljs-keyword\">je</span>     <span class=\"hljs-number\">1228</span> &lt;doLikely+<span class=\"hljs-number\">0x18</span>&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1218</span>:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">8d</span> <span class=\"hljs-number\">3d</span> e5 <span class=\"hljs-number\">0d</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> \t<span class=\"hljs-keyword\">lea</span>    <span class=\"hljs-number\">0xde5</span>(%rip),%rdi        # <span class=\"hljs-number\">2004</span> &lt;_IO_stdin_used+<span class=\"hljs-number\">0x4</span>&gt;</span><br><span class=\"line\">    121f:\te9 3c fe ff ff       \tjmpq   <span class=\"hljs-number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1224</span>:\t0f 1f <span class=\"hljs-number\">40</span> <span class=\"hljs-number\">00</span>          \tnopl   <span class=\"hljs-number\">0x0</span>(%rax)</span><br><span class=\"line\">    <span class=\"hljs-number\">1228</span>:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">8d</span> <span class=\"hljs-number\">3d</span> d9 <span class=\"hljs-number\">0d</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> \t<span class=\"hljs-keyword\">lea</span>    <span class=\"hljs-number\">0xdd9</span>(%rip),%rdi        # <span class=\"hljs-number\">2008</span> &lt;_IO_stdin_used+<span class=\"hljs-number\">0x8</span>&gt;</span><br><span class=\"line\">    122f:\te9 2c fe ff ff       \tjmpq   <span class=\"hljs-number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1234</span>:\t<span class=\"hljs-number\">66</span> <span class=\"hljs-number\">66</span> 2e 0f 1f <span class=\"hljs-number\">84</span> <span class=\"hljs-number\">00</span> \tdata16 nopw %cs:<span class=\"hljs-number\">0x0</span>(%rax,%rax,<span class=\"hljs-number\">1</span>)</span><br><span class=\"line\">    123b:\t<span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> </span><br><span class=\"line\">    123f:\t<span class=\"hljs-number\">90</span>                   \t<span class=\"hljs-keyword\">nop</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-number\">0000000000001290</span> &lt;normal&gt;:</span><br><span class=\"line\">    <span class=\"hljs-number\">1290</span>:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    <span class=\"hljs-number\">1294</span>:\t<span class=\"hljs-number\">85</span> ff                \t<span class=\"hljs-keyword\">test</span>   %edi,%edi</span><br><span class=\"line\">    <span class=\"hljs-number\">1296</span>:\t<span class=\"hljs-number\">74</span> <span class=\"hljs-number\">10</span>                \t<span class=\"hljs-keyword\">je</span>     12a8 &lt;normal+<span class=\"hljs-number\">0x18</span>&gt;</span><br><span class=\"line\">    <span class=\"hljs-number\">1298</span>:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">8d</span> <span class=\"hljs-number\">3d</span> <span class=\"hljs-number\">65</span> <span class=\"hljs-number\">0d</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> \t<span class=\"hljs-keyword\">lea</span>    <span class=\"hljs-number\">0xd65</span>(%rip),%rdi        # <span class=\"hljs-number\">2004</span> &lt;_IO_stdin_used+<span class=\"hljs-number\">0x4</span>&gt;</span><br><span class=\"line\">    129f:\te9 bc fd ff ff       \tjmpq   <span class=\"hljs-number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    12a4:\t0f 1f <span class=\"hljs-number\">40</span> <span class=\"hljs-number\">00</span>          \tnopl   <span class=\"hljs-number\">0x0</span>(%rax)</span><br><span class=\"line\">    12a8:\t<span class=\"hljs-number\">48</span> <span class=\"hljs-number\">8d</span> <span class=\"hljs-number\">3d</span> <span class=\"hljs-number\">59</span> <span class=\"hljs-number\">0d</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> \t<span class=\"hljs-keyword\">lea</span>    <span class=\"hljs-number\">0xd59</span>(%rip),%rdi        # <span class=\"hljs-number\">2008</span> &lt;_IO_stdin_used+<span class=\"hljs-number\">0x8</span>&gt;</span><br><span class=\"line\">    12af:\te9 ac fd ff ff       \tjmpq   <span class=\"hljs-number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    12b4:\t<span class=\"hljs-number\">66</span> <span class=\"hljs-number\">66</span> 2e 0f 1f <span class=\"hljs-number\">84</span> <span class=\"hljs-number\">00</span> \tdata16 nopw %cs:<span class=\"hljs-number\">0x0</span>(%rax,%rax,<span class=\"hljs-number\">1</span>)</span><br><span class=\"line\">    12bb:\t<span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> <span class=\"hljs-number\">00</span> </span><br><span class=\"line\">    12bf:\t<span class=\"hljs-number\">90</span>                   \t<span class=\"hljs-keyword\">nop</span></span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x53EF;&#x89C1;&#xFF0C;O3&#x5DF2;&#x7ECF;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4F18;&#x5316;&#x7A7A;&#x95F4;&#x4E86;&#xFF0C;_builtin_expect&#x7684;&#x5B58;&#x5728;&#x611F;&#x4E5F;&#x5DF2;&#x7136;&#x662F;0&#x3002;</p>\n<p>&#x8FD9;&#x6B21;&#x7684;&#x5B9E;&#x9A8C;&#x662F;&#x5426;&#x5931;&#x8D25;&#x5462;&#xFF0C;&#x7ED3;&#x679C;&#x4E0A;&#x770B;&#x8D77;&#x6765;&#x7684;&#x786E;&#x5982;&#x6B64;&#x3002;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x5C1D;&#x8BD5;&#x66F4;&#x591A;&#x7684;&#x5E73;&#x53F0;&#xFF0C;&#x540C;&#x65F6;&#x5404;&#x4E2A;&#x5E73;&#x53F0;&#x7684;&#x7248;&#x672C;&#x6216;GCC&#x7684;&#x7248;&#x672C;&#x90FD;&#x53EF;&#x80FD;&#x5BF9;&#x7F16;&#x8BD1;&#x7684;&#x7ED3;&#x679C;&#x9020;&#x6210;&#x4E0D;&#x540C;&#x7684;&#x5F71;&#x54CD;&#x3002;<br>_builtin_expect&#x5230;&#x5E95;&#x6709;&#x6CA1;&#x6709;&#x7528;&#xFF1F;&#x6211;&#x80FD;&#x786E;&#x4FE1;&#x7684;&#x662F;&#xFF0C;&#x518D;&#x66F4;&#x52A0;&#x6FC0;&#x8FDB;&#x7684;&#x4F18;&#x5316;&#x7B49;&#x7EA7;&#x4E0B;&#xFF0C;_builtin_expect&#x7684;&#x5B58;&#x5728;&#x611F;&#x5FC5;&#x7136;&#x662F;&#x7A00;&#x8584;&#x7684;&#x3002;&#x4F46;&#x662F;GCC&#x5728;&#x9047;&#x5230;_builtin_expect&#x65F6;&#x5177;&#x4F53;&#x505A;&#x4E86;&#x4E9B;&#x4EC0;&#x4E48;&#xFF0C;&#x5E0C;&#x671B;&#x67D0;&#x4E00;&#x5929;&#x9605;&#x8BFB;&#x5B8C;GCC&#x76F8;&#x5173;&#x7684;&#x6E90;&#x7801;&#x540E;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x6EE1;&#x610F;&#x7684;&#x7B54;&#x6848;&#x5427;&#xFF01;~</p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"C","path":"tags/C/"},{"name":"GCC","path":"tags/GCC/"},{"name":"ä»£ç ä¼˜åŒ–","path":"tags/ä»£ç ä¼˜åŒ–/"}],"excerpt":"<html><head></head><body><p>&#x6211;&#x4EEC;&#x65E5;&#x5E38;&#x7F16;&#x5199;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x5E38;&#x89C1;&#x7684;&#x5206;&#x652F;&#x8BED;&#x53E5;&#xFF0C;&#x89E3;&#x91CA;&#x884C;&#x8BED;&#x8A00;&#x80FD;&#x591F;&#x6839;&#x636E;&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x671F;&#x95F4;&#x6536;&#x96C6;&#x5206;&#x652F;&#x7684;&#x8DF3;&#x8F6C;&#x7684;&#x8D8B;&#x52BF;&#x52A8;&#x6001;&#x4F18;&#x5316;&#x5206;&#x652F;&#x8DF3;&#x8F6C;&#x3002;&#x800C;&#x7F16;&#x8BD1;&#x8A00;&#x8BED;&#x7531;&#x4E8E;&#x7F16;&#x8BD1;&#x540E;&#x76F4;&#x63A5;&#x751F;&#x6210;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x5F88;&#x96BE;&#x5728;&#x7F16;&#x8BD1;&#x671F;&#x63A8;&#x65AD;&#x51FA;&#x6700;&#x597D;&#x7684;&#x4F18;&#x5316;&#x6761;&#x4EF6;&#x3002;GCC&#x4E3A;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x4F9B;&#x4E86;&#x624B;&#x52A8;&#x4F18;&#x5316;&#x5206;&#x652F;&#x9884;&#x6D4B;&#x7684;&#x65B9;&#x6CD5;__builtin_expect&#xFF0C;&#x901A;&#x8FC7;&#x663E;&#x793A;&#x7F16;&#x7A0B;&#x5411;&#x7F16;&#x8BD1;&#x5668;&#x63D0;&#x4F9B;&#x4F18;&#x5316;&#x5EFA;&#x8BAE;&#x4ECE;&#x800C;&#x4F18;&#x5316;&#x5206;&#x652F;&#x7684;&#x8D70;&#x5411;&#x3002;</p></body></html>","more":"<p>ç¼–è¯‘å™¨æ˜¯å¦‚ä½•å¤„ç†åˆ†æ”¯æ¡ä»¶çš„ï¼Ÿä½¿ç”¨__builtin_expectçš„åˆ†æ”¯æ˜¯å¦‚ä½•å¾—åˆ°ä¼˜åŒ–çš„ï¼Ÿä½¿ç”¨GCCé»˜è®¤çš„ä¼˜åŒ–çº§åˆ«ä¼šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p>\n<p>ä¸ºäº†è§£å¼€è¿™äº›ç–‘æƒ‘ï¼Œæˆ‘ä»¬ç›´æ¥ä¸Šä»£ç ã€‚</p>\n<ul>\n<li>å¹³å° Ubuntu 20.04.1 LTS</li>\n<li>å†…æ ¸ Linux b13a1870ebc6 5.4.39-linuxkit #1 SMP Fri May 8 23:03:06 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</li>\n<li>ç¼–è¯‘å·¥å…· gcc (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0</li>\n</ul>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//xå¾ˆå¯èƒ½ä¸ºtrue</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> likely(x) __builtin_expect(!!(x), 1)  </span></span><br><span class=\"line\"><span class=\"comment\">//xå¾ˆå¯èƒ½ä¸ºfalse</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> unlikely(x) __builtin_expect(!!(x), 0)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">foo</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;foo\\n&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">foo1</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;foo1\\n&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">doLikely</span><span class=\"params\">(<span class=\"keyword\">int</span> a)</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(likely(a))&#123;</span><br><span class=\"line\">        foo();    </span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        foo1();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">doLikelyNocall</span><span class=\"params\">(<span class=\"keyword\">int</span> a)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(likely(a))&#123;</span><br><span class=\"line\">        x = a*a;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        x = a+a;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">doUnlikely</span><span class=\"params\">(<span class=\"keyword\">int</span> a)</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(unlikely(a))&#123;</span><br><span class=\"line\">        foo();</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        foo1();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">doUnlikelyNocall</span><span class=\"params\">(<span class=\"keyword\">int</span> a)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(unlikely(a))&#123;</span><br><span class=\"line\">        x = a*a;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        x = a+a;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">normal</span><span class=\"params\">(<span class=\"keyword\">int</span> a)</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(a)&#123;</span><br><span class=\"line\">        foo();</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        foo1();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">normalNocall</span><span class=\"params\">(<span class=\"keyword\">int</span> a)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(a)&#123;</span><br><span class=\"line\">        x = a*a;</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        x = a+a;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> **argv)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//ä¸ºäº†æ’é™¤å¸¸é‡å¯¼è‡´ç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œè¿™é‡Œä½¿ç”¨ä¸å®šå‚æ•°ä½œä¸ºå…¥å‚ï¼Œé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–ç›¸å…³ä»£ç </span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> a = atoi(argv[<span class=\"number\">1</span>]);</span><br><span class=\"line\">    doLikely(a);</span><br><span class=\"line\">    doUnlikely(a);</span><br><span class=\"line\">    normal(a);</span><br><span class=\"line\">    doLikelyNocall(a);</span><br><span class=\"line\">    doUnlikelyNocall(a);</span><br><span class=\"line\">    normalNocall(a);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¼€å§‹ç¼–è¾‘ï¼Œè¿™é‡Œæ˜¾ç¤ºçš„æŒ‡å®š-O0 -O1 -O2 -O3è¿™å››ä¸ªä¼˜åŒ–ç­‰çº§ã€‚</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"comment\"># gcc -O0 -o test_0 builtin_expect.c</span></span><br><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"comment\"># gcc -O1 -o test_1 builtin_expect.c</span></span><br><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"comment\"># gcc -O2 -o test_2 builtin_expect.c</span></span><br><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"comment\"># gcc -O3 -o test_3 builtin_expect.c</span></span><br></pre></td></tr></table></figure>\n\n<p>å°†ç¼–è¯‘åçš„ç›®æ ‡æ–‡ä»¶åæ±‡ç¼–</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"comment\"># objdump -d test_0 &gt;test_0.a</span></span><br><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"comment\"># objdump -d test_1 &gt;test_1.a</span></span><br><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"comment\"># objdump -d test_2 &gt;test_2.a</span></span><br><span class=\"line\">root@b13a1870ebc6:/workspace_c/builtin_expect<span class=\"comment\"># objdump -d test_3 &gt;test_3.a</span></span><br></pre></td></tr></table></figure>\n\n<p>æœ€ç»ˆæˆ‘ä»¬å¾—åˆ°äº†4ä¸ªä¼˜åŒ–ç­‰çº§ä¸åŒçš„æ±‡ç¼–ä»£ç ï¼Œå¹¶ä¾æ¬¡å¯¹æ¯”ç›¸å…³é€»è¾‘ã€‚</p>\n<p>1.-O0ç­‰çº§ä¸‹ï¼Œç¼–è¯‘å™¨é»˜è®¤ä¸æ‰§è¡Œä»»ä½•ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯¹æ¯”åŸå§‹åˆ†æ”¯ä»£ç å’Œç»è¿‡__builtin_expectä¼˜åŒ–åçš„ä»£ç åœ¨æ±‡ç¼–ç ä¸Šæœ‰ä½•åŒºåˆ«ã€‚</p>\n<figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">0000000000001197</span> &lt;doLikely&gt;:</span><br><span class=\"line\">    <span class=\"number\">1197</span>:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    119b:\t<span class=\"number\">55</span>                   \t<span class=\"keyword\">push</span>   %rbp</span><br><span class=\"line\">    119c:\t<span class=\"number\">48</span> <span class=\"number\">89</span> e5             \t<span class=\"keyword\">mov</span>    %rsp,%rbp</span><br><span class=\"line\">    119f:\t<span class=\"number\">48</span> <span class=\"number\">83</span> ec <span class=\"number\">10</span>          \t<span class=\"keyword\">sub</span>    <span class=\"number\">$0</span>x10,%rsp</span><br><span class=\"line\">    11a3:\t<span class=\"number\">89</span> <span class=\"number\">7d</span> fc             \t<span class=\"keyword\">mov</span>    %edi,-<span class=\"number\">0x4</span>(%rbp)      #å‚æ•°aå­˜æ”¾è‡³-<span class=\"number\">0x4</span>(%rbp)å¤„</span><br><span class=\"line\">    11a6:\t<span class=\"number\">83</span> <span class=\"number\">7d</span> fc <span class=\"number\">00</span>          \tcmpl   <span class=\"number\">$0</span>x0,-<span class=\"number\">0x4</span>(%rbp)      #å‚æ•°aå’Œ<span class=\"number\">0</span>æ¯”è¾ƒ</span><br><span class=\"line\">    11aa:\t0f <span class=\"number\">95</span> c0             \t<span class=\"keyword\">setne</span>  %al                  #æ¡ä»¶è®¾ç½®ï¼Œ<span class=\"built_in\">al</span>ä¸­ä¿å­˜~ZFã€‚if a = <span class=\"number\">1</span> then <span class=\"built_in\">al</span> = <span class=\"number\">1</span> <span class=\"comment\">; if a = 0 then al = 0</span></span><br><span class=\"line\">    11ad:\t0f b6 c0             \tmovzbl %al,%eax             #<span class=\"built_in\">eax</span> = <span class=\"number\">0000000000000000</span> -&gt; <span class=\"number\">00000000000000000000000000000000</span> <span class=\"keyword\">or</span> <span class=\"number\">0000000000000001</span> -&gt; <span class=\"number\">00000000000000000000000000000001</span></span><br><span class=\"line\">    11b0:\t<span class=\"number\">48</span> <span class=\"number\">85</span> c0             \t<span class=\"keyword\">test</span>   %rax,%rax            #åˆ¤æ–­<span class=\"built_in\">eax</span>æ˜¯å¦ä¸º<span class=\"number\">0</span></span><br><span class=\"line\">    11b3:\t<span class=\"number\">74</span> 0c                \t<span class=\"keyword\">je</span>     11c1 &lt;doLikely+<span class=\"number\">0x2a</span>&gt; #<span class=\"built_in\">eax</span> = <span class=\"number\">0</span>(a = <span class=\"number\">0</span>)æ—¶ï¼Œè·³è½¬è‡³11c1ï¼Œ<span class=\"keyword\">call</span> foo1</span><br><span class=\"line\">    11b5:\tb8 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       \t<span class=\"keyword\">mov</span>    <span class=\"number\">$0</span>x0,%eax</span><br><span class=\"line\">    11ba:\te8 aa ff ff ff       \tcallq  <span class=\"number\">1169</span> &lt;foo&gt;           #<span class=\"built_in\">eax</span>!=<span class=\"number\">0</span>(a = <span class=\"number\">0</span>)æ—¶ï¼Œ<span class=\"keyword\">call</span> foo</span><br><span class=\"line\">    11bf:\teb 0a                \t<span class=\"keyword\">jmp</span>    11cb &lt;doLikely+<span class=\"number\">0x34</span>&gt; #è·³è½¬è‡³11cbï¼Œç»“æŸ</span><br><span class=\"line\">    11c1:\tb8 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       \t<span class=\"keyword\">mov</span>    <span class=\"number\">$0</span>x0,%eax</span><br><span class=\"line\">    11c6:\te8 b5 ff ff ff       \tcallq  <span class=\"number\">1180</span> &lt;foo1&gt;</span><br><span class=\"line\">    11cb:\t<span class=\"number\">90</span>                   \t<span class=\"keyword\">nop</span></span><br><span class=\"line\">    11cc:\tc9                   \tleaveq </span><br><span class=\"line\">    11cd:\tc3                   \tretq   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0000000000001265</span> &lt;normal&gt;:</span><br><span class=\"line\">    <span class=\"number\">1265</span>:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    <span class=\"number\">1269</span>:\t<span class=\"number\">55</span>                   \t<span class=\"keyword\">push</span>   %rbp</span><br><span class=\"line\">    126a:\t<span class=\"number\">48</span> <span class=\"number\">89</span> e5             \t<span class=\"keyword\">mov</span>    %rsp,%rbp</span><br><span class=\"line\">    <span class=\"number\">126d</span>:\t<span class=\"number\">48</span> <span class=\"number\">83</span> ec <span class=\"number\">10</span>          \t<span class=\"keyword\">sub</span>    <span class=\"number\">$0</span>x10,%rsp</span><br><span class=\"line\">    <span class=\"number\">1271</span>:\t<span class=\"number\">89</span> <span class=\"number\">7d</span> fc             \t<span class=\"keyword\">mov</span>    %edi,-<span class=\"number\">0x4</span>(%rbp)      #å‚æ•°aå­˜æ”¾è‡³-<span class=\"number\">0x4</span>(%rbp)å¤„</span><br><span class=\"line\">    <span class=\"number\">1274</span>:\t<span class=\"number\">83</span> <span class=\"number\">7d</span> fc <span class=\"number\">00</span>          \tcmpl   <span class=\"number\">$0</span>x0,-<span class=\"number\">0x4</span>(%rbp)      #å‚æ•°aå’Œ<span class=\"number\">0</span>æ¯”è¾ƒ</span><br><span class=\"line\">    <span class=\"number\">1278</span>:\t<span class=\"number\">74</span> 0c                \t<span class=\"keyword\">je</span>     <span class=\"number\">1286</span> &lt;normal+<span class=\"number\">0x21</span>&gt;   #å¦‚æœa=<span class=\"number\">0</span>ï¼Œåˆ™è·³è½¬è‡³<span class=\"number\">1286</span>ï¼Œæ‰§è¡Œfoo1</span><br><span class=\"line\">    127a:\tb8 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       \t<span class=\"keyword\">mov</span>    <span class=\"number\">$0</span>x0,%eax</span><br><span class=\"line\">    127f:\te8 e5 fe ff ff       \tcallq  <span class=\"number\">1169</span> &lt;foo&gt;           #å¦‚æœa!=<span class=\"number\">0</span>,åˆ™æ‰§è¡Œfoo</span><br><span class=\"line\">    <span class=\"number\">1284</span>:\teb 0a                \t<span class=\"keyword\">jmp</span>    <span class=\"number\">1290</span> &lt;normal+<span class=\"number\">0x2b</span>&gt;   #è·³è½¬è‡³<span class=\"number\">1290</span>ï¼Œç»“æŸ</span><br><span class=\"line\">    <span class=\"number\">1286</span>:\tb8 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       \t<span class=\"keyword\">mov</span>    <span class=\"number\">$0</span>x0,%eax</span><br><span class=\"line\">    128b:\te8 f0 fe ff ff       \tcallq  <span class=\"number\">1180</span> &lt;foo1&gt;</span><br><span class=\"line\">    <span class=\"number\">1290</span>:\t<span class=\"number\">90</span>                   \t<span class=\"keyword\">nop</span></span><br><span class=\"line\">    <span class=\"number\">1291</span>:\tc9                   \tleaveq </span><br><span class=\"line\">    <span class=\"number\">1292</span>:\tc3                   \tretq   </span><br></pre></td></tr></table></figure>\n\n<p>é€šè¿‡å¯¹æ¯”ï¼Œç»“æœä»¤äººæƒŠè®¶ã€‚è™½ç„¶æ‰§è¡Œç»“æœä¸€ç›´ï¼Œä½†æ˜¯æ²¡æœ‰ç»è¿‡_builtin_expectä¼˜åŒ–çš„åˆ†æ”¯åˆ¤æ–­ï¼Œåè€Œæ¯”æ ‡è¯†_builtin_expectçš„æ±‡ç¼–ä»£ç æ›´åŠ ç®€æ´ã€‚</p>\n<p>åˆ†æUnlikelyçš„æ±‡ç¼–ä»£ç ï¼Œä¹Ÿå­˜åœ¨åŒæ ·çš„é—®é¢˜ï¼Œç¼–è¯‘å™¨è²Œä¼¼ä¼šå¤šæ­¤ä¸€ä¸¾å¢åŠ ä¸€æ­¥çš„åˆ¤æ–­</p>\n<figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00000000000011fe &lt;doUnlikely&gt;:</span><br><span class=\"line\">    11fe:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    <span class=\"number\">1202</span>:\t<span class=\"number\">55</span>                   \t<span class=\"keyword\">push</span>   %rbp</span><br><span class=\"line\">    <span class=\"number\">1203</span>:\t<span class=\"number\">48</span> <span class=\"number\">89</span> e5             \t<span class=\"keyword\">mov</span>    %rsp,%rbp</span><br><span class=\"line\">    <span class=\"number\">1206</span>:\t<span class=\"number\">48</span> <span class=\"number\">83</span> ec <span class=\"number\">10</span>          \t<span class=\"keyword\">sub</span>    <span class=\"number\">$0</span>x10,%rsp</span><br><span class=\"line\">    120a:\t<span class=\"number\">89</span> <span class=\"number\">7d</span> fc             \t<span class=\"keyword\">mov</span>    %edi,-<span class=\"number\">0x4</span>(%rbp)</span><br><span class=\"line\">    <span class=\"number\">120d</span>:\t<span class=\"number\">83</span> <span class=\"number\">7d</span> fc <span class=\"number\">00</span>          \tcmpl   <span class=\"number\">$0</span>x0,-<span class=\"number\">0x4</span>(%rbp)</span><br><span class=\"line\">    <span class=\"number\">1211</span>:\t0f <span class=\"number\">95</span> c0             \t<span class=\"keyword\">setne</span>  %al</span><br><span class=\"line\">    <span class=\"number\">1214</span>:\t0f b6 c0             \tmovzbl %al,%eax</span><br><span class=\"line\">    <span class=\"number\">1217</span>:\t<span class=\"number\">48</span> <span class=\"number\">85</span> c0             \t<span class=\"keyword\">test</span>   %rax,%rax</span><br><span class=\"line\">    121a:\t<span class=\"number\">74</span> 0c                \t<span class=\"keyword\">je</span>     <span class=\"number\">1228</span> &lt;doUnlikely+<span class=\"number\">0x2a</span>&gt;</span><br><span class=\"line\">    121c:\tb8 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       \t<span class=\"keyword\">mov</span>    <span class=\"number\">$0</span>x0,%eax</span><br><span class=\"line\">    <span class=\"number\">1221</span>:\te8 <span class=\"number\">43</span> ff ff ff       \tcallq  <span class=\"number\">1169</span> &lt;foo&gt;</span><br><span class=\"line\">    <span class=\"number\">1226</span>:\teb 0a                \t<span class=\"keyword\">jmp</span>    <span class=\"number\">1232</span> &lt;doUnlikely+<span class=\"number\">0x34</span>&gt;</span><br><span class=\"line\">    <span class=\"number\">1228</span>:\tb8 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       \t<span class=\"keyword\">mov</span>    <span class=\"number\">$0</span>x0,%eax</span><br><span class=\"line\">    <span class=\"number\">122d</span>:\te8 4e ff ff ff       \tcallq  <span class=\"number\">1180</span> &lt;foo1&gt;</span><br><span class=\"line\">    <span class=\"number\">1232</span>:\t<span class=\"number\">90</span>                   \t<span class=\"keyword\">nop</span></span><br><span class=\"line\">    <span class=\"number\">1233</span>:\tc9                   \tleaveq </span><br><span class=\"line\">    <span class=\"number\">1234</span>:\tc3                   \tretq   </span><br></pre></td></tr></table></figure>\n\n<p>æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå†™äº†ä¸ªéå†…éƒ¨è°ƒç”¨çš„ç‰ˆæœ¬ï¼Œç»“æœä¹Ÿæ˜¯åŒæ ·ã€‚ç¼–è¯‘å™¨æ²¡æœ‰å¯¹_builtin_expectåšå‡ºä¸ä¸€æ ·çš„ä¼˜åŒ–ã€‚</p>\n<figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00000000000011ce &lt;doLikelyNocall&gt;:</span><br><span class=\"line\">    11ce:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    11d2:\t<span class=\"number\">55</span>                   \t<span class=\"keyword\">push</span>   %rbp</span><br><span class=\"line\">    11d3:\t<span class=\"number\">48</span> <span class=\"number\">89</span> e5             \t<span class=\"keyword\">mov</span>    %rsp,%rbp</span><br><span class=\"line\">    11d6:\t<span class=\"number\">89</span> <span class=\"number\">7d</span> ec             \t<span class=\"keyword\">mov</span>    %edi,-<span class=\"number\">0x14</span>(%rbp)</span><br><span class=\"line\">    11d9:\t<span class=\"number\">83</span> <span class=\"number\">7d</span> ec <span class=\"number\">00</span>          \tcmpl   <span class=\"number\">$0</span>x0,-<span class=\"number\">0x14</span>(%rbp)</span><br><span class=\"line\">    11<span class=\"built_in\">dd</span>:\t0f <span class=\"number\">95</span> c0             \t<span class=\"keyword\">setne</span>  %al</span><br><span class=\"line\">    11e0:\t0f b6 c0             \tmovzbl %al,%eax</span><br><span class=\"line\">    11e3:\t<span class=\"number\">48</span> <span class=\"number\">85</span> c0             \t<span class=\"keyword\">test</span>   %rax,%rax</span><br><span class=\"line\">    11e6:\t<span class=\"number\">74</span> <span class=\"number\">0b</span>                \t<span class=\"keyword\">je</span>     11f3 &lt;doLikelyNocall+<span class=\"number\">0x25</span>&gt;</span><br><span class=\"line\">    11e8:\t8b <span class=\"number\">45</span> ec             \t<span class=\"keyword\">mov</span>    -<span class=\"number\">0x14</span>(%rbp),%eax</span><br><span class=\"line\">    11eb:\t0f af c0             \t<span class=\"keyword\">imul</span>   %eax,%eax</span><br><span class=\"line\">    11ee:\t<span class=\"number\">89</span> <span class=\"number\">45</span> fc             \t<span class=\"keyword\">mov</span>    %eax,-<span class=\"number\">0x4</span>(%rbp)</span><br><span class=\"line\">    11f1:\teb <span class=\"number\">08</span>                \t<span class=\"keyword\">jmp</span>    11fb &lt;doLikelyNocall+<span class=\"number\">0x2d</span>&gt;</span><br><span class=\"line\">    11f3:\t8b <span class=\"number\">45</span> ec             \t<span class=\"keyword\">mov</span>    -<span class=\"number\">0x14</span>(%rbp),%eax</span><br><span class=\"line\">    11f6:\t<span class=\"number\">01</span> c0                \t<span class=\"keyword\">add</span>    %eax,%eax</span><br><span class=\"line\">    11f8:\t<span class=\"number\">89</span> <span class=\"number\">45</span> fc             \t<span class=\"keyword\">mov</span>    %eax,-<span class=\"number\">0x4</span>(%rbp)</span><br><span class=\"line\">    11fb:\t<span class=\"number\">90</span>                   \t<span class=\"keyword\">nop</span></span><br><span class=\"line\">    11fc:\t<span class=\"number\">5d</span>                   \t<span class=\"keyword\">pop</span>    %rbp</span><br><span class=\"line\">    11fd:\tc3                   \tretq   </span><br></pre></td></tr></table></figure>\n\n<p>2.ä¸ºäº†äº†è§£_builtin_expectæ˜¯å¦çœŸçš„æœ‰ç”¨ï¼Œæˆ‘ä»¬å†çœ‹çœ‹å…¶ä»–ä¼˜åŒ–ç­‰çº§ -O1ã€‚</p>\n<figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000000000000119b &lt;doLikely&gt;:</span><br><span class=\"line\">    119b:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    119f:\t<span class=\"number\">48</span> <span class=\"number\">83</span> ec <span class=\"number\">08</span>          \t<span class=\"keyword\">sub</span>    <span class=\"number\">$0</span>x8,%rsp</span><br><span class=\"line\">    11a3:\t<span class=\"number\">85</span> ff                \t<span class=\"keyword\">test</span>   %edi,%edi</span><br><span class=\"line\">    11a5:\t<span class=\"number\">74</span> 0f                \t<span class=\"keyword\">je</span>     11b6 &lt;doLikely+<span class=\"number\">0x1b</span>&gt;</span><br><span class=\"line\">    11a7:\tb8 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       \t<span class=\"keyword\">mov</span>    <span class=\"number\">$0</span>x0,%eax</span><br><span class=\"line\">    11ac:\te8 b8 ff ff ff       \tcallq  <span class=\"number\">1169</span> &lt;foo&gt;</span><br><span class=\"line\">    11b1:\t<span class=\"number\">48</span> <span class=\"number\">83</span> c4 <span class=\"number\">08</span>          \t<span class=\"keyword\">add</span>    <span class=\"number\">$0</span>x8,%rsp</span><br><span class=\"line\">    11b5:\tc3                   \tretq   </span><br><span class=\"line\">    11b6:\tb8 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       \t<span class=\"keyword\">mov</span>    <span class=\"number\">$0</span>x0,%eax</span><br><span class=\"line\">    11bb:\te8 c2 ff ff ff       \tcallq  <span class=\"number\">1182</span> &lt;foo1&gt;</span><br><span class=\"line\">    11c0:\teb ef                \t<span class=\"keyword\">jmp</span>    11b1 &lt;doLikely+<span class=\"number\">0x16</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">00000000000011f3 &lt;normal&gt;:</span><br><span class=\"line\">    11f3:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    11f7:\t<span class=\"number\">48</span> <span class=\"number\">83</span> ec <span class=\"number\">08</span>          \t<span class=\"keyword\">sub</span>    <span class=\"number\">$0</span>x8,%rsp</span><br><span class=\"line\">    11fb:\t<span class=\"number\">85</span> ff                \t<span class=\"keyword\">test</span>   %edi,%edi</span><br><span class=\"line\">    11fd:\t<span class=\"number\">74</span> 0f                \t<span class=\"keyword\">je</span>     120e &lt;normal+<span class=\"number\">0x1b</span>&gt;</span><br><span class=\"line\">    11ff:\tb8 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       \t<span class=\"keyword\">mov</span>    <span class=\"number\">$0</span>x0,%eax</span><br><span class=\"line\">    <span class=\"number\">1204</span>:\te8 <span class=\"number\">60</span> ff ff ff       \tcallq  <span class=\"number\">1169</span> &lt;foo&gt;</span><br><span class=\"line\">    <span class=\"number\">1209</span>:\t<span class=\"number\">48</span> <span class=\"number\">83</span> c4 <span class=\"number\">08</span>          \t<span class=\"keyword\">add</span>    <span class=\"number\">$0</span>x8,%rsp</span><br><span class=\"line\">    <span class=\"number\">120d</span>:\tc3                   \tretq   </span><br><span class=\"line\">    120e:\tb8 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       \t<span class=\"keyword\">mov</span>    <span class=\"number\">$0</span>x0,%eax</span><br><span class=\"line\">    <span class=\"number\">1213</span>:\te8 6a ff ff ff       \tcallq  <span class=\"number\">1182</span> &lt;foo1&gt;</span><br><span class=\"line\">    <span class=\"number\">1218</span>:\teb ef                \t<span class=\"keyword\">jmp</span>    <span class=\"number\">1209</span> &lt;normal+<span class=\"number\">0x16</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">00000000000011ee &lt;doUnlikelyNocall&gt;:</span><br><span class=\"line\">    11ee:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    11f2:\tc3                   \tretq   </span><br></pre></td></tr></table></figure>\n\n<p>è§‚å¯Ÿ-O1ä¼˜åŒ–åçš„æ±‡ç¼–ä»£ç ï¼Œä»£ç é£æ ¼æœ‰äº†è´¨çš„é£è¶Šã€‚å»é™¤äº†å…¬å¼åŒ–çš„å‚æ•°ä¼ é€’ï¼Œè´¹åŠ²çš„å€¼æ¯”è¾ƒã€‚ä½†æ˜¯ä¾ç„¶æ²¡æœ‰ä½“ç°å‡º_builtin_expectæœ‰æ²¡æœ‰çš„åŒºåˆ«ã€‚<br>åŒæ ·çš„ï¼Œæˆ‘ä»¬çš„éè°ƒç”¨ç‰ˆæœ¬ç”±äºæ— è¿”å›å€¼ï¼Œå·²ç»è¢«ç¼–è¯‘å™¨å®Œå…¨ä¼˜åŒ–æ‰äº†ã€‚</p>\n<p>æˆ‘ä»¬å†çœ‹çœ‹-O2ã€‚</p>\n<figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">0000000000001210</span> &lt;doLikely&gt;:</span><br><span class=\"line\">    <span class=\"number\">1210</span>:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    <span class=\"number\">1214</span>:\t<span class=\"number\">85</span> ff                \t<span class=\"keyword\">test</span>   %edi,%edi</span><br><span class=\"line\">    <span class=\"number\">1216</span>:\t<span class=\"number\">74</span> <span class=\"number\">10</span>                \t<span class=\"keyword\">je</span>     <span class=\"number\">1228</span> &lt;doLikely+<span class=\"number\">0x18</span>&gt;</span><br><span class=\"line\">    <span class=\"number\">1218</span>:\t<span class=\"number\">48</span> <span class=\"number\">8d</span> <span class=\"number\">3d</span> e5 <span class=\"number\">0d</span> <span class=\"number\">00</span> <span class=\"number\">00</span> \t<span class=\"keyword\">lea</span>    <span class=\"number\">0xde5</span>(%rip),%rdi        # <span class=\"number\">2004</span> &lt;_IO_stdin_used+<span class=\"number\">0x4</span>&gt;</span><br><span class=\"line\">    121f:\te9 3c fe ff ff       \tjmpq   <span class=\"number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    <span class=\"number\">1224</span>:\t0f 1f <span class=\"number\">40</span> <span class=\"number\">00</span>          \tnopl   <span class=\"number\">0x0</span>(%rax)</span><br><span class=\"line\">    <span class=\"number\">1228</span>:\t<span class=\"number\">48</span> <span class=\"number\">8d</span> <span class=\"number\">3d</span> d9 <span class=\"number\">0d</span> <span class=\"number\">00</span> <span class=\"number\">00</span> \t<span class=\"keyword\">lea</span>    <span class=\"number\">0xdd9</span>(%rip),%rdi        # <span class=\"number\">2008</span> &lt;_IO_stdin_used+<span class=\"number\">0x8</span>&gt;</span><br><span class=\"line\">    122f:\te9 2c fe ff ff       \tjmpq   <span class=\"number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    <span class=\"number\">1234</span>:\t<span class=\"number\">66</span> <span class=\"number\">66</span> 2e 0f 1f <span class=\"number\">84</span> <span class=\"number\">00</span> \tdata16 nopw %cs:<span class=\"number\">0x0</span>(%rax,%rax,<span class=\"number\">1</span>)</span><br><span class=\"line\">    123b:\t<span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> </span><br><span class=\"line\">    123f:\t<span class=\"number\">90</span>                   \t<span class=\"keyword\">nop</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0000000000001290</span> &lt;normal&gt;:</span><br><span class=\"line\">    <span class=\"number\">1290</span>:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    <span class=\"number\">1294</span>:\t<span class=\"number\">85</span> ff                \t<span class=\"keyword\">test</span>   %edi,%edi</span><br><span class=\"line\">    <span class=\"number\">1296</span>:\t<span class=\"number\">74</span> <span class=\"number\">10</span>                \t<span class=\"keyword\">je</span>     12a8 &lt;normal+<span class=\"number\">0x18</span>&gt;</span><br><span class=\"line\">    <span class=\"number\">1298</span>:\t<span class=\"number\">48</span> <span class=\"number\">8d</span> <span class=\"number\">3d</span> <span class=\"number\">65</span> <span class=\"number\">0d</span> <span class=\"number\">00</span> <span class=\"number\">00</span> \t<span class=\"keyword\">lea</span>    <span class=\"number\">0xd65</span>(%rip),%rdi        # <span class=\"number\">2004</span> &lt;_IO_stdin_used+<span class=\"number\">0x4</span>&gt;</span><br><span class=\"line\">    129f:\te9 bc fd ff ff       \tjmpq   <span class=\"number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    12a4:\t0f 1f <span class=\"number\">40</span> <span class=\"number\">00</span>          \tnopl   <span class=\"number\">0x0</span>(%rax)</span><br><span class=\"line\">    12a8:\t<span class=\"number\">48</span> <span class=\"number\">8d</span> <span class=\"number\">3d</span> <span class=\"number\">59</span> <span class=\"number\">0d</span> <span class=\"number\">00</span> <span class=\"number\">00</span> \t<span class=\"keyword\">lea</span>    <span class=\"number\">0xd59</span>(%rip),%rdi        # <span class=\"number\">2008</span> &lt;_IO_stdin_used+<span class=\"number\">0x8</span>&gt;</span><br><span class=\"line\">    12af:\te9 ac fd ff ff       \tjmpq   <span class=\"number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    12b4:\t<span class=\"number\">66</span> <span class=\"number\">66</span> 2e 0f 1f <span class=\"number\">84</span> <span class=\"number\">00</span> \tdata16 nopw %cs:<span class=\"number\">0x0</span>(%rax,%rax,<span class=\"number\">1</span>)</span><br><span class=\"line\">    12bb:\t<span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> </span><br><span class=\"line\">    12bf:\t<span class=\"number\">90</span>                   \t<span class=\"keyword\">nop</span></span><br></pre></td></tr></table></figure>\n\n<p>ä»£ç è¿›ä¸€æ­¥çš„è¢«ä¼˜åŒ–ï¼Œä»æ±‡ç¼–ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ–¹æ³•è°ƒç”¨å®Œå…¨ä¼˜åŒ–æ‰äº†æ ˆä¸Šè°ƒç”¨ã€‚å»é™¤äº†æ ˆä¸Šä¼ é€’ï¼Œå°†callæŒ‡ä»¤å˜ä¸ºäº†jmpæŒ‡ä»¤ï¼Œè¿›ä¸€æ­¥å‡å°‘äº†æŒ‡ä»¤ä¸Šçš„å¼€é”€ã€‚<br>ä½†ç»“æœä»ç„¶æ²¡æœ‰æ”¹å˜ï¼Œ_builtin_expectä¾ç„¶æ²¡æœ‰å‘å…‰å‘çƒ­ã€‚</p>\n<p>æœ€åæˆ‘ä»¬åªèƒ½æŠŠå¸Œæœ›å¯„æ‰˜äº-O3ä¸Šçœ‹çœ‹äº†ã€‚</p>\n<figure class=\"highlight x86asm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">0000000000001210</span> &lt;doLikely&gt;:</span><br><span class=\"line\">    <span class=\"number\">1210</span>:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    <span class=\"number\">1214</span>:\t<span class=\"number\">85</span> ff                \t<span class=\"keyword\">test</span>   %edi,%edi</span><br><span class=\"line\">    <span class=\"number\">1216</span>:\t<span class=\"number\">74</span> <span class=\"number\">10</span>                \t<span class=\"keyword\">je</span>     <span class=\"number\">1228</span> &lt;doLikely+<span class=\"number\">0x18</span>&gt;</span><br><span class=\"line\">    <span class=\"number\">1218</span>:\t<span class=\"number\">48</span> <span class=\"number\">8d</span> <span class=\"number\">3d</span> e5 <span class=\"number\">0d</span> <span class=\"number\">00</span> <span class=\"number\">00</span> \t<span class=\"keyword\">lea</span>    <span class=\"number\">0xde5</span>(%rip),%rdi        # <span class=\"number\">2004</span> &lt;_IO_stdin_used+<span class=\"number\">0x4</span>&gt;</span><br><span class=\"line\">    121f:\te9 3c fe ff ff       \tjmpq   <span class=\"number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    <span class=\"number\">1224</span>:\t0f 1f <span class=\"number\">40</span> <span class=\"number\">00</span>          \tnopl   <span class=\"number\">0x0</span>(%rax)</span><br><span class=\"line\">    <span class=\"number\">1228</span>:\t<span class=\"number\">48</span> <span class=\"number\">8d</span> <span class=\"number\">3d</span> d9 <span class=\"number\">0d</span> <span class=\"number\">00</span> <span class=\"number\">00</span> \t<span class=\"keyword\">lea</span>    <span class=\"number\">0xdd9</span>(%rip),%rdi        # <span class=\"number\">2008</span> &lt;_IO_stdin_used+<span class=\"number\">0x8</span>&gt;</span><br><span class=\"line\">    122f:\te9 2c fe ff ff       \tjmpq   <span class=\"number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    <span class=\"number\">1234</span>:\t<span class=\"number\">66</span> <span class=\"number\">66</span> 2e 0f 1f <span class=\"number\">84</span> <span class=\"number\">00</span> \tdata16 nopw %cs:<span class=\"number\">0x0</span>(%rax,%rax,<span class=\"number\">1</span>)</span><br><span class=\"line\">    123b:\t<span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> </span><br><span class=\"line\">    123f:\t<span class=\"number\">90</span>                   \t<span class=\"keyword\">nop</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0000000000001290</span> &lt;normal&gt;:</span><br><span class=\"line\">    <span class=\"number\">1290</span>:\tf3 0f 1e fa          \tendbr64 </span><br><span class=\"line\">    <span class=\"number\">1294</span>:\t<span class=\"number\">85</span> ff                \t<span class=\"keyword\">test</span>   %edi,%edi</span><br><span class=\"line\">    <span class=\"number\">1296</span>:\t<span class=\"number\">74</span> <span class=\"number\">10</span>                \t<span class=\"keyword\">je</span>     12a8 &lt;normal+<span class=\"number\">0x18</span>&gt;</span><br><span class=\"line\">    <span class=\"number\">1298</span>:\t<span class=\"number\">48</span> <span class=\"number\">8d</span> <span class=\"number\">3d</span> <span class=\"number\">65</span> <span class=\"number\">0d</span> <span class=\"number\">00</span> <span class=\"number\">00</span> \t<span class=\"keyword\">lea</span>    <span class=\"number\">0xd65</span>(%rip),%rdi        # <span class=\"number\">2004</span> &lt;_IO_stdin_used+<span class=\"number\">0x4</span>&gt;</span><br><span class=\"line\">    129f:\te9 bc fd ff ff       \tjmpq   <span class=\"number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    12a4:\t0f 1f <span class=\"number\">40</span> <span class=\"number\">00</span>          \tnopl   <span class=\"number\">0x0</span>(%rax)</span><br><span class=\"line\">    12a8:\t<span class=\"number\">48</span> <span class=\"number\">8d</span> <span class=\"number\">3d</span> <span class=\"number\">59</span> <span class=\"number\">0d</span> <span class=\"number\">00</span> <span class=\"number\">00</span> \t<span class=\"keyword\">lea</span>    <span class=\"number\">0xd59</span>(%rip),%rdi        # <span class=\"number\">2008</span> &lt;_IO_stdin_used+<span class=\"number\">0x8</span>&gt;</span><br><span class=\"line\">    12af:\te9 ac fd ff ff       \tjmpq   <span class=\"number\">1060</span> &lt;puts@plt&gt;</span><br><span class=\"line\">    12b4:\t<span class=\"number\">66</span> <span class=\"number\">66</span> 2e 0f 1f <span class=\"number\">84</span> <span class=\"number\">00</span> \tdata16 nopw %cs:<span class=\"number\">0x0</span>(%rax,%rax,<span class=\"number\">1</span>)</span><br><span class=\"line\">    12bb:\t<span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> </span><br><span class=\"line\">    12bf:\t<span class=\"number\">90</span>                   \t<span class=\"keyword\">nop</span></span><br></pre></td></tr></table></figure>\n\n<p>å¯è§ï¼ŒO3å·²ç»æ²¡æœ‰ä»»ä½•ä¼˜åŒ–ç©ºé—´äº†ï¼Œ_builtin_expectçš„å­˜åœ¨æ„Ÿä¹Ÿå·²ç„¶æ˜¯0ã€‚</p>\n<p>è¿™æ¬¡çš„å®éªŒæ˜¯å¦å¤±è´¥å‘¢ï¼Œç»“æœä¸Šçœ‹èµ·æ¥çš„ç¡®å¦‚æ­¤ã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰å°è¯•æ›´å¤šçš„å¹³å°ï¼ŒåŒæ—¶å„ä¸ªå¹³å°çš„ç‰ˆæœ¬æˆ–GCCçš„ç‰ˆæœ¬éƒ½å¯èƒ½å¯¹ç¼–è¯‘çš„ç»“æœé€ æˆä¸åŒçš„å½±å“ã€‚<br>_builtin_expectåˆ°åº•æœ‰æ²¡æœ‰ç”¨ï¼Ÿæˆ‘èƒ½ç¡®ä¿¡çš„æ˜¯ï¼Œå†æ›´åŠ æ¿€è¿›çš„ä¼˜åŒ–ç­‰çº§ä¸‹ï¼Œ_builtin_expectçš„å­˜åœ¨æ„Ÿå¿…ç„¶æ˜¯ç¨€è–„çš„ã€‚ä½†æ˜¯GCCåœ¨é‡åˆ°_builtin_expectæ—¶å…·ä½“åšäº†äº›ä»€ä¹ˆï¼Œå¸Œæœ›æŸä¸€å¤©é˜…è¯»å®ŒGCCç›¸å…³çš„æºç åæ‰¾åˆ°ä¸€ä¸ªæ»¡æ„çš„ç­”æ¡ˆå§ï¼~</p>"},{"title":"åŸºäºFlinkå®ç°ç®€å•çš„æ—¥å¿—å¼‚å¸¸æ¨é€","date":"2020-05-30T08:13:42.000Z","_content":"\n## ç›‘æ§ç³»ç»Ÿ\nä¸šåŠ¡ç³»ç»Ÿç»å¸¸ä¼šæ¥å…¥å„ç§ç›‘æ§ç³»ç»Ÿæˆ–APMç³»ç»Ÿï¼Œä»è€Œå®ç°ç”Ÿäº§é—®é¢˜çš„å¿«é€ŸæŠ¥è­¦å’Œå®šä½ã€‚æ¯”å¦‚CATã€PingPongã€skywalkingç­‰ï¼Œè™½ç„¶å®ç°åŸç†å’Œæ¶æ„ç•¥æœ‰ä¸åŒï¼Œä½†éƒ½ä¸ºä¸šåŠ¡ç³»ç»Ÿæä¾›äº†è°ƒç”¨é“¾è·Ÿè¸ªã€å¼‚å¸¸æ—¥å¿—ã€DBå¼‚å¸¸ã€è¿æ¥è¶…æ—¶ã€JVMä¿¡æ¯ç­‰æŠ¥è­¦ã€‚ç”šè‡³æˆ‘ä»¬å¯ä»¥åœ¨ç›‘æ§å¹³å°ä¸Šå®šåˆ¶è‡ªå·±çš„æŠ¥è­¦è§„åˆ™ï¼Œç›‘æ§ç³»ç»Ÿä¼šæ ¹æ®è§„åˆ™å‘å…³ç³»äººæä¾›æŠ¥è­¦ä¿¡æ¯ã€‚\n\nä»¥ä¸Šéƒ½æ˜¯åŸºäºç›‘æ§ç³»ç»Ÿæä¾›çš„åŠŸèƒ½å®ç°å„ä¸ªç»´åº¦çš„æŠ¥è­¦ã€‚æœ€è¿‘åœ¨æ¯é¥¬Flinkï¼Œæ‰€ä»¥æƒ³èƒ½å¦ç”¨Flinkå®ç°ä¸€ä¸ªç®€å•çš„æ—¥å¿—å¼‚å¸¸æŠ¥è­¦ã€‚è¯ä¸å¤šè¯´ï¼Œå¼€å§‹æ’¸ä»£ç ã€‚\n<!-- more -->\n## å¼•å…¥æ—¥å¿—æœåŠ¡ä¾èµ–\nç”±äºç³»ç»Ÿå·²ç»å…¨é¢æ¥å…¥é˜¿é‡Œäº‘æ—¥å¿—å¹³å°ï¼Œå¹¶ä¸”é˜¿é‡Œäº‘ä¹Ÿéå¸¸æœ‰å¥½çš„ä¸ºæˆ‘ä»¬æä¾›äº†Flinké˜¿é‡Œäº‘Sourceçš„å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦å¼•å…¥é˜¿é‡Œäº‘æä¾›çš„jaråŒ…å³å¯ï¼Œçœå»äº†è‡ªå·±å®ç°çš„åŠŸå¤«ã€‚\n\n```yml\n    compile \"com.aliyun.openservices:flink-log-connector:0.1.3\"\n    compile \"com.google.protobuf:protobuf-java:2.5.0\"\n    compile \"com.aliyun.openservices:aliyun-log:0.6.10\"\n    // ç”±äºå½“å‰åªæ˜¯ç”¨Sourceï¼Œæ‰€ä»¥ä¸å¼•å…¥Sinkæ¨¡å—\n    // compile \"com.aliyun.openservices:log-loghub-producer:0.1.8\" \n```\nå¯ä»¥çœ‹åˆ°ï¼Œé˜¿é‡Œäº‘æ—¥å¿—é€šè¿‡protobufåè®®è¿›è¡Œåºåˆ—åŒ–ä¼ è¾“ã€‚\n\n## æ—¥å¿—åˆ†æå¯åŠ¨ç±»\nå‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼Œæˆ‘ä»¬é…ç½®äº†é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡çš„é“¾æ¥å±æ€§ï¼ŒæŒ‡å®šäº†æ—¥å¿—æ–‡ä»¶ã€‚\næ­¤å¤–æˆ‘ä»¬è¿˜å®šä¹‰äº†intervalå‚æ•°ä¸ºæ—¥å¿—é—´éš”ï¼›thresholdä¸ºé”™è¯¯æ•°ï¼›nameserverAddressä¸ºå°†é”™è¯¯ä¿¡æ¯å‘é€è‡³RockerMQåœ°å€ã€‚ç»“åˆä¸Šä¸€ç¯‡æ–‡ä»¶ï¼Œå¼‚å¸¸æ¨é€ä»»åŠ¡ä¼šå°†é”™è¯¯ä¿¡æ¯é€šè¿‡wechatæ¨é€ç»™å¹²ç³»äººã€‚\n\n```java\n ParameterTool parameterTool = ParameterTool.fromArgs(args);\n        String interval = parameterTool.get(\"interval\");\n        String threshold = parameterTool.get(\"threshold\");\n        String nameserverAddress = parameterTool.get(\"nameserverAddress\");\n\n        Properties configProps = new Properties();\n        // è®¾ç½®è®¿é—®æ—¥å¿—æœåŠ¡çš„åŸŸå\n        configProps.put(ConfigConstants.LOG_ENDPOINT, \"xxxxxxxxxxxx\");\n        // è®¾ç½®è®¿é—®ak\n        configProps.put(ConfigConstants.LOG_ACCESSSKEYID, \"xxxxxxxx\");\n        configProps.put(ConfigConstants.LOG_ACCESSKEY, \"xxxxxx\");\n        // è®¾ç½®æ—¥å¿—æœåŠ¡çš„project\n        configProps.put(ConfigConstants.LOG_PROJECT, \"xxxxxxx\");\n        // è®¾ç½®æ—¥å¿—æœåŠ¡çš„LogStore\n        configProps.put(ConfigConstants.LOG_LOGSTORE, \"xxxxxxxx\");\n        // è®¾ç½®æ¶ˆè´¹æ—¥å¿—æœåŠ¡èµ·å§‹ä½ç½®\n        configProps.put(ConfigConstants.LOG_CONSUMER_BEGIN_POSITION, Consts.LOG_END_CURSOR);\n        // è®¾ç½®æ—¥å¿—æœåŠ¡çš„æ¶ˆæ¯ååºåˆ—åŒ–æ–¹æ³•\n        RawLogGroupListDeserializer deserializer = new RawLogGroupListDeserializer();\n        final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\n        Properties producerProps = new Properties();\n        producerProps.setProperty(RocketMQConfig.NAME_SERVER_ADDR, nameserverAddress);\n\n        DataStream<RawLogGroupList> logTestStream = env.addSource(\n                new FlinkLogConsumer<RawLogGroupList>(deserializer, configProps));\n```\n\n### è§£æé˜¿é‡Œäº‘æ—¥å¿—å¹¶è½¬æ¢ä¸ºæ—¥å¿—æµ\n```java\nSingleOutputStreamOperator<LogInfo> process = logTestStream\n        .flatMap(new TransLogInfo())\n        .keyBy(\"podName\")\n        .keyBy(\"level\")\n        .process(new SplitLeveProcess());\n```\n\n#### æˆ‘ä»¬é¦–å…ˆå®ç°äº†FlatMapFunctionæ¥å£ï¼Œä¸ºçš„æ˜¯å°†é˜¿é‡Œäº‘çš„æ—¥å¿—æµç»“æ„è§£ææˆæˆ‘ä»¬è‡ªå·±æƒ³è¦çš„æ—¥å¿—ç»“æ„\n```java\npublic class TransLogInfo implements FlatMapFunction<RawLogGroupList, LogInfo> {\n\n\n    @Override\n    public void flatMap(RawLogGroupList value, Collector<LogInfo> out) throws Exception {\n        List<RawLogGroup> rawLogGroups = value.getRawLogGroups();\n        if(rawLogGroups != null){\n            for(RawLogGroup rawLogGroup : rawLogGroups){\n                String nodeIp = \"\";\n                Map<String, String> tags = rawLogGroup.getTags();\n                if(tags != null){\n                    nodeIp = tags.get(\"_node_ip_\");\n                }\n                if(rawLogGroup != null){\n                    List<RawLog> logs = rawLogGroup.getLogs();\n                    if(!CollectionUtils.isEmpty(logs)){\n                        for(RawLog log : logs){\n                            if(log != null){\n                                LogInfo logInfo = new LogInfo();\n                                Map<String, String> contents = log.getContents();\n                                if(contents != null){\n                                    logInfo.setNodeIp(nodeIp);\n                                    logInfo.setReceiveTime(contents.get(\"@timestamp\"));\n                                    logInfo.setLevel(contents.get(\"_level\"));\n                                    logInfo.setAccountId(contents.get(\"accountId\"));\n                                    logInfo.setPodName(contents.get(\"_pod_name_\"));\n                                    logInfo.setTraceId(contents.get(\"traceId\"));\n                                    logInfo.setMessage(contents.get(\"nte_message\"));\n                                    logInfo.setAppName(contents.get(\"appName\"));\n                                }\n                                out.collect(logInfo);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n```\n#### å°†è§£æåçš„æ—¥å¿—æµæŒ‰ç…§å®¹å™¨åå’Œæ—¥å¿—ç­‰çº§åˆ†ç»„(å¦‚æœåªæ˜¯æƒ³å¤„ç†ERRORçº§åˆ«çš„é”™è¯¯ï¼Œä¹Ÿå¯ä»¥ç”¨Filterå¯¹levelè¿›è¡Œè¿‡æ»¤)\n\n#### æˆ‘ä»¬å®ç°äº†KeyedProcessFunctionæ¥å£ï¼Œå°†ERRORæ—¥å¿—åˆ†æµè¿›è¡Œå¤„ç†\n```java\npublic class SplitLeveProcess extends KeyedProcessFunction<Tuple, LogInfo, LogInfo> {\n    private static final String LEVEL_INOF = \"INFO\";\n    private static final String LEVEL_ERROR = \"ERROR\";\n\n    final OutputTag<LogInfo> outputTag = new OutputTag<LogInfo>(\"error-log\"){};\n\n    @Override\n    public void processElement(LogInfo value, Context ctx, Collector<LogInfo> out) throws Exception {\n        if(LEVEL_INOF.equals(value.getLevel())){\n            out.collect(value);\n        }else if(LEVEL_ERROR.equals(value.getLevel())){\n            ctx.output(outputTag,value);\n        }\n    }\n}\n```\n\n#### å¾—åˆ°ERRORæ—¥å¿—ä¾§è¾“å‡ºæµï¼Œå¤„ç†é”™è¯¯æ—¥å¿—æµ\n```java\n        DataStream<LogInfo> errorStream = process.getSideOutput(new OutputTag<LogInfo>(\"error-log\"){});\n        errorStream.keyBy(\"podName\").process(new ErrorProcess(Long.valueOf(interval) * 1000,Integer.valueOf(threshold)))\n//                .setParallelism(4)\n                .map(new ToMessage())\n                .addSink(new RocketMQSink(new SimpleKeyValueSerializationSchema(null, \"body\"),\n                        new DefaultTopicSelector(topic), producerProps).withBatchFlushOnCheckpoint(true));\n```\n\n#### é’ˆå¯¹é”™è¯¯æ—¥å¿—å¤„ç†ï¼ŒåŒæ ·å®ç°äº†KeyedProcessFunctionæ¥å£ï¼Œé€šè¿‡æ³¨å†Œå®šæ—¶å™¨åˆ¤æ–­intervalå‘¨æœŸå†…ï¼Œé”™è¯¯æ•°é‡æ˜¯å¦è¶…è¿‡thresholdã€‚å¦‚æœè¶…è¿‡åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯æµï¼Œäº¤ç”±åé¢çš„ç®—å­å¤„ç†\n\n```java\npublic class ErrorProcess extends KeyedProcessFunction<Tuple, LogInfo, AlertInfo> {\n    private long interval;\n    private int threshold;\n//    private transient SendWechatService sendWechatService;\n    ValueState<Integer> cnt ;\n    ValueState<Long> timer ;\n    ValueState<String> pod ;\n    ValueState<List> errorMsg ;\n\n    public ErrorProcess(long interval,int threshold){\n        this.interval = interval;\n        this.threshold = threshold;\n    }\n\n    @Override\n    public void open(Configuration parameters) throws Exception {\n        super.open(parameters);\n        cnt = getRuntimeContext().getState(new ValueStateDescriptor<Integer>(\"cnt\",Integer.class,0));\n        timer = getRuntimeContext().getState(new ValueStateDescriptor<Long>(\"timer\",Long.class));\n        pod = getRuntimeContext().getState(new ValueStateDescriptor<String>(\"pod\",String.class));\n        errorMsg = getRuntimeContext().getState(new ValueStateDescriptor<>(\"errorMsg\",List.class));\n    }\n\n    @Override\n    public void processElement(LogInfo value, Context ctx, Collector<AlertInfo> out) throws Exception {\n        pod.update(value.getPodName());\n        if(\"ERROR\".equals(value.getLevel())){\n            if(timer.value() == null){\n                ctx.timerService().registerProcessingTimeTimer(ctx.timerService().currentProcessingTime() + interval);\n            }\n            cnt.update(cnt.value() + 1);\n            List em = errorMsg.value();\n            if(em == null){\n                em = new ArrayList();\n            }\n            em.add(value.getMessage());\n            errorMsg.update(em);\n        }else {\n            if(timer.value() != null){\n                ctx.timerService().deleteEventTimeTimer(timer.value());\n                cnt.clear();\n                timer.clear();\n            }\n        }\n    }\n\n    @Override\n    public void onTimer(long timestamp, OnTimerContext ctx, Collector<AlertInfo> out) throws Exception {\n        if(cnt.value() >=threshold){\n            AlertInfo alertInfo = new AlertInfo();\n            alertInfo.setErrorCnt(cnt.value());\n            alertInfo.setLevel(\"ERROR\");\n            alertInfo.setPodName(pod.value());\n            alertInfo.setMg(errorMsg.value());\n            String content = \"In \" + interval/1000 + \" seconds, pod[\" + pod.value()  + \"] over \" + threshold + \" error happened ,error count[\" + cnt.value() + \"]    detail:\" + \"\\n\"  + \"\\n\";\n            for(int i = 1 ;i<=errorMsg.value().size();i++){\n                content = content + \"[\" + i + \"]\" + errorMsg.value().get(i-1) + \"  \" + \"\\n\";\n            }\n            alertInfo.setContent(content);\n            out.collect(alertInfo);\n\n        }\n        cnt.clear();\n        timer.clear();\n        errorMsg.clear();\n    }\n```\n\n#### åç»­ç®—å­å°†é”™è¯¯æ—¥å¿—æµè½¬æ¢æˆæŒ‡å®šç»“æ„ï¼Œå¹¶å‘ç»™RocketMQçš„Sinkï¼Œäº¤ç”±é”™è¯¯æ¨é€ä»»åŠ¡è¿›è¡Œwechatæ¨é€ã€‚\n```java\n    public static class ToMessage implements MapFunction<AlertInfo, String> {\n        @Override\n        public String map(AlertInfo value) throws Exception {\n            JSONObject messageBody = new JSONObject();\n            messageBody.put(\"alertMsg\",value.getContent());\n            messageBody.put(\"alertTo\",\"xxxxx\");\n            messageBody.put(\"bizType\",\"\");\n            return messageBody.toJSONString();\n        }\n    }\n```\n\n## æ€»ç»“\nä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„é”™è¯¯æ—¥å¿—åˆ†æåŠæŠ¥è­¦çš„æµç¨‹ï¼Œä¸‹æ¬¡æˆ‘ä»¬é’ˆå¯¹è¿™ä¸ªæµç¨‹å†å†™ä¸€ç¯‡æµ‹è¯•æ–‡ã€‚åŒæ—¶è¿™ä¸ªæµç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯¹é”™è¯¯æ—¥å¿—æµé‡‡ç”¨çš„æ˜¯ä¾§æµè¾“å‡ºã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬çš„ä¸»æµä¸­ï¼Œæˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šæ­£å¸¸æ—¥å¿—å€¼å¾—æˆ‘ä»¬åˆ†æå’ŒæŒ–æ˜ï¼Œåé¢æˆ‘ä»¬ä¹Ÿä¼šå›´ç»•è¿™äº›æ—¥å¿—æ¥åšäº›æœ‰æ„æ€çš„ä¸œè¥¿ï¼Œé‚£è¿™ä¸€æ¬¡æˆ‘ä»¬å°±å…ˆåˆ°è¿™äº†ã€‚","source":"_posts/åŸºäºFlinkå®ç°ç®€å•çš„æ—¥å¿—å¼‚å¸¸æ¨é€.md","raw":"---\ntitle: åŸºäºFlinkå®ç°ç®€å•çš„æ—¥å¿—å¼‚å¸¸æ¨é€\ndate: 2020-05-30 16:13:42\ntags: \n    - Java\n    - Flink\n    - ç›‘æ§\ncategories :\n    - Technology\n---\n\n## ç›‘æ§ç³»ç»Ÿ\nä¸šåŠ¡ç³»ç»Ÿç»å¸¸ä¼šæ¥å…¥å„ç§ç›‘æ§ç³»ç»Ÿæˆ–APMç³»ç»Ÿï¼Œä»è€Œå®ç°ç”Ÿäº§é—®é¢˜çš„å¿«é€ŸæŠ¥è­¦å’Œå®šä½ã€‚æ¯”å¦‚CATã€PingPongã€skywalkingç­‰ï¼Œè™½ç„¶å®ç°åŸç†å’Œæ¶æ„ç•¥æœ‰ä¸åŒï¼Œä½†éƒ½ä¸ºä¸šåŠ¡ç³»ç»Ÿæä¾›äº†è°ƒç”¨é“¾è·Ÿè¸ªã€å¼‚å¸¸æ—¥å¿—ã€DBå¼‚å¸¸ã€è¿æ¥è¶…æ—¶ã€JVMä¿¡æ¯ç­‰æŠ¥è­¦ã€‚ç”šè‡³æˆ‘ä»¬å¯ä»¥åœ¨ç›‘æ§å¹³å°ä¸Šå®šåˆ¶è‡ªå·±çš„æŠ¥è­¦è§„åˆ™ï¼Œç›‘æ§ç³»ç»Ÿä¼šæ ¹æ®è§„åˆ™å‘å…³ç³»äººæä¾›æŠ¥è­¦ä¿¡æ¯ã€‚\n\nä»¥ä¸Šéƒ½æ˜¯åŸºäºç›‘æ§ç³»ç»Ÿæä¾›çš„åŠŸèƒ½å®ç°å„ä¸ªç»´åº¦çš„æŠ¥è­¦ã€‚æœ€è¿‘åœ¨æ¯é¥¬Flinkï¼Œæ‰€ä»¥æƒ³èƒ½å¦ç”¨Flinkå®ç°ä¸€ä¸ªç®€å•çš„æ—¥å¿—å¼‚å¸¸æŠ¥è­¦ã€‚è¯ä¸å¤šè¯´ï¼Œå¼€å§‹æ’¸ä»£ç ã€‚\n<!-- more -->\n## å¼•å…¥æ—¥å¿—æœåŠ¡ä¾èµ–\nç”±äºç³»ç»Ÿå·²ç»å…¨é¢æ¥å…¥é˜¿é‡Œäº‘æ—¥å¿—å¹³å°ï¼Œå¹¶ä¸”é˜¿é‡Œäº‘ä¹Ÿéå¸¸æœ‰å¥½çš„ä¸ºæˆ‘ä»¬æä¾›äº†Flinké˜¿é‡Œäº‘Sourceçš„å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦å¼•å…¥é˜¿é‡Œäº‘æä¾›çš„jaråŒ…å³å¯ï¼Œçœå»äº†è‡ªå·±å®ç°çš„åŠŸå¤«ã€‚\n\n```yml\n    compile \"com.aliyun.openservices:flink-log-connector:0.1.3\"\n    compile \"com.google.protobuf:protobuf-java:2.5.0\"\n    compile \"com.aliyun.openservices:aliyun-log:0.6.10\"\n    // ç”±äºå½“å‰åªæ˜¯ç”¨Sourceï¼Œæ‰€ä»¥ä¸å¼•å…¥Sinkæ¨¡å—\n    // compile \"com.aliyun.openservices:log-loghub-producer:0.1.8\" \n```\nå¯ä»¥çœ‹åˆ°ï¼Œé˜¿é‡Œäº‘æ—¥å¿—é€šè¿‡protobufåè®®è¿›è¡Œåºåˆ—åŒ–ä¼ è¾“ã€‚\n\n## æ—¥å¿—åˆ†æå¯åŠ¨ç±»\nå‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼Œæˆ‘ä»¬é…ç½®äº†é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡çš„é“¾æ¥å±æ€§ï¼ŒæŒ‡å®šäº†æ—¥å¿—æ–‡ä»¶ã€‚\næ­¤å¤–æˆ‘ä»¬è¿˜å®šä¹‰äº†intervalå‚æ•°ä¸ºæ—¥å¿—é—´éš”ï¼›thresholdä¸ºé”™è¯¯æ•°ï¼›nameserverAddressä¸ºå°†é”™è¯¯ä¿¡æ¯å‘é€è‡³RockerMQåœ°å€ã€‚ç»“åˆä¸Šä¸€ç¯‡æ–‡ä»¶ï¼Œå¼‚å¸¸æ¨é€ä»»åŠ¡ä¼šå°†é”™è¯¯ä¿¡æ¯é€šè¿‡wechatæ¨é€ç»™å¹²ç³»äººã€‚\n\n```java\n ParameterTool parameterTool = ParameterTool.fromArgs(args);\n        String interval = parameterTool.get(\"interval\");\n        String threshold = parameterTool.get(\"threshold\");\n        String nameserverAddress = parameterTool.get(\"nameserverAddress\");\n\n        Properties configProps = new Properties();\n        // è®¾ç½®è®¿é—®æ—¥å¿—æœåŠ¡çš„åŸŸå\n        configProps.put(ConfigConstants.LOG_ENDPOINT, \"xxxxxxxxxxxx\");\n        // è®¾ç½®è®¿é—®ak\n        configProps.put(ConfigConstants.LOG_ACCESSSKEYID, \"xxxxxxxx\");\n        configProps.put(ConfigConstants.LOG_ACCESSKEY, \"xxxxxx\");\n        // è®¾ç½®æ—¥å¿—æœåŠ¡çš„project\n        configProps.put(ConfigConstants.LOG_PROJECT, \"xxxxxxx\");\n        // è®¾ç½®æ—¥å¿—æœåŠ¡çš„LogStore\n        configProps.put(ConfigConstants.LOG_LOGSTORE, \"xxxxxxxx\");\n        // è®¾ç½®æ¶ˆè´¹æ—¥å¿—æœåŠ¡èµ·å§‹ä½ç½®\n        configProps.put(ConfigConstants.LOG_CONSUMER_BEGIN_POSITION, Consts.LOG_END_CURSOR);\n        // è®¾ç½®æ—¥å¿—æœåŠ¡çš„æ¶ˆæ¯ååºåˆ—åŒ–æ–¹æ³•\n        RawLogGroupListDeserializer deserializer = new RawLogGroupListDeserializer();\n        final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\n        Properties producerProps = new Properties();\n        producerProps.setProperty(RocketMQConfig.NAME_SERVER_ADDR, nameserverAddress);\n\n        DataStream<RawLogGroupList> logTestStream = env.addSource(\n                new FlinkLogConsumer<RawLogGroupList>(deserializer, configProps));\n```\n\n### è§£æé˜¿é‡Œäº‘æ—¥å¿—å¹¶è½¬æ¢ä¸ºæ—¥å¿—æµ\n```java\nSingleOutputStreamOperator<LogInfo> process = logTestStream\n        .flatMap(new TransLogInfo())\n        .keyBy(\"podName\")\n        .keyBy(\"level\")\n        .process(new SplitLeveProcess());\n```\n\n#### æˆ‘ä»¬é¦–å…ˆå®ç°äº†FlatMapFunctionæ¥å£ï¼Œä¸ºçš„æ˜¯å°†é˜¿é‡Œäº‘çš„æ—¥å¿—æµç»“æ„è§£ææˆæˆ‘ä»¬è‡ªå·±æƒ³è¦çš„æ—¥å¿—ç»“æ„\n```java\npublic class TransLogInfo implements FlatMapFunction<RawLogGroupList, LogInfo> {\n\n\n    @Override\n    public void flatMap(RawLogGroupList value, Collector<LogInfo> out) throws Exception {\n        List<RawLogGroup> rawLogGroups = value.getRawLogGroups();\n        if(rawLogGroups != null){\n            for(RawLogGroup rawLogGroup : rawLogGroups){\n                String nodeIp = \"\";\n                Map<String, String> tags = rawLogGroup.getTags();\n                if(tags != null){\n                    nodeIp = tags.get(\"_node_ip_\");\n                }\n                if(rawLogGroup != null){\n                    List<RawLog> logs = rawLogGroup.getLogs();\n                    if(!CollectionUtils.isEmpty(logs)){\n                        for(RawLog log : logs){\n                            if(log != null){\n                                LogInfo logInfo = new LogInfo();\n                                Map<String, String> contents = log.getContents();\n                                if(contents != null){\n                                    logInfo.setNodeIp(nodeIp);\n                                    logInfo.setReceiveTime(contents.get(\"@timestamp\"));\n                                    logInfo.setLevel(contents.get(\"_level\"));\n                                    logInfo.setAccountId(contents.get(\"accountId\"));\n                                    logInfo.setPodName(contents.get(\"_pod_name_\"));\n                                    logInfo.setTraceId(contents.get(\"traceId\"));\n                                    logInfo.setMessage(contents.get(\"nte_message\"));\n                                    logInfo.setAppName(contents.get(\"appName\"));\n                                }\n                                out.collect(logInfo);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n```\n#### å°†è§£æåçš„æ—¥å¿—æµæŒ‰ç…§å®¹å™¨åå’Œæ—¥å¿—ç­‰çº§åˆ†ç»„(å¦‚æœåªæ˜¯æƒ³å¤„ç†ERRORçº§åˆ«çš„é”™è¯¯ï¼Œä¹Ÿå¯ä»¥ç”¨Filterå¯¹levelè¿›è¡Œè¿‡æ»¤)\n\n#### æˆ‘ä»¬å®ç°äº†KeyedProcessFunctionæ¥å£ï¼Œå°†ERRORæ—¥å¿—åˆ†æµè¿›è¡Œå¤„ç†\n```java\npublic class SplitLeveProcess extends KeyedProcessFunction<Tuple, LogInfo, LogInfo> {\n    private static final String LEVEL_INOF = \"INFO\";\n    private static final String LEVEL_ERROR = \"ERROR\";\n\n    final OutputTag<LogInfo> outputTag = new OutputTag<LogInfo>(\"error-log\"){};\n\n    @Override\n    public void processElement(LogInfo value, Context ctx, Collector<LogInfo> out) throws Exception {\n        if(LEVEL_INOF.equals(value.getLevel())){\n            out.collect(value);\n        }else if(LEVEL_ERROR.equals(value.getLevel())){\n            ctx.output(outputTag,value);\n        }\n    }\n}\n```\n\n#### å¾—åˆ°ERRORæ—¥å¿—ä¾§è¾“å‡ºæµï¼Œå¤„ç†é”™è¯¯æ—¥å¿—æµ\n```java\n        DataStream<LogInfo> errorStream = process.getSideOutput(new OutputTag<LogInfo>(\"error-log\"){});\n        errorStream.keyBy(\"podName\").process(new ErrorProcess(Long.valueOf(interval) * 1000,Integer.valueOf(threshold)))\n//                .setParallelism(4)\n                .map(new ToMessage())\n                .addSink(new RocketMQSink(new SimpleKeyValueSerializationSchema(null, \"body\"),\n                        new DefaultTopicSelector(topic), producerProps).withBatchFlushOnCheckpoint(true));\n```\n\n#### é’ˆå¯¹é”™è¯¯æ—¥å¿—å¤„ç†ï¼ŒåŒæ ·å®ç°äº†KeyedProcessFunctionæ¥å£ï¼Œé€šè¿‡æ³¨å†Œå®šæ—¶å™¨åˆ¤æ–­intervalå‘¨æœŸå†…ï¼Œé”™è¯¯æ•°é‡æ˜¯å¦è¶…è¿‡thresholdã€‚å¦‚æœè¶…è¿‡åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯æµï¼Œäº¤ç”±åé¢çš„ç®—å­å¤„ç†\n\n```java\npublic class ErrorProcess extends KeyedProcessFunction<Tuple, LogInfo, AlertInfo> {\n    private long interval;\n    private int threshold;\n//    private transient SendWechatService sendWechatService;\n    ValueState<Integer> cnt ;\n    ValueState<Long> timer ;\n    ValueState<String> pod ;\n    ValueState<List> errorMsg ;\n\n    public ErrorProcess(long interval,int threshold){\n        this.interval = interval;\n        this.threshold = threshold;\n    }\n\n    @Override\n    public void open(Configuration parameters) throws Exception {\n        super.open(parameters);\n        cnt = getRuntimeContext().getState(new ValueStateDescriptor<Integer>(\"cnt\",Integer.class,0));\n        timer = getRuntimeContext().getState(new ValueStateDescriptor<Long>(\"timer\",Long.class));\n        pod = getRuntimeContext().getState(new ValueStateDescriptor<String>(\"pod\",String.class));\n        errorMsg = getRuntimeContext().getState(new ValueStateDescriptor<>(\"errorMsg\",List.class));\n    }\n\n    @Override\n    public void processElement(LogInfo value, Context ctx, Collector<AlertInfo> out) throws Exception {\n        pod.update(value.getPodName());\n        if(\"ERROR\".equals(value.getLevel())){\n            if(timer.value() == null){\n                ctx.timerService().registerProcessingTimeTimer(ctx.timerService().currentProcessingTime() + interval);\n            }\n            cnt.update(cnt.value() + 1);\n            List em = errorMsg.value();\n            if(em == null){\n                em = new ArrayList();\n            }\n            em.add(value.getMessage());\n            errorMsg.update(em);\n        }else {\n            if(timer.value() != null){\n                ctx.timerService().deleteEventTimeTimer(timer.value());\n                cnt.clear();\n                timer.clear();\n            }\n        }\n    }\n\n    @Override\n    public void onTimer(long timestamp, OnTimerContext ctx, Collector<AlertInfo> out) throws Exception {\n        if(cnt.value() >=threshold){\n            AlertInfo alertInfo = new AlertInfo();\n            alertInfo.setErrorCnt(cnt.value());\n            alertInfo.setLevel(\"ERROR\");\n            alertInfo.setPodName(pod.value());\n            alertInfo.setMg(errorMsg.value());\n            String content = \"In \" + interval/1000 + \" seconds, pod[\" + pod.value()  + \"] over \" + threshold + \" error happened ,error count[\" + cnt.value() + \"]    detail:\" + \"\\n\"  + \"\\n\";\n            for(int i = 1 ;i<=errorMsg.value().size();i++){\n                content = content + \"[\" + i + \"]\" + errorMsg.value().get(i-1) + \"  \" + \"\\n\";\n            }\n            alertInfo.setContent(content);\n            out.collect(alertInfo);\n\n        }\n        cnt.clear();\n        timer.clear();\n        errorMsg.clear();\n    }\n```\n\n#### åç»­ç®—å­å°†é”™è¯¯æ—¥å¿—æµè½¬æ¢æˆæŒ‡å®šç»“æ„ï¼Œå¹¶å‘ç»™RocketMQçš„Sinkï¼Œäº¤ç”±é”™è¯¯æ¨é€ä»»åŠ¡è¿›è¡Œwechatæ¨é€ã€‚\n```java\n    public static class ToMessage implements MapFunction<AlertInfo, String> {\n        @Override\n        public String map(AlertInfo value) throws Exception {\n            JSONObject messageBody = new JSONObject();\n            messageBody.put(\"alertMsg\",value.getContent());\n            messageBody.put(\"alertTo\",\"xxxxx\");\n            messageBody.put(\"bizType\",\"\");\n            return messageBody.toJSONString();\n        }\n    }\n```\n\n## æ€»ç»“\nä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„é”™è¯¯æ—¥å¿—åˆ†æåŠæŠ¥è­¦çš„æµç¨‹ï¼Œä¸‹æ¬¡æˆ‘ä»¬é’ˆå¯¹è¿™ä¸ªæµç¨‹å†å†™ä¸€ç¯‡æµ‹è¯•æ–‡ã€‚åŒæ—¶è¿™ä¸ªæµç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯¹é”™è¯¯æ—¥å¿—æµé‡‡ç”¨çš„æ˜¯ä¾§æµè¾“å‡ºã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬çš„ä¸»æµä¸­ï¼Œæˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šæ­£å¸¸æ—¥å¿—å€¼å¾—æˆ‘ä»¬åˆ†æå’ŒæŒ–æ˜ï¼Œåé¢æˆ‘ä»¬ä¹Ÿä¼šå›´ç»•è¿™äº›æ—¥å¿—æ¥åšäº›æœ‰æ„æ€çš„ä¸œè¥¿ï¼Œé‚£è¿™ä¸€æ¬¡æˆ‘ä»¬å°±å…ˆåˆ°è¿™äº†ã€‚","slug":"åŸºäºFlinkå®ç°ç®€å•çš„æ—¥å¿—å¼‚å¸¸æ¨é€","published":1,"updated":"2020-12-14T09:51:24.018Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htg000uv25243rb7mpl","content":"<html><head></head><body><h2 id=\"&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;\"><a href=\"#&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;\" class=\"headerlink\" title=\"&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;\"></a>&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;</h2><p>&#x4E1A;&#x52A1;&#x7CFB;&#x7EDF;&#x7ECF;&#x5E38;&#x4F1A;&#x63A5;&#x5165;&#x5404;&#x79CD;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x6216;APM&#x7CFB;&#x7EDF;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x751F;&#x4EA7;&#x95EE;&#x9898;&#x7684;&#x5FEB;&#x901F;&#x62A5;&#x8B66;&#x548C;&#x5B9A;&#x4F4D;&#x3002;&#x6BD4;&#x5982;CAT&#x3001;PingPong&#x3001;skywalking&#x7B49;&#xFF0C;&#x867D;&#x7136;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x548C;&#x67B6;&#x6784;&#x7565;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x4F46;&#x90FD;&#x4E3A;&#x4E1A;&#x52A1;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x4E86;&#x8C03;&#x7528;&#x94FE;&#x8DDF;&#x8E2A;&#x3001;&#x5F02;&#x5E38;&#x65E5;&#x5FD7;&#x3001;DB&#x5F02;&#x5E38;&#x3001;&#x8FDE;&#x63A5;&#x8D85;&#x65F6;&#x3001;JVM&#x4FE1;&#x606F;&#x7B49;&#x62A5;&#x8B66;&#x3002;&#x751A;&#x81F3;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x76D1;&#x63A7;&#x5E73;&#x53F0;&#x4E0A;&#x5B9A;&#x5236;&#x81EA;&#x5DF1;&#x7684;&#x62A5;&#x8B66;&#x89C4;&#x5219;&#xFF0C;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x4F1A;&#x6839;&#x636E;&#x89C4;&#x5219;&#x5411;&#x5173;&#x7CFB;&#x4EBA;&#x63D0;&#x4F9B;&#x62A5;&#x8B66;&#x4FE1;&#x606F;&#x3002;</p>\n<p>&#x4EE5;&#x4E0A;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x7684;&#x529F;&#x80FD;&#x5B9E;&#x73B0;&#x5404;&#x4E2A;&#x7EF4;&#x5EA6;&#x7684;&#x62A5;&#x8B66;&#x3002;&#x6700;&#x8FD1;&#x5728;&#x636F;&#x996C;Flink&#xFF0C;&#x6240;&#x4EE5;&#x60F3;&#x80FD;&#x5426;&#x7528;Flink&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x65E5;&#x5FD7;&#x5F02;&#x5E38;&#x62A5;&#x8B66;&#x3002;&#x8BDD;&#x4E0D;&#x591A;&#x8BF4;&#xFF0C;&#x5F00;&#x59CB;&#x64B8;&#x4EE3;&#x7801;&#x3002;</p>\n<a id=\"more\"></a>\n<h2 id=\"&#x5F15;&#x5165;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x4F9D;&#x8D56;\"><a href=\"#&#x5F15;&#x5165;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x4F9D;&#x8D56;\" class=\"headerlink\" title=\"&#x5F15;&#x5165;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x4F9D;&#x8D56;\"></a>&#x5F15;&#x5165;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x4F9D;&#x8D56;</h2><p>&#x7531;&#x4E8E;&#x7CFB;&#x7EDF;&#x5DF2;&#x7ECF;&#x5168;&#x9762;&#x63A5;&#x5165;&#x963F;&#x91CC;&#x4E91;&#x65E5;&#x5FD7;&#x5E73;&#x53F0;&#xFF0C;&#x5E76;&#x4E14;&#x963F;&#x91CC;&#x4E91;&#x4E5F;&#x975E;&#x5E38;&#x6709;&#x597D;&#x7684;&#x4E3A;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;Flink&#x963F;&#x91CC;&#x4E91;Source&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EA;&#x8981;&#x5F15;&#x5165;&#x963F;&#x91CC;&#x4E91;&#x63D0;&#x4F9B;&#x7684;jar&#x5305;&#x5373;&#x53EF;&#xFF0C;&#x7701;&#x53BB;&#x4E86;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7684;&#x529F;&#x592B;&#x3002;</p>\n<figure class=\"highlight yml hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-string\">compile</span> <span class=\"hljs-string\">&quot;com.aliyun.openservices:flink-log-connector:0.1.3&quot;</span></span><br><span class=\"line\"><span class=\"hljs-string\">compile</span> <span class=\"hljs-string\">&quot;com.google.protobuf:protobuf-java:2.5.0&quot;</span></span><br><span class=\"line\"><span class=\"hljs-string\">compile</span> <span class=\"hljs-string\">&quot;com.aliyun.openservices:aliyun-log:0.6.10&quot;</span></span><br><span class=\"line\"><span class=\"hljs-string\">//</span> <span class=\"hljs-string\">&#x7531;&#x4E8E;&#x5F53;&#x524D;&#x53EA;&#x662F;&#x7528;Source&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x5F15;&#x5165;Sink&#x6A21;&#x5757;</span></span><br><span class=\"line\"><span class=\"hljs-string\">//</span> <span class=\"hljs-string\">compile</span> <span class=\"hljs-string\">&quot;com.aliyun.openservices:log-loghub-producer:0.1.8&quot;</span> </span><br></pre></td></tr></tbody></table></figure>\n<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x963F;&#x91CC;&#x4E91;&#x65E5;&#x5FD7;&#x901A;&#x8FC7;protobuf&#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x5E8F;&#x5217;&#x5316;&#x4F20;&#x8F93;&#x3002;</p>\n<h2 id=\"&#x65E5;&#x5FD7;&#x5206;&#x6790;&#x542F;&#x52A8;&#x7C7B;\"><a href=\"#&#x65E5;&#x5FD7;&#x5206;&#x6790;&#x542F;&#x52A8;&#x7C7B;\" class=\"headerlink\" title=\"&#x65E5;&#x5FD7;&#x5206;&#x6790;&#x542F;&#x52A8;&#x7C7B;\"></a>&#x65E5;&#x5FD7;&#x5206;&#x6790;&#x542F;&#x52A8;&#x7C7B;</h2><p>&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x6587;&#x6863;&#xFF0C;&#x6211;&#x4EEC;&#x914D;&#x7F6E;&#x4E86;&#x963F;&#x91CC;&#x4E91;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x7684;&#x94FE;&#x63A5;&#x5C5E;&#x6027;&#xFF0C;&#x6307;&#x5B9A;&#x4E86;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x3002;<br>&#x6B64;&#x5916;&#x6211;&#x4EEC;&#x8FD8;&#x5B9A;&#x4E49;&#x4E86;interval&#x53C2;&#x6570;&#x4E3A;&#x65E5;&#x5FD7;&#x95F4;&#x9694;&#xFF1B;threshold&#x4E3A;&#x9519;&#x8BEF;&#x6570;&#xFF1B;nameserverAddress&#x4E3A;&#x5C06;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x53D1;&#x9001;&#x81F3;RockerMQ&#x5730;&#x5740;&#x3002;&#x7ED3;&#x5408;&#x4E0A;&#x4E00;&#x7BC7;&#x6587;&#x4EF6;&#xFF0C;&#x5F02;&#x5E38;&#x63A8;&#x9001;&#x4EFB;&#x52A1;&#x4F1A;&#x5C06;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x901A;&#x8FC7;wechat&#x63A8;&#x9001;&#x7ED9;&#x5E72;&#x7CFB;&#x4EBA;&#x3002;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ParameterTool parameterTool = ParameterTool.fromArgs(args);</span><br><span class=\"line\">       String interval = parameterTool.get(<span class=\"hljs-string\">&quot;interval&quot;</span>);</span><br><span class=\"line\">       String threshold = parameterTool.get(<span class=\"hljs-string\">&quot;threshold&quot;</span>);</span><br><span class=\"line\">       String nameserverAddress = parameterTool.get(<span class=\"hljs-string\">&quot;nameserverAddress&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">       Properties configProps = <span class=\"hljs-keyword\">new</span> Properties();</span><br><span class=\"line\">       <span class=\"hljs-comment\">// &#x8BBE;&#x7F6E;&#x8BBF;&#x95EE;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x7684;&#x57DF;&#x540D;</span></span><br><span class=\"line\">       configProps.put(ConfigConstants.LOG_ENDPOINT, <span class=\"hljs-string\">&quot;xxxxxxxxxxxx&quot;</span>);</span><br><span class=\"line\">       <span class=\"hljs-comment\">// &#x8BBE;&#x7F6E;&#x8BBF;&#x95EE;ak</span></span><br><span class=\"line\">       configProps.put(ConfigConstants.LOG_ACCESSSKEYID, <span class=\"hljs-string\">&quot;xxxxxxxx&quot;</span>);</span><br><span class=\"line\">       configProps.put(ConfigConstants.LOG_ACCESSKEY, <span class=\"hljs-string\">&quot;xxxxxx&quot;</span>);</span><br><span class=\"line\">       <span class=\"hljs-comment\">// &#x8BBE;&#x7F6E;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x7684;project</span></span><br><span class=\"line\">       configProps.put(ConfigConstants.LOG_PROJECT, <span class=\"hljs-string\">&quot;xxxxxxx&quot;</span>);</span><br><span class=\"line\">       <span class=\"hljs-comment\">// &#x8BBE;&#x7F6E;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x7684;LogStore</span></span><br><span class=\"line\">       configProps.put(ConfigConstants.LOG_LOGSTORE, <span class=\"hljs-string\">&quot;xxxxxxxx&quot;</span>);</span><br><span class=\"line\">       <span class=\"hljs-comment\">// &#x8BBE;&#x7F6E;&#x6D88;&#x8D39;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x8D77;&#x59CB;&#x4F4D;&#x7F6E;</span></span><br><span class=\"line\">       configProps.put(ConfigConstants.LOG_CONSUMER_BEGIN_POSITION, Consts.LOG_END_CURSOR);</span><br><span class=\"line\">       <span class=\"hljs-comment\">// &#x8BBE;&#x7F6E;&#x65E5;&#x5FD7;&#x670D;&#x52A1;&#x7684;&#x6D88;&#x606F;&#x53CD;&#x5E8F;&#x5217;&#x5316;&#x65B9;&#x6CD5;</span></span><br><span class=\"line\">       RawLogGroupListDeserializer deserializer = <span class=\"hljs-keyword\">new</span> RawLogGroupListDeserializer();</span><br><span class=\"line\">       <span class=\"hljs-keyword\">final</span> StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class=\"line\"></span><br><span class=\"line\">       Properties producerProps = <span class=\"hljs-keyword\">new</span> Properties();</span><br><span class=\"line\">       producerProps.setProperty(RocketMQConfig.NAME_SERVER_ADDR, nameserverAddress);</span><br><span class=\"line\"></span><br><span class=\"line\">       DataStream&lt;RawLogGroupList&gt; logTestStream = env.addSource(</span><br><span class=\"line\">               <span class=\"hljs-keyword\">new</span> FlinkLogConsumer&lt;RawLogGroupList&gt;(deserializer, configProps));</span><br></pre></td></tr></tbody></table></figure>\n\n<h3 id=\"&#x89E3;&#x6790;&#x963F;&#x91CC;&#x4E91;&#x65E5;&#x5FD7;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;&#x65E5;&#x5FD7;&#x6D41;\"><a href=\"#&#x89E3;&#x6790;&#x963F;&#x91CC;&#x4E91;&#x65E5;&#x5FD7;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;&#x65E5;&#x5FD7;&#x6D41;\" class=\"headerlink\" title=\"&#x89E3;&#x6790;&#x963F;&#x91CC;&#x4E91;&#x65E5;&#x5FD7;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;&#x65E5;&#x5FD7;&#x6D41;\"></a>&#x89E3;&#x6790;&#x963F;&#x91CC;&#x4E91;&#x65E5;&#x5FD7;&#x5E76;&#x8F6C;&#x6362;&#x4E3A;&#x65E5;&#x5FD7;&#x6D41;</h3><figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SingleOutputStreamOperator&lt;LogInfo&gt; process = logTestStream</span><br><span class=\"line\">        .flatMap(<span class=\"hljs-keyword\">new</span> TransLogInfo())</span><br><span class=\"line\">        .keyBy(<span class=\"hljs-string\">&quot;podName&quot;</span>)</span><br><span class=\"line\">        .keyBy(<span class=\"hljs-string\">&quot;level&quot;</span>)</span><br><span class=\"line\">        .process(<span class=\"hljs-keyword\">new</span> SplitLeveProcess());</span><br></pre></td></tr></tbody></table></figure>\n\n<h4 id=\"&#x6211;&#x4EEC;&#x9996;&#x5148;&#x5B9E;&#x73B0;&#x4E86;FlatMapFunction&#x63A5;&#x53E3;&#xFF0C;&#x4E3A;&#x7684;&#x662F;&#x5C06;&#x963F;&#x91CC;&#x4E91;&#x7684;&#x65E5;&#x5FD7;&#x6D41;&#x7ED3;&#x6784;&#x89E3;&#x6790;&#x6210;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x60F3;&#x8981;&#x7684;&#x65E5;&#x5FD7;&#x7ED3;&#x6784;\"><a href=\"#&#x6211;&#x4EEC;&#x9996;&#x5148;&#x5B9E;&#x73B0;&#x4E86;FlatMapFunction&#x63A5;&#x53E3;&#xFF0C;&#x4E3A;&#x7684;&#x662F;&#x5C06;&#x963F;&#x91CC;&#x4E91;&#x7684;&#x65E5;&#x5FD7;&#x6D41;&#x7ED3;&#x6784;&#x89E3;&#x6790;&#x6210;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x60F3;&#x8981;&#x7684;&#x65E5;&#x5FD7;&#x7ED3;&#x6784;\" class=\"headerlink\" title=\"&#x6211;&#x4EEC;&#x9996;&#x5148;&#x5B9E;&#x73B0;&#x4E86;FlatMapFunction&#x63A5;&#x53E3;&#xFF0C;&#x4E3A;&#x7684;&#x662F;&#x5C06;&#x963F;&#x91CC;&#x4E91;&#x7684;&#x65E5;&#x5FD7;&#x6D41;&#x7ED3;&#x6784;&#x89E3;&#x6790;&#x6210;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x60F3;&#x8981;&#x7684;&#x65E5;&#x5FD7;&#x7ED3;&#x6784;\"></a>&#x6211;&#x4EEC;&#x9996;&#x5148;&#x5B9E;&#x73B0;&#x4E86;FlatMapFunction&#x63A5;&#x53E3;&#xFF0C;&#x4E3A;&#x7684;&#x662F;&#x5C06;&#x963F;&#x91CC;&#x4E91;&#x7684;&#x65E5;&#x5FD7;&#x6D41;&#x7ED3;&#x6784;&#x89E3;&#x6790;&#x6210;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x60F3;&#x8981;&#x7684;&#x65E5;&#x5FD7;&#x7ED3;&#x6784;</h4><figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TransLogInfo</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">FlatMapFunction</span>&lt;<span class=\"hljs-title\">RawLogGroupList</span>, <span class=\"hljs-title\">LogInfo</span>&gt; </span>{</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">flatMap</span><span class=\"hljs-params\">(RawLogGroupList value, Collector&lt;LogInfo&gt; out)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{</span><br><span class=\"line\">        List&lt;RawLogGroup&gt; rawLogGroups = value.getRawLogGroups();</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span>(rawLogGroups != <span class=\"hljs-keyword\">null</span>){</span><br><span class=\"line\">            <span class=\"hljs-keyword\">for</span>(RawLogGroup rawLogGroup : rawLogGroups){</span><br><span class=\"line\">                String nodeIp = <span class=\"hljs-string\">&quot;&quot;</span>;</span><br><span class=\"line\">                Map&lt;String, String&gt; tags = rawLogGroup.getTags();</span><br><span class=\"line\">                <span class=\"hljs-keyword\">if</span>(tags != <span class=\"hljs-keyword\">null</span>){</span><br><span class=\"line\">                    nodeIp = tags.get(<span class=\"hljs-string\">&quot;_node_ip_&quot;</span>);</span><br><span class=\"line\">                }</span><br><span class=\"line\">                <span class=\"hljs-keyword\">if</span>(rawLogGroup != <span class=\"hljs-keyword\">null</span>){</span><br><span class=\"line\">                    List&lt;RawLog&gt; logs = rawLogGroup.getLogs();</span><br><span class=\"line\">                    <span class=\"hljs-keyword\">if</span>(!CollectionUtils.isEmpty(logs)){</span><br><span class=\"line\">                        <span class=\"hljs-keyword\">for</span>(RawLog log : logs){</span><br><span class=\"line\">                            <span class=\"hljs-keyword\">if</span>(log != <span class=\"hljs-keyword\">null</span>){</span><br><span class=\"line\">                                LogInfo logInfo = <span class=\"hljs-keyword\">new</span> LogInfo();</span><br><span class=\"line\">                                Map&lt;String, String&gt; contents = log.getContents();</span><br><span class=\"line\">                                <span class=\"hljs-keyword\">if</span>(contents != <span class=\"hljs-keyword\">null</span>){</span><br><span class=\"line\">                                    logInfo.setNodeIp(nodeIp);</span><br><span class=\"line\">                                    logInfo.setReceiveTime(contents.get(<span class=\"hljs-string\">&quot;@timestamp&quot;</span>));</span><br><span class=\"line\">                                    logInfo.setLevel(contents.get(<span class=\"hljs-string\">&quot;_level&quot;</span>));</span><br><span class=\"line\">                                    logInfo.setAccountId(contents.get(<span class=\"hljs-string\">&quot;accountId&quot;</span>));</span><br><span class=\"line\">                                    logInfo.setPodName(contents.get(<span class=\"hljs-string\">&quot;_pod_name_&quot;</span>));</span><br><span class=\"line\">                                    logInfo.setTraceId(contents.get(<span class=\"hljs-string\">&quot;traceId&quot;</span>));</span><br><span class=\"line\">                                    logInfo.setMessage(contents.get(<span class=\"hljs-string\">&quot;nte_message&quot;</span>));</span><br><span class=\"line\">                                    logInfo.setAppName(contents.get(<span class=\"hljs-string\">&quot;appName&quot;</span>));</span><br><span class=\"line\">                                }</span><br><span class=\"line\">                                out.collect(logInfo);</span><br><span class=\"line\">                            }</span><br><span class=\"line\">                        }</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></tbody></table></figure>\n<h4 id=\"&#x5C06;&#x89E3;&#x6790;&#x540E;&#x7684;&#x65E5;&#x5FD7;&#x6D41;&#x6309;&#x7167;&#x5BB9;&#x5668;&#x540D;&#x548C;&#x65E5;&#x5FD7;&#x7B49;&#x7EA7;&#x5206;&#x7EC4;-&#x5982;&#x679C;&#x53EA;&#x662F;&#x60F3;&#x5904;&#x7406;ERROR&#x7EA7;&#x522B;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;Filter&#x5BF9;level&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;\"><a href=\"#&#x5C06;&#x89E3;&#x6790;&#x540E;&#x7684;&#x65E5;&#x5FD7;&#x6D41;&#x6309;&#x7167;&#x5BB9;&#x5668;&#x540D;&#x548C;&#x65E5;&#x5FD7;&#x7B49;&#x7EA7;&#x5206;&#x7EC4;-&#x5982;&#x679C;&#x53EA;&#x662F;&#x60F3;&#x5904;&#x7406;ERROR&#x7EA7;&#x522B;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;Filter&#x5BF9;level&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;\" class=\"headerlink\" title=\"&#x5C06;&#x89E3;&#x6790;&#x540E;&#x7684;&#x65E5;&#x5FD7;&#x6D41;&#x6309;&#x7167;&#x5BB9;&#x5668;&#x540D;&#x548C;&#x65E5;&#x5FD7;&#x7B49;&#x7EA7;&#x5206;&#x7EC4;(&#x5982;&#x679C;&#x53EA;&#x662F;&#x60F3;&#x5904;&#x7406;ERROR&#x7EA7;&#x522B;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;Filter&#x5BF9;level&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;)\"></a>&#x5C06;&#x89E3;&#x6790;&#x540E;&#x7684;&#x65E5;&#x5FD7;&#x6D41;&#x6309;&#x7167;&#x5BB9;&#x5668;&#x540D;&#x548C;&#x65E5;&#x5FD7;&#x7B49;&#x7EA7;&#x5206;&#x7EC4;(&#x5982;&#x679C;&#x53EA;&#x662F;&#x60F3;&#x5904;&#x7406;ERROR&#x7EA7;&#x522B;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;Filter&#x5BF9;level&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;)</h4><h4 id=\"&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;KeyedProcessFunction&#x63A5;&#x53E3;&#xFF0C;&#x5C06;ERROR&#x65E5;&#x5FD7;&#x5206;&#x6D41;&#x8FDB;&#x884C;&#x5904;&#x7406;\"><a href=\"#&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;KeyedProcessFunction&#x63A5;&#x53E3;&#xFF0C;&#x5C06;ERROR&#x65E5;&#x5FD7;&#x5206;&#x6D41;&#x8FDB;&#x884C;&#x5904;&#x7406;\" class=\"headerlink\" title=\"&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;KeyedProcessFunction&#x63A5;&#x53E3;&#xFF0C;&#x5C06;ERROR&#x65E5;&#x5FD7;&#x5206;&#x6D41;&#x8FDB;&#x884C;&#x5904;&#x7406;\"></a>&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x4E86;KeyedProcessFunction&#x63A5;&#x53E3;&#xFF0C;&#x5C06;ERROR&#x65E5;&#x5FD7;&#x5206;&#x6D41;&#x8FDB;&#x884C;&#x5904;&#x7406;</h4><figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SplitLeveProcess</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">KeyedProcessFunction</span>&lt;<span class=\"hljs-title\">Tuple</span>, <span class=\"hljs-title\">LogInfo</span>, <span class=\"hljs-title\">LogInfo</span>&gt; </span>{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String LEVEL_INOF = <span class=\"hljs-string\">&quot;INFO&quot;</span>;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String LEVEL_ERROR = <span class=\"hljs-string\">&quot;ERROR&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">final</span> OutputTag&lt;LogInfo&gt; outputTag = <span class=\"hljs-keyword\">new</span> OutputTag&lt;LogInfo&gt;(<span class=\"hljs-string\">&quot;error-log&quot;</span>){};</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">processElement</span><span class=\"hljs-params\">(LogInfo value, Context ctx, Collector&lt;LogInfo&gt; out)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span>(LEVEL_INOF.equals(value.getLevel())){</span><br><span class=\"line\">            out.collect(value);</span><br><span class=\"line\">        }<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(LEVEL_ERROR.equals(value.getLevel())){</span><br><span class=\"line\">            ctx.output(outputTag,value);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<h4 id=\"&#x5F97;&#x5230;ERROR&#x65E5;&#x5FD7;&#x4FA7;&#x8F93;&#x51FA;&#x6D41;&#xFF0C;&#x5904;&#x7406;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x6D41;\"><a href=\"#&#x5F97;&#x5230;ERROR&#x65E5;&#x5FD7;&#x4FA7;&#x8F93;&#x51FA;&#x6D41;&#xFF0C;&#x5904;&#x7406;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x6D41;\" class=\"headerlink\" title=\"&#x5F97;&#x5230;ERROR&#x65E5;&#x5FD7;&#x4FA7;&#x8F93;&#x51FA;&#x6D41;&#xFF0C;&#x5904;&#x7406;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x6D41;\"></a>&#x5F97;&#x5230;ERROR&#x65E5;&#x5FD7;&#x4FA7;&#x8F93;&#x51FA;&#x6D41;&#xFF0C;&#x5904;&#x7406;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x6D41;</h4><figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        DataStream&lt;LogInfo&gt; errorStream = process.getSideOutput(<span class=\"hljs-keyword\">new</span> OutputTag&lt;LogInfo&gt;(<span class=\"hljs-string\">&quot;error-log&quot;</span>){});</span><br><span class=\"line\">        errorStream.keyBy(<span class=\"hljs-string\">&quot;podName&quot;</span>).process(<span class=\"hljs-keyword\">new</span> ErrorProcess(Long.valueOf(interval) * <span class=\"hljs-number\">1000</span>,Integer.valueOf(threshold)))</span><br><span class=\"line\"><span class=\"hljs-comment\">//                .setParallelism(4)</span></span><br><span class=\"line\">                .map(<span class=\"hljs-keyword\">new</span> ToMessage())</span><br><span class=\"line\">                .addSink(<span class=\"hljs-keyword\">new</span> RocketMQSink(<span class=\"hljs-keyword\">new</span> SimpleKeyValueSerializationSchema(<span class=\"hljs-keyword\">null</span>, <span class=\"hljs-string\">&quot;body&quot;</span>),</span><br><span class=\"line\">                        <span class=\"hljs-keyword\">new</span> DefaultTopicSelector(topic), producerProps).withBatchFlushOnCheckpoint(<span class=\"hljs-keyword\">true</span>));</span><br></pre></td></tr></tbody></table></figure>\n\n<h4 id=\"&#x9488;&#x5BF9;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x5904;&#x7406;&#xFF0C;&#x540C;&#x6837;&#x5B9E;&#x73B0;&#x4E86;KeyedProcessFunction&#x63A5;&#x53E3;&#xFF0C;&#x901A;&#x8FC7;&#x6CE8;&#x518C;&#x5B9A;&#x65F6;&#x5668;&#x5224;&#x65AD;interval&#x5468;&#x671F;&#x5185;&#xFF0C;&#x9519;&#x8BEF;&#x6570;&#x91CF;&#x662F;&#x5426;&#x8D85;&#x8FC7;threshold&#x3002;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x5219;&#x8F93;&#x51FA;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x6D41;&#xFF0C;&#x4EA4;&#x7531;&#x540E;&#x9762;&#x7684;&#x7B97;&#x5B50;&#x5904;&#x7406;\"><a href=\"#&#x9488;&#x5BF9;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x5904;&#x7406;&#xFF0C;&#x540C;&#x6837;&#x5B9E;&#x73B0;&#x4E86;KeyedProcessFunction&#x63A5;&#x53E3;&#xFF0C;&#x901A;&#x8FC7;&#x6CE8;&#x518C;&#x5B9A;&#x65F6;&#x5668;&#x5224;&#x65AD;interval&#x5468;&#x671F;&#x5185;&#xFF0C;&#x9519;&#x8BEF;&#x6570;&#x91CF;&#x662F;&#x5426;&#x8D85;&#x8FC7;threshold&#x3002;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x5219;&#x8F93;&#x51FA;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x6D41;&#xFF0C;&#x4EA4;&#x7531;&#x540E;&#x9762;&#x7684;&#x7B97;&#x5B50;&#x5904;&#x7406;\" class=\"headerlink\" title=\"&#x9488;&#x5BF9;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x5904;&#x7406;&#xFF0C;&#x540C;&#x6837;&#x5B9E;&#x73B0;&#x4E86;KeyedProcessFunction&#x63A5;&#x53E3;&#xFF0C;&#x901A;&#x8FC7;&#x6CE8;&#x518C;&#x5B9A;&#x65F6;&#x5668;&#x5224;&#x65AD;interval&#x5468;&#x671F;&#x5185;&#xFF0C;&#x9519;&#x8BEF;&#x6570;&#x91CF;&#x662F;&#x5426;&#x8D85;&#x8FC7;threshold&#x3002;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x5219;&#x8F93;&#x51FA;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x6D41;&#xFF0C;&#x4EA4;&#x7531;&#x540E;&#x9762;&#x7684;&#x7B97;&#x5B50;&#x5904;&#x7406;\"></a>&#x9488;&#x5BF9;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x5904;&#x7406;&#xFF0C;&#x540C;&#x6837;&#x5B9E;&#x73B0;&#x4E86;KeyedProcessFunction&#x63A5;&#x53E3;&#xFF0C;&#x901A;&#x8FC7;&#x6CE8;&#x518C;&#x5B9A;&#x65F6;&#x5668;&#x5224;&#x65AD;interval&#x5468;&#x671F;&#x5185;&#xFF0C;&#x9519;&#x8BEF;&#x6570;&#x91CF;&#x662F;&#x5426;&#x8D85;&#x8FC7;threshold&#x3002;&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x5219;&#x8F93;&#x51FA;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x6D41;&#xFF0C;&#x4EA4;&#x7531;&#x540E;&#x9762;&#x7684;&#x7B97;&#x5B50;&#x5904;&#x7406;</h4><figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ErrorProcess</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">KeyedProcessFunction</span>&lt;<span class=\"hljs-title\">Tuple</span>, <span class=\"hljs-title\">LogInfo</span>, <span class=\"hljs-title\">AlertInfo</span>&gt; </span>{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">long</span> interval;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> threshold;</span><br><span class=\"line\"><span class=\"hljs-comment\">//    private transient SendWechatService sendWechatService;</span></span><br><span class=\"line\">    ValueState&lt;Integer&gt; cnt ;</span><br><span class=\"line\">    ValueState&lt;Long&gt; timer ;</span><br><span class=\"line\">    ValueState&lt;String&gt; pod ;</span><br><span class=\"line\">    ValueState&lt;List&gt; errorMsg ;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">ErrorProcess</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">long</span> interval,<span class=\"hljs-keyword\">int</span> threshold)</span></span>{</span><br><span class=\"line\">        <span class=\"hljs-keyword\">this</span>.interval = interval;</span><br><span class=\"line\">        <span class=\"hljs-keyword\">this</span>.threshold = threshold;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">open</span><span class=\"hljs-params\">(Configuration parameters)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{</span><br><span class=\"line\">        <span class=\"hljs-keyword\">super</span>.open(parameters);</span><br><span class=\"line\">        cnt = getRuntimeContext().getState(<span class=\"hljs-keyword\">new</span> ValueStateDescriptor&lt;Integer&gt;(<span class=\"hljs-string\">&quot;cnt&quot;</span>,Integer.class,<span class=\"hljs-number\">0</span>));</span><br><span class=\"line\">        timer = getRuntimeContext().getState(<span class=\"hljs-keyword\">new</span> ValueStateDescriptor&lt;Long&gt;(<span class=\"hljs-string\">&quot;timer&quot;</span>,Long.class));</span><br><span class=\"line\">        pod = getRuntimeContext().getState(<span class=\"hljs-keyword\">new</span> ValueStateDescriptor&lt;String&gt;(<span class=\"hljs-string\">&quot;pod&quot;</span>,String.class));</span><br><span class=\"line\">        errorMsg = getRuntimeContext().getState(<span class=\"hljs-keyword\">new</span> ValueStateDescriptor&lt;&gt;(<span class=\"hljs-string\">&quot;errorMsg&quot;</span>,List.class));</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">processElement</span><span class=\"hljs-params\">(LogInfo value, Context ctx, Collector&lt;AlertInfo&gt; out)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{</span><br><span class=\"line\">        pod.update(value.getPodName());</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-string\">&quot;ERROR&quot;</span>.equals(value.getLevel())){</span><br><span class=\"line\">            <span class=\"hljs-keyword\">if</span>(timer.value() == <span class=\"hljs-keyword\">null</span>){</span><br><span class=\"line\">                ctx.timerService().registerProcessingTimeTimer(ctx.timerService().currentProcessingTime() + interval);</span><br><span class=\"line\">            }</span><br><span class=\"line\">            cnt.update(cnt.value() + <span class=\"hljs-number\">1</span>);</span><br><span class=\"line\">            List em = errorMsg.value();</span><br><span class=\"line\">            <span class=\"hljs-keyword\">if</span>(em == <span class=\"hljs-keyword\">null</span>){</span><br><span class=\"line\">                em = <span class=\"hljs-keyword\">new</span> ArrayList();</span><br><span class=\"line\">            }</span><br><span class=\"line\">            em.add(value.getMessage());</span><br><span class=\"line\">            errorMsg.update(em);</span><br><span class=\"line\">        }<span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">if</span>(timer.value() != <span class=\"hljs-keyword\">null</span>){</span><br><span class=\"line\">                ctx.timerService().deleteEventTimeTimer(timer.value());</span><br><span class=\"line\">                cnt.clear();</span><br><span class=\"line\">                timer.clear();</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">onTimer</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">long</span> timestamp, OnTimerContext ctx, Collector&lt;AlertInfo&gt; out)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span>(cnt.value() &gt;=threshold){</span><br><span class=\"line\">            AlertInfo alertInfo = <span class=\"hljs-keyword\">new</span> AlertInfo();</span><br><span class=\"line\">            alertInfo.setErrorCnt(cnt.value());</span><br><span class=\"line\">            alertInfo.setLevel(<span class=\"hljs-string\">&quot;ERROR&quot;</span>);</span><br><span class=\"line\">            alertInfo.setPodName(pod.value());</span><br><span class=\"line\">            alertInfo.setMg(errorMsg.value());</span><br><span class=\"line\">            String content = <span class=\"hljs-string\">&quot;In &quot;</span> + interval/<span class=\"hljs-number\">1000</span> + <span class=\"hljs-string\">&quot; seconds, pod[&quot;</span> + pod.value()  + <span class=\"hljs-string\">&quot;] over &quot;</span> + threshold + <span class=\"hljs-string\">&quot; error happened ,error count[&quot;</span> + cnt.value() + <span class=\"hljs-string\">&quot;]    detail:&quot;</span> + <span class=\"hljs-string\">&quot;\\n&quot;</span>  + <span class=\"hljs-string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">            <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">1</span> ;i&lt;=errorMsg.value().size();i++){</span><br><span class=\"line\">                content = content + <span class=\"hljs-string\">&quot;[&quot;</span> + i + <span class=\"hljs-string\">&quot;]&quot;</span> + errorMsg.value().get(i-<span class=\"hljs-number\">1</span>) + <span class=\"hljs-string\">&quot;  &quot;</span> + <span class=\"hljs-string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            alertInfo.setContent(content);</span><br><span class=\"line\">            out.collect(alertInfo);</span><br><span class=\"line\"></span><br><span class=\"line\">        }</span><br><span class=\"line\">        cnt.clear();</span><br><span class=\"line\">        timer.clear();</span><br><span class=\"line\">        errorMsg.clear();</span><br><span class=\"line\">    }</span><br></pre></td></tr></tbody></table></figure>\n\n<h4 id=\"&#x540E;&#x7EED;&#x7B97;&#x5B50;&#x5C06;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x6D41;&#x8F6C;&#x6362;&#x6210;&#x6307;&#x5B9A;&#x7ED3;&#x6784;&#xFF0C;&#x5E76;&#x53D1;&#x7ED9;RocketMQ&#x7684;Sink&#xFF0C;&#x4EA4;&#x7531;&#x9519;&#x8BEF;&#x63A8;&#x9001;&#x4EFB;&#x52A1;&#x8FDB;&#x884C;wechat&#x63A8;&#x9001;&#x3002;\"><a href=\"#&#x540E;&#x7EED;&#x7B97;&#x5B50;&#x5C06;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x6D41;&#x8F6C;&#x6362;&#x6210;&#x6307;&#x5B9A;&#x7ED3;&#x6784;&#xFF0C;&#x5E76;&#x53D1;&#x7ED9;RocketMQ&#x7684;Sink&#xFF0C;&#x4EA4;&#x7531;&#x9519;&#x8BEF;&#x63A8;&#x9001;&#x4EFB;&#x52A1;&#x8FDB;&#x884C;wechat&#x63A8;&#x9001;&#x3002;\" class=\"headerlink\" title=\"&#x540E;&#x7EED;&#x7B97;&#x5B50;&#x5C06;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x6D41;&#x8F6C;&#x6362;&#x6210;&#x6307;&#x5B9A;&#x7ED3;&#x6784;&#xFF0C;&#x5E76;&#x53D1;&#x7ED9;RocketMQ&#x7684;Sink&#xFF0C;&#x4EA4;&#x7531;&#x9519;&#x8BEF;&#x63A8;&#x9001;&#x4EFB;&#x52A1;&#x8FDB;&#x884C;wechat&#x63A8;&#x9001;&#x3002;\"></a>&#x540E;&#x7EED;&#x7B97;&#x5B50;&#x5C06;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x6D41;&#x8F6C;&#x6362;&#x6210;&#x6307;&#x5B9A;&#x7ED3;&#x6784;&#xFF0C;&#x5E76;&#x53D1;&#x7ED9;RocketMQ&#x7684;Sink&#xFF0C;&#x4EA4;&#x7531;&#x9519;&#x8BEF;&#x63A8;&#x9001;&#x4EFB;&#x52A1;&#x8FDB;&#x884C;wechat&#x63A8;&#x9001;&#x3002;</h4><figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ToMessage</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">MapFunction</span>&lt;<span class=\"hljs-title\">AlertInfo</span>, <span class=\"hljs-title\">String</span>&gt; </span>{</span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">map</span><span class=\"hljs-params\">(AlertInfo value)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{</span><br><span class=\"line\">        JSONObject messageBody = <span class=\"hljs-keyword\">new</span> JSONObject();</span><br><span class=\"line\">        messageBody.put(<span class=\"hljs-string\">&quot;alertMsg&quot;</span>,value.getContent());</span><br><span class=\"line\">        messageBody.put(<span class=\"hljs-string\">&quot;alertTo&quot;</span>,<span class=\"hljs-string\">&quot;xxxxx&quot;</span>);</span><br><span class=\"line\">        messageBody.put(<span class=\"hljs-string\">&quot;bizType&quot;</span>,<span class=\"hljs-string\">&quot;&quot;</span>);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> messageBody.toJSONString();</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<h2 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h2><p>&#x4EE5;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x5206;&#x6790;&#x53CA;&#x62A5;&#x8B66;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x4E0B;&#x6B21;&#x6211;&#x4EEC;&#x9488;&#x5BF9;&#x8FD9;&#x4E2A;&#x6D41;&#x7A0B;&#x518D;&#x5199;&#x4E00;&#x7BC7;&#x6D4B;&#x8BD5;&#x6587;&#x3002;&#x540C;&#x65F6;&#x8FD9;&#x4E2A;&#x6D41;&#x7A0B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5BF9;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x6D41;&#x91C7;&#x7528;&#x7684;&#x662F;&#x4FA7;&#x6D41;&#x8F93;&#x51FA;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x4E3B;&#x6D41;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x6709;&#x5F88;&#x591A;&#x6B63;&#x5E38;&#x65E5;&#x5FD7;&#x503C;&#x5F97;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x548C;&#x6316;&#x6398;&#xFF0C;&#x540E;&#x9762;&#x6211;&#x4EEC;&#x4E5F;&#x4F1A;&#x56F4;&#x7ED5;&#x8FD9;&#x4E9B;&#x65E5;&#x5FD7;&#x6765;&#x505A;&#x4E9B;&#x6709;&#x610F;&#x601D;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x90A3;&#x8FD9;&#x4E00;&#x6B21;&#x6211;&#x4EEC;&#x5C31;&#x5148;&#x5230;&#x8FD9;&#x4E86;&#x3002;</p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Flink","path":"tags/Flink/"},{"name":"ç›‘æ§","path":"tags/ç›‘æ§/"}],"excerpt":"<html><head></head><body><h2 id=\"&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;\"><a href=\"#&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;\" class=\"headerlink\" title=\"&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;\"></a>&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;</h2><p>&#x4E1A;&#x52A1;&#x7CFB;&#x7EDF;&#x7ECF;&#x5E38;&#x4F1A;&#x63A5;&#x5165;&#x5404;&#x79CD;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x6216;APM&#x7CFB;&#x7EDF;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x751F;&#x4EA7;&#x95EE;&#x9898;&#x7684;&#x5FEB;&#x901F;&#x62A5;&#x8B66;&#x548C;&#x5B9A;&#x4F4D;&#x3002;&#x6BD4;&#x5982;CAT&#x3001;PingPong&#x3001;skywalking&#x7B49;&#xFF0C;&#x867D;&#x7136;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x548C;&#x67B6;&#x6784;&#x7565;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x4F46;&#x90FD;&#x4E3A;&#x4E1A;&#x52A1;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x4E86;&#x8C03;&#x7528;&#x94FE;&#x8DDF;&#x8E2A;&#x3001;&#x5F02;&#x5E38;&#x65E5;&#x5FD7;&#x3001;DB&#x5F02;&#x5E38;&#x3001;&#x8FDE;&#x63A5;&#x8D85;&#x65F6;&#x3001;JVM&#x4FE1;&#x606F;&#x7B49;&#x62A5;&#x8B66;&#x3002;&#x751A;&#x81F3;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x76D1;&#x63A7;&#x5E73;&#x53F0;&#x4E0A;&#x5B9A;&#x5236;&#x81EA;&#x5DF1;&#x7684;&#x62A5;&#x8B66;&#x89C4;&#x5219;&#xFF0C;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x4F1A;&#x6839;&#x636E;&#x89C4;&#x5219;&#x5411;&#x5173;&#x7CFB;&#x4EBA;&#x63D0;&#x4F9B;&#x62A5;&#x8B66;&#x4FE1;&#x606F;&#x3002;</p>\n<p>&#x4EE5;&#x4E0A;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x7684;&#x529F;&#x80FD;&#x5B9E;&#x73B0;&#x5404;&#x4E2A;&#x7EF4;&#x5EA6;&#x7684;&#x62A5;&#x8B66;&#x3002;&#x6700;&#x8FD1;&#x5728;&#x636F;&#x996C;Flink&#xFF0C;&#x6240;&#x4EE5;&#x60F3;&#x80FD;&#x5426;&#x7528;Flink&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x65E5;&#x5FD7;&#x5F02;&#x5E38;&#x62A5;&#x8B66;&#x3002;&#x8BDD;&#x4E0D;&#x591A;&#x8BF4;&#xFF0C;&#x5F00;&#x59CB;&#x64B8;&#x4EE3;&#x7801;&#x3002;</p></body></html>","more":"<h2 id=\"å¼•å…¥æ—¥å¿—æœåŠ¡ä¾èµ–\"><a href=\"#å¼•å…¥æ—¥å¿—æœåŠ¡ä¾èµ–\" class=\"headerlink\" title=\"å¼•å…¥æ—¥å¿—æœåŠ¡ä¾èµ–\"></a>å¼•å…¥æ—¥å¿—æœåŠ¡ä¾èµ–</h2><p>ç”±äºç³»ç»Ÿå·²ç»å…¨é¢æ¥å…¥é˜¿é‡Œäº‘æ—¥å¿—å¹³å°ï¼Œå¹¶ä¸”é˜¿é‡Œäº‘ä¹Ÿéå¸¸æœ‰å¥½çš„ä¸ºæˆ‘ä»¬æä¾›äº†Flinké˜¿é‡Œäº‘Sourceçš„å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦å¼•å…¥é˜¿é‡Œäº‘æä¾›çš„jaråŒ…å³å¯ï¼Œçœå»äº†è‡ªå·±å®ç°çš„åŠŸå¤«ã€‚</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">compile</span> <span class=\"string\">&quot;com.aliyun.openservices:flink-log-connector:0.1.3&quot;</span></span><br><span class=\"line\"><span class=\"string\">compile</span> <span class=\"string\">&quot;com.google.protobuf:protobuf-java:2.5.0&quot;</span></span><br><span class=\"line\"><span class=\"string\">compile</span> <span class=\"string\">&quot;com.aliyun.openservices:aliyun-log:0.6.10&quot;</span></span><br><span class=\"line\"><span class=\"string\">//</span> <span class=\"string\">ç”±äºå½“å‰åªæ˜¯ç”¨Sourceï¼Œæ‰€ä»¥ä¸å¼•å…¥Sinkæ¨¡å—</span></span><br><span class=\"line\"><span class=\"string\">//</span> <span class=\"string\">compile</span> <span class=\"string\">&quot;com.aliyun.openservices:log-loghub-producer:0.1.8&quot;</span> </span><br></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œé˜¿é‡Œäº‘æ—¥å¿—é€šè¿‡protobufåè®®è¿›è¡Œåºåˆ—åŒ–ä¼ è¾“ã€‚</p>\n<h2 id=\"æ—¥å¿—åˆ†æå¯åŠ¨ç±»\"><a href=\"#æ—¥å¿—åˆ†æå¯åŠ¨ç±»\" class=\"headerlink\" title=\"æ—¥å¿—åˆ†æå¯åŠ¨ç±»\"></a>æ—¥å¿—åˆ†æå¯åŠ¨ç±»</h2><p>å‚è€ƒå®˜ç½‘æ–‡æ¡£ï¼Œæˆ‘ä»¬é…ç½®äº†é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡çš„é“¾æ¥å±æ€§ï¼ŒæŒ‡å®šäº†æ—¥å¿—æ–‡ä»¶ã€‚<br>æ­¤å¤–æˆ‘ä»¬è¿˜å®šä¹‰äº†intervalå‚æ•°ä¸ºæ—¥å¿—é—´éš”ï¼›thresholdä¸ºé”™è¯¯æ•°ï¼›nameserverAddressä¸ºå°†é”™è¯¯ä¿¡æ¯å‘é€è‡³RockerMQåœ°å€ã€‚ç»“åˆä¸Šä¸€ç¯‡æ–‡ä»¶ï¼Œå¼‚å¸¸æ¨é€ä»»åŠ¡ä¼šå°†é”™è¯¯ä¿¡æ¯é€šè¿‡wechatæ¨é€ç»™å¹²ç³»äººã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ParameterTool parameterTool = ParameterTool.fromArgs(args);</span><br><span class=\"line\">       String interval = parameterTool.get(<span class=\"string\">&quot;interval&quot;</span>);</span><br><span class=\"line\">       String threshold = parameterTool.get(<span class=\"string\">&quot;threshold&quot;</span>);</span><br><span class=\"line\">       String nameserverAddress = parameterTool.get(<span class=\"string\">&quot;nameserverAddress&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">       Properties configProps = <span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">       <span class=\"comment\">// è®¾ç½®è®¿é—®æ—¥å¿—æœåŠ¡çš„åŸŸå</span></span><br><span class=\"line\">       configProps.put(ConfigConstants.LOG_ENDPOINT, <span class=\"string\">&quot;xxxxxxxxxxxx&quot;</span>);</span><br><span class=\"line\">       <span class=\"comment\">// è®¾ç½®è®¿é—®ak</span></span><br><span class=\"line\">       configProps.put(ConfigConstants.LOG_ACCESSSKEYID, <span class=\"string\">&quot;xxxxxxxx&quot;</span>);</span><br><span class=\"line\">       configProps.put(ConfigConstants.LOG_ACCESSKEY, <span class=\"string\">&quot;xxxxxx&quot;</span>);</span><br><span class=\"line\">       <span class=\"comment\">// è®¾ç½®æ—¥å¿—æœåŠ¡çš„project</span></span><br><span class=\"line\">       configProps.put(ConfigConstants.LOG_PROJECT, <span class=\"string\">&quot;xxxxxxx&quot;</span>);</span><br><span class=\"line\">       <span class=\"comment\">// è®¾ç½®æ—¥å¿—æœåŠ¡çš„LogStore</span></span><br><span class=\"line\">       configProps.put(ConfigConstants.LOG_LOGSTORE, <span class=\"string\">&quot;xxxxxxxx&quot;</span>);</span><br><span class=\"line\">       <span class=\"comment\">// è®¾ç½®æ¶ˆè´¹æ—¥å¿—æœåŠ¡èµ·å§‹ä½ç½®</span></span><br><span class=\"line\">       configProps.put(ConfigConstants.LOG_CONSUMER_BEGIN_POSITION, Consts.LOG_END_CURSOR);</span><br><span class=\"line\">       <span class=\"comment\">// è®¾ç½®æ—¥å¿—æœåŠ¡çš„æ¶ˆæ¯ååºåˆ—åŒ–æ–¹æ³•</span></span><br><span class=\"line\">       RawLogGroupListDeserializer deserializer = <span class=\"keyword\">new</span> RawLogGroupListDeserializer();</span><br><span class=\"line\">       <span class=\"keyword\">final</span> StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class=\"line\"></span><br><span class=\"line\">       Properties producerProps = <span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">       producerProps.setProperty(RocketMQConfig.NAME_SERVER_ADDR, nameserverAddress);</span><br><span class=\"line\"></span><br><span class=\"line\">       DataStream&lt;RawLogGroupList&gt; logTestStream = env.addSource(</span><br><span class=\"line\">               <span class=\"keyword\">new</span> FlinkLogConsumer&lt;RawLogGroupList&gt;(deserializer, configProps));</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"è§£æé˜¿é‡Œäº‘æ—¥å¿—å¹¶è½¬æ¢ä¸ºæ—¥å¿—æµ\"><a href=\"#è§£æé˜¿é‡Œäº‘æ—¥å¿—å¹¶è½¬æ¢ä¸ºæ—¥å¿—æµ\" class=\"headerlink\" title=\"è§£æé˜¿é‡Œäº‘æ—¥å¿—å¹¶è½¬æ¢ä¸ºæ—¥å¿—æµ\"></a>è§£æé˜¿é‡Œäº‘æ—¥å¿—å¹¶è½¬æ¢ä¸ºæ—¥å¿—æµ</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SingleOutputStreamOperator&lt;LogInfo&gt; process = logTestStream</span><br><span class=\"line\">        .flatMap(<span class=\"keyword\">new</span> TransLogInfo())</span><br><span class=\"line\">        .keyBy(<span class=\"string\">&quot;podName&quot;</span>)</span><br><span class=\"line\">        .keyBy(<span class=\"string\">&quot;level&quot;</span>)</span><br><span class=\"line\">        .process(<span class=\"keyword\">new</span> SplitLeveProcess());</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"æˆ‘ä»¬é¦–å…ˆå®ç°äº†FlatMapFunctionæ¥å£ï¼Œä¸ºçš„æ˜¯å°†é˜¿é‡Œäº‘çš„æ—¥å¿—æµç»“æ„è§£ææˆæˆ‘ä»¬è‡ªå·±æƒ³è¦çš„æ—¥å¿—ç»“æ„\"><a href=\"#æˆ‘ä»¬é¦–å…ˆå®ç°äº†FlatMapFunctionæ¥å£ï¼Œä¸ºçš„æ˜¯å°†é˜¿é‡Œäº‘çš„æ—¥å¿—æµç»“æ„è§£ææˆæˆ‘ä»¬è‡ªå·±æƒ³è¦çš„æ—¥å¿—ç»“æ„\" class=\"headerlink\" title=\"æˆ‘ä»¬é¦–å…ˆå®ç°äº†FlatMapFunctionæ¥å£ï¼Œä¸ºçš„æ˜¯å°†é˜¿é‡Œäº‘çš„æ—¥å¿—æµç»“æ„è§£ææˆæˆ‘ä»¬è‡ªå·±æƒ³è¦çš„æ—¥å¿—ç»“æ„\"></a>æˆ‘ä»¬é¦–å…ˆå®ç°äº†FlatMapFunctionæ¥å£ï¼Œä¸ºçš„æ˜¯å°†é˜¿é‡Œäº‘çš„æ—¥å¿—æµç»“æ„è§£ææˆæˆ‘ä»¬è‡ªå·±æƒ³è¦çš„æ—¥å¿—ç»“æ„</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TransLogInfo</span> <span class=\"keyword\">implements</span> <span class=\"title\">FlatMapFunction</span>&lt;<span class=\"title\">RawLogGroupList</span>, <span class=\"title\">LogInfo</span>&gt; </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">flatMap</span><span class=\"params\">(RawLogGroupList value, Collector&lt;LogInfo&gt; out)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        List&lt;RawLogGroup&gt; rawLogGroups = value.getRawLogGroups();</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(rawLogGroups != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(RawLogGroup rawLogGroup : rawLogGroups)&#123;</span><br><span class=\"line\">                String nodeIp = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">                Map&lt;String, String&gt; tags = rawLogGroup.getTags();</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(tags != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                    nodeIp = tags.get(<span class=\"string\">&quot;_node_ip_&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(rawLogGroup != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                    List&lt;RawLog&gt; logs = rawLogGroup.getLogs();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(!CollectionUtils.isEmpty(logs))&#123;</span><br><span class=\"line\">                        <span class=\"keyword\">for</span>(RawLog log : logs)&#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span>(log != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                                LogInfo logInfo = <span class=\"keyword\">new</span> LogInfo();</span><br><span class=\"line\">                                Map&lt;String, String&gt; contents = log.getContents();</span><br><span class=\"line\">                                <span class=\"keyword\">if</span>(contents != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                                    logInfo.setNodeIp(nodeIp);</span><br><span class=\"line\">                                    logInfo.setReceiveTime(contents.get(<span class=\"string\">&quot;@timestamp&quot;</span>));</span><br><span class=\"line\">                                    logInfo.setLevel(contents.get(<span class=\"string\">&quot;_level&quot;</span>));</span><br><span class=\"line\">                                    logInfo.setAccountId(contents.get(<span class=\"string\">&quot;accountId&quot;</span>));</span><br><span class=\"line\">                                    logInfo.setPodName(contents.get(<span class=\"string\">&quot;_pod_name_&quot;</span>));</span><br><span class=\"line\">                                    logInfo.setTraceId(contents.get(<span class=\"string\">&quot;traceId&quot;</span>));</span><br><span class=\"line\">                                    logInfo.setMessage(contents.get(<span class=\"string\">&quot;nte_message&quot;</span>));</span><br><span class=\"line\">                                    logInfo.setAppName(contents.get(<span class=\"string\">&quot;appName&quot;</span>));</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                                out.collect(logInfo);</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"å°†è§£æåçš„æ—¥å¿—æµæŒ‰ç…§å®¹å™¨åå’Œæ—¥å¿—ç­‰çº§åˆ†ç»„-å¦‚æœåªæ˜¯æƒ³å¤„ç†ERRORçº§åˆ«çš„é”™è¯¯ï¼Œä¹Ÿå¯ä»¥ç”¨Filterå¯¹levelè¿›è¡Œè¿‡æ»¤\"><a href=\"#å°†è§£æåçš„æ—¥å¿—æµæŒ‰ç…§å®¹å™¨åå’Œæ—¥å¿—ç­‰çº§åˆ†ç»„-å¦‚æœåªæ˜¯æƒ³å¤„ç†ERRORçº§åˆ«çš„é”™è¯¯ï¼Œä¹Ÿå¯ä»¥ç”¨Filterå¯¹levelè¿›è¡Œè¿‡æ»¤\" class=\"headerlink\" title=\"å°†è§£æåçš„æ—¥å¿—æµæŒ‰ç…§å®¹å™¨åå’Œæ—¥å¿—ç­‰çº§åˆ†ç»„(å¦‚æœåªæ˜¯æƒ³å¤„ç†ERRORçº§åˆ«çš„é”™è¯¯ï¼Œä¹Ÿå¯ä»¥ç”¨Filterå¯¹levelè¿›è¡Œè¿‡æ»¤)\"></a>å°†è§£æåçš„æ—¥å¿—æµæŒ‰ç…§å®¹å™¨åå’Œæ—¥å¿—ç­‰çº§åˆ†ç»„(å¦‚æœåªæ˜¯æƒ³å¤„ç†ERRORçº§åˆ«çš„é”™è¯¯ï¼Œä¹Ÿå¯ä»¥ç”¨Filterå¯¹levelè¿›è¡Œè¿‡æ»¤)</h4><h4 id=\"æˆ‘ä»¬å®ç°äº†KeyedProcessFunctionæ¥å£ï¼Œå°†ERRORæ—¥å¿—åˆ†æµè¿›è¡Œå¤„ç†\"><a href=\"#æˆ‘ä»¬å®ç°äº†KeyedProcessFunctionæ¥å£ï¼Œå°†ERRORæ—¥å¿—åˆ†æµè¿›è¡Œå¤„ç†\" class=\"headerlink\" title=\"æˆ‘ä»¬å®ç°äº†KeyedProcessFunctionæ¥å£ï¼Œå°†ERRORæ—¥å¿—åˆ†æµè¿›è¡Œå¤„ç†\"></a>æˆ‘ä»¬å®ç°äº†KeyedProcessFunctionæ¥å£ï¼Œå°†ERRORæ—¥å¿—åˆ†æµè¿›è¡Œå¤„ç†</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SplitLeveProcess</span> <span class=\"keyword\">extends</span> <span class=\"title\">KeyedProcessFunction</span>&lt;<span class=\"title\">Tuple</span>, <span class=\"title\">LogInfo</span>, <span class=\"title\">LogInfo</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String LEVEL_INOF = <span class=\"string\">&quot;INFO&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> String LEVEL_ERROR = <span class=\"string\">&quot;ERROR&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">final</span> OutputTag&lt;LogInfo&gt; outputTag = <span class=\"keyword\">new</span> OutputTag&lt;LogInfo&gt;(<span class=\"string\">&quot;error-log&quot;</span>)&#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">processElement</span><span class=\"params\">(LogInfo value, Context ctx, Collector&lt;LogInfo&gt; out)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(LEVEL_INOF.equals(value.getLevel()))&#123;</span><br><span class=\"line\">            out.collect(value);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(LEVEL_ERROR.equals(value.getLevel()))&#123;</span><br><span class=\"line\">            ctx.output(outputTag,value);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"å¾—åˆ°ERRORæ—¥å¿—ä¾§è¾“å‡ºæµï¼Œå¤„ç†é”™è¯¯æ—¥å¿—æµ\"><a href=\"#å¾—åˆ°ERRORæ—¥å¿—ä¾§è¾“å‡ºæµï¼Œå¤„ç†é”™è¯¯æ—¥å¿—æµ\" class=\"headerlink\" title=\"å¾—åˆ°ERRORæ—¥å¿—ä¾§è¾“å‡ºæµï¼Œå¤„ç†é”™è¯¯æ—¥å¿—æµ\"></a>å¾—åˆ°ERRORæ—¥å¿—ä¾§è¾“å‡ºæµï¼Œå¤„ç†é”™è¯¯æ—¥å¿—æµ</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        DataStream&lt;LogInfo&gt; errorStream = process.getSideOutput(<span class=\"keyword\">new</span> OutputTag&lt;LogInfo&gt;(<span class=\"string\">&quot;error-log&quot;</span>)&#123;&#125;);</span><br><span class=\"line\">        errorStream.keyBy(<span class=\"string\">&quot;podName&quot;</span>).process(<span class=\"keyword\">new</span> ErrorProcess(Long.valueOf(interval) * <span class=\"number\">1000</span>,Integer.valueOf(threshold)))</span><br><span class=\"line\"><span class=\"comment\">//                .setParallelism(4)</span></span><br><span class=\"line\">                .map(<span class=\"keyword\">new</span> ToMessage())</span><br><span class=\"line\">                .addSink(<span class=\"keyword\">new</span> RocketMQSink(<span class=\"keyword\">new</span> SimpleKeyValueSerializationSchema(<span class=\"keyword\">null</span>, <span class=\"string\">&quot;body&quot;</span>),</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> DefaultTopicSelector(topic), producerProps).withBatchFlushOnCheckpoint(<span class=\"keyword\">true</span>));</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"é’ˆå¯¹é”™è¯¯æ—¥å¿—å¤„ç†ï¼ŒåŒæ ·å®ç°äº†KeyedProcessFunctionæ¥å£ï¼Œé€šè¿‡æ³¨å†Œå®šæ—¶å™¨åˆ¤æ–­intervalå‘¨æœŸå†…ï¼Œé”™è¯¯æ•°é‡æ˜¯å¦è¶…è¿‡thresholdã€‚å¦‚æœè¶…è¿‡åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯æµï¼Œäº¤ç”±åé¢çš„ç®—å­å¤„ç†\"><a href=\"#é’ˆå¯¹é”™è¯¯æ—¥å¿—å¤„ç†ï¼ŒåŒæ ·å®ç°äº†KeyedProcessFunctionæ¥å£ï¼Œé€šè¿‡æ³¨å†Œå®šæ—¶å™¨åˆ¤æ–­intervalå‘¨æœŸå†…ï¼Œé”™è¯¯æ•°é‡æ˜¯å¦è¶…è¿‡thresholdã€‚å¦‚æœè¶…è¿‡åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯æµï¼Œäº¤ç”±åé¢çš„ç®—å­å¤„ç†\" class=\"headerlink\" title=\"é’ˆå¯¹é”™è¯¯æ—¥å¿—å¤„ç†ï¼ŒåŒæ ·å®ç°äº†KeyedProcessFunctionæ¥å£ï¼Œé€šè¿‡æ³¨å†Œå®šæ—¶å™¨åˆ¤æ–­intervalå‘¨æœŸå†…ï¼Œé”™è¯¯æ•°é‡æ˜¯å¦è¶…è¿‡thresholdã€‚å¦‚æœè¶…è¿‡åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯æµï¼Œäº¤ç”±åé¢çš„ç®—å­å¤„ç†\"></a>é’ˆå¯¹é”™è¯¯æ—¥å¿—å¤„ç†ï¼ŒåŒæ ·å®ç°äº†KeyedProcessFunctionæ¥å£ï¼Œé€šè¿‡æ³¨å†Œå®šæ—¶å™¨åˆ¤æ–­intervalå‘¨æœŸå†…ï¼Œé”™è¯¯æ•°é‡æ˜¯å¦è¶…è¿‡thresholdã€‚å¦‚æœè¶…è¿‡åˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯æµï¼Œäº¤ç”±åé¢çš„ç®—å­å¤„ç†</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ErrorProcess</span> <span class=\"keyword\">extends</span> <span class=\"title\">KeyedProcessFunction</span>&lt;<span class=\"title\">Tuple</span>, <span class=\"title\">LogInfo</span>, <span class=\"title\">AlertInfo</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> interval;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> threshold;</span><br><span class=\"line\"><span class=\"comment\">//    private transient SendWechatService sendWechatService;</span></span><br><span class=\"line\">    ValueState&lt;Integer&gt; cnt ;</span><br><span class=\"line\">    ValueState&lt;Long&gt; timer ;</span><br><span class=\"line\">    ValueState&lt;String&gt; pod ;</span><br><span class=\"line\">    ValueState&lt;List&gt; errorMsg ;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ErrorProcess</span><span class=\"params\">(<span class=\"keyword\">long</span> interval,<span class=\"keyword\">int</span> threshold)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.interval = interval;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.threshold = threshold;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">open</span><span class=\"params\">(Configuration parameters)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.open(parameters);</span><br><span class=\"line\">        cnt = getRuntimeContext().getState(<span class=\"keyword\">new</span> ValueStateDescriptor&lt;Integer&gt;(<span class=\"string\">&quot;cnt&quot;</span>,Integer.class,<span class=\"number\">0</span>));</span><br><span class=\"line\">        timer = getRuntimeContext().getState(<span class=\"keyword\">new</span> ValueStateDescriptor&lt;Long&gt;(<span class=\"string\">&quot;timer&quot;</span>,Long.class));</span><br><span class=\"line\">        pod = getRuntimeContext().getState(<span class=\"keyword\">new</span> ValueStateDescriptor&lt;String&gt;(<span class=\"string\">&quot;pod&quot;</span>,String.class));</span><br><span class=\"line\">        errorMsg = getRuntimeContext().getState(<span class=\"keyword\">new</span> ValueStateDescriptor&lt;&gt;(<span class=\"string\">&quot;errorMsg&quot;</span>,List.class));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">processElement</span><span class=\"params\">(LogInfo value, Context ctx, Collector&lt;AlertInfo&gt; out)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        pod.update(value.getPodName());</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"string\">&quot;ERROR&quot;</span>.equals(value.getLevel()))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(timer.value() == <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                ctx.timerService().registerProcessingTimeTimer(ctx.timerService().currentProcessingTime() + interval);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            cnt.update(cnt.value() + <span class=\"number\">1</span>);</span><br><span class=\"line\">            List em = errorMsg.value();</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(em == <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                em = <span class=\"keyword\">new</span> ArrayList();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            em.add(value.getMessage());</span><br><span class=\"line\">            errorMsg.update(em);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(timer.value() != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">                ctx.timerService().deleteEventTimeTimer(timer.value());</span><br><span class=\"line\">                cnt.clear();</span><br><span class=\"line\">                timer.clear();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onTimer</span><span class=\"params\">(<span class=\"keyword\">long</span> timestamp, OnTimerContext ctx, Collector&lt;AlertInfo&gt; out)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(cnt.value() &gt;=threshold)&#123;</span><br><span class=\"line\">            AlertInfo alertInfo = <span class=\"keyword\">new</span> AlertInfo();</span><br><span class=\"line\">            alertInfo.setErrorCnt(cnt.value());</span><br><span class=\"line\">            alertInfo.setLevel(<span class=\"string\">&quot;ERROR&quot;</span>);</span><br><span class=\"line\">            alertInfo.setPodName(pod.value());</span><br><span class=\"line\">            alertInfo.setMg(errorMsg.value());</span><br><span class=\"line\">            String content = <span class=\"string\">&quot;In &quot;</span> + interval/<span class=\"number\">1000</span> + <span class=\"string\">&quot; seconds, pod[&quot;</span> + pod.value()  + <span class=\"string\">&quot;] over &quot;</span> + threshold + <span class=\"string\">&quot; error happened ,error count[&quot;</span> + cnt.value() + <span class=\"string\">&quot;]    detail:&quot;</span> + <span class=\"string\">&quot;\\n&quot;</span>  + <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">1</span> ;i&lt;=errorMsg.value().size();i++)&#123;</span><br><span class=\"line\">                content = content + <span class=\"string\">&quot;[&quot;</span> + i + <span class=\"string\">&quot;]&quot;</span> + errorMsg.value().get(i-<span class=\"number\">1</span>) + <span class=\"string\">&quot;  &quot;</span> + <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            alertInfo.setContent(content);</span><br><span class=\"line\">            out.collect(alertInfo);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        cnt.clear();</span><br><span class=\"line\">        timer.clear();</span><br><span class=\"line\">        errorMsg.clear();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"åç»­ç®—å­å°†é”™è¯¯æ—¥å¿—æµè½¬æ¢æˆæŒ‡å®šç»“æ„ï¼Œå¹¶å‘ç»™RocketMQçš„Sinkï¼Œäº¤ç”±é”™è¯¯æ¨é€ä»»åŠ¡è¿›è¡Œwechatæ¨é€ã€‚\"><a href=\"#åç»­ç®—å­å°†é”™è¯¯æ—¥å¿—æµè½¬æ¢æˆæŒ‡å®šç»“æ„ï¼Œå¹¶å‘ç»™RocketMQçš„Sinkï¼Œäº¤ç”±é”™è¯¯æ¨é€ä»»åŠ¡è¿›è¡Œwechatæ¨é€ã€‚\" class=\"headerlink\" title=\"åç»­ç®—å­å°†é”™è¯¯æ—¥å¿—æµè½¬æ¢æˆæŒ‡å®šç»“æ„ï¼Œå¹¶å‘ç»™RocketMQçš„Sinkï¼Œäº¤ç”±é”™è¯¯æ¨é€ä»»åŠ¡è¿›è¡Œwechatæ¨é€ã€‚\"></a>åç»­ç®—å­å°†é”™è¯¯æ—¥å¿—æµè½¬æ¢æˆæŒ‡å®šç»“æ„ï¼Œå¹¶å‘ç»™RocketMQçš„Sinkï¼Œäº¤ç”±é”™è¯¯æ¨é€ä»»åŠ¡è¿›è¡Œwechatæ¨é€ã€‚</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ToMessage</span> <span class=\"keyword\">implements</span> <span class=\"title\">MapFunction</span>&lt;<span class=\"title\">AlertInfo</span>, <span class=\"title\">String</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">map</span><span class=\"params\">(AlertInfo value)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        JSONObject messageBody = <span class=\"keyword\">new</span> JSONObject();</span><br><span class=\"line\">        messageBody.put(<span class=\"string\">&quot;alertMsg&quot;</span>,value.getContent());</span><br><span class=\"line\">        messageBody.put(<span class=\"string\">&quot;alertTo&quot;</span>,<span class=\"string\">&quot;xxxxx&quot;</span>);</span><br><span class=\"line\">        messageBody.put(<span class=\"string\">&quot;bizType&quot;</span>,<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> messageBody.toJSONString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„é”™è¯¯æ—¥å¿—åˆ†æåŠæŠ¥è­¦çš„æµç¨‹ï¼Œä¸‹æ¬¡æˆ‘ä»¬é’ˆå¯¹è¿™ä¸ªæµç¨‹å†å†™ä¸€ç¯‡æµ‹è¯•æ–‡ã€‚åŒæ—¶è¿™ä¸ªæµç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯¹é”™è¯¯æ—¥å¿—æµé‡‡ç”¨çš„æ˜¯ä¾§æµè¾“å‡ºã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬çš„ä¸»æµä¸­ï¼Œæˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šæ­£å¸¸æ—¥å¿—å€¼å¾—æˆ‘ä»¬åˆ†æå’ŒæŒ–æ˜ï¼Œåé¢æˆ‘ä»¬ä¹Ÿä¼šå›´ç»•è¿™äº›æ—¥å¿—æ¥åšäº›æœ‰æ„æ€çš„ä¸œè¥¿ï¼Œé‚£è¿™ä¸€æ¬¡æˆ‘ä»¬å°±å…ˆåˆ°è¿™äº†ã€‚</p>"},{"title":"åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•","date":"2020-05-21T11:41:25.000Z","_content":"\nä¸Šæ¬¡æˆ‘ä»¬ç®€å•çš„å®ç°äº†å¦‚ä½•é€šè¿‡Flinkå®ç°ä¸€ä¸ªç®€å•çš„wechatæ¨é€åŠŸèƒ½ï¼Œè¿™æ¬¡æˆ‘ä»¬å°±å®é™…çš„è¿è¡Œèµ·æ¥çœ‹çœ‹ã€‚ä»¥ä¸‹æ“ä½œéƒ½æ˜¯åŸºäºwindowsç¯å¢ƒï¼Œä¸ºé¿å…ç¯å¢ƒçš„å½±å“å…¨éƒ¨é‡‡ç”¨dockeréƒ¨ç½²ã€‚\n\n### æ­å»ºæœ¬åœ°RocketMQç¯å¢ƒ\n1. æ‹‰å–namesrv å’Œbroker é•œåƒ\n   - docker pull rocketmqinc/rocketmq:4.4.0\n\n2. å¯åŠ¨namesrv\n   - docker run -d -p 9876:9876 -v D:\\work\\rocketmq\\data\\namesrv\\logs:/root/logs -v D:\\work\\rocketmq\\data\\namesrv\\store:/root/store --name rmqnamesrv -e \"MAX_POSSIBLE_HEAP=100000000\" rocketmqinc/rocketmq:4.4.0 sh mqnamesrv\n\n3. é…ç½®broker.config\n   ``` yml\n    brokerClusterName = DefaultCluster\n    brokerName = broker-a\n    brokerId = 0\n    deleteWhen = 04\n    fileReservedTime = 48\n    brokerRole = ASYNC_MASTER\n    flushDiskType = ASYNC_FLUSH\n    brokerIP1 = 192.168.1.2\n   ```\n  <!-- more -->\n4. å¯åŠ¨broker\n   - docker run -d -p 10911:10911 -p 10909:10909 -v  D:\\work\\rocketmq\\data\\broker\\logs:/root/logs -v  D:\\work\\rocketmq\\data\\broker\\store:/root/store -v  D:\\work\\rocketmq\\conf\\broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf --name rmqbroker --link rmqnamesrv:namesrv -e \"NAMESRV_ADDR=namesrv:9876\" -e \"MAX_POSSIBLE_HEAP=200000000\" rocketmqinc/rocketmq:4.4.0 sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf\n\n5. æ‹‰å–æ§åˆ¶å°é•œåƒ\n   - docker pull pangliang/rocketmq-console-ng\n\n6. å¯åŠ¨æ§åˆ¶å°\n   - docker run -e \"JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.1.2:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false\" -p 8080:8080 -t pangliang/rocketmq-console-ng\n\n### RocketMQ è®¾ç½®\nä»¥ä¸Šï¼Œæˆ‘ä»¬å°±åœ¨æœ¬åœ°ç¯å¢ƒç®€å•çš„éƒ¨ç½²å¥½äº†rocketMQçš„è¿è¡Œç¯å¢ƒ\n\n![01](åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-dashboard.png)\n\næˆ‘ä»¬é…ç½®ä¸‹Topic\n\n![02](åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-topic.png)\n\n### å¯åŠ¨Flinkæœ¬åœ°è¿è¡Œæ—¶ç¯å¢ƒ\n1. é…ç½®å¯åŠ¨å‚æ•°\n\n--nameserverAddress 127.0.0.1:9876 --consumerGroup flinkGroup --consumerTopic AlertWechatTopic\n\n2. å¯åŠ¨Flinkæœ¬åœ°è¿è¡Œæ—¶Job\n   \n![03](åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/flink-local.png)\n\n3. æ¨¡æ‹Ÿä¸€æ¡æŠ¥è­¦ä¿¡æ¯\n\n![04](åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-message.png)\n\n4. æŸ¥çœ‹æŠ¥è­¦ä¿¡æ¯\n\n![05](åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/wechat-message.png)\n\n\n### æ€»ç»“\né€šè¿‡ç®€å•çš„æ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€å¥—ç»Ÿä¸€çš„wechatå‘Šè­¦ä¿¡æ¯å‘é€æœºåˆ¶ã€‚ä¸šåŠ¡ç³»ç»Ÿã€å‘Šè­¦ç³»ç»Ÿã€æˆ–æ˜¯Flinkå…¶ä»–çš„Jobä¸éœ€è¦å…³å¿ƒå‘Šè­¦æ¨é€çš„ç»†èŠ‚ã€‚åªè¦å‘ç»Ÿä¸€çš„Topicä¸­æ¨é€å‘Šè­¦ä¿¡æ¯ï¼Œå‘Šè­¦æ¨é€ä»»åŠ¡å°±æ˜¯å®æ—¶çš„æŠŠé”™è¯¯ä¿¡æ¯æ¨é€è‡³wechatä¸­ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å›´ç»•å‘Šè­¦çš„æ ¸å¿ƒåŠŸèƒ½ï¼šæ•°æ®çš„é‡‡é›†ã€æ•°æ®çš„åˆ†æã€‚åŸºäºFlinkæ¥è®¾è®¡ä¸€ä¸ªç»Ÿä¸€çš„æŠ¥è­¦å¹³å°ã€‚","source":"_posts/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•.md","raw":"---\ntitle: åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•\ndate: 2020-05-21 19:41:25\ntags: \n    - Java\n    - Flink\n    - ç›‘æ§\ncategories :\n    - Technology\n---\n\nä¸Šæ¬¡æˆ‘ä»¬ç®€å•çš„å®ç°äº†å¦‚ä½•é€šè¿‡Flinkå®ç°ä¸€ä¸ªç®€å•çš„wechatæ¨é€åŠŸèƒ½ï¼Œè¿™æ¬¡æˆ‘ä»¬å°±å®é™…çš„è¿è¡Œèµ·æ¥çœ‹çœ‹ã€‚ä»¥ä¸‹æ“ä½œéƒ½æ˜¯åŸºäºwindowsç¯å¢ƒï¼Œä¸ºé¿å…ç¯å¢ƒçš„å½±å“å…¨éƒ¨é‡‡ç”¨dockeréƒ¨ç½²ã€‚\n\n### æ­å»ºæœ¬åœ°RocketMQç¯å¢ƒ\n1. æ‹‰å–namesrv å’Œbroker é•œåƒ\n   - docker pull rocketmqinc/rocketmq:4.4.0\n\n2. å¯åŠ¨namesrv\n   - docker run -d -p 9876:9876 -v D:\\work\\rocketmq\\data\\namesrv\\logs:/root/logs -v D:\\work\\rocketmq\\data\\namesrv\\store:/root/store --name rmqnamesrv -e \"MAX_POSSIBLE_HEAP=100000000\" rocketmqinc/rocketmq:4.4.0 sh mqnamesrv\n\n3. é…ç½®broker.config\n   ``` yml\n    brokerClusterName = DefaultCluster\n    brokerName = broker-a\n    brokerId = 0\n    deleteWhen = 04\n    fileReservedTime = 48\n    brokerRole = ASYNC_MASTER\n    flushDiskType = ASYNC_FLUSH\n    brokerIP1 = 192.168.1.2\n   ```\n  <!-- more -->\n4. å¯åŠ¨broker\n   - docker run -d -p 10911:10911 -p 10909:10909 -v  D:\\work\\rocketmq\\data\\broker\\logs:/root/logs -v  D:\\work\\rocketmq\\data\\broker\\store:/root/store -v  D:\\work\\rocketmq\\conf\\broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf --name rmqbroker --link rmqnamesrv:namesrv -e \"NAMESRV_ADDR=namesrv:9876\" -e \"MAX_POSSIBLE_HEAP=200000000\" rocketmqinc/rocketmq:4.4.0 sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf\n\n5. æ‹‰å–æ§åˆ¶å°é•œåƒ\n   - docker pull pangliang/rocketmq-console-ng\n\n6. å¯åŠ¨æ§åˆ¶å°\n   - docker run -e \"JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.1.2:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false\" -p 8080:8080 -t pangliang/rocketmq-console-ng\n\n### RocketMQ è®¾ç½®\nä»¥ä¸Šï¼Œæˆ‘ä»¬å°±åœ¨æœ¬åœ°ç¯å¢ƒç®€å•çš„éƒ¨ç½²å¥½äº†rocketMQçš„è¿è¡Œç¯å¢ƒ\n\n![01](åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-dashboard.png)\n\næˆ‘ä»¬é…ç½®ä¸‹Topic\n\n![02](åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-topic.png)\n\n### å¯åŠ¨Flinkæœ¬åœ°è¿è¡Œæ—¶ç¯å¢ƒ\n1. é…ç½®å¯åŠ¨å‚æ•°\n\n--nameserverAddress 127.0.0.1:9876 --consumerGroup flinkGroup --consumerTopic AlertWechatTopic\n\n2. å¯åŠ¨Flinkæœ¬åœ°è¿è¡Œæ—¶Job\n   \n![03](åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/flink-local.png)\n\n3. æ¨¡æ‹Ÿä¸€æ¡æŠ¥è­¦ä¿¡æ¯\n\n![04](åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-message.png)\n\n4. æŸ¥çœ‹æŠ¥è­¦ä¿¡æ¯\n\n![05](åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/wechat-message.png)\n\n\n### æ€»ç»“\né€šè¿‡ç®€å•çš„æ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€å¥—ç»Ÿä¸€çš„wechatå‘Šè­¦ä¿¡æ¯å‘é€æœºåˆ¶ã€‚ä¸šåŠ¡ç³»ç»Ÿã€å‘Šè­¦ç³»ç»Ÿã€æˆ–æ˜¯Flinkå…¶ä»–çš„Jobä¸éœ€è¦å…³å¿ƒå‘Šè­¦æ¨é€çš„ç»†èŠ‚ã€‚åªè¦å‘ç»Ÿä¸€çš„Topicä¸­æ¨é€å‘Šè­¦ä¿¡æ¯ï¼Œå‘Šè­¦æ¨é€ä»»åŠ¡å°±æ˜¯å®æ—¶çš„æŠŠé”™è¯¯ä¿¡æ¯æ¨é€è‡³wechatä¸­ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å›´ç»•å‘Šè­¦çš„æ ¸å¿ƒåŠŸèƒ½ï¼šæ•°æ®çš„é‡‡é›†ã€æ•°æ®çš„åˆ†æã€‚åŸºäºFlinkæ¥è®¾è®¡ä¸€ä¸ªç»Ÿä¸€çš„æŠ¥è­¦å¹³å°ã€‚","slug":"åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•","published":1,"updated":"2020-12-14T10:23:32.989Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71hth000wv252el9hayof","content":"<html><head></head><body><p>&#x4E0A;&#x6B21;&#x6211;&#x4EEC;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x73B0;&#x4E86;&#x5982;&#x4F55;&#x901A;&#x8FC7;Flink&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;wechat&#x63A8;&#x9001;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x5C31;&#x5B9E;&#x9645;&#x7684;&#x8FD0;&#x884C;&#x8D77;&#x6765;&#x770B;&#x770B;&#x3002;&#x4EE5;&#x4E0B;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x57FA;&#x4E8E;windows&#x73AF;&#x5883;&#xFF0C;&#x4E3A;&#x907F;&#x514D;&#x73AF;&#x5883;&#x7684;&#x5F71;&#x54CD;&#x5168;&#x90E8;&#x91C7;&#x7528;docker&#x90E8;&#x7F72;&#x3002;</p>\n<h3 id=\"&#x642D;&#x5EFA;&#x672C;&#x5730;RocketMQ&#x73AF;&#x5883;\"><a href=\"#&#x642D;&#x5EFA;&#x672C;&#x5730;RocketMQ&#x73AF;&#x5883;\" class=\"headerlink\" title=\"&#x642D;&#x5EFA;&#x672C;&#x5730;RocketMQ&#x73AF;&#x5883;\"></a>&#x642D;&#x5EFA;&#x672C;&#x5730;RocketMQ&#x73AF;&#x5883;</h3><ol>\n<li><p>&#x62C9;&#x53D6;namesrv &#x548C;broker &#x955C;&#x50CF;</p>\n<ul>\n<li>docker pull rocketmqinc/rocketmq:4.4.0</li>\n</ul>\n</li>\n<li><p>&#x542F;&#x52A8;namesrv</p>\n<ul>\n<li>docker run -d -p 9876:9876 -v D:\\work\\rocketmq\\data\\namesrv\\logs:/root/logs -v D:\\work\\rocketmq\\data\\namesrv\\store:/root/store &#x2013;name rmqnamesrv -e &#x201C;MAX_POSSIBLE_HEAP=100000000&#x201D; rocketmqinc/rocketmq:4.4.0 sh mqnamesrv</li>\n</ul>\n</li>\n<li><p>&#x914D;&#x7F6E;broker.config</p>\n<figure class=\"highlight yml hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-string\">brokerClusterName</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-string\">DefaultCluster</span></span><br><span class=\"line\"><span class=\"hljs-string\">brokerName</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-string\">broker-a</span></span><br><span class=\"line\"><span class=\"hljs-string\">brokerId</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-number\">0</span></span><br><span class=\"line\"><span class=\"hljs-string\">deleteWhen</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-number\">04</span></span><br><span class=\"line\"><span class=\"hljs-string\">fileReservedTime</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-number\">48</span></span><br><span class=\"line\"><span class=\"hljs-string\">brokerRole</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-string\">ASYNC_MASTER</span></span><br><span class=\"line\"><span class=\"hljs-string\">flushDiskType</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-string\">ASYNC_FLUSH</span></span><br><span class=\"line\"><span class=\"hljs-string\">brokerIP1</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.2</span></span><br></pre></td></tr></tbody></table></figure>\n<a id=\"more\"></a></li>\n<li><p>&#x542F;&#x52A8;broker</p>\n<ul>\n<li>docker run -d -p 10911:10911 -p 10909:10909 -v  D:\\work\\rocketmq\\data\\broker\\logs:/root/logs -v  D:\\work\\rocketmq\\data\\broker\\store:/root/store -v  D:\\work\\rocketmq\\conf\\broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf &#x2013;name rmqbroker &#x2013;link rmqnamesrv:namesrv -e &#x201C;NAMESRV_ADDR=namesrv:9876&#x201D; -e &#x201C;MAX_POSSIBLE_HEAP=200000000&#x201D; rocketmqinc/rocketmq:4.4.0 sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf</li>\n</ul>\n</li>\n<li><p>&#x62C9;&#x53D6;&#x63A7;&#x5236;&#x53F0;&#x955C;&#x50CF;</p>\n<ul>\n<li>docker pull pangliang/rocketmq-console-ng</li>\n</ul>\n</li>\n<li><p>&#x542F;&#x52A8;&#x63A7;&#x5236;&#x53F0;</p>\n<ul>\n<li>docker run -e &#x201C;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.1.2:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false&#x201D; -p 8080:8080 -t pangliang/rocketmq-console-ng</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"RocketMQ-&#x8BBE;&#x7F6E;\"><a href=\"#RocketMQ-&#x8BBE;&#x7F6E;\" class=\"headerlink\" title=\"RocketMQ &#x8BBE;&#x7F6E;\"></a>RocketMQ &#x8BBE;&#x7F6E;</h3><p>&#x4EE5;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5728;&#x672C;&#x5730;&#x73AF;&#x5883;&#x7B80;&#x5355;&#x7684;&#x90E8;&#x7F72;&#x597D;&#x4E86;rocketMQ&#x7684;&#x8FD0;&#x884C;&#x73AF;&#x5883;</p>\n<p><img src=\"/2020/05/21/%E5%9F%BA%E4%BA%8EFlink%E6%8E%A8%E9%80%81%E6%8A%A5%E8%AD%A6%E4%BF%A1%E6%81%AF-%E6%B5%8B%E8%AF%95/rocketmq-dashboard.png\" alt=\"01\"></p>\n<p>&#x6211;&#x4EEC;&#x914D;&#x7F6E;&#x4E0B;Topic</p>\n<p><img src=\"/2020/05/21/%E5%9F%BA%E4%BA%8EFlink%E6%8E%A8%E9%80%81%E6%8A%A5%E8%AD%A6%E4%BF%A1%E6%81%AF-%E6%B5%8B%E8%AF%95/rocketmq-topic.png\" alt=\"02\"></p>\n<h3 id=\"&#x542F;&#x52A8;Flink&#x672C;&#x5730;&#x8FD0;&#x884C;&#x65F6;&#x73AF;&#x5883;\"><a href=\"#&#x542F;&#x52A8;Flink&#x672C;&#x5730;&#x8FD0;&#x884C;&#x65F6;&#x73AF;&#x5883;\" class=\"headerlink\" title=\"&#x542F;&#x52A8;Flink&#x672C;&#x5730;&#x8FD0;&#x884C;&#x65F6;&#x73AF;&#x5883;\"></a>&#x542F;&#x52A8;Flink&#x672C;&#x5730;&#x8FD0;&#x884C;&#x65F6;&#x73AF;&#x5883;</h3><ol>\n<li>&#x914D;&#x7F6E;&#x542F;&#x52A8;&#x53C2;&#x6570;</li>\n</ol>\n<p>&#x2013;nameserverAddress 127.0.0.1:9876 &#x2013;consumerGroup flinkGroup &#x2013;consumerTopic AlertWechatTopic</p>\n<ol start=\"2\">\n<li>&#x542F;&#x52A8;Flink&#x672C;&#x5730;&#x8FD0;&#x884C;&#x65F6;Job</li>\n</ol>\n<p><img src=\"/2020/05/21/%E5%9F%BA%E4%BA%8EFlink%E6%8E%A8%E9%80%81%E6%8A%A5%E8%AD%A6%E4%BF%A1%E6%81%AF-%E6%B5%8B%E8%AF%95/flink-local.png\" alt=\"03\"></p>\n<ol start=\"3\">\n<li>&#x6A21;&#x62DF;&#x4E00;&#x6761;&#x62A5;&#x8B66;&#x4FE1;&#x606F;</li>\n</ol>\n<p><img src=\"/2020/05/21/%E5%9F%BA%E4%BA%8EFlink%E6%8E%A8%E9%80%81%E6%8A%A5%E8%AD%A6%E4%BF%A1%E6%81%AF-%E6%B5%8B%E8%AF%95/rocketmq-message.png\" alt=\"04\"></p>\n<ol start=\"4\">\n<li>&#x67E5;&#x770B;&#x62A5;&#x8B66;&#x4FE1;&#x606F;</li>\n</ol>\n<p><img src=\"/2020/05/21/%E5%9F%BA%E4%BA%8EFlink%E6%8E%A8%E9%80%81%E6%8A%A5%E8%AD%A6%E4%BF%A1%E6%81%AF-%E6%B5%8B%E8%AF%95/wechat-message.png\" alt=\"05\"></p>\n<h3 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h3><p>&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x4E00;&#x5957;&#x7EDF;&#x4E00;&#x7684;wechat&#x544A;&#x8B66;&#x4FE1;&#x606F;&#x53D1;&#x9001;&#x673A;&#x5236;&#x3002;&#x4E1A;&#x52A1;&#x7CFB;&#x7EDF;&#x3001;&#x544A;&#x8B66;&#x7CFB;&#x7EDF;&#x3001;&#x6216;&#x662F;Flink&#x5176;&#x4ED6;&#x7684;Job&#x4E0D;&#x9700;&#x8981;&#x5173;&#x5FC3;&#x544A;&#x8B66;&#x63A8;&#x9001;&#x7684;&#x7EC6;&#x8282;&#x3002;&#x53EA;&#x8981;&#x5411;&#x7EDF;&#x4E00;&#x7684;Topic&#x4E2D;&#x63A8;&#x9001;&#x544A;&#x8B66;&#x4FE1;&#x606F;&#xFF0C;&#x544A;&#x8B66;&#x63A8;&#x9001;&#x4EFB;&#x52A1;&#x5C31;&#x662F;&#x5B9E;&#x65F6;&#x7684;&#x628A;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x63A8;&#x9001;&#x81F3;wechat&#x4E2D;&#x3002;<br>&#x63A5;&#x4E0B;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x56F4;&#x7ED5;&#x544A;&#x8B66;&#x7684;&#x6838;&#x5FC3;&#x529F;&#x80FD;&#xFF1A;&#x6570;&#x636E;&#x7684;&#x91C7;&#x96C6;&#x3001;&#x6570;&#x636E;&#x7684;&#x5206;&#x6790;&#x3002;&#x57FA;&#x4E8E;Flink&#x6765;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x62A5;&#x8B66;&#x5E73;&#x53F0;&#x3002;</p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Flink","path":"tags/Flink/"},{"name":"ç›‘æ§","path":"tags/ç›‘æ§/"}],"excerpt":"<html><head></head><body><p>&#x4E0A;&#x6B21;&#x6211;&#x4EEC;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x73B0;&#x4E86;&#x5982;&#x4F55;&#x901A;&#x8FC7;Flink&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;wechat&#x63A8;&#x9001;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x5C31;&#x5B9E;&#x9645;&#x7684;&#x8FD0;&#x884C;&#x8D77;&#x6765;&#x770B;&#x770B;&#x3002;&#x4EE5;&#x4E0B;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x57FA;&#x4E8E;windows&#x73AF;&#x5883;&#xFF0C;&#x4E3A;&#x907F;&#x514D;&#x73AF;&#x5883;&#x7684;&#x5F71;&#x54CD;&#x5168;&#x90E8;&#x91C7;&#x7528;docker&#x90E8;&#x7F72;&#x3002;</p>\n<h3 id=\"&#x642D;&#x5EFA;&#x672C;&#x5730;RocketMQ&#x73AF;&#x5883;\"><a href=\"#&#x642D;&#x5EFA;&#x672C;&#x5730;RocketMQ&#x73AF;&#x5883;\" class=\"headerlink\" title=\"&#x642D;&#x5EFA;&#x672C;&#x5730;RocketMQ&#x73AF;&#x5883;\"></a>&#x642D;&#x5EFA;&#x672C;&#x5730;RocketMQ&#x73AF;&#x5883;</h3><ol>\n<li><p>&#x62C9;&#x53D6;namesrv &#x548C;broker &#x955C;&#x50CF;</p>\n<ul>\n<li>docker pull rocketmqinc/rocketmq:4.4.0</li>\n</ul>\n</li>\n<li><p>&#x542F;&#x52A8;namesrv</p>\n<ul>\n<li>docker run -d -p 9876:9876 -v D:\\work\\rocketmq\\data\\namesrv\\logs:/root/logs -v D:\\work\\rocketmq\\data\\namesrv\\store:/root/store &#x2013;name rmqnamesrv -e &#x201C;MAX_POSSIBLE_HEAP=100000000&#x201D; rocketmqinc/rocketmq:4.4.0 sh mqnamesrv</li>\n</ul>\n</li>\n<li><p>&#x914D;&#x7F6E;broker.config</p>\n<figure class=\"highlight yml hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-string\">brokerClusterName</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-string\">DefaultCluster</span></span><br><span class=\"line\"><span class=\"hljs-string\">brokerName</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-string\">broker-a</span></span><br><span class=\"line\"><span class=\"hljs-string\">brokerId</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-number\">0</span></span><br><span class=\"line\"><span class=\"hljs-string\">deleteWhen</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-number\">04</span></span><br><span class=\"line\"><span class=\"hljs-string\">fileReservedTime</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-number\">48</span></span><br><span class=\"line\"><span class=\"hljs-string\">brokerRole</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-string\">ASYNC_MASTER</span></span><br><span class=\"line\"><span class=\"hljs-string\">flushDiskType</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-string\">ASYNC_FLUSH</span></span><br><span class=\"line\"><span class=\"hljs-string\">brokerIP1</span> <span class=\"hljs-string\">=</span> <span class=\"hljs-number\">192.168</span><span class=\"hljs-number\">.1</span><span class=\"hljs-number\">.2</span></span><br></pre></td></tr></tbody></table></figure></li></ol></body></html>","more":"\n<li><p>å¯åŠ¨broker</p>\n<ul>\n<li>docker run -d -p 10911:10911 -p 10909:10909 -v  D:\\work\\rocketmq\\data\\broker\\logs:/root/logs -v  D:\\work\\rocketmq\\data\\broker\\store:/root/store -v  D:\\work\\rocketmq\\conf\\broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf â€“name rmqbroker â€“link rmqnamesrv:namesrv -e â€œNAMESRV_ADDR=namesrv:9876â€ -e â€œMAX_POSSIBLE_HEAP=200000000â€ rocketmqinc/rocketmq:4.4.0 sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf</li>\n</ul>\n</li>\n<li><p>æ‹‰å–æ§åˆ¶å°é•œåƒ</p>\n<ul>\n<li>docker pull pangliang/rocketmq-console-ng</li>\n</ul>\n</li>\n<li><p>å¯åŠ¨æ§åˆ¶å°</p>\n<ul>\n<li>docker run -e â€œJAVA_OPTS=-Drocketmq.namesrv.addr=192.168.1.2:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=falseâ€ -p 8080:8080 -t pangliang/rocketmq-console-ng</li>\n</ul>\n</li>\n\n<h3 id=\"RocketMQ-è®¾ç½®\"><a href=\"#RocketMQ-è®¾ç½®\" class=\"headerlink\" title=\"RocketMQ è®¾ç½®\"></a>RocketMQ è®¾ç½®</h3><p>ä»¥ä¸Šï¼Œæˆ‘ä»¬å°±åœ¨æœ¬åœ°ç¯å¢ƒç®€å•çš„éƒ¨ç½²å¥½äº†rocketMQçš„è¿è¡Œç¯å¢ƒ</p>\n<p><img src=\"/2020/05/21/%E5%9F%BA%E4%BA%8EFlink%E6%8E%A8%E9%80%81%E6%8A%A5%E8%AD%A6%E4%BF%A1%E6%81%AF-%E6%B5%8B%E8%AF%95/rocketmq-dashboard.png\" alt=\"01\"></p>\n<p>æˆ‘ä»¬é…ç½®ä¸‹Topic</p>\n<p><img src=\"/2020/05/21/%E5%9F%BA%E4%BA%8EFlink%E6%8E%A8%E9%80%81%E6%8A%A5%E8%AD%A6%E4%BF%A1%E6%81%AF-%E6%B5%8B%E8%AF%95/rocketmq-topic.png\" alt=\"02\"></p>\n<h3 id=\"å¯åŠ¨Flinkæœ¬åœ°è¿è¡Œæ—¶ç¯å¢ƒ\"><a href=\"#å¯åŠ¨Flinkæœ¬åœ°è¿è¡Œæ—¶ç¯å¢ƒ\" class=\"headerlink\" title=\"å¯åŠ¨Flinkæœ¬åœ°è¿è¡Œæ—¶ç¯å¢ƒ\"></a>å¯åŠ¨Flinkæœ¬åœ°è¿è¡Œæ—¶ç¯å¢ƒ</h3><ol>\n<li>é…ç½®å¯åŠ¨å‚æ•°</li>\n</ol>\n<p>â€“nameserverAddress 127.0.0.1:9876 â€“consumerGroup flinkGroup â€“consumerTopic AlertWechatTopic</p>\n<ol start=\"2\">\n<li>å¯åŠ¨Flinkæœ¬åœ°è¿è¡Œæ—¶Job</li>\n</ol>\n<p><img src=\"/2020/05/21/%E5%9F%BA%E4%BA%8EFlink%E6%8E%A8%E9%80%81%E6%8A%A5%E8%AD%A6%E4%BF%A1%E6%81%AF-%E6%B5%8B%E8%AF%95/flink-local.png\" alt=\"03\"></p>\n<ol start=\"3\">\n<li>æ¨¡æ‹Ÿä¸€æ¡æŠ¥è­¦ä¿¡æ¯</li>\n</ol>\n<p><img src=\"/2020/05/21/%E5%9F%BA%E4%BA%8EFlink%E6%8E%A8%E9%80%81%E6%8A%A5%E8%AD%A6%E4%BF%A1%E6%81%AF-%E6%B5%8B%E8%AF%95/rocketmq-message.png\" alt=\"04\"></p>\n<ol start=\"4\">\n<li>æŸ¥çœ‹æŠ¥è­¦ä¿¡æ¯</li>\n</ol>\n<p><img src=\"/2020/05/21/%E5%9F%BA%E4%BA%8EFlink%E6%8E%A8%E9%80%81%E6%8A%A5%E8%AD%A6%E4%BF%A1%E6%81%AF-%E6%B5%8B%E8%AF%95/wechat-message.png\" alt=\"05\"></p>\n<h3 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h3><p>é€šè¿‡ç®€å•çš„æ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€å¥—ç»Ÿä¸€çš„wechatå‘Šè­¦ä¿¡æ¯å‘é€æœºåˆ¶ã€‚ä¸šåŠ¡ç³»ç»Ÿã€å‘Šè­¦ç³»ç»Ÿã€æˆ–æ˜¯Flinkå…¶ä»–çš„Jobä¸éœ€è¦å…³å¿ƒå‘Šè­¦æ¨é€çš„ç»†èŠ‚ã€‚åªè¦å‘ç»Ÿä¸€çš„Topicä¸­æ¨é€å‘Šè­¦ä¿¡æ¯ï¼Œå‘Šè­¦æ¨é€ä»»åŠ¡å°±æ˜¯å®æ—¶çš„æŠŠé”™è¯¯ä¿¡æ¯æ¨é€è‡³wechatä¸­ã€‚<br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å›´ç»•å‘Šè­¦çš„æ ¸å¿ƒåŠŸèƒ½ï¼šæ•°æ®çš„é‡‡é›†ã€æ•°æ®çš„åˆ†æã€‚åŸºäºFlinkæ¥è®¾è®¡ä¸€ä¸ªç»Ÿä¸€çš„æŠ¥è­¦å¹³å°ã€‚</p>"},{"title":"åŸºäºFlinkè®¾è®¡ç»Ÿä¸€æŠ¥è­¦å¹³å°","date":"2020-05-16T09:24:48.000Z","_content":"\næœ€è¿‘åœ¨æ•´ç†åç«¯å·²æœ‰çš„é”™è¯¯æŠ¥è­¦ï¼Œä¸»è¦åˆ†ä¸¤å¤§ç±»ï¼š\n1. å¼‚å¸¸æŠ¥è­¦\n   - åŸºäºç›‘æ§ç³»ç»Ÿã€‚å¦‚CATã€pingpongã€skywalkingç­‰APMç³»ç»Ÿçš„é”™è¯¯å¼‚å¸¸ç›‘æ§ã€‚å¼€å‘äººå‘˜é’ˆå¯¹å¼‚å¸¸ç±»å‹ï¼Œåˆ¶å®šç›¸åº”çš„é˜ˆå€¼ã€‚å¯¹ä»£ç è¿è¡Œæ—¶å¼‚å¸¸ã€sqlå¼‚å¸¸ã€ç½‘ç»œå¼‚å¸¸ç­‰è¿›è¡ŒæŒ‡æ ‡ç›‘æ§ã€‚å½“å¼‚å¸¸è¶…è¿‡æŒ‡å®šé˜ˆå€¼æ—¶æ¨é€å¼‚å¸¸ä¿¡æ¯ã€‚æˆ‘ä»¬çš„åç«¯ç³»ç»Ÿæ˜¯åŸºäºCATè¿›è¡Œç›‘æ§ï¼Œç›‘æ§çš„æŒ‡æ ‡å’Œé…ç½®éƒ½è¦äººä¸ºè¿›è¡Œé…ç½®ï¼Œå¼‚å¸¸ä¿¡æ¯çš„æ¨é€éœ€è¦å¼€å‘å¹¶ä¸CATå¯¹æ¥ï¼ŒåŒæ—¶å¾®ä¿¡æ¨é€è¿™å—å¼‚å¸¸ä¿¡æ¯æœ‰é™ï¼Œå¾€å¾€è¦é€šè¿‡é‚®ä»¶å‘Šè­¦å’Œç™»å½•CATå¹³å°æŸ¥çœ‹æ‰èƒ½å¤§æ¦‚äº†è§£é”™è¯¯çš„ç±»å‹ã€‚è¿™ç‚¹é•¿æœŸè¢«å¼€å‘äººå‘˜è¯Ÿç—…ï¼Œè™½ç„¶æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ä¿®æ”¹CATçš„æºç æ¥æ”¹å–„ä¸Šè¯‰é—®é¢˜ã€‚ä½†å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œæ›´åŠ ç›´è§‚çš„å †é”™è¯¯ä¿¡æ¯è¿›è¡Œå¤„ç†æ˜¯å†å¥½ä¸è¿‡çš„äº‹æƒ…ã€‚\n   - åŸºäºç³»ç»ŸæŒ‡æ ‡ã€‚æœ‰åˆ«äºæœåŠ¡å¼‚å¸¸ï¼Œç³»ç»ŸæŒ‡æ ‡æœ‰æ›´çµæ´»çš„é‡‡é›†æ–¹å¼ã€‚æˆ‘ä»¬é‡‡ç”¨äº†Spring Mericsï¼ŒåŸºäºPrometheusæ­å»ºäº†ç³»ç»ŸæŒ‡æ ‡çš„ç›‘æ§ä½“ç³»ï¼Œç»“åˆGrafanaå°†è¿‘å®æ—¶çš„ç³»ç»ŸæŒ‡æ ‡å±•ç°è‡³å±å¹•ã€‚åŒæ ·é‡åˆ°ç³»ç»ŸæŒ‡æ ‡å¼‚å¸¸çš„æ—¶å€™ï¼Œå¦‚Heapç©ºé—´ä½¿ç”¨é‡å¼‚å¸¸ï¼ŒCPUé£™é«˜ï¼Œå†…å­˜å‘Šæ€¥ç­‰æƒ…å†µï¼Œæˆ‘ä»¬é€šè¿‡Grafanaçš„è‡ªå®šä¹‰å‘Šè­¦å°†é”™è¯¯æ¨é€ç»™ç›¸å…³å¼€å‘ã€‚\n  <!-- more -->\n2. ä¸šåŠ¡å‘Šè­¦\n   - åŸºäºå®æ—¶æ•°æ®ã€‚é€šè¿‡å¯¹ä¸šåŠ¡æµç¨‹çš„åŸ‹ç‚¹ï¼Œå°†é‡‡é›†çš„å®æ—¶æ•°æ®è¿›è¡Œè®¡ç®—æ¯”è¾ƒã€‚å¹¶å°†å¼‚å¸¸çš„ä¸šåŠ¡æ•°æ®è¿›è¡Œæ¨é€å‘Šè­¦ã€‚\n   - åŸºäºç¦»çº¿æ•°æ®ã€‚å®šæ—¶åˆ†æç¦»çº¿æ•°æ®ï¼Œæ¨é€å¼‚å¸¸ä¸šåŠ¡æ•°æ®å‘Šè­¦ã€‚\n\nä»¥ä¸Šå¤§æ¦‚ä»‹ç»äº†ç›‘æ§çš„å‡ ä¸ªæ–¹å‘åŠå…¶è½åœ°æ–¹å¼ï¼Œé€šè¿‡åˆ†ææˆ‘ä»¬å¯ä»¥å°†æ•´ä¸ªç›‘æ§è¡Œä¸ºæŠ½è±¡æˆä¸€ä¸ªæ•°æ®æµï¼šç›‘æ§æ•°æ®æº--> ç›‘æ§æ•°æ®æ¸…æ´— --> ç›‘æ§æ•°æ®è®¡ç®— --> æ¨é€æŠ¥è­¦\n\nåŸºäºè¿™ä¸ªç»“è®ºï¼Œæ­£å¼æˆ‘ä»¬ä¼šå¼€å§‹ç ”ç©¶å¹¶æ¢ç´¢Flinkçš„å¥‘æœºã€‚é¢å¯¹ç›®å‰åç«¯å½¢å½¢è‰²è‰²çš„ç›‘æ§æ–¹å¼åŠå¤„ç†æµç¨‹ï¼Œæ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½æ˜¯å‰²è£‚çš„ï¼Œæ— æ³•ç»Ÿä¸€æ€æƒ³çš„ã€‚é¢å¯¹ä¸åŒçš„ç›‘æ§åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬è¦è€ƒè™‘ä¸åŒæ¥å¤„ç†æ‰‹æ®µï¼Œè¿™å˜ç›¸çš„å¢åŠ äº†å¼€å‘äººå‘˜çš„äººåŠ›èµ„æºã€‚\n\nä¸ºæ­¤æˆ‘ä»¬è€ƒè™‘æ€æ ·å¯ä»¥æœ€å¤§é™åº¦çš„ç»Ÿä¸€å„ä¸ªæŠ¥è­¦çš„æµç¨‹ï¼Œå¹¶æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å¤„ç†å¹³å°ã€‚è¿™ä¸ªæ—¶å€™Flinkæ¥åˆ°äº†æˆ‘ä»¬é¢å‰ã€‚\n\nFlinkæ˜¯ä»€ä¹ˆç›¸æ¯”ä¸ç”¨ä»‹ç»äº†ï¼Œå®˜ç½‘å·²ç»ä»‹ç»çš„ç›¸å½“è¯¦ç»†äº†ï¼š\n<https://flink.apache.org/>\n\nä¸Šé¢æŠ½è±¡çš„ç›‘æ§æµç¨‹ï¼šç›‘æ§æ•°æ®æº--> ç›‘æ§æ•°æ®æ¸…æ´— --> ç›‘æ§æ•°æ®è®¡ç®— --> æ¨é€æŠ¥è­¦\n\nç”¨Flinkå¯ä»¥è¡¨ç¤ºä¸ºï¼šSource--> ETL--> Operator--> Sink\n\nç»“åˆä¸Šé¢çš„åˆ†æï¼Œæˆ‘æ‰“ç®—å…ˆä»æ¨é€æŠ¥è­¦åŠŸèƒ½å…¥æ‰‹ã€‚åˆ©ç”¨Flinkçš„æµå¼å¤„ç†èƒ½åŠ›ï¼Œå¼€å‘ä¸€ä¸ªç»Ÿä¸€çš„æŠ¥è­¦å‡ºå£ä»»åŠ¡ã€‚\n#### æ•°æ®æº\næ•°æ®æºæˆ‘ä»¬æ‰“ç®—é‡‡ç”¨RocketMQã€‚åˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„æŠ¥è­¦æ¨é€Topicï¼Œå®šä¹‰ç»Ÿä¸€çš„æŠ¥è­¦æ¶ˆæ¯æ ¼å¼ã€‚\n\n|Topic|AlertWechatTopic|\n|---|---|\n|Body|{\"alertMsg\":\"\",<br>\"alertTo\":\"\",<br>\"bizType\":\"\"<br> }\n\n#### ç®—å­\n1. åº”ç”¨RocketMQ-Extendæä¾›çš„Flinkæ”¯æŒï¼Œå®˜æ–¹ç»§æ‰¿äº†RichParallelSourceFunctionç±»ã€‚å®ç°äº†æ³¨å†ŒConsumerï¼Œæ‹‰å–Topicä¸‹çš„æ¶ˆæ¯ã€‚\n\n2. å®˜æ–¹æä¾›çš„åºåˆ—åŒ–æ–¹æ³•ä»…æœ‰é’ˆå¯¹keyå’Œvalueçš„Stringåºåˆ—åŒ–SimpleKeyValueDeserializationSchemaã€‚åœ¨è¿ç”¨ä¸Šæ˜¯æ»¡è¶³çš„ï¼Œä½†æ˜¯åæœŸç¼–ç¨‹ä¸Šå¯èƒ½è‡ªå®šä¹‰ä¼šæ›´åŠ æ–¹ä¾¿ã€‚åæœŸæˆ‘ä»¬ä¼šè€ƒè™‘æ‰©å±•åºåˆ—åŒ–æ–¹å¼æˆ–æ˜¯å®˜æ–¹æä¾›çš„æ‹‰å–æ¶ˆæ¯æºç ï¼Œåšåˆ°æ›´çµæ´»çš„æ¶ˆæ¯æ ¼å¼ä¼ è¾“ã€‚\n\n3. å°†ä»RocketMQä¸­æ‹‰å–åˆ°çš„æ¶ˆæ¯åšMapï¼Œæ ¼å¼åŒ–æˆæˆ‘ä»¬å¸Œæœ›çš„ç»“æ„ã€‚\n\n```java\npublic static void main(String[] args) {\n        ParameterTool parameterTool = ParameterTool.fromArgs(args);\n        String nameserverAddress = parameterTool.get(\"nameserverAddress\");\n        String consumerGroup = parameterTool.get(\"consumerGroup\");\n        String consumerTopic = parameterTool.get(\"consumerTopic\");\n\n        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n        SendWechatService sendWechatService = new SendWechatService();\n        // enable checkpoint\n        env.enableCheckpointing(3000);\n\n        Properties consumerProps = new Properties();\n        consumerProps.setProperty(RocketMQConfig.NAME_SERVER_ADDR, nameserverAddress);\n        consumerProps.setProperty(RocketMQConfig.CONSUMER_GROUP, consumerGroup);\n        consumerProps.setProperty(RocketMQConfig.CONSUMER_TOPIC, consumerTopic);\n\n        env.addSource(new RocketMQSource<Map>(new SimpleKeyValueDeserializationSchema(null,\"body\"),consumerProps))\n                .name(\"rocketmq-source\")\n                .map(new MapFunction<Map, WechatAlertInfo>() {\n                    @Override\n                    public WechatAlertInfo map(Map value) throws Exception {\n                        String body = (String)value.get(\"body\");\n                        WechatAlertInfo wechatAlertInfo = JSONObject.parseObject(body, WechatAlertInfo.class);\n                        return wechatAlertInfo;\n                    }\n                }).addSink(new WechatSink())\n                .name(\"wechat sink\");\n        try {\n            env.execute(\"send to wechat\");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n```\n\n4. å°†æ ¼å¼åŒ–å®Œæˆçš„æ•°æ®æºè¾“å‡ºåˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„Sinkä¸­ï¼Œè¯¥sinkçš„åŠŸèƒ½ä¸ºå‘é€wechatä¿¡æ¯ã€‚\n\n```java\npublic class WechatSink extends RichSinkFunction<WechatAlertInfo> {\n    private transient SendWechatService sendWechatService;\n\n    @Override\n    public void open(Configuration parameters) throws Exception {\n        sendWechatService = new SendWechatService();\n    }\n\n    @Override\n    public void invoke(WechatAlertInfo value, Context context) throws Exception {\n        sendWechatService.sendMessage(value.getAlertMsg(),value.getAlertTo());\n    }\n}\n```\n\nä»¥ä¸Šæˆ‘ä»¬å°±ç®€å•çš„å®ç°äº†å°†RocketMQä¸­çš„æŠ¥è­¦æ¶ˆæ¯æ¨é€è‡³wechatçš„åŠŸèƒ½ï¼Œä¸‹æ¬¡æˆ‘ä»¬æŠŠä»£ç è·‘èµ·æ¥çœ‹çœ‹ã€‚","source":"_posts/åŸºäºFlinkè®¾è®¡ç»Ÿä¸€æŠ¥è­¦å¹³å°.md","raw":"---\ntitle: åŸºäºFlinkè®¾è®¡ç»Ÿä¸€æŠ¥è­¦å¹³å°\ndate: 2020-05-16 17:24:48\ntags: \n    - Java\n    - Flink\n    - ç›‘æ§\ncategories :\n    - Technology\n---\n\næœ€è¿‘åœ¨æ•´ç†åç«¯å·²æœ‰çš„é”™è¯¯æŠ¥è­¦ï¼Œä¸»è¦åˆ†ä¸¤å¤§ç±»ï¼š\n1. å¼‚å¸¸æŠ¥è­¦\n   - åŸºäºç›‘æ§ç³»ç»Ÿã€‚å¦‚CATã€pingpongã€skywalkingç­‰APMç³»ç»Ÿçš„é”™è¯¯å¼‚å¸¸ç›‘æ§ã€‚å¼€å‘äººå‘˜é’ˆå¯¹å¼‚å¸¸ç±»å‹ï¼Œåˆ¶å®šç›¸åº”çš„é˜ˆå€¼ã€‚å¯¹ä»£ç è¿è¡Œæ—¶å¼‚å¸¸ã€sqlå¼‚å¸¸ã€ç½‘ç»œå¼‚å¸¸ç­‰è¿›è¡ŒæŒ‡æ ‡ç›‘æ§ã€‚å½“å¼‚å¸¸è¶…è¿‡æŒ‡å®šé˜ˆå€¼æ—¶æ¨é€å¼‚å¸¸ä¿¡æ¯ã€‚æˆ‘ä»¬çš„åç«¯ç³»ç»Ÿæ˜¯åŸºäºCATè¿›è¡Œç›‘æ§ï¼Œç›‘æ§çš„æŒ‡æ ‡å’Œé…ç½®éƒ½è¦äººä¸ºè¿›è¡Œé…ç½®ï¼Œå¼‚å¸¸ä¿¡æ¯çš„æ¨é€éœ€è¦å¼€å‘å¹¶ä¸CATå¯¹æ¥ï¼ŒåŒæ—¶å¾®ä¿¡æ¨é€è¿™å—å¼‚å¸¸ä¿¡æ¯æœ‰é™ï¼Œå¾€å¾€è¦é€šè¿‡é‚®ä»¶å‘Šè­¦å’Œç™»å½•CATå¹³å°æŸ¥çœ‹æ‰èƒ½å¤§æ¦‚äº†è§£é”™è¯¯çš„ç±»å‹ã€‚è¿™ç‚¹é•¿æœŸè¢«å¼€å‘äººå‘˜è¯Ÿç—…ï¼Œè™½ç„¶æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ä¿®æ”¹CATçš„æºç æ¥æ”¹å–„ä¸Šè¯‰é—®é¢˜ã€‚ä½†å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œæ›´åŠ ç›´è§‚çš„å †é”™è¯¯ä¿¡æ¯è¿›è¡Œå¤„ç†æ˜¯å†å¥½ä¸è¿‡çš„äº‹æƒ…ã€‚\n   - åŸºäºç³»ç»ŸæŒ‡æ ‡ã€‚æœ‰åˆ«äºæœåŠ¡å¼‚å¸¸ï¼Œç³»ç»ŸæŒ‡æ ‡æœ‰æ›´çµæ´»çš„é‡‡é›†æ–¹å¼ã€‚æˆ‘ä»¬é‡‡ç”¨äº†Spring Mericsï¼ŒåŸºäºPrometheusæ­å»ºäº†ç³»ç»ŸæŒ‡æ ‡çš„ç›‘æ§ä½“ç³»ï¼Œç»“åˆGrafanaå°†è¿‘å®æ—¶çš„ç³»ç»ŸæŒ‡æ ‡å±•ç°è‡³å±å¹•ã€‚åŒæ ·é‡åˆ°ç³»ç»ŸæŒ‡æ ‡å¼‚å¸¸çš„æ—¶å€™ï¼Œå¦‚Heapç©ºé—´ä½¿ç”¨é‡å¼‚å¸¸ï¼ŒCPUé£™é«˜ï¼Œå†…å­˜å‘Šæ€¥ç­‰æƒ…å†µï¼Œæˆ‘ä»¬é€šè¿‡Grafanaçš„è‡ªå®šä¹‰å‘Šè­¦å°†é”™è¯¯æ¨é€ç»™ç›¸å…³å¼€å‘ã€‚\n  <!-- more -->\n2. ä¸šåŠ¡å‘Šè­¦\n   - åŸºäºå®æ—¶æ•°æ®ã€‚é€šè¿‡å¯¹ä¸šåŠ¡æµç¨‹çš„åŸ‹ç‚¹ï¼Œå°†é‡‡é›†çš„å®æ—¶æ•°æ®è¿›è¡Œè®¡ç®—æ¯”è¾ƒã€‚å¹¶å°†å¼‚å¸¸çš„ä¸šåŠ¡æ•°æ®è¿›è¡Œæ¨é€å‘Šè­¦ã€‚\n   - åŸºäºç¦»çº¿æ•°æ®ã€‚å®šæ—¶åˆ†æç¦»çº¿æ•°æ®ï¼Œæ¨é€å¼‚å¸¸ä¸šåŠ¡æ•°æ®å‘Šè­¦ã€‚\n\nä»¥ä¸Šå¤§æ¦‚ä»‹ç»äº†ç›‘æ§çš„å‡ ä¸ªæ–¹å‘åŠå…¶è½åœ°æ–¹å¼ï¼Œé€šè¿‡åˆ†ææˆ‘ä»¬å¯ä»¥å°†æ•´ä¸ªç›‘æ§è¡Œä¸ºæŠ½è±¡æˆä¸€ä¸ªæ•°æ®æµï¼šç›‘æ§æ•°æ®æº--> ç›‘æ§æ•°æ®æ¸…æ´— --> ç›‘æ§æ•°æ®è®¡ç®— --> æ¨é€æŠ¥è­¦\n\nåŸºäºè¿™ä¸ªç»“è®ºï¼Œæ­£å¼æˆ‘ä»¬ä¼šå¼€å§‹ç ”ç©¶å¹¶æ¢ç´¢Flinkçš„å¥‘æœºã€‚é¢å¯¹ç›®å‰åç«¯å½¢å½¢è‰²è‰²çš„ç›‘æ§æ–¹å¼åŠå¤„ç†æµç¨‹ï¼Œæ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½æ˜¯å‰²è£‚çš„ï¼Œæ— æ³•ç»Ÿä¸€æ€æƒ³çš„ã€‚é¢å¯¹ä¸åŒçš„ç›‘æ§åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬è¦è€ƒè™‘ä¸åŒæ¥å¤„ç†æ‰‹æ®µï¼Œè¿™å˜ç›¸çš„å¢åŠ äº†å¼€å‘äººå‘˜çš„äººåŠ›èµ„æºã€‚\n\nä¸ºæ­¤æˆ‘ä»¬è€ƒè™‘æ€æ ·å¯ä»¥æœ€å¤§é™åº¦çš„ç»Ÿä¸€å„ä¸ªæŠ¥è­¦çš„æµç¨‹ï¼Œå¹¶æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å¤„ç†å¹³å°ã€‚è¿™ä¸ªæ—¶å€™Flinkæ¥åˆ°äº†æˆ‘ä»¬é¢å‰ã€‚\n\nFlinkæ˜¯ä»€ä¹ˆç›¸æ¯”ä¸ç”¨ä»‹ç»äº†ï¼Œå®˜ç½‘å·²ç»ä»‹ç»çš„ç›¸å½“è¯¦ç»†äº†ï¼š\n<https://flink.apache.org/>\n\nä¸Šé¢æŠ½è±¡çš„ç›‘æ§æµç¨‹ï¼šç›‘æ§æ•°æ®æº--> ç›‘æ§æ•°æ®æ¸…æ´— --> ç›‘æ§æ•°æ®è®¡ç®— --> æ¨é€æŠ¥è­¦\n\nç”¨Flinkå¯ä»¥è¡¨ç¤ºä¸ºï¼šSource--> ETL--> Operator--> Sink\n\nç»“åˆä¸Šé¢çš„åˆ†æï¼Œæˆ‘æ‰“ç®—å…ˆä»æ¨é€æŠ¥è­¦åŠŸèƒ½å…¥æ‰‹ã€‚åˆ©ç”¨Flinkçš„æµå¼å¤„ç†èƒ½åŠ›ï¼Œå¼€å‘ä¸€ä¸ªç»Ÿä¸€çš„æŠ¥è­¦å‡ºå£ä»»åŠ¡ã€‚\n#### æ•°æ®æº\næ•°æ®æºæˆ‘ä»¬æ‰“ç®—é‡‡ç”¨RocketMQã€‚åˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„æŠ¥è­¦æ¨é€Topicï¼Œå®šä¹‰ç»Ÿä¸€çš„æŠ¥è­¦æ¶ˆæ¯æ ¼å¼ã€‚\n\n|Topic|AlertWechatTopic|\n|---|---|\n|Body|{\"alertMsg\":\"\",<br>\"alertTo\":\"\",<br>\"bizType\":\"\"<br> }\n\n#### ç®—å­\n1. åº”ç”¨RocketMQ-Extendæä¾›çš„Flinkæ”¯æŒï¼Œå®˜æ–¹ç»§æ‰¿äº†RichParallelSourceFunctionç±»ã€‚å®ç°äº†æ³¨å†ŒConsumerï¼Œæ‹‰å–Topicä¸‹çš„æ¶ˆæ¯ã€‚\n\n2. å®˜æ–¹æä¾›çš„åºåˆ—åŒ–æ–¹æ³•ä»…æœ‰é’ˆå¯¹keyå’Œvalueçš„Stringåºåˆ—åŒ–SimpleKeyValueDeserializationSchemaã€‚åœ¨è¿ç”¨ä¸Šæ˜¯æ»¡è¶³çš„ï¼Œä½†æ˜¯åæœŸç¼–ç¨‹ä¸Šå¯èƒ½è‡ªå®šä¹‰ä¼šæ›´åŠ æ–¹ä¾¿ã€‚åæœŸæˆ‘ä»¬ä¼šè€ƒè™‘æ‰©å±•åºåˆ—åŒ–æ–¹å¼æˆ–æ˜¯å®˜æ–¹æä¾›çš„æ‹‰å–æ¶ˆæ¯æºç ï¼Œåšåˆ°æ›´çµæ´»çš„æ¶ˆæ¯æ ¼å¼ä¼ è¾“ã€‚\n\n3. å°†ä»RocketMQä¸­æ‹‰å–åˆ°çš„æ¶ˆæ¯åšMapï¼Œæ ¼å¼åŒ–æˆæˆ‘ä»¬å¸Œæœ›çš„ç»“æ„ã€‚\n\n```java\npublic static void main(String[] args) {\n        ParameterTool parameterTool = ParameterTool.fromArgs(args);\n        String nameserverAddress = parameterTool.get(\"nameserverAddress\");\n        String consumerGroup = parameterTool.get(\"consumerGroup\");\n        String consumerTopic = parameterTool.get(\"consumerTopic\");\n\n        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n        SendWechatService sendWechatService = new SendWechatService();\n        // enable checkpoint\n        env.enableCheckpointing(3000);\n\n        Properties consumerProps = new Properties();\n        consumerProps.setProperty(RocketMQConfig.NAME_SERVER_ADDR, nameserverAddress);\n        consumerProps.setProperty(RocketMQConfig.CONSUMER_GROUP, consumerGroup);\n        consumerProps.setProperty(RocketMQConfig.CONSUMER_TOPIC, consumerTopic);\n\n        env.addSource(new RocketMQSource<Map>(new SimpleKeyValueDeserializationSchema(null,\"body\"),consumerProps))\n                .name(\"rocketmq-source\")\n                .map(new MapFunction<Map, WechatAlertInfo>() {\n                    @Override\n                    public WechatAlertInfo map(Map value) throws Exception {\n                        String body = (String)value.get(\"body\");\n                        WechatAlertInfo wechatAlertInfo = JSONObject.parseObject(body, WechatAlertInfo.class);\n                        return wechatAlertInfo;\n                    }\n                }).addSink(new WechatSink())\n                .name(\"wechat sink\");\n        try {\n            env.execute(\"send to wechat\");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n```\n\n4. å°†æ ¼å¼åŒ–å®Œæˆçš„æ•°æ®æºè¾“å‡ºåˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„Sinkä¸­ï¼Œè¯¥sinkçš„åŠŸèƒ½ä¸ºå‘é€wechatä¿¡æ¯ã€‚\n\n```java\npublic class WechatSink extends RichSinkFunction<WechatAlertInfo> {\n    private transient SendWechatService sendWechatService;\n\n    @Override\n    public void open(Configuration parameters) throws Exception {\n        sendWechatService = new SendWechatService();\n    }\n\n    @Override\n    public void invoke(WechatAlertInfo value, Context context) throws Exception {\n        sendWechatService.sendMessage(value.getAlertMsg(),value.getAlertTo());\n    }\n}\n```\n\nä»¥ä¸Šæˆ‘ä»¬å°±ç®€å•çš„å®ç°äº†å°†RocketMQä¸­çš„æŠ¥è­¦æ¶ˆæ¯æ¨é€è‡³wechatçš„åŠŸèƒ½ï¼Œä¸‹æ¬¡æˆ‘ä»¬æŠŠä»£ç è·‘èµ·æ¥çœ‹çœ‹ã€‚","slug":"åŸºäºFlinkè®¾è®¡ç»Ÿä¸€æŠ¥è­¦å¹³å°","published":1,"updated":"2020-12-14T09:51:24.020Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71hti000yv252112dc7je","content":"<html><head></head><body><p>&#x6700;&#x8FD1;&#x5728;&#x6574;&#x7406;&#x540E;&#x7AEF;&#x5DF2;&#x6709;&#x7684;&#x9519;&#x8BEF;&#x62A5;&#x8B66;&#xFF0C;&#x4E3B;&#x8981;&#x5206;&#x4E24;&#x5927;&#x7C7B;&#xFF1A;</p>\n<ol>\n<li>&#x5F02;&#x5E38;&#x62A5;&#x8B66;<ul>\n<li>&#x57FA;&#x4E8E;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x3002;&#x5982;CAT&#x3001;pingpong&#x3001;skywalking&#x7B49;APM&#x7CFB;&#x7EDF;&#x7684;&#x9519;&#x8BEF;&#x5F02;&#x5E38;&#x76D1;&#x63A7;&#x3002;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x9488;&#x5BF9;&#x5F02;&#x5E38;&#x7C7B;&#x578B;&#xFF0C;&#x5236;&#x5B9A;&#x76F8;&#x5E94;&#x7684;&#x9608;&#x503C;&#x3002;&#x5BF9;&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;&#x3001;sql&#x5F02;&#x5E38;&#x3001;&#x7F51;&#x7EDC;&#x5F02;&#x5E38;&#x7B49;&#x8FDB;&#x884C;&#x6307;&#x6807;&#x76D1;&#x63A7;&#x3002;&#x5F53;&#x5F02;&#x5E38;&#x8D85;&#x8FC7;&#x6307;&#x5B9A;&#x9608;&#x503C;&#x65F6;&#x63A8;&#x9001;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x540E;&#x7AEF;&#x7CFB;&#x7EDF;&#x662F;&#x57FA;&#x4E8E;CAT&#x8FDB;&#x884C;&#x76D1;&#x63A7;&#xFF0C;&#x76D1;&#x63A7;&#x7684;&#x6307;&#x6807;&#x548C;&#x914D;&#x7F6E;&#x90FD;&#x8981;&#x4EBA;&#x4E3A;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#xFF0C;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#x7684;&#x63A8;&#x9001;&#x9700;&#x8981;&#x5F00;&#x53D1;&#x5E76;&#x4E0E;CAT&#x5BF9;&#x63A5;&#xFF0C;&#x540C;&#x65F6;&#x5FAE;&#x4FE1;&#x63A8;&#x9001;&#x8FD9;&#x5757;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#x6709;&#x9650;&#xFF0C;&#x5F80;&#x5F80;&#x8981;&#x901A;&#x8FC7;&#x90AE;&#x4EF6;&#x544A;&#x8B66;&#x548C;&#x767B;&#x5F55;CAT&#x5E73;&#x53F0;&#x67E5;&#x770B;&#x624D;&#x80FD;&#x5927;&#x6982;&#x4E86;&#x89E3;&#x9519;&#x8BEF;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x8FD9;&#x70B9;&#x957F;&#x671F;&#x88AB;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x8BDF;&#x75C5;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x901A;&#x8FC7;&#x4FEE;&#x6539;CAT&#x7684;&#x6E90;&#x7801;&#x6765;&#x6539;&#x5584;&#x4E0A;&#x8BC9;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x5BF9;&#x4E8E;&#x7A0B;&#x5E8F;&#x5458;&#x6765;&#x8BF4;&#xFF0C;&#x66F4;&#x52A0;&#x76F4;&#x89C2;&#x7684;&#x5806;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x662F;&#x518D;&#x597D;&#x4E0D;&#x8FC7;&#x7684;&#x4E8B;&#x60C5;&#x3002;</li>\n<li>&#x57FA;&#x4E8E;&#x7CFB;&#x7EDF;&#x6307;&#x6807;&#x3002;&#x6709;&#x522B;&#x4E8E;&#x670D;&#x52A1;&#x5F02;&#x5E38;&#xFF0C;&#x7CFB;&#x7EDF;&#x6307;&#x6807;&#x6709;&#x66F4;&#x7075;&#x6D3B;&#x7684;&#x91C7;&#x96C6;&#x65B9;&#x5F0F;&#x3002;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x4E86;Spring Merics&#xFF0C;&#x57FA;&#x4E8E;Prometheus&#x642D;&#x5EFA;&#x4E86;&#x7CFB;&#x7EDF;&#x6307;&#x6807;&#x7684;&#x76D1;&#x63A7;&#x4F53;&#x7CFB;&#xFF0C;&#x7ED3;&#x5408;Grafana&#x5C06;&#x8FD1;&#x5B9E;&#x65F6;&#x7684;&#x7CFB;&#x7EDF;&#x6307;&#x6807;&#x5C55;&#x73B0;&#x81F3;&#x5C4F;&#x5E55;&#x3002;&#x540C;&#x6837;&#x9047;&#x5230;&#x7CFB;&#x7EDF;&#x6307;&#x6807;&#x5F02;&#x5E38;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;Heap&#x7A7A;&#x95F4;&#x4F7F;&#x7528;&#x91CF;&#x5F02;&#x5E38;&#xFF0C;CPU&#x98D9;&#x9AD8;&#xFF0C;&#x5185;&#x5B58;&#x544A;&#x6025;&#x7B49;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;Grafana&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x544A;&#x8B66;&#x5C06;&#x9519;&#x8BEF;&#x63A8;&#x9001;&#x7ED9;&#x76F8;&#x5173;&#x5F00;&#x53D1;&#x3002;<a id=\"more\"></a></li>\n</ul>\n</li>\n<li>&#x4E1A;&#x52A1;&#x544A;&#x8B66;<ul>\n<li>&#x57FA;&#x4E8E;&#x5B9E;&#x65F6;&#x6570;&#x636E;&#x3002;&#x901A;&#x8FC7;&#x5BF9;&#x4E1A;&#x52A1;&#x6D41;&#x7A0B;&#x7684;&#x57CB;&#x70B9;&#xFF0C;&#x5C06;&#x91C7;&#x96C6;&#x7684;&#x5B9E;&#x65F6;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x8BA1;&#x7B97;&#x6BD4;&#x8F83;&#x3002;&#x5E76;&#x5C06;&#x5F02;&#x5E38;&#x7684;&#x4E1A;&#x52A1;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x63A8;&#x9001;&#x544A;&#x8B66;&#x3002;</li>\n<li>&#x57FA;&#x4E8E;&#x79BB;&#x7EBF;&#x6570;&#x636E;&#x3002;&#x5B9A;&#x65F6;&#x5206;&#x6790;&#x79BB;&#x7EBF;&#x6570;&#x636E;&#xFF0C;&#x63A8;&#x9001;&#x5F02;&#x5E38;&#x4E1A;&#x52A1;&#x6570;&#x636E;&#x544A;&#x8B66;&#x3002;</li>\n</ul>\n</li>\n</ol>\n<p>&#x4EE5;&#x4E0A;&#x5927;&#x6982;&#x4ECB;&#x7ECD;&#x4E86;&#x76D1;&#x63A7;&#x7684;&#x51E0;&#x4E2A;&#x65B9;&#x5411;&#x53CA;&#x5176;&#x843D;&#x5730;&#x65B9;&#x5F0F;&#xFF0C;&#x901A;&#x8FC7;&#x5206;&#x6790;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x6574;&#x4E2A;&#x76D1;&#x63A7;&#x884C;&#x4E3A;&#x62BD;&#x8C61;&#x6210;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x6D41;&#xFF1A;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x6E90;&#x2013;&gt; &#x76D1;&#x63A7;&#x6570;&#x636E;&#x6E05;&#x6D17; &#x2013;&gt; &#x76D1;&#x63A7;&#x6570;&#x636E;&#x8BA1;&#x7B97; &#x2013;&gt; &#x63A8;&#x9001;&#x62A5;&#x8B66;</p>\n<p>&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x7ED3;&#x8BBA;&#xFF0C;&#x6B63;&#x5F0F;&#x6211;&#x4EEC;&#x4F1A;&#x5F00;&#x59CB;&#x7814;&#x7A76;&#x5E76;&#x63A2;&#x7D22;Flink&#x7684;&#x5951;&#x673A;&#x3002;&#x9762;&#x5BF9;&#x76EE;&#x524D;&#x540E;&#x7AEF;&#x5F62;&#x5F62;&#x8272;&#x8272;&#x7684;&#x76D1;&#x63A7;&#x65B9;&#x5F0F;&#x53CA;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x90E8;&#x5206;&#x90FD;&#x662F;&#x5272;&#x88C2;&#x7684;&#xFF0C;&#x65E0;&#x6CD5;&#x7EDF;&#x4E00;&#x601D;&#x60F3;&#x7684;&#x3002;&#x9762;&#x5BF9;&#x4E0D;&#x540C;&#x7684;&#x76D1;&#x63A7;&#x573A;&#x666F;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x8003;&#x8651;&#x4E0D;&#x540C;&#x63A5;&#x5904;&#x7406;&#x624B;&#x6BB5;&#xFF0C;&#x8FD9;&#x53D8;&#x76F8;&#x7684;&#x589E;&#x52A0;&#x4E86;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x7684;&#x4EBA;&#x529B;&#x8D44;&#x6E90;&#x3002;</p>\n<p>&#x4E3A;&#x6B64;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x600E;&#x6837;&#x53EF;&#x4EE5;&#x6700;&#x5927;&#x9650;&#x5EA6;&#x7684;&#x7EDF;&#x4E00;&#x5404;&#x4E2A;&#x62A5;&#x8B66;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x5904;&#x7406;&#x5E73;&#x53F0;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;Flink&#x6765;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x9762;&#x524D;&#x3002;</p>\n<p>Flink&#x662F;&#x4EC0;&#x4E48;&#x76F8;&#x6BD4;&#x4E0D;&#x7528;&#x4ECB;&#x7ECD;&#x4E86;&#xFF0C;&#x5B98;&#x7F51;&#x5DF2;&#x7ECF;&#x4ECB;&#x7ECD;&#x7684;&#x76F8;&#x5F53;&#x8BE6;&#x7EC6;&#x4E86;&#xFF1A;<br><a href=\"https://flink.apache.org/\">https://flink.apache.org/</a></p>\n<p>&#x4E0A;&#x9762;&#x62BD;&#x8C61;&#x7684;&#x76D1;&#x63A7;&#x6D41;&#x7A0B;&#xFF1A;&#x76D1;&#x63A7;&#x6570;&#x636E;&#x6E90;&#x2013;&gt; &#x76D1;&#x63A7;&#x6570;&#x636E;&#x6E05;&#x6D17; &#x2013;&gt; &#x76D1;&#x63A7;&#x6570;&#x636E;&#x8BA1;&#x7B97; &#x2013;&gt; &#x63A8;&#x9001;&#x62A5;&#x8B66;</p>\n<p>&#x7528;Flink&#x53EF;&#x4EE5;&#x8868;&#x793A;&#x4E3A;&#xFF1A;Source&#x2013;&gt; ETL&#x2013;&gt; Operator&#x2013;&gt; Sink</p>\n<p>&#x7ED3;&#x5408;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x6253;&#x7B97;&#x5148;&#x4ECE;&#x63A8;&#x9001;&#x62A5;&#x8B66;&#x529F;&#x80FD;&#x5165;&#x624B;&#x3002;&#x5229;&#x7528;Flink&#x7684;&#x6D41;&#x5F0F;&#x5904;&#x7406;&#x80FD;&#x529B;&#xFF0C;&#x5F00;&#x53D1;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x62A5;&#x8B66;&#x51FA;&#x53E3;&#x4EFB;&#x52A1;&#x3002;</p>\n<h4 id=\"&#x6570;&#x636E;&#x6E90;\"><a href=\"#&#x6570;&#x636E;&#x6E90;\" class=\"headerlink\" title=\"&#x6570;&#x636E;&#x6E90;\"></a>&#x6570;&#x636E;&#x6E90;</h4><p>&#x6570;&#x636E;&#x6E90;&#x6211;&#x4EEC;&#x6253;&#x7B97;&#x91C7;&#x7528;RocketMQ&#x3002;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7EDF;&#x4E00;&#x7684;&#x62A5;&#x8B66;&#x63A8;&#x9001;Topic&#xFF0C;&#x5B9A;&#x4E49;&#x7EDF;&#x4E00;&#x7684;&#x62A5;&#x8B66;&#x6D88;&#x606F;&#x683C;&#x5F0F;&#x3002;</p>\n<table>\n<thead>\n<tr>\n<th>Topic</th>\n<th>AlertWechatTopic</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Body</td>\n<td>{&#x201C;alertMsg&#x201D;:&#x201D;&#x201D;,<br>&#x201C;alertTo&#x201D;:&#x201D;&#x201D;,<br>&#x201C;bizType&#x201D;:&#x201D;&#x201D;<br> }</td>\n</tr>\n</tbody></table>\n<h4 id=\"&#x7B97;&#x5B50;\"><a href=\"#&#x7B97;&#x5B50;\" class=\"headerlink\" title=\"&#x7B97;&#x5B50;\"></a>&#x7B97;&#x5B50;</h4><ol>\n<li><p>&#x5E94;&#x7528;RocketMQ-Extend&#x63D0;&#x4F9B;&#x7684;Flink&#x652F;&#x6301;&#xFF0C;&#x5B98;&#x65B9;&#x7EE7;&#x627F;&#x4E86;RichParallelSourceFunction&#x7C7B;&#x3002;&#x5B9E;&#x73B0;&#x4E86;&#x6CE8;&#x518C;Consumer&#xFF0C;&#x62C9;&#x53D6;Topic&#x4E0B;&#x7684;&#x6D88;&#x606F;&#x3002;</p>\n</li>\n<li><p>&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;&#x5E8F;&#x5217;&#x5316;&#x65B9;&#x6CD5;&#x4EC5;&#x6709;&#x9488;&#x5BF9;key&#x548C;value&#x7684;String&#x5E8F;&#x5217;&#x5316;SimpleKeyValueDeserializationSchema&#x3002;&#x5728;&#x8FD0;&#x7528;&#x4E0A;&#x662F;&#x6EE1;&#x8DB3;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x540E;&#x671F;&#x7F16;&#x7A0B;&#x4E0A;&#x53EF;&#x80FD;&#x81EA;&#x5B9A;&#x4E49;&#x4F1A;&#x66F4;&#x52A0;&#x65B9;&#x4FBF;&#x3002;&#x540E;&#x671F;&#x6211;&#x4EEC;&#x4F1A;&#x8003;&#x8651;&#x6269;&#x5C55;&#x5E8F;&#x5217;&#x5316;&#x65B9;&#x5F0F;&#x6216;&#x662F;&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;&#x62C9;&#x53D6;&#x6D88;&#x606F;&#x6E90;&#x7801;&#xFF0C;&#x505A;&#x5230;&#x66F4;&#x7075;&#x6D3B;&#x7684;&#x6D88;&#x606F;&#x683C;&#x5F0F;&#x4F20;&#x8F93;&#x3002;</p>\n</li>\n<li><p>&#x5C06;&#x4ECE;RocketMQ&#x4E2D;&#x62C9;&#x53D6;&#x5230;&#x7684;&#x6D88;&#x606F;&#x505A;Map&#xFF0C;&#x683C;&#x5F0F;&#x5316;&#x6210;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x7684;&#x7ED3;&#x6784;&#x3002;</p>\n</li>\n</ol>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>{</span><br><span class=\"line\">        ParameterTool parameterTool = ParameterTool.fromArgs(args);</span><br><span class=\"line\">        String nameserverAddress = parameterTool.get(<span class=\"hljs-string\">&quot;nameserverAddress&quot;</span>);</span><br><span class=\"line\">        String consumerGroup = parameterTool.get(<span class=\"hljs-string\">&quot;consumerGroup&quot;</span>);</span><br><span class=\"line\">        String consumerTopic = parameterTool.get(<span class=\"hljs-string\">&quot;consumerTopic&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class=\"line\">        SendWechatService sendWechatService = <span class=\"hljs-keyword\">new</span> SendWechatService();</span><br><span class=\"line\">        <span class=\"hljs-comment\">// enable checkpoint</span></span><br><span class=\"line\">        env.enableCheckpointing(<span class=\"hljs-number\">3000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        Properties consumerProps = <span class=\"hljs-keyword\">new</span> Properties();</span><br><span class=\"line\">        consumerProps.setProperty(RocketMQConfig.NAME_SERVER_ADDR, nameserverAddress);</span><br><span class=\"line\">        consumerProps.setProperty(RocketMQConfig.CONSUMER_GROUP, consumerGroup);</span><br><span class=\"line\">        consumerProps.setProperty(RocketMQConfig.CONSUMER_TOPIC, consumerTopic);</span><br><span class=\"line\"></span><br><span class=\"line\">        env.addSource(<span class=\"hljs-keyword\">new</span> RocketMQSource&lt;Map&gt;(<span class=\"hljs-keyword\">new</span> SimpleKeyValueDeserializationSchema(<span class=\"hljs-keyword\">null</span>,<span class=\"hljs-string\">&quot;body&quot;</span>),consumerProps))</span><br><span class=\"line\">                .name(<span class=\"hljs-string\">&quot;rocketmq-source&quot;</span>)</span><br><span class=\"line\">                .map(<span class=\"hljs-keyword\">new</span> MapFunction&lt;Map, WechatAlertInfo&gt;() {</span><br><span class=\"line\">                    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">                    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> WechatAlertInfo <span class=\"hljs-title\">map</span><span class=\"hljs-params\">(Map value)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{</span><br><span class=\"line\">                        String body = (String)value.get(<span class=\"hljs-string\">&quot;body&quot;</span>);</span><br><span class=\"line\">                        WechatAlertInfo wechatAlertInfo = JSONObject.parseObject(body, WechatAlertInfo.class);</span><br><span class=\"line\">                        <span class=\"hljs-keyword\">return</span> wechatAlertInfo;</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }).addSink(<span class=\"hljs-keyword\">new</span> WechatSink())</span><br><span class=\"line\">                .name(<span class=\"hljs-string\">&quot;wechat sink&quot;</span>);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">try</span> {</span><br><span class=\"line\">            env.execute(<span class=\"hljs-string\">&quot;send to wechat&quot;</span>);</span><br><span class=\"line\">        } <span class=\"hljs-keyword\">catch</span> (Exception e) {</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></tbody></table></figure>\n\n<ol start=\"4\">\n<li>&#x5C06;&#x683C;&#x5F0F;&#x5316;&#x5B8C;&#x6210;&#x7684;&#x6570;&#x636E;&#x6E90;&#x8F93;&#x51FA;&#x5230;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7684;Sink&#x4E2D;&#xFF0C;&#x8BE5;sink&#x7684;&#x529F;&#x80FD;&#x4E3A;&#x53D1;&#x9001;wechat&#x4FE1;&#x606F;&#x3002;</li>\n</ol>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">WechatSink</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">RichSinkFunction</span>&lt;<span class=\"hljs-title\">WechatAlertInfo</span>&gt; </span>{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">transient</span> SendWechatService sendWechatService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">open</span><span class=\"hljs-params\">(Configuration parameters)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{</span><br><span class=\"line\">        sendWechatService = <span class=\"hljs-keyword\">new</span> SendWechatService();</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">invoke</span><span class=\"hljs-params\">(WechatAlertInfo value, Context context)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{</span><br><span class=\"line\">        sendWechatService.sendMessage(value.getAlertMsg(),value.getAlertTo());</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x4EE5;&#x4E0A;&#x6211;&#x4EEC;&#x5C31;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x73B0;&#x4E86;&#x5C06;RocketMQ&#x4E2D;&#x7684;&#x62A5;&#x8B66;&#x6D88;&#x606F;&#x63A8;&#x9001;&#x81F3;wechat&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x4E0B;&#x6B21;&#x6211;&#x4EEC;&#x628A;&#x4EE3;&#x7801;&#x8DD1;&#x8D77;&#x6765;&#x770B;&#x770B;&#x3002;</p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Flink","path":"tags/Flink/"},{"name":"ç›‘æ§","path":"tags/ç›‘æ§/"}],"excerpt":"<html><head></head><body><p>&#x6700;&#x8FD1;&#x5728;&#x6574;&#x7406;&#x540E;&#x7AEF;&#x5DF2;&#x6709;&#x7684;&#x9519;&#x8BEF;&#x62A5;&#x8B66;&#xFF0C;&#x4E3B;&#x8981;&#x5206;&#x4E24;&#x5927;&#x7C7B;&#xFF1A;</p>\n<ol>\n<li>&#x5F02;&#x5E38;&#x62A5;&#x8B66;<ul>\n<li>&#x57FA;&#x4E8E;&#x76D1;&#x63A7;&#x7CFB;&#x7EDF;&#x3002;&#x5982;CAT&#x3001;pingpong&#x3001;skywalking&#x7B49;APM&#x7CFB;&#x7EDF;&#x7684;&#x9519;&#x8BEF;&#x5F02;&#x5E38;&#x76D1;&#x63A7;&#x3002;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x9488;&#x5BF9;&#x5F02;&#x5E38;&#x7C7B;&#x578B;&#xFF0C;&#x5236;&#x5B9A;&#x76F8;&#x5E94;&#x7684;&#x9608;&#x503C;&#x3002;&#x5BF9;&#x4EE3;&#x7801;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;&#x3001;sql&#x5F02;&#x5E38;&#x3001;&#x7F51;&#x7EDC;&#x5F02;&#x5E38;&#x7B49;&#x8FDB;&#x884C;&#x6307;&#x6807;&#x76D1;&#x63A7;&#x3002;&#x5F53;&#x5F02;&#x5E38;&#x8D85;&#x8FC7;&#x6307;&#x5B9A;&#x9608;&#x503C;&#x65F6;&#x63A8;&#x9001;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x540E;&#x7AEF;&#x7CFB;&#x7EDF;&#x662F;&#x57FA;&#x4E8E;CAT&#x8FDB;&#x884C;&#x76D1;&#x63A7;&#xFF0C;&#x76D1;&#x63A7;&#x7684;&#x6307;&#x6807;&#x548C;&#x914D;&#x7F6E;&#x90FD;&#x8981;&#x4EBA;&#x4E3A;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#xFF0C;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#x7684;&#x63A8;&#x9001;&#x9700;&#x8981;&#x5F00;&#x53D1;&#x5E76;&#x4E0E;CAT&#x5BF9;&#x63A5;&#xFF0C;&#x540C;&#x65F6;&#x5FAE;&#x4FE1;&#x63A8;&#x9001;&#x8FD9;&#x5757;&#x5F02;&#x5E38;&#x4FE1;&#x606F;&#x6709;&#x9650;&#xFF0C;&#x5F80;&#x5F80;&#x8981;&#x901A;&#x8FC7;&#x90AE;&#x4EF6;&#x544A;&#x8B66;&#x548C;&#x767B;&#x5F55;CAT&#x5E73;&#x53F0;&#x67E5;&#x770B;&#x624D;&#x80FD;&#x5927;&#x6982;&#x4E86;&#x89E3;&#x9519;&#x8BEF;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x8FD9;&#x70B9;&#x957F;&#x671F;&#x88AB;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x8BDF;&#x75C5;&#xFF0C;&#x867D;&#x7136;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x901A;&#x8FC7;&#x4FEE;&#x6539;CAT&#x7684;&#x6E90;&#x7801;&#x6765;&#x6539;&#x5584;&#x4E0A;&#x8BC9;&#x95EE;&#x9898;&#x3002;&#x4F46;&#x5BF9;&#x4E8E;&#x7A0B;&#x5E8F;&#x5458;&#x6765;&#x8BF4;&#xFF0C;&#x66F4;&#x52A0;&#x76F4;&#x89C2;&#x7684;&#x5806;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x662F;&#x518D;&#x597D;&#x4E0D;&#x8FC7;&#x7684;&#x4E8B;&#x60C5;&#x3002;</li>\n<li>&#x57FA;&#x4E8E;&#x7CFB;&#x7EDF;&#x6307;&#x6807;&#x3002;&#x6709;&#x522B;&#x4E8E;&#x670D;&#x52A1;&#x5F02;&#x5E38;&#xFF0C;&#x7CFB;&#x7EDF;&#x6307;&#x6807;&#x6709;&#x66F4;&#x7075;&#x6D3B;&#x7684;&#x91C7;&#x96C6;&#x65B9;&#x5F0F;&#x3002;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x4E86;Spring Merics&#xFF0C;&#x57FA;&#x4E8E;Prometheus&#x642D;&#x5EFA;&#x4E86;&#x7CFB;&#x7EDF;&#x6307;&#x6807;&#x7684;&#x76D1;&#x63A7;&#x4F53;&#x7CFB;&#xFF0C;&#x7ED3;&#x5408;Grafana&#x5C06;&#x8FD1;&#x5B9E;&#x65F6;&#x7684;&#x7CFB;&#x7EDF;&#x6307;&#x6807;&#x5C55;&#x73B0;&#x81F3;&#x5C4F;&#x5E55;&#x3002;&#x540C;&#x6837;&#x9047;&#x5230;&#x7CFB;&#x7EDF;&#x6307;&#x6807;&#x5F02;&#x5E38;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;Heap&#x7A7A;&#x95F4;&#x4F7F;&#x7528;&#x91CF;&#x5F02;&#x5E38;&#xFF0C;CPU&#x98D9;&#x9AD8;&#xFF0C;&#x5185;&#x5B58;&#x544A;&#x6025;&#x7B49;&#x60C5;&#x51B5;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;Grafana&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x544A;&#x8B66;&#x5C06;&#x9519;&#x8BEF;&#x63A8;&#x9001;&#x7ED9;&#x76F8;&#x5173;&#x5F00;&#x53D1;&#x3002;</li></ul></li></ol></body></html>","more":"\n\n\n<li>ä¸šåŠ¡å‘Šè­¦<ul>\n<li>åŸºäºå®æ—¶æ•°æ®ã€‚é€šè¿‡å¯¹ä¸šåŠ¡æµç¨‹çš„åŸ‹ç‚¹ï¼Œå°†é‡‡é›†çš„å®æ—¶æ•°æ®è¿›è¡Œè®¡ç®—æ¯”è¾ƒã€‚å¹¶å°†å¼‚å¸¸çš„ä¸šåŠ¡æ•°æ®è¿›è¡Œæ¨é€å‘Šè­¦ã€‚</li>\n<li>åŸºäºç¦»çº¿æ•°æ®ã€‚å®šæ—¶åˆ†æç¦»çº¿æ•°æ®ï¼Œæ¨é€å¼‚å¸¸ä¸šåŠ¡æ•°æ®å‘Šè­¦ã€‚</li>\n</ul>\n</li>\n\n<p>ä»¥ä¸Šå¤§æ¦‚ä»‹ç»äº†ç›‘æ§çš„å‡ ä¸ªæ–¹å‘åŠå…¶è½åœ°æ–¹å¼ï¼Œé€šè¿‡åˆ†ææˆ‘ä»¬å¯ä»¥å°†æ•´ä¸ªç›‘æ§è¡Œä¸ºæŠ½è±¡æˆä¸€ä¸ªæ•°æ®æµï¼šç›‘æ§æ•°æ®æºâ€“&gt; ç›‘æ§æ•°æ®æ¸…æ´— â€“&gt; ç›‘æ§æ•°æ®è®¡ç®— â€“&gt; æ¨é€æŠ¥è­¦</p>\n<p>åŸºäºè¿™ä¸ªç»“è®ºï¼Œæ­£å¼æˆ‘ä»¬ä¼šå¼€å§‹ç ”ç©¶å¹¶æ¢ç´¢Flinkçš„å¥‘æœºã€‚é¢å¯¹ç›®å‰åç«¯å½¢å½¢è‰²è‰²çš„ç›‘æ§æ–¹å¼åŠå¤„ç†æµç¨‹ï¼Œæ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½æ˜¯å‰²è£‚çš„ï¼Œæ— æ³•ç»Ÿä¸€æ€æƒ³çš„ã€‚é¢å¯¹ä¸åŒçš„ç›‘æ§åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬è¦è€ƒè™‘ä¸åŒæ¥å¤„ç†æ‰‹æ®µï¼Œè¿™å˜ç›¸çš„å¢åŠ äº†å¼€å‘äººå‘˜çš„äººåŠ›èµ„æºã€‚</p>\n<p>ä¸ºæ­¤æˆ‘ä»¬è€ƒè™‘æ€æ ·å¯ä»¥æœ€å¤§é™åº¦çš„ç»Ÿä¸€å„ä¸ªæŠ¥è­¦çš„æµç¨‹ï¼Œå¹¶æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å¤„ç†å¹³å°ã€‚è¿™ä¸ªæ—¶å€™Flinkæ¥åˆ°äº†æˆ‘ä»¬é¢å‰ã€‚</p>\n<p>Flinkæ˜¯ä»€ä¹ˆç›¸æ¯”ä¸ç”¨ä»‹ç»äº†ï¼Œå®˜ç½‘å·²ç»ä»‹ç»çš„ç›¸å½“è¯¦ç»†äº†ï¼š<br><a href=\"https://flink.apache.org/\">https://flink.apache.org/</a></p>\n<p>ä¸Šé¢æŠ½è±¡çš„ç›‘æ§æµç¨‹ï¼šç›‘æ§æ•°æ®æºâ€“&gt; ç›‘æ§æ•°æ®æ¸…æ´— â€“&gt; ç›‘æ§æ•°æ®è®¡ç®— â€“&gt; æ¨é€æŠ¥è­¦</p>\n<p>ç”¨Flinkå¯ä»¥è¡¨ç¤ºä¸ºï¼šSourceâ€“&gt; ETLâ€“&gt; Operatorâ€“&gt; Sink</p>\n<p>ç»“åˆä¸Šé¢çš„åˆ†æï¼Œæˆ‘æ‰“ç®—å…ˆä»æ¨é€æŠ¥è­¦åŠŸèƒ½å…¥æ‰‹ã€‚åˆ©ç”¨Flinkçš„æµå¼å¤„ç†èƒ½åŠ›ï¼Œå¼€å‘ä¸€ä¸ªç»Ÿä¸€çš„æŠ¥è­¦å‡ºå£ä»»åŠ¡ã€‚</p>\n<h4 id=\"æ•°æ®æº\"><a href=\"#æ•°æ®æº\" class=\"headerlink\" title=\"æ•°æ®æº\"></a>æ•°æ®æº</h4><p>æ•°æ®æºæˆ‘ä»¬æ‰“ç®—é‡‡ç”¨RocketMQã€‚åˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„æŠ¥è­¦æ¨é€Topicï¼Œå®šä¹‰ç»Ÿä¸€çš„æŠ¥è­¦æ¶ˆæ¯æ ¼å¼ã€‚</p>\n<table>\n<thead>\n<tr>\n<th>Topic</th>\n<th>AlertWechatTopic</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Body</td>\n<td>{â€œalertMsgâ€:â€â€,<br>â€œalertToâ€:â€â€,<br>â€œbizTypeâ€:â€â€<br> }</td>\n</tr>\n</tbody></table>\n<h4 id=\"ç®—å­\"><a href=\"#ç®—å­\" class=\"headerlink\" title=\"ç®—å­\"></a>ç®—å­</h4><ol>\n<li><p>åº”ç”¨RocketMQ-Extendæä¾›çš„Flinkæ”¯æŒï¼Œå®˜æ–¹ç»§æ‰¿äº†RichParallelSourceFunctionç±»ã€‚å®ç°äº†æ³¨å†ŒConsumerï¼Œæ‹‰å–Topicä¸‹çš„æ¶ˆæ¯ã€‚</p>\n</li>\n<li><p>å®˜æ–¹æä¾›çš„åºåˆ—åŒ–æ–¹æ³•ä»…æœ‰é’ˆå¯¹keyå’Œvalueçš„Stringåºåˆ—åŒ–SimpleKeyValueDeserializationSchemaã€‚åœ¨è¿ç”¨ä¸Šæ˜¯æ»¡è¶³çš„ï¼Œä½†æ˜¯åæœŸç¼–ç¨‹ä¸Šå¯èƒ½è‡ªå®šä¹‰ä¼šæ›´åŠ æ–¹ä¾¿ã€‚åæœŸæˆ‘ä»¬ä¼šè€ƒè™‘æ‰©å±•åºåˆ—åŒ–æ–¹å¼æˆ–æ˜¯å®˜æ–¹æä¾›çš„æ‹‰å–æ¶ˆæ¯æºç ï¼Œåšåˆ°æ›´çµæ´»çš„æ¶ˆæ¯æ ¼å¼ä¼ è¾“ã€‚</p>\n</li>\n<li><p>å°†ä»RocketMQä¸­æ‹‰å–åˆ°çš„æ¶ˆæ¯åšMapï¼Œæ ¼å¼åŒ–æˆæˆ‘ä»¬å¸Œæœ›çš„ç»“æ„ã€‚</p>\n</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        ParameterTool parameterTool = ParameterTool.fromArgs(args);</span><br><span class=\"line\">        String nameserverAddress = parameterTool.get(<span class=\"string\">&quot;nameserverAddress&quot;</span>);</span><br><span class=\"line\">        String consumerGroup = parameterTool.get(<span class=\"string\">&quot;consumerGroup&quot;</span>);</span><br><span class=\"line\">        String consumerTopic = parameterTool.get(<span class=\"string\">&quot;consumerTopic&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class=\"line\">        SendWechatService sendWechatService = <span class=\"keyword\">new</span> SendWechatService();</span><br><span class=\"line\">        <span class=\"comment\">// enable checkpoint</span></span><br><span class=\"line\">        env.enableCheckpointing(<span class=\"number\">3000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        Properties consumerProps = <span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">        consumerProps.setProperty(RocketMQConfig.NAME_SERVER_ADDR, nameserverAddress);</span><br><span class=\"line\">        consumerProps.setProperty(RocketMQConfig.CONSUMER_GROUP, consumerGroup);</span><br><span class=\"line\">        consumerProps.setProperty(RocketMQConfig.CONSUMER_TOPIC, consumerTopic);</span><br><span class=\"line\"></span><br><span class=\"line\">        env.addSource(<span class=\"keyword\">new</span> RocketMQSource&lt;Map&gt;(<span class=\"keyword\">new</span> SimpleKeyValueDeserializationSchema(<span class=\"keyword\">null</span>,<span class=\"string\">&quot;body&quot;</span>),consumerProps))</span><br><span class=\"line\">                .name(<span class=\"string\">&quot;rocketmq-source&quot;</span>)</span><br><span class=\"line\">                .map(<span class=\"keyword\">new</span> MapFunction&lt;Map, WechatAlertInfo&gt;() &#123;</span><br><span class=\"line\">                    <span class=\"meta\">@Override</span></span><br><span class=\"line\">                    <span class=\"function\"><span class=\"keyword\">public</span> WechatAlertInfo <span class=\"title\">map</span><span class=\"params\">(Map value)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">                        String body = (String)value.get(<span class=\"string\">&quot;body&quot;</span>);</span><br><span class=\"line\">                        WechatAlertInfo wechatAlertInfo = JSONObject.parseObject(body, WechatAlertInfo.class);</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> wechatAlertInfo;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;).addSink(<span class=\"keyword\">new</span> WechatSink())</span><br><span class=\"line\">                .name(<span class=\"string\">&quot;wechat sink&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            env.execute(<span class=\"string\">&quot;send to wechat&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>å°†æ ¼å¼åŒ–å®Œæˆçš„æ•°æ®æºè¾“å‡ºåˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„Sinkä¸­ï¼Œè¯¥sinkçš„åŠŸèƒ½ä¸ºå‘é€wechatä¿¡æ¯ã€‚</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WechatSink</span> <span class=\"keyword\">extends</span> <span class=\"title\">RichSinkFunction</span>&lt;<span class=\"title\">WechatAlertInfo</span>&gt; </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> SendWechatService sendWechatService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">open</span><span class=\"params\">(Configuration parameters)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        sendWechatService = <span class=\"keyword\">new</span> SendWechatService();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">invoke</span><span class=\"params\">(WechatAlertInfo value, Context context)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        sendWechatService.sendMessage(value.getAlertMsg(),value.getAlertTo());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä»¥ä¸Šæˆ‘ä»¬å°±ç®€å•çš„å®ç°äº†å°†RocketMQä¸­çš„æŠ¥è­¦æ¶ˆæ¯æ¨é€è‡³wechatçš„åŠŸèƒ½ï¼Œä¸‹æ¬¡æˆ‘ä»¬æŠŠä»£ç è·‘èµ·æ¥çœ‹çœ‹ã€‚</p>"},{"title":"æˆ‘ä¸ºä»€ä¹ˆä¼šæ‰‹æ’¸ä¸€ä¸ªé…ç½®ä¸­å¿ƒ--ä»‹ç»ç¯‡","date":"2020-03-20T13:39:15.000Z","_content":"nadia-configæ˜¯ä¸€æ¬¾åŸºäºspring bootçš„é…ç½®ä¸­å¿ƒï¼Œèƒ½å¤Ÿé›†ä¸­åŒ–ç®¡ç†ä¸åŒç¯å¢ƒã€ä¸åŒç‰ˆæœ¬çš„é›†ç¾¤é…ç½®ï¼Œå¹¶æä¾›é…ç½®çš„å®æ—¶æ›´æ–°ã€å›è°ƒã€å®¡æ‰¹ã€æƒé™ç®¡ç†ç­‰åŠŸèƒ½ã€‚\n>https://github.com/nadia-repository/nadia-config\n\n# Nadia Config Center\n\n## ç»„ä»¶ä»‹ç»\n- [nadia-client](nadia-client/README.md)\n- [nadia-server](nadia-server/README.md)\n\n## Release-Note\n- v1.0\n<!-- more -->\n## ä¸»è¦ç›®æ ‡ï¼š\n\n- å…¼å®¹springbootæ¡†æ¶ï¼Œä¸šåŠ¡ç³»ç»Ÿæ— éœ€ä»£ç å˜æ›´\n- å¿«é€Ÿæ¥å…¥ï¼ŒjaråŒ…å¼•ç”¨\n- é…ç½®åŠ¨æ€æ›´æ–°ï¼Œå®æ—¶ç”Ÿæ•ˆ\n- æ”¯æŒé›†ç¾¤åˆ†ç»„ï¼Œé…ç½®å·®å¼‚åŒ–\n- æä¾›é…ç½®ç»Ÿä¸€å˜æ›´å¹³å°ï¼Œæ”¯æŒå¹³å°ç”¨æˆ·çš„æƒé™ç®¡ç†å’Œé…ç½®å˜æ›´çš„æƒé™ç®¡ç†\n\n#### éƒ¨ç½²å›¾\n\n![01](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/æœåŠ¡éƒ¨ç½²å›¾.png)\n\n#### é¡¹ç›®æ„æˆ\n> nadia-config é¡¹ç›®æ ¹ç›®å½•\n\n>> nadia-client å®¢æˆ·ç«¯\n\n>> nadia-core é€šç”¨ä»£ç \n\n>> nadia-server æœåŠ¡ç«¯\n\n>> nadia-web å‰ç«¯é¡µé¢\n\n>> nadia-demo å®¢æˆ·ç«¯demo\n\n>> docs æ–‡æ¡£\n\n>>> desgin è®¾è®¡æ–‡æ¡£\n\n>>> sql æœåŠ¡ç«¯è„šæœ¬\n\n>>>> DDL.sql å»ºè¡¨\n\n>>>> DML.sql åˆå§‹æ•°æ®\n\n\n#### ç®¡ç†å¹³å°ä»‹ç»\n\n#### 1. ç™»å½•é¡µé¢\n\n![02](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/ç™»å½•.png)\n\n#### 2. æ³¨å†Œé¡µé¢\n\n![03](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/æ³¨å†Œ.png)\n\n\n#### 3. ä¸»ç•Œé¢\n###### æ ¹æ®ç™»å½•ç”¨æˆ·çš„è§’è‰²ä¸åŒï¼Œèœå•æŒ‰é’®ä¼šæœ‰ç›¸åº”å˜åŒ–\n\n![04](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/ä¸»é¡µé¢.png)\n\n\n#### 4. é…ç½®ç®¡ç†--å…ƒæ•°æ®ç®¡ç†\n###### å…ƒæ•°æ®ç®¡ç†æ˜¯æ‰€æœ‰é…ç½®çš„åŸºç¡€ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨é…ç½®é¡¹æ—¶éœ€è¦æŒ‡å®šç›¸å…³çš„å…ƒæ•°æ®\n\n![05](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/metadata.png)\n\n\n###### åè¯è§£é‡Š\n* Application ç³»ç»Ÿåç§°ï¼Œå®¢æˆ·ç«¯å¯ä»¥æŒ‡å®šä½¿ç”¨ä»»æ„ä¸€å¥—ç³»ç»Ÿä¸‹çš„é…ç½®ã€‚\n* Group ç»„åç§°ï¼Œå®¢æˆ·ç«¯æŒ‡å®šç³»ç»Ÿåï¼Œä»éœ€è¦æŒ‡å®šä½¿ç”¨ç³»ç»Ÿä¸‹çš„æŸä¸ªç»„ã€‚è‹¥ä¸å¼ºåˆ¶æŒ‡å®šï¼Œå®¢æˆ·ç«¯å¯åŠ¨åä¼šé»˜è®¤ä½¿ç”¨Defaultç»„ä¸‹çš„é…ç½®ï¼ŒåæœŸå¯ä½¿ç”¨ç»„åˆ‡æ¢åŠŸèƒ½åˆ‡æ¢è‡³ä¸åŒç»„ã€‚\n\n###### åŠŸèƒ½è¯´æ˜\n* Add æ–°å¢Applicationï¼ŒåŒæ—¶æ–°å¢é»˜è®¤Group(Default)ã€‚\n* Delete åˆ é™¤Application\\Groupä¿¡æ¯ã€‚å½“å‰Groupå¦‚æœæ­£åœ¨è¢«ä½¿ç”¨ï¼Œæˆ–å½“å‰ç»„ä¸ºDefaultç»„ä¸”å­˜åœ¨éDefaultç»„æ—¶ï¼Œä¸èƒ½åˆ é™¤ã€‚Defualtç»„åˆ é™¤åå°†åŒæ—¶åˆ é™¤Applicationã€‚\n* Compare æ¯”è¾ƒåŒä¸€Applicationä¸‹ä¸åŒGroupçš„é…ç½®å·®å¼‚ï¼Œå¯å¤šé€‰ï¼Œä½†è‡³å°‘é€‰ä¸¤ä¸ªç»„ã€‚\n\n![06](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/compare.png)\n\n\n* Edit ä¿®æ”¹Applicationä¿¡æ¯\n* Group æ–°å¢ç»„ã€‚å¯é€‰æ‹©ä»æŸä¸ªç»„å¤åˆ¶æ‰€æœ‰å·²å‘å¸ƒé…ç½®é¡¹ï¼Œæˆ–ç”Ÿäº§æ–°çš„ç©ºç»„ã€‚\n\n![07](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/addGroup.png)\n\n\n* Instances å¯å°†æŸå®ä¾‹è°ƒæ•´è‡³å¦ä¸€ç»„ã€‚\n\n![08](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/switch.png)\n\n\n* Inscance æŸ¥çœ‹å¼„å®ä¾‹å½“å‰çš„é…ç½®ä¸æœåŠ¡ç«¯é…ç½®çš„å·®å¼‚ã€‚\n\n![09](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/instance.png)\n\n\n#### 5. é…ç½®ç®¡ç†--é…ç½®é¡¹ç®¡ç†\n###### é…ç½®é¡¹ç®¡ç†æä¾›å…·ä½“é…ç½®çš„å¢åˆ æ”¹æŸ¥ã€å‘å¸ƒç­‰åŠŸèƒ½\n\n![10](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/configs.png)\n\n\n###### åè¯è§£é‡Š\n* Key é…ç½®é¡¹çš„keyï¼Œä¸å®¢æˆ·ç«¯ä¸­@Value({key})ç›¸å¯¹åº”\n* Value å€¼\n* Status \n    * new æ–°å»ºé…ç½®\n    * edited é…ç½®å·²å˜æ›´ï¼Œå¸¦å®¡æ‰¹\n    * approved é…ç½®å®¡æ‰¹é€šè¿‡ï¼Œå¯å‘å¸ƒ\n    * published é…ç½®å·²å‘å¸ƒ\n    * removing é…ç½®åˆ é™¤ï¼Œå¾…å®¡æ‰¹\n    * deleted é…ç½®å·²åˆ é™¤ï¼Œä¸æ˜¾ç¤º\n    * invalid é…ç½®æ— æ•ˆï¼Œä¸æ˜¾ç¤º\n    \n###### åŠŸèƒ½è¯´æ˜\n* Add æ–°å¢é…ç½®ï¼Œå¯é€‰æ‹©é…ç½®çš„å¯è§æƒé™ã€‚è‹¥ä¸é€‰æ‹©ï¼Œåˆ™è¯¥é…ç½®ä¸ºå½“å‰ç™»å½•ç”¨æˆ·çš„è§’è‰²å¯è§ã€‚éœ€è¦å®¡æ‰¹ã€‚\n* Delete åˆ é™¤é…ç½®ï¼Œéœ€è¦å®¡æ‰¹ã€‚\n* Export å¯¼å‡ºé…ç½®ã€‚\n* Import å¯¼å…¥é…ç½®ï¼Œéœ€è¦å®¡æ‰¹ã€‚\n* Edit ç¼–è¾‘é…ç½®ï¼Œéœ€è¦å®¡æ‰¹ã€‚\n* Instance æŸ¥çœ‹å½“å‰é…ç½®çš„ä½¿ç”¨æƒ…å†µã€‚\n\n![11](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/instanceConfig.png)\n\n\n* History é…ç½®ä¿®æ”¹å†å²\n\n![12](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/history.png)\n\n\n#### 6. é…ç½®ç®¡ç†--é…ç½®é¡¹åˆ†é…\n###### é…ç½®é¡¹åˆ†é…æä¾›å…¨å±€çš„è§’è‰²é…ç½®å¯è§æƒé™è®¾ç½®ã€‚\n\n![13](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/allocate.png)\n\n\n###### åŠŸèƒ½è¯´æ˜\n* Allocate åˆ†é…è§’è‰²å¯è§é…ç½®\n\n![14](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/allocateConfigs.png)\n\n\n#### 7. æ¶ˆæ¯ä¸­å¿ƒ--æ“ä½œæ—¥å¿—\n###### æä¾›ç®¡ç†å¹³å°æ‰€æœ‰å¢åˆ æ”¹çš„æ“ä½œæ—¥å¿—æŸ¥è¯¢å’Œå›æº¯ã€‚\n\n![15](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/operationLog.png)\n\n\n#### 8. æ¶ˆæ¯ä¸­å¿ƒ--ä»»åŠ¡ä¸­å¿ƒ\n###### æä¾›å®¡æ‰¹æŸ¥çœ‹ã€å®¡æ‰¹æ“ä½œ(é€šè¿‡ã€æ‹’ç»)ç­‰åŠŸèƒ½ã€‚\n* Pending Task å¾…å®¡æ‰¹åˆ—è¡¨ï¼Œæä¾›å®¡æ‰¹é€šè¿‡ã€å†³ç»ï¼Œå®¡é…å†…å®¹æŸ¥çœ‹ç­‰åŠŸèƒ½ã€‚\n\n![16](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/pendingTask.png)\n\n\n* Processing Task å®¡æ‰¹è¿›åº¦åˆ—è¡¨ï¼Œæä¾›å®¡æ‰¹è¿›åº¦çš„æŸ¥è¯¢ã€‚\n\n![17](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/processingTask.png)\n\n\n* Complete Task å®Œæˆä»»åŠ¡åˆ—è¡¨ï¼Œæä¾›å†å²å®¡æ‰¹é€šè¿‡ã€æ‹’ç»çš„ä»»åŠ¡çš„æŸ¥è¯¢ã€‚\n\n![18](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/completeTask.png)\n\n\n#### 9. æ¶ˆæ¯ä¸­å¿ƒ--æ“ä½œæ—¥å¿—\n###### æä¾›å®¢æˆ·ç«¯ä¸ŠæŠ¥æ—¥å¿—çš„æŸ¥è¯¢ã€‚\n\n![19](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/clientLog.png)\n\n\n#### 10. ç”¨æˆ·ä¸­å¿ƒ--è§’è‰²ç®¡ç†\n###### æä¾›è§’è‰²çš„å¢åˆ æ”¹æŸ¥ï¼Œè§’è‰²çš„èœå•æƒé™ã€æŒ‰é’®æƒé™çš„è®¾ç½®ã€‚\n\n![20](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/role.png)\n\n\n#### 11. ç”¨æˆ·ä¸­å¿ƒ--ç”¨æˆ·ç®¡ç†\n###### æä¾›ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥ï¼Œç”¨æˆ·çš„è§’è‰²åˆ†é…è®¾ç½®ã€‚\n\n![21](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/user.png)\n\n","source":"_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡.md","raw":"---\ntitle: æˆ‘ä¸ºä»€ä¹ˆä¼šæ‰‹æ’¸ä¸€ä¸ªé…ç½®ä¸­å¿ƒ--ä»‹ç»ç¯‡\ndate: 2020-03-20 21:39:15\ntags: \n    - Java\n    - Redis\n    - é…ç½®ä¸­å¿ƒ\ncategories :\n    - Technology\n---\nnadia-configæ˜¯ä¸€æ¬¾åŸºäºspring bootçš„é…ç½®ä¸­å¿ƒï¼Œèƒ½å¤Ÿé›†ä¸­åŒ–ç®¡ç†ä¸åŒç¯å¢ƒã€ä¸åŒç‰ˆæœ¬çš„é›†ç¾¤é…ç½®ï¼Œå¹¶æä¾›é…ç½®çš„å®æ—¶æ›´æ–°ã€å›è°ƒã€å®¡æ‰¹ã€æƒé™ç®¡ç†ç­‰åŠŸèƒ½ã€‚\n>https://github.com/nadia-repository/nadia-config\n\n# Nadia Config Center\n\n## ç»„ä»¶ä»‹ç»\n- [nadia-client](nadia-client/README.md)\n- [nadia-server](nadia-server/README.md)\n\n## Release-Note\n- v1.0\n<!-- more -->\n## ä¸»è¦ç›®æ ‡ï¼š\n\n- å…¼å®¹springbootæ¡†æ¶ï¼Œä¸šåŠ¡ç³»ç»Ÿæ— éœ€ä»£ç å˜æ›´\n- å¿«é€Ÿæ¥å…¥ï¼ŒjaråŒ…å¼•ç”¨\n- é…ç½®åŠ¨æ€æ›´æ–°ï¼Œå®æ—¶ç”Ÿæ•ˆ\n- æ”¯æŒé›†ç¾¤åˆ†ç»„ï¼Œé…ç½®å·®å¼‚åŒ–\n- æä¾›é…ç½®ç»Ÿä¸€å˜æ›´å¹³å°ï¼Œæ”¯æŒå¹³å°ç”¨æˆ·çš„æƒé™ç®¡ç†å’Œé…ç½®å˜æ›´çš„æƒé™ç®¡ç†\n\n#### éƒ¨ç½²å›¾\n\n![01](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/æœåŠ¡éƒ¨ç½²å›¾.png)\n\n#### é¡¹ç›®æ„æˆ\n> nadia-config é¡¹ç›®æ ¹ç›®å½•\n\n>> nadia-client å®¢æˆ·ç«¯\n\n>> nadia-core é€šç”¨ä»£ç \n\n>> nadia-server æœåŠ¡ç«¯\n\n>> nadia-web å‰ç«¯é¡µé¢\n\n>> nadia-demo å®¢æˆ·ç«¯demo\n\n>> docs æ–‡æ¡£\n\n>>> desgin è®¾è®¡æ–‡æ¡£\n\n>>> sql æœåŠ¡ç«¯è„šæœ¬\n\n>>>> DDL.sql å»ºè¡¨\n\n>>>> DML.sql åˆå§‹æ•°æ®\n\n\n#### ç®¡ç†å¹³å°ä»‹ç»\n\n#### 1. ç™»å½•é¡µé¢\n\n![02](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/ç™»å½•.png)\n\n#### 2. æ³¨å†Œé¡µé¢\n\n![03](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/æ³¨å†Œ.png)\n\n\n#### 3. ä¸»ç•Œé¢\n###### æ ¹æ®ç™»å½•ç”¨æˆ·çš„è§’è‰²ä¸åŒï¼Œèœå•æŒ‰é’®ä¼šæœ‰ç›¸åº”å˜åŒ–\n\n![04](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/ä¸»é¡µé¢.png)\n\n\n#### 4. é…ç½®ç®¡ç†--å…ƒæ•°æ®ç®¡ç†\n###### å…ƒæ•°æ®ç®¡ç†æ˜¯æ‰€æœ‰é…ç½®çš„åŸºç¡€ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨é…ç½®é¡¹æ—¶éœ€è¦æŒ‡å®šç›¸å…³çš„å…ƒæ•°æ®\n\n![05](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/metadata.png)\n\n\n###### åè¯è§£é‡Š\n* Application ç³»ç»Ÿåç§°ï¼Œå®¢æˆ·ç«¯å¯ä»¥æŒ‡å®šä½¿ç”¨ä»»æ„ä¸€å¥—ç³»ç»Ÿä¸‹çš„é…ç½®ã€‚\n* Group ç»„åç§°ï¼Œå®¢æˆ·ç«¯æŒ‡å®šç³»ç»Ÿåï¼Œä»éœ€è¦æŒ‡å®šä½¿ç”¨ç³»ç»Ÿä¸‹çš„æŸä¸ªç»„ã€‚è‹¥ä¸å¼ºåˆ¶æŒ‡å®šï¼Œå®¢æˆ·ç«¯å¯åŠ¨åä¼šé»˜è®¤ä½¿ç”¨Defaultç»„ä¸‹çš„é…ç½®ï¼ŒåæœŸå¯ä½¿ç”¨ç»„åˆ‡æ¢åŠŸèƒ½åˆ‡æ¢è‡³ä¸åŒç»„ã€‚\n\n###### åŠŸèƒ½è¯´æ˜\n* Add æ–°å¢Applicationï¼ŒåŒæ—¶æ–°å¢é»˜è®¤Group(Default)ã€‚\n* Delete åˆ é™¤Application\\Groupä¿¡æ¯ã€‚å½“å‰Groupå¦‚æœæ­£åœ¨è¢«ä½¿ç”¨ï¼Œæˆ–å½“å‰ç»„ä¸ºDefaultç»„ä¸”å­˜åœ¨éDefaultç»„æ—¶ï¼Œä¸èƒ½åˆ é™¤ã€‚Defualtç»„åˆ é™¤åå°†åŒæ—¶åˆ é™¤Applicationã€‚\n* Compare æ¯”è¾ƒåŒä¸€Applicationä¸‹ä¸åŒGroupçš„é…ç½®å·®å¼‚ï¼Œå¯å¤šé€‰ï¼Œä½†è‡³å°‘é€‰ä¸¤ä¸ªç»„ã€‚\n\n![06](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/compare.png)\n\n\n* Edit ä¿®æ”¹Applicationä¿¡æ¯\n* Group æ–°å¢ç»„ã€‚å¯é€‰æ‹©ä»æŸä¸ªç»„å¤åˆ¶æ‰€æœ‰å·²å‘å¸ƒé…ç½®é¡¹ï¼Œæˆ–ç”Ÿäº§æ–°çš„ç©ºç»„ã€‚\n\n![07](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/addGroup.png)\n\n\n* Instances å¯å°†æŸå®ä¾‹è°ƒæ•´è‡³å¦ä¸€ç»„ã€‚\n\n![08](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/switch.png)\n\n\n* Inscance æŸ¥çœ‹å¼„å®ä¾‹å½“å‰çš„é…ç½®ä¸æœåŠ¡ç«¯é…ç½®çš„å·®å¼‚ã€‚\n\n![09](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/instance.png)\n\n\n#### 5. é…ç½®ç®¡ç†--é…ç½®é¡¹ç®¡ç†\n###### é…ç½®é¡¹ç®¡ç†æä¾›å…·ä½“é…ç½®çš„å¢åˆ æ”¹æŸ¥ã€å‘å¸ƒç­‰åŠŸèƒ½\n\n![10](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/configs.png)\n\n\n###### åè¯è§£é‡Š\n* Key é…ç½®é¡¹çš„keyï¼Œä¸å®¢æˆ·ç«¯ä¸­@Value({key})ç›¸å¯¹åº”\n* Value å€¼\n* Status \n    * new æ–°å»ºé…ç½®\n    * edited é…ç½®å·²å˜æ›´ï¼Œå¸¦å®¡æ‰¹\n    * approved é…ç½®å®¡æ‰¹é€šè¿‡ï¼Œå¯å‘å¸ƒ\n    * published é…ç½®å·²å‘å¸ƒ\n    * removing é…ç½®åˆ é™¤ï¼Œå¾…å®¡æ‰¹\n    * deleted é…ç½®å·²åˆ é™¤ï¼Œä¸æ˜¾ç¤º\n    * invalid é…ç½®æ— æ•ˆï¼Œä¸æ˜¾ç¤º\n    \n###### åŠŸèƒ½è¯´æ˜\n* Add æ–°å¢é…ç½®ï¼Œå¯é€‰æ‹©é…ç½®çš„å¯è§æƒé™ã€‚è‹¥ä¸é€‰æ‹©ï¼Œåˆ™è¯¥é…ç½®ä¸ºå½“å‰ç™»å½•ç”¨æˆ·çš„è§’è‰²å¯è§ã€‚éœ€è¦å®¡æ‰¹ã€‚\n* Delete åˆ é™¤é…ç½®ï¼Œéœ€è¦å®¡æ‰¹ã€‚\n* Export å¯¼å‡ºé…ç½®ã€‚\n* Import å¯¼å…¥é…ç½®ï¼Œéœ€è¦å®¡æ‰¹ã€‚\n* Edit ç¼–è¾‘é…ç½®ï¼Œéœ€è¦å®¡æ‰¹ã€‚\n* Instance æŸ¥çœ‹å½“å‰é…ç½®çš„ä½¿ç”¨æƒ…å†µã€‚\n\n![11](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/instanceConfig.png)\n\n\n* History é…ç½®ä¿®æ”¹å†å²\n\n![12](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/history.png)\n\n\n#### 6. é…ç½®ç®¡ç†--é…ç½®é¡¹åˆ†é…\n###### é…ç½®é¡¹åˆ†é…æä¾›å…¨å±€çš„è§’è‰²é…ç½®å¯è§æƒé™è®¾ç½®ã€‚\n\n![13](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/allocate.png)\n\n\n###### åŠŸèƒ½è¯´æ˜\n* Allocate åˆ†é…è§’è‰²å¯è§é…ç½®\n\n![14](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/allocateConfigs.png)\n\n\n#### 7. æ¶ˆæ¯ä¸­å¿ƒ--æ“ä½œæ—¥å¿—\n###### æä¾›ç®¡ç†å¹³å°æ‰€æœ‰å¢åˆ æ”¹çš„æ“ä½œæ—¥å¿—æŸ¥è¯¢å’Œå›æº¯ã€‚\n\n![15](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/operationLog.png)\n\n\n#### 8. æ¶ˆæ¯ä¸­å¿ƒ--ä»»åŠ¡ä¸­å¿ƒ\n###### æä¾›å®¡æ‰¹æŸ¥çœ‹ã€å®¡æ‰¹æ“ä½œ(é€šè¿‡ã€æ‹’ç»)ç­‰åŠŸèƒ½ã€‚\n* Pending Task å¾…å®¡æ‰¹åˆ—è¡¨ï¼Œæä¾›å®¡æ‰¹é€šè¿‡ã€å†³ç»ï¼Œå®¡é…å†…å®¹æŸ¥çœ‹ç­‰åŠŸèƒ½ã€‚\n\n![16](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/pendingTask.png)\n\n\n* Processing Task å®¡æ‰¹è¿›åº¦åˆ—è¡¨ï¼Œæä¾›å®¡æ‰¹è¿›åº¦çš„æŸ¥è¯¢ã€‚\n\n![17](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/processingTask.png)\n\n\n* Complete Task å®Œæˆä»»åŠ¡åˆ—è¡¨ï¼Œæä¾›å†å²å®¡æ‰¹é€šè¿‡ã€æ‹’ç»çš„ä»»åŠ¡çš„æŸ¥è¯¢ã€‚\n\n![18](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/completeTask.png)\n\n\n#### 9. æ¶ˆæ¯ä¸­å¿ƒ--æ“ä½œæ—¥å¿—\n###### æä¾›å®¢æˆ·ç«¯ä¸ŠæŠ¥æ—¥å¿—çš„æŸ¥è¯¢ã€‚\n\n![19](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/clientLog.png)\n\n\n#### 10. ç”¨æˆ·ä¸­å¿ƒ--è§’è‰²ç®¡ç†\n###### æä¾›è§’è‰²çš„å¢åˆ æ”¹æŸ¥ï¼Œè§’è‰²çš„èœå•æƒé™ã€æŒ‰é’®æƒé™çš„è®¾ç½®ã€‚\n\n![20](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/role.png)\n\n\n#### 11. ç”¨æˆ·ä¸­å¿ƒ--ç”¨æˆ·ç®¡ç†\n###### æä¾›ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥ï¼Œç”¨æˆ·çš„è§’è‰²åˆ†é…è®¾ç½®ã€‚\n\n![21](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/user.png)\n\n","slug":"æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡","published":1,"updated":"2020-12-14T10:33:44.564Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htk0012v252dysvfnfm","content":"<html><head></head><body><p>nadia-config&#x662F;&#x4E00;&#x6B3E;&#x57FA;&#x4E8E;spring boot&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#xFF0C;&#x80FD;&#x591F;&#x96C6;&#x4E2D;&#x5316;&#x7BA1;&#x7406;&#x4E0D;&#x540C;&#x73AF;&#x5883;&#x3001;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;&#x96C6;&#x7FA4;&#x914D;&#x7F6E;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x914D;&#x7F6E;&#x7684;&#x5B9E;&#x65F6;&#x66F4;&#x65B0;&#x3001;&#x56DE;&#x8C03;&#x3001;&#x5BA1;&#x6279;&#x3001;&#x6743;&#x9650;&#x7BA1;&#x7406;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<blockquote>\n<p><a href=\"https://github.com/nadia-repository/nadia-config\">https://github.com/nadia-repository/nadia-config</a></p>\n</blockquote>\n<h1 id=\"Nadia-Config-Center\"><a href=\"#Nadia-Config-Center\" class=\"headerlink\" title=\"Nadia Config Center\"></a>Nadia Config Center</h1><h2 id=\"&#x7EC4;&#x4EF6;&#x4ECB;&#x7ECD;\"><a href=\"#&#x7EC4;&#x4EF6;&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"&#x7EC4;&#x4EF6;&#x4ECB;&#x7ECD;\"></a>&#x7EC4;&#x4EF6;&#x4ECB;&#x7ECD;</h2><ul>\n<li><a href=\"nadia-client/README.md\">nadia-client</a></li>\n<li><a href=\"nadia-server/README.md\">nadia-server</a></li>\n</ul>\n<h2 id=\"Release-Note\"><a href=\"#Release-Note\" class=\"headerlink\" title=\"Release-Note\"></a>Release-Note</h2><ul>\n<li><p>v1.0</p>\n<a id=\"more\"></a>\n<h2 id=\"&#x4E3B;&#x8981;&#x76EE;&#x6807;&#xFF1A;\"><a href=\"#&#x4E3B;&#x8981;&#x76EE;&#x6807;&#xFF1A;\" class=\"headerlink\" title=\"&#x4E3B;&#x8981;&#x76EE;&#x6807;&#xFF1A;\"></a>&#x4E3B;&#x8981;&#x76EE;&#x6807;&#xFF1A;</h2></li>\n<li><p>&#x517C;&#x5BB9;springboot&#x6846;&#x67B6;&#xFF0C;&#x4E1A;&#x52A1;&#x7CFB;&#x7EDF;&#x65E0;&#x9700;&#x4EE3;&#x7801;&#x53D8;&#x66F4;</p>\n</li>\n<li><p>&#x5FEB;&#x901F;&#x63A5;&#x5165;&#xFF0C;jar&#x5305;&#x5F15;&#x7528;</p>\n</li>\n<li><p>&#x914D;&#x7F6E;&#x52A8;&#x6001;&#x66F4;&#x65B0;&#xFF0C;&#x5B9E;&#x65F6;&#x751F;&#x6548;</p>\n</li>\n<li><p>&#x652F;&#x6301;&#x96C6;&#x7FA4;&#x5206;&#x7EC4;&#xFF0C;&#x914D;&#x7F6E;&#x5DEE;&#x5F02;&#x5316;</p>\n</li>\n<li><p>&#x63D0;&#x4F9B;&#x914D;&#x7F6E;&#x7EDF;&#x4E00;&#x53D8;&#x66F4;&#x5E73;&#x53F0;&#xFF0C;&#x652F;&#x6301;&#x5E73;&#x53F0;&#x7528;&#x6237;&#x7684;&#x6743;&#x9650;&#x7BA1;&#x7406;&#x548C;&#x914D;&#x7F6E;&#x53D8;&#x66F4;&#x7684;&#x6743;&#x9650;&#x7BA1;&#x7406;</p>\n</li>\n</ul>\n<h4 id=\"&#x90E8;&#x7F72;&#x56FE;\"><a href=\"#&#x90E8;&#x7F72;&#x56FE;\" class=\"headerlink\" title=\"&#x90E8;&#x7F72;&#x56FE;\"></a>&#x90E8;&#x7F72;&#x56FE;</h4><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%9B%BE.png\" alt=\"01\"></p>\n<h4 id=\"&#x9879;&#x76EE;&#x6784;&#x6210;\"><a href=\"#&#x9879;&#x76EE;&#x6784;&#x6210;\" class=\"headerlink\" title=\"&#x9879;&#x76EE;&#x6784;&#x6210;\"></a>&#x9879;&#x76EE;&#x6784;&#x6210;</h4><blockquote>\n<p>nadia-config &#x9879;&#x76EE;&#x6839;&#x76EE;&#x5F55;</p>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>nadia-client &#x5BA2;&#x6237;&#x7AEF;</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>nadia-core &#x901A;&#x7528;&#x4EE3;&#x7801;</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>nadia-server &#x670D;&#x52A1;&#x7AEF;</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>nadia-web &#x524D;&#x7AEF;&#x9875;&#x9762;</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>nadia-demo &#x5BA2;&#x6237;&#x7AEF;demo</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>docs &#x6587;&#x6863;</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>desgin &#x8BBE;&#x8BA1;&#x6587;&#x6863;</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>sql &#x670D;&#x52A1;&#x7AEF;&#x811A;&#x672C;</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>DDL.sql &#x5EFA;&#x8868;</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>DML.sql &#x521D;&#x59CB;&#x6570;&#x636E;</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<h4 id=\"&#x7BA1;&#x7406;&#x5E73;&#x53F0;&#x4ECB;&#x7ECD;\"><a href=\"#&#x7BA1;&#x7406;&#x5E73;&#x53F0;&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"&#x7BA1;&#x7406;&#x5E73;&#x53F0;&#x4ECB;&#x7ECD;\"></a>&#x7BA1;&#x7406;&#x5E73;&#x53F0;&#x4ECB;&#x7ECD;</h4><h4 id=\"1-&#x767B;&#x5F55;&#x9875;&#x9762;\"><a href=\"#1-&#x767B;&#x5F55;&#x9875;&#x9762;\" class=\"headerlink\" title=\"1. &#x767B;&#x5F55;&#x9875;&#x9762;\"></a>1. &#x767B;&#x5F55;&#x9875;&#x9762;</h4><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/%E7%99%BB%E5%BD%95.png\" alt=\"02\"></p>\n<h4 id=\"2-&#x6CE8;&#x518C;&#x9875;&#x9762;\"><a href=\"#2-&#x6CE8;&#x518C;&#x9875;&#x9762;\" class=\"headerlink\" title=\"2. &#x6CE8;&#x518C;&#x9875;&#x9762;\"></a>2. &#x6CE8;&#x518C;&#x9875;&#x9762;</h4><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/%E6%B3%A8%E5%86%8C.png\" alt=\"03\"></p>\n<h4 id=\"3-&#x4E3B;&#x754C;&#x9762;\"><a href=\"#3-&#x4E3B;&#x754C;&#x9762;\" class=\"headerlink\" title=\"3. &#x4E3B;&#x754C;&#x9762;\"></a>3. &#x4E3B;&#x754C;&#x9762;</h4><h6 id=\"&#x6839;&#x636E;&#x767B;&#x5F55;&#x7528;&#x6237;&#x7684;&#x89D2;&#x8272;&#x4E0D;&#x540C;&#xFF0C;&#x83DC;&#x5355;&#x6309;&#x94AE;&#x4F1A;&#x6709;&#x76F8;&#x5E94;&#x53D8;&#x5316;\"><a href=\"#&#x6839;&#x636E;&#x767B;&#x5F55;&#x7528;&#x6237;&#x7684;&#x89D2;&#x8272;&#x4E0D;&#x540C;&#xFF0C;&#x83DC;&#x5355;&#x6309;&#x94AE;&#x4F1A;&#x6709;&#x76F8;&#x5E94;&#x53D8;&#x5316;\" class=\"headerlink\" title=\"&#x6839;&#x636E;&#x767B;&#x5F55;&#x7528;&#x6237;&#x7684;&#x89D2;&#x8272;&#x4E0D;&#x540C;&#xFF0C;&#x83DC;&#x5355;&#x6309;&#x94AE;&#x4F1A;&#x6709;&#x76F8;&#x5E94;&#x53D8;&#x5316;\"></a>&#x6839;&#x636E;&#x767B;&#x5F55;&#x7528;&#x6237;&#x7684;&#x89D2;&#x8272;&#x4E0D;&#x540C;&#xFF0C;&#x83DC;&#x5355;&#x6309;&#x94AE;&#x4F1A;&#x6709;&#x76F8;&#x5E94;&#x53D8;&#x5316;</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/%E4%B8%BB%E9%A1%B5%E9%9D%A2.png\" alt=\"04\"></p>\n<h4 id=\"4-&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x2013;&#x5143;&#x6570;&#x636E;&#x7BA1;&#x7406;\"><a href=\"#4-&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x2013;&#x5143;&#x6570;&#x636E;&#x7BA1;&#x7406;\" class=\"headerlink\" title=\"4. &#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x2013;&#x5143;&#x6570;&#x636E;&#x7BA1;&#x7406;\"></a>4. &#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x2013;&#x5143;&#x6570;&#x636E;&#x7BA1;&#x7406;</h4><h6 id=\"&#x5143;&#x6570;&#x636E;&#x7BA1;&#x7406;&#x662F;&#x6240;&#x6709;&#x914D;&#x7F6E;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x9879;&#x65F6;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x76F8;&#x5173;&#x7684;&#x5143;&#x6570;&#x636E;\"><a href=\"#&#x5143;&#x6570;&#x636E;&#x7BA1;&#x7406;&#x662F;&#x6240;&#x6709;&#x914D;&#x7F6E;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x9879;&#x65F6;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x76F8;&#x5173;&#x7684;&#x5143;&#x6570;&#x636E;\" class=\"headerlink\" title=\"&#x5143;&#x6570;&#x636E;&#x7BA1;&#x7406;&#x662F;&#x6240;&#x6709;&#x914D;&#x7F6E;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x9879;&#x65F6;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x76F8;&#x5173;&#x7684;&#x5143;&#x6570;&#x636E;\"></a>&#x5143;&#x6570;&#x636E;&#x7BA1;&#x7406;&#x662F;&#x6240;&#x6709;&#x914D;&#x7F6E;&#x7684;&#x57FA;&#x7840;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x9879;&#x65F6;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x76F8;&#x5173;&#x7684;&#x5143;&#x6570;&#x636E;</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/metadata.png\" alt=\"05\"></p>\n<h6 id=\"&#x540D;&#x8BCD;&#x89E3;&#x91CA;\"><a href=\"#&#x540D;&#x8BCD;&#x89E3;&#x91CA;\" class=\"headerlink\" title=\"&#x540D;&#x8BCD;&#x89E3;&#x91CA;\"></a>&#x540D;&#x8BCD;&#x89E3;&#x91CA;</h6><ul>\n<li>Application &#x7CFB;&#x7EDF;&#x540D;&#x79F0;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4F7F;&#x7528;&#x4EFB;&#x610F;&#x4E00;&#x5957;&#x7CFB;&#x7EDF;&#x4E0B;&#x7684;&#x914D;&#x7F6E;&#x3002;</li>\n<li>Group &#x7EC4;&#x540D;&#x79F0;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x6307;&#x5B9A;&#x7CFB;&#x7EDF;&#x540E;&#xFF0C;&#x4ECD;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x4E0B;&#x7684;&#x67D0;&#x4E2A;&#x7EC4;&#x3002;&#x82E5;&#x4E0D;&#x5F3A;&#x5236;&#x6307;&#x5B9A;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x542F;&#x52A8;&#x540E;&#x4F1A;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;Default&#x7EC4;&#x4E0B;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x540E;&#x671F;&#x53EF;&#x4F7F;&#x7528;&#x7EC4;&#x5207;&#x6362;&#x529F;&#x80FD;&#x5207;&#x6362;&#x81F3;&#x4E0D;&#x540C;&#x7EC4;&#x3002;</li>\n</ul>\n<h6 id=\"&#x529F;&#x80FD;&#x8BF4;&#x660E;\"><a href=\"#&#x529F;&#x80FD;&#x8BF4;&#x660E;\" class=\"headerlink\" title=\"&#x529F;&#x80FD;&#x8BF4;&#x660E;\"></a>&#x529F;&#x80FD;&#x8BF4;&#x660E;</h6><ul>\n<li>Add &#x65B0;&#x589E;Application&#xFF0C;&#x540C;&#x65F6;&#x65B0;&#x589E;&#x9ED8;&#x8BA4;Group(Default)&#x3002;</li>\n<li>Delete &#x5220;&#x9664;Application\\Group&#x4FE1;&#x606F;&#x3002;&#x5F53;&#x524D;Group&#x5982;&#x679C;&#x6B63;&#x5728;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;&#x6216;&#x5F53;&#x524D;&#x7EC4;&#x4E3A;Default&#x7EC4;&#x4E14;&#x5B58;&#x5728;&#x975E;Default&#x7EC4;&#x65F6;&#xFF0C;&#x4E0D;&#x80FD;&#x5220;&#x9664;&#x3002;Defualt&#x7EC4;&#x5220;&#x9664;&#x540E;&#x5C06;&#x540C;&#x65F6;&#x5220;&#x9664;Application&#x3002;</li>\n<li>Compare &#x6BD4;&#x8F83;&#x540C;&#x4E00;Application&#x4E0B;&#x4E0D;&#x540C;Group&#x7684;&#x914D;&#x7F6E;&#x5DEE;&#x5F02;&#xFF0C;&#x53EF;&#x591A;&#x9009;&#xFF0C;&#x4F46;&#x81F3;&#x5C11;&#x9009;&#x4E24;&#x4E2A;&#x7EC4;&#x3002;</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/compare.png\" alt=\"06\"></p>\n<ul>\n<li>Edit &#x4FEE;&#x6539;Application&#x4FE1;&#x606F;</li>\n<li>Group &#x65B0;&#x589E;&#x7EC4;&#x3002;&#x53EF;&#x9009;&#x62E9;&#x4ECE;&#x67D0;&#x4E2A;&#x7EC4;&#x590D;&#x5236;&#x6240;&#x6709;&#x5DF2;&#x53D1;&#x5E03;&#x914D;&#x7F6E;&#x9879;&#xFF0C;&#x6216;&#x751F;&#x4EA7;&#x65B0;&#x7684;&#x7A7A;&#x7EC4;&#x3002;</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/addGroup.png\" alt=\"07\"></p>\n<ul>\n<li>Instances &#x53EF;&#x5C06;&#x67D0;&#x5B9E;&#x4F8B;&#x8C03;&#x6574;&#x81F3;&#x53E6;&#x4E00;&#x7EC4;&#x3002;</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/switch.png\" alt=\"08\"></p>\n<ul>\n<li>Inscance &#x67E5;&#x770B;&#x5F04;&#x5B9E;&#x4F8B;&#x5F53;&#x524D;&#x7684;&#x914D;&#x7F6E;&#x4E0E;&#x670D;&#x52A1;&#x7AEF;&#x914D;&#x7F6E;&#x7684;&#x5DEE;&#x5F02;&#x3002;</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/instance.png\" alt=\"09\"></p>\n<h4 id=\"5-&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x2013;&#x914D;&#x7F6E;&#x9879;&#x7BA1;&#x7406;\"><a href=\"#5-&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x2013;&#x914D;&#x7F6E;&#x9879;&#x7BA1;&#x7406;\" class=\"headerlink\" title=\"5. &#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x2013;&#x914D;&#x7F6E;&#x9879;&#x7BA1;&#x7406;\"></a>5. &#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x2013;&#x914D;&#x7F6E;&#x9879;&#x7BA1;&#x7406;</h4><h6 id=\"&#x914D;&#x7F6E;&#x9879;&#x7BA1;&#x7406;&#x63D0;&#x4F9B;&#x5177;&#x4F53;&#x914D;&#x7F6E;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#x3001;&#x53D1;&#x5E03;&#x7B49;&#x529F;&#x80FD;\"><a href=\"#&#x914D;&#x7F6E;&#x9879;&#x7BA1;&#x7406;&#x63D0;&#x4F9B;&#x5177;&#x4F53;&#x914D;&#x7F6E;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#x3001;&#x53D1;&#x5E03;&#x7B49;&#x529F;&#x80FD;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;&#x9879;&#x7BA1;&#x7406;&#x63D0;&#x4F9B;&#x5177;&#x4F53;&#x914D;&#x7F6E;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#x3001;&#x53D1;&#x5E03;&#x7B49;&#x529F;&#x80FD;\"></a>&#x914D;&#x7F6E;&#x9879;&#x7BA1;&#x7406;&#x63D0;&#x4F9B;&#x5177;&#x4F53;&#x914D;&#x7F6E;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#x3001;&#x53D1;&#x5E03;&#x7B49;&#x529F;&#x80FD;</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/configs.png\" alt=\"10\"></p>\n<h6 id=\"&#x540D;&#x8BCD;&#x89E3;&#x91CA;-1\"><a href=\"#&#x540D;&#x8BCD;&#x89E3;&#x91CA;-1\" class=\"headerlink\" title=\"&#x540D;&#x8BCD;&#x89E3;&#x91CA;\"></a>&#x540D;&#x8BCD;&#x89E3;&#x91CA;</h6><ul>\n<li>Key &#x914D;&#x7F6E;&#x9879;&#x7684;key&#xFF0C;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x4E2D;@Value({key})&#x76F8;&#x5BF9;&#x5E94;</li>\n<li>Value &#x503C;</li>\n<li>Status <ul>\n<li>new &#x65B0;&#x5EFA;&#x914D;&#x7F6E;</li>\n<li>edited &#x914D;&#x7F6E;&#x5DF2;&#x53D8;&#x66F4;&#xFF0C;&#x5E26;&#x5BA1;&#x6279;</li>\n<li>approved &#x914D;&#x7F6E;&#x5BA1;&#x6279;&#x901A;&#x8FC7;&#xFF0C;&#x53EF;&#x53D1;&#x5E03;</li>\n<li>published &#x914D;&#x7F6E;&#x5DF2;&#x53D1;&#x5E03;</li>\n<li>removing &#x914D;&#x7F6E;&#x5220;&#x9664;&#xFF0C;&#x5F85;&#x5BA1;&#x6279;</li>\n<li>deleted &#x914D;&#x7F6E;&#x5DF2;&#x5220;&#x9664;&#xFF0C;&#x4E0D;&#x663E;&#x793A;</li>\n<li>invalid &#x914D;&#x7F6E;&#x65E0;&#x6548;&#xFF0C;&#x4E0D;&#x663E;&#x793A;</li>\n</ul>\n</li>\n</ul>\n<h6 id=\"&#x529F;&#x80FD;&#x8BF4;&#x660E;-1\"><a href=\"#&#x529F;&#x80FD;&#x8BF4;&#x660E;-1\" class=\"headerlink\" title=\"&#x529F;&#x80FD;&#x8BF4;&#x660E;\"></a>&#x529F;&#x80FD;&#x8BF4;&#x660E;</h6><ul>\n<li>Add &#x65B0;&#x589E;&#x914D;&#x7F6E;&#xFF0C;&#x53EF;&#x9009;&#x62E9;&#x914D;&#x7F6E;&#x7684;&#x53EF;&#x89C1;&#x6743;&#x9650;&#x3002;&#x82E5;&#x4E0D;&#x9009;&#x62E9;&#xFF0C;&#x5219;&#x8BE5;&#x914D;&#x7F6E;&#x4E3A;&#x5F53;&#x524D;&#x767B;&#x5F55;&#x7528;&#x6237;&#x7684;&#x89D2;&#x8272;&#x53EF;&#x89C1;&#x3002;&#x9700;&#x8981;&#x5BA1;&#x6279;&#x3002;</li>\n<li>Delete &#x5220;&#x9664;&#x914D;&#x7F6E;&#xFF0C;&#x9700;&#x8981;&#x5BA1;&#x6279;&#x3002;</li>\n<li>Export &#x5BFC;&#x51FA;&#x914D;&#x7F6E;&#x3002;</li>\n<li>Import &#x5BFC;&#x5165;&#x914D;&#x7F6E;&#xFF0C;&#x9700;&#x8981;&#x5BA1;&#x6279;&#x3002;</li>\n<li>Edit &#x7F16;&#x8F91;&#x914D;&#x7F6E;&#xFF0C;&#x9700;&#x8981;&#x5BA1;&#x6279;&#x3002;</li>\n<li>Instance &#x67E5;&#x770B;&#x5F53;&#x524D;&#x914D;&#x7F6E;&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x3002;</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/instanceConfig.png\" alt=\"11\"></p>\n<ul>\n<li>History &#x914D;&#x7F6E;&#x4FEE;&#x6539;&#x5386;&#x53F2;</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/history.png\" alt=\"12\"></p>\n<h4 id=\"6-&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x2013;&#x914D;&#x7F6E;&#x9879;&#x5206;&#x914D;\"><a href=\"#6-&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x2013;&#x914D;&#x7F6E;&#x9879;&#x5206;&#x914D;\" class=\"headerlink\" title=\"6. &#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x2013;&#x914D;&#x7F6E;&#x9879;&#x5206;&#x914D;\"></a>6. &#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x2013;&#x914D;&#x7F6E;&#x9879;&#x5206;&#x914D;</h4><h6 id=\"&#x914D;&#x7F6E;&#x9879;&#x5206;&#x914D;&#x63D0;&#x4F9B;&#x5168;&#x5C40;&#x7684;&#x89D2;&#x8272;&#x914D;&#x7F6E;&#x53EF;&#x89C1;&#x6743;&#x9650;&#x8BBE;&#x7F6E;&#x3002;\"><a href=\"#&#x914D;&#x7F6E;&#x9879;&#x5206;&#x914D;&#x63D0;&#x4F9B;&#x5168;&#x5C40;&#x7684;&#x89D2;&#x8272;&#x914D;&#x7F6E;&#x53EF;&#x89C1;&#x6743;&#x9650;&#x8BBE;&#x7F6E;&#x3002;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;&#x9879;&#x5206;&#x914D;&#x63D0;&#x4F9B;&#x5168;&#x5C40;&#x7684;&#x89D2;&#x8272;&#x914D;&#x7F6E;&#x53EF;&#x89C1;&#x6743;&#x9650;&#x8BBE;&#x7F6E;&#x3002;\"></a>&#x914D;&#x7F6E;&#x9879;&#x5206;&#x914D;&#x63D0;&#x4F9B;&#x5168;&#x5C40;&#x7684;&#x89D2;&#x8272;&#x914D;&#x7F6E;&#x53EF;&#x89C1;&#x6743;&#x9650;&#x8BBE;&#x7F6E;&#x3002;</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/allocate.png\" alt=\"13\"></p>\n<h6 id=\"&#x529F;&#x80FD;&#x8BF4;&#x660E;-2\"><a href=\"#&#x529F;&#x80FD;&#x8BF4;&#x660E;-2\" class=\"headerlink\" title=\"&#x529F;&#x80FD;&#x8BF4;&#x660E;\"></a>&#x529F;&#x80FD;&#x8BF4;&#x660E;</h6><ul>\n<li>Allocate &#x5206;&#x914D;&#x89D2;&#x8272;&#x53EF;&#x89C1;&#x914D;&#x7F6E;</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/allocateConfigs.png\" alt=\"14\"></p>\n<h4 id=\"7-&#x6D88;&#x606F;&#x4E2D;&#x5FC3;&#x2013;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;\"><a href=\"#7-&#x6D88;&#x606F;&#x4E2D;&#x5FC3;&#x2013;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;\" class=\"headerlink\" title=\"7. &#x6D88;&#x606F;&#x4E2D;&#x5FC3;&#x2013;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;\"></a>7. &#x6D88;&#x606F;&#x4E2D;&#x5FC3;&#x2013;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;</h4><h6 id=\"&#x63D0;&#x4F9B;&#x7BA1;&#x7406;&#x5E73;&#x53F0;&#x6240;&#x6709;&#x589E;&#x5220;&#x6539;&#x7684;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;&#x67E5;&#x8BE2;&#x548C;&#x56DE;&#x6EAF;&#x3002;\"><a href=\"#&#x63D0;&#x4F9B;&#x7BA1;&#x7406;&#x5E73;&#x53F0;&#x6240;&#x6709;&#x589E;&#x5220;&#x6539;&#x7684;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;&#x67E5;&#x8BE2;&#x548C;&#x56DE;&#x6EAF;&#x3002;\" class=\"headerlink\" title=\"&#x63D0;&#x4F9B;&#x7BA1;&#x7406;&#x5E73;&#x53F0;&#x6240;&#x6709;&#x589E;&#x5220;&#x6539;&#x7684;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;&#x67E5;&#x8BE2;&#x548C;&#x56DE;&#x6EAF;&#x3002;\"></a>&#x63D0;&#x4F9B;&#x7BA1;&#x7406;&#x5E73;&#x53F0;&#x6240;&#x6709;&#x589E;&#x5220;&#x6539;&#x7684;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;&#x67E5;&#x8BE2;&#x548C;&#x56DE;&#x6EAF;&#x3002;</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/operationLog.png\" alt=\"15\"></p>\n<h4 id=\"8-&#x6D88;&#x606F;&#x4E2D;&#x5FC3;&#x2013;&#x4EFB;&#x52A1;&#x4E2D;&#x5FC3;\"><a href=\"#8-&#x6D88;&#x606F;&#x4E2D;&#x5FC3;&#x2013;&#x4EFB;&#x52A1;&#x4E2D;&#x5FC3;\" class=\"headerlink\" title=\"8. &#x6D88;&#x606F;&#x4E2D;&#x5FC3;&#x2013;&#x4EFB;&#x52A1;&#x4E2D;&#x5FC3;\"></a>8. &#x6D88;&#x606F;&#x4E2D;&#x5FC3;&#x2013;&#x4EFB;&#x52A1;&#x4E2D;&#x5FC3;</h4><h6 id=\"&#x63D0;&#x4F9B;&#x5BA1;&#x6279;&#x67E5;&#x770B;&#x3001;&#x5BA1;&#x6279;&#x64CD;&#x4F5C;-&#x901A;&#x8FC7;&#x3001;&#x62D2;&#x7EDD;-&#x7B49;&#x529F;&#x80FD;&#x3002;\"><a href=\"#&#x63D0;&#x4F9B;&#x5BA1;&#x6279;&#x67E5;&#x770B;&#x3001;&#x5BA1;&#x6279;&#x64CD;&#x4F5C;-&#x901A;&#x8FC7;&#x3001;&#x62D2;&#x7EDD;-&#x7B49;&#x529F;&#x80FD;&#x3002;\" class=\"headerlink\" title=\"&#x63D0;&#x4F9B;&#x5BA1;&#x6279;&#x67E5;&#x770B;&#x3001;&#x5BA1;&#x6279;&#x64CD;&#x4F5C;(&#x901A;&#x8FC7;&#x3001;&#x62D2;&#x7EDD;)&#x7B49;&#x529F;&#x80FD;&#x3002;\"></a>&#x63D0;&#x4F9B;&#x5BA1;&#x6279;&#x67E5;&#x770B;&#x3001;&#x5BA1;&#x6279;&#x64CD;&#x4F5C;(&#x901A;&#x8FC7;&#x3001;&#x62D2;&#x7EDD;)&#x7B49;&#x529F;&#x80FD;&#x3002;</h6><ul>\n<li>Pending Task &#x5F85;&#x5BA1;&#x6279;&#x5217;&#x8868;&#xFF0C;&#x63D0;&#x4F9B;&#x5BA1;&#x6279;&#x901A;&#x8FC7;&#x3001;&#x51B3;&#x7EDD;&#xFF0C;&#x5BA1;&#x914D;&#x5185;&#x5BB9;&#x67E5;&#x770B;&#x7B49;&#x529F;&#x80FD;&#x3002;</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/pendingTask.png\" alt=\"16\"></p>\n<ul>\n<li>Processing Task &#x5BA1;&#x6279;&#x8FDB;&#x5EA6;&#x5217;&#x8868;&#xFF0C;&#x63D0;&#x4F9B;&#x5BA1;&#x6279;&#x8FDB;&#x5EA6;&#x7684;&#x67E5;&#x8BE2;&#x3002;</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/processingTask.png\" alt=\"17\"></p>\n<ul>\n<li>Complete Task &#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#x5217;&#x8868;&#xFF0C;&#x63D0;&#x4F9B;&#x5386;&#x53F2;&#x5BA1;&#x6279;&#x901A;&#x8FC7;&#x3001;&#x62D2;&#x7EDD;&#x7684;&#x4EFB;&#x52A1;&#x7684;&#x67E5;&#x8BE2;&#x3002;</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/completeTask.png\" alt=\"18\"></p>\n<h4 id=\"9-&#x6D88;&#x606F;&#x4E2D;&#x5FC3;&#x2013;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;\"><a href=\"#9-&#x6D88;&#x606F;&#x4E2D;&#x5FC3;&#x2013;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;\" class=\"headerlink\" title=\"9. &#x6D88;&#x606F;&#x4E2D;&#x5FC3;&#x2013;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;\"></a>9. &#x6D88;&#x606F;&#x4E2D;&#x5FC3;&#x2013;&#x64CD;&#x4F5C;&#x65E5;&#x5FD7;</h4><h6 id=\"&#x63D0;&#x4F9B;&#x5BA2;&#x6237;&#x7AEF;&#x4E0A;&#x62A5;&#x65E5;&#x5FD7;&#x7684;&#x67E5;&#x8BE2;&#x3002;\"><a href=\"#&#x63D0;&#x4F9B;&#x5BA2;&#x6237;&#x7AEF;&#x4E0A;&#x62A5;&#x65E5;&#x5FD7;&#x7684;&#x67E5;&#x8BE2;&#x3002;\" class=\"headerlink\" title=\"&#x63D0;&#x4F9B;&#x5BA2;&#x6237;&#x7AEF;&#x4E0A;&#x62A5;&#x65E5;&#x5FD7;&#x7684;&#x67E5;&#x8BE2;&#x3002;\"></a>&#x63D0;&#x4F9B;&#x5BA2;&#x6237;&#x7AEF;&#x4E0A;&#x62A5;&#x65E5;&#x5FD7;&#x7684;&#x67E5;&#x8BE2;&#x3002;</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/clientLog.png\" alt=\"19\"></p>\n<h4 id=\"10-&#x7528;&#x6237;&#x4E2D;&#x5FC3;&#x2013;&#x89D2;&#x8272;&#x7BA1;&#x7406;\"><a href=\"#10-&#x7528;&#x6237;&#x4E2D;&#x5FC3;&#x2013;&#x89D2;&#x8272;&#x7BA1;&#x7406;\" class=\"headerlink\" title=\"10. &#x7528;&#x6237;&#x4E2D;&#x5FC3;&#x2013;&#x89D2;&#x8272;&#x7BA1;&#x7406;\"></a>10. &#x7528;&#x6237;&#x4E2D;&#x5FC3;&#x2013;&#x89D2;&#x8272;&#x7BA1;&#x7406;</h4><h6 id=\"&#x63D0;&#x4F9B;&#x89D2;&#x8272;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#xFF0C;&#x89D2;&#x8272;&#x7684;&#x83DC;&#x5355;&#x6743;&#x9650;&#x3001;&#x6309;&#x94AE;&#x6743;&#x9650;&#x7684;&#x8BBE;&#x7F6E;&#x3002;\"><a href=\"#&#x63D0;&#x4F9B;&#x89D2;&#x8272;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#xFF0C;&#x89D2;&#x8272;&#x7684;&#x83DC;&#x5355;&#x6743;&#x9650;&#x3001;&#x6309;&#x94AE;&#x6743;&#x9650;&#x7684;&#x8BBE;&#x7F6E;&#x3002;\" class=\"headerlink\" title=\"&#x63D0;&#x4F9B;&#x89D2;&#x8272;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#xFF0C;&#x89D2;&#x8272;&#x7684;&#x83DC;&#x5355;&#x6743;&#x9650;&#x3001;&#x6309;&#x94AE;&#x6743;&#x9650;&#x7684;&#x8BBE;&#x7F6E;&#x3002;\"></a>&#x63D0;&#x4F9B;&#x89D2;&#x8272;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#xFF0C;&#x89D2;&#x8272;&#x7684;&#x83DC;&#x5355;&#x6743;&#x9650;&#x3001;&#x6309;&#x94AE;&#x6743;&#x9650;&#x7684;&#x8BBE;&#x7F6E;&#x3002;</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/role.png\" alt=\"20\"></p>\n<h4 id=\"11-&#x7528;&#x6237;&#x4E2D;&#x5FC3;&#x2013;&#x7528;&#x6237;&#x7BA1;&#x7406;\"><a href=\"#11-&#x7528;&#x6237;&#x4E2D;&#x5FC3;&#x2013;&#x7528;&#x6237;&#x7BA1;&#x7406;\" class=\"headerlink\" title=\"11. &#x7528;&#x6237;&#x4E2D;&#x5FC3;&#x2013;&#x7528;&#x6237;&#x7BA1;&#x7406;\"></a>11. &#x7528;&#x6237;&#x4E2D;&#x5FC3;&#x2013;&#x7528;&#x6237;&#x7BA1;&#x7406;</h4><h6 id=\"&#x63D0;&#x4F9B;&#x7528;&#x6237;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#xFF0C;&#x7528;&#x6237;&#x7684;&#x89D2;&#x8272;&#x5206;&#x914D;&#x8BBE;&#x7F6E;&#x3002;\"><a href=\"#&#x63D0;&#x4F9B;&#x7528;&#x6237;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#xFF0C;&#x7528;&#x6237;&#x7684;&#x89D2;&#x8272;&#x5206;&#x914D;&#x8BBE;&#x7F6E;&#x3002;\" class=\"headerlink\" title=\"&#x63D0;&#x4F9B;&#x7528;&#x6237;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#xFF0C;&#x7528;&#x6237;&#x7684;&#x89D2;&#x8272;&#x5206;&#x914D;&#x8BBE;&#x7F6E;&#x3002;\"></a>&#x63D0;&#x4F9B;&#x7528;&#x6237;&#x7684;&#x589E;&#x5220;&#x6539;&#x67E5;&#xFF0C;&#x7528;&#x6237;&#x7684;&#x89D2;&#x8272;&#x5206;&#x914D;&#x8BBE;&#x7F6E;&#x3002;</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/user.png\" alt=\"21\"></p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Redis","path":"tags/Redis/"},{"name":"é…ç½®ä¸­å¿ƒ","path":"tags/é…ç½®ä¸­å¿ƒ/"}],"excerpt":"<html><head></head><body><p>nadia-config&#x662F;&#x4E00;&#x6B3E;&#x57FA;&#x4E8E;spring boot&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#xFF0C;&#x80FD;&#x591F;&#x96C6;&#x4E2D;&#x5316;&#x7BA1;&#x7406;&#x4E0D;&#x540C;&#x73AF;&#x5883;&#x3001;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x7684;&#x96C6;&#x7FA4;&#x914D;&#x7F6E;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x914D;&#x7F6E;&#x7684;&#x5B9E;&#x65F6;&#x66F4;&#x65B0;&#x3001;&#x56DE;&#x8C03;&#x3001;&#x5BA1;&#x6279;&#x3001;&#x6743;&#x9650;&#x7BA1;&#x7406;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>\n<blockquote>\n<p><a href=\"https://github.com/nadia-repository/nadia-config\">https://github.com/nadia-repository/nadia-config</a></p>\n</blockquote>\n<h1 id=\"Nadia-Config-Center\"><a href=\"#Nadia-Config-Center\" class=\"headerlink\" title=\"Nadia Config Center\"></a>Nadia Config Center</h1><h2 id=\"&#x7EC4;&#x4EF6;&#x4ECB;&#x7ECD;\"><a href=\"#&#x7EC4;&#x4EF6;&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"&#x7EC4;&#x4EF6;&#x4ECB;&#x7ECD;\"></a>&#x7EC4;&#x4EF6;&#x4ECB;&#x7ECD;</h2><ul>\n<li><a href=\"nadia-client/README.md\">nadia-client</a></li>\n<li><a href=\"nadia-server/README.md\">nadia-server</a></li>\n</ul>\n<h2 id=\"Release-Note\"><a href=\"#Release-Note\" class=\"headerlink\" title=\"Release-Note\"></a>Release-Note</h2><ul>\n<li><p>v1.0</p></li></ul></body></html>","more":"<h2 id=\"ä¸»è¦ç›®æ ‡ï¼š\"><a href=\"#ä¸»è¦ç›®æ ‡ï¼š\" class=\"headerlink\" title=\"ä¸»è¦ç›®æ ‡ï¼š\"></a>ä¸»è¦ç›®æ ‡ï¼š</h2>\n<li><p>å…¼å®¹springbootæ¡†æ¶ï¼Œä¸šåŠ¡ç³»ç»Ÿæ— éœ€ä»£ç å˜æ›´</p>\n</li>\n<li><p>å¿«é€Ÿæ¥å…¥ï¼ŒjaråŒ…å¼•ç”¨</p>\n</li>\n<li><p>é…ç½®åŠ¨æ€æ›´æ–°ï¼Œå®æ—¶ç”Ÿæ•ˆ</p>\n</li>\n<li><p>æ”¯æŒé›†ç¾¤åˆ†ç»„ï¼Œé…ç½®å·®å¼‚åŒ–</p>\n</li>\n<li><p>æä¾›é…ç½®ç»Ÿä¸€å˜æ›´å¹³å°ï¼Œæ”¯æŒå¹³å°ç”¨æˆ·çš„æƒé™ç®¡ç†å’Œé…ç½®å˜æ›´çš„æƒé™ç®¡ç†</p>\n</li>\n\n<h4 id=\"éƒ¨ç½²å›¾\"><a href=\"#éƒ¨ç½²å›¾\" class=\"headerlink\" title=\"éƒ¨ç½²å›¾\"></a>éƒ¨ç½²å›¾</h4><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%9B%BE.png\" alt=\"01\"></p>\n<h4 id=\"é¡¹ç›®æ„æˆ\"><a href=\"#é¡¹ç›®æ„æˆ\" class=\"headerlink\" title=\"é¡¹ç›®æ„æˆ\"></a>é¡¹ç›®æ„æˆ</h4><blockquote>\n<p>nadia-config é¡¹ç›®æ ¹ç›®å½•</p>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>nadia-client å®¢æˆ·ç«¯</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>nadia-core é€šç”¨ä»£ç </p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>nadia-server æœåŠ¡ç«¯</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>nadia-web å‰ç«¯é¡µé¢</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>nadia-demo å®¢æˆ·ç«¯demo</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<p>docs æ–‡æ¡£</p>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>desgin è®¾è®¡æ–‡æ¡£</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>sql æœåŠ¡ç«¯è„šæœ¬</p>\n</blockquote>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>DDL.sql å»ºè¡¨</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<blockquote>\n<p>DML.sql åˆå§‹æ•°æ®</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<h4 id=\"ç®¡ç†å¹³å°ä»‹ç»\"><a href=\"#ç®¡ç†å¹³å°ä»‹ç»\" class=\"headerlink\" title=\"ç®¡ç†å¹³å°ä»‹ç»\"></a>ç®¡ç†å¹³å°ä»‹ç»</h4><h4 id=\"1-ç™»å½•é¡µé¢\"><a href=\"#1-ç™»å½•é¡µé¢\" class=\"headerlink\" title=\"1. ç™»å½•é¡µé¢\"></a>1. ç™»å½•é¡µé¢</h4><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/%E7%99%BB%E5%BD%95.png\" alt=\"02\"></p>\n<h4 id=\"2-æ³¨å†Œé¡µé¢\"><a href=\"#2-æ³¨å†Œé¡µé¢\" class=\"headerlink\" title=\"2. æ³¨å†Œé¡µé¢\"></a>2. æ³¨å†Œé¡µé¢</h4><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/%E6%B3%A8%E5%86%8C.png\" alt=\"03\"></p>\n<h4 id=\"3-ä¸»ç•Œé¢\"><a href=\"#3-ä¸»ç•Œé¢\" class=\"headerlink\" title=\"3. ä¸»ç•Œé¢\"></a>3. ä¸»ç•Œé¢</h4><h6 id=\"æ ¹æ®ç™»å½•ç”¨æˆ·çš„è§’è‰²ä¸åŒï¼Œèœå•æŒ‰é’®ä¼šæœ‰ç›¸åº”å˜åŒ–\"><a href=\"#æ ¹æ®ç™»å½•ç”¨æˆ·çš„è§’è‰²ä¸åŒï¼Œèœå•æŒ‰é’®ä¼šæœ‰ç›¸åº”å˜åŒ–\" class=\"headerlink\" title=\"æ ¹æ®ç™»å½•ç”¨æˆ·çš„è§’è‰²ä¸åŒï¼Œèœå•æŒ‰é’®ä¼šæœ‰ç›¸åº”å˜åŒ–\"></a>æ ¹æ®ç™»å½•ç”¨æˆ·çš„è§’è‰²ä¸åŒï¼Œèœå•æŒ‰é’®ä¼šæœ‰ç›¸åº”å˜åŒ–</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/%E4%B8%BB%E9%A1%B5%E9%9D%A2.png\" alt=\"04\"></p>\n<h4 id=\"4-é…ç½®ç®¡ç†â€“å…ƒæ•°æ®ç®¡ç†\"><a href=\"#4-é…ç½®ç®¡ç†â€“å…ƒæ•°æ®ç®¡ç†\" class=\"headerlink\" title=\"4. é…ç½®ç®¡ç†â€“å…ƒæ•°æ®ç®¡ç†\"></a>4. é…ç½®ç®¡ç†â€“å…ƒæ•°æ®ç®¡ç†</h4><h6 id=\"å…ƒæ•°æ®ç®¡ç†æ˜¯æ‰€æœ‰é…ç½®çš„åŸºç¡€ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨é…ç½®é¡¹æ—¶éœ€è¦æŒ‡å®šç›¸å…³çš„å…ƒæ•°æ®\"><a href=\"#å…ƒæ•°æ®ç®¡ç†æ˜¯æ‰€æœ‰é…ç½®çš„åŸºç¡€ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨é…ç½®é¡¹æ—¶éœ€è¦æŒ‡å®šç›¸å…³çš„å…ƒæ•°æ®\" class=\"headerlink\" title=\"å…ƒæ•°æ®ç®¡ç†æ˜¯æ‰€æœ‰é…ç½®çš„åŸºç¡€ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨é…ç½®é¡¹æ—¶éœ€è¦æŒ‡å®šç›¸å…³çš„å…ƒæ•°æ®\"></a>å…ƒæ•°æ®ç®¡ç†æ˜¯æ‰€æœ‰é…ç½®çš„åŸºç¡€ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨é…ç½®é¡¹æ—¶éœ€è¦æŒ‡å®šç›¸å…³çš„å…ƒæ•°æ®</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/metadata.png\" alt=\"05\"></p>\n<h6 id=\"åè¯è§£é‡Š\"><a href=\"#åè¯è§£é‡Š\" class=\"headerlink\" title=\"åè¯è§£é‡Š\"></a>åè¯è§£é‡Š</h6><ul>\n<li>Application ç³»ç»Ÿåç§°ï¼Œå®¢æˆ·ç«¯å¯ä»¥æŒ‡å®šä½¿ç”¨ä»»æ„ä¸€å¥—ç³»ç»Ÿä¸‹çš„é…ç½®ã€‚</li>\n<li>Group ç»„åç§°ï¼Œå®¢æˆ·ç«¯æŒ‡å®šç³»ç»Ÿåï¼Œä»éœ€è¦æŒ‡å®šä½¿ç”¨ç³»ç»Ÿä¸‹çš„æŸä¸ªç»„ã€‚è‹¥ä¸å¼ºåˆ¶æŒ‡å®šï¼Œå®¢æˆ·ç«¯å¯åŠ¨åä¼šé»˜è®¤ä½¿ç”¨Defaultç»„ä¸‹çš„é…ç½®ï¼ŒåæœŸå¯ä½¿ç”¨ç»„åˆ‡æ¢åŠŸèƒ½åˆ‡æ¢è‡³ä¸åŒç»„ã€‚</li>\n</ul>\n<h6 id=\"åŠŸèƒ½è¯´æ˜\"><a href=\"#åŠŸèƒ½è¯´æ˜\" class=\"headerlink\" title=\"åŠŸèƒ½è¯´æ˜\"></a>åŠŸèƒ½è¯´æ˜</h6><ul>\n<li>Add æ–°å¢Applicationï¼ŒåŒæ—¶æ–°å¢é»˜è®¤Group(Default)ã€‚</li>\n<li>Delete åˆ é™¤Application\\Groupä¿¡æ¯ã€‚å½“å‰Groupå¦‚æœæ­£åœ¨è¢«ä½¿ç”¨ï¼Œæˆ–å½“å‰ç»„ä¸ºDefaultç»„ä¸”å­˜åœ¨éDefaultç»„æ—¶ï¼Œä¸èƒ½åˆ é™¤ã€‚Defualtç»„åˆ é™¤åå°†åŒæ—¶åˆ é™¤Applicationã€‚</li>\n<li>Compare æ¯”è¾ƒåŒä¸€Applicationä¸‹ä¸åŒGroupçš„é…ç½®å·®å¼‚ï¼Œå¯å¤šé€‰ï¼Œä½†è‡³å°‘é€‰ä¸¤ä¸ªç»„ã€‚</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/compare.png\" alt=\"06\"></p>\n<ul>\n<li>Edit ä¿®æ”¹Applicationä¿¡æ¯</li>\n<li>Group æ–°å¢ç»„ã€‚å¯é€‰æ‹©ä»æŸä¸ªç»„å¤åˆ¶æ‰€æœ‰å·²å‘å¸ƒé…ç½®é¡¹ï¼Œæˆ–ç”Ÿäº§æ–°çš„ç©ºç»„ã€‚</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/addGroup.png\" alt=\"07\"></p>\n<ul>\n<li>Instances å¯å°†æŸå®ä¾‹è°ƒæ•´è‡³å¦ä¸€ç»„ã€‚</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/switch.png\" alt=\"08\"></p>\n<ul>\n<li>Inscance æŸ¥çœ‹å¼„å®ä¾‹å½“å‰çš„é…ç½®ä¸æœåŠ¡ç«¯é…ç½®çš„å·®å¼‚ã€‚</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/instance.png\" alt=\"09\"></p>\n<h4 id=\"5-é…ç½®ç®¡ç†â€“é…ç½®é¡¹ç®¡ç†\"><a href=\"#5-é…ç½®ç®¡ç†â€“é…ç½®é¡¹ç®¡ç†\" class=\"headerlink\" title=\"5. é…ç½®ç®¡ç†â€“é…ç½®é¡¹ç®¡ç†\"></a>5. é…ç½®ç®¡ç†â€“é…ç½®é¡¹ç®¡ç†</h4><h6 id=\"é…ç½®é¡¹ç®¡ç†æä¾›å…·ä½“é…ç½®çš„å¢åˆ æ”¹æŸ¥ã€å‘å¸ƒç­‰åŠŸèƒ½\"><a href=\"#é…ç½®é¡¹ç®¡ç†æä¾›å…·ä½“é…ç½®çš„å¢åˆ æ”¹æŸ¥ã€å‘å¸ƒç­‰åŠŸèƒ½\" class=\"headerlink\" title=\"é…ç½®é¡¹ç®¡ç†æä¾›å…·ä½“é…ç½®çš„å¢åˆ æ”¹æŸ¥ã€å‘å¸ƒç­‰åŠŸèƒ½\"></a>é…ç½®é¡¹ç®¡ç†æä¾›å…·ä½“é…ç½®çš„å¢åˆ æ”¹æŸ¥ã€å‘å¸ƒç­‰åŠŸèƒ½</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/configs.png\" alt=\"10\"></p>\n<h6 id=\"åè¯è§£é‡Š-1\"><a href=\"#åè¯è§£é‡Š-1\" class=\"headerlink\" title=\"åè¯è§£é‡Š\"></a>åè¯è§£é‡Š</h6><ul>\n<li>Key é…ç½®é¡¹çš„keyï¼Œä¸å®¢æˆ·ç«¯ä¸­@Value({key})ç›¸å¯¹åº”</li>\n<li>Value å€¼</li>\n<li>Status <ul>\n<li>new æ–°å»ºé…ç½®</li>\n<li>edited é…ç½®å·²å˜æ›´ï¼Œå¸¦å®¡æ‰¹</li>\n<li>approved é…ç½®å®¡æ‰¹é€šè¿‡ï¼Œå¯å‘å¸ƒ</li>\n<li>published é…ç½®å·²å‘å¸ƒ</li>\n<li>removing é…ç½®åˆ é™¤ï¼Œå¾…å®¡æ‰¹</li>\n<li>deleted é…ç½®å·²åˆ é™¤ï¼Œä¸æ˜¾ç¤º</li>\n<li>invalid é…ç½®æ— æ•ˆï¼Œä¸æ˜¾ç¤º</li>\n</ul>\n</li>\n</ul>\n<h6 id=\"åŠŸèƒ½è¯´æ˜-1\"><a href=\"#åŠŸèƒ½è¯´æ˜-1\" class=\"headerlink\" title=\"åŠŸèƒ½è¯´æ˜\"></a>åŠŸèƒ½è¯´æ˜</h6><ul>\n<li>Add æ–°å¢é…ç½®ï¼Œå¯é€‰æ‹©é…ç½®çš„å¯è§æƒé™ã€‚è‹¥ä¸é€‰æ‹©ï¼Œåˆ™è¯¥é…ç½®ä¸ºå½“å‰ç™»å½•ç”¨æˆ·çš„è§’è‰²å¯è§ã€‚éœ€è¦å®¡æ‰¹ã€‚</li>\n<li>Delete åˆ é™¤é…ç½®ï¼Œéœ€è¦å®¡æ‰¹ã€‚</li>\n<li>Export å¯¼å‡ºé…ç½®ã€‚</li>\n<li>Import å¯¼å…¥é…ç½®ï¼Œéœ€è¦å®¡æ‰¹ã€‚</li>\n<li>Edit ç¼–è¾‘é…ç½®ï¼Œéœ€è¦å®¡æ‰¹ã€‚</li>\n<li>Instance æŸ¥çœ‹å½“å‰é…ç½®çš„ä½¿ç”¨æƒ…å†µã€‚</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/instanceConfig.png\" alt=\"11\"></p>\n<ul>\n<li>History é…ç½®ä¿®æ”¹å†å²</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/history.png\" alt=\"12\"></p>\n<h4 id=\"6-é…ç½®ç®¡ç†â€“é…ç½®é¡¹åˆ†é…\"><a href=\"#6-é…ç½®ç®¡ç†â€“é…ç½®é¡¹åˆ†é…\" class=\"headerlink\" title=\"6. é…ç½®ç®¡ç†â€“é…ç½®é¡¹åˆ†é…\"></a>6. é…ç½®ç®¡ç†â€“é…ç½®é¡¹åˆ†é…</h4><h6 id=\"é…ç½®é¡¹åˆ†é…æä¾›å…¨å±€çš„è§’è‰²é…ç½®å¯è§æƒé™è®¾ç½®ã€‚\"><a href=\"#é…ç½®é¡¹åˆ†é…æä¾›å…¨å±€çš„è§’è‰²é…ç½®å¯è§æƒé™è®¾ç½®ã€‚\" class=\"headerlink\" title=\"é…ç½®é¡¹åˆ†é…æä¾›å…¨å±€çš„è§’è‰²é…ç½®å¯è§æƒé™è®¾ç½®ã€‚\"></a>é…ç½®é¡¹åˆ†é…æä¾›å…¨å±€çš„è§’è‰²é…ç½®å¯è§æƒé™è®¾ç½®ã€‚</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/allocate.png\" alt=\"13\"></p>\n<h6 id=\"åŠŸèƒ½è¯´æ˜-2\"><a href=\"#åŠŸèƒ½è¯´æ˜-2\" class=\"headerlink\" title=\"åŠŸèƒ½è¯´æ˜\"></a>åŠŸèƒ½è¯´æ˜</h6><ul>\n<li>Allocate åˆ†é…è§’è‰²å¯è§é…ç½®</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/allocateConfigs.png\" alt=\"14\"></p>\n<h4 id=\"7-æ¶ˆæ¯ä¸­å¿ƒâ€“æ“ä½œæ—¥å¿—\"><a href=\"#7-æ¶ˆæ¯ä¸­å¿ƒâ€“æ“ä½œæ—¥å¿—\" class=\"headerlink\" title=\"7. æ¶ˆæ¯ä¸­å¿ƒâ€“æ“ä½œæ—¥å¿—\"></a>7. æ¶ˆæ¯ä¸­å¿ƒâ€“æ“ä½œæ—¥å¿—</h4><h6 id=\"æä¾›ç®¡ç†å¹³å°æ‰€æœ‰å¢åˆ æ”¹çš„æ“ä½œæ—¥å¿—æŸ¥è¯¢å’Œå›æº¯ã€‚\"><a href=\"#æä¾›ç®¡ç†å¹³å°æ‰€æœ‰å¢åˆ æ”¹çš„æ“ä½œæ—¥å¿—æŸ¥è¯¢å’Œå›æº¯ã€‚\" class=\"headerlink\" title=\"æä¾›ç®¡ç†å¹³å°æ‰€æœ‰å¢åˆ æ”¹çš„æ“ä½œæ—¥å¿—æŸ¥è¯¢å’Œå›æº¯ã€‚\"></a>æä¾›ç®¡ç†å¹³å°æ‰€æœ‰å¢åˆ æ”¹çš„æ“ä½œæ—¥å¿—æŸ¥è¯¢å’Œå›æº¯ã€‚</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/operationLog.png\" alt=\"15\"></p>\n<h4 id=\"8-æ¶ˆæ¯ä¸­å¿ƒâ€“ä»»åŠ¡ä¸­å¿ƒ\"><a href=\"#8-æ¶ˆæ¯ä¸­å¿ƒâ€“ä»»åŠ¡ä¸­å¿ƒ\" class=\"headerlink\" title=\"8. æ¶ˆæ¯ä¸­å¿ƒâ€“ä»»åŠ¡ä¸­å¿ƒ\"></a>8. æ¶ˆæ¯ä¸­å¿ƒâ€“ä»»åŠ¡ä¸­å¿ƒ</h4><h6 id=\"æä¾›å®¡æ‰¹æŸ¥çœ‹ã€å®¡æ‰¹æ“ä½œ-é€šè¿‡ã€æ‹’ç»-ç­‰åŠŸèƒ½ã€‚\"><a href=\"#æä¾›å®¡æ‰¹æŸ¥çœ‹ã€å®¡æ‰¹æ“ä½œ-é€šè¿‡ã€æ‹’ç»-ç­‰åŠŸèƒ½ã€‚\" class=\"headerlink\" title=\"æä¾›å®¡æ‰¹æŸ¥çœ‹ã€å®¡æ‰¹æ“ä½œ(é€šè¿‡ã€æ‹’ç»)ç­‰åŠŸèƒ½ã€‚\"></a>æä¾›å®¡æ‰¹æŸ¥çœ‹ã€å®¡æ‰¹æ“ä½œ(é€šè¿‡ã€æ‹’ç»)ç­‰åŠŸèƒ½ã€‚</h6><ul>\n<li>Pending Task å¾…å®¡æ‰¹åˆ—è¡¨ï¼Œæä¾›å®¡æ‰¹é€šè¿‡ã€å†³ç»ï¼Œå®¡é…å†…å®¹æŸ¥çœ‹ç­‰åŠŸèƒ½ã€‚</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/pendingTask.png\" alt=\"16\"></p>\n<ul>\n<li>Processing Task å®¡æ‰¹è¿›åº¦åˆ—è¡¨ï¼Œæä¾›å®¡æ‰¹è¿›åº¦çš„æŸ¥è¯¢ã€‚</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/processingTask.png\" alt=\"17\"></p>\n<ul>\n<li>Complete Task å®Œæˆä»»åŠ¡åˆ—è¡¨ï¼Œæä¾›å†å²å®¡æ‰¹é€šè¿‡ã€æ‹’ç»çš„ä»»åŠ¡çš„æŸ¥è¯¢ã€‚</li>\n</ul>\n<p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/completeTask.png\" alt=\"18\"></p>\n<h4 id=\"9-æ¶ˆæ¯ä¸­å¿ƒâ€“æ“ä½œæ—¥å¿—\"><a href=\"#9-æ¶ˆæ¯ä¸­å¿ƒâ€“æ“ä½œæ—¥å¿—\" class=\"headerlink\" title=\"9. æ¶ˆæ¯ä¸­å¿ƒâ€“æ“ä½œæ—¥å¿—\"></a>9. æ¶ˆæ¯ä¸­å¿ƒâ€“æ“ä½œæ—¥å¿—</h4><h6 id=\"æä¾›å®¢æˆ·ç«¯ä¸ŠæŠ¥æ—¥å¿—çš„æŸ¥è¯¢ã€‚\"><a href=\"#æä¾›å®¢æˆ·ç«¯ä¸ŠæŠ¥æ—¥å¿—çš„æŸ¥è¯¢ã€‚\" class=\"headerlink\" title=\"æä¾›å®¢æˆ·ç«¯ä¸ŠæŠ¥æ—¥å¿—çš„æŸ¥è¯¢ã€‚\"></a>æä¾›å®¢æˆ·ç«¯ä¸ŠæŠ¥æ—¥å¿—çš„æŸ¥è¯¢ã€‚</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/clientLog.png\" alt=\"19\"></p>\n<h4 id=\"10-ç”¨æˆ·ä¸­å¿ƒâ€“è§’è‰²ç®¡ç†\"><a href=\"#10-ç”¨æˆ·ä¸­å¿ƒâ€“è§’è‰²ç®¡ç†\" class=\"headerlink\" title=\"10. ç”¨æˆ·ä¸­å¿ƒâ€“è§’è‰²ç®¡ç†\"></a>10. ç”¨æˆ·ä¸­å¿ƒâ€“è§’è‰²ç®¡ç†</h4><h6 id=\"æä¾›è§’è‰²çš„å¢åˆ æ”¹æŸ¥ï¼Œè§’è‰²çš„èœå•æƒé™ã€æŒ‰é’®æƒé™çš„è®¾ç½®ã€‚\"><a href=\"#æä¾›è§’è‰²çš„å¢åˆ æ”¹æŸ¥ï¼Œè§’è‰²çš„èœå•æƒé™ã€æŒ‰é’®æƒé™çš„è®¾ç½®ã€‚\" class=\"headerlink\" title=\"æä¾›è§’è‰²çš„å¢åˆ æ”¹æŸ¥ï¼Œè§’è‰²çš„èœå•æƒé™ã€æŒ‰é’®æƒé™çš„è®¾ç½®ã€‚\"></a>æä¾›è§’è‰²çš„å¢åˆ æ”¹æŸ¥ï¼Œè§’è‰²çš„èœå•æƒé™ã€æŒ‰é’®æƒé™çš„è®¾ç½®ã€‚</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/role.png\" alt=\"20\"></p>\n<h4 id=\"11-ç”¨æˆ·ä¸­å¿ƒâ€“ç”¨æˆ·ç®¡ç†\"><a href=\"#11-ç”¨æˆ·ä¸­å¿ƒâ€“ç”¨æˆ·ç®¡ç†\" class=\"headerlink\" title=\"11. ç”¨æˆ·ä¸­å¿ƒâ€“ç”¨æˆ·ç®¡ç†\"></a>11. ç”¨æˆ·ä¸­å¿ƒâ€“ç”¨æˆ·ç®¡ç†</h4><h6 id=\"æä¾›ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥ï¼Œç”¨æˆ·çš„è§’è‰²åˆ†é…è®¾ç½®ã€‚\"><a href=\"#æä¾›ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥ï¼Œç”¨æˆ·çš„è§’è‰²åˆ†é…è®¾ç½®ã€‚\" class=\"headerlink\" title=\"æä¾›ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥ï¼Œç”¨æˆ·çš„è§’è‰²åˆ†é…è®¾ç½®ã€‚\"></a>æä¾›ç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥ï¼Œç”¨æˆ·çš„è§’è‰²åˆ†é…è®¾ç½®ã€‚</h6><p><img src=\"/2020/03/20/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E4%BB%8B%E7%BB%8D%E7%AF%87/user.png\" alt=\"21\"></p>"},{"title":"æˆ‘ä¸ºä»€ä¹ˆä¼šæ‰‹æ’¸ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡ï¼ˆä¸€ï¼‰","date":"2020-03-24T06:12:24.000Z","_content":"## å¼€ç¯‡\nä»è¿™ç¯‡å¼€å§‹ï¼Œæˆ‘ä»¬å¼€å§‹ä»‹ç»æ•´ä¸ªé…ç½®ä¸­å¿ƒçš„è®¾è®¡æ€æƒ³å’Œæ¶æ„çš„æµç¨‹ï¼Œä¸»è¦ä¼šåˆ†ä¸ºä¸‹é¢å‡ ä¸ªéƒ¨åˆ†ï¼š\n\n1. é…ç½®ä¸­å¿ƒåŸºç¡€åŠŸèƒ½åˆ†æ\n2. é…ç½®ä¸­å¿ƒæŠ€æœ¯é€‰å‹\n3. é…ç½®ä¸­å¿ƒæ¶æ„éƒ¨ç½²\n\n## åŸºç¡€åŠŸèƒ½åˆ†æ--é…ç½®ç»“æ„\nå¼€å§‹è®¾è®¡å‰æˆ‘ä»¬å…ˆåˆ†æä¸‹ä¸€ä¸ªé…ç½®ä¸­å¿ƒåˆ°åº•éœ€è¦å“ªäº›åŠŸèƒ½ï¼ŒåŒæ—¶å·¥ä½œä¸­æœ‰å“ªäº›ç—›ç‚¹æ˜¯å¯ä»¥é€šè¿‡é…ç½®ä¸­å¿ƒæ¥è§£å†³çš„ã€‚\n<!-- more -->\n#### 1.é…ç½®çš„ç®¡ç†\nåŸå§‹çš„é…ç½®é¡¹ç®¡ç†å¤§é‡é‡‡ç”¨äº†ä»£ç ç»´æŠ¤çš„æ–¹å¼ï¼Œå¦‚springçš„ymlé…ç½®æ–‡ä»¶ã€ä»£ç ä¸­çš„@Valueæ³¨è§£ã€å„ç§ä¸­é—´ä»¶çš„é…ç½®æ–‡ä»¶ç­‰ã€‚ä¸ä»…ä¸åˆ©äºé…ç½®çš„åŠ¨æ€å˜æ›´ï¼Œæ›´ä¸åˆ©äºç»Ÿä¸€ç®¡ç†é…ç½®ä¿¡æ¯ï¼Œå› æ­¤ç°æœ‰çš„é…ç½®ä¸­å¿ƒè§£å†³æ–¹æ¡ˆä¼šé€šå¸¸ä¼šå°†é…ç½®ä¸­å¿ƒåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚\n* å®¢æˆ·ç«¯è´Ÿè´£ä¸šåŠ¡ç³»ç»Ÿçš„é…ç½®æ”¶é›†ä¸å®æ—¶åŒæ­¥ç­‰ã€‚\n* æœåŠ¡ç«¯è´Ÿè´£é…ç½®çš„ç»Ÿä¸€ç®¡ç†å’Œå®æ—¶æ›´æ–°ç­‰ã€‚\n\nç»“åˆä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡çš„åˆæœŸä¹Ÿä¼šå°†æ•´ä¸ªé…ç½®ä¸­å¿ƒçš„æŠ€æœ¯æ¶æ„åˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸¤éƒ¨åˆ†ã€‚\n\nå›åˆ°é…ç½®ç®¡ç†çš„è¯é¢˜ä¸Šï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ç‚¹ã€å¦‚ä½•ç®¡ç†é…ç½®ã€‘ã€‚è¿™é‡Œçš„â€œç®¡ç†â€ä¸å•å•åªæ˜¯å°†é…ç½®åœ¨æŸä¸ªé¡µé¢ä¸Šç»™ç”¨æˆ·å±•ç¤ºè€Œå·²ï¼Œè¿˜è¦ç»†åŒ–åˆ°ï¼š\n* é…ç½®å¦‚ä½•åˆ’åˆ†èŒƒå›´ï¼Ÿ\n* é…ç½®å·®å¼‚åŒ–å¦‚ä½•å¤„ç†ï¼Ÿ\n* é…ç½®æƒé™å¦‚ä½•å¤„ç†ï¼Ÿ\n\n###### é…ç½®å¦‚ä½•åˆ’åˆ†èŒƒå›´ï¼Ÿ\nå„ä¸ªä¸šåŠ¡æœåŠ¡è¿æ¥åˆ°é…ç½®ä¸­å¿ƒåï¼Œä»–ä»¬éƒ½æœ‰æ€ä¹ˆä¸åŒçš„é…ç½®ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠä»–ä»¬çš„é…ç½®å…¨éƒ¨æ··ä¸ºä¸€è°ˆã€‚ä¸åŒçš„æœåŠ¡çš„é…ç½®æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œå¤šä¸ªç›¸åŒæœåŠ¡å…±äº«åŒä¸€ä¸ªä½œç”¨åŸŸä¸‹çš„é…ç½®ã€‚\n\né€šè¿‡æœåŠ¡æ¥åˆ’åˆ†é…ç½®èŒƒå›´æ˜¯ä¸€ä¸ªåŠæ³•ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™å…¶å®ä¹Ÿæ˜¯è¿™ä¹ˆå¤„ç†çš„ã€‚ä½†æ˜¯ä»…ä»…å¦‚æ­¤æ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼Œä¸šåŠ¡åœºæ™¯ä¸Šæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°AB testï¼Œæˆ‘ä»¬è§£å†³çš„åŠæ³•å¸¸å¸¸æ˜¯é€šè¿‡ç°åº¦å‘å¸ƒæˆ–è“ç»¿å‘ç‰ˆã€‚é€šè¿‡ä¸åŒçš„è§„åˆ™å°†å‰ç«¯æµé‡å¼•å‘ç›¸åŒæœåŠ¡çš„ä¸åŒç‰ˆæœ¬ä»è€Œå®ç°ç”Ÿäº§ä¸Šçš„å·®å¼‚åŒ–ã€‚\n\nå¦‚æœæˆ‘ä»¬åªæ˜¯ç®€å•çš„é€šè¿‡æœåŠ¡æ¥åˆ’åˆ†é…ç½®ï¼Œä½†é‡åˆ°ä¸Šè¯‰é—®é¢˜çš„æ—¶å€™å¾€å¾€ç—›ç–¼ä¸å·²ã€‚1.0 Veréœ€è¦çœ‹åˆ°Aæ–‡æ¡ˆï¼Œ1.1 Veréœ€è¦çœ‹åˆ°Bæ–‡æ¡ˆã€‚æˆ‘ä»¬å‡è±¡ä¸‹ï¼Œå¦‚æœé€šè¿‡è¿‡å»çš„é…ç½®æ–‡ä»¶æ–¹å¼ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆå¤„ç†ï¼Ÿé¦–å…ˆè¦åœ¨ä»£ç é‡Œåˆ¤æ–­å½“å‰æœåŠ¡çš„ç‰ˆæœ¬ï¼Œç„¶åæ ¹æ®ä¸åŒçš„ç‰ˆæœ¬è¯»å–ä¸åŒçš„é…ç½®ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸åŒç‰ˆæœ¬ä¸åŒå±•ç¤ºæ•ˆæœçš„åŠŸèƒ½ã€‚\n\n```Java\n\n@Vaule(\"{test.a}\")\nprivate String testA;\n\n@Vaule(\"{test.b}\")\nprivate String testB;\n\npublic void getTest(String version) {\n    if('1.0'.equel(version)){\n        System.out.println(testA);\n    }else if('1.1'.equel(version)){\n        System.out.println(testB);\n    }\n}\n```\n\nå¯èƒ½ä¼šæœ‰æ›´å¥½çš„å¤„ç†æ–¹æ³•ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬ä¼šåƒä¸Šé¢å†™ä»£ç ã€‚é•¿æ­¤ä»¥å¾€å¯æƒ³è€ŒçŸ¥ï¼Œåé¢çš„åŒå­¦ä¸çŸ¥é“ä¹‹å‰çš„é€»è¾‘å°±çœ‹ä¸æ‡‚è¿™æ®µä»£ç åœ¨å†™ä»€ä¹ˆã€‚è€Œä¸”æ¯æ¬¡æœ‰ç‰ˆæœ¬çš„å˜æ›´ï¼Œéƒ½éœ€è¦ç¡¬ç¼–ç ã€‚\n\né‚£æœ‰æ²¡æœ‰æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œæ—¢ç„¶æˆ‘ä»¬éƒ½æœ‰é…ç½®ä¸­å¿ƒäº†ï¼ŒåŒæ—¶æˆ‘ä»¬çš„é…ç½®ä¹Ÿéƒ½äº¤ç”±é…ç½®ä¸­å¿ƒç®¡ç†äº†ï¼Œé…ç½®å˜æ›´æ—¶æˆ‘ä»¬ä¹Ÿèƒ½å®æ—¶çš„åŒæ­¥é…ç½®ã€‚é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½åŒºåˆ†å‡ºç›¸åŒæœåŠ¡çš„å·®å¼‚åŒ–é…ç½®å‘¢ï¼Ÿ\n\nç­”æ¡ˆè‚¯å®šæ˜¯å¯ä»¥çš„ã€‚åœ¨å·²æœåŠ¡ä½œä¸ºé…ç½®çš„ä½œç”¨åŸŸä¸‹ï¼Œæˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªç»„çš„æ¦‚å¿µï¼š\n\n|Application|Group|\n---|---\nService1|Default\nService1|V1.0\nService1|V1.1\nService2|Default\n\nåŒä¸€ä¸ªåº”ç”¨å¯ä»¥åˆ’åˆ†å¤šä¸ªç»„ï¼Œæ¯ä¸ªç»„ä¸­çš„é…ç½®å­˜åœ¨å·®å¼‚åŒ–ï¼Œç›¸åŒé…ç½®çš„æœåŠ¡å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç»„çš„é…ç½®ã€‚\n\nä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬åˆ’åˆ†é…ç½®èŒƒå›´çš„è¿‡ç¨‹ï¼Œæ—¢å¯ä»¥è§£å†³é…ç½®çš„å·®å¼‚åŒ–ï¼Œä¹Ÿå¯ä»¥å°†å„ä¸ªæœåŠ¡çš„é…ç½®ç»Ÿä¸€ç®¡ç†èµ·æ¥ã€‚å½“ç„¶è¿™ä¸ªé…ç½®çš„æ¨¡å‹è¿˜éœ€è¦ä¸æ–­çš„è¿›åŒ–ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬æ˜¯å¦å¯ä»¥æç‚¼å‡ºç›¸åŒçš„é…ç½®ï¼Œç±»ä¼¼äºjaråœ¨æˆ‘ä»¬æœåŠ¡ä¸­ç›¸äº’å¼•ç”¨çš„æ–¹å¼ä¸€æ ·ï¼Œåœ¨æˆ‘ä»¬ç»™ä¸ªåº”ç”¨ä¸­å…±äº«ã€‚æœªæ¥æˆ‘ä»¬ä¹Ÿä¼šé’ˆå¯¹ç±»ä¼¼çš„éœ€æ±‚ä¸æ–­çš„ä¼˜åŒ–ã€‚\n\n\n\n","source":"_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡.md","raw":"---\ntitle: æˆ‘ä¸ºä»€ä¹ˆä¼šæ‰‹æ’¸ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡ï¼ˆä¸€ï¼‰\ndate: 2020-03-24 14:12:24\ntags: \n    - Java\n    - Redis\n    - é…ç½®ä¸­å¿ƒ\ncategories :\n    - Technology\n---\n## å¼€ç¯‡\nä»è¿™ç¯‡å¼€å§‹ï¼Œæˆ‘ä»¬å¼€å§‹ä»‹ç»æ•´ä¸ªé…ç½®ä¸­å¿ƒçš„è®¾è®¡æ€æƒ³å’Œæ¶æ„çš„æµç¨‹ï¼Œä¸»è¦ä¼šåˆ†ä¸ºä¸‹é¢å‡ ä¸ªéƒ¨åˆ†ï¼š\n\n1. é…ç½®ä¸­å¿ƒåŸºç¡€åŠŸèƒ½åˆ†æ\n2. é…ç½®ä¸­å¿ƒæŠ€æœ¯é€‰å‹\n3. é…ç½®ä¸­å¿ƒæ¶æ„éƒ¨ç½²\n\n## åŸºç¡€åŠŸèƒ½åˆ†æ--é…ç½®ç»“æ„\nå¼€å§‹è®¾è®¡å‰æˆ‘ä»¬å…ˆåˆ†æä¸‹ä¸€ä¸ªé…ç½®ä¸­å¿ƒåˆ°åº•éœ€è¦å“ªäº›åŠŸèƒ½ï¼ŒåŒæ—¶å·¥ä½œä¸­æœ‰å“ªäº›ç—›ç‚¹æ˜¯å¯ä»¥é€šè¿‡é…ç½®ä¸­å¿ƒæ¥è§£å†³çš„ã€‚\n<!-- more -->\n#### 1.é…ç½®çš„ç®¡ç†\nåŸå§‹çš„é…ç½®é¡¹ç®¡ç†å¤§é‡é‡‡ç”¨äº†ä»£ç ç»´æŠ¤çš„æ–¹å¼ï¼Œå¦‚springçš„ymlé…ç½®æ–‡ä»¶ã€ä»£ç ä¸­çš„@Valueæ³¨è§£ã€å„ç§ä¸­é—´ä»¶çš„é…ç½®æ–‡ä»¶ç­‰ã€‚ä¸ä»…ä¸åˆ©äºé…ç½®çš„åŠ¨æ€å˜æ›´ï¼Œæ›´ä¸åˆ©äºç»Ÿä¸€ç®¡ç†é…ç½®ä¿¡æ¯ï¼Œå› æ­¤ç°æœ‰çš„é…ç½®ä¸­å¿ƒè§£å†³æ–¹æ¡ˆä¼šé€šå¸¸ä¼šå°†é…ç½®ä¸­å¿ƒåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚\n* å®¢æˆ·ç«¯è´Ÿè´£ä¸šåŠ¡ç³»ç»Ÿçš„é…ç½®æ”¶é›†ä¸å®æ—¶åŒæ­¥ç­‰ã€‚\n* æœåŠ¡ç«¯è´Ÿè´£é…ç½®çš„ç»Ÿä¸€ç®¡ç†å’Œå®æ—¶æ›´æ–°ç­‰ã€‚\n\nç»“åˆä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡çš„åˆæœŸä¹Ÿä¼šå°†æ•´ä¸ªé…ç½®ä¸­å¿ƒçš„æŠ€æœ¯æ¶æ„åˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸¤éƒ¨åˆ†ã€‚\n\nå›åˆ°é…ç½®ç®¡ç†çš„è¯é¢˜ä¸Šï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ç‚¹ã€å¦‚ä½•ç®¡ç†é…ç½®ã€‘ã€‚è¿™é‡Œçš„â€œç®¡ç†â€ä¸å•å•åªæ˜¯å°†é…ç½®åœ¨æŸä¸ªé¡µé¢ä¸Šç»™ç”¨æˆ·å±•ç¤ºè€Œå·²ï¼Œè¿˜è¦ç»†åŒ–åˆ°ï¼š\n* é…ç½®å¦‚ä½•åˆ’åˆ†èŒƒå›´ï¼Ÿ\n* é…ç½®å·®å¼‚åŒ–å¦‚ä½•å¤„ç†ï¼Ÿ\n* é…ç½®æƒé™å¦‚ä½•å¤„ç†ï¼Ÿ\n\n###### é…ç½®å¦‚ä½•åˆ’åˆ†èŒƒå›´ï¼Ÿ\nå„ä¸ªä¸šåŠ¡æœåŠ¡è¿æ¥åˆ°é…ç½®ä¸­å¿ƒåï¼Œä»–ä»¬éƒ½æœ‰æ€ä¹ˆä¸åŒçš„é…ç½®ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠä»–ä»¬çš„é…ç½®å…¨éƒ¨æ··ä¸ºä¸€è°ˆã€‚ä¸åŒçš„æœåŠ¡çš„é…ç½®æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œå¤šä¸ªç›¸åŒæœåŠ¡å…±äº«åŒä¸€ä¸ªä½œç”¨åŸŸä¸‹çš„é…ç½®ã€‚\n\né€šè¿‡æœåŠ¡æ¥åˆ’åˆ†é…ç½®èŒƒå›´æ˜¯ä¸€ä¸ªåŠæ³•ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™å…¶å®ä¹Ÿæ˜¯è¿™ä¹ˆå¤„ç†çš„ã€‚ä½†æ˜¯ä»…ä»…å¦‚æ­¤æ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼Œä¸šåŠ¡åœºæ™¯ä¸Šæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°AB testï¼Œæˆ‘ä»¬è§£å†³çš„åŠæ³•å¸¸å¸¸æ˜¯é€šè¿‡ç°åº¦å‘å¸ƒæˆ–è“ç»¿å‘ç‰ˆã€‚é€šè¿‡ä¸åŒçš„è§„åˆ™å°†å‰ç«¯æµé‡å¼•å‘ç›¸åŒæœåŠ¡çš„ä¸åŒç‰ˆæœ¬ä»è€Œå®ç°ç”Ÿäº§ä¸Šçš„å·®å¼‚åŒ–ã€‚\n\nå¦‚æœæˆ‘ä»¬åªæ˜¯ç®€å•çš„é€šè¿‡æœåŠ¡æ¥åˆ’åˆ†é…ç½®ï¼Œä½†é‡åˆ°ä¸Šè¯‰é—®é¢˜çš„æ—¶å€™å¾€å¾€ç—›ç–¼ä¸å·²ã€‚1.0 Veréœ€è¦çœ‹åˆ°Aæ–‡æ¡ˆï¼Œ1.1 Veréœ€è¦çœ‹åˆ°Bæ–‡æ¡ˆã€‚æˆ‘ä»¬å‡è±¡ä¸‹ï¼Œå¦‚æœé€šè¿‡è¿‡å»çš„é…ç½®æ–‡ä»¶æ–¹å¼ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆå¤„ç†ï¼Ÿé¦–å…ˆè¦åœ¨ä»£ç é‡Œåˆ¤æ–­å½“å‰æœåŠ¡çš„ç‰ˆæœ¬ï¼Œç„¶åæ ¹æ®ä¸åŒçš„ç‰ˆæœ¬è¯»å–ä¸åŒçš„é…ç½®ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸åŒç‰ˆæœ¬ä¸åŒå±•ç¤ºæ•ˆæœçš„åŠŸèƒ½ã€‚\n\n```Java\n\n@Vaule(\"{test.a}\")\nprivate String testA;\n\n@Vaule(\"{test.b}\")\nprivate String testB;\n\npublic void getTest(String version) {\n    if('1.0'.equel(version)){\n        System.out.println(testA);\n    }else if('1.1'.equel(version)){\n        System.out.println(testB);\n    }\n}\n```\n\nå¯èƒ½ä¼šæœ‰æ›´å¥½çš„å¤„ç†æ–¹æ³•ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬ä¼šåƒä¸Šé¢å†™ä»£ç ã€‚é•¿æ­¤ä»¥å¾€å¯æƒ³è€ŒçŸ¥ï¼Œåé¢çš„åŒå­¦ä¸çŸ¥é“ä¹‹å‰çš„é€»è¾‘å°±çœ‹ä¸æ‡‚è¿™æ®µä»£ç åœ¨å†™ä»€ä¹ˆã€‚è€Œä¸”æ¯æ¬¡æœ‰ç‰ˆæœ¬çš„å˜æ›´ï¼Œéƒ½éœ€è¦ç¡¬ç¼–ç ã€‚\n\né‚£æœ‰æ²¡æœ‰æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œæ—¢ç„¶æˆ‘ä»¬éƒ½æœ‰é…ç½®ä¸­å¿ƒäº†ï¼ŒåŒæ—¶æˆ‘ä»¬çš„é…ç½®ä¹Ÿéƒ½äº¤ç”±é…ç½®ä¸­å¿ƒç®¡ç†äº†ï¼Œé…ç½®å˜æ›´æ—¶æˆ‘ä»¬ä¹Ÿèƒ½å®æ—¶çš„åŒæ­¥é…ç½®ã€‚é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½åŒºåˆ†å‡ºç›¸åŒæœåŠ¡çš„å·®å¼‚åŒ–é…ç½®å‘¢ï¼Ÿ\n\nç­”æ¡ˆè‚¯å®šæ˜¯å¯ä»¥çš„ã€‚åœ¨å·²æœåŠ¡ä½œä¸ºé…ç½®çš„ä½œç”¨åŸŸä¸‹ï¼Œæˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªç»„çš„æ¦‚å¿µï¼š\n\n|Application|Group|\n---|---\nService1|Default\nService1|V1.0\nService1|V1.1\nService2|Default\n\nåŒä¸€ä¸ªåº”ç”¨å¯ä»¥åˆ’åˆ†å¤šä¸ªç»„ï¼Œæ¯ä¸ªç»„ä¸­çš„é…ç½®å­˜åœ¨å·®å¼‚åŒ–ï¼Œç›¸åŒé…ç½®çš„æœåŠ¡å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç»„çš„é…ç½®ã€‚\n\nä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬åˆ’åˆ†é…ç½®èŒƒå›´çš„è¿‡ç¨‹ï¼Œæ—¢å¯ä»¥è§£å†³é…ç½®çš„å·®å¼‚åŒ–ï¼Œä¹Ÿå¯ä»¥å°†å„ä¸ªæœåŠ¡çš„é…ç½®ç»Ÿä¸€ç®¡ç†èµ·æ¥ã€‚å½“ç„¶è¿™ä¸ªé…ç½®çš„æ¨¡å‹è¿˜éœ€è¦ä¸æ–­çš„è¿›åŒ–ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬æ˜¯å¦å¯ä»¥æç‚¼å‡ºç›¸åŒçš„é…ç½®ï¼Œç±»ä¼¼äºjaråœ¨æˆ‘ä»¬æœåŠ¡ä¸­ç›¸äº’å¼•ç”¨çš„æ–¹å¼ä¸€æ ·ï¼Œåœ¨æˆ‘ä»¬ç»™ä¸ªåº”ç”¨ä¸­å…±äº«ã€‚æœªæ¥æˆ‘ä»¬ä¹Ÿä¼šé’ˆå¯¹ç±»ä¼¼çš„éœ€æ±‚ä¸æ–­çš„ä¼˜åŒ–ã€‚\n\n\n\n","slug":"æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡","published":1,"updated":"2020-12-14T09:51:24.047Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htl0015v2521jmd29wg","content":"<html><head></head><body><h2 id=\"&#x5F00;&#x7BC7;\"><a href=\"#&#x5F00;&#x7BC7;\" class=\"headerlink\" title=\"&#x5F00;&#x7BC7;\"></a>&#x5F00;&#x7BC7;</h2><p>&#x4ECE;&#x8FD9;&#x7BC7;&#x5F00;&#x59CB;&#xFF0C;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x4ECB;&#x7ECD;&#x6574;&#x4E2A;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x548C;&#x67B6;&#x6784;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x4E3B;&#x8981;&#x4F1A;&#x5206;&#x4E3A;&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#x90E8;&#x5206;&#xFF1A;</p>\n<ol>\n<li>&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;</li>\n<li>&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x6280;&#x672F;&#x9009;&#x578B;</li>\n<li>&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x67B6;&#x6784;&#x90E8;&#x7F72;</li>\n</ol>\n<h2 id=\"&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7ED3;&#x6784;\"><a href=\"#&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7ED3;&#x6784;\" class=\"headerlink\" title=\"&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7ED3;&#x6784;\"></a>&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7ED3;&#x6784;</h2><p>&#x5F00;&#x59CB;&#x8BBE;&#x8BA1;&#x524D;&#x6211;&#x4EEC;&#x5148;&#x5206;&#x6790;&#x4E0B;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x5230;&#x5E95;&#x9700;&#x8981;&#x54EA;&#x4E9B;&#x529F;&#x80FD;&#xFF0C;&#x540C;&#x65F6;&#x5DE5;&#x4F5C;&#x4E2D;&#x6709;&#x54EA;&#x4E9B;&#x75DB;&#x70B9;&#x662F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x6765;&#x89E3;&#x51B3;&#x7684;&#x3002;</p>\n<a id=\"more\"></a>\n<h4 id=\"1-&#x914D;&#x7F6E;&#x7684;&#x7BA1;&#x7406;\"><a href=\"#1-&#x914D;&#x7F6E;&#x7684;&#x7BA1;&#x7406;\" class=\"headerlink\" title=\"1.&#x914D;&#x7F6E;&#x7684;&#x7BA1;&#x7406;\"></a>1.&#x914D;&#x7F6E;&#x7684;&#x7BA1;&#x7406;</h4><p>&#x539F;&#x59CB;&#x7684;&#x914D;&#x7F6E;&#x9879;&#x7BA1;&#x7406;&#x5927;&#x91CF;&#x91C7;&#x7528;&#x4E86;&#x4EE3;&#x7801;&#x7EF4;&#x62A4;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5982;spring&#x7684;yml&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3001;&#x4EE3;&#x7801;&#x4E2D;&#x7684;@Value&#x6CE8;&#x89E3;&#x3001;&#x5404;&#x79CD;&#x4E2D;&#x95F4;&#x4EF6;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7B49;&#x3002;&#x4E0D;&#x4EC5;&#x4E0D;&#x5229;&#x4E8E;&#x914D;&#x7F6E;&#x7684;&#x52A8;&#x6001;&#x53D8;&#x66F4;&#xFF0C;&#x66F4;&#x4E0D;&#x5229;&#x4E8E;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x56E0;&#x6B64;&#x73B0;&#x6709;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4F1A;&#x901A;&#x5E38;&#x4F1A;&#x5C06;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x5206;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x3002;</p>\n<ul>\n<li>&#x5BA2;&#x6237;&#x7AEF;&#x8D1F;&#x8D23;&#x4E1A;&#x52A1;&#x7CFB;&#x7EDF;&#x7684;&#x914D;&#x7F6E;&#x6536;&#x96C6;&#x4E0E;&#x5B9E;&#x65F6;&#x540C;&#x6B65;&#x7B49;&#x3002;</li>\n<li>&#x670D;&#x52A1;&#x7AEF;&#x8D1F;&#x8D23;&#x914D;&#x7F6E;&#x7684;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x548C;&#x5B9E;&#x65F6;&#x66F4;&#x65B0;&#x7B49;&#x3002;</li>\n</ul>\n<p>&#x7ED3;&#x5408;&#x4E0A;&#x9762;&#x7684;&#x601D;&#x8DEF;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x8BBE;&#x8BA1;&#x7684;&#x521D;&#x671F;&#x4E5F;&#x4F1A;&#x5C06;&#x6574;&#x4E2A;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x6280;&#x672F;&#x67B6;&#x6784;&#x5206;&#x4E3A;&#x5BA2;&#x6237;&#x7AEF;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x4E24;&#x90E8;&#x5206;&#x3002;</p>\n<p>&#x56DE;&#x5230;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x7684;&#x8BDD;&#x9898;&#x4E0A;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x9700;&#x8981;&#x8003;&#x8651;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x529F;&#x80FD;&#x70B9;&#x3010;&#x5982;&#x4F55;&#x7BA1;&#x7406;&#x914D;&#x7F6E;&#x3011;&#x3002;&#x8FD9;&#x91CC;&#x7684;&#x201C;&#x7BA1;&#x7406;&#x201D;&#x4E0D;&#x5355;&#x5355;&#x53EA;&#x662F;&#x5C06;&#x914D;&#x7F6E;&#x5728;&#x67D0;&#x4E2A;&#x9875;&#x9762;&#x4E0A;&#x7ED9;&#x7528;&#x6237;&#x5C55;&#x793A;&#x800C;&#x5DF2;&#xFF0C;&#x8FD8;&#x8981;&#x7EC6;&#x5316;&#x5230;&#xFF1A;</p>\n<ul>\n<li>&#x914D;&#x7F6E;&#x5982;&#x4F55;&#x5212;&#x5206;&#x8303;&#x56F4;&#xFF1F;</li>\n<li>&#x914D;&#x7F6E;&#x5DEE;&#x5F02;&#x5316;&#x5982;&#x4F55;&#x5904;&#x7406;&#xFF1F;</li>\n<li>&#x914D;&#x7F6E;&#x6743;&#x9650;&#x5982;&#x4F55;&#x5904;&#x7406;&#xFF1F;</li>\n</ul>\n<h6 id=\"&#x914D;&#x7F6E;&#x5982;&#x4F55;&#x5212;&#x5206;&#x8303;&#x56F4;&#xFF1F;\"><a href=\"#&#x914D;&#x7F6E;&#x5982;&#x4F55;&#x5212;&#x5206;&#x8303;&#x56F4;&#xFF1F;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;&#x5982;&#x4F55;&#x5212;&#x5206;&#x8303;&#x56F4;&#xFF1F;\"></a>&#x914D;&#x7F6E;&#x5982;&#x4F55;&#x5212;&#x5206;&#x8303;&#x56F4;&#xFF1F;</h6><p>&#x5404;&#x4E2A;&#x4E1A;&#x52A1;&#x670D;&#x52A1;&#x8FDE;&#x63A5;&#x5230;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x540E;&#xFF0C;&#x4ED6;&#x4EEC;&#x90FD;&#x6709;&#x600E;&#x4E48;&#x4E0D;&#x540C;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x80FD;&#x628A;&#x4ED6;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x5168;&#x90E8;&#x6DF7;&#x4E3A;&#x4E00;&#x8C08;&#x3002;&#x4E0D;&#x540C;&#x7684;&#x670D;&#x52A1;&#x7684;&#x914D;&#x7F6E;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x591A;&#x4E2A;&#x76F8;&#x540C;&#x670D;&#x52A1;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x4E2A;&#x4F5C;&#x7528;&#x57DF;&#x4E0B;&#x7684;&#x914D;&#x7F6E;&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x670D;&#x52A1;&#x6765;&#x5212;&#x5206;&#x914D;&#x7F6E;&#x8303;&#x56F4;&#x662F;&#x4E00;&#x4E2A;&#x529E;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x7F16;&#x5199;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x8FD9;&#x4E48;&#x5904;&#x7406;&#x7684;&#x3002;&#x4F46;&#x662F;&#x4EC5;&#x4EC5;&#x5982;&#x6B64;&#x662F;&#x4E0D;&#x591F;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x60F3;&#x8C61;&#x4E00;&#x4E2A;&#x573A;&#x666F;&#xFF0C;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#x4E0A;&#x6211;&#x4EEC;&#x7ECF;&#x5E38;&#x4F1A;&#x9047;&#x5230;AB test&#xFF0C;&#x6211;&#x4EEC;&#x89E3;&#x51B3;&#x7684;&#x529E;&#x6CD5;&#x5E38;&#x5E38;&#x662F;&#x901A;&#x8FC7;&#x7070;&#x5EA6;&#x53D1;&#x5E03;&#x6216;&#x84DD;&#x7EFF;&#x53D1;&#x7248;&#x3002;&#x901A;&#x8FC7;&#x4E0D;&#x540C;&#x7684;&#x89C4;&#x5219;&#x5C06;&#x524D;&#x7AEF;&#x6D41;&#x91CF;&#x5F15;&#x5411;&#x76F8;&#x540C;&#x670D;&#x52A1;&#x7684;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x751F;&#x4EA7;&#x4E0A;&#x7684;&#x5DEE;&#x5F02;&#x5316;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x7B80;&#x5355;&#x7684;&#x901A;&#x8FC7;&#x670D;&#x52A1;&#x6765;&#x5212;&#x5206;&#x914D;&#x7F6E;&#xFF0C;&#x4F46;&#x9047;&#x5230;&#x4E0A;&#x8BC9;&#x95EE;&#x9898;&#x7684;&#x65F6;&#x5019;&#x5F80;&#x5F80;&#x75DB;&#x75BC;&#x4E0D;&#x5DF2;&#x3002;1.0 Ver&#x9700;&#x8981;&#x770B;&#x5230;A&#x6587;&#x6848;&#xFF0C;1.1 Ver&#x9700;&#x8981;&#x770B;&#x5230;B&#x6587;&#x6848;&#x3002;&#x6211;&#x4EEC;&#x5047;&#x8C61;&#x4E0B;&#xFF0C;&#x5982;&#x679C;&#x901A;&#x8FC7;&#x8FC7;&#x53BB;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x65B9;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x600E;&#x4E48;&#x5904;&#x7406;&#xFF1F;&#x9996;&#x5148;&#x8981;&#x5728;&#x4EE3;&#x7801;&#x91CC;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x670D;&#x52A1;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x7248;&#x672C;&#x8BFB;&#x53D6;&#x4E0D;&#x540C;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x6700;&#x7EC8;&#x8FBE;&#x5230;&#x4E0D;&#x540C;&#x7248;&#x672C;&#x4E0D;&#x540C;&#x5C55;&#x793A;&#x6548;&#x679C;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-meta\">@Vaule(&quot;{test.a}&quot;)</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">private</span> String testA;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-meta\">@Vaule(&quot;{test.b}&quot;)</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">private</span> String testB;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">getTest</span><span class=\"hljs-params\">(String version)</span> </span>{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-string\">&apos;1.0&apos;</span>.equel(version)){</span><br><span class=\"line\">        System.out.println(testA);</span><br><span class=\"line\">    }<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-string\">&apos;1.1&apos;</span>.equel(version)){</span><br><span class=\"line\">        System.out.println(testB);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x66F4;&#x597D;&#x7684;&#x5904;&#x7406;&#x65B9;&#x6CD5;&#xFF0C;&#x4F46;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#x6211;&#x4EEC;&#x4F1A;&#x50CF;&#x4E0A;&#x9762;&#x5199;&#x4EE3;&#x7801;&#x3002;&#x957F;&#x6B64;&#x4EE5;&#x5F80;&#x53EF;&#x60F3;&#x800C;&#x77E5;&#xFF0C;&#x540E;&#x9762;&#x7684;&#x540C;&#x5B66;&#x4E0D;&#x77E5;&#x9053;&#x4E4B;&#x524D;&#x7684;&#x903B;&#x8F91;&#x5C31;&#x770B;&#x4E0D;&#x61C2;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5728;&#x5199;&#x4EC0;&#x4E48;&#x3002;&#x800C;&#x4E14;&#x6BCF;&#x6B21;&#x6709;&#x7248;&#x672C;&#x7684;&#x53D8;&#x66F4;&#xFF0C;&#x90FD;&#x9700;&#x8981;&#x786C;&#x7F16;&#x7801;&#x3002;</p>\n<p>&#x90A3;&#x6709;&#x6CA1;&#x6709;&#x66F4;&#x4F18;&#x96C5;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x65E2;&#x7136;&#x6211;&#x4EEC;&#x90FD;&#x6709;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x4E86;&#xFF0C;&#x540C;&#x65F6;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x4E5F;&#x90FD;&#x4EA4;&#x7531;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7BA1;&#x7406;&#x4E86;&#xFF0C;&#x914D;&#x7F6E;&#x53D8;&#x66F4;&#x65F6;&#x6211;&#x4EEC;&#x4E5F;&#x80FD;&#x5B9E;&#x65F6;&#x7684;&#x540C;&#x6B65;&#x914D;&#x7F6E;&#x3002;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x80FD;&#x4E0D;&#x80FD;&#x533A;&#x5206;&#x51FA;&#x76F8;&#x540C;&#x670D;&#x52A1;&#x7684;&#x5DEE;&#x5F02;&#x5316;&#x914D;&#x7F6E;&#x5462;&#xFF1F;</p>\n<p>&#x7B54;&#x6848;&#x80AF;&#x5B9A;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;&#x5728;&#x5DF2;&#x670D;&#x52A1;&#x4F5C;&#x4E3A;&#x914D;&#x7F6E;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7EC4;&#x7684;&#x6982;&#x5FF5;&#xFF1A;</p>\n<table>\n<thead>\n<tr>\n<th>Application</th>\n<th>Group</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Service1</td>\n<td>Default</td>\n</tr>\n<tr>\n<td>Service1</td>\n<td>V1.0</td>\n</tr>\n<tr>\n<td>Service1</td>\n<td>V1.1</td>\n</tr>\n<tr>\n<td>Service2</td>\n<td>Default</td>\n</tr>\n</tbody></table>\n<p>&#x540C;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x53EF;&#x4EE5;&#x5212;&#x5206;&#x591A;&#x4E2A;&#x7EC4;&#xFF0C;&#x6BCF;&#x4E2A;&#x7EC4;&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#x5B58;&#x5728;&#x5DEE;&#x5F02;&#x5316;&#xFF0C;&#x76F8;&#x540C;&#x914D;&#x7F6E;&#x7684;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x7EC4;&#x7684;&#x914D;&#x7F6E;&#x3002;</p>\n<p>&#x4EE5;&#x4E0A;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x5212;&#x5206;&#x914D;&#x7F6E;&#x8303;&#x56F4;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x65E2;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x914D;&#x7F6E;&#x7684;&#x5DEE;&#x5F02;&#x5316;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06;&#x5404;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x914D;&#x7F6E;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x8D77;&#x6765;&#x3002;&#x5F53;&#x7136;&#x8FD9;&#x4E2A;&#x914D;&#x7F6E;&#x7684;&#x6A21;&#x578B;&#x8FD8;&#x9700;&#x8981;&#x4E0D;&#x65AD;&#x7684;&#x8FDB;&#x5316;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;&#x6211;&#x4EEC;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x63D0;&#x70BC;&#x51FA;&#x76F8;&#x540C;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;jar&#x5728;&#x6211;&#x4EEC;&#x670D;&#x52A1;&#x4E2D;&#x76F8;&#x4E92;&#x5F15;&#x7528;&#x7684;&#x65B9;&#x5F0F;&#x4E00;&#x6837;&#xFF0C;&#x5728;&#x6211;&#x4EEC;&#x7ED9;&#x4E2A;&#x5E94;&#x7528;&#x4E2D;&#x5171;&#x4EAB;&#x3002;&#x672A;&#x6765;&#x6211;&#x4EEC;&#x4E5F;&#x4F1A;&#x9488;&#x5BF9;&#x7C7B;&#x4F3C;&#x7684;&#x9700;&#x6C42;&#x4E0D;&#x65AD;&#x7684;&#x4F18;&#x5316;&#x3002;</p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Redis","path":"tags/Redis/"},{"name":"é…ç½®ä¸­å¿ƒ","path":"tags/é…ç½®ä¸­å¿ƒ/"}],"excerpt":"<html><head></head><body><h2 id=\"&#x5F00;&#x7BC7;\"><a href=\"#&#x5F00;&#x7BC7;\" class=\"headerlink\" title=\"&#x5F00;&#x7BC7;\"></a>&#x5F00;&#x7BC7;</h2><p>&#x4ECE;&#x8FD9;&#x7BC7;&#x5F00;&#x59CB;&#xFF0C;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x4ECB;&#x7ECD;&#x6574;&#x4E2A;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x548C;&#x67B6;&#x6784;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x4E3B;&#x8981;&#x4F1A;&#x5206;&#x4E3A;&#x4E0B;&#x9762;&#x51E0;&#x4E2A;&#x90E8;&#x5206;&#xFF1A;</p>\n<ol>\n<li>&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;</li>\n<li>&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x6280;&#x672F;&#x9009;&#x578B;</li>\n<li>&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x67B6;&#x6784;&#x90E8;&#x7F72;</li>\n</ol>\n<h2 id=\"&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7ED3;&#x6784;\"><a href=\"#&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7ED3;&#x6784;\" class=\"headerlink\" title=\"&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7ED3;&#x6784;\"></a>&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7ED3;&#x6784;</h2><p>&#x5F00;&#x59CB;&#x8BBE;&#x8BA1;&#x524D;&#x6211;&#x4EEC;&#x5148;&#x5206;&#x6790;&#x4E0B;&#x4E00;&#x4E2A;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x5230;&#x5E95;&#x9700;&#x8981;&#x54EA;&#x4E9B;&#x529F;&#x80FD;&#xFF0C;&#x540C;&#x65F6;&#x5DE5;&#x4F5C;&#x4E2D;&#x6709;&#x54EA;&#x4E9B;&#x75DB;&#x70B9;&#x662F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x6765;&#x89E3;&#x51B3;&#x7684;&#x3002;</p></body></html>","more":"<h4 id=\"1-é…ç½®çš„ç®¡ç†\"><a href=\"#1-é…ç½®çš„ç®¡ç†\" class=\"headerlink\" title=\"1.é…ç½®çš„ç®¡ç†\"></a>1.é…ç½®çš„ç®¡ç†</h4><p>åŸå§‹çš„é…ç½®é¡¹ç®¡ç†å¤§é‡é‡‡ç”¨äº†ä»£ç ç»´æŠ¤çš„æ–¹å¼ï¼Œå¦‚springçš„ymlé…ç½®æ–‡ä»¶ã€ä»£ç ä¸­çš„@Valueæ³¨è§£ã€å„ç§ä¸­é—´ä»¶çš„é…ç½®æ–‡ä»¶ç­‰ã€‚ä¸ä»…ä¸åˆ©äºé…ç½®çš„åŠ¨æ€å˜æ›´ï¼Œæ›´ä¸åˆ©äºç»Ÿä¸€ç®¡ç†é…ç½®ä¿¡æ¯ï¼Œå› æ­¤ç°æœ‰çš„é…ç½®ä¸­å¿ƒè§£å†³æ–¹æ¡ˆä¼šé€šå¸¸ä¼šå°†é…ç½®ä¸­å¿ƒåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚</p>\n<ul>\n<li>å®¢æˆ·ç«¯è´Ÿè´£ä¸šåŠ¡ç³»ç»Ÿçš„é…ç½®æ”¶é›†ä¸å®æ—¶åŒæ­¥ç­‰ã€‚</li>\n<li>æœåŠ¡ç«¯è´Ÿè´£é…ç½®çš„ç»Ÿä¸€ç®¡ç†å’Œå®æ—¶æ›´æ–°ç­‰ã€‚</li>\n</ul>\n<p>ç»“åˆä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡çš„åˆæœŸä¹Ÿä¼šå°†æ•´ä¸ªé…ç½®ä¸­å¿ƒçš„æŠ€æœ¯æ¶æ„åˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸¤éƒ¨åˆ†ã€‚</p>\n<p>å›åˆ°é…ç½®ç®¡ç†çš„è¯é¢˜ä¸Šï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ç‚¹ã€å¦‚ä½•ç®¡ç†é…ç½®ã€‘ã€‚è¿™é‡Œçš„â€œç®¡ç†â€ä¸å•å•åªæ˜¯å°†é…ç½®åœ¨æŸä¸ªé¡µé¢ä¸Šç»™ç”¨æˆ·å±•ç¤ºè€Œå·²ï¼Œè¿˜è¦ç»†åŒ–åˆ°ï¼š</p>\n<ul>\n<li>é…ç½®å¦‚ä½•åˆ’åˆ†èŒƒå›´ï¼Ÿ</li>\n<li>é…ç½®å·®å¼‚åŒ–å¦‚ä½•å¤„ç†ï¼Ÿ</li>\n<li>é…ç½®æƒé™å¦‚ä½•å¤„ç†ï¼Ÿ</li>\n</ul>\n<h6 id=\"é…ç½®å¦‚ä½•åˆ’åˆ†èŒƒå›´ï¼Ÿ\"><a href=\"#é…ç½®å¦‚ä½•åˆ’åˆ†èŒƒå›´ï¼Ÿ\" class=\"headerlink\" title=\"é…ç½®å¦‚ä½•åˆ’åˆ†èŒƒå›´ï¼Ÿ\"></a>é…ç½®å¦‚ä½•åˆ’åˆ†èŒƒå›´ï¼Ÿ</h6><p>å„ä¸ªä¸šåŠ¡æœåŠ¡è¿æ¥åˆ°é…ç½®ä¸­å¿ƒåï¼Œä»–ä»¬éƒ½æœ‰æ€ä¹ˆä¸åŒçš„é…ç½®ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠä»–ä»¬çš„é…ç½®å…¨éƒ¨æ··ä¸ºä¸€è°ˆã€‚ä¸åŒçš„æœåŠ¡çš„é…ç½®æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œå¤šä¸ªç›¸åŒæœåŠ¡å…±äº«åŒä¸€ä¸ªä½œç”¨åŸŸä¸‹çš„é…ç½®ã€‚</p>\n<p>é€šè¿‡æœåŠ¡æ¥åˆ’åˆ†é…ç½®èŒƒå›´æ˜¯ä¸€ä¸ªåŠæ³•ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™å…¶å®ä¹Ÿæ˜¯è¿™ä¹ˆå¤„ç†çš„ã€‚ä½†æ˜¯ä»…ä»…å¦‚æ­¤æ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸€ä¸ªåœºæ™¯ï¼Œä¸šåŠ¡åœºæ™¯ä¸Šæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°AB testï¼Œæˆ‘ä»¬è§£å†³çš„åŠæ³•å¸¸å¸¸æ˜¯é€šè¿‡ç°åº¦å‘å¸ƒæˆ–è“ç»¿å‘ç‰ˆã€‚é€šè¿‡ä¸åŒçš„è§„åˆ™å°†å‰ç«¯æµé‡å¼•å‘ç›¸åŒæœåŠ¡çš„ä¸åŒç‰ˆæœ¬ä»è€Œå®ç°ç”Ÿäº§ä¸Šçš„å·®å¼‚åŒ–ã€‚</p>\n<p>å¦‚æœæˆ‘ä»¬åªæ˜¯ç®€å•çš„é€šè¿‡æœåŠ¡æ¥åˆ’åˆ†é…ç½®ï¼Œä½†é‡åˆ°ä¸Šè¯‰é—®é¢˜çš„æ—¶å€™å¾€å¾€ç—›ç–¼ä¸å·²ã€‚1.0 Veréœ€è¦çœ‹åˆ°Aæ–‡æ¡ˆï¼Œ1.1 Veréœ€è¦çœ‹åˆ°Bæ–‡æ¡ˆã€‚æˆ‘ä»¬å‡è±¡ä¸‹ï¼Œå¦‚æœé€šè¿‡è¿‡å»çš„é…ç½®æ–‡ä»¶æ–¹å¼ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆå¤„ç†ï¼Ÿé¦–å…ˆè¦åœ¨ä»£ç é‡Œåˆ¤æ–­å½“å‰æœåŠ¡çš„ç‰ˆæœ¬ï¼Œç„¶åæ ¹æ®ä¸åŒçš„ç‰ˆæœ¬è¯»å–ä¸åŒçš„é…ç½®ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸åŒç‰ˆæœ¬ä¸åŒå±•ç¤ºæ•ˆæœçš„åŠŸèƒ½ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Vaule(&quot;&#123;test.a&#125;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> String testA;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Vaule(&quot;&#123;test.b&#125;&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> String testB;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getTest</span><span class=\"params\">(String version)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"string\">&#x27;1.0&#x27;</span>.equel(version))&#123;</span><br><span class=\"line\">        System.out.println(testA);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"string\">&#x27;1.1&#x27;</span>.equel(version))&#123;</span><br><span class=\"line\">        System.out.println(testB);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¯èƒ½ä¼šæœ‰æ›´å¥½çš„å¤„ç†æ–¹æ³•ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬ä¼šåƒä¸Šé¢å†™ä»£ç ã€‚é•¿æ­¤ä»¥å¾€å¯æƒ³è€ŒçŸ¥ï¼Œåé¢çš„åŒå­¦ä¸çŸ¥é“ä¹‹å‰çš„é€»è¾‘å°±çœ‹ä¸æ‡‚è¿™æ®µä»£ç åœ¨å†™ä»€ä¹ˆã€‚è€Œä¸”æ¯æ¬¡æœ‰ç‰ˆæœ¬çš„å˜æ›´ï¼Œéƒ½éœ€è¦ç¡¬ç¼–ç ã€‚</p>\n<p>é‚£æœ‰æ²¡æœ‰æ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œæ—¢ç„¶æˆ‘ä»¬éƒ½æœ‰é…ç½®ä¸­å¿ƒäº†ï¼ŒåŒæ—¶æˆ‘ä»¬çš„é…ç½®ä¹Ÿéƒ½äº¤ç”±é…ç½®ä¸­å¿ƒç®¡ç†äº†ï¼Œé…ç½®å˜æ›´æ—¶æˆ‘ä»¬ä¹Ÿèƒ½å®æ—¶çš„åŒæ­¥é…ç½®ã€‚é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½åŒºåˆ†å‡ºç›¸åŒæœåŠ¡çš„å·®å¼‚åŒ–é…ç½®å‘¢ï¼Ÿ</p>\n<p>ç­”æ¡ˆè‚¯å®šæ˜¯å¯ä»¥çš„ã€‚åœ¨å·²æœåŠ¡ä½œä¸ºé…ç½®çš„ä½œç”¨åŸŸä¸‹ï¼Œæˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªç»„çš„æ¦‚å¿µï¼š</p>\n<table>\n<thead>\n<tr>\n<th>Application</th>\n<th>Group</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Service1</td>\n<td>Default</td>\n</tr>\n<tr>\n<td>Service1</td>\n<td>V1.0</td>\n</tr>\n<tr>\n<td>Service1</td>\n<td>V1.1</td>\n</tr>\n<tr>\n<td>Service2</td>\n<td>Default</td>\n</tr>\n</tbody></table>\n<p>åŒä¸€ä¸ªåº”ç”¨å¯ä»¥åˆ’åˆ†å¤šä¸ªç»„ï¼Œæ¯ä¸ªç»„ä¸­çš„é…ç½®å­˜åœ¨å·®å¼‚åŒ–ï¼Œç›¸åŒé…ç½®çš„æœåŠ¡å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªç»„çš„é…ç½®ã€‚</p>\n<p>ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬åˆ’åˆ†é…ç½®èŒƒå›´çš„è¿‡ç¨‹ï¼Œæ—¢å¯ä»¥è§£å†³é…ç½®çš„å·®å¼‚åŒ–ï¼Œä¹Ÿå¯ä»¥å°†å„ä¸ªæœåŠ¡çš„é…ç½®ç»Ÿä¸€ç®¡ç†èµ·æ¥ã€‚å½“ç„¶è¿™ä¸ªé…ç½®çš„æ¨¡å‹è¿˜éœ€è¦ä¸æ–­çš„è¿›åŒ–ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬æ˜¯å¦å¯ä»¥æç‚¼å‡ºç›¸åŒçš„é…ç½®ï¼Œç±»ä¼¼äºjaråœ¨æˆ‘ä»¬æœåŠ¡ä¸­ç›¸äº’å¼•ç”¨çš„æ–¹å¼ä¸€æ ·ï¼Œåœ¨æˆ‘ä»¬ç»™ä¸ªåº”ç”¨ä¸­å…±äº«ã€‚æœªæ¥æˆ‘ä»¬ä¹Ÿä¼šé’ˆå¯¹ç±»ä¼¼çš„éœ€æ±‚ä¸æ–­çš„ä¼˜åŒ–ã€‚</p>"},{"title":"æˆ‘ä¸ºä»€ä¹ˆä¼šæ‰‹æ’¸ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡ï¼ˆäºŒï¼‰","date":"2020-04-11T12:45:24.000Z","_content":"\n## åŸºç¡€åŠŸèƒ½åˆ†æ--é…ç½®ç®¡ç†&ç»´æŠ¤\nä¸Šæ–‡æˆ‘ä»¬åˆ†æäº†é…ç½®åŸŸç®¡ç†ç›¸å…³çš„åŠŸèƒ½ï¼Œè¿™æ¬¡æˆ‘ä»¬è¦åˆ†æä¸‹é…ç½®ä¸­å¿ƒçš„æ ¸å¿ƒåŠŸèƒ½ï¼šé…ç½®æ›´æ–°ã€‚\næˆ‘ä»¬å°†ä»å‡ ä¸ªè§’åº¦åˆ†æé…ç½®æ›´æ–°åŠŸèƒ½ï¼š\n\n* å®¢æˆ·ç«¯é…ç½®æ”¶é›†ä¸æœ¬åœ°ç»´æŠ¤\n* æœåŠ¡ç«¯é…ç½®ç®¡ç†\n* é…ç½®çš„çƒ­æ›´æ–°\n<!-- more -->\n#### å®¢æˆ·ç«¯é…ç½®æ”¶é›†ä¸æœ¬åœ°ç»´æŠ¤\né¦–å…ˆæˆ‘ä»¬æ¥è®¨è®ºä¸‹æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨é…ç½®çš„åœºæ™¯ï¼Œå‰é¢ä¸€ç¯‡æˆ‘ä»¬æåˆ°è¿‡ï¼Œé€šè¿‡springçš„@Valueæˆ‘ä»¬å¯ä»¥æœ¬åœ°çš„ç®¡ç†é…ç½®ã€‚é™¤æ­¤ä»¥ä¸ºæˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°è‡ªèº«çš„é…ç½®ç®¡ç†æœºåˆ¶ï¼Œæœ€å¸¸è§çš„å¦‚æ•°æ®åº“ç®¡ç†å¹¶åŠ è½½ã€KVä¸­é—´ä»¶å­˜å‚¨å¹¶åŠ è½½ã€æœ¬åœ°æ–‡ä»¶å­˜å‚¨å¹¶åŠ è½½ç­‰ã€‚\n\nè€ƒè™‘åˆ°é¡¹ç›®æœ¬èº«å¸Œæœ›æ›´å°‘çš„ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ŒåŒæ—¶èƒ½å¤Ÿå®ç°é…ç½®çš„æ”¶é›†å’Œç®¡ç†ï¼Œspringæä¾›çš„@Valuleä¸å¤±ä¸ºä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚é¦–å…ˆï¼Œspringå®¹å™¨ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨æ”¶é›†å¹¶ç®¡ç†é…ç½®ä¿¡æ¯ï¼›å…¶æ¬¡ï¼Œä¹Ÿæä¾›äº†è‰¯å¥½çš„ç¯å¢ƒé…ç½®éš”ç¦»å’Œæœ¬åœ°é…ç½®ç»´æŠ¤ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè·å–springå®¹å™¨ä¸­ç»´æŠ¤çš„é…ç½®å¯¹è±¡é‚£ä¸å°±èƒ½æ‰‹å·¥å¹²é¢„å®¢æˆ·ç«¯é…ç½®çš„ç»´æŠ¤è¿‡ç¨‹å—ï¼\n\n#### æœåŠ¡ç«¯é…ç½®ç®¡ç†\nç›¸æ¯”å®¢æˆ·ç«¯é…ç½®çš„ç®¡ç†ï¼ŒæœåŠ¡ç«¯å°±å®¹æ˜“å¾ˆå¤šã€‚é€šè¿‡ä¸Šç¯‡çš„åˆ†æï¼Œæˆ‘ä»¬å®Œå…¨èƒ½å¤Ÿæ„å»ºå‡ºè‡ªå·±çš„é…ç½®é¡¹ç»“æ„ï¼Œå¹¶äº¤ç”±DBæŒä¹…åŒ–ä»è€Œè¾¾åˆ°æœåŠ¡ç«¯é…ç½®ç®¡ç†çš„åŠŸèƒ½ã€‚\n\n#### é…ç½®çš„çƒ­æ›´æ–°\næœ‰äº†ä¹‹å‰çš„å®¢æˆ·ç«¯é…ç½®çš„æ”¶é›†å’ŒæœåŠ¡ç«¯é…ç½®ç®¡ç†çš„åˆ†æï¼Œæˆ‘ä»¬è¦å®ç°ä¸€å¥—é…ç½®çš„çƒ­æ›´æ–°çš„æŠ€æœ¯æ–¹å‘å°±éå¸¸æ˜ç¡®äº†ã€‚\n\né¦–å…ˆï¼Œå®¢æˆ·ç«¯å¯åŠ¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä»è¿œç¨‹æœåŠ¡ç«¯æ‹‰å–åˆ°æœ€æ–°çš„é…ç½®ï¼Œå¦‚æœæ‹‰å–ä¸åˆ°åˆ™ä½¿ç”¨æœ¬åœ°é»˜è®¤çš„ã€‚\n\n![01](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/å®¢æˆ·ç«¯å¯åŠ¨å¹¶æ›´æ–°é…ç½®.png)\n\n\nå…¶æ¬¡ï¼Œä¸ºäº†å®ç°çƒ­æ›´æ–°ã€‚æ¯å½“æœåŠ¡ç«¯å¯¹é…ç½®è¿›è¡Œå˜æ›´åï¼Œéœ€è¦å®æ—¶é€šçŸ¥ç›¸åº”çš„å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯è¦åŒæ—¶æ›´æ–°æœ€æ–°çš„é…ç½®ã€‚\n\n![02](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/æœåŠ¡ç«¯çƒ­æ›´æ–°é…ç½®.png)\n\n\n## å…¶ä»–\nä»¥ä¸ŠåŠŸèƒ½ä¿è¯äº†æˆ‘ä»¬çš„é…ç½®ä¸­å¿ƒæœ€åŸºæœ¬çš„é…ç½®ç®¡ç†åŠŸèƒ½çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚ä½†å›´ç»•æ•´ä¸ªé…ç½®ä¸­å¿ƒï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–åŠŸèƒ½éœ€è¦åˆ†æï¼Œå¦‚é…ç½®çš„æƒé™ã€ç”¨æˆ·çš„ç®¡ç†ç­‰ã€‚æ¥ä¸‹æ¥çš„åšå®¢ä¸­ï¼Œæˆ‘ä»¬è®²ä¼šè®¨è®ºå®ç°ä¸€ä¸ªå®Œæ•´çš„é…ç½®ä¸­å¿ƒï¼Œæˆ‘ä»¬è‡³å°‘è¿˜éœ€è¦å“ªäº›åŠŸèƒ½ã€‚æœ€åå›´ç»•è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªé‡è¦ç¯‡ç« ï¼šé€‰å‹ç¯‡ã€‚\n\nå…ˆåšä¸€ä¸ªé¢„å‘Šï¼Œåé¢çš„æ›´æ–°æˆ‘ä»¬ä¼šå›´ç»•ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½å»å±•å¼€ï¼š\n* é€‰å‹\n* åŠŸèƒ½å®ç°ä¸æºç \n* ä¸å…¶ä»–é…ç½®ä¸­å¿ƒçš„æ¯”è¾ƒ\n* æœªæ¥çš„ä¼˜åŒ–ä¸å±•æœ›\n","source":"_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2.md","raw":"---\ntitle: æˆ‘ä¸ºä»€ä¹ˆä¼šæ‰‹æ’¸ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡ï¼ˆäºŒï¼‰\ndate: 2020-04-11 20:45:24\ntags: \n    - Java\n    - Redis\n    - é…ç½®ä¸­å¿ƒ\ncategories :\n    - Technology\n---\n\n## åŸºç¡€åŠŸèƒ½åˆ†æ--é…ç½®ç®¡ç†&ç»´æŠ¤\nä¸Šæ–‡æˆ‘ä»¬åˆ†æäº†é…ç½®åŸŸç®¡ç†ç›¸å…³çš„åŠŸèƒ½ï¼Œè¿™æ¬¡æˆ‘ä»¬è¦åˆ†æä¸‹é…ç½®ä¸­å¿ƒçš„æ ¸å¿ƒåŠŸèƒ½ï¼šé…ç½®æ›´æ–°ã€‚\næˆ‘ä»¬å°†ä»å‡ ä¸ªè§’åº¦åˆ†æé…ç½®æ›´æ–°åŠŸèƒ½ï¼š\n\n* å®¢æˆ·ç«¯é…ç½®æ”¶é›†ä¸æœ¬åœ°ç»´æŠ¤\n* æœåŠ¡ç«¯é…ç½®ç®¡ç†\n* é…ç½®çš„çƒ­æ›´æ–°\n<!-- more -->\n#### å®¢æˆ·ç«¯é…ç½®æ”¶é›†ä¸æœ¬åœ°ç»´æŠ¤\né¦–å…ˆæˆ‘ä»¬æ¥è®¨è®ºä¸‹æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨é…ç½®çš„åœºæ™¯ï¼Œå‰é¢ä¸€ç¯‡æˆ‘ä»¬æåˆ°è¿‡ï¼Œé€šè¿‡springçš„@Valueæˆ‘ä»¬å¯ä»¥æœ¬åœ°çš„ç®¡ç†é…ç½®ã€‚é™¤æ­¤ä»¥ä¸ºæˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°è‡ªèº«çš„é…ç½®ç®¡ç†æœºåˆ¶ï¼Œæœ€å¸¸è§çš„å¦‚æ•°æ®åº“ç®¡ç†å¹¶åŠ è½½ã€KVä¸­é—´ä»¶å­˜å‚¨å¹¶åŠ è½½ã€æœ¬åœ°æ–‡ä»¶å­˜å‚¨å¹¶åŠ è½½ç­‰ã€‚\n\nè€ƒè™‘åˆ°é¡¹ç›®æœ¬èº«å¸Œæœ›æ›´å°‘çš„ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ŒåŒæ—¶èƒ½å¤Ÿå®ç°é…ç½®çš„æ”¶é›†å’Œç®¡ç†ï¼Œspringæä¾›çš„@Valuleä¸å¤±ä¸ºä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚é¦–å…ˆï¼Œspringå®¹å™¨ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨æ”¶é›†å¹¶ç®¡ç†é…ç½®ä¿¡æ¯ï¼›å…¶æ¬¡ï¼Œä¹Ÿæä¾›äº†è‰¯å¥½çš„ç¯å¢ƒé…ç½®éš”ç¦»å’Œæœ¬åœ°é…ç½®ç»´æŠ¤ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè·å–springå®¹å™¨ä¸­ç»´æŠ¤çš„é…ç½®å¯¹è±¡é‚£ä¸å°±èƒ½æ‰‹å·¥å¹²é¢„å®¢æˆ·ç«¯é…ç½®çš„ç»´æŠ¤è¿‡ç¨‹å—ï¼\n\n#### æœåŠ¡ç«¯é…ç½®ç®¡ç†\nç›¸æ¯”å®¢æˆ·ç«¯é…ç½®çš„ç®¡ç†ï¼ŒæœåŠ¡ç«¯å°±å®¹æ˜“å¾ˆå¤šã€‚é€šè¿‡ä¸Šç¯‡çš„åˆ†æï¼Œæˆ‘ä»¬å®Œå…¨èƒ½å¤Ÿæ„å»ºå‡ºè‡ªå·±çš„é…ç½®é¡¹ç»“æ„ï¼Œå¹¶äº¤ç”±DBæŒä¹…åŒ–ä»è€Œè¾¾åˆ°æœåŠ¡ç«¯é…ç½®ç®¡ç†çš„åŠŸèƒ½ã€‚\n\n#### é…ç½®çš„çƒ­æ›´æ–°\næœ‰äº†ä¹‹å‰çš„å®¢æˆ·ç«¯é…ç½®çš„æ”¶é›†å’ŒæœåŠ¡ç«¯é…ç½®ç®¡ç†çš„åˆ†æï¼Œæˆ‘ä»¬è¦å®ç°ä¸€å¥—é…ç½®çš„çƒ­æ›´æ–°çš„æŠ€æœ¯æ–¹å‘å°±éå¸¸æ˜ç¡®äº†ã€‚\n\né¦–å…ˆï¼Œå®¢æˆ·ç«¯å¯åŠ¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä»è¿œç¨‹æœåŠ¡ç«¯æ‹‰å–åˆ°æœ€æ–°çš„é…ç½®ï¼Œå¦‚æœæ‹‰å–ä¸åˆ°åˆ™ä½¿ç”¨æœ¬åœ°é»˜è®¤çš„ã€‚\n\n![01](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/å®¢æˆ·ç«¯å¯åŠ¨å¹¶æ›´æ–°é…ç½®.png)\n\n\nå…¶æ¬¡ï¼Œä¸ºäº†å®ç°çƒ­æ›´æ–°ã€‚æ¯å½“æœåŠ¡ç«¯å¯¹é…ç½®è¿›è¡Œå˜æ›´åï¼Œéœ€è¦å®æ—¶é€šçŸ¥ç›¸åº”çš„å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯è¦åŒæ—¶æ›´æ–°æœ€æ–°çš„é…ç½®ã€‚\n\n![02](æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/æœåŠ¡ç«¯çƒ­æ›´æ–°é…ç½®.png)\n\n\n## å…¶ä»–\nä»¥ä¸ŠåŠŸèƒ½ä¿è¯äº†æˆ‘ä»¬çš„é…ç½®ä¸­å¿ƒæœ€åŸºæœ¬çš„é…ç½®ç®¡ç†åŠŸèƒ½çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚ä½†å›´ç»•æ•´ä¸ªé…ç½®ä¸­å¿ƒï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–åŠŸèƒ½éœ€è¦åˆ†æï¼Œå¦‚é…ç½®çš„æƒé™ã€ç”¨æˆ·çš„ç®¡ç†ç­‰ã€‚æ¥ä¸‹æ¥çš„åšå®¢ä¸­ï¼Œæˆ‘ä»¬è®²ä¼šè®¨è®ºå®ç°ä¸€ä¸ªå®Œæ•´çš„é…ç½®ä¸­å¿ƒï¼Œæˆ‘ä»¬è‡³å°‘è¿˜éœ€è¦å“ªäº›åŠŸèƒ½ã€‚æœ€åå›´ç»•è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªé‡è¦ç¯‡ç« ï¼šé€‰å‹ç¯‡ã€‚\n\nå…ˆåšä¸€ä¸ªé¢„å‘Šï¼Œåé¢çš„æ›´æ–°æˆ‘ä»¬ä¼šå›´ç»•ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½å»å±•å¼€ï¼š\n* é€‰å‹\n* åŠŸèƒ½å®ç°ä¸æºç \n* ä¸å…¶ä»–é…ç½®ä¸­å¿ƒçš„æ¯”è¾ƒ\n* æœªæ¥çš„ä¼˜åŒ–ä¸å±•æœ›\n","slug":"æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2","published":1,"updated":"2020-12-14T10:34:34.801Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htm0018v252039k1qwo","content":"<html><head></head><body><h2 id=\"&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7BA1;&#x7406;-amp-&#x7EF4;&#x62A4;\"><a href=\"#&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7BA1;&#x7406;-amp-&#x7EF4;&#x62A4;\" class=\"headerlink\" title=\"&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&amp;&#x7EF4;&#x62A4;\"></a>&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&amp;&#x7EF4;&#x62A4;</h2><p>&#x4E0A;&#x6587;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x4E86;&#x914D;&#x7F6E;&#x57DF;&#x7BA1;&#x7406;&#x76F8;&#x5173;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x8981;&#x5206;&#x6790;&#x4E0B;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x6838;&#x5FC3;&#x529F;&#x80FD;&#xFF1A;&#x914D;&#x7F6E;&#x66F4;&#x65B0;&#x3002;<br>&#x6211;&#x4EEC;&#x5C06;&#x4ECE;&#x51E0;&#x4E2A;&#x89D2;&#x5EA6;&#x5206;&#x6790;&#x914D;&#x7F6E;&#x66F4;&#x65B0;&#x529F;&#x80FD;&#xFF1A;</p>\n<ul>\n<li>&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x6536;&#x96C6;&#x4E0E;&#x672C;&#x5730;&#x7EF4;&#x62A4;</li>\n<li>&#x670D;&#x52A1;&#x7AEF;&#x914D;&#x7F6E;&#x7BA1;&#x7406;</li>\n<li>&#x914D;&#x7F6E;&#x7684;&#x70ED;&#x66F4;&#x65B0;<a id=\"more\"></a>\n<h4 id=\"&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x6536;&#x96C6;&#x4E0E;&#x672C;&#x5730;&#x7EF4;&#x62A4;\"><a href=\"#&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x6536;&#x96C6;&#x4E0E;&#x672C;&#x5730;&#x7EF4;&#x62A4;\" class=\"headerlink\" title=\"&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x6536;&#x96C6;&#x4E0E;&#x672C;&#x5730;&#x7EF4;&#x62A4;\"></a>&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x6536;&#x96C6;&#x4E0E;&#x672C;&#x5730;&#x7EF4;&#x62A4;</h4>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x6765;&#x8BA8;&#x8BBA;&#x4E0B;&#x6211;&#x4EEC;&#x5E73;&#x65F6;&#x4F7F;&#x7528;&#x914D;&#x7F6E;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x524D;&#x9762;&#x4E00;&#x7BC7;&#x6211;&#x4EEC;&#x63D0;&#x5230;&#x8FC7;&#xFF0C;&#x901A;&#x8FC7;spring&#x7684;@Value&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x672C;&#x5730;&#x7684;&#x7BA1;&#x7406;&#x914D;&#x7F6E;&#x3002;&#x9664;&#x6B64;&#x4EE5;&#x4E3A;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x81EA;&#x8EAB;&#x7684;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x673A;&#x5236;&#xFF0C;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x5982;&#x6570;&#x636E;&#x5E93;&#x7BA1;&#x7406;&#x5E76;&#x52A0;&#x8F7D;&#x3001;KV&#x4E2D;&#x95F4;&#x4EF6;&#x5B58;&#x50A8;&#x5E76;&#x52A0;&#x8F7D;&#x3001;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x5B58;&#x50A8;&#x5E76;&#x52A0;&#x8F7D;&#x7B49;&#x3002;</li>\n</ul>\n<p>&#x8003;&#x8651;&#x5230;&#x9879;&#x76EE;&#x672C;&#x8EAB;&#x5E0C;&#x671B;&#x66F4;&#x5C11;&#x7684;&#x4F9D;&#x8D56;&#x7B2C;&#x4E09;&#x65B9;&#x670D;&#x52A1;&#xFF0C;&#x540C;&#x65F6;&#x80FD;&#x591F;&#x5B9E;&#x73B0;&#x914D;&#x7F6E;&#x7684;&#x6536;&#x96C6;&#x548C;&#x7BA1;&#x7406;&#xFF0C;spring&#x63D0;&#x4F9B;&#x7684;@Valule&#x4E0D;&#x5931;&#x4E3A;&#x4E00;&#x4E2A;&#x4E0D;&#x9519;&#x7684;&#x9009;&#x62E9;&#x3002;&#x9996;&#x5148;&#xFF0C;spring&#x5BB9;&#x5668;&#x4F1A;&#x4E3A;&#x6211;&#x4EEC;&#x81EA;&#x52A8;&#x6536;&#x96C6;&#x5E76;&#x7BA1;&#x7406;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF1B;&#x5176;&#x6B21;&#xFF0C;&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x826F;&#x597D;&#x7684;&#x73AF;&#x5883;&#x914D;&#x7F6E;&#x9694;&#x79BB;&#x548C;&#x672C;&#x5730;&#x914D;&#x7F6E;&#x7EF4;&#x62A4;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x83B7;&#x53D6;spring&#x5BB9;&#x5668;&#x4E2D;&#x7EF4;&#x62A4;&#x7684;&#x914D;&#x7F6E;&#x5BF9;&#x8C61;&#x90A3;&#x4E0D;&#x5C31;&#x80FD;&#x624B;&#x5DE5;&#x5E72;&#x9884;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x7684;&#x7EF4;&#x62A4;&#x8FC7;&#x7A0B;&#x5417;&#xFF01;</p>\n<h4 id=\"&#x670D;&#x52A1;&#x7AEF;&#x914D;&#x7F6E;&#x7BA1;&#x7406;\"><a href=\"#&#x670D;&#x52A1;&#x7AEF;&#x914D;&#x7F6E;&#x7BA1;&#x7406;\" class=\"headerlink\" title=\"&#x670D;&#x52A1;&#x7AEF;&#x914D;&#x7F6E;&#x7BA1;&#x7406;\"></a>&#x670D;&#x52A1;&#x7AEF;&#x914D;&#x7F6E;&#x7BA1;&#x7406;</h4><p>&#x76F8;&#x6BD4;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x7684;&#x7BA1;&#x7406;&#xFF0C;&#x670D;&#x52A1;&#x7AEF;&#x5C31;&#x5BB9;&#x6613;&#x5F88;&#x591A;&#x3002;&#x901A;&#x8FC7;&#x4E0A;&#x7BC7;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x4EEC;&#x5B8C;&#x5168;&#x80FD;&#x591F;&#x6784;&#x5EFA;&#x51FA;&#x81EA;&#x5DF1;&#x7684;&#x914D;&#x7F6E;&#x9879;&#x7ED3;&#x6784;&#xFF0C;&#x5E76;&#x4EA4;&#x7531;DB&#x6301;&#x4E45;&#x5316;&#x4ECE;&#x800C;&#x8FBE;&#x5230;&#x670D;&#x52A1;&#x7AEF;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<h4 id=\"&#x914D;&#x7F6E;&#x7684;&#x70ED;&#x66F4;&#x65B0;\"><a href=\"#&#x914D;&#x7F6E;&#x7684;&#x70ED;&#x66F4;&#x65B0;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;&#x7684;&#x70ED;&#x66F4;&#x65B0;\"></a>&#x914D;&#x7F6E;&#x7684;&#x70ED;&#x66F4;&#x65B0;</h4><p>&#x6709;&#x4E86;&#x4E4B;&#x524D;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x7684;&#x6536;&#x96C6;&#x548C;&#x670D;&#x52A1;&#x7AEF;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;&#x4E00;&#x5957;&#x914D;&#x7F6E;&#x7684;&#x70ED;&#x66F4;&#x65B0;&#x7684;&#x6280;&#x672F;&#x65B9;&#x5411;&#x5C31;&#x975E;&#x5E38;&#x660E;&#x786E;&#x4E86;&#x3002;</p>\n<p>&#x9996;&#x5148;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4ECE;&#x8FDC;&#x7A0B;&#x670D;&#x52A1;&#x7AEF;&#x62C9;&#x53D6;&#x5230;&#x6700;&#x65B0;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5982;&#x679C;&#x62C9;&#x53D6;&#x4E0D;&#x5230;&#x5219;&#x4F7F;&#x7528;&#x672C;&#x5730;&#x9ED8;&#x8BA4;&#x7684;&#x3002;</p>\n<p><img src=\"/2020/04/11/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E8%AE%BE%E8%AE%A1%E7%AF%872/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%90%AF%E5%8A%A8%E5%B9%B6%E6%9B%B4%E6%96%B0%E9%85%8D%E7%BD%AE.png\" alt=\"01\"></p>\n<p>&#x5176;&#x6B21;&#xFF0C;&#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x70ED;&#x66F4;&#x65B0;&#x3002;&#x6BCF;&#x5F53;&#x670D;&#x52A1;&#x7AEF;&#x5BF9;&#x914D;&#x7F6E;&#x8FDB;&#x884C;&#x53D8;&#x66F4;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x5B9E;&#x65F6;&#x901A;&#x77E5;&#x76F8;&#x5E94;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#xFF0C;&#x5E76;&#x4E14;&#x5BA2;&#x6237;&#x7AEF;&#x8981;&#x540C;&#x65F6;&#x66F4;&#x65B0;&#x6700;&#x65B0;&#x7684;&#x914D;&#x7F6E;&#x3002;</p>\n<p><img src=\"/2020/04/11/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E8%AE%BE%E8%AE%A1%E7%AF%872/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%83%AD%E6%9B%B4%E6%96%B0%E9%85%8D%E7%BD%AE.png\" alt=\"02\"></p>\n<h2 id=\"&#x5176;&#x4ED6;\"><a href=\"#&#x5176;&#x4ED6;\" class=\"headerlink\" title=\"&#x5176;&#x4ED6;\"></a>&#x5176;&#x4ED6;</h2><p>&#x4EE5;&#x4E0A;&#x529F;&#x80FD;&#x4FDD;&#x8BC1;&#x4E86;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x6700;&#x57FA;&#x672C;&#x7684;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x529F;&#x80FD;&#x7684;&#x6574;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x3002;&#x4F46;&#x56F4;&#x7ED5;&#x6574;&#x4E2A;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#xFF0C;&#x8FD8;&#x6709;&#x8BB8;&#x591A;&#x5176;&#x4ED6;&#x529F;&#x80FD;&#x9700;&#x8981;&#x5206;&#x6790;&#xFF0C;&#x5982;&#x914D;&#x7F6E;&#x7684;&#x6743;&#x9650;&#x3001;&#x7528;&#x6237;&#x7684;&#x7BA1;&#x7406;&#x7B49;&#x3002;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x535A;&#x5BA2;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8BB2;&#x4F1A;&#x8BA8;&#x8BBA;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#xFF0C;&#x6211;&#x4EEC;&#x81F3;&#x5C11;&#x8FD8;&#x9700;&#x8981;&#x54EA;&#x4E9B;&#x529F;&#x80FD;&#x3002;&#x6700;&#x540E;&#x56F4;&#x7ED5;&#x8FD9;&#x4E9B;&#x529F;&#x80FD;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x8FDB;&#x5165;&#x4E0B;&#x4E00;&#x4E2A;&#x91CD;&#x8981;&#x7BC7;&#x7AE0;&#xFF1A;&#x9009;&#x578B;&#x7BC7;&#x3002;</p>\n<p>&#x5148;&#x505A;&#x4E00;&#x4E2A;&#x9884;&#x544A;&#xFF0C;&#x540E;&#x9762;&#x7684;&#x66F4;&#x65B0;&#x6211;&#x4EEC;&#x4F1A;&#x56F4;&#x7ED5;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x529F;&#x80FD;&#x53BB;&#x5C55;&#x5F00;&#xFF1A;</p>\n<ul>\n<li>&#x9009;&#x578B;</li>\n<li>&#x529F;&#x80FD;&#x5B9E;&#x73B0;&#x4E0E;&#x6E90;&#x7801;</li>\n<li>&#x4E0E;&#x5176;&#x4ED6;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x6BD4;&#x8F83;</li>\n<li>&#x672A;&#x6765;&#x7684;&#x4F18;&#x5316;&#x4E0E;&#x5C55;&#x671B;</li>\n</ul>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Redis","path":"tags/Redis/"},{"name":"é…ç½®ä¸­å¿ƒ","path":"tags/é…ç½®ä¸­å¿ƒ/"}],"excerpt":"<html><head></head><body><h2 id=\"&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7BA1;&#x7406;-amp-&#x7EF4;&#x62A4;\"><a href=\"#&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7BA1;&#x7406;-amp-&#x7EF4;&#x62A4;\" class=\"headerlink\" title=\"&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&amp;&#x7EF4;&#x62A4;\"></a>&#x57FA;&#x7840;&#x529F;&#x80FD;&#x5206;&#x6790;&#x2013;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&amp;&#x7EF4;&#x62A4;</h2><p>&#x4E0A;&#x6587;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x4E86;&#x914D;&#x7F6E;&#x57DF;&#x7BA1;&#x7406;&#x76F8;&#x5173;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x8981;&#x5206;&#x6790;&#x4E0B;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x6838;&#x5FC3;&#x529F;&#x80FD;&#xFF1A;&#x914D;&#x7F6E;&#x66F4;&#x65B0;&#x3002;<br>&#x6211;&#x4EEC;&#x5C06;&#x4ECE;&#x51E0;&#x4E2A;&#x89D2;&#x5EA6;&#x5206;&#x6790;&#x914D;&#x7F6E;&#x66F4;&#x65B0;&#x529F;&#x80FD;&#xFF1A;</p>\n<ul>\n<li>&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x6536;&#x96C6;&#x4E0E;&#x672C;&#x5730;&#x7EF4;&#x62A4;</li>\n<li>&#x670D;&#x52A1;&#x7AEF;&#x914D;&#x7F6E;&#x7BA1;&#x7406;</li>\n<li>&#x914D;&#x7F6E;&#x7684;&#x70ED;&#x66F4;&#x65B0;</li></ul></body></html>","more":"<h4 id=\"å®¢æˆ·ç«¯é…ç½®æ”¶é›†ä¸æœ¬åœ°ç»´æŠ¤\"><a href=\"#å®¢æˆ·ç«¯é…ç½®æ”¶é›†ä¸æœ¬åœ°ç»´æŠ¤\" class=\"headerlink\" title=\"å®¢æˆ·ç«¯é…ç½®æ”¶é›†ä¸æœ¬åœ°ç»´æŠ¤\"></a>å®¢æˆ·ç«¯é…ç½®æ”¶é›†ä¸æœ¬åœ°ç»´æŠ¤</h4>é¦–å…ˆæˆ‘ä»¬æ¥è®¨è®ºä¸‹æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨é…ç½®çš„åœºæ™¯ï¼Œå‰é¢ä¸€ç¯‡æˆ‘ä»¬æåˆ°è¿‡ï¼Œé€šè¿‡springçš„@Valueæˆ‘ä»¬å¯ä»¥æœ¬åœ°çš„ç®¡ç†é…ç½®ã€‚é™¤æ­¤ä»¥ä¸ºæˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°è‡ªèº«çš„é…ç½®ç®¡ç†æœºåˆ¶ï¼Œæœ€å¸¸è§çš„å¦‚æ•°æ®åº“ç®¡ç†å¹¶åŠ è½½ã€KVä¸­é—´ä»¶å­˜å‚¨å¹¶åŠ è½½ã€æœ¬åœ°æ–‡ä»¶å­˜å‚¨å¹¶åŠ è½½ç­‰ã€‚\n\n<p>è€ƒè™‘åˆ°é¡¹ç›®æœ¬èº«å¸Œæœ›æ›´å°‘çš„ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ŒåŒæ—¶èƒ½å¤Ÿå®ç°é…ç½®çš„æ”¶é›†å’Œç®¡ç†ï¼Œspringæä¾›çš„@Valuleä¸å¤±ä¸ºä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚é¦–å…ˆï¼Œspringå®¹å™¨ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨æ”¶é›†å¹¶ç®¡ç†é…ç½®ä¿¡æ¯ï¼›å…¶æ¬¡ï¼Œä¹Ÿæä¾›äº†è‰¯å¥½çš„ç¯å¢ƒé…ç½®éš”ç¦»å’Œæœ¬åœ°é…ç½®ç»´æŠ¤ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè·å–springå®¹å™¨ä¸­ç»´æŠ¤çš„é…ç½®å¯¹è±¡é‚£ä¸å°±èƒ½æ‰‹å·¥å¹²é¢„å®¢æˆ·ç«¯é…ç½®çš„ç»´æŠ¤è¿‡ç¨‹å—ï¼</p>\n<h4 id=\"æœåŠ¡ç«¯é…ç½®ç®¡ç†\"><a href=\"#æœåŠ¡ç«¯é…ç½®ç®¡ç†\" class=\"headerlink\" title=\"æœåŠ¡ç«¯é…ç½®ç®¡ç†\"></a>æœåŠ¡ç«¯é…ç½®ç®¡ç†</h4><p>ç›¸æ¯”å®¢æˆ·ç«¯é…ç½®çš„ç®¡ç†ï¼ŒæœåŠ¡ç«¯å°±å®¹æ˜“å¾ˆå¤šã€‚é€šè¿‡ä¸Šç¯‡çš„åˆ†æï¼Œæˆ‘ä»¬å®Œå…¨èƒ½å¤Ÿæ„å»ºå‡ºè‡ªå·±çš„é…ç½®é¡¹ç»“æ„ï¼Œå¹¶äº¤ç”±DBæŒä¹…åŒ–ä»è€Œè¾¾åˆ°æœåŠ¡ç«¯é…ç½®ç®¡ç†çš„åŠŸèƒ½ã€‚</p>\n<h4 id=\"é…ç½®çš„çƒ­æ›´æ–°\"><a href=\"#é…ç½®çš„çƒ­æ›´æ–°\" class=\"headerlink\" title=\"é…ç½®çš„çƒ­æ›´æ–°\"></a>é…ç½®çš„çƒ­æ›´æ–°</h4><p>æœ‰äº†ä¹‹å‰çš„å®¢æˆ·ç«¯é…ç½®çš„æ”¶é›†å’ŒæœåŠ¡ç«¯é…ç½®ç®¡ç†çš„åˆ†æï¼Œæˆ‘ä»¬è¦å®ç°ä¸€å¥—é…ç½®çš„çƒ­æ›´æ–°çš„æŠ€æœ¯æ–¹å‘å°±éå¸¸æ˜ç¡®äº†ã€‚</p>\n<p>é¦–å…ˆï¼Œå®¢æˆ·ç«¯å¯åŠ¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä»è¿œç¨‹æœåŠ¡ç«¯æ‹‰å–åˆ°æœ€æ–°çš„é…ç½®ï¼Œå¦‚æœæ‹‰å–ä¸åˆ°åˆ™ä½¿ç”¨æœ¬åœ°é»˜è®¤çš„ã€‚</p>\n<p><img src=\"/2020/04/11/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E8%AE%BE%E8%AE%A1%E7%AF%872/%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%90%AF%E5%8A%A8%E5%B9%B6%E6%9B%B4%E6%96%B0%E9%85%8D%E7%BD%AE.png\" alt=\"01\"></p>\n<p>å…¶æ¬¡ï¼Œä¸ºäº†å®ç°çƒ­æ›´æ–°ã€‚æ¯å½“æœåŠ¡ç«¯å¯¹é…ç½®è¿›è¡Œå˜æ›´åï¼Œéœ€è¦å®æ—¶é€šçŸ¥ç›¸åº”çš„å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯è¦åŒæ—¶æ›´æ–°æœ€æ–°çš„é…ç½®ã€‚</p>\n<p><img src=\"/2020/04/11/%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E9%87%8D%E6%96%B0%E5%86%99%E4%B8%80%E4%B8%AA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-%E8%AE%BE%E8%AE%A1%E7%AF%872/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%83%AD%E6%9B%B4%E6%96%B0%E9%85%8D%E7%BD%AE.png\" alt=\"02\"></p>\n<h2 id=\"å…¶ä»–\"><a href=\"#å…¶ä»–\" class=\"headerlink\" title=\"å…¶ä»–\"></a>å…¶ä»–</h2><p>ä»¥ä¸ŠåŠŸèƒ½ä¿è¯äº†æˆ‘ä»¬çš„é…ç½®ä¸­å¿ƒæœ€åŸºæœ¬çš„é…ç½®ç®¡ç†åŠŸèƒ½çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚ä½†å›´ç»•æ•´ä¸ªé…ç½®ä¸­å¿ƒï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–åŠŸèƒ½éœ€è¦åˆ†æï¼Œå¦‚é…ç½®çš„æƒé™ã€ç”¨æˆ·çš„ç®¡ç†ç­‰ã€‚æ¥ä¸‹æ¥çš„åšå®¢ä¸­ï¼Œæˆ‘ä»¬è®²ä¼šè®¨è®ºå®ç°ä¸€ä¸ªå®Œæ•´çš„é…ç½®ä¸­å¿ƒï¼Œæˆ‘ä»¬è‡³å°‘è¿˜éœ€è¦å“ªäº›åŠŸèƒ½ã€‚æœ€åå›´ç»•è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªé‡è¦ç¯‡ç« ï¼šé€‰å‹ç¯‡ã€‚</p>\n<p>å…ˆåšä¸€ä¸ªé¢„å‘Šï¼Œåé¢çš„æ›´æ–°æˆ‘ä»¬ä¼šå›´ç»•ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½å»å±•å¼€ï¼š</p>\n<ul>\n<li>é€‰å‹</li>\n<li>åŠŸèƒ½å®ç°ä¸æºç </li>\n<li>ä¸å…¶ä»–é…ç½®ä¸­å¿ƒçš„æ¯”è¾ƒ</li>\n<li>æœªæ¥çš„ä¼˜åŒ–ä¸å±•æœ›</li>\n</ul>"},{"title":"æˆ‘ä¸ºä»€ä¹ˆä¼šæ‰‹æ’¸ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡ï¼ˆä¸‰ï¼‰","date":"2020-04-12T06:29:58.000Z","_content":"\n## åŠŸèƒ½&æ¶æ„é€‰å‹\nåœ¨åšå…·ä½“çš„æ¶æ„é€‰å‹å‰ï¼Œå…ˆè¦æ˜ç¡®ä¸¤ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬çš„æŠ€æœ¯æ ˆæ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬æ˜¯ä¸ºæ€æ ·çš„æŠ€æœ¯å›¢é˜Ÿæä¾›æœåŠ¡çš„ã€‚\n\n#### é€‰å‹å‰çš„è®¨è®º\nå½“å‰å…¬å¸åç«¯å›¢é˜Ÿå¤§é‡çš„é‡‡ç”¨äº†JAVAçš„æŠ€æœ¯æ ˆï¼Œéšç€å…¬å¸çš„å‘å±•å›´ç»•ç€Spring Cloudå…¨å®¶æ¡¶ï¼Œå›¢é˜Ÿå·²ç»æ­å»ºäº†ç›¸å½“å¤šçš„ä¸šåŠ¡æœåŠ¡ã€‚å¯ä»¥è¯´æˆ‘ä»¬è®¾è®¡çš„é…åˆä¸­å¿ƒæœåŠ¡åœ¨æœ€å¤§é™åº¦ä¸Šä¼šä»¥JAVAä¸ºåŸºç¡€ï¼Œå›´ç»•ç€Springçš„ç”Ÿæ€åœˆè¿›è¡Œè®¾è®¡å¹¶å¼€å‘ã€‚\n\né‚£ä¹ˆå›åˆ°æˆ‘ä»¬ä¹‹å‰çš„æ¶æ„é€‰å‹è¯é¢˜ï¼Œå¯ä»¥å°†é—®é¢˜æ”¹ä¸ºï¼šå¦‚ä½•å›´ç»•Springçš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ç°ä¸€å¥—é…ç½®çµæ´»ã€ç®¡ç†ç®€æ´ã€å€¼çƒ­æ›´æ–°çš„ç³»ç»Ÿã€‚\n<!-- more -->\nç¡®å®šæˆ‘ä»¬å¿…é¡»ç»“åˆSpringåï¼Œæ¥ä¸‹æ¥éœ€è¦æ˜ç¡®çš„å°±æ˜¯ï¼Œå¦‚ä½•å®ç°é…ç½®çš„çƒ­æ›´æ–°ã€‚ç›®å‰å¼€æºçš„é…ç½®ä¸­å¿ƒæœ‰è¿™ä¹ˆå‡ ç§è§£å†³æ–¹æ¡ˆï¼š\n\næ–¹å¼|ä¸­é—´ä»¶|ä¼˜ç‚¹|ç¼ºç‚¹\n|---|---|---|---|\n|æœåŠ¡ç«¯è°ƒç”¨å®¢æˆ·ç«¯Apiè¿›è¡Œæ¨é€|æ— éœ€|å®ç°ç®€å•<br>æ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶|ä¾èµ–Httpè¯·æ±‚è¿‡äºé‡<br>è‡ªå®šä¹‰åè®®å¼€å‘å¤æ‚<br>éœ€è¦è‡ªå·±ä¿è¯è¯·æ±‚çš„å¯é æ€§ |\n|å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯Apiè¿›è¡Œæ‹‰å–|æ— éœ€|å®ç°ç®€å•<br>æ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶|ä¾èµ–Httpè¯·æ±‚è¿‡äºé‡<br>è‡ªå®šä¹‰åè®®å¼€å‘å¤æ‚<br>éœ€è¦è‡ªå·±ä¿è¯è¯·æ±‚çš„å¯é æ€§ |\n|ä¾èµ–ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶æ¨é€|Zookeeperã€Redisã€Nascoç­‰|å¼€å‘ç®€å•ã€ä¸éœ€è¦è‡ªå·±å®ç°é€šè®¯<br>å¯ä¾èµ–ä¸­é—´ä»¶è‡ªèº«çš„HAåšé«˜å¯ç”¨|å¢åŠ äº†é¡¹ç›®çš„å¤æ‚åº¦<br>éœ€è¦è€ƒè™‘ä¸­é—´ä»¶å’Œå½“å‰é¡¹ç›®çš„å†²çªé—®é¢˜|\n\nå¯¹æ¯”äº†å¸‚åœºä¸Šçš„è®¾è®¡å’Œæˆ‘ä»¬çš„è‡ªèº«çš„äººåŠ›æˆæœ¬ï¼Œæˆ‘ä»¬å†³å®šå¼•å…¥ä¸€æ¬¾æˆç†Ÿä¸­é—´ä»¶æ¥è§£å†³å¤§éƒ¨åˆ†çš„é€šè®¯å’Œé…ç½®å‘ç°é—®é¢˜ã€‚è¿™ä¸ªæ—¶å€™æ‘†åœ¨æˆ‘ä»¬é¢å‰çš„å¯é€‰é¡¹å…¶å®è¿˜æ˜¯å¾ˆæœ‰é™çš„ï¼Œèƒ½èƒœä»»æˆ‘ä»¬çš„éœ€æ±‚çš„æ— éå°±æ˜¯Zkã€redisã€MQè¿™å‡ ä¸ªã€‚\n\nè¿™å‡ ä¸ªè€³ç†Ÿèƒ½è¯¦çš„ä¸­é—´ä»¶ä¸Šæ¥æˆ‘ä»¬å°±æ”¾å¼ƒäº†zkï¼Œè€ƒè™‘ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ã€‚\n1. zkä¸é€‚åˆåšå¤§é‡æ•°æ®çš„å­˜å‚¨ï¼Œç‰¹åˆ«æ˜¯é…ç½®è¿™ç§ç»“æ„åŒ–çš„æ•°æ®ã€‚è™½ç„¶zkçš„CPç‰¹æ€§èƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥ç²¾å‡†çš„é…ç½®æ¨é€ç‰¹æ€§ï¼Œä½†æ˜¯é‡åˆ°å¤§é‡çš„é…ç½®å†…å®¹zkå°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒã€‚\n2. zkçš„snapshotåŠŸèƒ½ï¼Œä¸€æ—¦å‘ç°æ•°æ®å¯¹å…¶é—®é¢˜ï¼Œéœ€è¦åœæœºäººå·¥å¤„ç†ã€‚\n3. è¿‘å¹´æ¥zkåœ¨æœåŠ¡æ³¨å†Œå‘ç°ä¸Šå¤§å±•æ‹³è„šï¼Œä½†æˆ‘å§‹ç»ˆè®¤ä¸ºzkåœ¨ä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶ä¼šæ˜¾å¾—æ‰è¥Ÿè§è‚˜ï¼Œå…ƒæ•°æ®ç®¡ç†æ‰æ˜¯å®ƒçœŸæ­£è¿ç”¨çš„é¢†åŸŸã€‚è¿™ä¸€ç‚¹æ­£å¥½å¥‘åˆæˆ‘ä»¬çš„å¥‘æœºï¼Œä¸è¿‡ä¸å·§çš„æ˜¯æˆ‘ä»¬æƒ³è¦å¼€å‘çš„å¹¶ä¸æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„é…ç½®ä¸­å¿ƒï¼Œæˆ–è€…è¯´åˆ†å¸ƒå¼å¹¶ä¸æ˜¯æˆ‘ä»¬çš„ä¸­å¿ƒã€‚åè€Œåˆ†å¸ƒå¼çš„é…ç½®ç®¡ç†æ‰æ˜¯æˆ‘ä»¬æœ€å¥½çš„é€‰æ‹©ã€‚\n   \nå‰©ä¸‹å°±æ˜¯MQå’Œredisä¸­åšé€‰æ‹©ï¼Œä»–ä»¬ä¸¤ä¸ªå°±æ¯”è¾ƒå¥½æŠ‰æ‹©äº†ã€‚MQå’ŒRediséƒ½å¯ä»¥åšåˆ°HAã€å˜æ›´çš„å®æ—¶æ¨é€ã€ä½†æ˜¯MQæ²¡æ³•åšåˆ°æ•°æ®çš„ç®¡ç†ã€‚åŠ ä¸Šæˆ‘ä»¬çš„ç³»ç»Ÿé‡Œå·²è¿‘å¤§é‡çš„ä½¿ç”¨åˆ°äº†redisï¼Œå¯¹redisçš„æ“ä½œä¹Ÿæ¯”è¾ƒç†Ÿæ‚‰ã€‚æœ€ç»ˆæˆ‘ä»¬é€‰æ‹©äº†redisä½œä¸ºä¸­é—´ä»¶ä¸ºæˆ‘ä»¬çš„é…ç½®ä¸­å¿ƒåšé…ç½®çš„ç»Ÿä¸€ç®¡ç†ã€‚","source":"_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡3.md","raw":"---\ntitle: æˆ‘ä¸ºä»€ä¹ˆä¼šæ‰‹æ’¸ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡ï¼ˆä¸‰ï¼‰\ndate: 2020-04-12 14:29:58\ntags: \n    - Java\n    - Redis\n    - é…ç½®ä¸­å¿ƒ\ncategories :\n    - Technology\n---\n\n## åŠŸèƒ½&æ¶æ„é€‰å‹\nåœ¨åšå…·ä½“çš„æ¶æ„é€‰å‹å‰ï¼Œå…ˆè¦æ˜ç¡®ä¸¤ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬çš„æŠ€æœ¯æ ˆæ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬æ˜¯ä¸ºæ€æ ·çš„æŠ€æœ¯å›¢é˜Ÿæä¾›æœåŠ¡çš„ã€‚\n\n#### é€‰å‹å‰çš„è®¨è®º\nå½“å‰å…¬å¸åç«¯å›¢é˜Ÿå¤§é‡çš„é‡‡ç”¨äº†JAVAçš„æŠ€æœ¯æ ˆï¼Œéšç€å…¬å¸çš„å‘å±•å›´ç»•ç€Spring Cloudå…¨å®¶æ¡¶ï¼Œå›¢é˜Ÿå·²ç»æ­å»ºäº†ç›¸å½“å¤šçš„ä¸šåŠ¡æœåŠ¡ã€‚å¯ä»¥è¯´æˆ‘ä»¬è®¾è®¡çš„é…åˆä¸­å¿ƒæœåŠ¡åœ¨æœ€å¤§é™åº¦ä¸Šä¼šä»¥JAVAä¸ºåŸºç¡€ï¼Œå›´ç»•ç€Springçš„ç”Ÿæ€åœˆè¿›è¡Œè®¾è®¡å¹¶å¼€å‘ã€‚\n\né‚£ä¹ˆå›åˆ°æˆ‘ä»¬ä¹‹å‰çš„æ¶æ„é€‰å‹è¯é¢˜ï¼Œå¯ä»¥å°†é—®é¢˜æ”¹ä¸ºï¼šå¦‚ä½•å›´ç»•Springçš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ç°ä¸€å¥—é…ç½®çµæ´»ã€ç®¡ç†ç®€æ´ã€å€¼çƒ­æ›´æ–°çš„ç³»ç»Ÿã€‚\n<!-- more -->\nç¡®å®šæˆ‘ä»¬å¿…é¡»ç»“åˆSpringåï¼Œæ¥ä¸‹æ¥éœ€è¦æ˜ç¡®çš„å°±æ˜¯ï¼Œå¦‚ä½•å®ç°é…ç½®çš„çƒ­æ›´æ–°ã€‚ç›®å‰å¼€æºçš„é…ç½®ä¸­å¿ƒæœ‰è¿™ä¹ˆå‡ ç§è§£å†³æ–¹æ¡ˆï¼š\n\næ–¹å¼|ä¸­é—´ä»¶|ä¼˜ç‚¹|ç¼ºç‚¹\n|---|---|---|---|\n|æœåŠ¡ç«¯è°ƒç”¨å®¢æˆ·ç«¯Apiè¿›è¡Œæ¨é€|æ— éœ€|å®ç°ç®€å•<br>æ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶|ä¾èµ–Httpè¯·æ±‚è¿‡äºé‡<br>è‡ªå®šä¹‰åè®®å¼€å‘å¤æ‚<br>éœ€è¦è‡ªå·±ä¿è¯è¯·æ±‚çš„å¯é æ€§ |\n|å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯Apiè¿›è¡Œæ‹‰å–|æ— éœ€|å®ç°ç®€å•<br>æ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶|ä¾èµ–Httpè¯·æ±‚è¿‡äºé‡<br>è‡ªå®šä¹‰åè®®å¼€å‘å¤æ‚<br>éœ€è¦è‡ªå·±ä¿è¯è¯·æ±‚çš„å¯é æ€§ |\n|ä¾èµ–ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶æ¨é€|Zookeeperã€Redisã€Nascoç­‰|å¼€å‘ç®€å•ã€ä¸éœ€è¦è‡ªå·±å®ç°é€šè®¯<br>å¯ä¾èµ–ä¸­é—´ä»¶è‡ªèº«çš„HAåšé«˜å¯ç”¨|å¢åŠ äº†é¡¹ç›®çš„å¤æ‚åº¦<br>éœ€è¦è€ƒè™‘ä¸­é—´ä»¶å’Œå½“å‰é¡¹ç›®çš„å†²çªé—®é¢˜|\n\nå¯¹æ¯”äº†å¸‚åœºä¸Šçš„è®¾è®¡å’Œæˆ‘ä»¬çš„è‡ªèº«çš„äººåŠ›æˆæœ¬ï¼Œæˆ‘ä»¬å†³å®šå¼•å…¥ä¸€æ¬¾æˆç†Ÿä¸­é—´ä»¶æ¥è§£å†³å¤§éƒ¨åˆ†çš„é€šè®¯å’Œé…ç½®å‘ç°é—®é¢˜ã€‚è¿™ä¸ªæ—¶å€™æ‘†åœ¨æˆ‘ä»¬é¢å‰çš„å¯é€‰é¡¹å…¶å®è¿˜æ˜¯å¾ˆæœ‰é™çš„ï¼Œèƒ½èƒœä»»æˆ‘ä»¬çš„éœ€æ±‚çš„æ— éå°±æ˜¯Zkã€redisã€MQè¿™å‡ ä¸ªã€‚\n\nè¿™å‡ ä¸ªè€³ç†Ÿèƒ½è¯¦çš„ä¸­é—´ä»¶ä¸Šæ¥æˆ‘ä»¬å°±æ”¾å¼ƒäº†zkï¼Œè€ƒè™‘ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ã€‚\n1. zkä¸é€‚åˆåšå¤§é‡æ•°æ®çš„å­˜å‚¨ï¼Œç‰¹åˆ«æ˜¯é…ç½®è¿™ç§ç»“æ„åŒ–çš„æ•°æ®ã€‚è™½ç„¶zkçš„CPç‰¹æ€§èƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥ç²¾å‡†çš„é…ç½®æ¨é€ç‰¹æ€§ï¼Œä½†æ˜¯é‡åˆ°å¤§é‡çš„é…ç½®å†…å®¹zkå°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒã€‚\n2. zkçš„snapshotåŠŸèƒ½ï¼Œä¸€æ—¦å‘ç°æ•°æ®å¯¹å…¶é—®é¢˜ï¼Œéœ€è¦åœæœºäººå·¥å¤„ç†ã€‚\n3. è¿‘å¹´æ¥zkåœ¨æœåŠ¡æ³¨å†Œå‘ç°ä¸Šå¤§å±•æ‹³è„šï¼Œä½†æˆ‘å§‹ç»ˆè®¤ä¸ºzkåœ¨ä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶ä¼šæ˜¾å¾—æ‰è¥Ÿè§è‚˜ï¼Œå…ƒæ•°æ®ç®¡ç†æ‰æ˜¯å®ƒçœŸæ­£è¿ç”¨çš„é¢†åŸŸã€‚è¿™ä¸€ç‚¹æ­£å¥½å¥‘åˆæˆ‘ä»¬çš„å¥‘æœºï¼Œä¸è¿‡ä¸å·§çš„æ˜¯æˆ‘ä»¬æƒ³è¦å¼€å‘çš„å¹¶ä¸æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„é…ç½®ä¸­å¿ƒï¼Œæˆ–è€…è¯´åˆ†å¸ƒå¼å¹¶ä¸æ˜¯æˆ‘ä»¬çš„ä¸­å¿ƒã€‚åè€Œåˆ†å¸ƒå¼çš„é…ç½®ç®¡ç†æ‰æ˜¯æˆ‘ä»¬æœ€å¥½çš„é€‰æ‹©ã€‚\n   \nå‰©ä¸‹å°±æ˜¯MQå’Œredisä¸­åšé€‰æ‹©ï¼Œä»–ä»¬ä¸¤ä¸ªå°±æ¯”è¾ƒå¥½æŠ‰æ‹©äº†ã€‚MQå’ŒRediséƒ½å¯ä»¥åšåˆ°HAã€å˜æ›´çš„å®æ—¶æ¨é€ã€ä½†æ˜¯MQæ²¡æ³•åšåˆ°æ•°æ®çš„ç®¡ç†ã€‚åŠ ä¸Šæˆ‘ä»¬çš„ç³»ç»Ÿé‡Œå·²è¿‘å¤§é‡çš„ä½¿ç”¨åˆ°äº†redisï¼Œå¯¹redisçš„æ“ä½œä¹Ÿæ¯”è¾ƒç†Ÿæ‚‰ã€‚æœ€ç»ˆæˆ‘ä»¬é€‰æ‹©äº†redisä½œä¸ºä¸­é—´ä»¶ä¸ºæˆ‘ä»¬çš„é…ç½®ä¸­å¿ƒåšé…ç½®çš„ç»Ÿä¸€ç®¡ç†ã€‚","slug":"æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡3","published":1,"updated":"2020-12-14T09:51:24.049Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htn001av252bj839727","content":"<html><head></head><body><h2 id=\"&#x529F;&#x80FD;-amp-&#x67B6;&#x6784;&#x9009;&#x578B;\"><a href=\"#&#x529F;&#x80FD;-amp-&#x67B6;&#x6784;&#x9009;&#x578B;\" class=\"headerlink\" title=\"&#x529F;&#x80FD;&amp;&#x67B6;&#x6784;&#x9009;&#x578B;\"></a>&#x529F;&#x80FD;&amp;&#x67B6;&#x6784;&#x9009;&#x578B;</h2><p>&#x5728;&#x505A;&#x5177;&#x4F53;&#x7684;&#x67B6;&#x6784;&#x9009;&#x578B;&#x524D;&#xFF0C;&#x5148;&#x8981;&#x660E;&#x786E;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x6211;&#x4EEC;&#x7684;&#x6280;&#x672F;&#x6808;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x6211;&#x4EEC;&#x662F;&#x4E3A;&#x600E;&#x6837;&#x7684;&#x6280;&#x672F;&#x56E2;&#x961F;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;&#x3002;</p>\n<h4 id=\"&#x9009;&#x578B;&#x524D;&#x7684;&#x8BA8;&#x8BBA;\"><a href=\"#&#x9009;&#x578B;&#x524D;&#x7684;&#x8BA8;&#x8BBA;\" class=\"headerlink\" title=\"&#x9009;&#x578B;&#x524D;&#x7684;&#x8BA8;&#x8BBA;\"></a>&#x9009;&#x578B;&#x524D;&#x7684;&#x8BA8;&#x8BBA;</h4><p>&#x5F53;&#x524D;&#x516C;&#x53F8;&#x540E;&#x7AEF;&#x56E2;&#x961F;&#x5927;&#x91CF;&#x7684;&#x91C7;&#x7528;&#x4E86;JAVA&#x7684;&#x6280;&#x672F;&#x6808;&#xFF0C;&#x968F;&#x7740;&#x516C;&#x53F8;&#x7684;&#x53D1;&#x5C55;&#x56F4;&#x7ED5;&#x7740;Spring Cloud&#x5168;&#x5BB6;&#x6876;&#xFF0C;&#x56E2;&#x961F;&#x5DF2;&#x7ECF;&#x642D;&#x5EFA;&#x4E86;&#x76F8;&#x5F53;&#x591A;&#x7684;&#x4E1A;&#x52A1;&#x670D;&#x52A1;&#x3002;&#x53EF;&#x4EE5;&#x8BF4;&#x6211;&#x4EEC;&#x8BBE;&#x8BA1;&#x7684;&#x914D;&#x5408;&#x4E2D;&#x5FC3;&#x670D;&#x52A1;&#x5728;&#x6700;&#x5927;&#x9650;&#x5EA6;&#x4E0A;&#x4F1A;&#x4EE5;JAVA&#x4E3A;&#x57FA;&#x7840;&#xFF0C;&#x56F4;&#x7ED5;&#x7740;Spring&#x7684;&#x751F;&#x6001;&#x5708;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#x5E76;&#x5F00;&#x53D1;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x56DE;&#x5230;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x7684;&#x67B6;&#x6784;&#x9009;&#x578B;&#x8BDD;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x95EE;&#x9898;&#x6539;&#x4E3A;&#xFF1A;&#x5982;&#x4F55;&#x56F4;&#x7ED5;Spring&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x5B9E;&#x73B0;&#x4E00;&#x5957;&#x914D;&#x7F6E;&#x7075;&#x6D3B;&#x3001;&#x7BA1;&#x7406;&#x7B80;&#x6D01;&#x3001;&#x503C;&#x70ED;&#x66F4;&#x65B0;&#x7684;&#x7CFB;&#x7EDF;&#x3002;</p>\n<a id=\"more\"></a>\n<p>&#x786E;&#x5B9A;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x7ED3;&#x5408;Spring&#x540E;&#xFF0C;&#x63A5;&#x4E0B;&#x6765;&#x9700;&#x8981;&#x660E;&#x786E;&#x7684;&#x5C31;&#x662F;&#xFF0C;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x914D;&#x7F6E;&#x7684;&#x70ED;&#x66F4;&#x65B0;&#x3002;&#x76EE;&#x524D;&#x5F00;&#x6E90;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x6709;&#x8FD9;&#x4E48;&#x51E0;&#x79CD;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;</p>\n<p>&#x65B9;&#x5F0F;|&#x4E2D;&#x95F4;&#x4EF6;|&#x4F18;&#x70B9;|&#x7F3A;&#x70B9;<br>|&#x2014;|&#x2014;|&#x2014;|&#x2014;|<br>|&#x670D;&#x52A1;&#x7AEF;&#x8C03;&#x7528;&#x5BA2;&#x6237;&#x7AEF;Api&#x8FDB;&#x884C;&#x63A8;&#x9001;|&#x65E0;&#x9700;|&#x5B9E;&#x73B0;&#x7B80;&#x5355;<br>&#x65E0;&#x9700;&#x5F15;&#x5165;&#x7B2C;&#x4E09;&#x65B9;&#x4E2D;&#x95F4;&#x4EF6;|&#x4F9D;&#x8D56;Http&#x8BF7;&#x6C42;&#x8FC7;&#x4E8E;&#x91CD;<br>&#x81EA;&#x5B9A;&#x4E49;&#x534F;&#x8BAE;&#x5F00;&#x53D1;&#x590D;&#x6742;<br>&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x4FDD;&#x8BC1;&#x8BF7;&#x6C42;&#x7684;&#x53EF;&#x9760;&#x6027; |<br>|&#x5BA2;&#x6237;&#x7AEF;&#x8C03;&#x7528;&#x670D;&#x52A1;&#x7AEF;Api&#x8FDB;&#x884C;&#x62C9;&#x53D6;|&#x65E0;&#x9700;|&#x5B9E;&#x73B0;&#x7B80;&#x5355;<br>&#x65E0;&#x9700;&#x5F15;&#x5165;&#x7B2C;&#x4E09;&#x65B9;&#x4E2D;&#x95F4;&#x4EF6;|&#x4F9D;&#x8D56;Http&#x8BF7;&#x6C42;&#x8FC7;&#x4E8E;&#x91CD;<br>&#x81EA;&#x5B9A;&#x4E49;&#x534F;&#x8BAE;&#x5F00;&#x53D1;&#x590D;&#x6742;<br>&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x4FDD;&#x8BC1;&#x8BF7;&#x6C42;&#x7684;&#x53EF;&#x9760;&#x6027; |<br>|&#x4F9D;&#x8D56;&#x7B2C;&#x4E09;&#x65B9;&#x4E2D;&#x95F4;&#x4EF6;&#x63A8;&#x9001;|Zookeeper&#x3001;Redis&#x3001;Nasco&#x7B49;|&#x5F00;&#x53D1;&#x7B80;&#x5355;&#x3001;&#x4E0D;&#x9700;&#x8981;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x901A;&#x8BAF;<br>&#x53EF;&#x4F9D;&#x8D56;&#x4E2D;&#x95F4;&#x4EF6;&#x81EA;&#x8EAB;&#x7684;HA&#x505A;&#x9AD8;&#x53EF;&#x7528;|&#x589E;&#x52A0;&#x4E86;&#x9879;&#x76EE;&#x7684;&#x590D;&#x6742;&#x5EA6;<br>&#x9700;&#x8981;&#x8003;&#x8651;&#x4E2D;&#x95F4;&#x4EF6;&#x548C;&#x5F53;&#x524D;&#x9879;&#x76EE;&#x7684;&#x51B2;&#x7A81;&#x95EE;&#x9898;|</p>\n<p>&#x5BF9;&#x6BD4;&#x4E86;&#x5E02;&#x573A;&#x4E0A;&#x7684;&#x8BBE;&#x8BA1;&#x548C;&#x6211;&#x4EEC;&#x7684;&#x81EA;&#x8EAB;&#x7684;&#x4EBA;&#x529B;&#x6210;&#x672C;&#xFF0C;&#x6211;&#x4EEC;&#x51B3;&#x5B9A;&#x5F15;&#x5165;&#x4E00;&#x6B3E;&#x6210;&#x719F;&#x4E2D;&#x95F4;&#x4EF6;&#x6765;&#x89E3;&#x51B3;&#x5927;&#x90E8;&#x5206;&#x7684;&#x901A;&#x8BAF;&#x548C;&#x914D;&#x7F6E;&#x53D1;&#x73B0;&#x95EE;&#x9898;&#x3002;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#x6446;&#x5728;&#x6211;&#x4EEC;&#x9762;&#x524D;&#x7684;&#x53EF;&#x9009;&#x9879;&#x5176;&#x5B9E;&#x8FD8;&#x662F;&#x5F88;&#x6709;&#x9650;&#x7684;&#xFF0C;&#x80FD;&#x80DC;&#x4EFB;&#x6211;&#x4EEC;&#x7684;&#x9700;&#x6C42;&#x7684;&#x65E0;&#x975E;&#x5C31;&#x662F;Zk&#x3001;redis&#x3001;MQ&#x8FD9;&#x51E0;&#x4E2A;&#x3002;</p>\n<p>&#x8FD9;&#x51E0;&#x4E2A;&#x8033;&#x719F;&#x80FD;&#x8BE6;&#x7684;&#x4E2D;&#x95F4;&#x4EF6;&#x4E0A;&#x6765;&#x6211;&#x4EEC;&#x5C31;&#x653E;&#x5F03;&#x4E86;zk&#xFF0C;&#x8003;&#x8651;&#x4E3B;&#x8981;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;&#x3002;</p>\n<ol>\n<li>zk&#x4E0D;&#x9002;&#x5408;&#x505A;&#x5927;&#x91CF;&#x6570;&#x636E;&#x7684;&#x5B58;&#x50A8;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x914D;&#x7F6E;&#x8FD9;&#x79CD;&#x7ED3;&#x6784;&#x5316;&#x7684;&#x6570;&#x636E;&#x3002;&#x867D;&#x7136;zk&#x7684;CP&#x7279;&#x6027;&#x80FD;&#x4E3A;&#x6211;&#x4EEC;&#x5E26;&#x6765;&#x7CBE;&#x51C6;&#x7684;&#x914D;&#x7F6E;&#x63A8;&#x9001;&#x7279;&#x6027;&#xFF0C;&#x4F46;&#x662F;&#x9047;&#x5230;&#x5927;&#x91CF;&#x7684;&#x914D;&#x7F6E;&#x5185;&#x5BB9;zk&#x5C31;&#x663E;&#x5F97;&#x529B;&#x4E0D;&#x4ECE;&#x5FC3;&#x3002;</li>\n<li>zk&#x7684;snapshot&#x529F;&#x80FD;&#xFF0C;&#x4E00;&#x65E6;&#x53D1;&#x73B0;&#x6570;&#x636E;&#x5BF9;&#x5176;&#x95EE;&#x9898;&#xFF0C;&#x9700;&#x8981;&#x505C;&#x673A;&#x4EBA;&#x5DE5;&#x5904;&#x7406;&#x3002;</li>\n<li>&#x8FD1;&#x5E74;&#x6765;zk&#x5728;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x53D1;&#x73B0;&#x4E0A;&#x5927;&#x5C55;&#x62F3;&#x811A;&#xFF0C;&#x4F46;&#x6211;&#x59CB;&#x7EC8;&#x8BA4;&#x4E3A;zk&#x5728;&#x4F5C;&#x4E3A;&#x6CE8;&#x518C;&#x4E2D;&#x5FC3;&#x65F6;&#x4F1A;&#x663E;&#x5F97;&#x6349;&#x895F;&#x89C1;&#x8098;&#xFF0C;&#x5143;&#x6570;&#x636E;&#x7BA1;&#x7406;&#x624D;&#x662F;&#x5B83;&#x771F;&#x6B63;&#x8FD0;&#x7528;&#x7684;&#x9886;&#x57DF;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x6B63;&#x597D;&#x5951;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x5951;&#x673A;&#xFF0C;&#x4E0D;&#x8FC7;&#x4E0D;&#x5DE7;&#x7684;&#x662F;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x5F00;&#x53D1;&#x7684;&#x5E76;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#xFF0C;&#x6216;&#x8005;&#x8BF4;&#x5206;&#x5E03;&#x5F0F;&#x5E76;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x4E2D;&#x5FC3;&#x3002;&#x53CD;&#x800C;&#x5206;&#x5E03;&#x5F0F;&#x7684;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x624D;&#x662F;&#x6211;&#x4EEC;&#x6700;&#x597D;&#x7684;&#x9009;&#x62E9;&#x3002;</li>\n</ol>\n<p>&#x5269;&#x4E0B;&#x5C31;&#x662F;MQ&#x548C;redis&#x4E2D;&#x505A;&#x9009;&#x62E9;&#xFF0C;&#x4ED6;&#x4EEC;&#x4E24;&#x4E2A;&#x5C31;&#x6BD4;&#x8F83;&#x597D;&#x6289;&#x62E9;&#x4E86;&#x3002;MQ&#x548C;Redis&#x90FD;&#x53EF;&#x4EE5;&#x505A;&#x5230;HA&#x3001;&#x53D8;&#x66F4;&#x7684;&#x5B9E;&#x65F6;&#x63A8;&#x9001;&#x3001;&#x4F46;&#x662F;MQ&#x6CA1;&#x6CD5;&#x505A;&#x5230;&#x6570;&#x636E;&#x7684;&#x7BA1;&#x7406;&#x3002;&#x52A0;&#x4E0A;&#x6211;&#x4EEC;&#x7684;&#x7CFB;&#x7EDF;&#x91CC;&#x5DF2;&#x8FD1;&#x5927;&#x91CF;&#x7684;&#x4F7F;&#x7528;&#x5230;&#x4E86;redis&#xFF0C;&#x5BF9;redis&#x7684;&#x64CD;&#x4F5C;&#x4E5F;&#x6BD4;&#x8F83;&#x719F;&#x6089;&#x3002;&#x6700;&#x7EC8;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x4E86;redis&#x4F5C;&#x4E3A;&#x4E2D;&#x95F4;&#x4EF6;&#x4E3A;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x505A;&#x914D;&#x7F6E;&#x7684;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;&#x3002;</p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Redis","path":"tags/Redis/"},{"name":"é…ç½®ä¸­å¿ƒ","path":"tags/é…ç½®ä¸­å¿ƒ/"}],"excerpt":"<html><head></head><body><h2 id=\"&#x529F;&#x80FD;-amp-&#x67B6;&#x6784;&#x9009;&#x578B;\"><a href=\"#&#x529F;&#x80FD;-amp-&#x67B6;&#x6784;&#x9009;&#x578B;\" class=\"headerlink\" title=\"&#x529F;&#x80FD;&amp;&#x67B6;&#x6784;&#x9009;&#x578B;\"></a>&#x529F;&#x80FD;&amp;&#x67B6;&#x6784;&#x9009;&#x578B;</h2><p>&#x5728;&#x505A;&#x5177;&#x4F53;&#x7684;&#x67B6;&#x6784;&#x9009;&#x578B;&#x524D;&#xFF0C;&#x5148;&#x8981;&#x660E;&#x786E;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x6211;&#x4EEC;&#x7684;&#x6280;&#x672F;&#x6808;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x6211;&#x4EEC;&#x662F;&#x4E3A;&#x600E;&#x6837;&#x7684;&#x6280;&#x672F;&#x56E2;&#x961F;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;&#x3002;</p>\n<h4 id=\"&#x9009;&#x578B;&#x524D;&#x7684;&#x8BA8;&#x8BBA;\"><a href=\"#&#x9009;&#x578B;&#x524D;&#x7684;&#x8BA8;&#x8BBA;\" class=\"headerlink\" title=\"&#x9009;&#x578B;&#x524D;&#x7684;&#x8BA8;&#x8BBA;\"></a>&#x9009;&#x578B;&#x524D;&#x7684;&#x8BA8;&#x8BBA;</h4><p>&#x5F53;&#x524D;&#x516C;&#x53F8;&#x540E;&#x7AEF;&#x56E2;&#x961F;&#x5927;&#x91CF;&#x7684;&#x91C7;&#x7528;&#x4E86;JAVA&#x7684;&#x6280;&#x672F;&#x6808;&#xFF0C;&#x968F;&#x7740;&#x516C;&#x53F8;&#x7684;&#x53D1;&#x5C55;&#x56F4;&#x7ED5;&#x7740;Spring Cloud&#x5168;&#x5BB6;&#x6876;&#xFF0C;&#x56E2;&#x961F;&#x5DF2;&#x7ECF;&#x642D;&#x5EFA;&#x4E86;&#x76F8;&#x5F53;&#x591A;&#x7684;&#x4E1A;&#x52A1;&#x670D;&#x52A1;&#x3002;&#x53EF;&#x4EE5;&#x8BF4;&#x6211;&#x4EEC;&#x8BBE;&#x8BA1;&#x7684;&#x914D;&#x5408;&#x4E2D;&#x5FC3;&#x670D;&#x52A1;&#x5728;&#x6700;&#x5927;&#x9650;&#x5EA6;&#x4E0A;&#x4F1A;&#x4EE5;JAVA&#x4E3A;&#x57FA;&#x7840;&#xFF0C;&#x56F4;&#x7ED5;&#x7740;Spring&#x7684;&#x751F;&#x6001;&#x5708;&#x8FDB;&#x884C;&#x8BBE;&#x8BA1;&#x5E76;&#x5F00;&#x53D1;&#x3002;</p>\n<p>&#x90A3;&#x4E48;&#x56DE;&#x5230;&#x6211;&#x4EEC;&#x4E4B;&#x524D;&#x7684;&#x67B6;&#x6784;&#x9009;&#x578B;&#x8BDD;&#x9898;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;&#x95EE;&#x9898;&#x6539;&#x4E3A;&#xFF1A;&#x5982;&#x4F55;&#x56F4;&#x7ED5;Spring&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x5B9E;&#x73B0;&#x4E00;&#x5957;&#x914D;&#x7F6E;&#x7075;&#x6D3B;&#x3001;&#x7BA1;&#x7406;&#x7B80;&#x6D01;&#x3001;&#x503C;&#x70ED;&#x66F4;&#x65B0;&#x7684;&#x7CFB;&#x7EDF;&#x3002;</p></body></html>","more":"<p>ç¡®å®šæˆ‘ä»¬å¿…é¡»ç»“åˆSpringåï¼Œæ¥ä¸‹æ¥éœ€è¦æ˜ç¡®çš„å°±æ˜¯ï¼Œå¦‚ä½•å®ç°é…ç½®çš„çƒ­æ›´æ–°ã€‚ç›®å‰å¼€æºçš„é…ç½®ä¸­å¿ƒæœ‰è¿™ä¹ˆå‡ ç§è§£å†³æ–¹æ¡ˆï¼š</p>\n<p>æ–¹å¼|ä¸­é—´ä»¶|ä¼˜ç‚¹|ç¼ºç‚¹<br>|â€”|â€”|â€”|â€”|<br>|æœåŠ¡ç«¯è°ƒç”¨å®¢æˆ·ç«¯Apiè¿›è¡Œæ¨é€|æ— éœ€|å®ç°ç®€å•<br>æ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶|ä¾èµ–Httpè¯·æ±‚è¿‡äºé‡<br>è‡ªå®šä¹‰åè®®å¼€å‘å¤æ‚<br>éœ€è¦è‡ªå·±ä¿è¯è¯·æ±‚çš„å¯é æ€§ |<br>|å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯Apiè¿›è¡Œæ‹‰å–|æ— éœ€|å®ç°ç®€å•<br>æ— éœ€å¼•å…¥ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶|ä¾èµ–Httpè¯·æ±‚è¿‡äºé‡<br>è‡ªå®šä¹‰åè®®å¼€å‘å¤æ‚<br>éœ€è¦è‡ªå·±ä¿è¯è¯·æ±‚çš„å¯é æ€§ |<br>|ä¾èµ–ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶æ¨é€|Zookeeperã€Redisã€Nascoç­‰|å¼€å‘ç®€å•ã€ä¸éœ€è¦è‡ªå·±å®ç°é€šè®¯<br>å¯ä¾èµ–ä¸­é—´ä»¶è‡ªèº«çš„HAåšé«˜å¯ç”¨|å¢åŠ äº†é¡¹ç›®çš„å¤æ‚åº¦<br>éœ€è¦è€ƒè™‘ä¸­é—´ä»¶å’Œå½“å‰é¡¹ç›®çš„å†²çªé—®é¢˜|</p>\n<p>å¯¹æ¯”äº†å¸‚åœºä¸Šçš„è®¾è®¡å’Œæˆ‘ä»¬çš„è‡ªèº«çš„äººåŠ›æˆæœ¬ï¼Œæˆ‘ä»¬å†³å®šå¼•å…¥ä¸€æ¬¾æˆç†Ÿä¸­é—´ä»¶æ¥è§£å†³å¤§éƒ¨åˆ†çš„é€šè®¯å’Œé…ç½®å‘ç°é—®é¢˜ã€‚è¿™ä¸ªæ—¶å€™æ‘†åœ¨æˆ‘ä»¬é¢å‰çš„å¯é€‰é¡¹å…¶å®è¿˜æ˜¯å¾ˆæœ‰é™çš„ï¼Œèƒ½èƒœä»»æˆ‘ä»¬çš„éœ€æ±‚çš„æ— éå°±æ˜¯Zkã€redisã€MQè¿™å‡ ä¸ªã€‚</p>\n<p>è¿™å‡ ä¸ªè€³ç†Ÿèƒ½è¯¦çš„ä¸­é—´ä»¶ä¸Šæ¥æˆ‘ä»¬å°±æ”¾å¼ƒäº†zkï¼Œè€ƒè™‘ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ã€‚</p>\n<ol>\n<li>zkä¸é€‚åˆåšå¤§é‡æ•°æ®çš„å­˜å‚¨ï¼Œç‰¹åˆ«æ˜¯é…ç½®è¿™ç§ç»“æ„åŒ–çš„æ•°æ®ã€‚è™½ç„¶zkçš„CPç‰¹æ€§èƒ½ä¸ºæˆ‘ä»¬å¸¦æ¥ç²¾å‡†çš„é…ç½®æ¨é€ç‰¹æ€§ï¼Œä½†æ˜¯é‡åˆ°å¤§é‡çš„é…ç½®å†…å®¹zkå°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒã€‚</li>\n<li>zkçš„snapshotåŠŸèƒ½ï¼Œä¸€æ—¦å‘ç°æ•°æ®å¯¹å…¶é—®é¢˜ï¼Œéœ€è¦åœæœºäººå·¥å¤„ç†ã€‚</li>\n<li>è¿‘å¹´æ¥zkåœ¨æœåŠ¡æ³¨å†Œå‘ç°ä¸Šå¤§å±•æ‹³è„šï¼Œä½†æˆ‘å§‹ç»ˆè®¤ä¸ºzkåœ¨ä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶ä¼šæ˜¾å¾—æ‰è¥Ÿè§è‚˜ï¼Œå…ƒæ•°æ®ç®¡ç†æ‰æ˜¯å®ƒçœŸæ­£è¿ç”¨çš„é¢†åŸŸã€‚è¿™ä¸€ç‚¹æ­£å¥½å¥‘åˆæˆ‘ä»¬çš„å¥‘æœºï¼Œä¸è¿‡ä¸å·§çš„æ˜¯æˆ‘ä»¬æƒ³è¦å¼€å‘çš„å¹¶ä¸æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„é…ç½®ä¸­å¿ƒï¼Œæˆ–è€…è¯´åˆ†å¸ƒå¼å¹¶ä¸æ˜¯æˆ‘ä»¬çš„ä¸­å¿ƒã€‚åè€Œåˆ†å¸ƒå¼çš„é…ç½®ç®¡ç†æ‰æ˜¯æˆ‘ä»¬æœ€å¥½çš„é€‰æ‹©ã€‚</li>\n</ol>\n<p>å‰©ä¸‹å°±æ˜¯MQå’Œredisä¸­åšé€‰æ‹©ï¼Œä»–ä»¬ä¸¤ä¸ªå°±æ¯”è¾ƒå¥½æŠ‰æ‹©äº†ã€‚MQå’ŒRediséƒ½å¯ä»¥åšåˆ°HAã€å˜æ›´çš„å®æ—¶æ¨é€ã€ä½†æ˜¯MQæ²¡æ³•åšåˆ°æ•°æ®çš„ç®¡ç†ã€‚åŠ ä¸Šæˆ‘ä»¬çš„ç³»ç»Ÿé‡Œå·²è¿‘å¤§é‡çš„ä½¿ç”¨åˆ°äº†redisï¼Œå¯¹redisçš„æ“ä½œä¹Ÿæ¯”è¾ƒç†Ÿæ‚‰ã€‚æœ€ç»ˆæˆ‘ä»¬é€‰æ‹©äº†redisä½œä¸ºä¸­é—´ä»¶ä¸ºæˆ‘ä»¬çš„é…ç½®ä¸­å¿ƒåšé…ç½®çš„ç»Ÿä¸€ç®¡ç†ã€‚</p>"},{"title":"æˆ‘ä¸ºä»€ä¹ˆä¼šæ‰‹æ’¸ä¸€ä¸ªé…ç½®ä¸­å¿ƒ--èµ·æºç¯‡","date":"2020-03-19T14:16:13.000Z","_content":"\n## èŠèŠåç«¯çš„å·¥ä½œ\nä½œä¸ºä¸€ä¸ªåç«¯ç‹—æœ€æ€•çš„æœ‰å‡ ä»¶äº‹ï¼š\n1. éœ€æ±‚åšä¹Ÿåšä¸å®Œå°±ç½¢è¾½ï¼Œéš”ä¸‰å·®äº”çš„ä¸šåŠ¡åŒå­¦è¿˜ä¼šè·‘æ¥è¯´â€œå¤§é”…ï¼Œæ˜¨å¤©ä¸Šæ¶çš„äº§å“éº»çƒ¦è°ƒæ•´ä¸‹æ–‡æ¡ˆâ€ã€‚ã€‚ã€‚\n2. å¥½ä¸å®¹æ˜“åšå®Œäº†éœ€æ±‚å¹¶ä¸”ç†¬åˆ°äº†ä¸Šçº¿ï¼Œç¬¬äºŒå¤©äº§å“è¿‡æ¥è¯´â€œè€å¼Ÿï¼Œé‚£ä¸ªéœ€æ±‚è¢«ç›‘ç®¡éƒ¨é—¨å‹’ä»¤ä¸‹æ¶äº†ï¼Œèƒ½æŠŠé‚£ä¸ªåŠŸèƒ½ä¸‹äº†ä¸â€ã€‚ã€‚ã€‚\n3. ä»£ç æ•²çš„å¼€å¿ƒçš„æ—¶å€™ï¼Œéš”å£è€å¤§è·‘è¿‡æ¥è¯´â€œå…„å¼Ÿï¼Œä¹‹å‰é‚£ä¸ªXXæŠ¥è¡¨ä¸é”™å•Šï¼Œä¹Ÿå®šæ—¶å‘æˆ‘ä¸€ä»½â€ã€‚ã€‚ã€‚\n<!-- more -->\nä¸Šé¢çš„åœºæ™¯å¤§å®¶è®¤è¯†æˆ‘çš„ä¸è¦å¯¹å·å…¥åº§å“ˆï¼Œä½œä¸ºä¸ªåç«¯ç‹—ï¼Œæœ€æ€•çš„å°±æ˜¯é‡å¤åŠ³åŠ¨ã€‚\n\näº§å“çš„æ–‡æ¡ˆã€ä¸šåŠ¡çš„å¼€å…³ã€æŠ¥è¡¨çš„æ”¶ä»¶äººç­‰ç­‰è¿™äº›æˆ‘ä»¬éƒ½å¯ä»¥å«åšä¸šåŠ¡é…ç½®ï¼Œä¸€ä¸ªåˆæ ¼çš„å¼€å‘ä¹Ÿèƒ½åœ¨éœ€æ±‚è®¾è®¡é˜¶æ®µå°†è¿™äº›é…ç½®ä»éœ€æ±‚ä¸­æç‚¼å‡ºæ¥å¹¶è¿›è¡Œé…ç½®åŒ–ï¼Œæ–¹ä¾¿æ—¥åçš„å˜æ›´ã€‚\né‚£ä¹ˆï¼Œä¸æ˜¯è¯´é…ç½®èƒ½å˜æ›´æˆ‘ä»¬å°±æ²¡äº‹äº†ã€‚\n\né¦–å…ˆï¼Œå¦‚æœåŸºäºspringå¼€å‘çš„å°ä¼™ä¼´è‚¯å®šä¼šæƒ³åˆ°springè‡ªå¸¦çš„é…ç½®æ–‡ä»¶ã€‚\né€šè¿‡é…ç½®æ–‡ä»¶çš„éš”ç¦»ï¼Œæˆ‘ä»¬å®Œå…¨èƒ½å¤Ÿéš”ç¦»å‡ºdevã€stagingã€prodç”šè‡³æ›´å¤šç¯å¢ƒçš„é…ç½®ã€‚æ¯å½“é…ç½®æœ‰å˜æ›´æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ç›¸åº”ç¯å¢ƒçš„é…ç½®ï¼Œå¹¶é‡æ–°éƒ¨ç½²å°±OKäº†ã€‚\n\n<font color=red >è¿™æ ·å¥½å—ï¼Ÿ</font>ç­”æ¡ˆæ˜¯æ²¡ä»€ä¹ˆä¸å¥½ã€‚<font color=red >ä½†æ˜¯ä¼˜é›…å—ï¼Ÿ</font>é‚£å¿…é¡»æ˜¯æŒ«çš„ä¸€å¡Œç³Šæ¶‚ã€‚\näº’è”ç½‘çš„æ ¹åŸºå°±æ˜¯å¿«é€Ÿå°è¯•ã€å¿«é€Ÿè½åœ°ã€åå¤å°è¯•ä»è€Œå¯»æ‰¾åˆ°æœ€ä¼˜çš„è§£å†³æ–¹æ¡ˆã€‚\nä¸šåŠ¡åœ¨ä¸æ–­çš„å°è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ–è®¸ä¼šè¹¦å‡ºä¸ªå¤§ç¥æ‹ç€è„‘è¢‹è¯´â€œæˆ‘è§‰å¾—å®¢æˆ·è¦çš„å°±æ˜¯è¿™ä¸ªï¼Œè¿™ä¹ˆé‚£ä¹ˆåšå‡†æ²¡é”™â€ã€‚ä½†ç°å®å¾€å¾€è¯æ˜æˆ‘ä»¬éƒ½æ˜¯æ™®é€šäººï¼Œæˆä¸ºåˆ«äººè‚šå­é‡Œçš„è›”è™«é‚£æ˜¯å¤šä¹ˆå›°éš¾çš„ä¸€ä»¶äº‹ã€‚\næ‰€ä»¥éœ€æ±‚çš„ååå¤å¤ï¼Œä»£ç çš„æ¥æ¥å›å›å°±æ˜¯ä¸€ä¸ªåç«¯ç‹—çš„æ—¥å¸¸ã€‚\n\n## é…ç½®ä¸­å¿ƒçš„å‡ºç°\né‚£åœ¨è¿™ç§å¿«é€Ÿå˜åŒ–çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä½œä¸ºå¼€å‘èƒ½åšäº›ä»€ä¹ˆå‘¢ï¼Ÿç­”æ¡ˆå…¶å®å¾ˆç®€ç­”ï¼Œå¤äººéƒ½è¯´äº†â€œå¤§é“åŒ–ç®€â€ï¼Œé‚£è‡ªç„¶æ˜¯æœ‰å˜åŒ–æˆ‘ä»¬å°±æ‹¥æŠ±å˜åŒ–ã€‚\nä½†ä¸€ä¸ªèªæ˜æˆ–è€…è¯´æ‡’æƒ°çš„ç¨‹åºå‘˜åœ¨æ‹¥æŠ±å˜åŒ–çš„åŒæ—¶æœ€é‡è¦çš„å·¥ä½œå°±æ˜¯å¯»æ‰¾é‚£ä¸ªä¸å˜ã€‚ä»£ç çš„æŠ½è±¡ã€ä¸šåŠ¡çš„æŠ½è±¡æ—¶æˆ‘ä»¬æ—¥åæœåŠ¡æ­å»ºçš„æ ¹åŸºã€‚è‡ªç„¶æˆ‘ä»¬ä¸Šé¢è¯´é“çš„é…ç½®å½“ç„¶ä¹Ÿæ˜¯ã€‚\n\nèªæ˜çš„ç¨‹åºå‘˜æ—©å°±æŠŠè¿™äº›ç¹æ‚çš„å·¥ä½œæŠ½ç¦»äº†å‡ºæ¥ï¼Œé…ç½®ä¸­å¿ƒè€Œç„¶è€Œç„¶çš„å­•è‚²å‡ºä¸–ã€‚ç™¾åº¦çš„Disconfã€æºç¨‹çš„Apolloã€é˜¿é‡Œçš„Nacosã€Spring Cloudçš„Spring Cloud Configã€‚\nåé¢æˆ‘ä¼šä¸“é—¨èŠèŠè¿™å‡ ä¸ªå¸¸è§çš„é…ç½®ä¸­å¿ƒçš„ä¼˜åŠ£ã€‚\n\n## æˆ‘ä¸ºä»€ä¹ˆæ‰‹æ’¸ä¸ªé…ç½®ä¸­å¿ƒ\né‚£è¿˜è¦å›åˆ°1å¹´å‰ï¼Œæˆ‘ä»¬å…¬å¸æœ€ä¸ºåˆ›ä¸šå…¬å¸ï¼Œä¸šåŠ¡åˆšåˆšèµ·æ­¥ã€‚ä¸ºäº†å¿«é€Ÿçš„ä¸šåŠ¡è½åœ°ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯èƒ½æ¥ä»€ä¹ˆå°±æ¥ä»€ä¹ˆï¼Œæ—¶é—´é•¿äº†æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼š<font color=red >å‘ç‰ˆæˆåˆ†å¤ªé«˜</font>ã€‚\n\nç›¸ä¿¡æ¯ä¸ªåšå¼€å‘çš„å°ä¼™ä¼´éƒ½æœ‰ä½“ä¼šï¼Œæ™šä¸Šå‘ç‰ˆæ˜¯ä¸€ä»¶å¤šä¹ˆè®©äººæƒ†æ€…çš„äº‹æƒ…å•Šã€‚ã€‚ã€‚ä½†æ›´è®©äººæƒ†æ€…çš„æ˜¯ï¼Œæœ¬æ¥åªæ˜¯ä¸€ä¸ªå°å°çš„é…ç½®å˜æ›´ï¼Œå´è¿˜è¦ç­‰åˆ°æ™šä¸Šæ‰èƒ½é‡æ–°ä¸Šçº¿ï¼Œç€å®è®©äººå—ä¸äº†ã€‚ä»é‚£ä¸ªæ—¶å€™å¼€å§‹ï¼Œæˆ‘ä»¬å°±æ‰“ç®—å¼•å…¥é…ç½®ä¸­å¿ƒäº†ã€‚\n\né¦–å…ˆè°ƒç ”é…ç½®ä¸­å¿ƒçš„å°ä¼™ä¼´ç»è¿‡å‡ ä¸ªç°å­˜å¼€æºç³»ç»Ÿçš„æ¯”è¾ƒï¼Œæœ€åé€‰å®šäº†ç™¾åº¦çš„Disconfã€‚è¯´ä¸Šå°±ä¸Šï¼ŒDisconfå°±åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­æ„‰å¿«çš„å¥”è·‘èµ·æ¥äº†ã€‚\n\n1å¹´è¿‡å»äº†ï¼Œç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œä¸šåŠ¡è¶Šæ¥è¶Šç¹çï¼Œå½“åˆé‚£ä¸ªäººè§äººçˆ±çš„Disconfä¸æ—¶çš„å˜æˆäº†æˆ‘ä»¬åˆé¥­æ—¶è¯Ÿç—…çš„è°ˆèµ„ã€‚å½“ç„¶å¹¶ä¸æ˜¯Disconfæœ¬èº«ä¸å¥½ï¼Œä¸è¿‡å¤±å»ç»´æŠ¤çš„ç¤¾åŒºæœ¬èº«ä¹Ÿæ˜¯å®ƒé—®é¢˜çš„ä¸€ç¯ã€‚ä½†æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼ŒDisconfæœ¬èº«å·²ç»æ…¢æ…¢ä¸é€‚åˆæˆ‘ä»¬çš„ä¸šåŠ¡äº†ã€‚å¯èƒ½ä¼šæœ‰äº›å°ä¼™ä¼´è¯´ï¼Œé‚£å°±ä½¿ç”¨æ›´å¼ºå¤§çš„Apolloï¼Œæˆ–è€…Nacosã€‚Apolloæœ¬èº«å›ºç„¶å¼ºå¤§ï¼Œä½†ä¸€ä¸ªç¬¬ä¸‰æ–¹ç³»ç»Ÿå§‹ç»ˆæ— æ³•å¥‘åˆæˆ‘ä»¬ç°åœ¨çš„ä¸šåŠ¡åœºæ™¯ï¼ŒNacosä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ï¼Œæ‰å¤–ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Spring Cloudçš„å…¨å®¶æ¡¶ï¼Œè‹¥å¼•å…¥Nacosï¼Œå¿…ç„¶éœ€è¦å‡çº§åˆ°Alibaba Spring Cloudã€‚æƒ³å¿…é£é™©å’Œå·¥ä½œé‡åªå¢æ— å‡ã€‚\n\nå› æ­¤åœ¨è¿™æ ·çš„ä¸€ä¸ªå¤§å‰æä¸‹ï¼Œæˆ‘ä»¬å†’å‡ºäº†â€œæˆ‘ä»€ä¹ˆä¸è‡ªå·±æ‰‹æ’¸ä¸ªé…ç½®ä¸­å¿ƒâ€çš„æƒ³æ³•ã€‚\n\n## é…ç½®ä¸­å¿ƒ nadia-config\nè‡ªæˆ‘æ‰“ä¸ªå¹¿å‘Šï¼Œæˆ‘çš„é…ç½®ä¸­å¿ƒå·²ç»ä¸Šçº¿äº†ï¼Œå¹¶ä¸”ç¬¬ä¸€ç‰ˆä¹Ÿå·²ç»å¼€æºï¼Œæ¬¢è¿å¤§å®¶æ‹ç – \n>https://github.com/nadia-repository/nadia-config\n\n","source":"_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-èµ·æºç¯‡.md","raw":"---\ntitle: æˆ‘ä¸ºä»€ä¹ˆä¼šæ‰‹æ’¸ä¸€ä¸ªé…ç½®ä¸­å¿ƒ--èµ·æºç¯‡\ndate: 2020-03-19 22:16:13\ntags: \n    - Java\n    - Redis\n    - é…ç½®ä¸­å¿ƒ\ncategories :\n    - Technology\n---\n\n## èŠèŠåç«¯çš„å·¥ä½œ\nä½œä¸ºä¸€ä¸ªåç«¯ç‹—æœ€æ€•çš„æœ‰å‡ ä»¶äº‹ï¼š\n1. éœ€æ±‚åšä¹Ÿåšä¸å®Œå°±ç½¢è¾½ï¼Œéš”ä¸‰å·®äº”çš„ä¸šåŠ¡åŒå­¦è¿˜ä¼šè·‘æ¥è¯´â€œå¤§é”…ï¼Œæ˜¨å¤©ä¸Šæ¶çš„äº§å“éº»çƒ¦è°ƒæ•´ä¸‹æ–‡æ¡ˆâ€ã€‚ã€‚ã€‚\n2. å¥½ä¸å®¹æ˜“åšå®Œäº†éœ€æ±‚å¹¶ä¸”ç†¬åˆ°äº†ä¸Šçº¿ï¼Œç¬¬äºŒå¤©äº§å“è¿‡æ¥è¯´â€œè€å¼Ÿï¼Œé‚£ä¸ªéœ€æ±‚è¢«ç›‘ç®¡éƒ¨é—¨å‹’ä»¤ä¸‹æ¶äº†ï¼Œèƒ½æŠŠé‚£ä¸ªåŠŸèƒ½ä¸‹äº†ä¸â€ã€‚ã€‚ã€‚\n3. ä»£ç æ•²çš„å¼€å¿ƒçš„æ—¶å€™ï¼Œéš”å£è€å¤§è·‘è¿‡æ¥è¯´â€œå…„å¼Ÿï¼Œä¹‹å‰é‚£ä¸ªXXæŠ¥è¡¨ä¸é”™å•Šï¼Œä¹Ÿå®šæ—¶å‘æˆ‘ä¸€ä»½â€ã€‚ã€‚ã€‚\n<!-- more -->\nä¸Šé¢çš„åœºæ™¯å¤§å®¶è®¤è¯†æˆ‘çš„ä¸è¦å¯¹å·å…¥åº§å“ˆï¼Œä½œä¸ºä¸ªåç«¯ç‹—ï¼Œæœ€æ€•çš„å°±æ˜¯é‡å¤åŠ³åŠ¨ã€‚\n\näº§å“çš„æ–‡æ¡ˆã€ä¸šåŠ¡çš„å¼€å…³ã€æŠ¥è¡¨çš„æ”¶ä»¶äººç­‰ç­‰è¿™äº›æˆ‘ä»¬éƒ½å¯ä»¥å«åšä¸šåŠ¡é…ç½®ï¼Œä¸€ä¸ªåˆæ ¼çš„å¼€å‘ä¹Ÿèƒ½åœ¨éœ€æ±‚è®¾è®¡é˜¶æ®µå°†è¿™äº›é…ç½®ä»éœ€æ±‚ä¸­æç‚¼å‡ºæ¥å¹¶è¿›è¡Œé…ç½®åŒ–ï¼Œæ–¹ä¾¿æ—¥åçš„å˜æ›´ã€‚\né‚£ä¹ˆï¼Œä¸æ˜¯è¯´é…ç½®èƒ½å˜æ›´æˆ‘ä»¬å°±æ²¡äº‹äº†ã€‚\n\né¦–å…ˆï¼Œå¦‚æœåŸºäºspringå¼€å‘çš„å°ä¼™ä¼´è‚¯å®šä¼šæƒ³åˆ°springè‡ªå¸¦çš„é…ç½®æ–‡ä»¶ã€‚\né€šè¿‡é…ç½®æ–‡ä»¶çš„éš”ç¦»ï¼Œæˆ‘ä»¬å®Œå…¨èƒ½å¤Ÿéš”ç¦»å‡ºdevã€stagingã€prodç”šè‡³æ›´å¤šç¯å¢ƒçš„é…ç½®ã€‚æ¯å½“é…ç½®æœ‰å˜æ›´æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ç›¸åº”ç¯å¢ƒçš„é…ç½®ï¼Œå¹¶é‡æ–°éƒ¨ç½²å°±OKäº†ã€‚\n\n<font color=red >è¿™æ ·å¥½å—ï¼Ÿ</font>ç­”æ¡ˆæ˜¯æ²¡ä»€ä¹ˆä¸å¥½ã€‚<font color=red >ä½†æ˜¯ä¼˜é›…å—ï¼Ÿ</font>é‚£å¿…é¡»æ˜¯æŒ«çš„ä¸€å¡Œç³Šæ¶‚ã€‚\näº’è”ç½‘çš„æ ¹åŸºå°±æ˜¯å¿«é€Ÿå°è¯•ã€å¿«é€Ÿè½åœ°ã€åå¤å°è¯•ä»è€Œå¯»æ‰¾åˆ°æœ€ä¼˜çš„è§£å†³æ–¹æ¡ˆã€‚\nä¸šåŠ¡åœ¨ä¸æ–­çš„å°è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ–è®¸ä¼šè¹¦å‡ºä¸ªå¤§ç¥æ‹ç€è„‘è¢‹è¯´â€œæˆ‘è§‰å¾—å®¢æˆ·è¦çš„å°±æ˜¯è¿™ä¸ªï¼Œè¿™ä¹ˆé‚£ä¹ˆåšå‡†æ²¡é”™â€ã€‚ä½†ç°å®å¾€å¾€è¯æ˜æˆ‘ä»¬éƒ½æ˜¯æ™®é€šäººï¼Œæˆä¸ºåˆ«äººè‚šå­é‡Œçš„è›”è™«é‚£æ˜¯å¤šä¹ˆå›°éš¾çš„ä¸€ä»¶äº‹ã€‚\næ‰€ä»¥éœ€æ±‚çš„ååå¤å¤ï¼Œä»£ç çš„æ¥æ¥å›å›å°±æ˜¯ä¸€ä¸ªåç«¯ç‹—çš„æ—¥å¸¸ã€‚\n\n## é…ç½®ä¸­å¿ƒçš„å‡ºç°\né‚£åœ¨è¿™ç§å¿«é€Ÿå˜åŒ–çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä½œä¸ºå¼€å‘èƒ½åšäº›ä»€ä¹ˆå‘¢ï¼Ÿç­”æ¡ˆå…¶å®å¾ˆç®€ç­”ï¼Œå¤äººéƒ½è¯´äº†â€œå¤§é“åŒ–ç®€â€ï¼Œé‚£è‡ªç„¶æ˜¯æœ‰å˜åŒ–æˆ‘ä»¬å°±æ‹¥æŠ±å˜åŒ–ã€‚\nä½†ä¸€ä¸ªèªæ˜æˆ–è€…è¯´æ‡’æƒ°çš„ç¨‹åºå‘˜åœ¨æ‹¥æŠ±å˜åŒ–çš„åŒæ—¶æœ€é‡è¦çš„å·¥ä½œå°±æ˜¯å¯»æ‰¾é‚£ä¸ªä¸å˜ã€‚ä»£ç çš„æŠ½è±¡ã€ä¸šåŠ¡çš„æŠ½è±¡æ—¶æˆ‘ä»¬æ—¥åæœåŠ¡æ­å»ºçš„æ ¹åŸºã€‚è‡ªç„¶æˆ‘ä»¬ä¸Šé¢è¯´é“çš„é…ç½®å½“ç„¶ä¹Ÿæ˜¯ã€‚\n\nèªæ˜çš„ç¨‹åºå‘˜æ—©å°±æŠŠè¿™äº›ç¹æ‚çš„å·¥ä½œæŠ½ç¦»äº†å‡ºæ¥ï¼Œé…ç½®ä¸­å¿ƒè€Œç„¶è€Œç„¶çš„å­•è‚²å‡ºä¸–ã€‚ç™¾åº¦çš„Disconfã€æºç¨‹çš„Apolloã€é˜¿é‡Œçš„Nacosã€Spring Cloudçš„Spring Cloud Configã€‚\nåé¢æˆ‘ä¼šä¸“é—¨èŠèŠè¿™å‡ ä¸ªå¸¸è§çš„é…ç½®ä¸­å¿ƒçš„ä¼˜åŠ£ã€‚\n\n## æˆ‘ä¸ºä»€ä¹ˆæ‰‹æ’¸ä¸ªé…ç½®ä¸­å¿ƒ\né‚£è¿˜è¦å›åˆ°1å¹´å‰ï¼Œæˆ‘ä»¬å…¬å¸æœ€ä¸ºåˆ›ä¸šå…¬å¸ï¼Œä¸šåŠ¡åˆšåˆšèµ·æ­¥ã€‚ä¸ºäº†å¿«é€Ÿçš„ä¸šåŠ¡è½åœ°ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯èƒ½æ¥ä»€ä¹ˆå°±æ¥ä»€ä¹ˆï¼Œæ—¶é—´é•¿äº†æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼š<font color=red >å‘ç‰ˆæˆåˆ†å¤ªé«˜</font>ã€‚\n\nç›¸ä¿¡æ¯ä¸ªåšå¼€å‘çš„å°ä¼™ä¼´éƒ½æœ‰ä½“ä¼šï¼Œæ™šä¸Šå‘ç‰ˆæ˜¯ä¸€ä»¶å¤šä¹ˆè®©äººæƒ†æ€…çš„äº‹æƒ…å•Šã€‚ã€‚ã€‚ä½†æ›´è®©äººæƒ†æ€…çš„æ˜¯ï¼Œæœ¬æ¥åªæ˜¯ä¸€ä¸ªå°å°çš„é…ç½®å˜æ›´ï¼Œå´è¿˜è¦ç­‰åˆ°æ™šä¸Šæ‰èƒ½é‡æ–°ä¸Šçº¿ï¼Œç€å®è®©äººå—ä¸äº†ã€‚ä»é‚£ä¸ªæ—¶å€™å¼€å§‹ï¼Œæˆ‘ä»¬å°±æ‰“ç®—å¼•å…¥é…ç½®ä¸­å¿ƒäº†ã€‚\n\né¦–å…ˆè°ƒç ”é…ç½®ä¸­å¿ƒçš„å°ä¼™ä¼´ç»è¿‡å‡ ä¸ªç°å­˜å¼€æºç³»ç»Ÿçš„æ¯”è¾ƒï¼Œæœ€åé€‰å®šäº†ç™¾åº¦çš„Disconfã€‚è¯´ä¸Šå°±ä¸Šï¼ŒDisconfå°±åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­æ„‰å¿«çš„å¥”è·‘èµ·æ¥äº†ã€‚\n\n1å¹´è¿‡å»äº†ï¼Œç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œä¸šåŠ¡è¶Šæ¥è¶Šç¹çï¼Œå½“åˆé‚£ä¸ªäººè§äººçˆ±çš„Disconfä¸æ—¶çš„å˜æˆäº†æˆ‘ä»¬åˆé¥­æ—¶è¯Ÿç—…çš„è°ˆèµ„ã€‚å½“ç„¶å¹¶ä¸æ˜¯Disconfæœ¬èº«ä¸å¥½ï¼Œä¸è¿‡å¤±å»ç»´æŠ¤çš„ç¤¾åŒºæœ¬èº«ä¹Ÿæ˜¯å®ƒé—®é¢˜çš„ä¸€ç¯ã€‚ä½†æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼ŒDisconfæœ¬èº«å·²ç»æ…¢æ…¢ä¸é€‚åˆæˆ‘ä»¬çš„ä¸šåŠ¡äº†ã€‚å¯èƒ½ä¼šæœ‰äº›å°ä¼™ä¼´è¯´ï¼Œé‚£å°±ä½¿ç”¨æ›´å¼ºå¤§çš„Apolloï¼Œæˆ–è€…Nacosã€‚Apolloæœ¬èº«å›ºç„¶å¼ºå¤§ï¼Œä½†ä¸€ä¸ªç¬¬ä¸‰æ–¹ç³»ç»Ÿå§‹ç»ˆæ— æ³•å¥‘åˆæˆ‘ä»¬ç°åœ¨çš„ä¸šåŠ¡åœºæ™¯ï¼ŒNacosä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ï¼Œæ‰å¤–ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Spring Cloudçš„å…¨å®¶æ¡¶ï¼Œè‹¥å¼•å…¥Nacosï¼Œå¿…ç„¶éœ€è¦å‡çº§åˆ°Alibaba Spring Cloudã€‚æƒ³å¿…é£é™©å’Œå·¥ä½œé‡åªå¢æ— å‡ã€‚\n\nå› æ­¤åœ¨è¿™æ ·çš„ä¸€ä¸ªå¤§å‰æä¸‹ï¼Œæˆ‘ä»¬å†’å‡ºäº†â€œæˆ‘ä»€ä¹ˆä¸è‡ªå·±æ‰‹æ’¸ä¸ªé…ç½®ä¸­å¿ƒâ€çš„æƒ³æ³•ã€‚\n\n## é…ç½®ä¸­å¿ƒ nadia-config\nè‡ªæˆ‘æ‰“ä¸ªå¹¿å‘Šï¼Œæˆ‘çš„é…ç½®ä¸­å¿ƒå·²ç»ä¸Šçº¿äº†ï¼Œå¹¶ä¸”ç¬¬ä¸€ç‰ˆä¹Ÿå·²ç»å¼€æºï¼Œæ¬¢è¿å¤§å®¶æ‹ç – \n>https://github.com/nadia-repository/nadia-config\n\n","slug":"æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-èµ·æºç¯‡","published":1,"updated":"2020-12-14T09:51:24.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71hto001dv2527yj851zv","content":"<html><head></head><body><h2 id=\"&#x804A;&#x804A;&#x540E;&#x7AEF;&#x7684;&#x5DE5;&#x4F5C;\"><a href=\"#&#x804A;&#x804A;&#x540E;&#x7AEF;&#x7684;&#x5DE5;&#x4F5C;\" class=\"headerlink\" title=\"&#x804A;&#x804A;&#x540E;&#x7AEF;&#x7684;&#x5DE5;&#x4F5C;\"></a>&#x804A;&#x804A;&#x540E;&#x7AEF;&#x7684;&#x5DE5;&#x4F5C;</h2><p>&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x540E;&#x7AEF;&#x72D7;&#x6700;&#x6015;&#x7684;&#x6709;&#x51E0;&#x4EF6;&#x4E8B;&#xFF1A;</p>\n<ol>\n<li>&#x9700;&#x6C42;&#x505A;&#x4E5F;&#x505A;&#x4E0D;&#x5B8C;&#x5C31;&#x7F62;&#x8FBD;&#xFF0C;&#x9694;&#x4E09;&#x5DEE;&#x4E94;&#x7684;&#x4E1A;&#x52A1;&#x540C;&#x5B66;&#x8FD8;&#x4F1A;&#x8DD1;&#x6765;&#x8BF4;&#x201C;&#x5927;&#x9505;&#xFF0C;&#x6628;&#x5929;&#x4E0A;&#x67B6;&#x7684;&#x4EA7;&#x54C1;&#x9EBB;&#x70E6;&#x8C03;&#x6574;&#x4E0B;&#x6587;&#x6848;&#x201D;&#x3002;&#x3002;&#x3002;</li>\n<li>&#x597D;&#x4E0D;&#x5BB9;&#x6613;&#x505A;&#x5B8C;&#x4E86;&#x9700;&#x6C42;&#x5E76;&#x4E14;&#x71AC;&#x5230;&#x4E86;&#x4E0A;&#x7EBF;&#xFF0C;&#x7B2C;&#x4E8C;&#x5929;&#x4EA7;&#x54C1;&#x8FC7;&#x6765;&#x8BF4;&#x201C;&#x8001;&#x5F1F;&#xFF0C;&#x90A3;&#x4E2A;&#x9700;&#x6C42;&#x88AB;&#x76D1;&#x7BA1;&#x90E8;&#x95E8;&#x52D2;&#x4EE4;&#x4E0B;&#x67B6;&#x4E86;&#xFF0C;&#x80FD;&#x628A;&#x90A3;&#x4E2A;&#x529F;&#x80FD;&#x4E0B;&#x4E86;&#x4E0D;&#x201D;&#x3002;&#x3002;&#x3002;</li>\n<li>&#x4EE3;&#x7801;&#x6572;&#x7684;&#x5F00;&#x5FC3;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9694;&#x58C1;&#x8001;&#x5927;&#x8DD1;&#x8FC7;&#x6765;&#x8BF4;&#x201C;&#x5144;&#x5F1F;&#xFF0C;&#x4E4B;&#x524D;&#x90A3;&#x4E2A;XX&#x62A5;&#x8868;&#x4E0D;&#x9519;&#x554A;&#xFF0C;&#x4E5F;&#x5B9A;&#x65F6;&#x53D1;&#x6211;&#x4E00;&#x4EFD;&#x201D;&#x3002;&#x3002;&#x3002;<a id=\"more\"></a>\n&#x4E0A;&#x9762;&#x7684;&#x573A;&#x666F;&#x5927;&#x5BB6;&#x8BA4;&#x8BC6;&#x6211;&#x7684;&#x4E0D;&#x8981;&#x5BF9;&#x53F7;&#x5165;&#x5EA7;&#x54C8;&#xFF0C;&#x4F5C;&#x4E3A;&#x4E2A;&#x540E;&#x7AEF;&#x72D7;&#xFF0C;&#x6700;&#x6015;&#x7684;&#x5C31;&#x662F;&#x91CD;&#x590D;&#x52B3;&#x52A8;&#x3002;</li>\n</ol>\n<p>&#x4EA7;&#x54C1;&#x7684;&#x6587;&#x6848;&#x3001;&#x4E1A;&#x52A1;&#x7684;&#x5F00;&#x5173;&#x3001;&#x62A5;&#x8868;&#x7684;&#x6536;&#x4EF6;&#x4EBA;&#x7B49;&#x7B49;&#x8FD9;&#x4E9B;&#x6211;&#x4EEC;&#x90FD;&#x53EF;&#x4EE5;&#x53EB;&#x505A;&#x4E1A;&#x52A1;&#x914D;&#x7F6E;&#xFF0C;&#x4E00;&#x4E2A;&#x5408;&#x683C;&#x7684;&#x5F00;&#x53D1;&#x4E5F;&#x80FD;&#x5728;&#x9700;&#x6C42;&#x8BBE;&#x8BA1;&#x9636;&#x6BB5;&#x5C06;&#x8FD9;&#x4E9B;&#x914D;&#x7F6E;&#x4ECE;&#x9700;&#x6C42;&#x4E2D;&#x63D0;&#x70BC;&#x51FA;&#x6765;&#x5E76;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x5316;&#xFF0C;&#x65B9;&#x4FBF;&#x65E5;&#x540E;&#x7684;&#x53D8;&#x66F4;&#x3002;<br>&#x90A3;&#x4E48;&#xFF0C;&#x4E0D;&#x662F;&#x8BF4;&#x914D;&#x7F6E;&#x80FD;&#x53D8;&#x66F4;&#x6211;&#x4EEC;&#x5C31;&#x6CA1;&#x4E8B;&#x4E86;&#x3002;</p>\n<p>&#x9996;&#x5148;&#xFF0C;&#x5982;&#x679C;&#x57FA;&#x4E8E;spring&#x5F00;&#x53D1;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x80AF;&#x5B9A;&#x4F1A;&#x60F3;&#x5230;spring&#x81EA;&#x5E26;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;<br>&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x9694;&#x79BB;&#xFF0C;&#x6211;&#x4EEC;&#x5B8C;&#x5168;&#x80FD;&#x591F;&#x9694;&#x79BB;&#x51FA;dev&#x3001;staging&#x3001;prod&#x751A;&#x81F3;&#x66F4;&#x591A;&#x73AF;&#x5883;&#x7684;&#x914D;&#x7F6E;&#x3002;&#x6BCF;&#x5F53;&#x914D;&#x7F6E;&#x6709;&#x53D8;&#x66F4;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x76F8;&#x5E94;&#x73AF;&#x5883;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x5E76;&#x91CD;&#x65B0;&#x90E8;&#x7F72;&#x5C31;OK&#x4E86;&#x3002;</p>\n<p><font color=\"red\">&#x8FD9;&#x6837;&#x597D;&#x5417;&#xFF1F;</font>&#x7B54;&#x6848;&#x662F;&#x6CA1;&#x4EC0;&#x4E48;&#x4E0D;&#x597D;&#x3002;<font color=\"red\">&#x4F46;&#x662F;&#x4F18;&#x96C5;&#x5417;&#xFF1F;</font>&#x90A3;&#x5FC5;&#x987B;&#x662F;&#x632B;&#x7684;&#x4E00;&#x584C;&#x7CCA;&#x6D82;&#x3002;<br>&#x4E92;&#x8054;&#x7F51;&#x7684;&#x6839;&#x57FA;&#x5C31;&#x662F;&#x5FEB;&#x901F;&#x5C1D;&#x8BD5;&#x3001;&#x5FEB;&#x901F;&#x843D;&#x5730;&#x3001;&#x53CD;&#x590D;&#x5C1D;&#x8BD5;&#x4ECE;&#x800C;&#x5BFB;&#x627E;&#x5230;&#x6700;&#x4F18;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002;<br>&#x4E1A;&#x52A1;&#x5728;&#x4E0D;&#x65AD;&#x7684;&#x5C1D;&#x8BD5;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6216;&#x8BB8;&#x4F1A;&#x8E66;&#x51FA;&#x4E2A;&#x5927;&#x795E;&#x62CD;&#x7740;&#x8111;&#x888B;&#x8BF4;&#x201C;&#x6211;&#x89C9;&#x5F97;&#x5BA2;&#x6237;&#x8981;&#x7684;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#xFF0C;&#x8FD9;&#x4E48;&#x90A3;&#x4E48;&#x505A;&#x51C6;&#x6CA1;&#x9519;&#x201D;&#x3002;&#x4F46;&#x73B0;&#x5B9E;&#x5F80;&#x5F80;&#x8BC1;&#x660E;&#x6211;&#x4EEC;&#x90FD;&#x662F;&#x666E;&#x901A;&#x4EBA;&#xFF0C;&#x6210;&#x4E3A;&#x522B;&#x4EBA;&#x809A;&#x5B50;&#x91CC;&#x7684;&#x86D4;&#x866B;&#x90A3;&#x662F;&#x591A;&#x4E48;&#x56F0;&#x96BE;&#x7684;&#x4E00;&#x4EF6;&#x4E8B;&#x3002;<br>&#x6240;&#x4EE5;&#x9700;&#x6C42;&#x7684;&#x53CD;&#x53CD;&#x590D;&#x590D;&#xFF0C;&#x4EE3;&#x7801;&#x7684;&#x6765;&#x6765;&#x56DE;&#x56DE;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x540E;&#x7AEF;&#x72D7;&#x7684;&#x65E5;&#x5E38;&#x3002;</p>\n<h2 id=\"&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x51FA;&#x73B0;\"><a href=\"#&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x51FA;&#x73B0;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x51FA;&#x73B0;\"></a>&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x51FA;&#x73B0;</h2><p>&#x90A3;&#x5728;&#x8FD9;&#x79CD;&#x5FEB;&#x901F;&#x53D8;&#x5316;&#x7684;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x4F5C;&#x4E3A;&#x5F00;&#x53D1;&#x80FD;&#x505A;&#x4E9B;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x7B54;&#x6848;&#x5176;&#x5B9E;&#x5F88;&#x7B80;&#x7B54;&#xFF0C;&#x53E4;&#x4EBA;&#x90FD;&#x8BF4;&#x4E86;&#x201C;&#x5927;&#x9053;&#x5316;&#x7B80;&#x201D;&#xFF0C;&#x90A3;&#x81EA;&#x7136;&#x662F;&#x6709;&#x53D8;&#x5316;&#x6211;&#x4EEC;&#x5C31;&#x62E5;&#x62B1;&#x53D8;&#x5316;&#x3002;<br>&#x4F46;&#x4E00;&#x4E2A;&#x806A;&#x660E;&#x6216;&#x8005;&#x8BF4;&#x61D2;&#x60F0;&#x7684;&#x7A0B;&#x5E8F;&#x5458;&#x5728;&#x62E5;&#x62B1;&#x53D8;&#x5316;&#x7684;&#x540C;&#x65F6;&#x6700;&#x91CD;&#x8981;&#x7684;&#x5DE5;&#x4F5C;&#x5C31;&#x662F;&#x5BFB;&#x627E;&#x90A3;&#x4E2A;&#x4E0D;&#x53D8;&#x3002;&#x4EE3;&#x7801;&#x7684;&#x62BD;&#x8C61;&#x3001;&#x4E1A;&#x52A1;&#x7684;&#x62BD;&#x8C61;&#x65F6;&#x6211;&#x4EEC;&#x65E5;&#x540E;&#x670D;&#x52A1;&#x642D;&#x5EFA;&#x7684;&#x6839;&#x57FA;&#x3002;&#x81EA;&#x7136;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x8BF4;&#x9053;&#x7684;&#x914D;&#x7F6E;&#x5F53;&#x7136;&#x4E5F;&#x662F;&#x3002;</p>\n<p>&#x806A;&#x660E;&#x7684;&#x7A0B;&#x5E8F;&#x5458;&#x65E9;&#x5C31;&#x628A;&#x8FD9;&#x4E9B;&#x7E41;&#x6742;&#x7684;&#x5DE5;&#x4F5C;&#x62BD;&#x79BB;&#x4E86;&#x51FA;&#x6765;&#xFF0C;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x800C;&#x7136;&#x800C;&#x7136;&#x7684;&#x5B55;&#x80B2;&#x51FA;&#x4E16;&#x3002;&#x767E;&#x5EA6;&#x7684;Disconf&#x3001;&#x643A;&#x7A0B;&#x7684;Apollo&#x3001;&#x963F;&#x91CC;&#x7684;Nacos&#x3001;Spring Cloud&#x7684;Spring Cloud Config&#x3002;<br>&#x540E;&#x9762;&#x6211;&#x4F1A;&#x4E13;&#x95E8;&#x804A;&#x804A;&#x8FD9;&#x51E0;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x4F18;&#x52A3;&#x3002;</p>\n<h2 id=\"&#x6211;&#x4E3A;&#x4EC0;&#x4E48;&#x624B;&#x64B8;&#x4E2A;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;\"><a href=\"#&#x6211;&#x4E3A;&#x4EC0;&#x4E48;&#x624B;&#x64B8;&#x4E2A;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;\" class=\"headerlink\" title=\"&#x6211;&#x4E3A;&#x4EC0;&#x4E48;&#x624B;&#x64B8;&#x4E2A;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;\"></a>&#x6211;&#x4E3A;&#x4EC0;&#x4E48;&#x624B;&#x64B8;&#x4E2A;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;</h2><p>&#x90A3;&#x8FD8;&#x8981;&#x56DE;&#x5230;1&#x5E74;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x516C;&#x53F8;&#x6700;&#x4E3A;&#x521B;&#x4E1A;&#x516C;&#x53F8;&#xFF0C;&#x4E1A;&#x52A1;&#x521A;&#x521A;&#x8D77;&#x6B65;&#x3002;&#x4E3A;&#x4E86;&#x5FEB;&#x901F;&#x7684;&#x4E1A;&#x52A1;&#x843D;&#x5730;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x662F;&#x80FD;&#x6765;&#x4EC0;&#x4E48;&#x5C31;&#x6765;&#x4EC0;&#x4E48;&#xFF0C;&#x65F6;&#x95F4;&#x957F;&#x4E86;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x4E86;&#x4E00;&#x4E2A;&#x5F88;&#x91CD;&#x8981;&#x7684;&#x95EE;&#x9898;&#xFF1A;<font color=\"red\">&#x53D1;&#x7248;&#x6210;&#x5206;&#x592A;&#x9AD8;</font>&#x3002;</p>\n<p>&#x76F8;&#x4FE1;&#x6BCF;&#x4E2A;&#x505A;&#x5F00;&#x53D1;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x90FD;&#x6709;&#x4F53;&#x4F1A;&#xFF0C;&#x665A;&#x4E0A;&#x53D1;&#x7248;&#x662F;&#x4E00;&#x4EF6;&#x591A;&#x4E48;&#x8BA9;&#x4EBA;&#x60C6;&#x6005;&#x7684;&#x4E8B;&#x60C5;&#x554A;&#x3002;&#x3002;&#x3002;&#x4F46;&#x66F4;&#x8BA9;&#x4EBA;&#x60C6;&#x6005;&#x7684;&#x662F;&#xFF0C;&#x672C;&#x6765;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x5C0F;&#x5C0F;&#x7684;&#x914D;&#x7F6E;&#x53D8;&#x66F4;&#xFF0C;&#x5374;&#x8FD8;&#x8981;&#x7B49;&#x5230;&#x665A;&#x4E0A;&#x624D;&#x80FD;&#x91CD;&#x65B0;&#x4E0A;&#x7EBF;&#xFF0C;&#x7740;&#x5B9E;&#x8BA9;&#x4EBA;&#x53D7;&#x4E0D;&#x4E86;&#x3002;&#x4ECE;&#x90A3;&#x4E2A;&#x65F6;&#x5019;&#x5F00;&#x59CB;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x6253;&#x7B97;&#x5F15;&#x5165;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x4E86;&#x3002;</p>\n<p>&#x9996;&#x5148;&#x8C03;&#x7814;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x5C0F;&#x4F19;&#x4F34;&#x7ECF;&#x8FC7;&#x51E0;&#x4E2A;&#x73B0;&#x5B58;&#x5F00;&#x6E90;&#x7CFB;&#x7EDF;&#x7684;&#x6BD4;&#x8F83;&#xFF0C;&#x6700;&#x540E;&#x9009;&#x5B9A;&#x4E86;&#x767E;&#x5EA6;&#x7684;Disconf&#x3002;&#x8BF4;&#x4E0A;&#x5C31;&#x4E0A;&#xFF0C;Disconf&#x5C31;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x7CFB;&#x7EDF;&#x4E2D;&#x6109;&#x5FEB;&#x7684;&#x5954;&#x8DD1;&#x8D77;&#x6765;&#x4E86;&#x3002;</p>\n<p>1&#x5E74;&#x8FC7;&#x53BB;&#x4E86;&#xFF0C;&#x7CFB;&#x7EDF;&#x8D8A;&#x6765;&#x8D8A;&#x590D;&#x6742;&#xFF0C;&#x4E1A;&#x52A1;&#x8D8A;&#x6765;&#x8D8A;&#x7E41;&#x7410;&#xFF0C;&#x5F53;&#x521D;&#x90A3;&#x4E2A;&#x4EBA;&#x89C1;&#x4EBA;&#x7231;&#x7684;Disconf&#x4E0D;&#x65F6;&#x7684;&#x53D8;&#x6210;&#x4E86;&#x6211;&#x4EEC;&#x5348;&#x996D;&#x65F6;&#x8BDF;&#x75C5;&#x7684;&#x8C08;&#x8D44;&#x3002;&#x5F53;&#x7136;&#x5E76;&#x4E0D;&#x662F;Disconf&#x672C;&#x8EAB;&#x4E0D;&#x597D;&#xFF0C;&#x4E0D;&#x8FC7;&#x5931;&#x53BB;&#x7EF4;&#x62A4;&#x7684;&#x793E;&#x533A;&#x672C;&#x8EAB;&#x4E5F;&#x662F;&#x5B83;&#x95EE;&#x9898;&#x7684;&#x4E00;&#x73AF;&#x3002;&#x4F46;&#x6700;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x70B9;&#x662F;&#xFF0C;Disconf&#x672C;&#x8EAB;&#x5DF2;&#x7ECF;&#x6162;&#x6162;&#x4E0D;&#x9002;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x4E1A;&#x52A1;&#x4E86;&#x3002;&#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x4E9B;&#x5C0F;&#x4F19;&#x4F34;&#x8BF4;&#xFF0C;&#x90A3;&#x5C31;&#x4F7F;&#x7528;&#x66F4;&#x5F3A;&#x5927;&#x7684;Apollo&#xFF0C;&#x6216;&#x8005;Nacos&#x3002;Apollo&#x672C;&#x8EAB;&#x56FA;&#x7136;&#x5F3A;&#x5927;&#xFF0C;&#x4F46;&#x4E00;&#x4E2A;&#x7B2C;&#x4E09;&#x65B9;&#x7CFB;&#x7EDF;&#x59CB;&#x7EC8;&#x65E0;&#x6CD5;&#x5951;&#x5408;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x7684;&#x4E1A;&#x52A1;&#x573A;&#x666F;&#xFF0C;Nacos&#x4E5F;&#x6709;&#x540C;&#x6837;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x624D;&#x5916;&#x7531;&#x4E8E;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x7684;&#x662F;Spring Cloud&#x7684;&#x5168;&#x5BB6;&#x6876;&#xFF0C;&#x82E5;&#x5F15;&#x5165;Nacos&#xFF0C;&#x5FC5;&#x7136;&#x9700;&#x8981;&#x5347;&#x7EA7;&#x5230;Alibaba Spring Cloud&#x3002;&#x60F3;&#x5FC5;&#x98CE;&#x9669;&#x548C;&#x5DE5;&#x4F5C;&#x91CF;&#x53EA;&#x589E;&#x65E0;&#x51CF;&#x3002;</p>\n<p>&#x56E0;&#x6B64;&#x5728;&#x8FD9;&#x6837;&#x7684;&#x4E00;&#x4E2A;&#x5927;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x6211;&#x4EEC;&#x5192;&#x51FA;&#x4E86;&#x201C;&#x6211;&#x4EC0;&#x4E48;&#x4E0D;&#x81EA;&#x5DF1;&#x624B;&#x64B8;&#x4E2A;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x201D;&#x7684;&#x60F3;&#x6CD5;&#x3002;</p>\n<h2 id=\"&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;-nadia-config\"><a href=\"#&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;-nadia-config\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;&#x4E2D;&#x5FC3; nadia-config\"></a>&#x914D;&#x7F6E;&#x4E2D;&#x5FC3; nadia-config</h2><p>&#x81EA;&#x6211;&#x6253;&#x4E2A;&#x5E7F;&#x544A;&#xFF0C;&#x6211;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x5DF2;&#x7ECF;&#x4E0A;&#x7EBF;&#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x7B2C;&#x4E00;&#x7248;&#x4E5F;&#x5DF2;&#x7ECF;&#x5F00;&#x6E90;&#xFF0C;&#x6B22;&#x8FCE;&#x5927;&#x5BB6;&#x62CD;&#x7816; </p>\n<blockquote>\n<p><a href=\"https://github.com/nadia-repository/nadia-config\">https://github.com/nadia-repository/nadia-config</a></p>\n</blockquote>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Redis","path":"tags/Redis/"},{"name":"é…ç½®ä¸­å¿ƒ","path":"tags/é…ç½®ä¸­å¿ƒ/"}],"excerpt":"<html><head></head><body><h2 id=\"&#x804A;&#x804A;&#x540E;&#x7AEF;&#x7684;&#x5DE5;&#x4F5C;\"><a href=\"#&#x804A;&#x804A;&#x540E;&#x7AEF;&#x7684;&#x5DE5;&#x4F5C;\" class=\"headerlink\" title=\"&#x804A;&#x804A;&#x540E;&#x7AEF;&#x7684;&#x5DE5;&#x4F5C;\"></a>&#x804A;&#x804A;&#x540E;&#x7AEF;&#x7684;&#x5DE5;&#x4F5C;</h2><p>&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x540E;&#x7AEF;&#x72D7;&#x6700;&#x6015;&#x7684;&#x6709;&#x51E0;&#x4EF6;&#x4E8B;&#xFF1A;</p>\n<ol>\n<li>&#x9700;&#x6C42;&#x505A;&#x4E5F;&#x505A;&#x4E0D;&#x5B8C;&#x5C31;&#x7F62;&#x8FBD;&#xFF0C;&#x9694;&#x4E09;&#x5DEE;&#x4E94;&#x7684;&#x4E1A;&#x52A1;&#x540C;&#x5B66;&#x8FD8;&#x4F1A;&#x8DD1;&#x6765;&#x8BF4;&#x201C;&#x5927;&#x9505;&#xFF0C;&#x6628;&#x5929;&#x4E0A;&#x67B6;&#x7684;&#x4EA7;&#x54C1;&#x9EBB;&#x70E6;&#x8C03;&#x6574;&#x4E0B;&#x6587;&#x6848;&#x201D;&#x3002;&#x3002;&#x3002;</li>\n<li>&#x597D;&#x4E0D;&#x5BB9;&#x6613;&#x505A;&#x5B8C;&#x4E86;&#x9700;&#x6C42;&#x5E76;&#x4E14;&#x71AC;&#x5230;&#x4E86;&#x4E0A;&#x7EBF;&#xFF0C;&#x7B2C;&#x4E8C;&#x5929;&#x4EA7;&#x54C1;&#x8FC7;&#x6765;&#x8BF4;&#x201C;&#x8001;&#x5F1F;&#xFF0C;&#x90A3;&#x4E2A;&#x9700;&#x6C42;&#x88AB;&#x76D1;&#x7BA1;&#x90E8;&#x95E8;&#x52D2;&#x4EE4;&#x4E0B;&#x67B6;&#x4E86;&#xFF0C;&#x80FD;&#x628A;&#x90A3;&#x4E2A;&#x529F;&#x80FD;&#x4E0B;&#x4E86;&#x4E0D;&#x201D;&#x3002;&#x3002;&#x3002;</li>\n<li>&#x4EE3;&#x7801;&#x6572;&#x7684;&#x5F00;&#x5FC3;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x9694;&#x58C1;&#x8001;&#x5927;&#x8DD1;&#x8FC7;&#x6765;&#x8BF4;&#x201C;&#x5144;&#x5F1F;&#xFF0C;&#x4E4B;&#x524D;&#x90A3;&#x4E2A;XX&#x62A5;&#x8868;&#x4E0D;&#x9519;&#x554A;&#xFF0C;&#x4E5F;&#x5B9A;&#x65F6;&#x53D1;&#x6211;&#x4E00;&#x4EFD;&#x201D;&#x3002;&#x3002;&#x3002;</li></ol></body></html>","more":"ä¸Šé¢çš„åœºæ™¯å¤§å®¶è®¤è¯†æˆ‘çš„ä¸è¦å¯¹å·å…¥åº§å“ˆï¼Œä½œä¸ºä¸ªåç«¯ç‹—ï¼Œæœ€æ€•çš„å°±æ˜¯é‡å¤åŠ³åŠ¨ã€‚\n\n<p>äº§å“çš„æ–‡æ¡ˆã€ä¸šåŠ¡çš„å¼€å…³ã€æŠ¥è¡¨çš„æ”¶ä»¶äººç­‰ç­‰è¿™äº›æˆ‘ä»¬éƒ½å¯ä»¥å«åšä¸šåŠ¡é…ç½®ï¼Œä¸€ä¸ªåˆæ ¼çš„å¼€å‘ä¹Ÿèƒ½åœ¨éœ€æ±‚è®¾è®¡é˜¶æ®µå°†è¿™äº›é…ç½®ä»éœ€æ±‚ä¸­æç‚¼å‡ºæ¥å¹¶è¿›è¡Œé…ç½®åŒ–ï¼Œæ–¹ä¾¿æ—¥åçš„å˜æ›´ã€‚<br>é‚£ä¹ˆï¼Œä¸æ˜¯è¯´é…ç½®èƒ½å˜æ›´æˆ‘ä»¬å°±æ²¡äº‹äº†ã€‚</p>\n<p>é¦–å…ˆï¼Œå¦‚æœåŸºäºspringå¼€å‘çš„å°ä¼™ä¼´è‚¯å®šä¼šæƒ³åˆ°springè‡ªå¸¦çš„é…ç½®æ–‡ä»¶ã€‚<br>é€šè¿‡é…ç½®æ–‡ä»¶çš„éš”ç¦»ï¼Œæˆ‘ä»¬å®Œå…¨èƒ½å¤Ÿéš”ç¦»å‡ºdevã€stagingã€prodç”šè‡³æ›´å¤šç¯å¢ƒçš„é…ç½®ã€‚æ¯å½“é…ç½®æœ‰å˜æ›´æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ç›¸åº”ç¯å¢ƒçš„é…ç½®ï¼Œå¹¶é‡æ–°éƒ¨ç½²å°±OKäº†ã€‚</p>\n<p><font color=\"red\">è¿™æ ·å¥½å—ï¼Ÿ</font>ç­”æ¡ˆæ˜¯æ²¡ä»€ä¹ˆä¸å¥½ã€‚<font color=\"red\">ä½†æ˜¯ä¼˜é›…å—ï¼Ÿ</font>é‚£å¿…é¡»æ˜¯æŒ«çš„ä¸€å¡Œç³Šæ¶‚ã€‚<br>äº’è”ç½‘çš„æ ¹åŸºå°±æ˜¯å¿«é€Ÿå°è¯•ã€å¿«é€Ÿè½åœ°ã€åå¤å°è¯•ä»è€Œå¯»æ‰¾åˆ°æœ€ä¼˜çš„è§£å†³æ–¹æ¡ˆã€‚<br>ä¸šåŠ¡åœ¨ä¸æ–­çš„å°è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ–è®¸ä¼šè¹¦å‡ºä¸ªå¤§ç¥æ‹ç€è„‘è¢‹è¯´â€œæˆ‘è§‰å¾—å®¢æˆ·è¦çš„å°±æ˜¯è¿™ä¸ªï¼Œè¿™ä¹ˆé‚£ä¹ˆåšå‡†æ²¡é”™â€ã€‚ä½†ç°å®å¾€å¾€è¯æ˜æˆ‘ä»¬éƒ½æ˜¯æ™®é€šäººï¼Œæˆä¸ºåˆ«äººè‚šå­é‡Œçš„è›”è™«é‚£æ˜¯å¤šä¹ˆå›°éš¾çš„ä¸€ä»¶äº‹ã€‚<br>æ‰€ä»¥éœ€æ±‚çš„ååå¤å¤ï¼Œä»£ç çš„æ¥æ¥å›å›å°±æ˜¯ä¸€ä¸ªåç«¯ç‹—çš„æ—¥å¸¸ã€‚</p>\n<h2 id=\"é…ç½®ä¸­å¿ƒçš„å‡ºç°\"><a href=\"#é…ç½®ä¸­å¿ƒçš„å‡ºç°\" class=\"headerlink\" title=\"é…ç½®ä¸­å¿ƒçš„å‡ºç°\"></a>é…ç½®ä¸­å¿ƒçš„å‡ºç°</h2><p>é‚£åœ¨è¿™ç§å¿«é€Ÿå˜åŒ–çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä½œä¸ºå¼€å‘èƒ½åšäº›ä»€ä¹ˆå‘¢ï¼Ÿç­”æ¡ˆå…¶å®å¾ˆç®€ç­”ï¼Œå¤äººéƒ½è¯´äº†â€œå¤§é“åŒ–ç®€â€ï¼Œé‚£è‡ªç„¶æ˜¯æœ‰å˜åŒ–æˆ‘ä»¬å°±æ‹¥æŠ±å˜åŒ–ã€‚<br>ä½†ä¸€ä¸ªèªæ˜æˆ–è€…è¯´æ‡’æƒ°çš„ç¨‹åºå‘˜åœ¨æ‹¥æŠ±å˜åŒ–çš„åŒæ—¶æœ€é‡è¦çš„å·¥ä½œå°±æ˜¯å¯»æ‰¾é‚£ä¸ªä¸å˜ã€‚ä»£ç çš„æŠ½è±¡ã€ä¸šåŠ¡çš„æŠ½è±¡æ—¶æˆ‘ä»¬æ—¥åæœåŠ¡æ­å»ºçš„æ ¹åŸºã€‚è‡ªç„¶æˆ‘ä»¬ä¸Šé¢è¯´é“çš„é…ç½®å½“ç„¶ä¹Ÿæ˜¯ã€‚</p>\n<p>èªæ˜çš„ç¨‹åºå‘˜æ—©å°±æŠŠè¿™äº›ç¹æ‚çš„å·¥ä½œæŠ½ç¦»äº†å‡ºæ¥ï¼Œé…ç½®ä¸­å¿ƒè€Œç„¶è€Œç„¶çš„å­•è‚²å‡ºä¸–ã€‚ç™¾åº¦çš„Disconfã€æºç¨‹çš„Apolloã€é˜¿é‡Œçš„Nacosã€Spring Cloudçš„Spring Cloud Configã€‚<br>åé¢æˆ‘ä¼šä¸“é—¨èŠèŠè¿™å‡ ä¸ªå¸¸è§çš„é…ç½®ä¸­å¿ƒçš„ä¼˜åŠ£ã€‚</p>\n<h2 id=\"æˆ‘ä¸ºä»€ä¹ˆæ‰‹æ’¸ä¸ªé…ç½®ä¸­å¿ƒ\"><a href=\"#æˆ‘ä¸ºä»€ä¹ˆæ‰‹æ’¸ä¸ªé…ç½®ä¸­å¿ƒ\" class=\"headerlink\" title=\"æˆ‘ä¸ºä»€ä¹ˆæ‰‹æ’¸ä¸ªé…ç½®ä¸­å¿ƒ\"></a>æˆ‘ä¸ºä»€ä¹ˆæ‰‹æ’¸ä¸ªé…ç½®ä¸­å¿ƒ</h2><p>é‚£è¿˜è¦å›åˆ°1å¹´å‰ï¼Œæˆ‘ä»¬å…¬å¸æœ€ä¸ºåˆ›ä¸šå…¬å¸ï¼Œä¸šåŠ¡åˆšåˆšèµ·æ­¥ã€‚ä¸ºäº†å¿«é€Ÿçš„ä¸šåŠ¡è½åœ°ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯èƒ½æ¥ä»€ä¹ˆå°±æ¥ä»€ä¹ˆï¼Œæ—¶é—´é•¿äº†æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼š<font color=\"red\">å‘ç‰ˆæˆåˆ†å¤ªé«˜</font>ã€‚</p>\n<p>ç›¸ä¿¡æ¯ä¸ªåšå¼€å‘çš„å°ä¼™ä¼´éƒ½æœ‰ä½“ä¼šï¼Œæ™šä¸Šå‘ç‰ˆæ˜¯ä¸€ä»¶å¤šä¹ˆè®©äººæƒ†æ€…çš„äº‹æƒ…å•Šã€‚ã€‚ã€‚ä½†æ›´è®©äººæƒ†æ€…çš„æ˜¯ï¼Œæœ¬æ¥åªæ˜¯ä¸€ä¸ªå°å°çš„é…ç½®å˜æ›´ï¼Œå´è¿˜è¦ç­‰åˆ°æ™šä¸Šæ‰èƒ½é‡æ–°ä¸Šçº¿ï¼Œç€å®è®©äººå—ä¸äº†ã€‚ä»é‚£ä¸ªæ—¶å€™å¼€å§‹ï¼Œæˆ‘ä»¬å°±æ‰“ç®—å¼•å…¥é…ç½®ä¸­å¿ƒäº†ã€‚</p>\n<p>é¦–å…ˆè°ƒç ”é…ç½®ä¸­å¿ƒçš„å°ä¼™ä¼´ç»è¿‡å‡ ä¸ªç°å­˜å¼€æºç³»ç»Ÿçš„æ¯”è¾ƒï¼Œæœ€åé€‰å®šäº†ç™¾åº¦çš„Disconfã€‚è¯´ä¸Šå°±ä¸Šï¼ŒDisconfå°±åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­æ„‰å¿«çš„å¥”è·‘èµ·æ¥äº†ã€‚</p>\n<p>1å¹´è¿‡å»äº†ï¼Œç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œä¸šåŠ¡è¶Šæ¥è¶Šç¹çï¼Œå½“åˆé‚£ä¸ªäººè§äººçˆ±çš„Disconfä¸æ—¶çš„å˜æˆäº†æˆ‘ä»¬åˆé¥­æ—¶è¯Ÿç—…çš„è°ˆèµ„ã€‚å½“ç„¶å¹¶ä¸æ˜¯Disconfæœ¬èº«ä¸å¥½ï¼Œä¸è¿‡å¤±å»ç»´æŠ¤çš„ç¤¾åŒºæœ¬èº«ä¹Ÿæ˜¯å®ƒé—®é¢˜çš„ä¸€ç¯ã€‚ä½†æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼ŒDisconfæœ¬èº«å·²ç»æ…¢æ…¢ä¸é€‚åˆæˆ‘ä»¬çš„ä¸šåŠ¡äº†ã€‚å¯èƒ½ä¼šæœ‰äº›å°ä¼™ä¼´è¯´ï¼Œé‚£å°±ä½¿ç”¨æ›´å¼ºå¤§çš„Apolloï¼Œæˆ–è€…Nacosã€‚Apolloæœ¬èº«å›ºç„¶å¼ºå¤§ï¼Œä½†ä¸€ä¸ªç¬¬ä¸‰æ–¹ç³»ç»Ÿå§‹ç»ˆæ— æ³•å¥‘åˆæˆ‘ä»¬ç°åœ¨çš„ä¸šåŠ¡åœºæ™¯ï¼ŒNacosä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ï¼Œæ‰å¤–ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Spring Cloudçš„å…¨å®¶æ¡¶ï¼Œè‹¥å¼•å…¥Nacosï¼Œå¿…ç„¶éœ€è¦å‡çº§åˆ°Alibaba Spring Cloudã€‚æƒ³å¿…é£é™©å’Œå·¥ä½œé‡åªå¢æ— å‡ã€‚</p>\n<p>å› æ­¤åœ¨è¿™æ ·çš„ä¸€ä¸ªå¤§å‰æä¸‹ï¼Œæˆ‘ä»¬å†’å‡ºäº†â€œæˆ‘ä»€ä¹ˆä¸è‡ªå·±æ‰‹æ’¸ä¸ªé…ç½®ä¸­å¿ƒâ€çš„æƒ³æ³•ã€‚</p>\n<h2 id=\"é…ç½®ä¸­å¿ƒ-nadia-config\"><a href=\"#é…ç½®ä¸­å¿ƒ-nadia-config\" class=\"headerlink\" title=\"é…ç½®ä¸­å¿ƒ nadia-config\"></a>é…ç½®ä¸­å¿ƒ nadia-config</h2><p>è‡ªæˆ‘æ‰“ä¸ªå¹¿å‘Šï¼Œæˆ‘çš„é…ç½®ä¸­å¿ƒå·²ç»ä¸Šçº¿äº†ï¼Œå¹¶ä¸”ç¬¬ä¸€ç‰ˆä¹Ÿå·²ç»å¼€æºï¼Œæ¬¢è¿å¤§å®¶æ‹ç – </p>\n<blockquote>\n<p><a href=\"https://github.com/nadia-repository/nadia-config\">https://github.com/nadia-repository/nadia-config</a></p>\n</blockquote>"},{"title":"æœå¯»æµæµªç‹—APP???","date":"2019-09-06T15:41:32.000Z","_content":"\n## ä¸­å›½AIå…¬å¸å¼€å‘äº†ç”¨é¼»çº¹æœç´¢æµæµªç‹—çš„APP\n\n\nå¦‚æœç¥åˆ°æµæµªç‹—çš„æµ·æŠ¥ä¸€å®šè¦çœ‹çœ‹ã€‚\n\néšç€ä¸€ä¸ªä¸ªå¯’å†·çš„æ—¥å­ï¼Œåˆè¦åˆ°çƒŸèŠ±å¤§ä¼šçš„å­£èŠ‚ã€‚ä¹Ÿæ˜¯å®¶çŠ¬è¢«é­ç‚®å£°å“è·‘çš„å­£èŠ‚ã€‚\n<!-- more -->\næœ€è¿‘å®¶é‡Œå…»ç‹—çš„è¶Šæ¥è¶Šå¤šï¼Œè¹­ç€çª—é—¨å¼€ç€ä¸»äººä¸€ä¸ç•™ç¥é€ƒè·‘çš„ä¹Ÿä¸åœ¨å°‘æ•°ï¼Œæˆ‘å®¶çš„çˆ±çŠ¬å°±æ˜¯åœ¨è¿™ä¸ªå­£èŠ‚é€ƒè·‘çš„ã€‚\n\nçˆ±çŠ¬èµ°ä¸¢æ—¶ä¸€èˆ¬æ¥è¯´å°±æ˜¯å¼ è´´å¯»ç‹—æµ·æŠ¥æˆ–è€…å„å¤„æ‰“å¬ã€‚ä½†æ˜¯ä¸­å›½çš„ä¸€å®¶å«Megviiï¼ˆæ—·ä¸–ï¼‰çš„AIå…¬å¸å¯ä¸ä¸€æ ·ã€‚\n\næ ¹æ®VergeæŠ¥é“ï¼Œè¯¥å…¬å¸æ­£åœ¨å¼€å‘ä¸€ç§åƒäººç±»æŒ‡çº¹ä¸€æ ·è¯†åˆ«ç‹—é¼»å­å½¢çŠ¶çš„ã€ç‹—è¯†åˆ«ç³»ç»Ÿã€‘ã€‚ä½¿ç”¨æ—·ä¸–çš„APPï¼Œé€šè¿‡æ‰‹æœºæ‘„åƒå¤´å¤šè§’åº¦æ‹æ‘„ç‹—é¼»å­å°±èƒ½ç™»å½•å®Œæˆã€‚å¹¶ç§°å…·æœ‰95%çš„ç²¾åº¦ï¼Œå› æ­¤é€šè¿‡è¿™ä¸ªAPPï¼Œæœ‰1ä¸‡5000æ¡å® ç‰©çŠ¬èƒ½å†å’Œå®ƒçš„ä¸»äººå†ä¼šã€‚\n\nä½†æ˜¯åœ¨ä¸­å›½ä¸æ˜¯ç”¨åœ¨å’Œä¸»äººçš„å†ä¼šï¼Œè€Œæ˜¯å’Œæ”¿åºœåˆä½œè§„èŒƒä¸è‰¯ç‹—ä¸»äººçš„è¡Œä¸ºã€‚\n\nå…·ä½“æ€æ ·ç›‘è§†è¿˜ä¸æ¸…æ¥šï¼Œå¯èƒ½æ˜¯å® ç‰©ç¬¬ä¸€æ¬¡è¿›å…¥å®¶åº­çš„æ—¶å€™ç™»å½•å§ã€‚ç„¶åå¦‚æœæƒ³æœå¯»æœ‰é—®é¢˜çš„ç‹—ä¸»äººï¼Œéœ€è¦å·¥ä½œäººå‘˜å½“åœºæ‰«æç‹—é¼»å­ä»è€Œé‰´åˆ«ç‹—ä¸»äººï¼Ÿ\n\nå°±æˆ‘çš„è¯è¿˜æ˜¯å¸Œæœ›èƒ½å¾—åˆ°éšåœ°å¤§å°ä¾¿çš„ç‹—ç‹—çš„ä¸»äººä¿¡æ¯ï¼Œæ¯•ç«Ÿå®¶é—¨å£è½ä¸‹çš„ä¾¿ä¾¿ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚\n\n\n\n{% blockquote ä¸­å·çœŸçŸ¥å­ https://www.gizmodo.jp/2019/07/ai-start-up-dog-nose.html ä¸­å›½ã®AIã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãŒè¿·ã„çŠ¬ã‚’é¼»ã®æŒ‡ç´‹ï¼ˆï¼Ÿï¼‰ã‚’ä½¿ã£ã¦æœç´¢ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’é–‹ç™º %}\næœ¬æ–‡è¯‘è‡ª\n{% endblockquote %}","source":"_posts/æœå¯»æµæµªç‹—APP.md","raw":"---\ntitle: æœå¯»æµæµªç‹—APP???\ndate: 2019-09-06 23:41:32\ntags: \n    - AI\n    - APP\ncategories:\n    - Translation\n---\n\n## ä¸­å›½AIå…¬å¸å¼€å‘äº†ç”¨é¼»çº¹æœç´¢æµæµªç‹—çš„APP\n\n\nå¦‚æœç¥åˆ°æµæµªç‹—çš„æµ·æŠ¥ä¸€å®šè¦çœ‹çœ‹ã€‚\n\néšç€ä¸€ä¸ªä¸ªå¯’å†·çš„æ—¥å­ï¼Œåˆè¦åˆ°çƒŸèŠ±å¤§ä¼šçš„å­£èŠ‚ã€‚ä¹Ÿæ˜¯å®¶çŠ¬è¢«é­ç‚®å£°å“è·‘çš„å­£èŠ‚ã€‚\n<!-- more -->\næœ€è¿‘å®¶é‡Œå…»ç‹—çš„è¶Šæ¥è¶Šå¤šï¼Œè¹­ç€çª—é—¨å¼€ç€ä¸»äººä¸€ä¸ç•™ç¥é€ƒè·‘çš„ä¹Ÿä¸åœ¨å°‘æ•°ï¼Œæˆ‘å®¶çš„çˆ±çŠ¬å°±æ˜¯åœ¨è¿™ä¸ªå­£èŠ‚é€ƒè·‘çš„ã€‚\n\nçˆ±çŠ¬èµ°ä¸¢æ—¶ä¸€èˆ¬æ¥è¯´å°±æ˜¯å¼ è´´å¯»ç‹—æµ·æŠ¥æˆ–è€…å„å¤„æ‰“å¬ã€‚ä½†æ˜¯ä¸­å›½çš„ä¸€å®¶å«Megviiï¼ˆæ—·ä¸–ï¼‰çš„AIå…¬å¸å¯ä¸ä¸€æ ·ã€‚\n\næ ¹æ®VergeæŠ¥é“ï¼Œè¯¥å…¬å¸æ­£åœ¨å¼€å‘ä¸€ç§åƒäººç±»æŒ‡çº¹ä¸€æ ·è¯†åˆ«ç‹—é¼»å­å½¢çŠ¶çš„ã€ç‹—è¯†åˆ«ç³»ç»Ÿã€‘ã€‚ä½¿ç”¨æ—·ä¸–çš„APPï¼Œé€šè¿‡æ‰‹æœºæ‘„åƒå¤´å¤šè§’åº¦æ‹æ‘„ç‹—é¼»å­å°±èƒ½ç™»å½•å®Œæˆã€‚å¹¶ç§°å…·æœ‰95%çš„ç²¾åº¦ï¼Œå› æ­¤é€šè¿‡è¿™ä¸ªAPPï¼Œæœ‰1ä¸‡5000æ¡å® ç‰©çŠ¬èƒ½å†å’Œå®ƒçš„ä¸»äººå†ä¼šã€‚\n\nä½†æ˜¯åœ¨ä¸­å›½ä¸æ˜¯ç”¨åœ¨å’Œä¸»äººçš„å†ä¼šï¼Œè€Œæ˜¯å’Œæ”¿åºœåˆä½œè§„èŒƒä¸è‰¯ç‹—ä¸»äººçš„è¡Œä¸ºã€‚\n\nå…·ä½“æ€æ ·ç›‘è§†è¿˜ä¸æ¸…æ¥šï¼Œå¯èƒ½æ˜¯å® ç‰©ç¬¬ä¸€æ¬¡è¿›å…¥å®¶åº­çš„æ—¶å€™ç™»å½•å§ã€‚ç„¶åå¦‚æœæƒ³æœå¯»æœ‰é—®é¢˜çš„ç‹—ä¸»äººï¼Œéœ€è¦å·¥ä½œäººå‘˜å½“åœºæ‰«æç‹—é¼»å­ä»è€Œé‰´åˆ«ç‹—ä¸»äººï¼Ÿ\n\nå°±æˆ‘çš„è¯è¿˜æ˜¯å¸Œæœ›èƒ½å¾—åˆ°éšåœ°å¤§å°ä¾¿çš„ç‹—ç‹—çš„ä¸»äººä¿¡æ¯ï¼Œæ¯•ç«Ÿå®¶é—¨å£è½ä¸‹çš„ä¾¿ä¾¿ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚\n\n\n\n{% blockquote ä¸­å·çœŸçŸ¥å­ https://www.gizmodo.jp/2019/07/ai-start-up-dog-nose.html ä¸­å›½ã®AIã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãŒè¿·ã„çŠ¬ã‚’é¼»ã®æŒ‡ç´‹ï¼ˆï¼Ÿï¼‰ã‚’ä½¿ã£ã¦æœç´¢ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’é–‹ç™º %}\næœ¬æ–‡è¯‘è‡ª\n{% endblockquote %}","slug":"æœå¯»æµæµªç‹—APP","published":1,"updated":"2020-12-14T09:51:24.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htp001gv252ehia4tyn","content":"<html><head></head><body><h2 id=\"&#x4E2D;&#x56FD;AI&#x516C;&#x53F8;&#x5F00;&#x53D1;&#x4E86;&#x7528;&#x9F3B;&#x7EB9;&#x641C;&#x7D22;&#x6D41;&#x6D6A;&#x72D7;&#x7684;APP\"><a href=\"#&#x4E2D;&#x56FD;AI&#x516C;&#x53F8;&#x5F00;&#x53D1;&#x4E86;&#x7528;&#x9F3B;&#x7EB9;&#x641C;&#x7D22;&#x6D41;&#x6D6A;&#x72D7;&#x7684;APP\" class=\"headerlink\" title=\"&#x4E2D;&#x56FD;AI&#x516C;&#x53F8;&#x5F00;&#x53D1;&#x4E86;&#x7528;&#x9F3B;&#x7EB9;&#x641C;&#x7D22;&#x6D41;&#x6D6A;&#x72D7;&#x7684;APP\"></a>&#x4E2D;&#x56FD;AI&#x516C;&#x53F8;&#x5F00;&#x53D1;&#x4E86;&#x7528;&#x9F3B;&#x7EB9;&#x641C;&#x7D22;&#x6D41;&#x6D6A;&#x72D7;&#x7684;APP</h2><p>&#x5982;&#x679C;&#x77A5;&#x5230;&#x6D41;&#x6D6A;&#x72D7;&#x7684;&#x6D77;&#x62A5;&#x4E00;&#x5B9A;&#x8981;&#x770B;&#x770B;&#x3002;</p>\n<p>&#x968F;&#x7740;&#x4E00;&#x4E2A;&#x4E2A;&#x5BD2;&#x51B7;&#x7684;&#x65E5;&#x5B50;&#xFF0C;&#x53C8;&#x8981;&#x5230;&#x70DF;&#x82B1;&#x5927;&#x4F1A;&#x7684;&#x5B63;&#x8282;&#x3002;&#x4E5F;&#x662F;&#x5BB6;&#x72AC;&#x88AB;&#x97AD;&#x70AE;&#x58F0;&#x5413;&#x8DD1;&#x7684;&#x5B63;&#x8282;&#x3002;</p>\n<a id=\"more\"></a>\n<p>&#x6700;&#x8FD1;&#x5BB6;&#x91CC;&#x517B;&#x72D7;&#x7684;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x8E6D;&#x7740;&#x7A97;&#x95E8;&#x5F00;&#x7740;&#x4E3B;&#x4EBA;&#x4E00;&#x4E0D;&#x7559;&#x795E;&#x9003;&#x8DD1;&#x7684;&#x4E5F;&#x4E0D;&#x5728;&#x5C11;&#x6570;&#xFF0C;&#x6211;&#x5BB6;&#x7684;&#x7231;&#x72AC;&#x5C31;&#x662F;&#x5728;&#x8FD9;&#x4E2A;&#x5B63;&#x8282;&#x9003;&#x8DD1;&#x7684;&#x3002;</p>\n<p>&#x7231;&#x72AC;&#x8D70;&#x4E22;&#x65F6;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x5C31;&#x662F;&#x5F20;&#x8D34;&#x5BFB;&#x72D7;&#x6D77;&#x62A5;&#x6216;&#x8005;&#x5404;&#x5904;&#x6253;&#x542C;&#x3002;&#x4F46;&#x662F;&#x4E2D;&#x56FD;&#x7684;&#x4E00;&#x5BB6;&#x53EB;Megvii&#xFF08;&#x65F7;&#x4E16;&#xFF09;&#x7684;AI&#x516C;&#x53F8;&#x53EF;&#x4E0D;&#x4E00;&#x6837;&#x3002;</p>\n<p>&#x6839;&#x636E;Verge&#x62A5;&#x9053;&#xFF0C;&#x8BE5;&#x516C;&#x53F8;&#x6B63;&#x5728;&#x5F00;&#x53D1;&#x4E00;&#x79CD;&#x50CF;&#x4EBA;&#x7C7B;&#x6307;&#x7EB9;&#x4E00;&#x6837;&#x8BC6;&#x522B;&#x72D7;&#x9F3B;&#x5B50;&#x5F62;&#x72B6;&#x7684;&#x3010;&#x72D7;&#x8BC6;&#x522B;&#x7CFB;&#x7EDF;&#x3011;&#x3002;&#x4F7F;&#x7528;&#x65F7;&#x4E16;&#x7684;APP&#xFF0C;&#x901A;&#x8FC7;&#x624B;&#x673A;&#x6444;&#x50CF;&#x5934;&#x591A;&#x89D2;&#x5EA6;&#x62CD;&#x6444;&#x72D7;&#x9F3B;&#x5B50;&#x5C31;&#x80FD;&#x767B;&#x5F55;&#x5B8C;&#x6210;&#x3002;&#x5E76;&#x79F0;&#x5177;&#x6709;95%&#x7684;&#x7CBE;&#x5EA6;&#xFF0C;&#x56E0;&#x6B64;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;APP&#xFF0C;&#x6709;1&#x4E07;5000&#x6761;&#x5BA0;&#x7269;&#x72AC;&#x80FD;&#x518D;&#x548C;&#x5B83;&#x7684;&#x4E3B;&#x4EBA;&#x518D;&#x4F1A;&#x3002;</p>\n<p>&#x4F46;&#x662F;&#x5728;&#x4E2D;&#x56FD;&#x4E0D;&#x662F;&#x7528;&#x5728;&#x548C;&#x4E3B;&#x4EBA;&#x7684;&#x518D;&#x4F1A;&#xFF0C;&#x800C;&#x662F;&#x548C;&#x653F;&#x5E9C;&#x5408;&#x4F5C;&#x89C4;&#x8303;&#x4E0D;&#x826F;&#x72D7;&#x4E3B;&#x4EBA;&#x7684;&#x884C;&#x4E3A;&#x3002;</p>\n<p>&#x5177;&#x4F53;&#x600E;&#x6837;&#x76D1;&#x89C6;&#x8FD8;&#x4E0D;&#x6E05;&#x695A;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x5BA0;&#x7269;&#x7B2C;&#x4E00;&#x6B21;&#x8FDB;&#x5165;&#x5BB6;&#x5EAD;&#x7684;&#x65F6;&#x5019;&#x767B;&#x5F55;&#x5427;&#x3002;&#x7136;&#x540E;&#x5982;&#x679C;&#x60F3;&#x641C;&#x5BFB;&#x6709;&#x95EE;&#x9898;&#x7684;&#x72D7;&#x4E3B;&#x4EBA;&#xFF0C;&#x9700;&#x8981;&#x5DE5;&#x4F5C;&#x4EBA;&#x5458;&#x5F53;&#x573A;&#x626B;&#x63CF;&#x72D7;&#x9F3B;&#x5B50;&#x4ECE;&#x800C;&#x9274;&#x522B;&#x72D7;&#x4E3B;&#x4EBA;&#xFF1F;</p>\n<p>&#x5C31;&#x6211;&#x7684;&#x8BDD;&#x8FD8;&#x662F;&#x5E0C;&#x671B;&#x80FD;&#x5F97;&#x5230;&#x968F;&#x5730;&#x5927;&#x5C0F;&#x4FBF;&#x7684;&#x72D7;&#x72D7;&#x7684;&#x4E3B;&#x4EBA;&#x4FE1;&#x606F;&#xFF0C;&#x6BD5;&#x7ADF;&#x5BB6;&#x95E8;&#x53E3;&#x843D;&#x4E0B;&#x7684;&#x4FBF;&#x4FBF;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;</p>\n<blockquote><p>&#x672C;&#x6587;&#x8BD1;&#x81EA;</p>\n<footer><strong>&#x4E2D;&#x5DDD;&#x771F;&#x77E5;&#x5B50;</strong><cite><a href=\"https://www.gizmodo.jp/2019/07/ai-start-up-dog-nose.html\">&#x4E2D;&#x56FD;&#x306E;AI&#x30B9;&#x30BF;&#x30FC;&#x30C8;&#x30A2;&#x30C3;&#x30D7;&#x304C;&#x8FF7;&#x3044;&#x72AC;&#x3092;&#x9F3B;&#x306E;&#x6307;&#x7D0B;&#xFF08;&#xFF1F;&#xFF09;&#x3092;&#x4F7F;&#x3063;&#x3066;&#x635C;&#x7D22;&#x3059;&#x308B;&#x30A2;&#x30D7;&#x30EA;&#x3092;&#x958B;&#x767A;</a></cite></footer></blockquote></body></html>","site":{"data":{}},"_categories":[{"name":"Translation","path":"categories/Translation/"}],"_tags":[{"name":"AI","path":"tags/AI/"},{"name":"APP","path":"tags/APP/"}],"excerpt":"<html><head></head><body><h2 id=\"&#x4E2D;&#x56FD;AI&#x516C;&#x53F8;&#x5F00;&#x53D1;&#x4E86;&#x7528;&#x9F3B;&#x7EB9;&#x641C;&#x7D22;&#x6D41;&#x6D6A;&#x72D7;&#x7684;APP\"><a href=\"#&#x4E2D;&#x56FD;AI&#x516C;&#x53F8;&#x5F00;&#x53D1;&#x4E86;&#x7528;&#x9F3B;&#x7EB9;&#x641C;&#x7D22;&#x6D41;&#x6D6A;&#x72D7;&#x7684;APP\" class=\"headerlink\" title=\"&#x4E2D;&#x56FD;AI&#x516C;&#x53F8;&#x5F00;&#x53D1;&#x4E86;&#x7528;&#x9F3B;&#x7EB9;&#x641C;&#x7D22;&#x6D41;&#x6D6A;&#x72D7;&#x7684;APP\"></a>&#x4E2D;&#x56FD;AI&#x516C;&#x53F8;&#x5F00;&#x53D1;&#x4E86;&#x7528;&#x9F3B;&#x7EB9;&#x641C;&#x7D22;&#x6D41;&#x6D6A;&#x72D7;&#x7684;APP</h2><p>&#x5982;&#x679C;&#x77A5;&#x5230;&#x6D41;&#x6D6A;&#x72D7;&#x7684;&#x6D77;&#x62A5;&#x4E00;&#x5B9A;&#x8981;&#x770B;&#x770B;&#x3002;</p>\n<p>&#x968F;&#x7740;&#x4E00;&#x4E2A;&#x4E2A;&#x5BD2;&#x51B7;&#x7684;&#x65E5;&#x5B50;&#xFF0C;&#x53C8;&#x8981;&#x5230;&#x70DF;&#x82B1;&#x5927;&#x4F1A;&#x7684;&#x5B63;&#x8282;&#x3002;&#x4E5F;&#x662F;&#x5BB6;&#x72AC;&#x88AB;&#x97AD;&#x70AE;&#x58F0;&#x5413;&#x8DD1;&#x7684;&#x5B63;&#x8282;&#x3002;</p></body></html>","more":"<p>æœ€è¿‘å®¶é‡Œå…»ç‹—çš„è¶Šæ¥è¶Šå¤šï¼Œè¹­ç€çª—é—¨å¼€ç€ä¸»äººä¸€ä¸ç•™ç¥é€ƒè·‘çš„ä¹Ÿä¸åœ¨å°‘æ•°ï¼Œæˆ‘å®¶çš„çˆ±çŠ¬å°±æ˜¯åœ¨è¿™ä¸ªå­£èŠ‚é€ƒè·‘çš„ã€‚</p>\n<p>çˆ±çŠ¬èµ°ä¸¢æ—¶ä¸€èˆ¬æ¥è¯´å°±æ˜¯å¼ è´´å¯»ç‹—æµ·æŠ¥æˆ–è€…å„å¤„æ‰“å¬ã€‚ä½†æ˜¯ä¸­å›½çš„ä¸€å®¶å«Megviiï¼ˆæ—·ä¸–ï¼‰çš„AIå…¬å¸å¯ä¸ä¸€æ ·ã€‚</p>\n<p>æ ¹æ®VergeæŠ¥é“ï¼Œè¯¥å…¬å¸æ­£åœ¨å¼€å‘ä¸€ç§åƒäººç±»æŒ‡çº¹ä¸€æ ·è¯†åˆ«ç‹—é¼»å­å½¢çŠ¶çš„ã€ç‹—è¯†åˆ«ç³»ç»Ÿã€‘ã€‚ä½¿ç”¨æ—·ä¸–çš„APPï¼Œé€šè¿‡æ‰‹æœºæ‘„åƒå¤´å¤šè§’åº¦æ‹æ‘„ç‹—é¼»å­å°±èƒ½ç™»å½•å®Œæˆã€‚å¹¶ç§°å…·æœ‰95%çš„ç²¾åº¦ï¼Œå› æ­¤é€šè¿‡è¿™ä¸ªAPPï¼Œæœ‰1ä¸‡5000æ¡å® ç‰©çŠ¬èƒ½å†å’Œå®ƒçš„ä¸»äººå†ä¼šã€‚</p>\n<p>ä½†æ˜¯åœ¨ä¸­å›½ä¸æ˜¯ç”¨åœ¨å’Œä¸»äººçš„å†ä¼šï¼Œè€Œæ˜¯å’Œæ”¿åºœåˆä½œè§„èŒƒä¸è‰¯ç‹—ä¸»äººçš„è¡Œä¸ºã€‚</p>\n<p>å…·ä½“æ€æ ·ç›‘è§†è¿˜ä¸æ¸…æ¥šï¼Œå¯èƒ½æ˜¯å® ç‰©ç¬¬ä¸€æ¬¡è¿›å…¥å®¶åº­çš„æ—¶å€™ç™»å½•å§ã€‚ç„¶åå¦‚æœæƒ³æœå¯»æœ‰é—®é¢˜çš„ç‹—ä¸»äººï¼Œéœ€è¦å·¥ä½œäººå‘˜å½“åœºæ‰«æç‹—é¼»å­ä»è€Œé‰´åˆ«ç‹—ä¸»äººï¼Ÿ</p>\n<p>å°±æˆ‘çš„è¯è¿˜æ˜¯å¸Œæœ›èƒ½å¾—åˆ°éšåœ°å¤§å°ä¾¿çš„ç‹—ç‹—çš„ä¸»äººä¿¡æ¯ï¼Œæ¯•ç«Ÿå®¶é—¨å£è½ä¸‹çš„ä¾¿ä¾¿ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p>\n<blockquote><p>æœ¬æ–‡è¯‘è‡ª</p>\n<footer><strong>ä¸­å·çœŸçŸ¥å­</strong><cite><a href=\"https://www.gizmodo.jp/2019/07/ai-start-up-dog-nose.html\">ä¸­å›½ã®AIã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãŒè¿·ã„çŠ¬ã‚’é¼»ã®æŒ‡ç´‹ï¼ˆï¼Ÿï¼‰ã‚’ä½¿ã£ã¦æœç´¢ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’é–‹ç™º</a></cite></footer></blockquote>"},{"title":"è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è¯»å–&è§£æ","date":"2020-12-11T03:43:51.000Z","_content":"\næœ€è¿‘å¼€å‘çš„é¡¹ç›®ä¸­é‡åˆ°äº†è‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„è¯»å–ä¸è§£æï¼Œç»“åˆç°æœ‰çš„çŸ¥è¯†å‚¨å¤‡è®¾è®¡äº†ä¸€å¥—é€šç”¨è§£ææ–¹æ¡ˆã€‚\n\n<!-- more -->\n### é…ç½®æ–‡ä»¶çš„ç»“æ„ä»‹ç»\nnadia-proxyçš„ä»£ç†é…ç½®æ–‡ä»¶å‚è€ƒäº†nginxçš„é…ç½®æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œäº†ä¸€å®šçš„ç²¾ç®€ã€‚\n\n``` json\nhttp {\n    servers {\n        listen 80;\n        location / {\n            root /var/html1;\n            index index.html;\n        }\n        location = /exact {\n            alias /var/html2;\n        }\n        location ^~ /prefix {\n            proxy {\n                strategy ROUND_ROBIN;\n                server 127.0.0.1:8001;\n                server 127.0.0.1:8002;\n                server 127.0.0.1:8003;\n            }\n        }\n        location ^~ /prefix {\n            proxy {\n                strategy WEIGHTED_ROUND_ROBIN;\n                server 127.0.0.1:8001 weight=1;\n                server 127.0.0.1:8002 weight=2;\n                server 127.0.0.1:8003 weight=3;\n            }\n        }\n    }\n    servers {\n        listen 4321;\n        location / {\n            proxy {\n                strategy IP_HASH;\n                server 127.0.0.1:8001;\n                server 127.0.0.1:8002;\n                server 127.0.0.1:8003;\n            }\n        }\n    }\n}\n```\n\n|èŠ‚ç‚¹|æè¿°|å±‚çº§|\n|---|---|---|\n|http|é…ç½®httpåè®®çš„ä»£ç†|0|\n|servers|é…ç½®å„ä¸ªæœåŠ¡çš„ä»£ç†|1|\n|listen|éœ€è¦è¢«ä»£ç†æœåŠ¡å¯¹å¤–æš´éœ²çš„ç«¯å£|2|\n|location|ä»£ç†æœåŠ¡ç›¸å…³çš„è·¯å¾„ä¿¡æ¯|2|\n|root|é™æ€æœåŠ¡ä»£ç†çš„æ–‡ä»¶å¤¹ï¼Œä¸åŒ…å«uriè·¯å¾„|3|\n|alias|é™æ€æœåŠ¡ä»£ç†çš„æ–‡ä»¶å¤¹ï¼ŒåŒ…å«uriè·¯å¾„|3|\n|index|é™æ€æœåŠ¡ä»£ç†çš„é»˜è®¤é¡µé¢|3|\n|proxy|åŠ¨æ€ä»£ç†çš„é…ç½®ä¿¡æ¯|3|\n|strategy|åŠ¨æ€ä»£ç†çš„è´Ÿè½½ç­–ç•¥ï¼Œé»˜è®¤ä¸ºè½®è®­|4|\n|server|åŠ¨æ€ä»£ç†çš„æœåŠ¡åˆ—è¡¨|4|\n\n\n### å¦‚ä½•è¯»å–é…ç½®æ–‡ä»¶\né€šè¿‡ä¸Šé¢çš„ä»‹ç»æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œé…ç½®æ–‡ä»¶æ˜¯ä»¥å±‚çº§çš„å½¢å¼æ‰€ä½“ç°çš„ã€‚ä¸ºæ­¤æˆ‘ä»¬ä¸ºå„ä¸ªèŠ‚ç‚¹è®¾è®¡äº†æ•°æ®ç»“æ„ï¼Œå¹¶å·²â€ä¼™ä¼´â€œæ ‘çš„å½¢å¼å½¢æˆä¸€é¢—è¯­æ³•ä¹¦ã€‚\n\n* é…ç½®æ–‡ä»¶èŠ‚ç‚¹çš„æ•°æ®ç»“æ„\n\n``` C\nenum config_node_type {PARENT,CHILD};Â //ä¸ºåˆå¹¶è¯­æ³•æ ‘æ ‡è¯†è¯¥èŠ‚ç‚¹çš„å±‚çº§å±æ€§\n\ntypedef struct config_node_struct{\n    enum config_node_type node_type;\n    void *content; //å½“å‰èŠ‚ç‚¹çš„å­—ç¬¦ä¸²\n\n    struct config_node_struct *friend; //åŒçº§åˆ«çš„èŠ‚ç‚¹\n    struct config_node_struct *child;  //å­©å­èŠ‚ç‚¹\n} CONFIG_NODE;\n```\n\n### æ–‡ä»¶è§£æ\né‡‡ç”¨è‡ªé¡¶å‘ä¸‹çš„è§£ææ–¹å¼ï¼ŒæŒ‰ç…§æ¯è¡Œé€å­—ç¬¦è§£æå­—ç¬¦ï¼š\n1. é‡åˆ°\"{\"å­—ç¬¦æ—¶ï¼Œå‘é…ç½®èŠ‚ç‚¹æ ˆä¸­å‹å…¥ä¸€ä¸ªPARENTç±»å‹çš„èŠ‚ç‚¹ã€‚\n2. é‡åˆ°\";\"å­—ç¬¦æ—¶ï¼Œå‘é…ç½®èŠ‚ç‚¹æ ˆä¸­å‹å…¥ä¸€ä¸ªCHILDç±»å‹çš„èŠ‚ç‚¹ã€‚\n3. é‡åˆ°\"}\"å­—ç¬¦æ—¶ï¼Œå¯¹ä¹‹å‰å‹å…¥é…ç½®èŠ‚ç‚¹æ ˆä¸­çš„èŠ‚ç‚¹ä¾æ¬¡å¼¹å‡ºï¼ŒåŒä¸ºCHILDçš„èŠ‚ç‚¹å½¢æˆä¼™ä¼´èŠ‚ç‚¹ï¼ŒçŸ¥é“é‡åˆ°PARENTèŠ‚ç‚¹åï¼Œå°†æ‰€æœ‰çš„CHILDèŠ‚ç‚¹æŒ‚è½½è‡³çˆ¶èŠ‚ç‚¹ä¸­ï¼Œå¹¶å°†PARENTå·²CHILDèŠ‚ç‚¹çš„èº«ä»½é‡æ–°å…¥æ ˆã€‚\n\né‡å¤ä¸Šè¿°1-3çš„æµç¨‹ï¼Œç›´è‡³æ–‡ä»¶è§£æå®Œæˆã€‚\n\n\n\n### èŠ‚ç‚¹çš„è¯­æ³•æ ‘è§£æ\nç›´è‡³ä¸Šä¸€ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å°†é…ç½®æ–‡ä»¶è¯»å–å®Œæˆå¹¶è§£ææˆä¸€é¢—åŒ…å«é…ç½®ä¿¡æ¯çš„è¯­æ³•æ ‘ã€‚\n\nç›®å‰æˆ‘ä»¬æ— æ³•å¾—çŸ¥å„ä¸ªèŠ‚ç‚¹çš„å…·ä½“é…ç½®å†…å®¹åŠå…¶é…ç½®ä¿¡æ¯ï¼Œå¹¶ä¸”ä¹Ÿæ— æ³•å¾—çŸ¥è§£æçš„é…ç½®é¡¹æ˜¯å¦æ»¡è¶³æˆ‘ä»¬çš„é…ç½®è¦æ±‚ã€‚\n\nä¸ºæ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œè‡ªåŠ¨è§£æå¹¶ç”Ÿæˆæˆ‘ä»¬æœ€ç»ˆå®šä¹‰çš„é…ç½®æ•°æ®ç»“æ„ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æ–¹å¼ä¸ºæœ‰é™çŠ¶æ€æœº(finite-state machine)ã€‚\n\n### æœ‰é™çŠ¶æ€æœº(finite-state machine)\næœ‰é™çŠ¶æ€æœºèƒ½å¾ˆå¥½çš„å°†æˆ‘ä»¬éœ€è¦è§£æçš„é…ç½®æ”¶æŸè‡³ä¸€ä¸ªæˆ‘ä»¬å¯æ§çš„èŒƒå›´ã€‚æˆ‘ä»¬ç®€åŒ–äº†çŠ¶æ€æœºçš„å·¥ä½œåŸç†ï¼Œä¸»è¦é‡‡ç”¨çŠ¶æ€æœºçš„çŠ¶æ€æµè½¬æ€§ã€‚å·²é…ç½®è¯­æ³•æ ‘çš„å‰ç½®éå†æ¥é©±åŠ¨çŠ¶æ€æœºçš„æ‰­è½¬ã€‚\n\n* æœ‰é™çŠ¶æ€æœºçš„æ•°æ®ç»“æ„\n\n``` C\nenum state {INIT,HTTP,SERVERS,LISTEN,LOCATION,ROOT,ALIAS,INDEX,STRATEGY,PROXY,SERVER}; //çŠ¶æ€æœºä¸­çš„å„ä¸ªçŠ¶æ€\n\n\ntypedef struct finite_state_machine {\n    enum state current_state; //å½“å‰çŠ¶æ€\n    char *tag; //çŠ¶æ€å\n    void *(* parse)(char *line,void *config); //å½“å‰çŠ¶æ€çš„æ‰§è¡Œå™¨\n\n    ARRAYLIST *child_state_list; //å­çŠ¶æ€åˆ—è¡¨\n    ARRAYLIST *frient_state_list; //åŒçº§çŠ¶æ€åˆ—è¡¨\n} FSM;\n```\n\nä»£ç å®ç°å±‚é¢ï¼Œæˆ‘ä»¬é€šè¿‡â€ä¼™ä¼´â€œæ ‘çš„é€’å½’éå†ï¼Œå¹¶ä¾é çŠ¶æ€æœºçš„åˆ—è¡¨æ¥æµè½¬çŠ¶æ€ï¼Œæœ€ç»ˆç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„é…ç½®æ–‡ä»¶ç»“æ„ã€‚\n\n``` C\n    CONFIG_NODE  *node = (CONFIG_NODE *)POP_STACK(stack);\n    FSM *init = status_machine_arrary[INIT];\n    for(int i = 0 ;i < ARRAYLIST_LENGTH(init->child_state_list) ; i++){\n        generate_proxy_config(node,nadia_proxy_config,ARRAYLIST_GET(init->child_state_list,i));\n    }\n\nstatic void generate_proxy_config(CONFIG_NODE  *node, void *config, FSM *fsm){\n    if(node == NULL){\n        return;\n    }\n    STRING *string = (STRING *)node->content;\n    void *node_config = NULL;\n    if(strstr(string->string,fsm->tag) != NULL){\n        node_config = fsm->parse(string->string,config);\n    }\n    //parse child\n    for(int i = 0 ;i < ARRAYLIST_LENGTH(fsm->child_state_list) ; i++){\n        generate_proxy_config(node->child,node_config,ARRAYLIST_GET(fsm->child_state_list,i));\n    }\n    //parse friend\n    for(int i = 0 ;i < ARRAYLIST_LENGTH(fsm->frient_state_list) ; i++){\n        generate_proxy_config(node->friend,config,ARRAYLIST_GET(fsm->frient_state_list,i));\n    }\n}\n```","source":"_posts/è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è¯»å–-è§£æ.md","raw":"---\ntitle: è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è¯»å–&è§£æ\ndate: 2020-12-11 11:43:51\ntags: \n    - C\ncategories :\n    - Technology\n---\n\næœ€è¿‘å¼€å‘çš„é¡¹ç›®ä¸­é‡åˆ°äº†è‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„è¯»å–ä¸è§£æï¼Œç»“åˆç°æœ‰çš„çŸ¥è¯†å‚¨å¤‡è®¾è®¡äº†ä¸€å¥—é€šç”¨è§£ææ–¹æ¡ˆã€‚\n\n<!-- more -->\n### é…ç½®æ–‡ä»¶çš„ç»“æ„ä»‹ç»\nnadia-proxyçš„ä»£ç†é…ç½®æ–‡ä»¶å‚è€ƒäº†nginxçš„é…ç½®æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œäº†ä¸€å®šçš„ç²¾ç®€ã€‚\n\n``` json\nhttp {\n    servers {\n        listen 80;\n        location / {\n            root /var/html1;\n            index index.html;\n        }\n        location = /exact {\n            alias /var/html2;\n        }\n        location ^~ /prefix {\n            proxy {\n                strategy ROUND_ROBIN;\n                server 127.0.0.1:8001;\n                server 127.0.0.1:8002;\n                server 127.0.0.1:8003;\n            }\n        }\n        location ^~ /prefix {\n            proxy {\n                strategy WEIGHTED_ROUND_ROBIN;\n                server 127.0.0.1:8001 weight=1;\n                server 127.0.0.1:8002 weight=2;\n                server 127.0.0.1:8003 weight=3;\n            }\n        }\n    }\n    servers {\n        listen 4321;\n        location / {\n            proxy {\n                strategy IP_HASH;\n                server 127.0.0.1:8001;\n                server 127.0.0.1:8002;\n                server 127.0.0.1:8003;\n            }\n        }\n    }\n}\n```\n\n|èŠ‚ç‚¹|æè¿°|å±‚çº§|\n|---|---|---|\n|http|é…ç½®httpåè®®çš„ä»£ç†|0|\n|servers|é…ç½®å„ä¸ªæœåŠ¡çš„ä»£ç†|1|\n|listen|éœ€è¦è¢«ä»£ç†æœåŠ¡å¯¹å¤–æš´éœ²çš„ç«¯å£|2|\n|location|ä»£ç†æœåŠ¡ç›¸å…³çš„è·¯å¾„ä¿¡æ¯|2|\n|root|é™æ€æœåŠ¡ä»£ç†çš„æ–‡ä»¶å¤¹ï¼Œä¸åŒ…å«uriè·¯å¾„|3|\n|alias|é™æ€æœåŠ¡ä»£ç†çš„æ–‡ä»¶å¤¹ï¼ŒåŒ…å«uriè·¯å¾„|3|\n|index|é™æ€æœåŠ¡ä»£ç†çš„é»˜è®¤é¡µé¢|3|\n|proxy|åŠ¨æ€ä»£ç†çš„é…ç½®ä¿¡æ¯|3|\n|strategy|åŠ¨æ€ä»£ç†çš„è´Ÿè½½ç­–ç•¥ï¼Œé»˜è®¤ä¸ºè½®è®­|4|\n|server|åŠ¨æ€ä»£ç†çš„æœåŠ¡åˆ—è¡¨|4|\n\n\n### å¦‚ä½•è¯»å–é…ç½®æ–‡ä»¶\né€šè¿‡ä¸Šé¢çš„ä»‹ç»æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œé…ç½®æ–‡ä»¶æ˜¯ä»¥å±‚çº§çš„å½¢å¼æ‰€ä½“ç°çš„ã€‚ä¸ºæ­¤æˆ‘ä»¬ä¸ºå„ä¸ªèŠ‚ç‚¹è®¾è®¡äº†æ•°æ®ç»“æ„ï¼Œå¹¶å·²â€ä¼™ä¼´â€œæ ‘çš„å½¢å¼å½¢æˆä¸€é¢—è¯­æ³•ä¹¦ã€‚\n\n* é…ç½®æ–‡ä»¶èŠ‚ç‚¹çš„æ•°æ®ç»“æ„\n\n``` C\nenum config_node_type {PARENT,CHILD};Â //ä¸ºåˆå¹¶è¯­æ³•æ ‘æ ‡è¯†è¯¥èŠ‚ç‚¹çš„å±‚çº§å±æ€§\n\ntypedef struct config_node_struct{\n    enum config_node_type node_type;\n    void *content; //å½“å‰èŠ‚ç‚¹çš„å­—ç¬¦ä¸²\n\n    struct config_node_struct *friend; //åŒçº§åˆ«çš„èŠ‚ç‚¹\n    struct config_node_struct *child;  //å­©å­èŠ‚ç‚¹\n} CONFIG_NODE;\n```\n\n### æ–‡ä»¶è§£æ\né‡‡ç”¨è‡ªé¡¶å‘ä¸‹çš„è§£ææ–¹å¼ï¼ŒæŒ‰ç…§æ¯è¡Œé€å­—ç¬¦è§£æå­—ç¬¦ï¼š\n1. é‡åˆ°\"{\"å­—ç¬¦æ—¶ï¼Œå‘é…ç½®èŠ‚ç‚¹æ ˆä¸­å‹å…¥ä¸€ä¸ªPARENTç±»å‹çš„èŠ‚ç‚¹ã€‚\n2. é‡åˆ°\";\"å­—ç¬¦æ—¶ï¼Œå‘é…ç½®èŠ‚ç‚¹æ ˆä¸­å‹å…¥ä¸€ä¸ªCHILDç±»å‹çš„èŠ‚ç‚¹ã€‚\n3. é‡åˆ°\"}\"å­—ç¬¦æ—¶ï¼Œå¯¹ä¹‹å‰å‹å…¥é…ç½®èŠ‚ç‚¹æ ˆä¸­çš„èŠ‚ç‚¹ä¾æ¬¡å¼¹å‡ºï¼ŒåŒä¸ºCHILDçš„èŠ‚ç‚¹å½¢æˆä¼™ä¼´èŠ‚ç‚¹ï¼ŒçŸ¥é“é‡åˆ°PARENTèŠ‚ç‚¹åï¼Œå°†æ‰€æœ‰çš„CHILDèŠ‚ç‚¹æŒ‚è½½è‡³çˆ¶èŠ‚ç‚¹ä¸­ï¼Œå¹¶å°†PARENTå·²CHILDèŠ‚ç‚¹çš„èº«ä»½é‡æ–°å…¥æ ˆã€‚\n\né‡å¤ä¸Šè¿°1-3çš„æµç¨‹ï¼Œç›´è‡³æ–‡ä»¶è§£æå®Œæˆã€‚\n\n\n\n### èŠ‚ç‚¹çš„è¯­æ³•æ ‘è§£æ\nç›´è‡³ä¸Šä¸€ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å°†é…ç½®æ–‡ä»¶è¯»å–å®Œæˆå¹¶è§£ææˆä¸€é¢—åŒ…å«é…ç½®ä¿¡æ¯çš„è¯­æ³•æ ‘ã€‚\n\nç›®å‰æˆ‘ä»¬æ— æ³•å¾—çŸ¥å„ä¸ªèŠ‚ç‚¹çš„å…·ä½“é…ç½®å†…å®¹åŠå…¶é…ç½®ä¿¡æ¯ï¼Œå¹¶ä¸”ä¹Ÿæ— æ³•å¾—çŸ¥è§£æçš„é…ç½®é¡¹æ˜¯å¦æ»¡è¶³æˆ‘ä»¬çš„é…ç½®è¦æ±‚ã€‚\n\nä¸ºæ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œè‡ªåŠ¨è§£æå¹¶ç”Ÿæˆæˆ‘ä»¬æœ€ç»ˆå®šä¹‰çš„é…ç½®æ•°æ®ç»“æ„ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æ–¹å¼ä¸ºæœ‰é™çŠ¶æ€æœº(finite-state machine)ã€‚\n\n### æœ‰é™çŠ¶æ€æœº(finite-state machine)\næœ‰é™çŠ¶æ€æœºèƒ½å¾ˆå¥½çš„å°†æˆ‘ä»¬éœ€è¦è§£æçš„é…ç½®æ”¶æŸè‡³ä¸€ä¸ªæˆ‘ä»¬å¯æ§çš„èŒƒå›´ã€‚æˆ‘ä»¬ç®€åŒ–äº†çŠ¶æ€æœºçš„å·¥ä½œåŸç†ï¼Œä¸»è¦é‡‡ç”¨çŠ¶æ€æœºçš„çŠ¶æ€æµè½¬æ€§ã€‚å·²é…ç½®è¯­æ³•æ ‘çš„å‰ç½®éå†æ¥é©±åŠ¨çŠ¶æ€æœºçš„æ‰­è½¬ã€‚\n\n* æœ‰é™çŠ¶æ€æœºçš„æ•°æ®ç»“æ„\n\n``` C\nenum state {INIT,HTTP,SERVERS,LISTEN,LOCATION,ROOT,ALIAS,INDEX,STRATEGY,PROXY,SERVER}; //çŠ¶æ€æœºä¸­çš„å„ä¸ªçŠ¶æ€\n\n\ntypedef struct finite_state_machine {\n    enum state current_state; //å½“å‰çŠ¶æ€\n    char *tag; //çŠ¶æ€å\n    void *(* parse)(char *line,void *config); //å½“å‰çŠ¶æ€çš„æ‰§è¡Œå™¨\n\n    ARRAYLIST *child_state_list; //å­çŠ¶æ€åˆ—è¡¨\n    ARRAYLIST *frient_state_list; //åŒçº§çŠ¶æ€åˆ—è¡¨\n} FSM;\n```\n\nä»£ç å®ç°å±‚é¢ï¼Œæˆ‘ä»¬é€šè¿‡â€ä¼™ä¼´â€œæ ‘çš„é€’å½’éå†ï¼Œå¹¶ä¾é çŠ¶æ€æœºçš„åˆ—è¡¨æ¥æµè½¬çŠ¶æ€ï¼Œæœ€ç»ˆç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„é…ç½®æ–‡ä»¶ç»“æ„ã€‚\n\n``` C\n    CONFIG_NODE  *node = (CONFIG_NODE *)POP_STACK(stack);\n    FSM *init = status_machine_arrary[INIT];\n    for(int i = 0 ;i < ARRAYLIST_LENGTH(init->child_state_list) ; i++){\n        generate_proxy_config(node,nadia_proxy_config,ARRAYLIST_GET(init->child_state_list,i));\n    }\n\nstatic void generate_proxy_config(CONFIG_NODE  *node, void *config, FSM *fsm){\n    if(node == NULL){\n        return;\n    }\n    STRING *string = (STRING *)node->content;\n    void *node_config = NULL;\n    if(strstr(string->string,fsm->tag) != NULL){\n        node_config = fsm->parse(string->string,config);\n    }\n    //parse child\n    for(int i = 0 ;i < ARRAYLIST_LENGTH(fsm->child_state_list) ; i++){\n        generate_proxy_config(node->child,node_config,ARRAYLIST_GET(fsm->child_state_list,i));\n    }\n    //parse friend\n    for(int i = 0 ;i < ARRAYLIST_LENGTH(fsm->frient_state_list) ; i++){\n        generate_proxy_config(node->friend,config,ARRAYLIST_GET(fsm->frient_state_list,i));\n    }\n}\n```","slug":"è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è¯»å–-è§£æ","published":1,"updated":"2020-12-14T09:51:24.054Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htq001kv252amvo3uoz","content":"<html><head></head><body><p>&#x6700;&#x8FD1;&#x5F00;&#x53D1;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x9047;&#x5230;&#x4E86;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x8BFB;&#x53D6;&#x4E0E;&#x89E3;&#x6790;&#xFF0C;&#x7ED3;&#x5408;&#x73B0;&#x6709;&#x7684;&#x77E5;&#x8BC6;&#x50A8;&#x5907;&#x8BBE;&#x8BA1;&#x4E86;&#x4E00;&#x5957;&#x901A;&#x7528;&#x89E3;&#x6790;&#x65B9;&#x6848;&#x3002;</p>\n<a id=\"more\"></a>\n<h3 id=\"&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x7ED3;&#x6784;&#x4ECB;&#x7ECD;\"><a href=\"#&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x7ED3;&#x6784;&#x4ECB;&#x7ECD;\" class=\"headerlink\" title=\"&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x7ED3;&#x6784;&#x4ECB;&#x7ECD;\"></a>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x7ED3;&#x6784;&#x4ECB;&#x7ECD;</h3><p>nadia-proxy&#x7684;&#x4EE3;&#x7406;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x53C2;&#x8003;&#x4E86;nginx&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x8FDB;&#x884C;&#x4E86;&#x4E00;&#x5B9A;&#x7684;&#x7CBE;&#x7B80;&#x3002;</p>\n<figure class=\"highlight hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http {</span><br><span class=\"line\">    servers {</span><br><span class=\"line\">        listen 80;</span><br><span class=\"line\">        location / {</span><br><span class=\"line\">            root /var/html1;</span><br><span class=\"line\">            index index.html;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        location = /exact {</span><br><span class=\"line\">            alias /var/html2;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        location ^~ /prefix {</span><br><span class=\"line\">            proxy {</span><br><span class=\"line\">                strategy ROUND_ROBIN;</span><br><span class=\"line\">                server 127.0.0.1:8001;</span><br><span class=\"line\">                server 127.0.0.1:8002;</span><br><span class=\"line\">                server 127.0.0.1:8003;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">        location ^~ /prefix {</span><br><span class=\"line\">            proxy {</span><br><span class=\"line\">                strategy WEIGHTED_ROUND_ROBIN;</span><br><span class=\"line\">                server 127.0.0.1:8001 weight=1;</span><br><span class=\"line\">                server 127.0.0.1:8002 weight=2;</span><br><span class=\"line\">                server 127.0.0.1:8003 weight=3;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    servers {</span><br><span class=\"line\">        listen 4321;</span><br><span class=\"line\">        location / {</span><br><span class=\"line\">            proxy {</span><br><span class=\"line\">                strategy IP_HASH;</span><br><span class=\"line\">                server 127.0.0.1:8001;</span><br><span class=\"line\">                server 127.0.0.1:8002;</span><br><span class=\"line\">                server 127.0.0.1:8003;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>&#x8282;&#x70B9;</th>\n<th>&#x63CF;&#x8FF0;</th>\n<th>&#x5C42;&#x7EA7;</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>http</td>\n<td>&#x914D;&#x7F6E;http&#x534F;&#x8BAE;&#x7684;&#x4EE3;&#x7406;</td>\n<td>0</td>\n</tr>\n<tr>\n<td>servers</td>\n<td>&#x914D;&#x7F6E;&#x5404;&#x4E2A;&#x670D;&#x52A1;&#x7684;&#x4EE3;&#x7406;</td>\n<td>1</td>\n</tr>\n<tr>\n<td>listen</td>\n<td>&#x9700;&#x8981;&#x88AB;&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5BF9;&#x5916;&#x66B4;&#x9732;&#x7684;&#x7AEF;&#x53E3;</td>\n<td>2</td>\n</tr>\n<tr>\n<td>location</td>\n<td>&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x76F8;&#x5173;&#x7684;&#x8DEF;&#x5F84;&#x4FE1;&#x606F;</td>\n<td>2</td>\n</tr>\n<tr>\n<td>root</td>\n<td>&#x9759;&#x6001;&#x670D;&#x52A1;&#x4EE3;&#x7406;&#x7684;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x4E0D;&#x5305;&#x542B;uri&#x8DEF;&#x5F84;</td>\n<td>3</td>\n</tr>\n<tr>\n<td>alias</td>\n<td>&#x9759;&#x6001;&#x670D;&#x52A1;&#x4EE3;&#x7406;&#x7684;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5305;&#x542B;uri&#x8DEF;&#x5F84;</td>\n<td>3</td>\n</tr>\n<tr>\n<td>index</td>\n<td>&#x9759;&#x6001;&#x670D;&#x52A1;&#x4EE3;&#x7406;&#x7684;&#x9ED8;&#x8BA4;&#x9875;&#x9762;</td>\n<td>3</td>\n</tr>\n<tr>\n<td>proxy</td>\n<td>&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x914D;&#x7F6E;&#x4FE1;&#x606F;</td>\n<td>3</td>\n</tr>\n<tr>\n<td>strategy</td>\n<td>&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x8D1F;&#x8F7D;&#x7B56;&#x7565;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;&#x8F6E;&#x8BAD;</td>\n<td>4</td>\n</tr>\n<tr>\n<td>server</td>\n<td>&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x7684;&#x670D;&#x52A1;&#x5217;&#x8868;</td>\n<td>4</td>\n</tr>\n</tbody></table>\n<h3 id=\"&#x5982;&#x4F55;&#x8BFB;&#x53D6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;\"><a href=\"#&#x5982;&#x4F55;&#x8BFB;&#x53D6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"&#x5982;&#x4F55;&#x8BFB;&#x53D6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;\"></a>&#x5982;&#x4F55;&#x8BFB;&#x53D6;&#x914D;&#x7F6E;&#x6587;&#x4EF6;</h3><p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x4ECB;&#x7ECD;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x662F;&#x4EE5;&#x5C42;&#x7EA7;&#x7684;&#x5F62;&#x5F0F;&#x6240;&#x4F53;&#x73B0;&#x7684;&#x3002;&#x4E3A;&#x6B64;&#x6211;&#x4EEC;&#x4E3A;&#x5404;&#x4E2A;&#x8282;&#x70B9;&#x8BBE;&#x8BA1;&#x4E86;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5E76;&#x5DF2;&#x201D;&#x4F19;&#x4F34;&#x201C;&#x6811;&#x7684;&#x5F62;&#x5F0F;&#x5F62;&#x6210;&#x4E00;&#x9897;&#x8BED;&#x6CD5;&#x4E66;&#x3002;</p>\n<ul>\n<li>&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8282;&#x70B9;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;</li>\n</ul>\n<figure class=\"highlight c hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">enum</span> <span class=\"hljs-title\">config_node_type</span> {</span>PARENT,CHILD};&#xA0;<span class=\"hljs-comment\">//&#x4E3A;&#x5408;&#x5E76;&#x8BED;&#x6CD5;&#x6811;&#x6807;&#x8BC6;&#x8BE5;&#x8282;&#x70B9;&#x7684;&#x5C42;&#x7EA7;&#x5C5E;&#x6027;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">typedef</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">config_node_struct</span>{</span></span><br><span class=\"line\">    <span class=\"hljs-class\"><span class=\"hljs-keyword\">enum</span> <span class=\"hljs-title\">config_node_type</span> <span class=\"hljs-title\">node_type</span>;</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">void</span> *content; <span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x8282;&#x70B9;&#x7684;&#x5B57;&#x7B26;&#x4E32;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">config_node_struct</span> *<span class=\"hljs-title\">friend</span>;</span> <span class=\"hljs-comment\">//&#x540C;&#x7EA7;&#x522B;&#x7684;&#x8282;&#x70B9;</span></span><br><span class=\"line\">    <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">config_node_struct</span> *<span class=\"hljs-title\">child</span>;</span>  <span class=\"hljs-comment\">//&#x5B69;&#x5B50;&#x8282;&#x70B9;</span></span><br><span class=\"line\">} CONFIG_NODE;</span><br></pre></td></tr></tbody></table></figure>\n\n<h3 id=\"&#x6587;&#x4EF6;&#x89E3;&#x6790;\"><a href=\"#&#x6587;&#x4EF6;&#x89E3;&#x6790;\" class=\"headerlink\" title=\"&#x6587;&#x4EF6;&#x89E3;&#x6790;\"></a>&#x6587;&#x4EF6;&#x89E3;&#x6790;</h3><p>&#x91C7;&#x7528;&#x81EA;&#x9876;&#x5411;&#x4E0B;&#x7684;&#x89E3;&#x6790;&#x65B9;&#x5F0F;&#xFF0C;&#x6309;&#x7167;&#x6BCF;&#x884C;&#x9010;&#x5B57;&#x7B26;&#x89E3;&#x6790;&#x5B57;&#x7B26;&#xFF1A;</p>\n<ol>\n<li>&#x9047;&#x5230;&#x201D;{&#x201C;&#x5B57;&#x7B26;&#x65F6;&#xFF0C;&#x5411;&#x914D;&#x7F6E;&#x8282;&#x70B9;&#x6808;&#x4E2D;&#x538B;&#x5165;&#x4E00;&#x4E2A;PARENT&#x7C7B;&#x578B;&#x7684;&#x8282;&#x70B9;&#x3002;</li>\n<li>&#x9047;&#x5230;&#x201D;;&#x201D;&#x5B57;&#x7B26;&#x65F6;&#xFF0C;&#x5411;&#x914D;&#x7F6E;&#x8282;&#x70B9;&#x6808;&#x4E2D;&#x538B;&#x5165;&#x4E00;&#x4E2A;CHILD&#x7C7B;&#x578B;&#x7684;&#x8282;&#x70B9;&#x3002;</li>\n<li>&#x9047;&#x5230;&#x201D;}&#x201D;&#x5B57;&#x7B26;&#x65F6;&#xFF0C;&#x5BF9;&#x4E4B;&#x524D;&#x538B;&#x5165;&#x914D;&#x7F6E;&#x8282;&#x70B9;&#x6808;&#x4E2D;&#x7684;&#x8282;&#x70B9;&#x4F9D;&#x6B21;&#x5F39;&#x51FA;&#xFF0C;&#x540C;&#x4E3A;CHILD&#x7684;&#x8282;&#x70B9;&#x5F62;&#x6210;&#x4F19;&#x4F34;&#x8282;&#x70B9;&#xFF0C;&#x77E5;&#x9053;&#x9047;&#x5230;PARENT&#x8282;&#x70B9;&#x540E;&#xFF0C;&#x5C06;&#x6240;&#x6709;&#x7684;CHILD&#x8282;&#x70B9;&#x6302;&#x8F7D;&#x81F3;&#x7236;&#x8282;&#x70B9;&#x4E2D;&#xFF0C;&#x5E76;&#x5C06;PARENT&#x5DF2;CHILD&#x8282;&#x70B9;&#x7684;&#x8EAB;&#x4EFD;&#x91CD;&#x65B0;&#x5165;&#x6808;&#x3002;</li>\n</ol>\n<p>&#x91CD;&#x590D;&#x4E0A;&#x8FF0;1-3&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x76F4;&#x81F3;&#x6587;&#x4EF6;&#x89E3;&#x6790;&#x5B8C;&#x6210;&#x3002;</p>\n<h3 id=\"&#x8282;&#x70B9;&#x7684;&#x8BED;&#x6CD5;&#x6811;&#x89E3;&#x6790;\"><a href=\"#&#x8282;&#x70B9;&#x7684;&#x8BED;&#x6CD5;&#x6811;&#x89E3;&#x6790;\" class=\"headerlink\" title=\"&#x8282;&#x70B9;&#x7684;&#x8BED;&#x6CD5;&#x6811;&#x89E3;&#x6790;\"></a>&#x8282;&#x70B9;&#x7684;&#x8BED;&#x6CD5;&#x6811;&#x89E3;&#x6790;</h3><p>&#x76F4;&#x81F3;&#x4E0A;&#x4E00;&#x4E2A;&#x6B65;&#x9AA4;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8BFB;&#x53D6;&#x5B8C;&#x6210;&#x5E76;&#x89E3;&#x6790;&#x6210;&#x4E00;&#x9897;&#x5305;&#x542B;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x7684;&#x8BED;&#x6CD5;&#x6811;&#x3002;</p>\n<p>&#x76EE;&#x524D;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x5F97;&#x77E5;&#x5404;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x5177;&#x4F53;&#x914D;&#x7F6E;&#x5185;&#x5BB9;&#x53CA;&#x5176;&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x4E14;&#x4E5F;&#x65E0;&#x6CD5;&#x5F97;&#x77E5;&#x89E3;&#x6790;&#x7684;&#x914D;&#x7F6E;&#x9879;&#x662F;&#x5426;&#x6EE1;&#x8DB3;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x8981;&#x6C42;&#x3002;</p>\n<p>&#x4E3A;&#x6B64;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x79CD;&#x673A;&#x5236;&#xFF0C;&#x81EA;&#x52A8;&#x89E3;&#x6790;&#x5E76;&#x751F;&#x6210;&#x6211;&#x4EEC;&#x6700;&#x7EC8;&#x5B9A;&#x4E49;&#x7684;&#x914D;&#x7F6E;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x91C7;&#x7528;&#x65B9;&#x5F0F;&#x4E3A;&#x6709;&#x9650;&#x72B6;&#x6001;&#x673A;(finite-state machine)&#x3002;</p>\n<h3 id=\"&#x6709;&#x9650;&#x72B6;&#x6001;&#x673A;-finite-state-machine\"><a href=\"#&#x6709;&#x9650;&#x72B6;&#x6001;&#x673A;-finite-state-machine\" class=\"headerlink\" title=\"&#x6709;&#x9650;&#x72B6;&#x6001;&#x673A;(finite-state machine)\"></a>&#x6709;&#x9650;&#x72B6;&#x6001;&#x673A;(finite-state machine)</h3><p>&#x6709;&#x9650;&#x72B6;&#x6001;&#x673A;&#x80FD;&#x5F88;&#x597D;&#x7684;&#x5C06;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x89E3;&#x6790;&#x7684;&#x914D;&#x7F6E;&#x6536;&#x675F;&#x81F3;&#x4E00;&#x4E2A;&#x6211;&#x4EEC;&#x53EF;&#x63A7;&#x7684;&#x8303;&#x56F4;&#x3002;&#x6211;&#x4EEC;&#x7B80;&#x5316;&#x4E86;&#x72B6;&#x6001;&#x673A;&#x7684;&#x5DE5;&#x4F5C;&#x539F;&#x7406;&#xFF0C;&#x4E3B;&#x8981;&#x91C7;&#x7528;&#x72B6;&#x6001;&#x673A;&#x7684;&#x72B6;&#x6001;&#x6D41;&#x8F6C;&#x6027;&#x3002;&#x5DF2;&#x914D;&#x7F6E;&#x8BED;&#x6CD5;&#x6811;&#x7684;&#x524D;&#x7F6E;&#x904D;&#x5386;&#x6765;&#x9A71;&#x52A8;&#x72B6;&#x6001;&#x673A;&#x7684;&#x626D;&#x8F6C;&#x3002;</p>\n<ul>\n<li>&#x6709;&#x9650;&#x72B6;&#x6001;&#x673A;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;</li>\n</ul>\n<figure class=\"highlight c hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">enum</span> <span class=\"hljs-title\">state</span> {</span>INIT,HTTP,SERVERS,LISTEN,LOCATION,ROOT,ALIAS,INDEX,STRATEGY,PROXY,SERVER}; <span class=\"hljs-comment\">//&#x72B6;&#x6001;&#x673A;&#x4E2D;&#x7684;&#x5404;&#x4E2A;&#x72B6;&#x6001;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">typedef</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">finite_state_machine</span> {</span></span><br><span class=\"line\">    <span class=\"hljs-class\"><span class=\"hljs-keyword\">enum</span> <span class=\"hljs-title\">state</span> <span class=\"hljs-title\">current_state</span>;</span> <span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x72B6;&#x6001;</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">char</span> *tag; <span class=\"hljs-comment\">//&#x72B6;&#x6001;&#x540D;</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">void</span> *(* parse)(<span class=\"hljs-keyword\">char</span> *line,<span class=\"hljs-keyword\">void</span> *config); <span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x72B6;&#x6001;&#x7684;&#x6267;&#x884C;&#x5668;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ARRAYLIST *child_state_list; <span class=\"hljs-comment\">//&#x5B50;&#x72B6;&#x6001;&#x5217;&#x8868;</span></span><br><span class=\"line\">    ARRAYLIST *frient_state_list; <span class=\"hljs-comment\">//&#x540C;&#x7EA7;&#x72B6;&#x6001;&#x5217;&#x8868;</span></span><br><span class=\"line\">} FSM;</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5C42;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x901A;&#x8FC7;&#x201D;&#x4F19;&#x4F34;&#x201C;&#x6811;&#x7684;&#x9012;&#x5F52;&#x904D;&#x5386;&#xFF0C;&#x5E76;&#x4F9D;&#x9760;&#x72B6;&#x6001;&#x673A;&#x7684;&#x5217;&#x8868;&#x6765;&#x6D41;&#x8F6C;&#x72B6;&#x6001;&#xFF0C;&#x6700;&#x7EC8;&#x751F;&#x6210;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x3002;</p>\n<figure class=\"highlight c hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    CONFIG_NODE  *node = (CONFIG_NODE *)POP_STACK(<span class=\"hljs-built_in\">stack</span>);</span><br><span class=\"line\">    FSM *init = status_machine_arrary[INIT];</span><br><span class=\"line\">    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span> ;i &lt; ARRAYLIST_LENGTH(init-&gt;child_state_list) ; i++){</span><br><span class=\"line\">        generate_proxy_config(node,nadia_proxy_config,ARRAYLIST_GET(init-&gt;child_state_list,i));</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">generate_proxy_config</span><span class=\"hljs-params\">(CONFIG_NODE  *node, <span class=\"hljs-keyword\">void</span> *config, FSM *fsm)</span></span>{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span>(node == <span class=\"hljs-literal\">NULL</span>){</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    STRING *<span class=\"hljs-built_in\">string</span> = (STRING *)node-&gt;content;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">void</span> *node_config = <span class=\"hljs-literal\">NULL</span>;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-built_in\">strstr</span>(<span class=\"hljs-built_in\">string</span>-&gt;<span class=\"hljs-built_in\">string</span>,fsm-&gt;tag) != <span class=\"hljs-literal\">NULL</span>){</span><br><span class=\"line\">        node_config = fsm-&gt;parse(<span class=\"hljs-built_in\">string</span>-&gt;<span class=\"hljs-built_in\">string</span>,config);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"hljs-comment\">//parse child</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span> ;i &lt; ARRAYLIST_LENGTH(fsm-&gt;child_state_list) ; i++){</span><br><span class=\"line\">        generate_proxy_config(node-&gt;child,node_config,ARRAYLIST_GET(fsm-&gt;child_state_list,i));</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"hljs-comment\">//parse friend</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span> ;i &lt; ARRAYLIST_LENGTH(fsm-&gt;frient_state_list) ; i++){</span><br><span class=\"line\">        generate_proxy_config(node-&gt;<span class=\"hljs-keyword\">friend</span>,config,ARRAYLIST_GET(fsm-&gt;frient_state_list,i));</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure></body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"C","path":"tags/C/"}],"excerpt":"<html><head></head><body><p>&#x6700;&#x8FD1;&#x5F00;&#x53D1;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x9047;&#x5230;&#x4E86;&#x81EA;&#x5B9A;&#x4E49;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x8BFB;&#x53D6;&#x4E0E;&#x89E3;&#x6790;&#xFF0C;&#x7ED3;&#x5408;&#x73B0;&#x6709;&#x7684;&#x77E5;&#x8BC6;&#x50A8;&#x5907;&#x8BBE;&#x8BA1;&#x4E86;&#x4E00;&#x5957;&#x901A;&#x7528;&#x89E3;&#x6790;&#x65B9;&#x6848;&#x3002;</p></body></html>","more":"<h3 id=\"é…ç½®æ–‡ä»¶çš„ç»“æ„ä»‹ç»\"><a href=\"#é…ç½®æ–‡ä»¶çš„ç»“æ„ä»‹ç»\" class=\"headerlink\" title=\"é…ç½®æ–‡ä»¶çš„ç»“æ„ä»‹ç»\"></a>é…ç½®æ–‡ä»¶çš„ç»“æ„ä»‹ç»</h3><p>nadia-proxyçš„ä»£ç†é…ç½®æ–‡ä»¶å‚è€ƒäº†nginxçš„é…ç½®æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œäº†ä¸€å®šçš„ç²¾ç®€ã€‚</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http &#123;</span><br><span class=\"line\">    servers &#123;</span><br><span class=\"line\">        listen 80;</span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">            root /var/html1;</span><br><span class=\"line\">            index index.html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        location = /exact &#123;</span><br><span class=\"line\">            alias /var/html2;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        location ^~ /prefix &#123;</span><br><span class=\"line\">            proxy &#123;</span><br><span class=\"line\">                strategy ROUND_ROBIN;</span><br><span class=\"line\">                server 127.0.0.1:8001;</span><br><span class=\"line\">                server 127.0.0.1:8002;</span><br><span class=\"line\">                server 127.0.0.1:8003;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        location ^~ /prefix &#123;</span><br><span class=\"line\">            proxy &#123;</span><br><span class=\"line\">                strategy WEIGHTED_ROUND_ROBIN;</span><br><span class=\"line\">                server 127.0.0.1:8001 weight=1;</span><br><span class=\"line\">                server 127.0.0.1:8002 weight=2;</span><br><span class=\"line\">                server 127.0.0.1:8003 weight=3;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    servers &#123;</span><br><span class=\"line\">        listen 4321;</span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">            proxy &#123;</span><br><span class=\"line\">                strategy IP_HASH;</span><br><span class=\"line\">                server 127.0.0.1:8001;</span><br><span class=\"line\">                server 127.0.0.1:8002;</span><br><span class=\"line\">                server 127.0.0.1:8003;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>èŠ‚ç‚¹</th>\n<th>æè¿°</th>\n<th>å±‚çº§</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>http</td>\n<td>é…ç½®httpåè®®çš„ä»£ç†</td>\n<td>0</td>\n</tr>\n<tr>\n<td>servers</td>\n<td>é…ç½®å„ä¸ªæœåŠ¡çš„ä»£ç†</td>\n<td>1</td>\n</tr>\n<tr>\n<td>listen</td>\n<td>éœ€è¦è¢«ä»£ç†æœåŠ¡å¯¹å¤–æš´éœ²çš„ç«¯å£</td>\n<td>2</td>\n</tr>\n<tr>\n<td>location</td>\n<td>ä»£ç†æœåŠ¡ç›¸å…³çš„è·¯å¾„ä¿¡æ¯</td>\n<td>2</td>\n</tr>\n<tr>\n<td>root</td>\n<td>é™æ€æœåŠ¡ä»£ç†çš„æ–‡ä»¶å¤¹ï¼Œä¸åŒ…å«uriè·¯å¾„</td>\n<td>3</td>\n</tr>\n<tr>\n<td>alias</td>\n<td>é™æ€æœåŠ¡ä»£ç†çš„æ–‡ä»¶å¤¹ï¼ŒåŒ…å«uriè·¯å¾„</td>\n<td>3</td>\n</tr>\n<tr>\n<td>index</td>\n<td>é™æ€æœåŠ¡ä»£ç†çš„é»˜è®¤é¡µé¢</td>\n<td>3</td>\n</tr>\n<tr>\n<td>proxy</td>\n<td>åŠ¨æ€ä»£ç†çš„é…ç½®ä¿¡æ¯</td>\n<td>3</td>\n</tr>\n<tr>\n<td>strategy</td>\n<td>åŠ¨æ€ä»£ç†çš„è´Ÿè½½ç­–ç•¥ï¼Œé»˜è®¤ä¸ºè½®è®­</td>\n<td>4</td>\n</tr>\n<tr>\n<td>server</td>\n<td>åŠ¨æ€ä»£ç†çš„æœåŠ¡åˆ—è¡¨</td>\n<td>4</td>\n</tr>\n</tbody></table>\n<h3 id=\"å¦‚ä½•è¯»å–é…ç½®æ–‡ä»¶\"><a href=\"#å¦‚ä½•è¯»å–é…ç½®æ–‡ä»¶\" class=\"headerlink\" title=\"å¦‚ä½•è¯»å–é…ç½®æ–‡ä»¶\"></a>å¦‚ä½•è¯»å–é…ç½®æ–‡ä»¶</h3><p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œé…ç½®æ–‡ä»¶æ˜¯ä»¥å±‚çº§çš„å½¢å¼æ‰€ä½“ç°çš„ã€‚ä¸ºæ­¤æˆ‘ä»¬ä¸ºå„ä¸ªèŠ‚ç‚¹è®¾è®¡äº†æ•°æ®ç»“æ„ï¼Œå¹¶å·²â€ä¼™ä¼´â€œæ ‘çš„å½¢å¼å½¢æˆä¸€é¢—è¯­æ³•ä¹¦ã€‚</p>\n<ul>\n<li>é…ç½®æ–‡ä»¶èŠ‚ç‚¹çš„æ•°æ®ç»“æ„</li>\n</ul>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">config_node_type</span> &#123;</span>PARENT,CHILD&#125;;Â <span class=\"comment\">//ä¸ºåˆå¹¶è¯­æ³•æ ‘æ ‡è¯†è¯¥èŠ‚ç‚¹çš„å±‚çº§å±æ€§</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">config_node_struct</span>&#123;</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">config_node_type</span> <span class=\"title\">node_type</span>;</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> *content; <span class=\"comment\">//å½“å‰èŠ‚ç‚¹çš„å­—ç¬¦ä¸²</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">config_node_struct</span> *<span class=\"title\">friend</span>;</span> <span class=\"comment\">//åŒçº§åˆ«çš„èŠ‚ç‚¹</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">config_node_struct</span> *<span class=\"title\">child</span>;</span>  <span class=\"comment\">//å­©å­èŠ‚ç‚¹</span></span><br><span class=\"line\">&#125; CONFIG_NODE;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"æ–‡ä»¶è§£æ\"><a href=\"#æ–‡ä»¶è§£æ\" class=\"headerlink\" title=\"æ–‡ä»¶è§£æ\"></a>æ–‡ä»¶è§£æ</h3><p>é‡‡ç”¨è‡ªé¡¶å‘ä¸‹çš„è§£ææ–¹å¼ï¼ŒæŒ‰ç…§æ¯è¡Œé€å­—ç¬¦è§£æå­—ç¬¦ï¼š</p>\n<ol>\n<li>é‡åˆ°â€{â€œå­—ç¬¦æ—¶ï¼Œå‘é…ç½®èŠ‚ç‚¹æ ˆä¸­å‹å…¥ä¸€ä¸ªPARENTç±»å‹çš„èŠ‚ç‚¹ã€‚</li>\n<li>é‡åˆ°â€;â€å­—ç¬¦æ—¶ï¼Œå‘é…ç½®èŠ‚ç‚¹æ ˆä¸­å‹å…¥ä¸€ä¸ªCHILDç±»å‹çš„èŠ‚ç‚¹ã€‚</li>\n<li>é‡åˆ°â€}â€å­—ç¬¦æ—¶ï¼Œå¯¹ä¹‹å‰å‹å…¥é…ç½®èŠ‚ç‚¹æ ˆä¸­çš„èŠ‚ç‚¹ä¾æ¬¡å¼¹å‡ºï¼ŒåŒä¸ºCHILDçš„èŠ‚ç‚¹å½¢æˆä¼™ä¼´èŠ‚ç‚¹ï¼ŒçŸ¥é“é‡åˆ°PARENTèŠ‚ç‚¹åï¼Œå°†æ‰€æœ‰çš„CHILDèŠ‚ç‚¹æŒ‚è½½è‡³çˆ¶èŠ‚ç‚¹ä¸­ï¼Œå¹¶å°†PARENTå·²CHILDèŠ‚ç‚¹çš„èº«ä»½é‡æ–°å…¥æ ˆã€‚</li>\n</ol>\n<p>é‡å¤ä¸Šè¿°1-3çš„æµç¨‹ï¼Œç›´è‡³æ–‡ä»¶è§£æå®Œæˆã€‚</p>\n<h3 id=\"èŠ‚ç‚¹çš„è¯­æ³•æ ‘è§£æ\"><a href=\"#èŠ‚ç‚¹çš„è¯­æ³•æ ‘è§£æ\" class=\"headerlink\" title=\"èŠ‚ç‚¹çš„è¯­æ³•æ ‘è§£æ\"></a>èŠ‚ç‚¹çš„è¯­æ³•æ ‘è§£æ</h3><p>ç›´è‡³ä¸Šä¸€ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å°†é…ç½®æ–‡ä»¶è¯»å–å®Œæˆå¹¶è§£ææˆä¸€é¢—åŒ…å«é…ç½®ä¿¡æ¯çš„è¯­æ³•æ ‘ã€‚</p>\n<p>ç›®å‰æˆ‘ä»¬æ— æ³•å¾—çŸ¥å„ä¸ªèŠ‚ç‚¹çš„å…·ä½“é…ç½®å†…å®¹åŠå…¶é…ç½®ä¿¡æ¯ï¼Œå¹¶ä¸”ä¹Ÿæ— æ³•å¾—çŸ¥è§£æçš„é…ç½®é¡¹æ˜¯å¦æ»¡è¶³æˆ‘ä»¬çš„é…ç½®è¦æ±‚ã€‚</p>\n<p>ä¸ºæ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œè‡ªåŠ¨è§£æå¹¶ç”Ÿæˆæˆ‘ä»¬æœ€ç»ˆå®šä¹‰çš„é…ç½®æ•°æ®ç»“æ„ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æ–¹å¼ä¸ºæœ‰é™çŠ¶æ€æœº(finite-state machine)ã€‚</p>\n<h3 id=\"æœ‰é™çŠ¶æ€æœº-finite-state-machine\"><a href=\"#æœ‰é™çŠ¶æ€æœº-finite-state-machine\" class=\"headerlink\" title=\"æœ‰é™çŠ¶æ€æœº(finite-state machine)\"></a>æœ‰é™çŠ¶æ€æœº(finite-state machine)</h3><p>æœ‰é™çŠ¶æ€æœºèƒ½å¾ˆå¥½çš„å°†æˆ‘ä»¬éœ€è¦è§£æçš„é…ç½®æ”¶æŸè‡³ä¸€ä¸ªæˆ‘ä»¬å¯æ§çš„èŒƒå›´ã€‚æˆ‘ä»¬ç®€åŒ–äº†çŠ¶æ€æœºçš„å·¥ä½œåŸç†ï¼Œä¸»è¦é‡‡ç”¨çŠ¶æ€æœºçš„çŠ¶æ€æµè½¬æ€§ã€‚å·²é…ç½®è¯­æ³•æ ‘çš„å‰ç½®éå†æ¥é©±åŠ¨çŠ¶æ€æœºçš„æ‰­è½¬ã€‚</p>\n<ul>\n<li>æœ‰é™çŠ¶æ€æœºçš„æ•°æ®ç»“æ„</li>\n</ul>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">state</span> &#123;</span>INIT,HTTP,SERVERS,LISTEN,LOCATION,ROOT,ALIAS,INDEX,STRATEGY,PROXY,SERVER&#125;; <span class=\"comment\">//çŠ¶æ€æœºä¸­çš„å„ä¸ªçŠ¶æ€</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">finite_state_machine</span> &#123;</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">state</span> <span class=\"title\">current_state</span>;</span> <span class=\"comment\">//å½“å‰çŠ¶æ€</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> *tag; <span class=\"comment\">//çŠ¶æ€å</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> *(* parse)(<span class=\"keyword\">char</span> *line,<span class=\"keyword\">void</span> *config); <span class=\"comment\">//å½“å‰çŠ¶æ€çš„æ‰§è¡Œå™¨</span></span><br><span class=\"line\"></span><br><span class=\"line\">    ARRAYLIST *child_state_list; <span class=\"comment\">//å­çŠ¶æ€åˆ—è¡¨</span></span><br><span class=\"line\">    ARRAYLIST *frient_state_list; <span class=\"comment\">//åŒçº§çŠ¶æ€åˆ—è¡¨</span></span><br><span class=\"line\">&#125; FSM;</span><br></pre></td></tr></table></figure>\n\n<p>ä»£ç å®ç°å±‚é¢ï¼Œæˆ‘ä»¬é€šè¿‡â€ä¼™ä¼´â€œæ ‘çš„é€’å½’éå†ï¼Œå¹¶ä¾é çŠ¶æ€æœºçš„åˆ—è¡¨æ¥æµè½¬çŠ¶æ€ï¼Œæœ€ç»ˆç”Ÿæˆæˆ‘ä»¬éœ€è¦çš„é…ç½®æ–‡ä»¶ç»“æ„ã€‚</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    CONFIG_NODE  *node = (CONFIG_NODE *)POP_STACK(<span class=\"built_in\">stack</span>);</span><br><span class=\"line\">    FSM *init = status_machine_arrary[INIT];</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ;i &lt; ARRAYLIST_LENGTH(init-&gt;child_state_list) ; i++)&#123;</span><br><span class=\"line\">        generate_proxy_config(node,nadia_proxy_config,ARRAYLIST_GET(init-&gt;child_state_list,i));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">generate_proxy_config</span><span class=\"params\">(CONFIG_NODE  *node, <span class=\"keyword\">void</span> *config, FSM *fsm)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(node == <span class=\"literal\">NULL</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    STRING *<span class=\"built_in\">string</span> = (STRING *)node-&gt;content;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> *node_config = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">strstr</span>(<span class=\"built_in\">string</span>-&gt;<span class=\"built_in\">string</span>,fsm-&gt;tag) != <span class=\"literal\">NULL</span>)&#123;</span><br><span class=\"line\">        node_config = fsm-&gt;parse(<span class=\"built_in\">string</span>-&gt;<span class=\"built_in\">string</span>,config);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//parse child</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ;i &lt; ARRAYLIST_LENGTH(fsm-&gt;child_state_list) ; i++)&#123;</span><br><span class=\"line\">        generate_proxy_config(node-&gt;child,node_config,ARRAYLIST_GET(fsm-&gt;child_state_list,i));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">//parse friend</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i = <span class=\"number\">0</span> ;i &lt; ARRAYLIST_LENGTH(fsm-&gt;frient_state_list) ; i++)&#123;</span><br><span class=\"line\">        generate_proxy_config(node-&gt;<span class=\"keyword\">friend</span>,config,ARRAYLIST_GET(fsm-&gt;frient_state_list,i));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°1","date":"2019-09-09T14:18:50.000Z","_content":"\n## ç¯å¢ƒé…ç½®\n1. å®‰è£…Golang\n   \n{% blockquote %}\nhttps://golang.google.cn/\n{% endblockquote %}\n\n2. è®¾ç½®Goç¯å¢ƒå˜é‡\n\n![01](è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1/gopath.png)\n\nåŒæ—¶è¦æ³¨æ„ï¼Œgoçš„å·¥ä½œç›®å½•ä¸ºè¯¥ç›®å½•ï¼Œå¦‚æœéœ€è¦åˆ‡æ¢éœ€è¦æ”¹å˜æ­¤è·¯å¾„ï¼Œä¸ç„¶å¯ä½¿ç”¨GoLandç­‰ideåˆ‡æ¢ã€‚\n<!-- more -->\n\n## ç®€å•å®ç°javaå‘½ä»¤\njava SDKè‡ªå¸¦å¾ˆå¤šå‘½ä»¤ï¼Œå¦‚javaã€javacã€javapç­‰ã€‚\njavaå‘½ä»¤æ˜¯å…¶ä¸­æœ€ç»ˆè¦çš„ä¸€ä¸ªï¼Œå¹³æ—¶æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªjarï¼Œå¦‚springbootå·¥ç¨‹ã€‚è¿˜æ˜¯ä¸€ä¸ªåŸºäºtomcatã€weblogicã€jbossçš„waråŒ…ã€‚å…¶æ ¹æœ¬éƒ½æ˜¯åˆ©ç”¨javaå‘½ä»¤æ‰§è¡Œmainæ–¹æ³•ä¸ºå…¥å£ã€‚\n\n{% codeblock %}\njava [-options] class [args]\njava [-options] -jar jarfile [args]\njavaw [-options] class [args]\njavaw [-options] -jar jarfile [args]\n{% endcodeblock %}\n\n{% blockquote %}\nå®˜æ–¹è¯´æ˜ï¼š  https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html\n{% endblockquote %}\n\n## ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\n1. javaå‘½ä»¤å…¥å‚ç»“æ„\n\n{% codeblock lang:go %}\ntype Cmd struct {\n\thelpFlag bool //å‘½ä»¤ä¸ºhelp æˆ– ? æ—¶ï¼štrue\n\tversionFlag bool //å‘½ä»¤æ˜¯å¦ä¸ºversionæ—¶ï¼štrue\n\tcpOption string //å‘½ä»¤ä¸ºcp æˆ– classpathæ—¶ï¼Œä¿å­˜å€¼\n\tXjreOption string //å‘½ä»¤ä¸ºXjreæ—¶ï¼Œä¿å­˜å€¼\n\tclass string //ä¿å­˜class\n\targs []string //ä¿å­˜å…¶ä»–å…¥å‚\n}\n{% endcodeblock %}\n\n2. è§£æå…¥å‚\n\n{% codeblock lang:go %}\nfunc parseCmd() *Cmd {\n\tcmd := &Cmd{} //å®ä¾‹åŒ–å…¥å‚å¯¹è±¡\n\tflag.Usage = printUsage //è®¾ç½®ç”¨æ³•è¯´æ˜\n\tflag.BoolVar(&cmd.helpFlag,\"help\",false,\"print help message\") //å‚æ•°ä¸ºhelpæ—¶ï¼Œ&cmd.helpFlag = true\n\tflag.BoolVar(&cmd.helpFlag,\"?\",false,\"print help message\") //å‚æ•°ä¸º?æ—¶ï¼Œ&cmd.helpFlag = true\n\tflag.BoolVar(&cmd.versionFlag,\"version\",false,\"print version and exit\") //å‚æ•°ä¸ºversionæ—¶ï¼Œ&cmd.versionFlag = true\n\tflag.StringVar(&cmd.cpOption,\"cp\",\"\",\"classpath\") //å‚æ•°ä¸ºversionæ—¶ï¼Œ&cmd.versionFlag = true\n\tflag.StringVar(&cmd.cpOption,\"classpath\",\"\",\"classpath\")\n\tflag.StringVar(&cmd.XjreOption,\"Xjre\",\"\",\"path to jres\")\n\tflag.Parse()\n\targs := flag.Args()\n\tif len(args) > 0 {\n\t\tcmd.class = args[0]\n\t\tcmd.args = args[1:]\n\t}\n\treturn cmd\n}\n\nfunc printUsage() {\n\tfmt.Printf(\"Usage: %s [-options] class [args...]\\n\",os.Args[0])\n}\n{% endcodeblock %}\n\n3. å¯åŠ¨æ–¹æ³•\n\n\n{% codeblock lang:go %}\nfunc main () {\n\tcmd := parseCmd() //è§£ææ–¹æ³•\n\tif cmd.versionFlag {\n\t\tfmt.Println(\"version 0.0.1\") //å…¥å‚ä¸ºversionæ—¶æ‰“å°ç‰ˆæœ¬å·\n\t} else if cmd.helpFlag || cmd.class == \"\" {\n\t\tprintUsage() //å…¥å‚ä¸ºhelpæˆ–?æˆ–classpathã€cpä¸ºç©ºæ—¶æ‰“å°è¯´æ˜\n\t}else {\n\t\tstartJVM(cmd) //å¯åŠ¨JVM\n\t}\n}\n\nfunc startJVM(cmd *Cmd){\n\tfmt.Printf(\"classpath:%s class:%s args:%v\",cmd.cpOption,cmd.class,cmd.args)\n}\n{% endcodeblock %}\n\n4. è¯•è¿è¡Œ\n\n{% codeblock lang:shell %}\nD:\\work\\workspace_go\\src\\jvmgo\\ch01> go install\n\nPS D:\\work\\workspace_go\\bin> .\\ch01.exe -version\nversion 0.0.1\n\nPS D:\\work\\workspace_go\\bin> .\\ch01.exe -help\nUsage: D:\\work\\workspace_go\\bin\\ch01.exe [-options] class [args...]\n\nPS D:\\work\\workspace_go\\bin> .\\ch01.exe -cp test.class a b c\nclasspath:test.class class:a args:[b c]\n{% endcodeblock %}","source":"_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1.md","raw":"---\ntitle: è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°1\ndate: 2019-09-09 22:18:50\ntags: \n    - JVM\n    - Java\n    - Go\ncategories :\n    - Technology\n---\n\n## ç¯å¢ƒé…ç½®\n1. å®‰è£…Golang\n   \n{% blockquote %}\nhttps://golang.google.cn/\n{% endblockquote %}\n\n2. è®¾ç½®Goç¯å¢ƒå˜é‡\n\n![01](è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1/gopath.png)\n\nåŒæ—¶è¦æ³¨æ„ï¼Œgoçš„å·¥ä½œç›®å½•ä¸ºè¯¥ç›®å½•ï¼Œå¦‚æœéœ€è¦åˆ‡æ¢éœ€è¦æ”¹å˜æ­¤è·¯å¾„ï¼Œä¸ç„¶å¯ä½¿ç”¨GoLandç­‰ideåˆ‡æ¢ã€‚\n<!-- more -->\n\n## ç®€å•å®ç°javaå‘½ä»¤\njava SDKè‡ªå¸¦å¾ˆå¤šå‘½ä»¤ï¼Œå¦‚javaã€javacã€javapç­‰ã€‚\njavaå‘½ä»¤æ˜¯å…¶ä¸­æœ€ç»ˆè¦çš„ä¸€ä¸ªï¼Œå¹³æ—¶æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªjarï¼Œå¦‚springbootå·¥ç¨‹ã€‚è¿˜æ˜¯ä¸€ä¸ªåŸºäºtomcatã€weblogicã€jbossçš„waråŒ…ã€‚å…¶æ ¹æœ¬éƒ½æ˜¯åˆ©ç”¨javaå‘½ä»¤æ‰§è¡Œmainæ–¹æ³•ä¸ºå…¥å£ã€‚\n\n{% codeblock %}\njava [-options] class [args]\njava [-options] -jar jarfile [args]\njavaw [-options] class [args]\njavaw [-options] -jar jarfile [args]\n{% endcodeblock %}\n\n{% blockquote %}\nå®˜æ–¹è¯´æ˜ï¼š  https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html\n{% endblockquote %}\n\n## ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\n1. javaå‘½ä»¤å…¥å‚ç»“æ„\n\n{% codeblock lang:go %}\ntype Cmd struct {\n\thelpFlag bool //å‘½ä»¤ä¸ºhelp æˆ– ? æ—¶ï¼štrue\n\tversionFlag bool //å‘½ä»¤æ˜¯å¦ä¸ºversionæ—¶ï¼štrue\n\tcpOption string //å‘½ä»¤ä¸ºcp æˆ– classpathæ—¶ï¼Œä¿å­˜å€¼\n\tXjreOption string //å‘½ä»¤ä¸ºXjreæ—¶ï¼Œä¿å­˜å€¼\n\tclass string //ä¿å­˜class\n\targs []string //ä¿å­˜å…¶ä»–å…¥å‚\n}\n{% endcodeblock %}\n\n2. è§£æå…¥å‚\n\n{% codeblock lang:go %}\nfunc parseCmd() *Cmd {\n\tcmd := &Cmd{} //å®ä¾‹åŒ–å…¥å‚å¯¹è±¡\n\tflag.Usage = printUsage //è®¾ç½®ç”¨æ³•è¯´æ˜\n\tflag.BoolVar(&cmd.helpFlag,\"help\",false,\"print help message\") //å‚æ•°ä¸ºhelpæ—¶ï¼Œ&cmd.helpFlag = true\n\tflag.BoolVar(&cmd.helpFlag,\"?\",false,\"print help message\") //å‚æ•°ä¸º?æ—¶ï¼Œ&cmd.helpFlag = true\n\tflag.BoolVar(&cmd.versionFlag,\"version\",false,\"print version and exit\") //å‚æ•°ä¸ºversionæ—¶ï¼Œ&cmd.versionFlag = true\n\tflag.StringVar(&cmd.cpOption,\"cp\",\"\",\"classpath\") //å‚æ•°ä¸ºversionæ—¶ï¼Œ&cmd.versionFlag = true\n\tflag.StringVar(&cmd.cpOption,\"classpath\",\"\",\"classpath\")\n\tflag.StringVar(&cmd.XjreOption,\"Xjre\",\"\",\"path to jres\")\n\tflag.Parse()\n\targs := flag.Args()\n\tif len(args) > 0 {\n\t\tcmd.class = args[0]\n\t\tcmd.args = args[1:]\n\t}\n\treturn cmd\n}\n\nfunc printUsage() {\n\tfmt.Printf(\"Usage: %s [-options] class [args...]\\n\",os.Args[0])\n}\n{% endcodeblock %}\n\n3. å¯åŠ¨æ–¹æ³•\n\n\n{% codeblock lang:go %}\nfunc main () {\n\tcmd := parseCmd() //è§£ææ–¹æ³•\n\tif cmd.versionFlag {\n\t\tfmt.Println(\"version 0.0.1\") //å…¥å‚ä¸ºversionæ—¶æ‰“å°ç‰ˆæœ¬å·\n\t} else if cmd.helpFlag || cmd.class == \"\" {\n\t\tprintUsage() //å…¥å‚ä¸ºhelpæˆ–?æˆ–classpathã€cpä¸ºç©ºæ—¶æ‰“å°è¯´æ˜\n\t}else {\n\t\tstartJVM(cmd) //å¯åŠ¨JVM\n\t}\n}\n\nfunc startJVM(cmd *Cmd){\n\tfmt.Printf(\"classpath:%s class:%s args:%v\",cmd.cpOption,cmd.class,cmd.args)\n}\n{% endcodeblock %}\n\n4. è¯•è¿è¡Œ\n\n{% codeblock lang:shell %}\nD:\\work\\workspace_go\\src\\jvmgo\\ch01> go install\n\nPS D:\\work\\workspace_go\\bin> .\\ch01.exe -version\nversion 0.0.1\n\nPS D:\\work\\workspace_go\\bin> .\\ch01.exe -help\nUsage: D:\\work\\workspace_go\\bin\\ch01.exe [-options] class [args...]\n\nPS D:\\work\\workspace_go\\bin> .\\ch01.exe -cp test.class a b c\nclasspath:test.class class:a args:[b c]\n{% endcodeblock %}","slug":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1","published":1,"updated":"2020-12-14T10:35:49.430Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71hts001nv252hbb3dttk","content":"<html><head></head><body><h2 id=\"&#x73AF;&#x5883;&#x914D;&#x7F6E;\"><a href=\"#&#x73AF;&#x5883;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x73AF;&#x5883;&#x914D;&#x7F6E;\"></a>&#x73AF;&#x5883;&#x914D;&#x7F6E;</h2><ol>\n<li>&#x5B89;&#x88C5;Golang</li>\n</ol>\n<blockquote><p><a href=\"https://golang.google.cn/\">https://golang.google.cn/</a></p>\n</blockquote>\n\n<ol start=\"2\">\n<li>&#x8BBE;&#x7F6E;Go&#x73AF;&#x5883;&#x53D8;&#x91CF;</li>\n</ol>\n<p><img src=\"/2019/09/09/%E8%87%AA%E5%B7%B1%E5%8A%A8%E6%89%8B%E5%86%99Java%E8%99%9A%E6%8B%9F%E6%9C%BA-%E7%AC%94%E8%AE%B01/gopath.png\" alt=\"01\"></p>\n<p>&#x540C;&#x65F6;&#x8981;&#x6CE8;&#x610F;&#xFF0C;go&#x7684;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x4E3A;&#x8BE5;&#x76EE;&#x5F55;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x5207;&#x6362;&#x9700;&#x8981;&#x6539;&#x53D8;&#x6B64;&#x8DEF;&#x5F84;&#xFF0C;&#x4E0D;&#x7136;&#x53EF;&#x4F7F;&#x7528;GoLand&#x7B49;ide&#x5207;&#x6362;&#x3002;</p>\n<a id=\"more\"></a>\n\n<h2 id=\"&#x7B80;&#x5355;&#x5B9E;&#x73B0;java&#x547D;&#x4EE4;\"><a href=\"#&#x7B80;&#x5355;&#x5B9E;&#x73B0;java&#x547D;&#x4EE4;\" class=\"headerlink\" title=\"&#x7B80;&#x5355;&#x5B9E;&#x73B0;java&#x547D;&#x4EE4;\"></a>&#x7B80;&#x5355;&#x5B9E;&#x73B0;java&#x547D;&#x4EE4;</h2><p>java SDK&#x81EA;&#x5E26;&#x5F88;&#x591A;&#x547D;&#x4EE4;&#xFF0C;&#x5982;java&#x3001;javac&#x3001;javap&#x7B49;&#x3002;<br>java&#x547D;&#x4EE4;&#x662F;&#x5176;&#x4E2D;&#x6700;&#x7EC8;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#xFF0C;&#x5E73;&#x65F6;&#x6211;&#x4EEC;&#x542F;&#x52A8;&#x4E00;&#x4E2A;jar&#xFF0C;&#x5982;springboot&#x5DE5;&#x7A0B;&#x3002;&#x8FD8;&#x662F;&#x4E00;&#x4E2A;&#x57FA;&#x4E8E;tomcat&#x3001;weblogic&#x3001;jboss&#x7684;war&#x5305;&#x3002;&#x5176;&#x6839;&#x672C;&#x90FD;&#x662F;&#x5229;&#x7528;java&#x547D;&#x4EE4;&#x6267;&#x884C;main&#x65B9;&#x6CD5;&#x4E3A;&#x5165;&#x53E3;&#x3002;</p>\n<figure class=\"highlight plain hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java [-options] class [args]</span><br><span class=\"line\">java [-options] -jar jarfile [args]</span><br><span class=\"line\">javaw [-options] class [args]</span><br><span class=\"line\">javaw [-options] -jar jarfile [args]</span><br></pre></td></tr></tbody></table></figure>\n\n<blockquote><p>&#x5B98;&#x65B9;&#x8BF4;&#x660E;&#xFF1A;  <a href=\"https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html\">https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html</a></p>\n</blockquote>\n\n<h2 id=\"&#x7528;Go&#x5B9E;&#x73B0;java&#x547D;&#x4EE4;&#x7684;&#x53C2;&#x6570;&#x8BFB;&#x53D6;\"><a href=\"#&#x7528;Go&#x5B9E;&#x73B0;java&#x547D;&#x4EE4;&#x7684;&#x53C2;&#x6570;&#x8BFB;&#x53D6;\" class=\"headerlink\" title=\"&#x7528;Go&#x5B9E;&#x73B0;java&#x547D;&#x4EE4;&#x7684;&#x53C2;&#x6570;&#x8BFB;&#x53D6;\"></a>&#x7528;Go&#x5B9E;&#x73B0;java&#x547D;&#x4EE4;&#x7684;&#x53C2;&#x6570;&#x8BFB;&#x53D6;</h2><ol>\n<li>java&#x547D;&#x4EE4;&#x5165;&#x53C2;&#x7ED3;&#x6784;</li>\n</ol>\n<figure class=\"highlight go hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> Cmd <span class=\"hljs-keyword\">struct</span> {</span><br><span class=\"line\">\thelpFlag <span class=\"hljs-keyword\">bool</span> <span class=\"hljs-comment\">//&#x547D;&#x4EE4;&#x4E3A;help &#x6216; ? &#x65F6;&#xFF1A;true</span></span><br><span class=\"line\">\tversionFlag <span class=\"hljs-keyword\">bool</span> <span class=\"hljs-comment\">//&#x547D;&#x4EE4;&#x662F;&#x5426;&#x4E3A;version&#x65F6;&#xFF1A;true</span></span><br><span class=\"line\">\tcpOption <span class=\"hljs-keyword\">string</span> <span class=\"hljs-comment\">//&#x547D;&#x4EE4;&#x4E3A;cp &#x6216; classpath&#x65F6;&#xFF0C;&#x4FDD;&#x5B58;&#x503C;</span></span><br><span class=\"line\">\tXjreOption <span class=\"hljs-keyword\">string</span> <span class=\"hljs-comment\">//&#x547D;&#x4EE4;&#x4E3A;Xjre&#x65F6;&#xFF0C;&#x4FDD;&#x5B58;&#x503C;</span></span><br><span class=\"line\">\tclass <span class=\"hljs-keyword\">string</span> <span class=\"hljs-comment\">//&#x4FDD;&#x5B58;class</span></span><br><span class=\"line\">\targs []<span class=\"hljs-keyword\">string</span> <span class=\"hljs-comment\">//&#x4FDD;&#x5B58;&#x5176;&#x4ED6;&#x5165;&#x53C2;</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<ol start=\"2\">\n<li>&#x89E3;&#x6790;&#x5165;&#x53C2;</li>\n</ol>\n<figure class=\"highlight go hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">parseCmd</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Cmd</span></span> {</span><br><span class=\"line\">\tcmd := &amp;Cmd{} <span class=\"hljs-comment\">//&#x5B9E;&#x4F8B;&#x5316;&#x5165;&#x53C2;&#x5BF9;&#x8C61;</span></span><br><span class=\"line\">\tflag.Usage = printUsage <span class=\"hljs-comment\">//&#x8BBE;&#x7F6E;&#x7528;&#x6CD5;&#x8BF4;&#x660E;</span></span><br><span class=\"line\">\tflag.BoolVar(&amp;cmd.helpFlag,<span class=\"hljs-string\">&quot;help&quot;</span>,<span class=\"hljs-literal\">false</span>,<span class=\"hljs-string\">&quot;print help message&quot;</span>) <span class=\"hljs-comment\">//&#x53C2;&#x6570;&#x4E3A;help&#x65F6;&#xFF0C;&amp;cmd.helpFlag = true</span></span><br><span class=\"line\">\tflag.BoolVar(&amp;cmd.helpFlag,<span class=\"hljs-string\">&quot;?&quot;</span>,<span class=\"hljs-literal\">false</span>,<span class=\"hljs-string\">&quot;print help message&quot;</span>) <span class=\"hljs-comment\">//&#x53C2;&#x6570;&#x4E3A;?&#x65F6;&#xFF0C;&amp;cmd.helpFlag = true</span></span><br><span class=\"line\">\tflag.BoolVar(&amp;cmd.versionFlag,<span class=\"hljs-string\">&quot;version&quot;</span>,<span class=\"hljs-literal\">false</span>,<span class=\"hljs-string\">&quot;print version and exit&quot;</span>) <span class=\"hljs-comment\">//&#x53C2;&#x6570;&#x4E3A;version&#x65F6;&#xFF0C;&amp;cmd.versionFlag = true</span></span><br><span class=\"line\">\tflag.StringVar(&amp;cmd.cpOption,<span class=\"hljs-string\">&quot;cp&quot;</span>,<span class=\"hljs-string\">&quot;&quot;</span>,<span class=\"hljs-string\">&quot;classpath&quot;</span>) <span class=\"hljs-comment\">//&#x53C2;&#x6570;&#x4E3A;version&#x65F6;&#xFF0C;&amp;cmd.versionFlag = true</span></span><br><span class=\"line\">\tflag.StringVar(&amp;cmd.cpOption,<span class=\"hljs-string\">&quot;classpath&quot;</span>,<span class=\"hljs-string\">&quot;&quot;</span>,<span class=\"hljs-string\">&quot;classpath&quot;</span>)</span><br><span class=\"line\">\tflag.StringVar(&amp;cmd.XjreOption,<span class=\"hljs-string\">&quot;Xjre&quot;</span>,<span class=\"hljs-string\">&quot;&quot;</span>,<span class=\"hljs-string\">&quot;path to jres&quot;</span>)</span><br><span class=\"line\">\tflag.Parse()</span><br><span class=\"line\">\targs := flag.Args()</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">len</span>(args) &gt; <span class=\"hljs-number\">0</span> {</span><br><span class=\"line\">\t\tcmd.class = args[<span class=\"hljs-number\">0</span>]</span><br><span class=\"line\">\t\tcmd.args = args[<span class=\"hljs-number\">1</span>:]</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> cmd</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">printUsage</span><span class=\"hljs-params\">()</span></span> {</span><br><span class=\"line\">\tfmt.Printf(<span class=\"hljs-string\">&quot;Usage: %s [-options] class [args...]\\n&quot;</span>,os.Args[<span class=\"hljs-number\">0</span>])</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<ol start=\"3\">\n<li>&#x542F;&#x52A8;&#x65B9;&#x6CD5;</li>\n</ol>\n<figure class=\"highlight go hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">main</span> <span class=\"hljs-params\">()</span></span> {</span><br><span class=\"line\">\tcmd := parseCmd() <span class=\"hljs-comment\">//&#x89E3;&#x6790;&#x65B9;&#x6CD5;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> cmd.versionFlag {</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"hljs-string\">&quot;version 0.0.1&quot;</span>) <span class=\"hljs-comment\">//&#x5165;&#x53C2;&#x4E3A;version&#x65F6;&#x6253;&#x5370;&#x7248;&#x672C;&#x53F7;</span></span><br><span class=\"line\">\t} <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> cmd.helpFlag || cmd.class == <span class=\"hljs-string\">&quot;&quot;</span> {</span><br><span class=\"line\">\t\tprintUsage() <span class=\"hljs-comment\">//&#x5165;&#x53C2;&#x4E3A;help&#x6216;?&#x6216;classpath&#x3001;cp&#x4E3A;&#x7A7A;&#x65F6;&#x6253;&#x5370;&#x8BF4;&#x660E;</span></span><br><span class=\"line\">\t}<span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">\t\tstartJVM(cmd) <span class=\"hljs-comment\">//&#x542F;&#x52A8;JVM</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">startJVM</span><span class=\"hljs-params\">(cmd *Cmd)</span></span>{</span><br><span class=\"line\">\tfmt.Printf(<span class=\"hljs-string\">&quot;classpath:%s class:%s args:%v&quot;</span>,cmd.cpOption,cmd.class,cmd.args)</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<ol start=\"4\">\n<li>&#x8BD5;&#x8FD0;&#x884C;</li>\n</ol>\n<figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">D:\\work\\workspace_go\\src\\jvmgo\\ch01&gt; go install</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch01.exe -version</span><br><span class=\"line\">version 0.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch01.exe -help</span><br><span class=\"line\">Usage: D:\\work\\workspace_go\\bin\\ch01.exe [-options] class [args...]</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch01.exe -cp test.class a b c</span><br><span class=\"line\">classpath:test.class class:a args:[b c]</span><br></pre></td></tr></tbody></table></figure></body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"JVM","path":"tags/JVM/"},{"name":"Java","path":"tags/Java/"},{"name":"Go","path":"tags/Go/"}],"excerpt":"<html><head></head><body><h2 id=\"&#x73AF;&#x5883;&#x914D;&#x7F6E;\"><a href=\"#&#x73AF;&#x5883;&#x914D;&#x7F6E;\" class=\"headerlink\" title=\"&#x73AF;&#x5883;&#x914D;&#x7F6E;\"></a>&#x73AF;&#x5883;&#x914D;&#x7F6E;</h2><ol>\n<li>&#x5B89;&#x88C5;Golang</li>\n</ol>\n<blockquote><p><a href=\"https://golang.google.cn/\">https://golang.google.cn/</a></p>\n</blockquote>\n\n<ol start=\"2\">\n<li>&#x8BBE;&#x7F6E;Go&#x73AF;&#x5883;&#x53D8;&#x91CF;</li>\n</ol>\n<p><img src=\"/2019/09/09/%E8%87%AA%E5%B7%B1%E5%8A%A8%E6%89%8B%E5%86%99Java%E8%99%9A%E6%8B%9F%E6%9C%BA-%E7%AC%94%E8%AE%B01/gopath.png\" alt=\"01\"></p>\n<p>&#x540C;&#x65F6;&#x8981;&#x6CE8;&#x610F;&#xFF0C;go&#x7684;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;&#x4E3A;&#x8BE5;&#x76EE;&#x5F55;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x5207;&#x6362;&#x9700;&#x8981;&#x6539;&#x53D8;&#x6B64;&#x8DEF;&#x5F84;&#xFF0C;&#x4E0D;&#x7136;&#x53EF;&#x4F7F;&#x7528;GoLand&#x7B49;ide&#x5207;&#x6362;&#x3002;</p></body></html>","more":"<h2 id=\"ç®€å•å®ç°javaå‘½ä»¤\"><a href=\"#ç®€å•å®ç°javaå‘½ä»¤\" class=\"headerlink\" title=\"ç®€å•å®ç°javaå‘½ä»¤\"></a>ç®€å•å®ç°javaå‘½ä»¤</h2><p>java SDKè‡ªå¸¦å¾ˆå¤šå‘½ä»¤ï¼Œå¦‚javaã€javacã€javapç­‰ã€‚<br>javaå‘½ä»¤æ˜¯å…¶ä¸­æœ€ç»ˆè¦çš„ä¸€ä¸ªï¼Œå¹³æ—¶æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªjarï¼Œå¦‚springbootå·¥ç¨‹ã€‚è¿˜æ˜¯ä¸€ä¸ªåŸºäºtomcatã€weblogicã€jbossçš„waråŒ…ã€‚å…¶æ ¹æœ¬éƒ½æ˜¯åˆ©ç”¨javaå‘½ä»¤æ‰§è¡Œmainæ–¹æ³•ä¸ºå…¥å£ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java [-options] class [args]</span><br><span class=\"line\">java [-options] -jar jarfile [args]</span><br><span class=\"line\">javaw [-options] class [args]</span><br><span class=\"line\">javaw [-options] -jar jarfile [args]</span><br></pre></td></tr></table></figure>\n\n<blockquote><p>å®˜æ–¹è¯´æ˜ï¼š  <a href=\"https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html\">https://docs.oracle.com/javase/8/docs/technotes/tools/windows/java.html</a></p>\n</blockquote>\n\n<h2 id=\"ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\"><a href=\"#ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\" class=\"headerlink\" title=\"ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–\"></a>ç”¨Goå®ç°javaå‘½ä»¤çš„å‚æ•°è¯»å–</h2><ol>\n<li>javaå‘½ä»¤å…¥å‚ç»“æ„</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Cmd <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\thelpFlag <span class=\"keyword\">bool</span> <span class=\"comment\">//å‘½ä»¤ä¸ºhelp æˆ– ? æ—¶ï¼štrue</span></span><br><span class=\"line\">\tversionFlag <span class=\"keyword\">bool</span> <span class=\"comment\">//å‘½ä»¤æ˜¯å¦ä¸ºversionæ—¶ï¼štrue</span></span><br><span class=\"line\">\tcpOption <span class=\"keyword\">string</span> <span class=\"comment\">//å‘½ä»¤ä¸ºcp æˆ– classpathæ—¶ï¼Œä¿å­˜å€¼</span></span><br><span class=\"line\">\tXjreOption <span class=\"keyword\">string</span> <span class=\"comment\">//å‘½ä»¤ä¸ºXjreæ—¶ï¼Œä¿å­˜å€¼</span></span><br><span class=\"line\">\tclass <span class=\"keyword\">string</span> <span class=\"comment\">//ä¿å­˜class</span></span><br><span class=\"line\">\targs []<span class=\"keyword\">string</span> <span class=\"comment\">//ä¿å­˜å…¶ä»–å…¥å‚</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>è§£æå…¥å‚</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">parseCmd</span><span class=\"params\">()</span> *<span class=\"title\">Cmd</span></span> &#123;</span><br><span class=\"line\">\tcmd := &amp;Cmd&#123;&#125; <span class=\"comment\">//å®ä¾‹åŒ–å…¥å‚å¯¹è±¡</span></span><br><span class=\"line\">\tflag.Usage = printUsage <span class=\"comment\">//è®¾ç½®ç”¨æ³•è¯´æ˜</span></span><br><span class=\"line\">\tflag.BoolVar(&amp;cmd.helpFlag,<span class=\"string\">&quot;help&quot;</span>,<span class=\"literal\">false</span>,<span class=\"string\">&quot;print help message&quot;</span>) <span class=\"comment\">//å‚æ•°ä¸ºhelpæ—¶ï¼Œ&amp;cmd.helpFlag = true</span></span><br><span class=\"line\">\tflag.BoolVar(&amp;cmd.helpFlag,<span class=\"string\">&quot;?&quot;</span>,<span class=\"literal\">false</span>,<span class=\"string\">&quot;print help message&quot;</span>) <span class=\"comment\">//å‚æ•°ä¸º?æ—¶ï¼Œ&amp;cmd.helpFlag = true</span></span><br><span class=\"line\">\tflag.BoolVar(&amp;cmd.versionFlag,<span class=\"string\">&quot;version&quot;</span>,<span class=\"literal\">false</span>,<span class=\"string\">&quot;print version and exit&quot;</span>) <span class=\"comment\">//å‚æ•°ä¸ºversionæ—¶ï¼Œ&amp;cmd.versionFlag = true</span></span><br><span class=\"line\">\tflag.StringVar(&amp;cmd.cpOption,<span class=\"string\">&quot;cp&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"string\">&quot;classpath&quot;</span>) <span class=\"comment\">//å‚æ•°ä¸ºversionæ—¶ï¼Œ&amp;cmd.versionFlag = true</span></span><br><span class=\"line\">\tflag.StringVar(&amp;cmd.cpOption,<span class=\"string\">&quot;classpath&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"string\">&quot;classpath&quot;</span>)</span><br><span class=\"line\">\tflag.StringVar(&amp;cmd.XjreOption,<span class=\"string\">&quot;Xjre&quot;</span>,<span class=\"string\">&quot;&quot;</span>,<span class=\"string\">&quot;path to jres&quot;</span>)</span><br><span class=\"line\">\tflag.Parse()</span><br><span class=\"line\">\targs := flag.Args()</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(args) &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\tcmd.class = args[<span class=\"number\">0</span>]</span><br><span class=\"line\">\t\tcmd.args = args[<span class=\"number\">1</span>:]</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> cmd</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">printUsage</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;Usage: %s [-options] class [args...]\\n&quot;</span>,os.Args[<span class=\"number\">0</span>])</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>å¯åŠ¨æ–¹æ³•</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span> <span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\tcmd := parseCmd() <span class=\"comment\">//è§£ææ–¹æ³•</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> cmd.versionFlag &#123;</span><br><span class=\"line\">\t\tfmt.Println(<span class=\"string\">&quot;version 0.0.1&quot;</span>) <span class=\"comment\">//å…¥å‚ä¸ºversionæ—¶æ‰“å°ç‰ˆæœ¬å·</span></span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> cmd.helpFlag || cmd.class == <span class=\"string\">&quot;&quot;</span> &#123;</span><br><span class=\"line\">\t\tprintUsage() <span class=\"comment\">//å…¥å‚ä¸ºhelpæˆ–?æˆ–classpathã€cpä¸ºç©ºæ—¶æ‰“å°è¯´æ˜</span></span><br><span class=\"line\">\t&#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\tstartJVM(cmd) <span class=\"comment\">//å¯åŠ¨JVM</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">startJVM</span><span class=\"params\">(cmd *Cmd)</span></span>&#123;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;classpath:%s class:%s args:%v&quot;</span>,cmd.cpOption,cmd.class,cmd.args)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>è¯•è¿è¡Œ</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">D:\\work\\workspace_go\\src\\jvmgo\\ch01&gt; go install</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch01.exe -version</span><br><span class=\"line\">version 0.0.1</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch01.exe -help</span><br><span class=\"line\">Usage: D:\\work\\workspace_go\\bin\\ch01.exe [-options] class [args...]</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch01.exe -cp test.class a b c</span><br><span class=\"line\">classpath:test.class class:a args:[b c]</span><br></pre></td></tr></table></figure>"},{"title":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°2","date":"2019-09-10T13:47:52.000Z","_content":"\n## å®ç°cp/classpath å‚æ•°æœç´¢classæ–‡ä»¶\n\n### java class path æœç´¢é¡ºåºï¼š\n1. å¯åŠ¨ç±»è·¯å¾„ï¼ˆbootstrap classpathï¼‰:jre\\lib ï¼ˆå¯é€šè¿‡-Xbootclasspathå‚æ•°ä¿®æ”¹è¯¥è·¯å¾„ï¼‰\n2. æ‰©å±•ç±»è·¯å¾„ï¼ˆextension classpathï¼‰:jre\\lib\\ext\n3. ç”¨æˆ·ç±»è·¯å¾„ï¼ˆuser classpathï¼‰:ç”¨æˆ·è‡ªå·±æŒ‡å®š\n\n<!-- more -->\n\n### å®ç°\n1. Entryæ¥å£ç”¨æ¥å®šä¹‰å¯åŠ¨ç±»çš„åŸºæœ¬åŠŸèƒ½\n\n{% codeblock lang:go %}\nconst pathListSeparator = string(os.PathListSeparator) //è·å–å½“å‰æ“ä½œç³»ç»Ÿåˆ†éš”ç¬¦\n\ntype Entry interface {\n\treadClass(classNme string) ([]byte,Entry,error) //å®šä¹‰æŒ‰classåè¯»å–classæ–‡ä»¶çš„æ–¹\n\tString() string \n}\n\n//æ ¹æ®classpathç”Ÿæˆå¯¹åº”çš„å¯åŠ¨ç±»\nfunc newEntry(path string) Entry {\n\tif strings.Contains(path,pathListSeparator){ //classpathè·¯å¾„åŒ…å«ç³»ç»Ÿåˆ†å‰²ç¬¦æ—¶ï¼Œnewç»„åˆå¯åŠ¨ç±»\n\t\treturn newCompositeEntry(path)\n\t}\n\n\tif strings.HasSuffix(path,\"*\") {\n\t\treturn newWildcardEntry(path) //classpathè·¯å¾„åŒ…å«*æ—¶ï¼Œnewé€šé…ç¬¦å¯åŠ¨ç±»\n\t}\n\n\tif strings.HasSuffix(path, \".jar\") || strings.HasSuffix(path, \".JAR\") ||\n      strings.HasSuffix(path, \".zip\") || strings.HasSuffix(path, \".ZIP\") {\n      return newZipEntry(path) //classpathè·¯å¾„åŒ…å«jarã€JARã€zipã€ZIPæ—¶ï¼Œnewæ–‡ä»¶å¤¹å¯åŠ¨ç±»\n   }\n\treturn newDirEntry(path)\n\n}\n{% endcodeblock %}\n\n2. Entryæ¥å£çš„å…·ä½“å®ç°\n * DirEntryï¼ŒæŒ‰ç…§æ–‡ä»¶è·¯å¾„è¯»å–æ–‡ä»¶äºŒè¿›åˆ¶æµ \n{% codeblock lang:golang %}\ntype DirEntry struct {\n\tabsDir string //å­˜å‚¨æ–‡ä»¶å¤¹è·¯å¾„\n}\n\nfunc newDirEntry(path string) *DirEntry {\n\tabsDir,err := filepath.Abs(path) //å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„\n\tif err != nil {\n\t\tpanic(err) //æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨æ—¶æç¤ºé”™è¯¯\n\t}\n\n\treturn &DirEntry{absDir} //è¿”å›DirEntryå®ä¾‹\n}\n\nfunc (self *DirEntry) readClass(className string) ([]byte,Entry,error){\n\tfileName := filepath.Join(self.absDir,className) //æ‹¼æ¥æ–‡ä»¶å¤¹è·¯å¾„å’Œclassname\n\tdata,err := ioutil.ReadFile(fileName) //è¯»å–æ–‡ä»¶\n\treturn data,self,err //è¿”å›æ–‡ä»¶å†…å®¹\n}\n\nfunc(self *DirEntry) String() string {\n\treturn self.absDir //è¿”å›æ–‡ä»¶å¤¹è·¯å¾„\n}\n{% endcodeblock %}\n\n * ZipEntry,è¯»å–å‹ç¼©æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶\n{% codeblock lang:golang %}\ntype ZipEnty struct {\n\tabsPath string //æ–‡ä»¶å¤¹è·¯å¾„\n}\n\nfunc newZipEntry(path string) *ZipEnty {\n\tabsPath, err := filepath.Abs(path) //å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn &ZipEnty{absPath}\n}\n\nfunc (self *ZipEnty) readClass(className string) ([]byte,Entry,error){\n\tr, err := zip.OpenReader(self.absPath) //ä»¥å‹ç¼©æ–‡ä»¶æ ¼å¼è§£å‹\n\tif err != nil {\n\t   return nil, nil, err\n\t}\n\tdefer r.Close() //æœ€åå…³é—­æ–‡ä»¶æµ\n\tfor _, f := range r.File { //å¾ªç¯è§£å‹å‡ºæ¥çš„æ–‡ä»¶\n\t   if f.Name == className { //å¦‚æœå½“å‰æ–‡ä»¶ä¸ºæŒ‡å®šæ–‡ä»¶\n\t\t  rc, err := f.Open() //æ‰“å¼€è¯¥æ–‡ä»¶\n\t\t  if err != nil {\n\t\t\t return nil, nil, err\n\t\t  }\n\t\t  defer rc.Close() //æœ€åå…³é—­æ–‡ä»¶\n\t\t  data, err := ioutil.ReadAll(rc) //è¯»å–æ–‡ä»¶æµ\n\t\t  if err != nil {\n\t\t\t return nil, nil, err\n\t\t  }\n\t\t  return data, self, nil //è¿”å›æ–‡ä»¶æµ\n\t   }\n\t}\n\treturn nil, nil, errors.New(\"class not found: \" + className)\n}\n\nfunc (self *ZipEnty) String() string {\n\treturn self.absPath\n}\n{% endcodeblock %}\n\n * CompositeEntry,è¯»å–ç¬¦åˆæ–‡ä»¶ç±»å‹\n{% codeblock lang:golang %}\ntype CompositeEntry []Entry //CompositeEntryä¸ºå¤šç§Entryçš„æ•°ç»„ï¼ˆDirã€Zipï¼‰\n\nfunc newCompositeEntry(pathList string) CompositeEntry {\n\tcompositeEntry := []Entry{} //å®ä¾‹Entryæ¥å£æ•°ç»„\n\n\tfor _,path := range strings.Split(pathList,pathListSeparator){ //æŒ‰ç…§ç³»ç»Ÿåˆ†å‰²ç¬¦æˆªå–pathåˆ—è¡¨ï¼Œå¹¶å¾ªç¯\n\t\tentry := newEntry(path) //æŒ‰ç…§æ¯ç§pathå®ä¾‹åŒ–ä¸åŒçš„Entry(Dirã€Zipã€Wildcard)\n\t\tcompositeEntry = append(compositeEntry,entry) //å°†å®ä¾‹åŒ–çš„ä¸åŒEntryæ”¾å…¥CompositeEntryæ•°ç»„ä¸­\n\t}\n\treturn compositeEntry\n}\n\nfunc (self CompositeEntry) readClass(className string)([]byte,Entry,error){\n\tfor _, entry := range self { //å¾ªç¯compositeEntryæ•°ç»„\n\t\tdata, from, err := entry.readClass(className) //æ ¹æ®ä¸åŒEntry(Dirã€Zipã€Wildcard)ï¼ŒæŒ‰æŒ‡å®šclassnameè¯»å–æ–‡ä»¶\n\t\tif err == nil {\n\t\t   return data, from, nil //è¿”å›è¯»å–ç»“æœ\n\t\t}\n\t }\n\t return nil, nil, errors.New(\"class not found: \" + className) //æ— ç»“æœæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯\n}\n\nfunc (self CompositeEntry) String() string {\n\tstrs := make([]string, len(self)) //æŒ‰ç…§CompositeEntryçš„é•¿åº¦ç”³æ˜è¯¥é•¿åº¦çš„Sringæ•°ç»„\n\tfor i, entry := range self { //å¾ªç¯CompositeEntry\n\t   strs[i] = entry.String() //è°ƒç”¨æ¯ä¸ªEntry(Dirã€Zipã€Wildcard)å®ç°ç±»çš„String()æ–¹æ³•,å¹¶æ”¾å…¥Stringæ•°ç»„ä¸­\n\t}\n\treturn strings.Join(strs, pathListSeparator) //å°†Stringæ•°ç»„ä¸­çš„ç»“æœä»¥ç³»ç»Ÿåˆ†éš”ç¬¦æ‹¼æ¥å¹¶è¿”å›\n}\n{% endcodeblock %}\n\n * WildcardEntryï¼ŒæŒ‰ç…§é€šé…ç¬¦è§£ææ–‡ä»¶\n{% codeblock lang:golang %}\nfunc newWildcardEntry(path string) CompositeEntry {\n\tbaseDir := path[:len(path)-1] // remove *\n\tcompositeEntry := []Entry{} //ç”³æ˜compositeEntryå¯¹è±¡(Entryçš„æ•°ç»„)\n\twalkFn := func(path string, info os.FileInfo, err error) error {\n\t\tif err != nil {\n\t\t   return err\n\t\t}\n\t\tif info.IsDir() && path != baseDir { //å¦‚æœå½“å‰ç›®å½•æ˜¯æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ˜¯æ ¹ç›®å½•\n\t\t   return filepath.SkipDir //è¿”å›SkipDirçš„é”™è¯¯\n\t\t}\n\t\tif strings.HasSuffix(path, \".jar\") || strings.HasSuffix(path, \".JAR\") { //å¦‚æœå½“å‰è·¯å¾„æ˜¯ä»¥.jaræˆ–.JARç»“å°¾çš„\n\t\t\tjarEntry := newZipEntry(path) //å®ä¾‹åŒ–ZipEntry\n\t\t\tcompositeEntry = append(compositeEntry, jarEntry) //å°†å®ä¾‹åŒ–çš„ZipEntryå¯¹è±¡æ”¾å…¥compositeEntryæ•°ç»„ä¸­\n\t\t }\n\t\t return nil\n\t  }\n\tfilepath.Walk(baseDir, walkFn) //å°†walkFnæ–¹æ³•ä¼ é€’ç»™filepath.Walk\n\treturn compositeEntry //è¿”å›ç»“æœ\n }\n{% endcodeblock %}\n\n* Classpathï¼Œ-cp|classpathå‚æ•°è§£æå®ç°çš„å…¥å£æ–¹æ³•\n{% codeblock lang:golang %}\ntype Classpath struct { //ClasspathåŒ…å«javaçš„ä¸‰ç§åŸºç¡€å¯åŠ¨è·¯å¾„\n\tbootClasspath Entry \n\textClasspath Entry\n\tuserClasspath Entry\n}\n\nfunc Parse(jreOption, cpOption string) * Classpath  {\n\tcp := &Classpath{} //å®ä¾‹åŒ–Classpathå¯¹è±¡\n\tcp.parseBootAndExtClasspath(jreOption) //æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„\n\tcp.parseUserClasspath(cpOption) //æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨è·¯å¾„\n\treturn cp //è¿”å›è®¾ç½®å¥½å¯åŠ¨è·¯å¾„çš„Classpathå¯¹è±¡\n}\n\nfunc (self *Classpath) ReadClass(className string) ([]byte,Entry,error){\n\tclassName = className + \".class\" //åˆå§‹åŒ–classNameæ–‡ä»¶å\n\tif data, entry, err := self.bootClasspath.readClass(className); err == nil { //å…ˆæ‰«æBootå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶\n\t   return data, entry, err //å­˜åœ¨åˆ™è¿”å›\n\t}\n\tif data, entry, err := self.extClasspath.readClass(className); err == nil { //å†æ‰«æExtå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶\n\t   return data, entry, err //å­˜åœ¨åˆ™è¿”å›\n\t}\n\treturn self.userClasspath.readClass(className) //ä»¥ä¸Šä¸¤ä¸ªè·¯å¾„ä¸‹éƒ½ä¸å­˜åœ¨ï¼Œåˆ™æ‰«æUserå¯åŠ¨è·¯å¾„\n}\n\nfunc (self *Classpath) String() string  {\n\treturn self.userClasspath.String()\n}\n\nfunc (self *Classpath) parseBootAndExtClasspath(jreOption string) { //æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„\n\tjreDir := getJreDir(jreOption) //è·å–jreè·¯å¾„\n   // jre/lib/*\n   jreLibPath := filepath.Join(jreDir, \"lib\", \"*\")\n   self.bootClasspath = newWildcardEntry(jreLibPath)\n   // jre/lib/ext/*\n   jreExtPath := filepath.Join(jreDir, \"lib\", \"ext\", \"*\")\n   self.extClasspath = newWildcardEntry(jreExtPath)\n}\n\nfunc getJreDir(jreOption string) string {\n\tif jreOption != \"\" && exists(jreOption) { //jreOptionä¸ä¸ºç©ºä¸”å­˜åœ¨æ—¶è¿”å›è¯¥è·¯å¾„\n\t   return jreOption\n\t}\n\tif exists(\"./jre\") { //./jreè·¯å¾„å­˜åœ¨æ—¶ï¼Œè¿”å›.jre\n\t   return \"./jre\"\n\t}\n\tif jh := os.Getenv(\"JAVA_HOME\"); jh != \"\" { //ç¯å¢ƒå˜é‡JAVA_HOMEå­˜åœ¨å¹¶ä¸”ä¸ä¸ºç©ºæ—¶\n\t   return filepath.Join(jh, \"jre\") //è¿”å›JAVA_HOME + \"jre\"\n\t}\n\tpanic(\"Can not find jre folder!\")\n }\n\n func exists(path string) bool {\n\tif _, err := os.Stat(path); err != nil {\n\t   if os.IsNotExist(err) {\n\t\t  return false\n\t   }\n\t}\n\treturn true\n }\n\n func (self *Classpath) parseUserClasspath(cpOption string) { //æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨å‚æ•°\n\tif cpOption == \"\" { //cpOptionä¸ºç©ºæ—¶\n\t   cpOption = \".\" //è¿”å›ç›¸å¯¹è·¯åŠ²\n\t}\n\tself.userClasspath = newEntry(cpOption) //æ ¹æ®-cp|classpathå‚æ•°å®ä¾‹åŒ–å¯¹åº”çš„Entry\n }\n{% endcodeblock %}\n\n * mainï¼Œä¿®æ”¹å¯åŠ¨ç±»\n{% codeblock lang:golang %}\nfunc startJVM(cmd *Cmd){\n\tcp := classpath.Parse(cmd.XjreOption, cmd.cpOption) //æ ¹æ®-Xjreå’Œ-cp|classpathå‚æ•°å®ä¾‹åŒ–classpathå¯¹è±¡å®ä¾‹\n\tfmt.Printf(\"classpath:%v class:%v args:%v\\n\",\n\t   cp, cmd.class, cmd.args)\n\tclassName := strings.Replace(cmd.class, \".\", \"/\", -1)\n\tclassData, _, err := cp.ReadClass(className) //æŒ‰ç…§3ä¸ªå¯åŠ¨è·¯å¾„æŸ¥æ‰¾å¹¶è¯»å–classNameæ–‡ä»¶\n\tif err != nil {\n\t   fmt.Printf(\"Could not find or load main class %s\\n\", cmd.class)\n\t   return\n\t}\n\tfmt.Printf(\"class data:%v\\n\", classData)\n}\n{% endcodeblock %}\n\n3. è¯•è¿è¡Œ\n{% codeblock lang:shell %}\nPS D:\\work\\workspace_go\\src\\jvmgo\\ch02> go install\n\nPS D:\\work\\workspace_go\\bin> .\\ch02.exe -Xjre \"C:\\Program Files\\Java\\jre1.8.0_202\" java.lang.Object\nclasspath:D:\\work\\workspace_go\\bin class:java.lang.Object args:[]\nclass data:[202 254 186 190 0 0 0 52 0 75 3 0 15 66 63 8 0 16 8 0 36 8 0 40 1 0 3 40 41 73 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 3 40 41 86 1 0 21 40 73 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 4 40 74 41 86 1 0 5 40 74 73 41 86 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 41 90 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 86 1 0 8 60 99 108 105 110 105 116 62 1 0 6 60 105 110 105 116 62 1 0 1 64 1 0 4 67 111 100\n101 1 0 10 69 120 99 101 112 116 105 111 110 115 1 0 9 83 105 103 110 97 116 117 114 101 1 0 13 83 116 97 99 107 77 97 112 84 97 98 108 101 1 0 6 97 112 112 101 110 100 1 0 5 99 108 111 110 101 1 0 6 101 113\n117 97 108 115 1 0 8 102 105 110 97 108 105 122 101 1 0 8 103 101 116 67 108 97 115 115 1 0 7 103 101 116 78 97 109 101 1 0 8 104 97 115 104 67 111 100 101 1 0 15 106 97 118 97 47 108 97 110 103 47 67 108 97\n115 115 1 0 36 106 97 118 97 47 108 97 110 103 47 67 108 111 110 101 78 111 116 83 117 112 112 111 114 116 101 100 69 120 99 101 112 116 105 111 110 1 0 34 106 97 118 97 47 108 97 110 103 47 73 108 108 101 103 97 108 65 114 103 117 109 101 110 116 69 120 99 101 112 116 105 111 110 1 0 17 106 97 118 97 47 108 97 110 103 47 73 110 116 101 103 101 114 1 0 30 106 97 118 97 47 108 97 110 103 47 73 110 116 101 114 114\n117 112 116 101 100 69 120 99 101 112 116 105 111 110 1 0 16 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 1 0 23 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 1 0 19 106 97 118 97 47 108 97 110 103 47 84 104 114 111 119 97 98 108 101 1 0 37 110 97 110 111 115 101 99 111 110 100 32 116 105 109 101 111 117 116 32 118 97 108 117 101 32 111 117 116 32 111 102 32 114 97 110 103 101 1 0 6 110 111 116 105 102 121 1 0 9 110 111 116 105 102 121 65 108 108 1 0 15 114 101 103 105 115 116 101 114 78 97 116 105 118 101 115 1 0 25 116 105 109 101 111 117 116 32 118 97 108 117 101 32 105 115 32 110 101 103 97 116 105 118 101 1 0 11 116 111 72 101 120 83 116 114 105 110 103 1 0 8 116 111 83 116 114 105 110 103 1 0 4 119 97 105 116 7 0 28 7 0 29 7 0 30 7 0 31 7 0 32 7 0 33 7 0 34 7 0 35 1 0 19 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 59 1 0 22 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 60 42 62 59 1 0 45 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 59 12 0 27 0 5 12 0 15 0 8 12 0 39 0 8 12 0 43 0 10 12 0 25 0 52 12 0 26 0 7 12 0 42 0 7 12 0 41 0\n9 12 0 15 0 13 12 0 21 0 54 10 0 44 0 60 10 0 46 0 63 10 0 47 0 62 10 0 49 0 55 10 0 49 0 57 10 0 49 0 58 10 0 49 0 59 10 0 50 0 56 10 0 50 0 61 10 0 50 0 64 0 33 0 49 0 0 0 0 0 0 0 14 0 1 0 15 0 8 0 1 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 1 10 0 39 0 8 0 0 1 17 0 25 0 52 0 1 0 19 0 0 0 2 0 53 1 1 0 27 0 5 0 0 0 1 0 23 0 12 0 1 0 17 0 0 0 34 0 2 0 2 0 0 0 11 42 43 166 0 7 4 167 0 4 3 172 0 0 0 1 0 20 0 0 0 5\n0 2 9 64 1 1 4 0 22 0 6 0 1 0 18 0 0 0 4 0 1 0 45 0 1 0 42 0 7 0 1 0 17 0 0 0 48 0 2 0 1 0 0 0 36 187 0 50 89 183 0 72 42 182 0 71 182 0 65 182 0 74 18 2 182 0 74 42 182 0 68 184 0 67 182 0 74 182 0 73 176 0\n0 0 0 1 17 0 37 0 8 0 0 1 17 0 38 0 8 0 0 1 17 0 43 0 10 0 1 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 11 0 2 0 17 0 0 0 74 0 4 0 4 0 0 0 50 31 9 148 156 0 13 187 0 46 89 18 4 183 0 66 191 29 155 0 9 29 18 1 164 0 13 187 0 46 89 18 3 183 0 66 191 29 158 0 7 31 10 97 64 42 31 182 0 70 177 0 0 0 1 0 20 0 0 0 6 0 4 16 9 9 7 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 8 0 2 0 17 0 0 0 18 0 3 0 1 0 0 0 6 42 9 182 0 70 177 0 0 0 0 0 18\n0 0 0 4 0 1 0 48 0 4 0 24 0 8 0 2 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 0 18 0 0 0 4 0 1 0 51 0 8 0 14 0 8 0 1 0 17 0 0 0 16 0 0 0 0 0 0 0 4 184 0 69 177 0 0 0 0 0 0]\n{% endcodeblock %}\n","source":"_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°2.md","raw":"---\ntitle: è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°2\ndate: 2019-09-10 21:47:52\ntags: \n    - JVM\n    - Java\n    - Go\ncategories :\n    - Technology\n---\n\n## å®ç°cp/classpath å‚æ•°æœç´¢classæ–‡ä»¶\n\n### java class path æœç´¢é¡ºåºï¼š\n1. å¯åŠ¨ç±»è·¯å¾„ï¼ˆbootstrap classpathï¼‰:jre\\lib ï¼ˆå¯é€šè¿‡-Xbootclasspathå‚æ•°ä¿®æ”¹è¯¥è·¯å¾„ï¼‰\n2. æ‰©å±•ç±»è·¯å¾„ï¼ˆextension classpathï¼‰:jre\\lib\\ext\n3. ç”¨æˆ·ç±»è·¯å¾„ï¼ˆuser classpathï¼‰:ç”¨æˆ·è‡ªå·±æŒ‡å®š\n\n<!-- more -->\n\n### å®ç°\n1. Entryæ¥å£ç”¨æ¥å®šä¹‰å¯åŠ¨ç±»çš„åŸºæœ¬åŠŸèƒ½\n\n{% codeblock lang:go %}\nconst pathListSeparator = string(os.PathListSeparator) //è·å–å½“å‰æ“ä½œç³»ç»Ÿåˆ†éš”ç¬¦\n\ntype Entry interface {\n\treadClass(classNme string) ([]byte,Entry,error) //å®šä¹‰æŒ‰classåè¯»å–classæ–‡ä»¶çš„æ–¹\n\tString() string \n}\n\n//æ ¹æ®classpathç”Ÿæˆå¯¹åº”çš„å¯åŠ¨ç±»\nfunc newEntry(path string) Entry {\n\tif strings.Contains(path,pathListSeparator){ //classpathè·¯å¾„åŒ…å«ç³»ç»Ÿåˆ†å‰²ç¬¦æ—¶ï¼Œnewç»„åˆå¯åŠ¨ç±»\n\t\treturn newCompositeEntry(path)\n\t}\n\n\tif strings.HasSuffix(path,\"*\") {\n\t\treturn newWildcardEntry(path) //classpathè·¯å¾„åŒ…å«*æ—¶ï¼Œnewé€šé…ç¬¦å¯åŠ¨ç±»\n\t}\n\n\tif strings.HasSuffix(path, \".jar\") || strings.HasSuffix(path, \".JAR\") ||\n      strings.HasSuffix(path, \".zip\") || strings.HasSuffix(path, \".ZIP\") {\n      return newZipEntry(path) //classpathè·¯å¾„åŒ…å«jarã€JARã€zipã€ZIPæ—¶ï¼Œnewæ–‡ä»¶å¤¹å¯åŠ¨ç±»\n   }\n\treturn newDirEntry(path)\n\n}\n{% endcodeblock %}\n\n2. Entryæ¥å£çš„å…·ä½“å®ç°\n * DirEntryï¼ŒæŒ‰ç…§æ–‡ä»¶è·¯å¾„è¯»å–æ–‡ä»¶äºŒè¿›åˆ¶æµ \n{% codeblock lang:golang %}\ntype DirEntry struct {\n\tabsDir string //å­˜å‚¨æ–‡ä»¶å¤¹è·¯å¾„\n}\n\nfunc newDirEntry(path string) *DirEntry {\n\tabsDir,err := filepath.Abs(path) //å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„\n\tif err != nil {\n\t\tpanic(err) //æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨æ—¶æç¤ºé”™è¯¯\n\t}\n\n\treturn &DirEntry{absDir} //è¿”å›DirEntryå®ä¾‹\n}\n\nfunc (self *DirEntry) readClass(className string) ([]byte,Entry,error){\n\tfileName := filepath.Join(self.absDir,className) //æ‹¼æ¥æ–‡ä»¶å¤¹è·¯å¾„å’Œclassname\n\tdata,err := ioutil.ReadFile(fileName) //è¯»å–æ–‡ä»¶\n\treturn data,self,err //è¿”å›æ–‡ä»¶å†…å®¹\n}\n\nfunc(self *DirEntry) String() string {\n\treturn self.absDir //è¿”å›æ–‡ä»¶å¤¹è·¯å¾„\n}\n{% endcodeblock %}\n\n * ZipEntry,è¯»å–å‹ç¼©æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶\n{% codeblock lang:golang %}\ntype ZipEnty struct {\n\tabsPath string //æ–‡ä»¶å¤¹è·¯å¾„\n}\n\nfunc newZipEntry(path string) *ZipEnty {\n\tabsPath, err := filepath.Abs(path) //å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\treturn &ZipEnty{absPath}\n}\n\nfunc (self *ZipEnty) readClass(className string) ([]byte,Entry,error){\n\tr, err := zip.OpenReader(self.absPath) //ä»¥å‹ç¼©æ–‡ä»¶æ ¼å¼è§£å‹\n\tif err != nil {\n\t   return nil, nil, err\n\t}\n\tdefer r.Close() //æœ€åå…³é—­æ–‡ä»¶æµ\n\tfor _, f := range r.File { //å¾ªç¯è§£å‹å‡ºæ¥çš„æ–‡ä»¶\n\t   if f.Name == className { //å¦‚æœå½“å‰æ–‡ä»¶ä¸ºæŒ‡å®šæ–‡ä»¶\n\t\t  rc, err := f.Open() //æ‰“å¼€è¯¥æ–‡ä»¶\n\t\t  if err != nil {\n\t\t\t return nil, nil, err\n\t\t  }\n\t\t  defer rc.Close() //æœ€åå…³é—­æ–‡ä»¶\n\t\t  data, err := ioutil.ReadAll(rc) //è¯»å–æ–‡ä»¶æµ\n\t\t  if err != nil {\n\t\t\t return nil, nil, err\n\t\t  }\n\t\t  return data, self, nil //è¿”å›æ–‡ä»¶æµ\n\t   }\n\t}\n\treturn nil, nil, errors.New(\"class not found: \" + className)\n}\n\nfunc (self *ZipEnty) String() string {\n\treturn self.absPath\n}\n{% endcodeblock %}\n\n * CompositeEntry,è¯»å–ç¬¦åˆæ–‡ä»¶ç±»å‹\n{% codeblock lang:golang %}\ntype CompositeEntry []Entry //CompositeEntryä¸ºå¤šç§Entryçš„æ•°ç»„ï¼ˆDirã€Zipï¼‰\n\nfunc newCompositeEntry(pathList string) CompositeEntry {\n\tcompositeEntry := []Entry{} //å®ä¾‹Entryæ¥å£æ•°ç»„\n\n\tfor _,path := range strings.Split(pathList,pathListSeparator){ //æŒ‰ç…§ç³»ç»Ÿåˆ†å‰²ç¬¦æˆªå–pathåˆ—è¡¨ï¼Œå¹¶å¾ªç¯\n\t\tentry := newEntry(path) //æŒ‰ç…§æ¯ç§pathå®ä¾‹åŒ–ä¸åŒçš„Entry(Dirã€Zipã€Wildcard)\n\t\tcompositeEntry = append(compositeEntry,entry) //å°†å®ä¾‹åŒ–çš„ä¸åŒEntryæ”¾å…¥CompositeEntryæ•°ç»„ä¸­\n\t}\n\treturn compositeEntry\n}\n\nfunc (self CompositeEntry) readClass(className string)([]byte,Entry,error){\n\tfor _, entry := range self { //å¾ªç¯compositeEntryæ•°ç»„\n\t\tdata, from, err := entry.readClass(className) //æ ¹æ®ä¸åŒEntry(Dirã€Zipã€Wildcard)ï¼ŒæŒ‰æŒ‡å®šclassnameè¯»å–æ–‡ä»¶\n\t\tif err == nil {\n\t\t   return data, from, nil //è¿”å›è¯»å–ç»“æœ\n\t\t}\n\t }\n\t return nil, nil, errors.New(\"class not found: \" + className) //æ— ç»“æœæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯\n}\n\nfunc (self CompositeEntry) String() string {\n\tstrs := make([]string, len(self)) //æŒ‰ç…§CompositeEntryçš„é•¿åº¦ç”³æ˜è¯¥é•¿åº¦çš„Sringæ•°ç»„\n\tfor i, entry := range self { //å¾ªç¯CompositeEntry\n\t   strs[i] = entry.String() //è°ƒç”¨æ¯ä¸ªEntry(Dirã€Zipã€Wildcard)å®ç°ç±»çš„String()æ–¹æ³•,å¹¶æ”¾å…¥Stringæ•°ç»„ä¸­\n\t}\n\treturn strings.Join(strs, pathListSeparator) //å°†Stringæ•°ç»„ä¸­çš„ç»“æœä»¥ç³»ç»Ÿåˆ†éš”ç¬¦æ‹¼æ¥å¹¶è¿”å›\n}\n{% endcodeblock %}\n\n * WildcardEntryï¼ŒæŒ‰ç…§é€šé…ç¬¦è§£ææ–‡ä»¶\n{% codeblock lang:golang %}\nfunc newWildcardEntry(path string) CompositeEntry {\n\tbaseDir := path[:len(path)-1] // remove *\n\tcompositeEntry := []Entry{} //ç”³æ˜compositeEntryå¯¹è±¡(Entryçš„æ•°ç»„)\n\twalkFn := func(path string, info os.FileInfo, err error) error {\n\t\tif err != nil {\n\t\t   return err\n\t\t}\n\t\tif info.IsDir() && path != baseDir { //å¦‚æœå½“å‰ç›®å½•æ˜¯æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ˜¯æ ¹ç›®å½•\n\t\t   return filepath.SkipDir //è¿”å›SkipDirçš„é”™è¯¯\n\t\t}\n\t\tif strings.HasSuffix(path, \".jar\") || strings.HasSuffix(path, \".JAR\") { //å¦‚æœå½“å‰è·¯å¾„æ˜¯ä»¥.jaræˆ–.JARç»“å°¾çš„\n\t\t\tjarEntry := newZipEntry(path) //å®ä¾‹åŒ–ZipEntry\n\t\t\tcompositeEntry = append(compositeEntry, jarEntry) //å°†å®ä¾‹åŒ–çš„ZipEntryå¯¹è±¡æ”¾å…¥compositeEntryæ•°ç»„ä¸­\n\t\t }\n\t\t return nil\n\t  }\n\tfilepath.Walk(baseDir, walkFn) //å°†walkFnæ–¹æ³•ä¼ é€’ç»™filepath.Walk\n\treturn compositeEntry //è¿”å›ç»“æœ\n }\n{% endcodeblock %}\n\n* Classpathï¼Œ-cp|classpathå‚æ•°è§£æå®ç°çš„å…¥å£æ–¹æ³•\n{% codeblock lang:golang %}\ntype Classpath struct { //ClasspathåŒ…å«javaçš„ä¸‰ç§åŸºç¡€å¯åŠ¨è·¯å¾„\n\tbootClasspath Entry \n\textClasspath Entry\n\tuserClasspath Entry\n}\n\nfunc Parse(jreOption, cpOption string) * Classpath  {\n\tcp := &Classpath{} //å®ä¾‹åŒ–Classpathå¯¹è±¡\n\tcp.parseBootAndExtClasspath(jreOption) //æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„\n\tcp.parseUserClasspath(cpOption) //æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨è·¯å¾„\n\treturn cp //è¿”å›è®¾ç½®å¥½å¯åŠ¨è·¯å¾„çš„Classpathå¯¹è±¡\n}\n\nfunc (self *Classpath) ReadClass(className string) ([]byte,Entry,error){\n\tclassName = className + \".class\" //åˆå§‹åŒ–classNameæ–‡ä»¶å\n\tif data, entry, err := self.bootClasspath.readClass(className); err == nil { //å…ˆæ‰«æBootå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶\n\t   return data, entry, err //å­˜åœ¨åˆ™è¿”å›\n\t}\n\tif data, entry, err := self.extClasspath.readClass(className); err == nil { //å†æ‰«æExtå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶\n\t   return data, entry, err //å­˜åœ¨åˆ™è¿”å›\n\t}\n\treturn self.userClasspath.readClass(className) //ä»¥ä¸Šä¸¤ä¸ªè·¯å¾„ä¸‹éƒ½ä¸å­˜åœ¨ï¼Œåˆ™æ‰«æUserå¯åŠ¨è·¯å¾„\n}\n\nfunc (self *Classpath) String() string  {\n\treturn self.userClasspath.String()\n}\n\nfunc (self *Classpath) parseBootAndExtClasspath(jreOption string) { //æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„\n\tjreDir := getJreDir(jreOption) //è·å–jreè·¯å¾„\n   // jre/lib/*\n   jreLibPath := filepath.Join(jreDir, \"lib\", \"*\")\n   self.bootClasspath = newWildcardEntry(jreLibPath)\n   // jre/lib/ext/*\n   jreExtPath := filepath.Join(jreDir, \"lib\", \"ext\", \"*\")\n   self.extClasspath = newWildcardEntry(jreExtPath)\n}\n\nfunc getJreDir(jreOption string) string {\n\tif jreOption != \"\" && exists(jreOption) { //jreOptionä¸ä¸ºç©ºä¸”å­˜åœ¨æ—¶è¿”å›è¯¥è·¯å¾„\n\t   return jreOption\n\t}\n\tif exists(\"./jre\") { //./jreè·¯å¾„å­˜åœ¨æ—¶ï¼Œè¿”å›.jre\n\t   return \"./jre\"\n\t}\n\tif jh := os.Getenv(\"JAVA_HOME\"); jh != \"\" { //ç¯å¢ƒå˜é‡JAVA_HOMEå­˜åœ¨å¹¶ä¸”ä¸ä¸ºç©ºæ—¶\n\t   return filepath.Join(jh, \"jre\") //è¿”å›JAVA_HOME + \"jre\"\n\t}\n\tpanic(\"Can not find jre folder!\")\n }\n\n func exists(path string) bool {\n\tif _, err := os.Stat(path); err != nil {\n\t   if os.IsNotExist(err) {\n\t\t  return false\n\t   }\n\t}\n\treturn true\n }\n\n func (self *Classpath) parseUserClasspath(cpOption string) { //æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨å‚æ•°\n\tif cpOption == \"\" { //cpOptionä¸ºç©ºæ—¶\n\t   cpOption = \".\" //è¿”å›ç›¸å¯¹è·¯åŠ²\n\t}\n\tself.userClasspath = newEntry(cpOption) //æ ¹æ®-cp|classpathå‚æ•°å®ä¾‹åŒ–å¯¹åº”çš„Entry\n }\n{% endcodeblock %}\n\n * mainï¼Œä¿®æ”¹å¯åŠ¨ç±»\n{% codeblock lang:golang %}\nfunc startJVM(cmd *Cmd){\n\tcp := classpath.Parse(cmd.XjreOption, cmd.cpOption) //æ ¹æ®-Xjreå’Œ-cp|classpathå‚æ•°å®ä¾‹åŒ–classpathå¯¹è±¡å®ä¾‹\n\tfmt.Printf(\"classpath:%v class:%v args:%v\\n\",\n\t   cp, cmd.class, cmd.args)\n\tclassName := strings.Replace(cmd.class, \".\", \"/\", -1)\n\tclassData, _, err := cp.ReadClass(className) //æŒ‰ç…§3ä¸ªå¯åŠ¨è·¯å¾„æŸ¥æ‰¾å¹¶è¯»å–classNameæ–‡ä»¶\n\tif err != nil {\n\t   fmt.Printf(\"Could not find or load main class %s\\n\", cmd.class)\n\t   return\n\t}\n\tfmt.Printf(\"class data:%v\\n\", classData)\n}\n{% endcodeblock %}\n\n3. è¯•è¿è¡Œ\n{% codeblock lang:shell %}\nPS D:\\work\\workspace_go\\src\\jvmgo\\ch02> go install\n\nPS D:\\work\\workspace_go\\bin> .\\ch02.exe -Xjre \"C:\\Program Files\\Java\\jre1.8.0_202\" java.lang.Object\nclasspath:D:\\work\\workspace_go\\bin class:java.lang.Object args:[]\nclass data:[202 254 186 190 0 0 0 52 0 75 3 0 15 66 63 8 0 16 8 0 36 8 0 40 1 0 3 40 41 73 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 3 40 41 86 1 0 21 40 73 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 4 40 74 41 86 1 0 5 40 74 73 41 86 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 41 90 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 86 1 0 8 60 99 108 105 110 105 116 62 1 0 6 60 105 110 105 116 62 1 0 1 64 1 0 4 67 111 100\n101 1 0 10 69 120 99 101 112 116 105 111 110 115 1 0 9 83 105 103 110 97 116 117 114 101 1 0 13 83 116 97 99 107 77 97 112 84 97 98 108 101 1 0 6 97 112 112 101 110 100 1 0 5 99 108 111 110 101 1 0 6 101 113\n117 97 108 115 1 0 8 102 105 110 97 108 105 122 101 1 0 8 103 101 116 67 108 97 115 115 1 0 7 103 101 116 78 97 109 101 1 0 8 104 97 115 104 67 111 100 101 1 0 15 106 97 118 97 47 108 97 110 103 47 67 108 97\n115 115 1 0 36 106 97 118 97 47 108 97 110 103 47 67 108 111 110 101 78 111 116 83 117 112 112 111 114 116 101 100 69 120 99 101 112 116 105 111 110 1 0 34 106 97 118 97 47 108 97 110 103 47 73 108 108 101 103 97 108 65 114 103 117 109 101 110 116 69 120 99 101 112 116 105 111 110 1 0 17 106 97 118 97 47 108 97 110 103 47 73 110 116 101 103 101 114 1 0 30 106 97 118 97 47 108 97 110 103 47 73 110 116 101 114 114\n117 112 116 101 100 69 120 99 101 112 116 105 111 110 1 0 16 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 1 0 23 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 1 0 19 106 97 118 97 47 108 97 110 103 47 84 104 114 111 119 97 98 108 101 1 0 37 110 97 110 111 115 101 99 111 110 100 32 116 105 109 101 111 117 116 32 118 97 108 117 101 32 111 117 116 32 111 102 32 114 97 110 103 101 1 0 6 110 111 116 105 102 121 1 0 9 110 111 116 105 102 121 65 108 108 1 0 15 114 101 103 105 115 116 101 114 78 97 116 105 118 101 115 1 0 25 116 105 109 101 111 117 116 32 118 97 108 117 101 32 105 115 32 110 101 103 97 116 105 118 101 1 0 11 116 111 72 101 120 83 116 114 105 110 103 1 0 8 116 111 83 116 114 105 110 103 1 0 4 119 97 105 116 7 0 28 7 0 29 7 0 30 7 0 31 7 0 32 7 0 33 7 0 34 7 0 35 1 0 19 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 59 1 0 22 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 60 42 62 59 1 0 45 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 59 12 0 27 0 5 12 0 15 0 8 12 0 39 0 8 12 0 43 0 10 12 0 25 0 52 12 0 26 0 7 12 0 42 0 7 12 0 41 0\n9 12 0 15 0 13 12 0 21 0 54 10 0 44 0 60 10 0 46 0 63 10 0 47 0 62 10 0 49 0 55 10 0 49 0 57 10 0 49 0 58 10 0 49 0 59 10 0 50 0 56 10 0 50 0 61 10 0 50 0 64 0 33 0 49 0 0 0 0 0 0 0 14 0 1 0 15 0 8 0 1 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 1 10 0 39 0 8 0 0 1 17 0 25 0 52 0 1 0 19 0 0 0 2 0 53 1 1 0 27 0 5 0 0 0 1 0 23 0 12 0 1 0 17 0 0 0 34 0 2 0 2 0 0 0 11 42 43 166 0 7 4 167 0 4 3 172 0 0 0 1 0 20 0 0 0 5\n0 2 9 64 1 1 4 0 22 0 6 0 1 0 18 0 0 0 4 0 1 0 45 0 1 0 42 0 7 0 1 0 17 0 0 0 48 0 2 0 1 0 0 0 36 187 0 50 89 183 0 72 42 182 0 71 182 0 65 182 0 74 18 2 182 0 74 42 182 0 68 184 0 67 182 0 74 182 0 73 176 0\n0 0 0 1 17 0 37 0 8 0 0 1 17 0 38 0 8 0 0 1 17 0 43 0 10 0 1 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 11 0 2 0 17 0 0 0 74 0 4 0 4 0 0 0 50 31 9 148 156 0 13 187 0 46 89 18 4 183 0 66 191 29 155 0 9 29 18 1 164 0 13 187 0 46 89 18 3 183 0 66 191 29 158 0 7 31 10 97 64 42 31 182 0 70 177 0 0 0 1 0 20 0 0 0 6 0 4 16 9 9 7 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 8 0 2 0 17 0 0 0 18 0 3 0 1 0 0 0 6 42 9 182 0 70 177 0 0 0 0 0 18\n0 0 0 4 0 1 0 48 0 4 0 24 0 8 0 2 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 0 18 0 0 0 4 0 1 0 51 0 8 0 14 0 8 0 1 0 17 0 0 0 16 0 0 0 0 0 0 0 4 184 0 69 177 0 0 0 0 0 0]\n{% endcodeblock %}\n","slug":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°2","published":1,"updated":"2020-12-14T09:51:24.055Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htt001rv2527zex6mbp","content":"<html><head></head><body><h2 id=\"&#x5B9E;&#x73B0;cp-classpath-&#x53C2;&#x6570;&#x641C;&#x7D22;class&#x6587;&#x4EF6;\"><a href=\"#&#x5B9E;&#x73B0;cp-classpath-&#x53C2;&#x6570;&#x641C;&#x7D22;class&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;cp/classpath &#x53C2;&#x6570;&#x641C;&#x7D22;class&#x6587;&#x4EF6;\"></a>&#x5B9E;&#x73B0;cp/classpath &#x53C2;&#x6570;&#x641C;&#x7D22;class&#x6587;&#x4EF6;</h2><h3 id=\"java-class-path-&#x641C;&#x7D22;&#x987A;&#x5E8F;&#xFF1A;\"><a href=\"#java-class-path-&#x641C;&#x7D22;&#x987A;&#x5E8F;&#xFF1A;\" class=\"headerlink\" title=\"java class path &#x641C;&#x7D22;&#x987A;&#x5E8F;&#xFF1A;\"></a>java class path &#x641C;&#x7D22;&#x987A;&#x5E8F;&#xFF1A;</h3><ol>\n<li>&#x542F;&#x52A8;&#x7C7B;&#x8DEF;&#x5F84;&#xFF08;bootstrap classpath&#xFF09;:jre\\lib &#xFF08;&#x53EF;&#x901A;&#x8FC7;-Xbootclasspath&#x53C2;&#x6570;&#x4FEE;&#x6539;&#x8BE5;&#x8DEF;&#x5F84;&#xFF09;</li>\n<li>&#x6269;&#x5C55;&#x7C7B;&#x8DEF;&#x5F84;&#xFF08;extension classpath&#xFF09;:jre\\lib\\ext</li>\n<li>&#x7528;&#x6237;&#x7C7B;&#x8DEF;&#x5F84;&#xFF08;user classpath&#xFF09;:&#x7528;&#x6237;&#x81EA;&#x5DF1;&#x6307;&#x5B9A;</li>\n</ol>\n<a id=\"more\"></a>\n\n<h3 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h3><ol>\n<li>Entry&#x63A5;&#x53E3;&#x7528;&#x6765;&#x5B9A;&#x4E49;&#x542F;&#x52A8;&#x7C7B;&#x7684;&#x57FA;&#x672C;&#x529F;&#x80FD;</li>\n</ol>\n<figure class=\"highlight go hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">const</span> pathListSeparator = <span class=\"hljs-keyword\">string</span>(os.PathListSeparator) <span class=\"hljs-comment\">//&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5206;&#x9694;&#x7B26;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">type</span> Entry <span class=\"hljs-keyword\">interface</span> {</span><br><span class=\"line\">\treadClass(classNme <span class=\"hljs-keyword\">string</span>) ([]<span class=\"hljs-keyword\">byte</span>,Entry,error) <span class=\"hljs-comment\">//&#x5B9A;&#x4E49;&#x6309;class&#x540D;&#x8BFB;&#x53D6;class&#x6587;&#x4EF6;&#x7684;&#x65B9;</span></span><br><span class=\"line\">\tString() <span class=\"hljs-keyword\">string</span> </span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x6839;&#x636E;classpath&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;&#x542F;&#x52A8;&#x7C7B;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newEntry</span><span class=\"hljs-params\">(path <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-title\">Entry</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> strings.Contains(path,pathListSeparator){ <span class=\"hljs-comment\">//classpath&#x8DEF;&#x5F84;&#x5305;&#x542B;&#x7CFB;&#x7EDF;&#x5206;&#x5272;&#x7B26;&#x65F6;&#xFF0C;new&#x7EC4;&#x5408;&#x542F;&#x52A8;&#x7C7B;</span></span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">return</span> newCompositeEntry(path)</span><br><span class=\"line\">\t}</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> strings.HasSuffix(path,<span class=\"hljs-string\">&quot;*&quot;</span>) {</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">return</span> newWildcardEntry(path) <span class=\"hljs-comment\">//classpath&#x8DEF;&#x5F84;&#x5305;&#x542B;*&#x65F6;&#xFF0C;new&#x901A;&#x914D;&#x7B26;&#x542F;&#x52A8;&#x7C7B;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> strings.HasSuffix(path, <span class=\"hljs-string\">&quot;.jar&quot;</span>) || strings.HasSuffix(path, <span class=\"hljs-string\">&quot;.JAR&quot;</span>) ||</span><br><span class=\"line\">      strings.HasSuffix(path, <span class=\"hljs-string\">&quot;.zip&quot;</span>) || strings.HasSuffix(path, <span class=\"hljs-string\">&quot;.ZIP&quot;</span>) {</span><br><span class=\"line\">      <span class=\"hljs-keyword\">return</span> newZipEntry(path) <span class=\"hljs-comment\">//classpath&#x8DEF;&#x5F84;&#x5305;&#x542B;jar&#x3001;JAR&#x3001;zip&#x3001;ZIP&#x65F6;&#xFF0C;new&#x6587;&#x4EF6;&#x5939;&#x542F;&#x52A8;&#x7C7B;</span></span><br><span class=\"line\">   }</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> newDirEntry(path)</span><br><span class=\"line\"></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<ol start=\"2\">\n<li>Entry&#x63A5;&#x53E3;&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;</li>\n</ol>\n<ul>\n<li><p>DirEntry&#xFF0C;&#x6309;&#x7167;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x4E8C;&#x8FDB;&#x5236;&#x6D41; </p>\n<figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> DirEntry <span class=\"hljs-keyword\">struct</span> {</span><br><span class=\"line\">\tabsDir <span class=\"hljs-keyword\">string</span> <span class=\"hljs-comment\">//&#x5B58;&#x50A8;&#x6587;&#x4EF6;&#x5939;&#x8DEF;&#x5F84;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newDirEntry</span><span class=\"hljs-params\">(path <span class=\"hljs-keyword\">string</span>)</span> *<span class=\"hljs-title\">DirEntry</span></span> {</span><br><span class=\"line\">\tabsDir,err := filepath.Abs(path) <span class=\"hljs-comment\">//&#x5982;&#x679C;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x5B58;&#x5728;&#xFF0C;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x5939;&#x8DEF;&#x5F84;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> {</span><br><span class=\"line\">\t\t<span class=\"hljs-built_in\">panic</span>(err) <span class=\"hljs-comment\">//&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x4E0D;&#x5B58;&#x5728;&#x65F6;&#x63D0;&#x793A;&#x9519;&#x8BEF;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> &amp;DirEntry{absDir} <span class=\"hljs-comment\">//&#x8FD4;&#x56DE;DirEntry&#x5B9E;&#x4F8B;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *DirEntry)</span> <span class=\"hljs-title\">readClass</span><span class=\"hljs-params\">(className <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-params\">([]<span class=\"hljs-keyword\">byte</span>,Entry,error)</span></span>{</span><br><span class=\"line\">\tfileName := filepath.Join(self.absDir,className) <span class=\"hljs-comment\">//&#x62FC;&#x63A5;&#x6587;&#x4EF6;&#x5939;&#x8DEF;&#x5F84;&#x548C;classname</span></span><br><span class=\"line\">\tdata,err := ioutil.ReadFile(fileName) <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;&#x6587;&#x4EF6;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> data,self,err <span class=\"hljs-comment\">//&#x8FD4;&#x56DE;&#x6587;&#x4EF6;&#x5185;&#x5BB9;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span><span class=\"hljs-params\">(self *DirEntry)</span> <span class=\"hljs-title\">String</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.absDir <span class=\"hljs-comment\">//&#x8FD4;&#x56DE;&#x6587;&#x4EF6;&#x5939;&#x8DEF;&#x5F84;</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li><p>ZipEntry,&#x8BFB;&#x53D6;&#x538B;&#x7F29;&#x6587;&#x4EF6;&#x5939;&#x5185;&#x7684;&#x6587;&#x4EF6;</p>\n<figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> ZipEnty <span class=\"hljs-keyword\">struct</span> {</span><br><span class=\"line\">\tabsPath <span class=\"hljs-keyword\">string</span> <span class=\"hljs-comment\">//&#x6587;&#x4EF6;&#x5939;&#x8DEF;&#x5F84;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newZipEntry</span><span class=\"hljs-params\">(path <span class=\"hljs-keyword\">string</span>)</span> *<span class=\"hljs-title\">ZipEnty</span></span> {</span><br><span class=\"line\">\tabsPath, err := filepath.Abs(path) <span class=\"hljs-comment\">//&#x5982;&#x679C;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x5B58;&#x5728;&#xFF0C;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x5939;&#x8DEF;&#x5F84;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> {</span><br><span class=\"line\">\t\t<span class=\"hljs-built_in\">panic</span>(err)</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> &amp;ZipEnty{absPath}</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ZipEnty)</span> <span class=\"hljs-title\">readClass</span><span class=\"hljs-params\">(className <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-params\">([]<span class=\"hljs-keyword\">byte</span>,Entry,error)</span></span>{</span><br><span class=\"line\">\tr, err := zip.OpenReader(self.absPath) <span class=\"hljs-comment\">//&#x4EE5;&#x538B;&#x7F29;&#x6587;&#x4EF6;&#x683C;&#x5F0F;&#x89E3;&#x538B;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> {</span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span>, <span class=\"hljs-literal\">nil</span>, err</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">defer</span> r.Close() <span class=\"hljs-comment\">//&#x6700;&#x540E;&#x5173;&#x95ED;&#x6587;&#x4EF6;&#x6D41;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> _, f := <span class=\"hljs-keyword\">range</span> r.File { <span class=\"hljs-comment\">//&#x5FAA;&#x73AF;&#x89E3;&#x538B;&#x51FA;&#x6765;&#x7684;&#x6587;&#x4EF6;</span></span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">if</span> f.Name == className { <span class=\"hljs-comment\">//&#x5982;&#x679C;&#x5F53;&#x524D;&#x6587;&#x4EF6;&#x4E3A;&#x6307;&#x5B9A;&#x6587;&#x4EF6;</span></span><br><span class=\"line\">\t\t  rc, err := f.Open() <span class=\"hljs-comment\">//&#x6253;&#x5F00;&#x8BE5;&#x6587;&#x4EF6;</span></span><br><span class=\"line\">\t\t  <span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> {</span><br><span class=\"line\">\t\t\t <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span>, <span class=\"hljs-literal\">nil</span>, err</span><br><span class=\"line\">\t\t  }</span><br><span class=\"line\">\t\t  <span class=\"hljs-keyword\">defer</span> rc.Close() <span class=\"hljs-comment\">//&#x6700;&#x540E;&#x5173;&#x95ED;&#x6587;&#x4EF6;</span></span><br><span class=\"line\">\t\t  data, err := ioutil.ReadAll(rc) <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x6D41;</span></span><br><span class=\"line\">\t\t  <span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> {</span><br><span class=\"line\">\t\t\t <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span>, <span class=\"hljs-literal\">nil</span>, err</span><br><span class=\"line\">\t\t  }</span><br><span class=\"line\">\t\t  <span class=\"hljs-keyword\">return</span> data, self, <span class=\"hljs-literal\">nil</span> <span class=\"hljs-comment\">//&#x8FD4;&#x56DE;&#x6587;&#x4EF6;&#x6D41;</span></span><br><span class=\"line\">\t   }</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span>, <span class=\"hljs-literal\">nil</span>, errors.New(<span class=\"hljs-string\">&quot;class not found: &quot;</span> + className)</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ZipEnty)</span> <span class=\"hljs-title\">String</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.absPath</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li><p>CompositeEntry,&#x8BFB;&#x53D6;&#x7B26;&#x5408;&#x6587;&#x4EF6;&#x7C7B;&#x578B;</p>\n<figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> CompositeEntry []Entry <span class=\"hljs-comment\">//CompositeEntry&#x4E3A;&#x591A;&#x79CD;Entry&#x7684;&#x6570;&#x7EC4;&#xFF08;Dir&#x3001;Zip&#xFF09;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newCompositeEntry</span><span class=\"hljs-params\">(pathList <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-title\">CompositeEntry</span></span> {</span><br><span class=\"line\">\tcompositeEntry := []Entry{} <span class=\"hljs-comment\">//&#x5B9E;&#x4F8B;Entry&#x63A5;&#x53E3;&#x6570;&#x7EC4;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> _,path := <span class=\"hljs-keyword\">range</span> strings.Split(pathList,pathListSeparator){ <span class=\"hljs-comment\">//&#x6309;&#x7167;&#x7CFB;&#x7EDF;&#x5206;&#x5272;&#x7B26;&#x622A;&#x53D6;path&#x5217;&#x8868;&#xFF0C;&#x5E76;&#x5FAA;&#x73AF;</span></span><br><span class=\"line\">\t\tentry := newEntry(path) <span class=\"hljs-comment\">//&#x6309;&#x7167;&#x6BCF;&#x79CD;path&#x5B9E;&#x4F8B;&#x5316;&#x4E0D;&#x540C;&#x7684;Entry(Dir&#x3001;Zip&#x3001;Wildcard)</span></span><br><span class=\"line\">\t\tcompositeEntry = <span class=\"hljs-built_in\">append</span>(compositeEntry,entry) <span class=\"hljs-comment\">//&#x5C06;&#x5B9E;&#x4F8B;&#x5316;&#x7684;&#x4E0D;&#x540C;Entry&#x653E;&#x5165;CompositeEntry&#x6570;&#x7EC4;&#x4E2D;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> compositeEntry</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self CompositeEntry)</span> <span class=\"hljs-title\">readClass</span><span class=\"hljs-params\">(className <span class=\"hljs-keyword\">string</span>)</span><span class=\"hljs-params\">([]<span class=\"hljs-keyword\">byte</span>,Entry,error)</span></span>{</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> _, entry := <span class=\"hljs-keyword\">range</span> self { <span class=\"hljs-comment\">//&#x5FAA;&#x73AF;compositeEntry&#x6570;&#x7EC4;</span></span><br><span class=\"line\">\t\tdata, from, err := entry.readClass(className) <span class=\"hljs-comment\">//&#x6839;&#x636E;&#x4E0D;&#x540C;Entry(Dir&#x3001;Zip&#x3001;Wildcard)&#xFF0C;&#x6309;&#x6307;&#x5B9A;classname&#x8BFB;&#x53D6;&#x6587;&#x4EF6;</span></span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> err == <span class=\"hljs-literal\">nil</span> {</span><br><span class=\"line\">\t\t   <span class=\"hljs-keyword\">return</span> data, from, <span class=\"hljs-literal\">nil</span> <span class=\"hljs-comment\">//&#x8FD4;&#x56DE;&#x8BFB;&#x53D6;&#x7ED3;&#x679C;</span></span><br><span class=\"line\">\t\t}</span><br><span class=\"line\">\t }</span><br><span class=\"line\">\t <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span>, <span class=\"hljs-literal\">nil</span>, errors.New(<span class=\"hljs-string\">&quot;class not found: &quot;</span> + className) <span class=\"hljs-comment\">//&#x65E0;&#x7ED3;&#x679C;&#x662F;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x4FE1;&#x606F;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self CompositeEntry)</span> <span class=\"hljs-title\">String</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> {</span><br><span class=\"line\">\tstrs := <span class=\"hljs-built_in\">make</span>([]<span class=\"hljs-keyword\">string</span>, <span class=\"hljs-built_in\">len</span>(self)) <span class=\"hljs-comment\">//&#x6309;&#x7167;CompositeEntry&#x7684;&#x957F;&#x5EA6;&#x7533;&#x660E;&#x8BE5;&#x957F;&#x5EA6;&#x7684;Sring&#x6570;&#x7EC4;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> i, entry := <span class=\"hljs-keyword\">range</span> self { <span class=\"hljs-comment\">//&#x5FAA;&#x73AF;CompositeEntry</span></span><br><span class=\"line\">\t   strs[i] = entry.String() <span class=\"hljs-comment\">//&#x8C03;&#x7528;&#x6BCF;&#x4E2A;Entry(Dir&#x3001;Zip&#x3001;Wildcard)&#x5B9E;&#x73B0;&#x7C7B;&#x7684;String()&#x65B9;&#x6CD5;,&#x5E76;&#x653E;&#x5165;String&#x6570;&#x7EC4;&#x4E2D;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> strings.Join(strs, pathListSeparator) <span class=\"hljs-comment\">//&#x5C06;String&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x7ED3;&#x679C;&#x4EE5;&#x7CFB;&#x7EDF;&#x5206;&#x9694;&#x7B26;&#x62FC;&#x63A5;&#x5E76;&#x8FD4;&#x56DE;</span></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li><p>WildcardEntry&#xFF0C;&#x6309;&#x7167;&#x901A;&#x914D;&#x7B26;&#x89E3;&#x6790;&#x6587;&#x4EF6;</p>\n<figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newWildcardEntry</span><span class=\"hljs-params\">(path <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-title\">CompositeEntry</span></span> {</span><br><span class=\"line\">\tbaseDir := path[:<span class=\"hljs-built_in\">len</span>(path)<span class=\"hljs-number\">-1</span>] <span class=\"hljs-comment\">// remove *</span></span><br><span class=\"line\">\tcompositeEntry := []Entry{} <span class=\"hljs-comment\">//&#x7533;&#x660E;compositeEntry&#x5BF9;&#x8C61;(Entry&#x7684;&#x6570;&#x7EC4;)</span></span><br><span class=\"line\">\twalkFn := <span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span><span class=\"hljs-params\">(path <span class=\"hljs-keyword\">string</span>, info os.FileInfo, err error)</span> <span class=\"hljs-title\">error</span></span> {</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> {</span><br><span class=\"line\">\t\t   <span class=\"hljs-keyword\">return</span> err</span><br><span class=\"line\">\t\t}</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> info.IsDir() &amp;&amp; path != baseDir { <span class=\"hljs-comment\">//&#x5982;&#x679C;&#x5F53;&#x524D;&#x76EE;&#x5F55;&#x662F;&#x6587;&#x4EF6;&#x5939;&#xFF0C;&#x5E76;&#x4E14;&#x662F;&#x6839;&#x76EE;&#x5F55;</span></span><br><span class=\"line\">\t\t   <span class=\"hljs-keyword\">return</span> filepath.SkipDir <span class=\"hljs-comment\">//&#x8FD4;&#x56DE;SkipDir&#x7684;&#x9519;&#x8BEF;</span></span><br><span class=\"line\">\t\t}</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> strings.HasSuffix(path, <span class=\"hljs-string\">&quot;.jar&quot;</span>) || strings.HasSuffix(path, <span class=\"hljs-string\">&quot;.JAR&quot;</span>) { <span class=\"hljs-comment\">//&#x5982;&#x679C;&#x5F53;&#x524D;&#x8DEF;&#x5F84;&#x662F;&#x4EE5;.jar&#x6216;.JAR&#x7ED3;&#x5C3E;&#x7684;</span></span><br><span class=\"line\">\t\t\tjarEntry := newZipEntry(path) <span class=\"hljs-comment\">//&#x5B9E;&#x4F8B;&#x5316;ZipEntry</span></span><br><span class=\"line\">\t\t\tcompositeEntry = <span class=\"hljs-built_in\">append</span>(compositeEntry, jarEntry) <span class=\"hljs-comment\">//&#x5C06;&#x5B9E;&#x4F8B;&#x5316;&#x7684;ZipEntry&#x5BF9;&#x8C61;&#x653E;&#x5165;compositeEntry&#x6570;&#x7EC4;&#x4E2D;</span></span><br><span class=\"line\">\t\t }</span><br><span class=\"line\">\t\t <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span></span><br><span class=\"line\">\t  }</span><br><span class=\"line\">\tfilepath.Walk(baseDir, walkFn) <span class=\"hljs-comment\">//&#x5C06;walkFn&#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x7ED9;filepath.Walk</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> compositeEntry <span class=\"hljs-comment\">//&#x8FD4;&#x56DE;&#x7ED3;&#x679C;</span></span><br><span class=\"line\"> }</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li><p>Classpath&#xFF0C;-cp|classpath&#x53C2;&#x6570;&#x89E3;&#x6790;&#x5B9E;&#x73B0;&#x7684;&#x5165;&#x53E3;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> Classpath <span class=\"hljs-keyword\">struct</span> { <span class=\"hljs-comment\">//Classpath&#x5305;&#x542B;java&#x7684;&#x4E09;&#x79CD;&#x57FA;&#x7840;&#x542F;&#x52A8;&#x8DEF;&#x5F84;</span></span><br><span class=\"line\">\tbootClasspath Entry </span><br><span class=\"line\">\textClasspath Entry</span><br><span class=\"line\">\tuserClasspath Entry</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">Parse</span><span class=\"hljs-params\">(jreOption, cpOption <span class=\"hljs-keyword\">string</span>)</span> * <span class=\"hljs-title\">Classpath</span></span>  {</span><br><span class=\"line\">\tcp := &amp;Classpath{} <span class=\"hljs-comment\">//&#x5B9E;&#x4F8B;&#x5316;Classpath&#x5BF9;&#x8C61;</span></span><br><span class=\"line\">\tcp.parseBootAndExtClasspath(jreOption) <span class=\"hljs-comment\">//&#x6309;&#x7167;-Xjre&#x53C2;&#x6570;&#x89E3;&#x6790;Boot&#x548C;Ext&#x542F;&#x52A8;&#x8DEF;&#x5F84;</span></span><br><span class=\"line\">\tcp.parseUserClasspath(cpOption) <span class=\"hljs-comment\">//&#x6309;&#x7167;-cp|classpath&#x53C2;&#x6570;&#x89E3;&#x6790;User&#x542F;&#x52A8;&#x8DEF;&#x5F84;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> cp <span class=\"hljs-comment\">//&#x8FD4;&#x56DE;&#x8BBE;&#x7F6E;&#x597D;&#x542F;&#x52A8;&#x8DEF;&#x5F84;&#x7684;Classpath&#x5BF9;&#x8C61;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Classpath)</span> <span class=\"hljs-title\">ReadClass</span><span class=\"hljs-params\">(className <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-params\">([]<span class=\"hljs-keyword\">byte</span>,Entry,error)</span></span>{</span><br><span class=\"line\">\tclassName = className + <span class=\"hljs-string\">&quot;.class&quot;</span> <span class=\"hljs-comment\">//&#x521D;&#x59CB;&#x5316;className&#x6587;&#x4EF6;&#x540D;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> data, entry, err := self.bootClasspath.readClass(className); err == <span class=\"hljs-literal\">nil</span> { <span class=\"hljs-comment\">//&#x5148;&#x626B;&#x63CF;Boot&#x542F;&#x52A8;&#x8DEF;&#x5F84;&#x4E0B;&#x662F;&#x5426;&#x5B58;&#x5728;&#x8BE5;className.class&#x6587;&#x4EF6;</span></span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span> data, entry, err <span class=\"hljs-comment\">//&#x5B58;&#x5728;&#x5219;&#x8FD4;&#x56DE;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> data, entry, err := self.extClasspath.readClass(className); err == <span class=\"hljs-literal\">nil</span> { <span class=\"hljs-comment\">//&#x518D;&#x626B;&#x63CF;Ext&#x542F;&#x52A8;&#x8DEF;&#x5F84;&#x4E0B;&#x662F;&#x5426;&#x5B58;&#x5728;&#x8BE5;className.class&#x6587;&#x4EF6;</span></span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span> data, entry, err <span class=\"hljs-comment\">//&#x5B58;&#x5728;&#x5219;&#x8FD4;&#x56DE;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.userClasspath.readClass(className) <span class=\"hljs-comment\">//&#x4EE5;&#x4E0A;&#x4E24;&#x4E2A;&#x8DEF;&#x5F84;&#x4E0B;&#x90FD;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x626B;&#x63CF;User&#x542F;&#x52A8;&#x8DEF;&#x5F84;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Classpath)</span> <span class=\"hljs-title\">String</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span>  {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.userClasspath.String()</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Classpath)</span> <span class=\"hljs-title\">parseBootAndExtClasspath</span><span class=\"hljs-params\">(jreOption <span class=\"hljs-keyword\">string</span>)</span></span> { <span class=\"hljs-comment\">//&#x6309;&#x7167;-Xjre&#x53C2;&#x6570;&#x89E3;&#x6790;Boot&#x548C;Ext&#x542F;&#x52A8;&#x8DEF;&#x5F84;</span></span><br><span class=\"line\">\tjreDir := getJreDir(jreOption) <span class=\"hljs-comment\">//&#x83B7;&#x53D6;jre&#x8DEF;&#x5F84;</span></span><br><span class=\"line\">   <span class=\"hljs-comment\">// jre/lib/*</span></span><br><span class=\"line\">   jreLibPath := filepath.Join(jreDir, <span class=\"hljs-string\">&quot;lib&quot;</span>, <span class=\"hljs-string\">&quot;*&quot;</span>)</span><br><span class=\"line\">   self.bootClasspath = newWildcardEntry(jreLibPath)</span><br><span class=\"line\">   <span class=\"hljs-comment\">// jre/lib/ext/*</span></span><br><span class=\"line\">   jreExtPath := filepath.Join(jreDir, <span class=\"hljs-string\">&quot;lib&quot;</span>, <span class=\"hljs-string\">&quot;ext&quot;</span>, <span class=\"hljs-string\">&quot;*&quot;</span>)</span><br><span class=\"line\">   self.extClasspath = newWildcardEntry(jreExtPath)</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">getJreDir</span><span class=\"hljs-params\">(jreOption <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-title\">string</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> jreOption != <span class=\"hljs-string\">&quot;&quot;</span> &amp;&amp; exists(jreOption) { <span class=\"hljs-comment\">//jreOption&#x4E0D;&#x4E3A;&#x7A7A;&#x4E14;&#x5B58;&#x5728;&#x65F6;&#x8FD4;&#x56DE;&#x8BE5;&#x8DEF;&#x5F84;</span></span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span> jreOption</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> exists(<span class=\"hljs-string\">&quot;./jre&quot;</span>) { <span class=\"hljs-comment\">//./jre&#x8DEF;&#x5F84;&#x5B58;&#x5728;&#x65F6;&#xFF0C;&#x8FD4;&#x56DE;.jre</span></span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;./jre&quot;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> jh := os.Getenv(<span class=\"hljs-string\">&quot;JAVA_HOME&quot;</span>); jh != <span class=\"hljs-string\">&quot;&quot;</span> { <span class=\"hljs-comment\">//&#x73AF;&#x5883;&#x53D8;&#x91CF;JAVA_HOME&#x5B58;&#x5728;&#x5E76;&#x4E14;&#x4E0D;&#x4E3A;&#x7A7A;&#x65F6;</span></span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span> filepath.Join(jh, <span class=\"hljs-string\">&quot;jre&quot;</span>) <span class=\"hljs-comment\">//&#x8FD4;&#x56DE;JAVA_HOME + &quot;jre&quot;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-built_in\">panic</span>(<span class=\"hljs-string\">&quot;Can not find jre folder!&quot;</span>)</span><br><span class=\"line\"> }</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">exists</span><span class=\"hljs-params\">(path <span class=\"hljs-keyword\">string</span>)</span> <span class=\"hljs-title\">bool</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> _, err := os.Stat(path); err != <span class=\"hljs-literal\">nil</span> {</span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">if</span> os.IsNotExist(err) {</span><br><span class=\"line\">\t\t  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span></span><br><span class=\"line\">\t   }</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span></span><br><span class=\"line\"> }</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Classpath)</span> <span class=\"hljs-title\">parseUserClasspath</span><span class=\"hljs-params\">(cpOption <span class=\"hljs-keyword\">string</span>)</span></span> { <span class=\"hljs-comment\">//&#x6309;&#x7167;-cp|classpath&#x53C2;&#x6570;&#x89E3;&#x6790;User&#x542F;&#x52A8;&#x53C2;&#x6570;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> cpOption == <span class=\"hljs-string\">&quot;&quot;</span> { <span class=\"hljs-comment\">//cpOption&#x4E3A;&#x7A7A;&#x65F6;</span></span><br><span class=\"line\">\t   cpOption = <span class=\"hljs-string\">&quot;.&quot;</span> <span class=\"hljs-comment\">//&#x8FD4;&#x56DE;&#x76F8;&#x5BF9;&#x8DEF;&#x52B2;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">\tself.userClasspath = newEntry(cpOption) <span class=\"hljs-comment\">//&#x6839;&#x636E;-cp|classpath&#x53C2;&#x6570;&#x5B9E;&#x4F8B;&#x5316;&#x5BF9;&#x5E94;&#x7684;Entry</span></span><br><span class=\"line\"> }</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li><p>main&#xFF0C;&#x4FEE;&#x6539;&#x542F;&#x52A8;&#x7C7B;</p>\n<figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">startJVM</span><span class=\"hljs-params\">(cmd *Cmd)</span></span>{</span><br><span class=\"line\">\tcp := classpath.Parse(cmd.XjreOption, cmd.cpOption) <span class=\"hljs-comment\">//&#x6839;&#x636E;-Xjre&#x548C;-cp|classpath&#x53C2;&#x6570;&#x5B9E;&#x4F8B;&#x5316;classpath&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;</span></span><br><span class=\"line\">\tfmt.Printf(<span class=\"hljs-string\">&quot;classpath:%v class:%v args:%v\\n&quot;</span>,</span><br><span class=\"line\">\t   cp, cmd.class, cmd.args)</span><br><span class=\"line\">\tclassName := strings.Replace(cmd.class, <span class=\"hljs-string\">&quot;.&quot;</span>, <span class=\"hljs-string\">&quot;/&quot;</span>, <span class=\"hljs-number\">-1</span>)</span><br><span class=\"line\">\tclassData, _, err := cp.ReadClass(className) <span class=\"hljs-comment\">//&#x6309;&#x7167;3&#x4E2A;&#x542F;&#x52A8;&#x8DEF;&#x5F84;&#x67E5;&#x627E;&#x5E76;&#x8BFB;&#x53D6;className&#x6587;&#x4EF6;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> err != <span class=\"hljs-literal\">nil</span> {</span><br><span class=\"line\">\t   fmt.Printf(<span class=\"hljs-string\">&quot;Could not find or load main class %s\\n&quot;</span>, cmd.class)</span><br><span class=\"line\">\t   <span class=\"hljs-keyword\">return</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">\tfmt.Printf(<span class=\"hljs-string\">&quot;class data:%v\\n&quot;</span>, classData)</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n</li>\n</ul>\n<ol start=\"3\">\n<li>&#x8BD5;&#x8FD0;&#x884C;<figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS D:\\work\\workspace_go\\src\\jvmgo\\ch02&gt; go install</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch02.exe -Xjre &quot;C:\\Program Files\\Java\\jre1.8.0_202&quot; java.lang.Object</span><br><span class=\"line\">classpath:D:\\work\\workspace_go\\bin class:java.lang.Object args:[]</span><br><span class=\"line\">class data:[202 254 186 190 0 0 0 52 0 75 3 0 15 66 63 8 0 16 8 0 36 8 0 40 1 0 3 40 41 73 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 3 40 41 86 1 0 21 40 73 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 4 40 74 41 86 1 0 5 40 74 73 41 86 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 41 90 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 86 1 0 8 60 99 108 105 110 105 116 62 1 0 6 60 105 110 105 116 62 1 0 1 64 1 0 4 67 111 100</span><br><span class=\"line\">101 1 0 10 69 120 99 101 112 116 105 111 110 115 1 0 9 83 105 103 110 97 116 117 114 101 1 0 13 83 116 97 99 107 77 97 112 84 97 98 108 101 1 0 6 97 112 112 101 110 100 1 0 5 99 108 111 110 101 1 0 6 101 113</span><br><span class=\"line\">117 97 108 115 1 0 8 102 105 110 97 108 105 122 101 1 0 8 103 101 116 67 108 97 115 115 1 0 7 103 101 116 78 97 109 101 1 0 8 104 97 115 104 67 111 100 101 1 0 15 106 97 118 97 47 108 97 110 103 47 67 108 97</span><br><span class=\"line\">115 115 1 0 36 106 97 118 97 47 108 97 110 103 47 67 108 111 110 101 78 111 116 83 117 112 112 111 114 116 101 100 69 120 99 101 112 116 105 111 110 1 0 34 106 97 118 97 47 108 97 110 103 47 73 108 108 101 103 97 108 65 114 103 117 109 101 110 116 69 120 99 101 112 116 105 111 110 1 0 17 106 97 118 97 47 108 97 110 103 47 73 110 116 101 103 101 114 1 0 30 106 97 118 97 47 108 97 110 103 47 73 110 116 101 114 114</span><br><span class=\"line\">117 112 116 101 100 69 120 99 101 112 116 105 111 110 1 0 16 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 1 0 23 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 1 0 19 106 97 118 97 47 108 97 110 103 47 84 104 114 111 119 97 98 108 101 1 0 37 110 97 110 111 115 101 99 111 110 100 32 116 105 109 101 111 117 116 32 118 97 108 117 101 32 111 117 116 32 111 102 32 114 97 110 103 101 1 0 6 110 111 116 105 102 121 1 0 9 110 111 116 105 102 121 65 108 108 1 0 15 114 101 103 105 115 116 101 114 78 97 116 105 118 101 115 1 0 25 116 105 109 101 111 117 116 32 118 97 108 117 101 32 105 115 32 110 101 103 97 116 105 118 101 1 0 11 116 111 72 101 120 83 116 114 105 110 103 1 0 8 116 111 83 116 114 105 110 103 1 0 4 119 97 105 116 7 0 28 7 0 29 7 0 30 7 0 31 7 0 32 7 0 33 7 0 34 7 0 35 1 0 19 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 59 1 0 22 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 60 42 62 59 1 0 45 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 59 12 0 27 0 5 12 0 15 0 8 12 0 39 0 8 12 0 43 0 10 12 0 25 0 52 12 0 26 0 7 12 0 42 0 7 12 0 41 0</span><br><span class=\"line\">9 12 0 15 0 13 12 0 21 0 54 10 0 44 0 60 10 0 46 0 63 10 0 47 0 62 10 0 49 0 55 10 0 49 0 57 10 0 49 0 58 10 0 49 0 59 10 0 50 0 56 10 0 50 0 61 10 0 50 0 64 0 33 0 49 0 0 0 0 0 0 0 14 0 1 0 15 0 8 0 1 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 1 10 0 39 0 8 0 0 1 17 0 25 0 52 0 1 0 19 0 0 0 2 0 53 1 1 0 27 0 5 0 0 0 1 0 23 0 12 0 1 0 17 0 0 0 34 0 2 0 2 0 0 0 11 42 43 166 0 7 4 167 0 4 3 172 0 0 0 1 0 20 0 0 0 5</span><br><span class=\"line\">0 2 9 64 1 1 4 0 22 0 6 0 1 0 18 0 0 0 4 0 1 0 45 0 1 0 42 0 7 0 1 0 17 0 0 0 48 0 2 0 1 0 0 0 36 187 0 50 89 183 0 72 42 182 0 71 182 0 65 182 0 74 18 2 182 0 74 42 182 0 68 184 0 67 182 0 74 182 0 73 176 0</span><br><span class=\"line\">0 0 0 1 17 0 37 0 8 0 0 1 17 0 38 0 8 0 0 1 17 0 43 0 10 0 1 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 11 0 2 0 17 0 0 0 74 0 4 0 4 0 0 0 50 31 9 148 156 0 13 187 0 46 89 18 4 183 0 66 191 29 155 0 9 29 18 1 164 0 13 187 0 46 89 18 3 183 0 66 191 29 158 0 7 31 10 97 64 42 31 182 0 70 177 0 0 0 1 0 20 0 0 0 6 0 4 16 9 9 7 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 8 0 2 0 17 0 0 0 18 0 3 0 1 0 0 0 6 42 9 182 0 70 177 0 0 0 0 0 18</span><br><span class=\"line\">0 0 0 4 0 1 0 48 0 4 0 24 0 8 0 2 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 0 18 0 0 0 4 0 1 0 51 0 8 0 14 0 8 0 1 0 17 0 0 0 16 0 0 0 0 0 0 0 4 184 0 69 177 0 0 0 0 0 0]</span><br></pre></td></tr></tbody></table></figure>\n</li>\n</ol>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"JVM","path":"tags/JVM/"},{"name":"Java","path":"tags/Java/"},{"name":"Go","path":"tags/Go/"}],"excerpt":"<html><head></head><body><h2 id=\"&#x5B9E;&#x73B0;cp-classpath-&#x53C2;&#x6570;&#x641C;&#x7D22;class&#x6587;&#x4EF6;\"><a href=\"#&#x5B9E;&#x73B0;cp-classpath-&#x53C2;&#x6570;&#x641C;&#x7D22;class&#x6587;&#x4EF6;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;cp/classpath &#x53C2;&#x6570;&#x641C;&#x7D22;class&#x6587;&#x4EF6;\"></a>&#x5B9E;&#x73B0;cp/classpath &#x53C2;&#x6570;&#x641C;&#x7D22;class&#x6587;&#x4EF6;</h2><h3 id=\"java-class-path-&#x641C;&#x7D22;&#x987A;&#x5E8F;&#xFF1A;\"><a href=\"#java-class-path-&#x641C;&#x7D22;&#x987A;&#x5E8F;&#xFF1A;\" class=\"headerlink\" title=\"java class path &#x641C;&#x7D22;&#x987A;&#x5E8F;&#xFF1A;\"></a>java class path &#x641C;&#x7D22;&#x987A;&#x5E8F;&#xFF1A;</h3><ol>\n<li>&#x542F;&#x52A8;&#x7C7B;&#x8DEF;&#x5F84;&#xFF08;bootstrap classpath&#xFF09;:jre\\lib &#xFF08;&#x53EF;&#x901A;&#x8FC7;-Xbootclasspath&#x53C2;&#x6570;&#x4FEE;&#x6539;&#x8BE5;&#x8DEF;&#x5F84;&#xFF09;</li>\n<li>&#x6269;&#x5C55;&#x7C7B;&#x8DEF;&#x5F84;&#xFF08;extension classpath&#xFF09;:jre\\lib\\ext</li>\n<li>&#x7528;&#x6237;&#x7C7B;&#x8DEF;&#x5F84;&#xFF08;user classpath&#xFF09;:&#x7528;&#x6237;&#x81EA;&#x5DF1;&#x6307;&#x5B9A;</li>\n</ol></body></html>","more":"<h3 id=\"å®ç°\"><a href=\"#å®ç°\" class=\"headerlink\" title=\"å®ç°\"></a>å®ç°</h3><ol>\n<li>Entryæ¥å£ç”¨æ¥å®šä¹‰å¯åŠ¨ç±»çš„åŸºæœ¬åŠŸèƒ½</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> pathListSeparator = <span class=\"keyword\">string</span>(os.PathListSeparator) <span class=\"comment\">//è·å–å½“å‰æ“ä½œç³»ç»Ÿåˆ†éš”ç¬¦</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Entry <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">\treadClass(classNme <span class=\"keyword\">string</span>) ([]<span class=\"keyword\">byte</span>,Entry,error) <span class=\"comment\">//å®šä¹‰æŒ‰classåè¯»å–classæ–‡ä»¶çš„æ–¹</span></span><br><span class=\"line\">\tString() <span class=\"keyword\">string</span> </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//æ ¹æ®classpathç”Ÿæˆå¯¹åº”çš„å¯åŠ¨ç±»</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newEntry</span><span class=\"params\">(path <span class=\"keyword\">string</span>)</span> <span class=\"title\">Entry</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> strings.Contains(path,pathListSeparator)&#123; <span class=\"comment\">//classpathè·¯å¾„åŒ…å«ç³»ç»Ÿåˆ†å‰²ç¬¦æ—¶ï¼Œnewç»„åˆå¯åŠ¨ç±»</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> newCompositeEntry(path)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> strings.HasSuffix(path,<span class=\"string\">&quot;*&quot;</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> newWildcardEntry(path) <span class=\"comment\">//classpathè·¯å¾„åŒ…å«*æ—¶ï¼Œnewé€šé…ç¬¦å¯åŠ¨ç±»</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> strings.HasSuffix(path, <span class=\"string\">&quot;.jar&quot;</span>) || strings.HasSuffix(path, <span class=\"string\">&quot;.JAR&quot;</span>) ||</span><br><span class=\"line\">      strings.HasSuffix(path, <span class=\"string\">&quot;.zip&quot;</span>) || strings.HasSuffix(path, <span class=\"string\">&quot;.ZIP&quot;</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> newZipEntry(path) <span class=\"comment\">//classpathè·¯å¾„åŒ…å«jarã€JARã€zipã€ZIPæ—¶ï¼Œnewæ–‡ä»¶å¤¹å¯åŠ¨ç±»</span></span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> newDirEntry(path)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>Entryæ¥å£çš„å…·ä½“å®ç°</li>\n</ol>\n<ul>\n<li><p>DirEntryï¼ŒæŒ‰ç…§æ–‡ä»¶è·¯å¾„è¯»å–æ–‡ä»¶äºŒè¿›åˆ¶æµ </p>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> DirEntry <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tabsDir <span class=\"keyword\">string</span> <span class=\"comment\">//å­˜å‚¨æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newDirEntry</span><span class=\"params\">(path <span class=\"keyword\">string</span>)</span> *<span class=\"title\">DirEntry</span></span> &#123;</span><br><span class=\"line\">\tabsDir,err := filepath.Abs(path) <span class=\"comment\">//å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err) <span class=\"comment\">//æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨æ—¶æç¤ºé”™è¯¯</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;DirEntry&#123;absDir&#125; <span class=\"comment\">//è¿”å›DirEntryå®ä¾‹</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *DirEntry)</span> <span class=\"title\">readClass</span><span class=\"params\">(className <span class=\"keyword\">string</span>)</span> <span class=\"params\">([]<span class=\"keyword\">byte</span>,Entry,error)</span></span>&#123;</span><br><span class=\"line\">\tfileName := filepath.Join(self.absDir,className) <span class=\"comment\">//æ‹¼æ¥æ–‡ä»¶å¤¹è·¯å¾„å’Œclassname</span></span><br><span class=\"line\">\tdata,err := ioutil.ReadFile(fileName) <span class=\"comment\">//è¯»å–æ–‡ä»¶</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> data,self,err <span class=\"comment\">//è¿”å›æ–‡ä»¶å†…å®¹</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(self *DirEntry)</span> <span class=\"title\">String</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.absDir <span class=\"comment\">//è¿”å›æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>ZipEntry,è¯»å–å‹ç¼©æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶</p>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> ZipEnty <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tabsPath <span class=\"keyword\">string</span> <span class=\"comment\">//æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newZipEntry</span><span class=\"params\">(path <span class=\"keyword\">string</span>)</span> *<span class=\"title\">ZipEnty</span></span> &#123;</span><br><span class=\"line\">\tabsPath, err := filepath.Abs(path) <span class=\"comment\">//å¦‚æœæ–‡ä»¶è·¯å¾„å­˜åœ¨ï¼Œè·å–æ–‡ä»¶å¤¹è·¯å¾„</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;ZipEnty&#123;absPath&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ZipEnty)</span> <span class=\"title\">readClass</span><span class=\"params\">(className <span class=\"keyword\">string</span>)</span> <span class=\"params\">([]<span class=\"keyword\">byte</span>,Entry,error)</span></span>&#123;</span><br><span class=\"line\">\tr, err := zip.OpenReader(self.absPath) <span class=\"comment\">//ä»¥å‹ç¼©æ–‡ä»¶æ ¼å¼è§£å‹</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span>, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> r.Close() <span class=\"comment\">//æœ€åå…³é—­æ–‡ä»¶æµ</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, f := <span class=\"keyword\">range</span> r.File &#123; <span class=\"comment\">//å¾ªç¯è§£å‹å‡ºæ¥çš„æ–‡ä»¶</span></span><br><span class=\"line\">\t   <span class=\"keyword\">if</span> f.Name == className &#123; <span class=\"comment\">//å¦‚æœå½“å‰æ–‡ä»¶ä¸ºæŒ‡å®šæ–‡ä»¶</span></span><br><span class=\"line\">\t\t  rc, err := f.Open() <span class=\"comment\">//æ‰“å¼€è¯¥æ–‡ä»¶</span></span><br><span class=\"line\">\t\t  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span>, err</span><br><span class=\"line\">\t\t  &#125;</span><br><span class=\"line\">\t\t  <span class=\"keyword\">defer</span> rc.Close() <span class=\"comment\">//æœ€åå…³é—­æ–‡ä»¶</span></span><br><span class=\"line\">\t\t  data, err := ioutil.ReadAll(rc) <span class=\"comment\">//è¯»å–æ–‡ä»¶æµ</span></span><br><span class=\"line\">\t\t  <span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span>, err</span><br><span class=\"line\">\t\t  &#125;</span><br><span class=\"line\">\t\t  <span class=\"keyword\">return</span> data, self, <span class=\"literal\">nil</span> <span class=\"comment\">//è¿”å›æ–‡ä»¶æµ</span></span><br><span class=\"line\">\t   &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span>, errors.New(<span class=\"string\">&quot;class not found: &quot;</span> + className)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ZipEnty)</span> <span class=\"title\">String</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.absPath</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>CompositeEntry,è¯»å–ç¬¦åˆæ–‡ä»¶ç±»å‹</p>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> CompositeEntry []Entry <span class=\"comment\">//CompositeEntryä¸ºå¤šç§Entryçš„æ•°ç»„ï¼ˆDirã€Zipï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newCompositeEntry</span><span class=\"params\">(pathList <span class=\"keyword\">string</span>)</span> <span class=\"title\">CompositeEntry</span></span> &#123;</span><br><span class=\"line\">\tcompositeEntry := []Entry&#123;&#125; <span class=\"comment\">//å®ä¾‹Entryæ¥å£æ•°ç»„</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _,path := <span class=\"keyword\">range</span> strings.Split(pathList,pathListSeparator)&#123; <span class=\"comment\">//æŒ‰ç…§ç³»ç»Ÿåˆ†å‰²ç¬¦æˆªå–pathåˆ—è¡¨ï¼Œå¹¶å¾ªç¯</span></span><br><span class=\"line\">\t\tentry := newEntry(path) <span class=\"comment\">//æŒ‰ç…§æ¯ç§pathå®ä¾‹åŒ–ä¸åŒçš„Entry(Dirã€Zipã€Wildcard)</span></span><br><span class=\"line\">\t\tcompositeEntry = <span class=\"built_in\">append</span>(compositeEntry,entry) <span class=\"comment\">//å°†å®ä¾‹åŒ–çš„ä¸åŒEntryæ”¾å…¥CompositeEntryæ•°ç»„ä¸­</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> compositeEntry</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self CompositeEntry)</span> <span class=\"title\">readClass</span><span class=\"params\">(className <span class=\"keyword\">string</span>)</span><span class=\"params\">([]<span class=\"keyword\">byte</span>,Entry,error)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, entry := <span class=\"keyword\">range</span> self &#123; <span class=\"comment\">//å¾ªç¯compositeEntryæ•°ç»„</span></span><br><span class=\"line\">\t\tdata, from, err := entry.readClass(className) <span class=\"comment\">//æ ¹æ®ä¸åŒEntry(Dirã€Zipã€Wildcard)ï¼ŒæŒ‰æŒ‡å®šclassnameè¯»å–æ–‡ä»¶</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t   <span class=\"keyword\">return</span> data, from, <span class=\"literal\">nil</span> <span class=\"comment\">//è¿”å›è¯»å–ç»“æœ</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t &#125;</span><br><span class=\"line\">\t <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>, <span class=\"literal\">nil</span>, errors.New(<span class=\"string\">&quot;class not found: &quot;</span> + className) <span class=\"comment\">//æ— ç»“æœæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self CompositeEntry)</span> <span class=\"title\">String</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\tstrs := <span class=\"built_in\">make</span>([]<span class=\"keyword\">string</span>, <span class=\"built_in\">len</span>(self)) <span class=\"comment\">//æŒ‰ç…§CompositeEntryçš„é•¿åº¦ç”³æ˜è¯¥é•¿åº¦çš„Sringæ•°ç»„</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i, entry := <span class=\"keyword\">range</span> self &#123; <span class=\"comment\">//å¾ªç¯CompositeEntry</span></span><br><span class=\"line\">\t   strs[i] = entry.String() <span class=\"comment\">//è°ƒç”¨æ¯ä¸ªEntry(Dirã€Zipã€Wildcard)å®ç°ç±»çš„String()æ–¹æ³•,å¹¶æ”¾å…¥Stringæ•°ç»„ä¸­</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> strings.Join(strs, pathListSeparator) <span class=\"comment\">//å°†Stringæ•°ç»„ä¸­çš„ç»“æœä»¥ç³»ç»Ÿåˆ†éš”ç¬¦æ‹¼æ¥å¹¶è¿”å›</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>WildcardEntryï¼ŒæŒ‰ç…§é€šé…ç¬¦è§£ææ–‡ä»¶</p>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newWildcardEntry</span><span class=\"params\">(path <span class=\"keyword\">string</span>)</span> <span class=\"title\">CompositeEntry</span></span> &#123;</span><br><span class=\"line\">\tbaseDir := path[:<span class=\"built_in\">len</span>(path)<span class=\"number\">-1</span>] <span class=\"comment\">// remove *</span></span><br><span class=\"line\">\tcompositeEntry := []Entry&#123;&#125; <span class=\"comment\">//ç”³æ˜compositeEntryå¯¹è±¡(Entryçš„æ•°ç»„)</span></span><br><span class=\"line\">\twalkFn := <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(path <span class=\"keyword\">string</span>, info os.FileInfo, err error)</span> <span class=\"title\">error</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t   <span class=\"keyword\">return</span> err</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> info.IsDir() &amp;&amp; path != baseDir &#123; <span class=\"comment\">//å¦‚æœå½“å‰ç›®å½•æ˜¯æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æ˜¯æ ¹ç›®å½•</span></span><br><span class=\"line\">\t\t   <span class=\"keyword\">return</span> filepath.SkipDir <span class=\"comment\">//è¿”å›SkipDirçš„é”™è¯¯</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> strings.HasSuffix(path, <span class=\"string\">&quot;.jar&quot;</span>) || strings.HasSuffix(path, <span class=\"string\">&quot;.JAR&quot;</span>) &#123; <span class=\"comment\">//å¦‚æœå½“å‰è·¯å¾„æ˜¯ä»¥.jaræˆ–.JARç»“å°¾çš„</span></span><br><span class=\"line\">\t\t\tjarEntry := newZipEntry(path) <span class=\"comment\">//å®ä¾‹åŒ–ZipEntry</span></span><br><span class=\"line\">\t\t\tcompositeEntry = <span class=\"built_in\">append</span>(compositeEntry, jarEntry) <span class=\"comment\">//å°†å®ä¾‹åŒ–çš„ZipEntryå¯¹è±¡æ”¾å…¥compositeEntryæ•°ç»„ä¸­</span></span><br><span class=\"line\">\t\t &#125;</span><br><span class=\"line\">\t\t <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">\t  &#125;</span><br><span class=\"line\">\tfilepath.Walk(baseDir, walkFn) <span class=\"comment\">//å°†walkFnæ–¹æ³•ä¼ é€’ç»™filepath.Walk</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> compositeEntry <span class=\"comment\">//è¿”å›ç»“æœ</span></span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Classpathï¼Œ-cp|classpathå‚æ•°è§£æå®ç°çš„å…¥å£æ–¹æ³•</p>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Classpath <span class=\"keyword\">struct</span> &#123; <span class=\"comment\">//ClasspathåŒ…å«javaçš„ä¸‰ç§åŸºç¡€å¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">\tbootClasspath Entry </span><br><span class=\"line\">\textClasspath Entry</span><br><span class=\"line\">\tuserClasspath Entry</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Parse</span><span class=\"params\">(jreOption, cpOption <span class=\"keyword\">string</span>)</span> * <span class=\"title\">Classpath</span></span>  &#123;</span><br><span class=\"line\">\tcp := &amp;Classpath&#123;&#125; <span class=\"comment\">//å®ä¾‹åŒ–Classpathå¯¹è±¡</span></span><br><span class=\"line\">\tcp.parseBootAndExtClasspath(jreOption) <span class=\"comment\">//æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">\tcp.parseUserClasspath(cpOption) <span class=\"comment\">//æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> cp <span class=\"comment\">//è¿”å›è®¾ç½®å¥½å¯åŠ¨è·¯å¾„çš„Classpathå¯¹è±¡</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Classpath)</span> <span class=\"title\">ReadClass</span><span class=\"params\">(className <span class=\"keyword\">string</span>)</span> <span class=\"params\">([]<span class=\"keyword\">byte</span>,Entry,error)</span></span>&#123;</span><br><span class=\"line\">\tclassName = className + <span class=\"string\">&quot;.class&quot;</span> <span class=\"comment\">//åˆå§‹åŒ–classNameæ–‡ä»¶å</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> data, entry, err := self.bootClasspath.readClass(className); err == <span class=\"literal\">nil</span> &#123; <span class=\"comment\">//å…ˆæ‰«æBootå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶</span></span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> data, entry, err <span class=\"comment\">//å­˜åœ¨åˆ™è¿”å›</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> data, entry, err := self.extClasspath.readClass(className); err == <span class=\"literal\">nil</span> &#123; <span class=\"comment\">//å†æ‰«æExtå¯åŠ¨è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨è¯¥className.classæ–‡ä»¶</span></span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> data, entry, err <span class=\"comment\">//å­˜åœ¨åˆ™è¿”å›</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.userClasspath.readClass(className) <span class=\"comment\">//ä»¥ä¸Šä¸¤ä¸ªè·¯å¾„ä¸‹éƒ½ä¸å­˜åœ¨ï¼Œåˆ™æ‰«æUserå¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Classpath)</span> <span class=\"title\">String</span><span class=\"params\">()</span> <span class=\"title\">string</span></span>  &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.userClasspath.String()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Classpath)</span> <span class=\"title\">parseBootAndExtClasspath</span><span class=\"params\">(jreOption <span class=\"keyword\">string</span>)</span></span> &#123; <span class=\"comment\">//æŒ‰ç…§-Xjreå‚æ•°è§£æBootå’ŒExtå¯åŠ¨è·¯å¾„</span></span><br><span class=\"line\">\tjreDir := getJreDir(jreOption) <span class=\"comment\">//è·å–jreè·¯å¾„</span></span><br><span class=\"line\">   <span class=\"comment\">// jre/lib/*</span></span><br><span class=\"line\">   jreLibPath := filepath.Join(jreDir, <span class=\"string\">&quot;lib&quot;</span>, <span class=\"string\">&quot;*&quot;</span>)</span><br><span class=\"line\">   self.bootClasspath = newWildcardEntry(jreLibPath)</span><br><span class=\"line\">   <span class=\"comment\">// jre/lib/ext/*</span></span><br><span class=\"line\">   jreExtPath := filepath.Join(jreDir, <span class=\"string\">&quot;lib&quot;</span>, <span class=\"string\">&quot;ext&quot;</span>, <span class=\"string\">&quot;*&quot;</span>)</span><br><span class=\"line\">   self.extClasspath = newWildcardEntry(jreExtPath)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">getJreDir</span><span class=\"params\">(jreOption <span class=\"keyword\">string</span>)</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> jreOption != <span class=\"string\">&quot;&quot;</span> &amp;&amp; exists(jreOption) &#123; <span class=\"comment\">//jreOptionä¸ä¸ºç©ºä¸”å­˜åœ¨æ—¶è¿”å›è¯¥è·¯å¾„</span></span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> jreOption</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> exists(<span class=\"string\">&quot;./jre&quot;</span>) &#123; <span class=\"comment\">//./jreè·¯å¾„å­˜åœ¨æ—¶ï¼Œè¿”å›.jre</span></span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> <span class=\"string\">&quot;./jre&quot;</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> jh := os.Getenv(<span class=\"string\">&quot;JAVA_HOME&quot;</span>); jh != <span class=\"string\">&quot;&quot;</span> &#123; <span class=\"comment\">//ç¯å¢ƒå˜é‡JAVA_HOMEå­˜åœ¨å¹¶ä¸”ä¸ä¸ºç©ºæ—¶</span></span><br><span class=\"line\">\t   <span class=\"keyword\">return</span> filepath.Join(jh, <span class=\"string\">&quot;jre&quot;</span>) <span class=\"comment\">//è¿”å›JAVA_HOME + &quot;jre&quot;</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">panic</span>(<span class=\"string\">&quot;Can not find jre folder!&quot;</span>)</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">exists</span><span class=\"params\">(path <span class=\"keyword\">string</span>)</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> _, err := os.Stat(path); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t   <span class=\"keyword\">if</span> os.IsNotExist(err) &#123;</span><br><span class=\"line\">\t\t  <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">\t   &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Classpath)</span> <span class=\"title\">parseUserClasspath</span><span class=\"params\">(cpOption <span class=\"keyword\">string</span>)</span></span> &#123; <span class=\"comment\">//æŒ‰ç…§-cp|classpathå‚æ•°è§£æUserå¯åŠ¨å‚æ•°</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> cpOption == <span class=\"string\">&quot;&quot;</span> &#123; <span class=\"comment\">//cpOptionä¸ºç©ºæ—¶</span></span><br><span class=\"line\">\t   cpOption = <span class=\"string\">&quot;.&quot;</span> <span class=\"comment\">//è¿”å›ç›¸å¯¹è·¯åŠ²</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tself.userClasspath = newEntry(cpOption) <span class=\"comment\">//æ ¹æ®-cp|classpathå‚æ•°å®ä¾‹åŒ–å¯¹åº”çš„Entry</span></span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>mainï¼Œä¿®æ”¹å¯åŠ¨ç±»</p>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">startJVM</span><span class=\"params\">(cmd *Cmd)</span></span>&#123;</span><br><span class=\"line\">\tcp := classpath.Parse(cmd.XjreOption, cmd.cpOption) <span class=\"comment\">//æ ¹æ®-Xjreå’Œ-cp|classpathå‚æ•°å®ä¾‹åŒ–classpathå¯¹è±¡å®ä¾‹</span></span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;classpath:%v class:%v args:%v\\n&quot;</span>,</span><br><span class=\"line\">\t   cp, cmd.class, cmd.args)</span><br><span class=\"line\">\tclassName := strings.Replace(cmd.class, <span class=\"string\">&quot;.&quot;</span>, <span class=\"string\">&quot;/&quot;</span>, <span class=\"number\">-1</span>)</span><br><span class=\"line\">\tclassData, _, err := cp.ReadClass(className) <span class=\"comment\">//æŒ‰ç…§3ä¸ªå¯åŠ¨è·¯å¾„æŸ¥æ‰¾å¹¶è¯»å–classNameæ–‡ä»¶</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t   fmt.Printf(<span class=\"string\">&quot;Could not find or load main class %s\\n&quot;</span>, cmd.class)</span><br><span class=\"line\">\t   <span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;class data:%v\\n&quot;</span>, classData)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<ol start=\"3\">\n<li>è¯•è¿è¡Œ<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PS D:\\work\\workspace_go\\src\\jvmgo\\ch02&gt; go install</span><br><span class=\"line\"></span><br><span class=\"line\">PS D:\\work\\workspace_go\\bin&gt; .\\ch02.exe -Xjre &quot;C:\\Program Files\\Java\\jre1.8.0_202&quot; java.lang.Object</span><br><span class=\"line\">classpath:D:\\work\\workspace_go\\bin class:java.lang.Object args:[]</span><br><span class=\"line\">class data:[202 254 186 190 0 0 0 52 0 75 3 0 15 66 63 8 0 16 8 0 36 8 0 40 1 0 3 40 41 73 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 1 0 20 40 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 3 40 41 86 1 0 21 40 73 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 1 0 4 40 74 41 86 1 0 5 40 74 73 41 86 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 59 41 90 1 0 21 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 86 1 0 8 60 99 108 105 110 105 116 62 1 0 6 60 105 110 105 116 62 1 0 1 64 1 0 4 67 111 100</span><br><span class=\"line\">101 1 0 10 69 120 99 101 112 116 105 111 110 115 1 0 9 83 105 103 110 97 116 117 114 101 1 0 13 83 116 97 99 107 77 97 112 84 97 98 108 101 1 0 6 97 112 112 101 110 100 1 0 5 99 108 111 110 101 1 0 6 101 113</span><br><span class=\"line\">117 97 108 115 1 0 8 102 105 110 97 108 105 122 101 1 0 8 103 101 116 67 108 97 115 115 1 0 7 103 101 116 78 97 109 101 1 0 8 104 97 115 104 67 111 100 101 1 0 15 106 97 118 97 47 108 97 110 103 47 67 108 97</span><br><span class=\"line\">115 115 1 0 36 106 97 118 97 47 108 97 110 103 47 67 108 111 110 101 78 111 116 83 117 112 112 111 114 116 101 100 69 120 99 101 112 116 105 111 110 1 0 34 106 97 118 97 47 108 97 110 103 47 73 108 108 101 103 97 108 65 114 103 117 109 101 110 116 69 120 99 101 112 116 105 111 110 1 0 17 106 97 118 97 47 108 97 110 103 47 73 110 116 101 103 101 114 1 0 30 106 97 118 97 47 108 97 110 103 47 73 110 116 101 114 114</span><br><span class=\"line\">117 112 116 101 100 69 120 99 101 112 116 105 111 110 1 0 16 106 97 118 97 47 108 97 110 103 47 79 98 106 101 99 116 1 0 23 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 1 0 19 106 97 118 97 47 108 97 110 103 47 84 104 114 111 119 97 98 108 101 1 0 37 110 97 110 111 115 101 99 111 110 100 32 116 105 109 101 111 117 116 32 118 97 108 117 101 32 111 117 116 32 111 102 32 114 97 110 103 101 1 0 6 110 111 116 105 102 121 1 0 9 110 111 116 105 102 121 65 108 108 1 0 15 114 101 103 105 115 116 101 114 78 97 116 105 118 101 115 1 0 25 116 105 109 101 111 117 116 32 118 97 108 117 101 32 105 115 32 110 101 103 97 116 105 118 101 1 0 11 116 111 72 101 120 83 116 114 105 110 103 1 0 8 116 111 83 116 114 105 110 103 1 0 4 119 97 105 116 7 0 28 7 0 29 7 0 30 7 0 31 7 0 32 7 0 33 7 0 34 7 0 35 1 0 19 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 59 1 0 22 40 41 76 106 97 118 97 47 108 97 110 103 47 67 108 97 115 115 60 42 62 59 1 0 45 40 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 59 41 76 106 97 118 97 47 108 97 110 103 47 83 116 114 105 110 103 66 117 105 108 100 101 114 59 12 0 27 0 5 12 0 15 0 8 12 0 39 0 8 12 0 43 0 10 12 0 25 0 52 12 0 26 0 7 12 0 42 0 7 12 0 41 0</span><br><span class=\"line\">9 12 0 15 0 13 12 0 21 0 54 10 0 44 0 60 10 0 46 0 63 10 0 47 0 62 10 0 49 0 55 10 0 49 0 57 10 0 49 0 58 10 0 49 0 59 10 0 50 0 56 10 0 50 0 61 10 0 50 0 64 0 33 0 49 0 0 0 0 0 0 0 14 0 1 0 15 0 8 0 1 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 1 10 0 39 0 8 0 0 1 17 0 25 0 52 0 1 0 19 0 0 0 2 0 53 1 1 0 27 0 5 0 0 0 1 0 23 0 12 0 1 0 17 0 0 0 34 0 2 0 2 0 0 0 11 42 43 166 0 7 4 167 0 4 3 172 0 0 0 1 0 20 0 0 0 5</span><br><span class=\"line\">0 2 9 64 1 1 4 0 22 0 6 0 1 0 18 0 0 0 4 0 1 0 45 0 1 0 42 0 7 0 1 0 17 0 0 0 48 0 2 0 1 0 0 0 36 187 0 50 89 183 0 72 42 182 0 71 182 0 65 182 0 74 18 2 182 0 74 42 182 0 68 184 0 67 182 0 74 182 0 73 176 0</span><br><span class=\"line\">0 0 0 1 17 0 37 0 8 0 0 1 17 0 38 0 8 0 0 1 17 0 43 0 10 0 1 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 11 0 2 0 17 0 0 0 74 0 4 0 4 0 0 0 50 31 9 148 156 0 13 187 0 46 89 18 4 183 0 66 191 29 155 0 9 29 18 1 164 0 13 187 0 46 89 18 3 183 0 66 191 29 158 0 7 31 10 97 64 42 31 182 0 70 177 0 0 0 1 0 20 0 0 0 6 0 4 16 9 9 7 0 18 0 0 0 4 0 1 0 48 0 17 0 43 0 8 0 2 0 17 0 0 0 18 0 3 0 1 0 0 0 6 42 9 182 0 70 177 0 0 0 0 0 18</span><br><span class=\"line\">0 0 0 4 0 1 0 48 0 4 0 24 0 8 0 2 0 17 0 0 0 13 0 0 0 1 0 0 0 1 177 0 0 0 0 0 18 0 0 0 4 0 1 0 51 0 8 0 14 0 8 0 1 0 17 0 0 0 16 0 0 0 0 0 0 0 4 184 0 69 177 0 0 0 0 0 0]</span><br></pre></td></tr></table></figure>\n</li>\n</ol>"},{"title":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°3","date":"2019-09-13T10:44:38.000Z","_content":"\nç¬¬ä¸‰ç¯‡ä¸»è¦å­¦ä¹ JVMä¸­classæ–‡ä»¶çš„å…·ä½“ç»“æ„ï¼Œå’ŒJVMæ˜¯å¦‚ä½•è§£æè¿™äº›ç»“æ„çš„ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡javacå·¥å…·å°†ä¸€ä¸ªjavaæ–‡ä»¶compileæˆä¸€ä¸ª.classæ–‡ä»¶ï¼Œå¹¶é€šè¿‡æˆ‘ä»¬è‡ªå·±å†™çš„jvmå°†è¯¥æ–‡ä»¶è§£æå¹¶æ‰“å°å‡ºæ¥ã€‚é€šè¿‡classæ–‡ä»¶çš„å­¦ä¹ èƒ½è®©æˆ‘ä»¬æ›´åŠ æ·±åˆ»çš„ç†è§£javaæ˜¯æ€æ ·å®ç°è·¨å¹³å°ï¼Œå¹¶ä¸”æˆ‘ä»¬ç¼–å†™çš„javaä»£ç åˆæ˜¯å¦‚ä½•åœ¨JVMä¸­ä½“ç°çš„ã€‚\n<!-- more -->\n\n### JVMä¸­classæ–‡ä»¶ç»“æ„(ClassFile)\nLength|name\n---|---\nu4|magic\nu2|minor_version\nu2|major_version\nu2|constant_pool_count\ncp_info|constant_pool[constant_pool_count-1]\nu2|access_flags\nu2|this_class\nu2|super_class\nu2|interfaces_count\nu2|interfaces[interfaces_count]\nu2|fields_count\nfield_info|fields[fields_count]\nu2|methods_count\nmethod_info|methods[methods_count]\n\n### JVMä¸­å­—æ®µç»“æ„(field_info)\nLength|name\n---|---\nu2|access_flags\nu2|name_index\nu2|descriptor_index\nu2|attributes_count\nattribute_info|attributes[attributes_count]\n\n### JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„(access_flags)\næ ‡å¿—å|æ ‡å¿—å€¼|æ ‡å¿—å«ä¹‰|é’ˆå¯¹çš„å¯¹è±¡\n---|---|---|---\nACC_PUBLIC|0x0001|publicç±»å‹|æ‰€æœ‰ç±»å‹\nACC_FINAL|0x0010|finalç±»å‹|ç±»\nACC_SUPER|0x0020|ä½¿ç”¨æ–°çš„invokespecialè¯­ä¹‰|ç±»å’Œæ¥å£\nACC_INTERFACE|0x0200|æ¥å£ç±»å‹|æ¥å£\nACC_ABSTRACT|0x0400|æŠ½è±¡ç±»å‹|ç±»å’Œæ¥å£\nACC_SYNTHETIC|0x1000|è¯¥ç±»ä¸ç”±ç”¨æˆ·ä»£ç ç”Ÿæˆ|æ‰€æœ‰ç±»å‹\nACC_ANNOTATION|0x2000|æ³¨è§£ç±»å‹|æ³¨è§£\nACC_ENUM|0x4000|æšä¸¾ç±»å‹|æšä¸¾\n\n### å®ç°\n1. å®šä¹‰Classæ–‡ä»¶çš„å½•å–ç±»(ClassReader)\n\n{% codeblock lang:golang %}\ntype ClassReader struct {\n\tdata []byte //classæ–‡ä»¶å­—èŠ‚æµ\n}\n\n// è¯»å–u1\nfunc (self *ClassReader) readUint8() uint8 {\n\tval := self.data[0] //è¯»å–1Byte\n\tself.data = self.data[1:]\n\treturn val\n}\n\n// u2\nfunc (self *ClassReader) readUint16() uint16 {\n\tval := binary.BigEndian.Uint16(self.data) //è¯»å–2Byteå¹¶è½¬ä¸ºuint16\n\tself.data = self.data[2:]\n\treturn val\n}\n\n// u4\nfunc (self *ClassReader) readUint32() uint32 {\n\tval := binary.BigEndian.Uint32(self.data) //è¯»å–4Byteå¹¶è½¬ä¸ºuint32\n\tself.data = self.data[4:]\n\treturn val\n}\n\nfunc (self *ClassReader) readUint64() uint64 {\n\tval := binary.BigEndian.Uint64(self.data) //è¯»å–8Byteå¹¶è½¬ä¸ºuint64\n\tself.data = self.data[8:]\n\treturn val\n}\n\nfunc (self *ClassReader) readUint16s() []uint16 {\n\tn := self.readUint16() //è¯»å–2Byteï¼Œè¯¥å€¼ä¸ºåç»­æ•°ç»„çš„é•¿åº¦\n\ts := make([]uint16, n) //ç”Ÿäº§é•¿åº¦ä¸ºnçš„uint16ç±»å‹æ•°ç»„\n\tfor i := range s {\n\t\ts[i] = self.readUint16() //è¯»å–classæ–‡ä»¶ï¼Œæ¯è¯»å–2Byteä¾¿æ”¾å…¥æ•°ç»„\n\t}\n\treturn s\n}\n\nfunc (self *ClassReader) readBytes(n uint32) []byte {\n\tbytes := self.data[:n] //è¯»å–é•¿åº¦ä¸ºnçš„å­—èŠ‚\n\tself.data = self.data[n:]\n\treturn bytes\n}\n{% endcodeblock %}\n\n1. å®šä¹‰Classæ–‡ä»¶çš„æ ¼å¼(ClassFile)\n\n{% codeblock lang:golang %}\ntype ClassFile struct { //æŒ‰ç…§jvmè§„èŒƒï¼Œå®šä¹‰classæ–‡ä»¶ç»“æ„\n\t//magic      uint32\n\tminorVersion uint16\n\tmajorVersion uint16\n\tconstantPool ConstantPool\n\taccessFlags  uint16\n\tthisClass    uint16\n\tsuperClass   uint16\n\tinterfaces   []uint16\n\tfields       []*MemberInfo\n\tmethods      []*MemberInfo\n\tattributes   []AttributeInfo\n}\n\n//æ–‡ä»¶è§£æå…¥å£æ–¹æ³•ï¼Œå…¥å‚classæ–‡ä»¶æµï¼Œè¿”å›classæ–‡ä»¶å¯¹è±¡\nfunc Parse(classData []byte) (cf *ClassFile, err error) {\n\tdefer func() { //æ•è·å¼‚å¸¸\n\t\tif r := recover(); r != nil {\n\t\t\tvar ok bool\n\t\t\terr, ok = r.(error)\n\t\t\tif !ok {\n\t\t\t\terr = fmt.Errorf(\"%v\", r)\n\t\t\t}\n\t\t}\n\t}()\n\n\tcr := &ClassReader{classData} //å®ä¾‹åŒ–classReaderç±»\n\tcf = &ClassFile{} //å®ä¾‹åŒ–ClassFileç±»\n\tcf.read(cr) //è¯»å–classæ–‡ä»¶\n\treturn\n}\n\n//è¯»å–classæ–‡ä»¶çš„å…·ä½“æ–¹æ³•\nfunc (self *ClassFile) read(reader *ClassReader) {\n\tself.readAndCheckMagic(reader) //è¯»å–é­”æ•°\n\tself.readAndCheckVersion(reader) //è¯»å–ä¸»æ¬¡ç‰ˆæœ¬å·\n\tself.constantPool = readConstantPool(reader) //è¯»å–å¸¸é‡æ± \n\tself.accessFlags = reader.readUint16() //è¯»å–å½“å‰ç±»ï¼ˆæˆ–è€…æ¥å£ï¼‰çš„è®¿é—®ä¿®é¥°ç¬¦\n\tself.thisClass = reader.readUint16() //è¯»å–å½“å‰ç±»ç´¢å¼•\n\tself.superClass = reader.readUint16() //è¯»å–çˆ¶ç±»ç´¢å¼•\n\tself.interfaces = reader.readUint16s() //è¯»å–æ‰€æœ‰æ¥å£ç´¢å¼•\n\tself.fields = readMembers(reader, self.constantPool) //ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æˆå‘˜\n\tself.methods = readMembers(reader, self.constantPool) //ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æ–¹æ³•\n\tself.attributes = readAttributes(reader, self.constantPool) //ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰å±æ€§\n}\n\nfunc (self *ClassFile) readAndCheckMagic(reader *ClassReader) {\n\tmagic := reader.readUint32() //è¯»å–4Byteé­”æ•°\n\tif magic != 0xCAFEBABE { //åˆ¤æ–­é­”æ•°æ˜¯å¦ä¸º0xCAFEBABE\n\t\tpanic(\"java.lang.ClassFormatError: magic!\")\n\t}\n}\n\nfunc (self *ClassFile) readAndCheckVersion(reader *ClassReader) {\n\tself.minorVersion = reader.readUint16() //é«˜2Byteä¸ºæ¬¡ç‰ˆæœ¬å·\n\tself.majorVersion = reader.readUint16() //ä½2Byteä¸ºä¸»ç‰ˆæœ¬å·\n\tswitch self.majorVersion { //æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¸º45~52\n\tcase 45:\n\t\treturn\n\tcase 46, 47, 48, 49, 50, 51, 52:\n\t\tif self.minorVersion == 0 {\n\t\t\treturn\n\t\t}\n\t}\n\n\tpanic(\"java.lang.UnsupportedClassVersionError!\")\n}\n\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) MinorVersion() uint16 {\n\treturn self.minorVersion\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) MajorVersion() uint16 {\n\treturn self.majorVersion\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) ConstantPool() ConstantPool {\n\treturn self.constantPool\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) AccessFlags() uint16 {\n\treturn self.accessFlags\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) Fields() []*MemberInfo {\n\treturn self.fields\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) Methods() []*MemberInfo {\n\treturn self.methods\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®thisClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°\nfunc (self *ClassFile) ClassName() string {\n\treturn self.constantPool.getClassName(self.thisClass)\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®superClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°\nfunc (self *ClassFile) SuperClassName() string {\n\tif self.superClass > 0 {\n\t\treturn self.constantPool.getClassName(self.superClass)\n\t}\n\treturn \"\"\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®interfacesç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°\nfunc (self *ClassFile) InterfaceNames() []string {\n\tinterfaceNames := make([]string, len(self.interfaces))\n\tfor i, cpIndex := range self.interfaces {\n\t\tinterfaceNames[i] = self.constantPool.getClassName(cpIndex)\n\t}\n\treturn interfaceNames\n}\n{% endcodeblock %}\n\n1. å®šä¹‰å­—æ®µå’Œæ–¹æ³•çš„ç»“æ„(field_infoã€method_info)\n\n{% codeblock lang:golang %}\ntype MemberInfo struct { //fieldå’Œmethodçš„ç»“æ„ç±»å‹ï¼Œä½¿ç”¨åŒä¸€ä¸ªç»“æ„\n\tcp              ConstantPool //å½“å‰å¸¸é‡æ± \n\taccessFlags     uint16 //è®¿é—®æ ‡å¿—\n\tnameIndex       uint16 //åç§°ç´¢å¼•\n\tdescriptorIndex uint16 //æè¿°ç´¢å¼•\n\tattributes      []AttributeInfo //å±æ€§åˆ—è¡¨ \n}\n\n// read field or method table\nfunc readMembers(reader *ClassReader, cp ConstantPool) []*MemberInfo {\n\tmemberCount := reader.readUint16() //è¯»å–fieldæˆ–methodæ•°é‡\n\tmembers := make([]*MemberInfo, memberCount) //åˆ›å»ºæ•°ç»„\n\tfor i := range members {\n\t\tmembers[i] = readMember(reader, cp)\n\t}\n\treturn members\n}\n\n//å…·ä½“è¯»å–fieldå’Œmethodçš„æ–¹æ³•\nfunc readMember(reader *ClassReader, cp ConstantPool) *MemberInfo {\n\treturn &MemberInfo{\n\t\tcp:              cp,\n\t\taccessFlags:     reader.readUint16(), //è¯»å–2Byteçš„è®¿é—®æ§åˆ¶ç¬¦\n\t\tnameIndex:       reader.readUint16(), //è¯»å–2Byteçš„åç§°ç´¢å¼•\n\t\tdescriptorIndex: reader.readUint16(), //è¯»å–2Byteçš„æè¿°ç´¢å¼•\n\t\tattributes:      readAttributes(reader, cp), //è¯»å–å±æ€§åˆ—è¡¨\n\t}\n}\n\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *MemberInfo) AccessFlags() uint16 {\n\treturn self.accessFlags\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡åç§°ç´¢å¼•è®¿é—®å¸¸é‡æ± \nfunc (self *MemberInfo) Name() string {\n\treturn self.cp.getUtf8(self.nameIndex)\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡æè¿°ç´¢å¼•è®¿é—®å¸¸é‡æ± \nfunc (self *MemberInfo) Descriptor() string {\n\treturn self.cp.getUtf8(self.descriptorIndex)\n}\n\n{% endcodeblock %}","source":"_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°3.md","raw":"---\ntitle: è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°3\ndate: 2019-09-13 18:44:38\ntags: \n    - JVM\n    - Java\n    - Go\ncategories :\n    - Technology\n---\n\nç¬¬ä¸‰ç¯‡ä¸»è¦å­¦ä¹ JVMä¸­classæ–‡ä»¶çš„å…·ä½“ç»“æ„ï¼Œå’ŒJVMæ˜¯å¦‚ä½•è§£æè¿™äº›ç»“æ„çš„ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡javacå·¥å…·å°†ä¸€ä¸ªjavaæ–‡ä»¶compileæˆä¸€ä¸ª.classæ–‡ä»¶ï¼Œå¹¶é€šè¿‡æˆ‘ä»¬è‡ªå·±å†™çš„jvmå°†è¯¥æ–‡ä»¶è§£æå¹¶æ‰“å°å‡ºæ¥ã€‚é€šè¿‡classæ–‡ä»¶çš„å­¦ä¹ èƒ½è®©æˆ‘ä»¬æ›´åŠ æ·±åˆ»çš„ç†è§£javaæ˜¯æ€æ ·å®ç°è·¨å¹³å°ï¼Œå¹¶ä¸”æˆ‘ä»¬ç¼–å†™çš„javaä»£ç åˆæ˜¯å¦‚ä½•åœ¨JVMä¸­ä½“ç°çš„ã€‚\n<!-- more -->\n\n### JVMä¸­classæ–‡ä»¶ç»“æ„(ClassFile)\nLength|name\n---|---\nu4|magic\nu2|minor_version\nu2|major_version\nu2|constant_pool_count\ncp_info|constant_pool[constant_pool_count-1]\nu2|access_flags\nu2|this_class\nu2|super_class\nu2|interfaces_count\nu2|interfaces[interfaces_count]\nu2|fields_count\nfield_info|fields[fields_count]\nu2|methods_count\nmethod_info|methods[methods_count]\n\n### JVMä¸­å­—æ®µç»“æ„(field_info)\nLength|name\n---|---\nu2|access_flags\nu2|name_index\nu2|descriptor_index\nu2|attributes_count\nattribute_info|attributes[attributes_count]\n\n### JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„(access_flags)\næ ‡å¿—å|æ ‡å¿—å€¼|æ ‡å¿—å«ä¹‰|é’ˆå¯¹çš„å¯¹è±¡\n---|---|---|---\nACC_PUBLIC|0x0001|publicç±»å‹|æ‰€æœ‰ç±»å‹\nACC_FINAL|0x0010|finalç±»å‹|ç±»\nACC_SUPER|0x0020|ä½¿ç”¨æ–°çš„invokespecialè¯­ä¹‰|ç±»å’Œæ¥å£\nACC_INTERFACE|0x0200|æ¥å£ç±»å‹|æ¥å£\nACC_ABSTRACT|0x0400|æŠ½è±¡ç±»å‹|ç±»å’Œæ¥å£\nACC_SYNTHETIC|0x1000|è¯¥ç±»ä¸ç”±ç”¨æˆ·ä»£ç ç”Ÿæˆ|æ‰€æœ‰ç±»å‹\nACC_ANNOTATION|0x2000|æ³¨è§£ç±»å‹|æ³¨è§£\nACC_ENUM|0x4000|æšä¸¾ç±»å‹|æšä¸¾\n\n### å®ç°\n1. å®šä¹‰Classæ–‡ä»¶çš„å½•å–ç±»(ClassReader)\n\n{% codeblock lang:golang %}\ntype ClassReader struct {\n\tdata []byte //classæ–‡ä»¶å­—èŠ‚æµ\n}\n\n// è¯»å–u1\nfunc (self *ClassReader) readUint8() uint8 {\n\tval := self.data[0] //è¯»å–1Byte\n\tself.data = self.data[1:]\n\treturn val\n}\n\n// u2\nfunc (self *ClassReader) readUint16() uint16 {\n\tval := binary.BigEndian.Uint16(self.data) //è¯»å–2Byteå¹¶è½¬ä¸ºuint16\n\tself.data = self.data[2:]\n\treturn val\n}\n\n// u4\nfunc (self *ClassReader) readUint32() uint32 {\n\tval := binary.BigEndian.Uint32(self.data) //è¯»å–4Byteå¹¶è½¬ä¸ºuint32\n\tself.data = self.data[4:]\n\treturn val\n}\n\nfunc (self *ClassReader) readUint64() uint64 {\n\tval := binary.BigEndian.Uint64(self.data) //è¯»å–8Byteå¹¶è½¬ä¸ºuint64\n\tself.data = self.data[8:]\n\treturn val\n}\n\nfunc (self *ClassReader) readUint16s() []uint16 {\n\tn := self.readUint16() //è¯»å–2Byteï¼Œè¯¥å€¼ä¸ºåç»­æ•°ç»„çš„é•¿åº¦\n\ts := make([]uint16, n) //ç”Ÿäº§é•¿åº¦ä¸ºnçš„uint16ç±»å‹æ•°ç»„\n\tfor i := range s {\n\t\ts[i] = self.readUint16() //è¯»å–classæ–‡ä»¶ï¼Œæ¯è¯»å–2Byteä¾¿æ”¾å…¥æ•°ç»„\n\t}\n\treturn s\n}\n\nfunc (self *ClassReader) readBytes(n uint32) []byte {\n\tbytes := self.data[:n] //è¯»å–é•¿åº¦ä¸ºnçš„å­—èŠ‚\n\tself.data = self.data[n:]\n\treturn bytes\n}\n{% endcodeblock %}\n\n1. å®šä¹‰Classæ–‡ä»¶çš„æ ¼å¼(ClassFile)\n\n{% codeblock lang:golang %}\ntype ClassFile struct { //æŒ‰ç…§jvmè§„èŒƒï¼Œå®šä¹‰classæ–‡ä»¶ç»“æ„\n\t//magic      uint32\n\tminorVersion uint16\n\tmajorVersion uint16\n\tconstantPool ConstantPool\n\taccessFlags  uint16\n\tthisClass    uint16\n\tsuperClass   uint16\n\tinterfaces   []uint16\n\tfields       []*MemberInfo\n\tmethods      []*MemberInfo\n\tattributes   []AttributeInfo\n}\n\n//æ–‡ä»¶è§£æå…¥å£æ–¹æ³•ï¼Œå…¥å‚classæ–‡ä»¶æµï¼Œè¿”å›classæ–‡ä»¶å¯¹è±¡\nfunc Parse(classData []byte) (cf *ClassFile, err error) {\n\tdefer func() { //æ•è·å¼‚å¸¸\n\t\tif r := recover(); r != nil {\n\t\t\tvar ok bool\n\t\t\terr, ok = r.(error)\n\t\t\tif !ok {\n\t\t\t\terr = fmt.Errorf(\"%v\", r)\n\t\t\t}\n\t\t}\n\t}()\n\n\tcr := &ClassReader{classData} //å®ä¾‹åŒ–classReaderç±»\n\tcf = &ClassFile{} //å®ä¾‹åŒ–ClassFileç±»\n\tcf.read(cr) //è¯»å–classæ–‡ä»¶\n\treturn\n}\n\n//è¯»å–classæ–‡ä»¶çš„å…·ä½“æ–¹æ³•\nfunc (self *ClassFile) read(reader *ClassReader) {\n\tself.readAndCheckMagic(reader) //è¯»å–é­”æ•°\n\tself.readAndCheckVersion(reader) //è¯»å–ä¸»æ¬¡ç‰ˆæœ¬å·\n\tself.constantPool = readConstantPool(reader) //è¯»å–å¸¸é‡æ± \n\tself.accessFlags = reader.readUint16() //è¯»å–å½“å‰ç±»ï¼ˆæˆ–è€…æ¥å£ï¼‰çš„è®¿é—®ä¿®é¥°ç¬¦\n\tself.thisClass = reader.readUint16() //è¯»å–å½“å‰ç±»ç´¢å¼•\n\tself.superClass = reader.readUint16() //è¯»å–çˆ¶ç±»ç´¢å¼•\n\tself.interfaces = reader.readUint16s() //è¯»å–æ‰€æœ‰æ¥å£ç´¢å¼•\n\tself.fields = readMembers(reader, self.constantPool) //ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æˆå‘˜\n\tself.methods = readMembers(reader, self.constantPool) //ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æ–¹æ³•\n\tself.attributes = readAttributes(reader, self.constantPool) //ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰å±æ€§\n}\n\nfunc (self *ClassFile) readAndCheckMagic(reader *ClassReader) {\n\tmagic := reader.readUint32() //è¯»å–4Byteé­”æ•°\n\tif magic != 0xCAFEBABE { //åˆ¤æ–­é­”æ•°æ˜¯å¦ä¸º0xCAFEBABE\n\t\tpanic(\"java.lang.ClassFormatError: magic!\")\n\t}\n}\n\nfunc (self *ClassFile) readAndCheckVersion(reader *ClassReader) {\n\tself.minorVersion = reader.readUint16() //é«˜2Byteä¸ºæ¬¡ç‰ˆæœ¬å·\n\tself.majorVersion = reader.readUint16() //ä½2Byteä¸ºä¸»ç‰ˆæœ¬å·\n\tswitch self.majorVersion { //æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¸º45~52\n\tcase 45:\n\t\treturn\n\tcase 46, 47, 48, 49, 50, 51, 52:\n\t\tif self.minorVersion == 0 {\n\t\t\treturn\n\t\t}\n\t}\n\n\tpanic(\"java.lang.UnsupportedClassVersionError!\")\n}\n\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) MinorVersion() uint16 {\n\treturn self.minorVersion\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) MajorVersion() uint16 {\n\treturn self.majorVersion\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) ConstantPool() ConstantPool {\n\treturn self.constantPool\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) AccessFlags() uint16 {\n\treturn self.accessFlags\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) Fields() []*MemberInfo {\n\treturn self.fields\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *ClassFile) Methods() []*MemberInfo {\n\treturn self.methods\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®thisClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°\nfunc (self *ClassFile) ClassName() string {\n\treturn self.constantPool.getClassName(self.thisClass)\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®superClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°\nfunc (self *ClassFile) SuperClassName() string {\n\tif self.superClass > 0 {\n\t\treturn self.constantPool.getClassName(self.superClass)\n\t}\n\treturn \"\"\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®interfacesç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°\nfunc (self *ClassFile) InterfaceNames() []string {\n\tinterfaceNames := make([]string, len(self.interfaces))\n\tfor i, cpIndex := range self.interfaces {\n\t\tinterfaceNames[i] = self.constantPool.getClassName(cpIndex)\n\t}\n\treturn interfaceNames\n}\n{% endcodeblock %}\n\n1. å®šä¹‰å­—æ®µå’Œæ–¹æ³•çš„ç»“æ„(field_infoã€method_info)\n\n{% codeblock lang:golang %}\ntype MemberInfo struct { //fieldå’Œmethodçš„ç»“æ„ç±»å‹ï¼Œä½¿ç”¨åŒä¸€ä¸ªç»“æ„\n\tcp              ConstantPool //å½“å‰å¸¸é‡æ± \n\taccessFlags     uint16 //è®¿é—®æ ‡å¿—\n\tnameIndex       uint16 //åç§°ç´¢å¼•\n\tdescriptorIndex uint16 //æè¿°ç´¢å¼•\n\tattributes      []AttributeInfo //å±æ€§åˆ—è¡¨ \n}\n\n// read field or method table\nfunc readMembers(reader *ClassReader, cp ConstantPool) []*MemberInfo {\n\tmemberCount := reader.readUint16() //è¯»å–fieldæˆ–methodæ•°é‡\n\tmembers := make([]*MemberInfo, memberCount) //åˆ›å»ºæ•°ç»„\n\tfor i := range members {\n\t\tmembers[i] = readMember(reader, cp)\n\t}\n\treturn members\n}\n\n//å…·ä½“è¯»å–fieldå’Œmethodçš„æ–¹æ³•\nfunc readMember(reader *ClassReader, cp ConstantPool) *MemberInfo {\n\treturn &MemberInfo{\n\t\tcp:              cp,\n\t\taccessFlags:     reader.readUint16(), //è¯»å–2Byteçš„è®¿é—®æ§åˆ¶ç¬¦\n\t\tnameIndex:       reader.readUint16(), //è¯»å–2Byteçš„åç§°ç´¢å¼•\n\t\tdescriptorIndex: reader.readUint16(), //è¯»å–2Byteçš„æè¿°ç´¢å¼•\n\t\tattributes:      readAttributes(reader, cp), //è¯»å–å±æ€§åˆ—è¡¨\n\t}\n}\n\n//å¯¹å¤–æš´éœ²getæ–¹æ³•\nfunc (self *MemberInfo) AccessFlags() uint16 {\n\treturn self.accessFlags\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡åç§°ç´¢å¼•è®¿é—®å¸¸é‡æ± \nfunc (self *MemberInfo) Name() string {\n\treturn self.cp.getUtf8(self.nameIndex)\n}\n//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡æè¿°ç´¢å¼•è®¿é—®å¸¸é‡æ± \nfunc (self *MemberInfo) Descriptor() string {\n\treturn self.cp.getUtf8(self.descriptorIndex)\n}\n\n{% endcodeblock %}","slug":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°3","published":1,"updated":"2020-12-14T09:51:24.056Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htw001uv2525k2udzt3","content":"<html><head></head><body><p>&#x7B2C;&#x4E09;&#x7BC7;&#x4E3B;&#x8981;&#x5B66;&#x4E60;JVM&#x4E2D;class&#x6587;&#x4EF6;&#x7684;&#x5177;&#x4F53;&#x7ED3;&#x6784;&#xFF0C;&#x548C;JVM&#x662F;&#x5982;&#x4F55;&#x89E3;&#x6790;&#x8FD9;&#x4E9B;&#x7ED3;&#x6784;&#x7684;&#x3002;<br>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;javac&#x5DE5;&#x5177;&#x5C06;&#x4E00;&#x4E2A;java&#x6587;&#x4EF6;compile&#x6210;&#x4E00;&#x4E2A;.class&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x5199;&#x7684;jvm&#x5C06;&#x8BE5;&#x6587;&#x4EF6;&#x89E3;&#x6790;&#x5E76;&#x6253;&#x5370;&#x51FA;&#x6765;&#x3002;&#x901A;&#x8FC7;class&#x6587;&#x4EF6;&#x7684;&#x5B66;&#x4E60;&#x80FD;&#x8BA9;&#x6211;&#x4EEC;&#x66F4;&#x52A0;&#x6DF1;&#x523B;&#x7684;&#x7406;&#x89E3;java&#x662F;&#x600E;&#x6837;&#x5B9E;&#x73B0;&#x8DE8;&#x5E73;&#x53F0;&#xFF0C;&#x5E76;&#x4E14;&#x6211;&#x4EEC;&#x7F16;&#x5199;&#x7684;java&#x4EE3;&#x7801;&#x53C8;&#x662F;&#x5982;&#x4F55;&#x5728;JVM&#x4E2D;&#x4F53;&#x73B0;&#x7684;&#x3002;</p>\n<a id=\"more\"></a>\n\n<h3 id=\"JVM&#x4E2D;class&#x6587;&#x4EF6;&#x7ED3;&#x6784;-ClassFile\"><a href=\"#JVM&#x4E2D;class&#x6587;&#x4EF6;&#x7ED3;&#x6784;-ClassFile\" class=\"headerlink\" title=\"JVM&#x4E2D;class&#x6587;&#x4EF6;&#x7ED3;&#x6784;(ClassFile)\"></a>JVM&#x4E2D;class&#x6587;&#x4EF6;&#x7ED3;&#x6784;(ClassFile)</h3><table>\n<thead>\n<tr>\n<th>Length</th>\n<th>name</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>u4</td>\n<td>magic</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>minor_version</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>major_version</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>constant_pool_count</td>\n</tr>\n<tr>\n<td>cp_info</td>\n<td>constant_pool[constant_pool_count-1]</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>access_flags</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>this_class</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>super_class</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>interfaces_count</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>interfaces[interfaces_count]</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>fields_count</td>\n</tr>\n<tr>\n<td>field_info</td>\n<td>fields[fields_count]</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>methods_count</td>\n</tr>\n<tr>\n<td>method_info</td>\n<td>methods[methods_count]</td>\n</tr>\n</tbody></table>\n<h3 id=\"JVM&#x4E2D;&#x5B57;&#x6BB5;&#x7ED3;&#x6784;-field-info\"><a href=\"#JVM&#x4E2D;&#x5B57;&#x6BB5;&#x7ED3;&#x6784;-field-info\" class=\"headerlink\" title=\"JVM&#x4E2D;&#x5B57;&#x6BB5;&#x7ED3;&#x6784;(field_info)\"></a>JVM&#x4E2D;&#x5B57;&#x6BB5;&#x7ED3;&#x6784;(field_info)</h3><table>\n<thead>\n<tr>\n<th>Length</th>\n<th>name</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>u2</td>\n<td>access_flags</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>name_index</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>descriptor_index</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>attributes_count</td>\n</tr>\n<tr>\n<td>attribute_info</td>\n<td>attributes[attributes_count]</td>\n</tr>\n</tbody></table>\n<h3 id=\"JVM&#x4E2D;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x7B26;&#x7ED3;&#x6784;-access-flags\"><a href=\"#JVM&#x4E2D;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x7B26;&#x7ED3;&#x6784;-access-flags\" class=\"headerlink\" title=\"JVM&#x4E2D;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x7B26;&#x7ED3;&#x6784;(access_flags)\"></a>JVM&#x4E2D;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x7B26;&#x7ED3;&#x6784;(access_flags)</h3><table>\n<thead>\n<tr>\n<th>&#x6807;&#x5FD7;&#x540D;</th>\n<th>&#x6807;&#x5FD7;&#x503C;</th>\n<th>&#x6807;&#x5FD7;&#x542B;&#x4E49;</th>\n<th>&#x9488;&#x5BF9;&#x7684;&#x5BF9;&#x8C61;</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>ACC_PUBLIC</td>\n<td>0x0001</td>\n<td>public&#x7C7B;&#x578B;</td>\n<td>&#x6240;&#x6709;&#x7C7B;&#x578B;</td>\n</tr>\n<tr>\n<td>ACC_FINAL</td>\n<td>0x0010</td>\n<td>final&#x7C7B;&#x578B;</td>\n<td>&#x7C7B;</td>\n</tr>\n<tr>\n<td>ACC_SUPER</td>\n<td>0x0020</td>\n<td>&#x4F7F;&#x7528;&#x65B0;&#x7684;invokespecial&#x8BED;&#x4E49;</td>\n<td>&#x7C7B;&#x548C;&#x63A5;&#x53E3;</td>\n</tr>\n<tr>\n<td>ACC_INTERFACE</td>\n<td>0x0200</td>\n<td>&#x63A5;&#x53E3;&#x7C7B;&#x578B;</td>\n<td>&#x63A5;&#x53E3;</td>\n</tr>\n<tr>\n<td>ACC_ABSTRACT</td>\n<td>0x0400</td>\n<td>&#x62BD;&#x8C61;&#x7C7B;&#x578B;</td>\n<td>&#x7C7B;&#x548C;&#x63A5;&#x53E3;</td>\n</tr>\n<tr>\n<td>ACC_SYNTHETIC</td>\n<td>0x1000</td>\n<td>&#x8BE5;&#x7C7B;&#x4E0D;&#x7531;&#x7528;&#x6237;&#x4EE3;&#x7801;&#x751F;&#x6210;</td>\n<td>&#x6240;&#x6709;&#x7C7B;&#x578B;</td>\n</tr>\n<tr>\n<td>ACC_ANNOTATION</td>\n<td>0x2000</td>\n<td>&#x6CE8;&#x89E3;&#x7C7B;&#x578B;</td>\n<td>&#x6CE8;&#x89E3;</td>\n</tr>\n<tr>\n<td>ACC_ENUM</td>\n<td>0x4000</td>\n<td>&#x679A;&#x4E3E;&#x7C7B;&#x578B;</td>\n<td>&#x679A;&#x4E3E;</td>\n</tr>\n</tbody></table>\n<h3 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h3><ol>\n<li>&#x5B9A;&#x4E49;Class&#x6587;&#x4EF6;&#x7684;&#x5F55;&#x53D6;&#x7C7B;(ClassReader)</li>\n</ol>\n<figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> ClassReader <span class=\"hljs-keyword\">struct</span> {</span><br><span class=\"line\">\tdata []<span class=\"hljs-keyword\">byte</span> <span class=\"hljs-comment\">//class&#x6587;&#x4EF6;&#x5B57;&#x8282;&#x6D41;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// &#x8BFB;&#x53D6;u1</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassReader)</span> <span class=\"hljs-title\">readUint8</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint8</span></span> {</span><br><span class=\"line\">\tval := self.data[<span class=\"hljs-number\">0</span>] <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;1Byte</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"hljs-number\">1</span>:]</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> val</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// u2</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassReader)</span> <span class=\"hljs-title\">readUint16</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint16</span></span> {</span><br><span class=\"line\">\tval := binary.BigEndian.Uint16(self.data) <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;2Byte&#x5E76;&#x8F6C;&#x4E3A;uint16</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"hljs-number\">2</span>:]</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> val</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// u4</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassReader)</span> <span class=\"hljs-title\">readUint32</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint32</span></span> {</span><br><span class=\"line\">\tval := binary.BigEndian.Uint32(self.data) <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;4Byte&#x5E76;&#x8F6C;&#x4E3A;uint32</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"hljs-number\">4</span>:]</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> val</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassReader)</span> <span class=\"hljs-title\">readUint64</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint64</span></span> {</span><br><span class=\"line\">\tval := binary.BigEndian.Uint64(self.data) <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;8Byte&#x5E76;&#x8F6C;&#x4E3A;uint64</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"hljs-number\">8</span>:]</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> val</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassReader)</span> <span class=\"hljs-title\">readUint16s</span><span class=\"hljs-params\">()</span> []<span class=\"hljs-title\">uint16</span></span> {</span><br><span class=\"line\">\tn := self.readUint16() <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;2Byte&#xFF0C;&#x8BE5;&#x503C;&#x4E3A;&#x540E;&#x7EED;&#x6570;&#x7EC4;&#x7684;&#x957F;&#x5EA6;</span></span><br><span class=\"line\">\ts := <span class=\"hljs-built_in\">make</span>([]<span class=\"hljs-keyword\">uint16</span>, n) <span class=\"hljs-comment\">//&#x751F;&#x4EA7;&#x957F;&#x5EA6;&#x4E3A;n&#x7684;uint16&#x7C7B;&#x578B;&#x6570;&#x7EC4;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> i := <span class=\"hljs-keyword\">range</span> s {</span><br><span class=\"line\">\t\ts[i] = self.readUint16() <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;class&#x6587;&#x4EF6;&#xFF0C;&#x6BCF;&#x8BFB;&#x53D6;2Byte&#x4FBF;&#x653E;&#x5165;&#x6570;&#x7EC4;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> s</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassReader)</span> <span class=\"hljs-title\">readBytes</span><span class=\"hljs-params\">(n <span class=\"hljs-keyword\">uint32</span>)</span> []<span class=\"hljs-title\">byte</span></span> {</span><br><span class=\"line\">\tbytes := self.data[:n] <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;&#x957F;&#x5EA6;&#x4E3A;n&#x7684;&#x5B57;&#x8282;</span></span><br><span class=\"line\">\tself.data = self.data[n:]</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> bytes</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<ol>\n<li>&#x5B9A;&#x4E49;Class&#x6587;&#x4EF6;&#x7684;&#x683C;&#x5F0F;(ClassFile)</li>\n</ol>\n<figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> ClassFile <span class=\"hljs-keyword\">struct</span> { <span class=\"hljs-comment\">//&#x6309;&#x7167;jvm&#x89C4;&#x8303;&#xFF0C;&#x5B9A;&#x4E49;class&#x6587;&#x4EF6;&#x7ED3;&#x6784;</span></span><br><span class=\"line\">\t<span class=\"hljs-comment\">//magic      uint32</span></span><br><span class=\"line\">\tminorVersion <span class=\"hljs-keyword\">uint16</span></span><br><span class=\"line\">\tmajorVersion <span class=\"hljs-keyword\">uint16</span></span><br><span class=\"line\">\tconstantPool ConstantPool</span><br><span class=\"line\">\taccessFlags  <span class=\"hljs-keyword\">uint16</span></span><br><span class=\"line\">\tthisClass    <span class=\"hljs-keyword\">uint16</span></span><br><span class=\"line\">\tsuperClass   <span class=\"hljs-keyword\">uint16</span></span><br><span class=\"line\">\tinterfaces   []<span class=\"hljs-keyword\">uint16</span></span><br><span class=\"line\">\tfields       []*MemberInfo</span><br><span class=\"line\">\tmethods      []*MemberInfo</span><br><span class=\"line\">\tattributes   []AttributeInfo</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x6587;&#x4EF6;&#x89E3;&#x6790;&#x5165;&#x53E3;&#x65B9;&#x6CD5;&#xFF0C;&#x5165;&#x53C2;class&#x6587;&#x4EF6;&#x6D41;&#xFF0C;&#x8FD4;&#x56DE;class&#x6587;&#x4EF6;&#x5BF9;&#x8C61;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">Parse</span><span class=\"hljs-params\">(classData []<span class=\"hljs-keyword\">byte</span>)</span> <span class=\"hljs-params\">(cf *ClassFile, err error)</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">defer</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span><span class=\"hljs-params\">()</span></span> { <span class=\"hljs-comment\">//&#x6355;&#x83B7;&#x5F02;&#x5E38;</span></span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> r := <span class=\"hljs-built_in\">recover</span>(); r != <span class=\"hljs-literal\">nil</span> {</span><br><span class=\"line\">\t\t\t<span class=\"hljs-keyword\">var</span> ok <span class=\"hljs-keyword\">bool</span></span><br><span class=\"line\">\t\t\terr, ok = r.(error)</span><br><span class=\"line\">\t\t\t<span class=\"hljs-keyword\">if</span> !ok {</span><br><span class=\"line\">\t\t\t\terr = fmt.Errorf(<span class=\"hljs-string\">&quot;%v&quot;</span>, r)</span><br><span class=\"line\">\t\t\t}</span><br><span class=\"line\">\t\t}</span><br><span class=\"line\">\t}()</span><br><span class=\"line\"></span><br><span class=\"line\">\tcr := &amp;ClassReader{classData} <span class=\"hljs-comment\">//&#x5B9E;&#x4F8B;&#x5316;classReader&#x7C7B;</span></span><br><span class=\"line\">\tcf = &amp;ClassFile{} <span class=\"hljs-comment\">//&#x5B9E;&#x4F8B;&#x5316;ClassFile&#x7C7B;</span></span><br><span class=\"line\">\tcf.read(cr) <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;class&#x6587;&#x4EF6;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x8BFB;&#x53D6;class&#x6587;&#x4EF6;&#x7684;&#x5177;&#x4F53;&#x65B9;&#x6CD5;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">read</span><span class=\"hljs-params\">(reader *ClassReader)</span></span> {</span><br><span class=\"line\">\tself.readAndCheckMagic(reader) <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;&#x9B54;&#x6570;</span></span><br><span class=\"line\">\tself.readAndCheckVersion(reader) <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;&#x4E3B;&#x6B21;&#x7248;&#x672C;&#x53F7;</span></span><br><span class=\"line\">\tself.constantPool = readConstantPool(reader) <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;&#x5E38;&#x91CF;&#x6C60;</span></span><br><span class=\"line\">\tself.accessFlags = reader.readUint16() <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;&#x5F53;&#x524D;&#x7C7B;&#xFF08;&#x6216;&#x8005;&#x63A5;&#x53E3;&#xFF09;&#x7684;&#x8BBF;&#x95EE;&#x4FEE;&#x9970;&#x7B26;</span></span><br><span class=\"line\">\tself.thisClass = reader.readUint16() <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;&#x5F53;&#x524D;&#x7C7B;&#x7D22;&#x5F15;</span></span><br><span class=\"line\">\tself.superClass = reader.readUint16() <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;&#x7236;&#x7C7B;&#x7D22;&#x5F15;</span></span><br><span class=\"line\">\tself.interfaces = reader.readUint16s() <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;&#x6240;&#x6709;&#x63A5;&#x53E3;&#x7D22;&#x5F15;</span></span><br><span class=\"line\">\tself.fields = readMembers(reader, self.constantPool) <span class=\"hljs-comment\">//&#x4ECE;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x8BFB;&#x53D6;&#x6240;&#x6709;&#x6210;&#x5458;</span></span><br><span class=\"line\">\tself.methods = readMembers(reader, self.constantPool) <span class=\"hljs-comment\">//&#x4ECE;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x8BFB;&#x53D6;&#x6240;&#x6709;&#x65B9;&#x6CD5;</span></span><br><span class=\"line\">\tself.attributes = readAttributes(reader, self.constantPool) <span class=\"hljs-comment\">//&#x4ECE;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x8BFB;&#x53D6;&#x6240;&#x6709;&#x5C5E;&#x6027;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">readAndCheckMagic</span><span class=\"hljs-params\">(reader *ClassReader)</span></span> {</span><br><span class=\"line\">\tmagic := reader.readUint32() <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;4Byte&#x9B54;&#x6570;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> magic != <span class=\"hljs-number\">0xCAFEBABE</span> { <span class=\"hljs-comment\">//&#x5224;&#x65AD;&#x9B54;&#x6570;&#x662F;&#x5426;&#x4E3A;0xCAFEBABE</span></span><br><span class=\"line\">\t\t<span class=\"hljs-built_in\">panic</span>(<span class=\"hljs-string\">&quot;java.lang.ClassFormatError: magic!&quot;</span>)</span><br><span class=\"line\">\t}</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">readAndCheckVersion</span><span class=\"hljs-params\">(reader *ClassReader)</span></span> {</span><br><span class=\"line\">\tself.minorVersion = reader.readUint16() <span class=\"hljs-comment\">//&#x9AD8;2Byte&#x4E3A;&#x6B21;&#x7248;&#x672C;&#x53F7;</span></span><br><span class=\"line\">\tself.majorVersion = reader.readUint16() <span class=\"hljs-comment\">//&#x4F4E;2Byte&#x4E3A;&#x4E3B;&#x7248;&#x672C;&#x53F7;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">switch</span> self.majorVersion { <span class=\"hljs-comment\">//&#x68C0;&#x67E5;&#x7248;&#x672C;&#x53F7;&#x662F;&#x5426;&#x4E3A;45~52</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">case</span> <span class=\"hljs-number\">45</span>:</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">return</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">case</span> <span class=\"hljs-number\">46</span>, <span class=\"hljs-number\">47</span>, <span class=\"hljs-number\">48</span>, <span class=\"hljs-number\">49</span>, <span class=\"hljs-number\">50</span>, <span class=\"hljs-number\">51</span>, <span class=\"hljs-number\">52</span>:</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> self.minorVersion == <span class=\"hljs-number\">0</span> {</span><br><span class=\"line\">\t\t\t<span class=\"hljs-keyword\">return</span></span><br><span class=\"line\">\t\t}</span><br><span class=\"line\">\t}</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-built_in\">panic</span>(<span class=\"hljs-string\">&quot;java.lang.UnsupportedClassVersionError!&quot;</span>)</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5BF9;&#x5916;&#x66B4;&#x9732;get&#x65B9;&#x6CD5;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">MinorVersion</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint16</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.minorVersion</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5BF9;&#x5916;&#x66B4;&#x9732;get&#x65B9;&#x6CD5;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">MajorVersion</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint16</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.majorVersion</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5BF9;&#x5916;&#x66B4;&#x9732;get&#x65B9;&#x6CD5;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">ConstantPool</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">ConstantPool</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.constantPool</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5BF9;&#x5916;&#x66B4;&#x9732;get&#x65B9;&#x6CD5;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">AccessFlags</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint16</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.accessFlags</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5BF9;&#x5916;&#x66B4;&#x9732;get&#x65B9;&#x6CD5;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">Fields</span><span class=\"hljs-params\">()</span> []*<span class=\"hljs-title\">MemberInfo</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.fields</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5BF9;&#x5916;&#x66B4;&#x9732;get&#x65B9;&#x6CD5;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">Methods</span><span class=\"hljs-params\">()</span> []*<span class=\"hljs-title\">MemberInfo</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.methods</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5BF9;&#x5916;&#x66B4;&#x9732;get&#x65B9;&#x6CD5;&#xFF0C;&#x6839;&#x636E;thisClass&#x7D22;&#x5F15;&#x5728;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x67E5;&#x627E;&#x540D;&#x79F0;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">ClassName</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.constantPool.getClassName(self.thisClass)</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5BF9;&#x5916;&#x66B4;&#x9732;get&#x65B9;&#x6CD5;&#xFF0C;&#x6839;&#x636E;superClass&#x7D22;&#x5F15;&#x5728;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x67E5;&#x627E;&#x540D;&#x79F0;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">SuperClassName</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> self.superClass &gt; <span class=\"hljs-number\">0</span> {</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">return</span> self.constantPool.getClassName(self.superClass)</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;&quot;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5BF9;&#x5916;&#x66B4;&#x9732;get&#x65B9;&#x6CD5;&#xFF0C;&#x6839;&#x636E;interfaces&#x7D22;&#x5F15;&#x5728;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x67E5;&#x627E;&#x540D;&#x79F0;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *ClassFile)</span> <span class=\"hljs-title\">InterfaceNames</span><span class=\"hljs-params\">()</span> []<span class=\"hljs-title\">string</span></span> {</span><br><span class=\"line\">\tinterfaceNames := <span class=\"hljs-built_in\">make</span>([]<span class=\"hljs-keyword\">string</span>, <span class=\"hljs-built_in\">len</span>(self.interfaces))</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> i, cpIndex := <span class=\"hljs-keyword\">range</span> self.interfaces {</span><br><span class=\"line\">\t\tinterfaceNames[i] = self.constantPool.getClassName(cpIndex)</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> interfaceNames</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<ol>\n<li>&#x5B9A;&#x4E49;&#x5B57;&#x6BB5;&#x548C;&#x65B9;&#x6CD5;&#x7684;&#x7ED3;&#x6784;(field_info&#x3001;method_info)</li>\n</ol>\n<figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> MemberInfo <span class=\"hljs-keyword\">struct</span> { <span class=\"hljs-comment\">//field&#x548C;method&#x7684;&#x7ED3;&#x6784;&#x7C7B;&#x578B;&#xFF0C;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x4E2A;&#x7ED3;&#x6784;</span></span><br><span class=\"line\">\tcp              ConstantPool <span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x5E38;&#x91CF;&#x6C60;</span></span><br><span class=\"line\">\taccessFlags     <span class=\"hljs-keyword\">uint16</span> <span class=\"hljs-comment\">//&#x8BBF;&#x95EE;&#x6807;&#x5FD7;</span></span><br><span class=\"line\">\tnameIndex       <span class=\"hljs-keyword\">uint16</span> <span class=\"hljs-comment\">//&#x540D;&#x79F0;&#x7D22;&#x5F15;</span></span><br><span class=\"line\">\tdescriptorIndex <span class=\"hljs-keyword\">uint16</span> <span class=\"hljs-comment\">//&#x63CF;&#x8FF0;&#x7D22;&#x5F15;</span></span><br><span class=\"line\">\tattributes      []AttributeInfo <span class=\"hljs-comment\">//&#x5C5E;&#x6027;&#x5217;&#x8868; </span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// read field or method table</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">readMembers</span><span class=\"hljs-params\">(reader *ClassReader, cp ConstantPool)</span> []*<span class=\"hljs-title\">MemberInfo</span></span> {</span><br><span class=\"line\">\tmemberCount := reader.readUint16() <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;field&#x6216;method&#x6570;&#x91CF;</span></span><br><span class=\"line\">\tmembers := <span class=\"hljs-built_in\">make</span>([]*MemberInfo, memberCount) <span class=\"hljs-comment\">//&#x521B;&#x5EFA;&#x6570;&#x7EC4;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">for</span> i := <span class=\"hljs-keyword\">range</span> members {</span><br><span class=\"line\">\t\tmembers[i] = readMember(reader, cp)</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> members</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5177;&#x4F53;&#x8BFB;&#x53D6;field&#x548C;method&#x7684;&#x65B9;&#x6CD5;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">readMember</span><span class=\"hljs-params\">(reader *ClassReader, cp ConstantPool)</span> *<span class=\"hljs-title\">MemberInfo</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> &amp;MemberInfo{</span><br><span class=\"line\">\t\tcp:              cp,</span><br><span class=\"line\">\t\taccessFlags:     reader.readUint16(), <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;2Byte&#x7684;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x7B26;</span></span><br><span class=\"line\">\t\tnameIndex:       reader.readUint16(), <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;2Byte&#x7684;&#x540D;&#x79F0;&#x7D22;&#x5F15;</span></span><br><span class=\"line\">\t\tdescriptorIndex: reader.readUint16(), <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;2Byte&#x7684;&#x63CF;&#x8FF0;&#x7D22;&#x5F15;</span></span><br><span class=\"line\">\t\tattributes:      readAttributes(reader, cp), <span class=\"hljs-comment\">//&#x8BFB;&#x53D6;&#x5C5E;&#x6027;&#x5217;&#x8868;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5BF9;&#x5916;&#x66B4;&#x9732;get&#x65B9;&#x6CD5;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *MemberInfo)</span> <span class=\"hljs-title\">AccessFlags</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">uint16</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.accessFlags</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5BF9;&#x5916;&#x66B4;&#x9732;get&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x8FC7;&#x540D;&#x79F0;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x5E38;&#x91CF;&#x6C60;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *MemberInfo)</span> <span class=\"hljs-title\">Name</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.cp.getUtf8(self.nameIndex)</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5BF9;&#x5916;&#x66B4;&#x9732;get&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x8FC7;&#x63CF;&#x8FF0;&#x7D22;&#x5F15;&#x8BBF;&#x95EE;&#x5E38;&#x91CF;&#x6C60;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *MemberInfo)</span> <span class=\"hljs-title\">Descriptor</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">string</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.cp.getUtf8(self.descriptorIndex)</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure></body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"JVM","path":"tags/JVM/"},{"name":"Java","path":"tags/Java/"},{"name":"Go","path":"tags/Go/"}],"excerpt":"<html><head></head><body><p>&#x7B2C;&#x4E09;&#x7BC7;&#x4E3B;&#x8981;&#x5B66;&#x4E60;JVM&#x4E2D;class&#x6587;&#x4EF6;&#x7684;&#x5177;&#x4F53;&#x7ED3;&#x6784;&#xFF0C;&#x548C;JVM&#x662F;&#x5982;&#x4F55;&#x89E3;&#x6790;&#x8FD9;&#x4E9B;&#x7ED3;&#x6784;&#x7684;&#x3002;<br>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;javac&#x5DE5;&#x5177;&#x5C06;&#x4E00;&#x4E2A;java&#x6587;&#x4EF6;compile&#x6210;&#x4E00;&#x4E2A;.class&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x5199;&#x7684;jvm&#x5C06;&#x8BE5;&#x6587;&#x4EF6;&#x89E3;&#x6790;&#x5E76;&#x6253;&#x5370;&#x51FA;&#x6765;&#x3002;&#x901A;&#x8FC7;class&#x6587;&#x4EF6;&#x7684;&#x5B66;&#x4E60;&#x80FD;&#x8BA9;&#x6211;&#x4EEC;&#x66F4;&#x52A0;&#x6DF1;&#x523B;&#x7684;&#x7406;&#x89E3;java&#x662F;&#x600E;&#x6837;&#x5B9E;&#x73B0;&#x8DE8;&#x5E73;&#x53F0;&#xFF0C;&#x5E76;&#x4E14;&#x6211;&#x4EEC;&#x7F16;&#x5199;&#x7684;java&#x4EE3;&#x7801;&#x53C8;&#x662F;&#x5982;&#x4F55;&#x5728;JVM&#x4E2D;&#x4F53;&#x73B0;&#x7684;&#x3002;</p></body></html>","more":"<h3 id=\"JVMä¸­classæ–‡ä»¶ç»“æ„-ClassFile\"><a href=\"#JVMä¸­classæ–‡ä»¶ç»“æ„-ClassFile\" class=\"headerlink\" title=\"JVMä¸­classæ–‡ä»¶ç»“æ„(ClassFile)\"></a>JVMä¸­classæ–‡ä»¶ç»“æ„(ClassFile)</h3><table>\n<thead>\n<tr>\n<th>Length</th>\n<th>name</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>u4</td>\n<td>magic</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>minor_version</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>major_version</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>constant_pool_count</td>\n</tr>\n<tr>\n<td>cp_info</td>\n<td>constant_pool[constant_pool_count-1]</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>access_flags</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>this_class</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>super_class</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>interfaces_count</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>interfaces[interfaces_count]</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>fields_count</td>\n</tr>\n<tr>\n<td>field_info</td>\n<td>fields[fields_count]</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>methods_count</td>\n</tr>\n<tr>\n<td>method_info</td>\n<td>methods[methods_count]</td>\n</tr>\n</tbody></table>\n<h3 id=\"JVMä¸­å­—æ®µç»“æ„-field-info\"><a href=\"#JVMä¸­å­—æ®µç»“æ„-field-info\" class=\"headerlink\" title=\"JVMä¸­å­—æ®µç»“æ„(field_info)\"></a>JVMä¸­å­—æ®µç»“æ„(field_info)</h3><table>\n<thead>\n<tr>\n<th>Length</th>\n<th>name</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>u2</td>\n<td>access_flags</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>name_index</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>descriptor_index</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>attributes_count</td>\n</tr>\n<tr>\n<td>attribute_info</td>\n<td>attributes[attributes_count]</td>\n</tr>\n</tbody></table>\n<h3 id=\"JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„-access-flags\"><a href=\"#JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„-access-flags\" class=\"headerlink\" title=\"JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„(access_flags)\"></a>JVMä¸­è®¿é—®æ§åˆ¶ç¬¦ç»“æ„(access_flags)</h3><table>\n<thead>\n<tr>\n<th>æ ‡å¿—å</th>\n<th>æ ‡å¿—å€¼</th>\n<th>æ ‡å¿—å«ä¹‰</th>\n<th>é’ˆå¯¹çš„å¯¹è±¡</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>ACC_PUBLIC</td>\n<td>0x0001</td>\n<td>publicç±»å‹</td>\n<td>æ‰€æœ‰ç±»å‹</td>\n</tr>\n<tr>\n<td>ACC_FINAL</td>\n<td>0x0010</td>\n<td>finalç±»å‹</td>\n<td>ç±»</td>\n</tr>\n<tr>\n<td>ACC_SUPER</td>\n<td>0x0020</td>\n<td>ä½¿ç”¨æ–°çš„invokespecialè¯­ä¹‰</td>\n<td>ç±»å’Œæ¥å£</td>\n</tr>\n<tr>\n<td>ACC_INTERFACE</td>\n<td>0x0200</td>\n<td>æ¥å£ç±»å‹</td>\n<td>æ¥å£</td>\n</tr>\n<tr>\n<td>ACC_ABSTRACT</td>\n<td>0x0400</td>\n<td>æŠ½è±¡ç±»å‹</td>\n<td>ç±»å’Œæ¥å£</td>\n</tr>\n<tr>\n<td>ACC_SYNTHETIC</td>\n<td>0x1000</td>\n<td>è¯¥ç±»ä¸ç”±ç”¨æˆ·ä»£ç ç”Ÿæˆ</td>\n<td>æ‰€æœ‰ç±»å‹</td>\n</tr>\n<tr>\n<td>ACC_ANNOTATION</td>\n<td>0x2000</td>\n<td>æ³¨è§£ç±»å‹</td>\n<td>æ³¨è§£</td>\n</tr>\n<tr>\n<td>ACC_ENUM</td>\n<td>0x4000</td>\n<td>æšä¸¾ç±»å‹</td>\n<td>æšä¸¾</td>\n</tr>\n</tbody></table>\n<h3 id=\"å®ç°\"><a href=\"#å®ç°\" class=\"headerlink\" title=\"å®ç°\"></a>å®ç°</h3><ol>\n<li>å®šä¹‰Classæ–‡ä»¶çš„å½•å–ç±»(ClassReader)</li>\n</ol>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> ClassReader <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tdata []<span class=\"keyword\">byte</span> <span class=\"comment\">//classæ–‡ä»¶å­—èŠ‚æµ</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// è¯»å–u1</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassReader)</span> <span class=\"title\">readUint8</span><span class=\"params\">()</span> <span class=\"title\">uint8</span></span> &#123;</span><br><span class=\"line\">\tval := self.data[<span class=\"number\">0</span>] <span class=\"comment\">//è¯»å–1Byte</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"number\">1</span>:]</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// u2</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassReader)</span> <span class=\"title\">readUint16</span><span class=\"params\">()</span> <span class=\"title\">uint16</span></span> &#123;</span><br><span class=\"line\">\tval := binary.BigEndian.Uint16(self.data) <span class=\"comment\">//è¯»å–2Byteå¹¶è½¬ä¸ºuint16</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"number\">2</span>:]</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// u4</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassReader)</span> <span class=\"title\">readUint32</span><span class=\"params\">()</span> <span class=\"title\">uint32</span></span> &#123;</span><br><span class=\"line\">\tval := binary.BigEndian.Uint32(self.data) <span class=\"comment\">//è¯»å–4Byteå¹¶è½¬ä¸ºuint32</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"number\">4</span>:]</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassReader)</span> <span class=\"title\">readUint64</span><span class=\"params\">()</span> <span class=\"title\">uint64</span></span> &#123;</span><br><span class=\"line\">\tval := binary.BigEndian.Uint64(self.data) <span class=\"comment\">//è¯»å–8Byteå¹¶è½¬ä¸ºuint64</span></span><br><span class=\"line\">\tself.data = self.data[<span class=\"number\">8</span>:]</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassReader)</span> <span class=\"title\">readUint16s</span><span class=\"params\">()</span> []<span class=\"title\">uint16</span></span> &#123;</span><br><span class=\"line\">\tn := self.readUint16() <span class=\"comment\">//è¯»å–2Byteï¼Œè¯¥å€¼ä¸ºåç»­æ•°ç»„çš„é•¿åº¦</span></span><br><span class=\"line\">\ts := <span class=\"built_in\">make</span>([]<span class=\"keyword\">uint16</span>, n) <span class=\"comment\">//ç”Ÿäº§é•¿åº¦ä¸ºnçš„uint16ç±»å‹æ•°ç»„</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> s &#123;</span><br><span class=\"line\">\t\ts[i] = self.readUint16() <span class=\"comment\">//è¯»å–classæ–‡ä»¶ï¼Œæ¯è¯»å–2Byteä¾¿æ”¾å…¥æ•°ç»„</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> s</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassReader)</span> <span class=\"title\">readBytes</span><span class=\"params\">(n <span class=\"keyword\">uint32</span>)</span> []<span class=\"title\">byte</span></span> &#123;</span><br><span class=\"line\">\tbytes := self.data[:n] <span class=\"comment\">//è¯»å–é•¿åº¦ä¸ºnçš„å­—èŠ‚</span></span><br><span class=\"line\">\tself.data = self.data[n:]</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> bytes</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>å®šä¹‰Classæ–‡ä»¶çš„æ ¼å¼(ClassFile)</li>\n</ol>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> ClassFile <span class=\"keyword\">struct</span> &#123; <span class=\"comment\">//æŒ‰ç…§jvmè§„èŒƒï¼Œå®šä¹‰classæ–‡ä»¶ç»“æ„</span></span><br><span class=\"line\">\t<span class=\"comment\">//magic      uint32</span></span><br><span class=\"line\">\tminorVersion <span class=\"keyword\">uint16</span></span><br><span class=\"line\">\tmajorVersion <span class=\"keyword\">uint16</span></span><br><span class=\"line\">\tconstantPool ConstantPool</span><br><span class=\"line\">\taccessFlags  <span class=\"keyword\">uint16</span></span><br><span class=\"line\">\tthisClass    <span class=\"keyword\">uint16</span></span><br><span class=\"line\">\tsuperClass   <span class=\"keyword\">uint16</span></span><br><span class=\"line\">\tinterfaces   []<span class=\"keyword\">uint16</span></span><br><span class=\"line\">\tfields       []*MemberInfo</span><br><span class=\"line\">\tmethods      []*MemberInfo</span><br><span class=\"line\">\tattributes   []AttributeInfo</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//æ–‡ä»¶è§£æå…¥å£æ–¹æ³•ï¼Œå…¥å‚classæ–‡ä»¶æµï¼Œè¿”å›classæ–‡ä»¶å¯¹è±¡</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Parse</span><span class=\"params\">(classData []<span class=\"keyword\">byte</span>)</span> <span class=\"params\">(cf *ClassFile, err error)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123; <span class=\"comment\">//æ•è·å¼‚å¸¸</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> r := <span class=\"built_in\">recover</span>(); r != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">var</span> ok <span class=\"keyword\">bool</span></span><br><span class=\"line\">\t\t\terr, ok = r.(error)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> !ok &#123;</span><br><span class=\"line\">\t\t\t\terr = fmt.Errorf(<span class=\"string\">&quot;%v&quot;</span>, r)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\"></span><br><span class=\"line\">\tcr := &amp;ClassReader&#123;classData&#125; <span class=\"comment\">//å®ä¾‹åŒ–classReaderç±»</span></span><br><span class=\"line\">\tcf = &amp;ClassFile&#123;&#125; <span class=\"comment\">//å®ä¾‹åŒ–ClassFileç±»</span></span><br><span class=\"line\">\tcf.read(cr) <span class=\"comment\">//è¯»å–classæ–‡ä»¶</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//è¯»å–classæ–‡ä»¶çš„å…·ä½“æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">read</span><span class=\"params\">(reader *ClassReader)</span></span> &#123;</span><br><span class=\"line\">\tself.readAndCheckMagic(reader) <span class=\"comment\">//è¯»å–é­”æ•°</span></span><br><span class=\"line\">\tself.readAndCheckVersion(reader) <span class=\"comment\">//è¯»å–ä¸»æ¬¡ç‰ˆæœ¬å·</span></span><br><span class=\"line\">\tself.constantPool = readConstantPool(reader) <span class=\"comment\">//è¯»å–å¸¸é‡æ± </span></span><br><span class=\"line\">\tself.accessFlags = reader.readUint16() <span class=\"comment\">//è¯»å–å½“å‰ç±»ï¼ˆæˆ–è€…æ¥å£ï¼‰çš„è®¿é—®ä¿®é¥°ç¬¦</span></span><br><span class=\"line\">\tself.thisClass = reader.readUint16() <span class=\"comment\">//è¯»å–å½“å‰ç±»ç´¢å¼•</span></span><br><span class=\"line\">\tself.superClass = reader.readUint16() <span class=\"comment\">//è¯»å–çˆ¶ç±»ç´¢å¼•</span></span><br><span class=\"line\">\tself.interfaces = reader.readUint16s() <span class=\"comment\">//è¯»å–æ‰€æœ‰æ¥å£ç´¢å¼•</span></span><br><span class=\"line\">\tself.fields = readMembers(reader, self.constantPool) <span class=\"comment\">//ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æˆå‘˜</span></span><br><span class=\"line\">\tself.methods = readMembers(reader, self.constantPool) <span class=\"comment\">//ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰æ–¹æ³•</span></span><br><span class=\"line\">\tself.attributes = readAttributes(reader, self.constantPool) <span class=\"comment\">//ä»å¸¸é‡æ± ä¸­è¯»å–æ‰€æœ‰å±æ€§</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">readAndCheckMagic</span><span class=\"params\">(reader *ClassReader)</span></span> &#123;</span><br><span class=\"line\">\tmagic := reader.readUint32() <span class=\"comment\">//è¯»å–4Byteé­”æ•°</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> magic != <span class=\"number\">0xCAFEBABE</span> &#123; <span class=\"comment\">//åˆ¤æ–­é­”æ•°æ˜¯å¦ä¸º0xCAFEBABE</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(<span class=\"string\">&quot;java.lang.ClassFormatError: magic!&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">readAndCheckVersion</span><span class=\"params\">(reader *ClassReader)</span></span> &#123;</span><br><span class=\"line\">\tself.minorVersion = reader.readUint16() <span class=\"comment\">//é«˜2Byteä¸ºæ¬¡ç‰ˆæœ¬å·</span></span><br><span class=\"line\">\tself.majorVersion = reader.readUint16() <span class=\"comment\">//ä½2Byteä¸ºä¸»ç‰ˆæœ¬å·</span></span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> self.majorVersion &#123; <span class=\"comment\">//æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦ä¸º45~52</span></span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">45</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t<span class=\"keyword\">case</span> <span class=\"number\">46</span>, <span class=\"number\">47</span>, <span class=\"number\">48</span>, <span class=\"number\">49</span>, <span class=\"number\">50</span>, <span class=\"number\">51</span>, <span class=\"number\">52</span>:</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> self.minorVersion == <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">panic</span>(<span class=\"string\">&quot;java.lang.UnsupportedClassVersionError!&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">MinorVersion</span><span class=\"params\">()</span> <span class=\"title\">uint16</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.minorVersion</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">MajorVersion</span><span class=\"params\">()</span> <span class=\"title\">uint16</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.majorVersion</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">ConstantPool</span><span class=\"params\">()</span> <span class=\"title\">ConstantPool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.constantPool</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">AccessFlags</span><span class=\"params\">()</span> <span class=\"title\">uint16</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.accessFlags</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">Fields</span><span class=\"params\">()</span> []*<span class=\"title\">MemberInfo</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.fields</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">Methods</span><span class=\"params\">()</span> []*<span class=\"title\">MemberInfo</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.methods</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®thisClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">ClassName</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.constantPool.getClassName(self.thisClass)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®superClassç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">SuperClassName</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> self.superClass &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> self.constantPool.getClassName(self.superClass)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œæ ¹æ®interfacesç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾åç§°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *ClassFile)</span> <span class=\"title\">InterfaceNames</span><span class=\"params\">()</span> []<span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\tinterfaceNames := <span class=\"built_in\">make</span>([]<span class=\"keyword\">string</span>, <span class=\"built_in\">len</span>(self.interfaces))</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i, cpIndex := <span class=\"keyword\">range</span> self.interfaces &#123;</span><br><span class=\"line\">\t\tinterfaceNames[i] = self.constantPool.getClassName(cpIndex)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> interfaceNames</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>å®šä¹‰å­—æ®µå’Œæ–¹æ³•çš„ç»“æ„(field_infoã€method_info)</li>\n</ol>\n<figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> MemberInfo <span class=\"keyword\">struct</span> &#123; <span class=\"comment\">//fieldå’Œmethodçš„ç»“æ„ç±»å‹ï¼Œä½¿ç”¨åŒä¸€ä¸ªç»“æ„</span></span><br><span class=\"line\">\tcp              ConstantPool <span class=\"comment\">//å½“å‰å¸¸é‡æ± </span></span><br><span class=\"line\">\taccessFlags     <span class=\"keyword\">uint16</span> <span class=\"comment\">//è®¿é—®æ ‡å¿—</span></span><br><span class=\"line\">\tnameIndex       <span class=\"keyword\">uint16</span> <span class=\"comment\">//åç§°ç´¢å¼•</span></span><br><span class=\"line\">\tdescriptorIndex <span class=\"keyword\">uint16</span> <span class=\"comment\">//æè¿°ç´¢å¼•</span></span><br><span class=\"line\">\tattributes      []AttributeInfo <span class=\"comment\">//å±æ€§åˆ—è¡¨ </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// read field or method table</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">readMembers</span><span class=\"params\">(reader *ClassReader, cp ConstantPool)</span> []*<span class=\"title\">MemberInfo</span></span> &#123;</span><br><span class=\"line\">\tmemberCount := reader.readUint16() <span class=\"comment\">//è¯»å–fieldæˆ–methodæ•°é‡</span></span><br><span class=\"line\">\tmembers := <span class=\"built_in\">make</span>([]*MemberInfo, memberCount) <span class=\"comment\">//åˆ›å»ºæ•°ç»„</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"keyword\">range</span> members &#123;</span><br><span class=\"line\">\t\tmembers[i] = readMember(reader, cp)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> members</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å…·ä½“è¯»å–fieldå’Œmethodçš„æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">readMember</span><span class=\"params\">(reader *ClassReader, cp ConstantPool)</span> *<span class=\"title\">MemberInfo</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;MemberInfo&#123;</span><br><span class=\"line\">\t\tcp:              cp,</span><br><span class=\"line\">\t\taccessFlags:     reader.readUint16(), <span class=\"comment\">//è¯»å–2Byteçš„è®¿é—®æ§åˆ¶ç¬¦</span></span><br><span class=\"line\">\t\tnameIndex:       reader.readUint16(), <span class=\"comment\">//è¯»å–2Byteçš„åç§°ç´¢å¼•</span></span><br><span class=\"line\">\t\tdescriptorIndex: reader.readUint16(), <span class=\"comment\">//è¯»å–2Byteçš„æè¿°ç´¢å¼•</span></span><br><span class=\"line\">\t\tattributes:      readAttributes(reader, cp), <span class=\"comment\">//è¯»å–å±æ€§åˆ—è¡¨</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *MemberInfo)</span> <span class=\"title\">AccessFlags</span><span class=\"params\">()</span> <span class=\"title\">uint16</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.accessFlags</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡åç§°ç´¢å¼•è®¿é—®å¸¸é‡æ± </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *MemberInfo)</span> <span class=\"title\">Name</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.cp.getUtf8(self.nameIndex)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å¯¹å¤–æš´éœ²getæ–¹æ³•ï¼Œé€šè¿‡æè¿°ç´¢å¼•è®¿é—®å¸¸é‡æ± </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *MemberInfo)</span> <span class=\"title\">Descriptor</span><span class=\"params\">()</span> <span class=\"title\">string</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.cp.getUtf8(self.descriptorIndex)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°4","date":"2019-09-26T13:49:11.000Z","_content":"\n### è¿è¡Œæ—¶æ•°æ®åŒº\nJVMå°†éœ€è¦ç”¨åˆ°çš„æ•°æ®å­˜æ”¾å…¥å†…å­˜ä¸­ï¼Œè¿™ä¸ªå†…å­˜åŒºå°±å«è¿è¡Œæ—¶æ•°æ®åŒº\nå¯åˆ†ä¸ºä¸¤ç§ï¼š\n1. ä¸€ç±»æ˜¯å¤šçº¿ç¨‹å…±äº«çš„ï¼Œè¯¥æ•°æ®åŒºéœ€è¦åœ¨Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºå¥½ï¼Œåœ¨Javaè™šæ‹Ÿæœºé€€å‡ºæ—¶é”€æ¯ã€‚\n2. ä¸€ç±»åˆ™æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œè¯¥æ•°æ®åŒºåˆ™åœ¨åˆ›å»ºçº¿ç¨‹æ—¶æ‰åˆ›å»ºï¼Œçº¿ç¨‹é€€å‡ºæ—¶é”€æ¯ã€‚\n\n<!-- more -->\n\n![01](è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4/è¿è¡Œæ—¶æ•°æ®åŒº.png)\n\n\n### å®ç°\n#### å®šä¹‰å¯¹è±¡ç»“æ„\n\n{% codeblock lang:golang %}\ntype Object struct {\n\t// todo\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\n\n{% codeblock lang:golang %}\ntype Thread struct {\n\tpc    int // the address of the instruction currently being executed\n\tstack *Stack //Javaè™šæ‹Ÿæœºæ ˆæŒ‡é’ˆ\n\t// todo\n}\n\n//åˆ›å»ºThreadå®ä¾‹\n//javaå‘½ä»¤æä¾›äº†-Xssé€‰é¡¹æ¥è®¾ç½®Javaè™šæ‹Ÿæœºæ ˆå¤§å°\nfunc NewThread() *Thread {\n\treturn &Thread{\n\t\tstack: newStack(1024), //æœ€å¤šå®¹çº³1024å¸§\n\t}\n}\n\nfunc (self *Thread) PC() int {\n\treturn self.pc\n}\nfunc (self *Thread) SetPC(pc int) {\n\tself.pc = pc\n}\n\n//å½“å‰å¸§è¿›æ ˆ\nfunc (self *Thread) PushFrame(frame *Frame) {\n\tself.stack.push(frame)\n}\n//å½“å‰å¸§å‡ºæ ˆ\nfunc (self *Thread) PopFrame() *Frame {\n\treturn self.stack.pop()\n}\n//è·å–å½“å‰å¸§\nfunc (self *Thread) CurrentFrame() *Frame {\n\treturn self.stack.top()\n}\n\n\n\n\n{% endcodeblock %}\n\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\n\n{% codeblock lang:golang %}\ntype Stack struct {\n\tmaxSize uint //æœ€å¤šå¯ä»¥å®¹çº³å¤šå°‘å¸§\n\tsize    uint //æ ˆçš„å½“å‰å¤§å°\n\t_top    *Frame //ä¿å­˜æ ˆé¡¶æŒ‡é’ˆ\n}\n\n//å®ä¾‹ä¸€ä¸ªæ ˆ\nfunc newStack(maxSize uint) *Stack {\n\treturn &Stack{\n\t\tmaxSize: maxSize,\n\t}\n}\n\n//å½“å‰å¸§è¿›æ ˆ\nfunc (self *Stack) push(frame *Frame) {\n\tif self.size >= self.maxSize { //åˆ¤æ–­å½“å‰æ ˆå¤§å°æ˜¯å¦è¶…è¿‡æœ€å¤§å®¹é‡\n\t\tpanic(\"java.lang.StackOverflowError\") \n\t}\n\n\tif self._top != nil {  //å½“å‰æ ˆé¡¶ä¸ä¸ºç©ºæ—¶\n\t\tframe.lower = self._top //å°†æ’å…¥å¸§å°¾æŒ‡å‘æ ˆé¡¶æŒ‡é’ˆ\n\t}\n\n\tself._top = frame //å½“å‰æ ˆé¡¶æŒ‡å‘å½“å‰å¸§\n\tself.size++ //å½“å‰æ ˆå¤§å°åŠ 1\n}\n\n//å½“å‰å¸§å‡ºæ ˆ\nfunc (self *Stack) pop() *Frame {\n\tif self._top == nil { //å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™\n\t\tpanic(\"jvm stack is empty!\")\n\t}\n\n\ttop := self._top //å–å‡ºå½“å‰æ ˆé¡¶å¸§\n\tself._top = top.lower //å°†å½“å‰æ ˆé¡¶æŒ‡å‘topçš„ä¸‹ä¸€å¸§\n\ttop.lower = nil //æ–­å¼€topçš„å°¾æŒ‡é’ˆ\n\tself.size-- //å½“å‰æ ˆå¤§å°å‡1\n\n\treturn top //è¿”å›top\n}\n\n//è·å–å½“å‰æ ˆé¡¶å¸§\nfunc (self *Stack) top() *Frame {\n\tif self._top == nil { ////å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™\n\t\tpanic(\"jvm stack is empty!\")\n\t}\n\n\treturn self._top //è¿”å›å½“å‰æ ˆé¡¶å¸§\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\n\n{% codeblock lang:golang %}\ntype Frame struct {\n\tlower        *Frame //æŒ‡å‘ä¸‹ä¸€å¸§\n\tlocalVars    LocalVars //ä¿å­˜å±€éƒ¨å˜é‡è¡¨æŒ‡é’ˆ\n\toperandStack *OperandStack //ä¿å­˜æ“ä½œæ•°æ ˆæŒ‡é’ˆ\n\t// todo\n}\n\n//å®ä¾‹åŒ–å¸§\nfunc NewFrame(maxLocals, maxStack uint) *Frame {\n\treturn &Frame{\n\t\tlocalVars:    newLocalVars(maxLocals), //å®ä¾‹åŒ–å±€éƒ¨å˜é‡å¯¹è±¡\n\t\toperandStack: newOperandStack(maxStack), //å®ä¾‹åŒ–æ“ä½œæ•°æ ˆå¯¹è±¡\n\t}\n}\n\n// getters\nfunc (self *Frame) LocalVars() LocalVars {\n\treturn self.localVars\n}\nfunc (self *Frame) OperandStack() *OperandStack {\n\treturn self.operandStack\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\n\n{% codeblock lang:golang %}\ntype LocalVars []Slot\n\n//åˆ›å»ºå±€éƒ¨å˜é‡å®ä¾‹\nfunc newLocalVars(maxLocals uint) LocalVars {\n\tif maxLocals > 0 {\n\t\treturn make([]Slot, maxLocals) //ç”³æ˜å¤§å°ä¸ºmaxLocalsçš„Slotæ•°ç»„\n\t}\n\treturn nil\n}\n\n//è®¾ç½®intç±»å‹\nfunc (self LocalVars) SetInt(index uint, val int32) {\n\tself[index].num = val\n}\n//å–intç±»å‹\nfunc (self LocalVars) GetInt(index uint) int32 {\n\treturn self[index].num\n}\n//è®¾ç½®float32ç±»å‹\nfunc (self LocalVars) SetFloat(index uint, val float32) {\n\tbits := math.Float32bits(val)//è½¬ä¸ºuint32\n\tself[index].num = int32(bits) //è½¬ä¸ºint32\n}\n//å–float32ç±»å‹\nfunc (self LocalVars) GetFloat(index uint) float32 {\n\tbits := uint32(self[index].num)//è½¬ä¸ºunit32\n\treturn math.Float32frombits(bits)//è½¬ä¸ºfloat\n}\n\n//è®¾ç½®longç±»å‹\nfunc (self LocalVars) SetLong(index uint, val int64) {\n\tself[index].num = int32(val)//å–ä½ä½32ä½å­˜å‚¨åœ¨index\n\tself[index+1].num = int32(val >> 32) //å³ç§»32ä½å–é«˜ä½32ä½å­˜å‚¨åœ¨index+1\n}\n//å–longç±»å‹\nfunc (self LocalVars) GetLong(index uint) int64 {\n\tlow := uint32(self[index].num) //å–indexä½32ä½\n\thigh := uint32(self[index+1].num) //å–index+1é«˜32ä½\n\treturn int64(high)<<32 | int64(low) //å·¦ç§»é«˜ä½32ä½ï¼Œæ‹¼æ¥é«˜ä½ä½è¿”å›\n}\n\n//è®¾ç½®float64\nfunc (self LocalVars) SetDouble(index uint, val float64) {\n\tbits := math.Float64bits(val) //è½¬ä¸ºuint64\n\tself.SetLong(index, int64(bits)) //ç”¨longå‹è®¾ç½®æ–¹æ³•è®¾ç½®int64\n}\n//å–float64\nfunc (self LocalVars) GetDouble(index uint) float64 {\n\tbits := uint64(self.GetLong(index)) //æŒ‰longå‹å–å€¼æ–¹æ³•å–å‡ºuint64\n\treturn math.Float64frombits(bits) //è½¬ä¸ºfloat64\n}\n//è®¾ç½®å¼•ç”¨\nfunc (self LocalVars) SetRef(index uint, ref *Object) {\n\tself[index].ref = ref\n}\n//å–å¼•ç”¨\nfunc (self LocalVars) GetRef(index uint) *Object {\n\treturn self[index].ref\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\n\n{% codeblock lang:golang %}\ntype OperandStack struct {\n\tsize  uint //è®°å½•æ ˆé¡¶ä½ç½®\n\tslots []Slot\n}\n//å®ä¾‹åŒ–æ“ä½œæ•°æ ˆ\nfunc newOperandStack(maxStack uint) *OperandStack {\n\tif maxStack > 0 {\n\t\treturn &OperandStack{\n\t\t\tslots: make([]Slot, maxStack),//ç”³æ˜maxStackå¤§å°çš„Slotæ•°ç»„\n\t\t}\n\t}\n\treturn nil\n}\n\nfunc (self *OperandStack) PushInt(val int32) {\n\tself.slots[self.size].num = val\n\tself.size++\n}\nfunc (self *OperandStack) PopInt() int32 {\n\tself.size--\n\treturn self.slots[self.size].num\n}\n\nfunc (self *OperandStack) PushFloat(val float32) {\n\tbits := math.Float32bits(val)\n\tself.slots[self.size].num = int32(bits)\n\tself.size++\n}\nfunc (self *OperandStack) PopFloat() float32 {\n\tself.size--\n\tbits := uint32(self.slots[self.size].num)\n\treturn math.Float32frombits(bits)\n}\n\n// long consumes two slots\nfunc (self *OperandStack) PushLong(val int64) {\n\tself.slots[self.size].num = int32(val)\n\tself.slots[self.size+1].num = int32(val >> 32)\n\tself.size += 2\n}\nfunc (self *OperandStack) PopLong() int64 {\n\tself.size -= 2\n\tlow := uint32(self.slots[self.size].num)\n\thigh := uint32(self.slots[self.size+1].num)\n\treturn int64(high)<<32 | int64(low)\n}\n\n// double consumes two slots\nfunc (self *OperandStack) PushDouble(val float64) {\n\tbits := math.Float64bits(val)\n\tself.PushLong(int64(bits))\n}\nfunc (self *OperandStack) PopDouble() float64 {\n\tbits := uint64(self.PopLong())\n\treturn math.Float64frombits(bits)\n}\n\nfunc (self *OperandStack) PushRef(ref *Object) {\n\tself.slots[self.size].ref = ref\n\tself.size++\n}\nfunc (self *OperandStack) PopRef() *Object {\n\tself.size--\n\tref := self.slots[self.size].ref\n\tself.slots[self.size].ref = nil\n\treturn ref\n}\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\n\n{% codeblock lang:golang %}\n\n{% endcodeblock %}","source":"_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4.md","raw":"---\ntitle: è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº ç¬”è®°4\ndate: 2019-09-26 21:49:11\ntags: \n    - JVM\n    - Java\n    - Go\ncategories :\n    - Technology\n---\n\n### è¿è¡Œæ—¶æ•°æ®åŒº\nJVMå°†éœ€è¦ç”¨åˆ°çš„æ•°æ®å­˜æ”¾å…¥å†…å­˜ä¸­ï¼Œè¿™ä¸ªå†…å­˜åŒºå°±å«è¿è¡Œæ—¶æ•°æ®åŒº\nå¯åˆ†ä¸ºä¸¤ç§ï¼š\n1. ä¸€ç±»æ˜¯å¤šçº¿ç¨‹å…±äº«çš„ï¼Œè¯¥æ•°æ®åŒºéœ€è¦åœ¨Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºå¥½ï¼Œåœ¨Javaè™šæ‹Ÿæœºé€€å‡ºæ—¶é”€æ¯ã€‚\n2. ä¸€ç±»åˆ™æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œè¯¥æ•°æ®åŒºåˆ™åœ¨åˆ›å»ºçº¿ç¨‹æ—¶æ‰åˆ›å»ºï¼Œçº¿ç¨‹é€€å‡ºæ—¶é”€æ¯ã€‚\n\n<!-- more -->\n\n![01](è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4/è¿è¡Œæ—¶æ•°æ®åŒº.png)\n\n\n### å®ç°\n#### å®šä¹‰å¯¹è±¡ç»“æ„\n\n{% codeblock lang:golang %}\ntype Object struct {\n\t// todo\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\n\n{% codeblock lang:golang %}\ntype Thread struct {\n\tpc    int // the address of the instruction currently being executed\n\tstack *Stack //Javaè™šæ‹Ÿæœºæ ˆæŒ‡é’ˆ\n\t// todo\n}\n\n//åˆ›å»ºThreadå®ä¾‹\n//javaå‘½ä»¤æä¾›äº†-Xssé€‰é¡¹æ¥è®¾ç½®Javaè™šæ‹Ÿæœºæ ˆå¤§å°\nfunc NewThread() *Thread {\n\treturn &Thread{\n\t\tstack: newStack(1024), //æœ€å¤šå®¹çº³1024å¸§\n\t}\n}\n\nfunc (self *Thread) PC() int {\n\treturn self.pc\n}\nfunc (self *Thread) SetPC(pc int) {\n\tself.pc = pc\n}\n\n//å½“å‰å¸§è¿›æ ˆ\nfunc (self *Thread) PushFrame(frame *Frame) {\n\tself.stack.push(frame)\n}\n//å½“å‰å¸§å‡ºæ ˆ\nfunc (self *Thread) PopFrame() *Frame {\n\treturn self.stack.pop()\n}\n//è·å–å½“å‰å¸§\nfunc (self *Thread) CurrentFrame() *Frame {\n\treturn self.stack.top()\n}\n\n\n\n\n{% endcodeblock %}\n\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\n\n{% codeblock lang:golang %}\ntype Stack struct {\n\tmaxSize uint //æœ€å¤šå¯ä»¥å®¹çº³å¤šå°‘å¸§\n\tsize    uint //æ ˆçš„å½“å‰å¤§å°\n\t_top    *Frame //ä¿å­˜æ ˆé¡¶æŒ‡é’ˆ\n}\n\n//å®ä¾‹ä¸€ä¸ªæ ˆ\nfunc newStack(maxSize uint) *Stack {\n\treturn &Stack{\n\t\tmaxSize: maxSize,\n\t}\n}\n\n//å½“å‰å¸§è¿›æ ˆ\nfunc (self *Stack) push(frame *Frame) {\n\tif self.size >= self.maxSize { //åˆ¤æ–­å½“å‰æ ˆå¤§å°æ˜¯å¦è¶…è¿‡æœ€å¤§å®¹é‡\n\t\tpanic(\"java.lang.StackOverflowError\") \n\t}\n\n\tif self._top != nil {  //å½“å‰æ ˆé¡¶ä¸ä¸ºç©ºæ—¶\n\t\tframe.lower = self._top //å°†æ’å…¥å¸§å°¾æŒ‡å‘æ ˆé¡¶æŒ‡é’ˆ\n\t}\n\n\tself._top = frame //å½“å‰æ ˆé¡¶æŒ‡å‘å½“å‰å¸§\n\tself.size++ //å½“å‰æ ˆå¤§å°åŠ 1\n}\n\n//å½“å‰å¸§å‡ºæ ˆ\nfunc (self *Stack) pop() *Frame {\n\tif self._top == nil { //å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™\n\t\tpanic(\"jvm stack is empty!\")\n\t}\n\n\ttop := self._top //å–å‡ºå½“å‰æ ˆé¡¶å¸§\n\tself._top = top.lower //å°†å½“å‰æ ˆé¡¶æŒ‡å‘topçš„ä¸‹ä¸€å¸§\n\ttop.lower = nil //æ–­å¼€topçš„å°¾æŒ‡é’ˆ\n\tself.size-- //å½“å‰æ ˆå¤§å°å‡1\n\n\treturn top //è¿”å›top\n}\n\n//è·å–å½“å‰æ ˆé¡¶å¸§\nfunc (self *Stack) top() *Frame {\n\tif self._top == nil { ////å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™\n\t\tpanic(\"jvm stack is empty!\")\n\t}\n\n\treturn self._top //è¿”å›å½“å‰æ ˆé¡¶å¸§\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\n\n{% codeblock lang:golang %}\ntype Frame struct {\n\tlower        *Frame //æŒ‡å‘ä¸‹ä¸€å¸§\n\tlocalVars    LocalVars //ä¿å­˜å±€éƒ¨å˜é‡è¡¨æŒ‡é’ˆ\n\toperandStack *OperandStack //ä¿å­˜æ“ä½œæ•°æ ˆæŒ‡é’ˆ\n\t// todo\n}\n\n//å®ä¾‹åŒ–å¸§\nfunc NewFrame(maxLocals, maxStack uint) *Frame {\n\treturn &Frame{\n\t\tlocalVars:    newLocalVars(maxLocals), //å®ä¾‹åŒ–å±€éƒ¨å˜é‡å¯¹è±¡\n\t\toperandStack: newOperandStack(maxStack), //å®ä¾‹åŒ–æ“ä½œæ•°æ ˆå¯¹è±¡\n\t}\n}\n\n// getters\nfunc (self *Frame) LocalVars() LocalVars {\n\treturn self.localVars\n}\nfunc (self *Frame) OperandStack() *OperandStack {\n\treturn self.operandStack\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\n\n{% codeblock lang:golang %}\ntype LocalVars []Slot\n\n//åˆ›å»ºå±€éƒ¨å˜é‡å®ä¾‹\nfunc newLocalVars(maxLocals uint) LocalVars {\n\tif maxLocals > 0 {\n\t\treturn make([]Slot, maxLocals) //ç”³æ˜å¤§å°ä¸ºmaxLocalsçš„Slotæ•°ç»„\n\t}\n\treturn nil\n}\n\n//è®¾ç½®intç±»å‹\nfunc (self LocalVars) SetInt(index uint, val int32) {\n\tself[index].num = val\n}\n//å–intç±»å‹\nfunc (self LocalVars) GetInt(index uint) int32 {\n\treturn self[index].num\n}\n//è®¾ç½®float32ç±»å‹\nfunc (self LocalVars) SetFloat(index uint, val float32) {\n\tbits := math.Float32bits(val)//è½¬ä¸ºuint32\n\tself[index].num = int32(bits) //è½¬ä¸ºint32\n}\n//å–float32ç±»å‹\nfunc (self LocalVars) GetFloat(index uint) float32 {\n\tbits := uint32(self[index].num)//è½¬ä¸ºunit32\n\treturn math.Float32frombits(bits)//è½¬ä¸ºfloat\n}\n\n//è®¾ç½®longç±»å‹\nfunc (self LocalVars) SetLong(index uint, val int64) {\n\tself[index].num = int32(val)//å–ä½ä½32ä½å­˜å‚¨åœ¨index\n\tself[index+1].num = int32(val >> 32) //å³ç§»32ä½å–é«˜ä½32ä½å­˜å‚¨åœ¨index+1\n}\n//å–longç±»å‹\nfunc (self LocalVars) GetLong(index uint) int64 {\n\tlow := uint32(self[index].num) //å–indexä½32ä½\n\thigh := uint32(self[index+1].num) //å–index+1é«˜32ä½\n\treturn int64(high)<<32 | int64(low) //å·¦ç§»é«˜ä½32ä½ï¼Œæ‹¼æ¥é«˜ä½ä½è¿”å›\n}\n\n//è®¾ç½®float64\nfunc (self LocalVars) SetDouble(index uint, val float64) {\n\tbits := math.Float64bits(val) //è½¬ä¸ºuint64\n\tself.SetLong(index, int64(bits)) //ç”¨longå‹è®¾ç½®æ–¹æ³•è®¾ç½®int64\n}\n//å–float64\nfunc (self LocalVars) GetDouble(index uint) float64 {\n\tbits := uint64(self.GetLong(index)) //æŒ‰longå‹å–å€¼æ–¹æ³•å–å‡ºuint64\n\treturn math.Float64frombits(bits) //è½¬ä¸ºfloat64\n}\n//è®¾ç½®å¼•ç”¨\nfunc (self LocalVars) SetRef(index uint, ref *Object) {\n\tself[index].ref = ref\n}\n//å–å¼•ç”¨\nfunc (self LocalVars) GetRef(index uint) *Object {\n\treturn self[index].ref\n}\n\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\n\n{% codeblock lang:golang %}\ntype OperandStack struct {\n\tsize  uint //è®°å½•æ ˆé¡¶ä½ç½®\n\tslots []Slot\n}\n//å®ä¾‹åŒ–æ“ä½œæ•°æ ˆ\nfunc newOperandStack(maxStack uint) *OperandStack {\n\tif maxStack > 0 {\n\t\treturn &OperandStack{\n\t\t\tslots: make([]Slot, maxStack),//ç”³æ˜maxStackå¤§å°çš„Slotæ•°ç»„\n\t\t}\n\t}\n\treturn nil\n}\n\nfunc (self *OperandStack) PushInt(val int32) {\n\tself.slots[self.size].num = val\n\tself.size++\n}\nfunc (self *OperandStack) PopInt() int32 {\n\tself.size--\n\treturn self.slots[self.size].num\n}\n\nfunc (self *OperandStack) PushFloat(val float32) {\n\tbits := math.Float32bits(val)\n\tself.slots[self.size].num = int32(bits)\n\tself.size++\n}\nfunc (self *OperandStack) PopFloat() float32 {\n\tself.size--\n\tbits := uint32(self.slots[self.size].num)\n\treturn math.Float32frombits(bits)\n}\n\n// long consumes two slots\nfunc (self *OperandStack) PushLong(val int64) {\n\tself.slots[self.size].num = int32(val)\n\tself.slots[self.size+1].num = int32(val >> 32)\n\tself.size += 2\n}\nfunc (self *OperandStack) PopLong() int64 {\n\tself.size -= 2\n\tlow := uint32(self.slots[self.size].num)\n\thigh := uint32(self.slots[self.size+1].num)\n\treturn int64(high)<<32 | int64(low)\n}\n\n// double consumes two slots\nfunc (self *OperandStack) PushDouble(val float64) {\n\tbits := math.Float64bits(val)\n\tself.PushLong(int64(bits))\n}\nfunc (self *OperandStack) PopDouble() float64 {\n\tbits := uint64(self.PopLong())\n\treturn math.Float64frombits(bits)\n}\n\nfunc (self *OperandStack) PushRef(ref *Object) {\n\tself.slots[self.size].ref = ref\n\tself.size++\n}\nfunc (self *OperandStack) PopRef() *Object {\n\tself.size--\n\tref := self.slots[self.size].ref\n\tself.slots[self.size].ref = nil\n\treturn ref\n}\n{% endcodeblock %}\n\n#### è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\n\n{% codeblock lang:golang %}\n\n{% endcodeblock %}","slug":"è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4","published":1,"updated":"2020-12-14T10:36:14.566Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htx001yv252bj0094ri","content":"<html><head></head><body><h3 id=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;\"><a href=\"#&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;\"></a>&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;</h3><p>JVM&#x5C06;&#x9700;&#x8981;&#x7528;&#x5230;&#x7684;&#x6570;&#x636E;&#x5B58;&#x653E;&#x5165;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x5185;&#x5B58;&#x533A;&#x5C31;&#x53EB;&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;<br>&#x53EF;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#xFF1A;</p>\n<ol>\n<li>&#x4E00;&#x7C7B;&#x662F;&#x591A;&#x7EBF;&#x7A0B;&#x5171;&#x4EAB;&#x7684;&#xFF0C;&#x8BE5;&#x6570;&#x636E;&#x533A;&#x9700;&#x8981;&#x5728;Java&#x865A;&#x62DF;&#x673A;&#x542F;&#x52A8;&#x65F6;&#x521B;&#x5EFA;&#x597D;&#xFF0C;&#x5728;Java&#x865A;&#x62DF;&#x673A;&#x9000;&#x51FA;&#x65F6;&#x9500;&#x6BC1;&#x3002;</li>\n<li>&#x4E00;&#x7C7B;&#x5219;&#x662F;&#x7EBF;&#x7A0B;&#x79C1;&#x6709;&#x7684;&#xFF0C;&#x8BE5;&#x6570;&#x636E;&#x533A;&#x5219;&#x5728;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x65F6;&#x624D;&#x521B;&#x5EFA;&#xFF0C;&#x7EBF;&#x7A0B;&#x9000;&#x51FA;&#x65F6;&#x9500;&#x6BC1;&#x3002;</li>\n</ol>\n<a id=\"more\"></a>\n\n<p><img src=\"/2019/09/26/%E8%87%AA%E5%B7%B1%E5%8A%A8%E6%89%8B%E5%86%99Java%E8%99%9A%E6%8B%9F%E6%9C%BA-%E7%AC%94%E8%AE%B04/%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.png\" alt=\"01\"></p>\n<h3 id=\"&#x5B9E;&#x73B0;\"><a href=\"#&#x5B9E;&#x73B0;\" class=\"headerlink\" title=\"&#x5B9E;&#x73B0;\"></a>&#x5B9E;&#x73B0;</h3><h4 id=\"&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x7ED3;&#x6784;\"><a href=\"#&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x7ED3;&#x6784;\" class=\"headerlink\" title=\"&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x7ED3;&#x6784;\"></a>&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x7ED3;&#x6784;</h4><figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> Object <span class=\"hljs-keyword\">struct</span> {</span><br><span class=\"line\">\t<span class=\"hljs-comment\">// todo</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n\n<h4 id=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x7EBF;&#x7A0B;\"><a href=\"#&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x7EBF;&#x7A0B;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x7EBF;&#x7A0B;\"></a>&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x7EBF;&#x7A0B;</h4><figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> Thread <span class=\"hljs-keyword\">struct</span> {</span><br><span class=\"line\">\tpc    <span class=\"hljs-keyword\">int</span> <span class=\"hljs-comment\">// the address of the instruction currently being executed</span></span><br><span class=\"line\">\tstack *Stack <span class=\"hljs-comment\">//Java&#x865A;&#x62DF;&#x673A;&#x6808;&#x6307;&#x9488;</span></span><br><span class=\"line\">\t<span class=\"hljs-comment\">// todo</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x521B;&#x5EFA;Thread&#x5B9E;&#x4F8B;</span></span><br><span class=\"line\"><span class=\"hljs-comment\">//java&#x547D;&#x4EE4;&#x63D0;&#x4F9B;&#x4E86;-Xss&#x9009;&#x9879;&#x6765;&#x8BBE;&#x7F6E;Java&#x865A;&#x62DF;&#x673A;&#x6808;&#x5927;&#x5C0F;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">NewThread</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Thread</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> &amp;Thread{</span><br><span class=\"line\">\t\tstack: newStack(<span class=\"hljs-number\">1024</span>), <span class=\"hljs-comment\">//&#x6700;&#x591A;&#x5BB9;&#x7EB3;1024&#x5E27;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Thread)</span> <span class=\"hljs-title\">PC</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">int</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.pc</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Thread)</span> <span class=\"hljs-title\">SetPC</span><span class=\"hljs-params\">(pc <span class=\"hljs-keyword\">int</span>)</span></span> {</span><br><span class=\"line\">\tself.pc = pc</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x5E27;&#x8FDB;&#x6808;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Thread)</span> <span class=\"hljs-title\">PushFrame</span><span class=\"hljs-params\">(frame *Frame)</span></span> {</span><br><span class=\"line\">\tself.stack.push(frame)</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x5E27;&#x51FA;&#x6808;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Thread)</span> <span class=\"hljs-title\">PopFrame</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Frame</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.stack.pop()</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x5E27;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Thread)</span> <span class=\"hljs-title\">CurrentFrame</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Frame</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.stack.top()</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n\n\n<h4 id=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-Java&#x865A;&#x62DF;&#x673A;&#x6808;\"><a href=\"#&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-Java&#x865A;&#x62DF;&#x673A;&#x6808;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-Java&#x865A;&#x62DF;&#x673A;&#x6808;\"></a>&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-Java&#x865A;&#x62DF;&#x673A;&#x6808;</h4><figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> Stack <span class=\"hljs-keyword\">struct</span> {</span><br><span class=\"line\">\tmaxSize <span class=\"hljs-keyword\">uint</span> <span class=\"hljs-comment\">//&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x5BB9;&#x7EB3;&#x591A;&#x5C11;&#x5E27;</span></span><br><span class=\"line\">\tsize    <span class=\"hljs-keyword\">uint</span> <span class=\"hljs-comment\">//&#x6808;&#x7684;&#x5F53;&#x524D;&#x5927;&#x5C0F;</span></span><br><span class=\"line\">\t_top    *Frame <span class=\"hljs-comment\">//&#x4FDD;&#x5B58;&#x6808;&#x9876;&#x6307;&#x9488;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5B9E;&#x4F8B;&#x4E00;&#x4E2A;&#x6808;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newStack</span><span class=\"hljs-params\">(maxSize <span class=\"hljs-keyword\">uint</span>)</span> *<span class=\"hljs-title\">Stack</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> &amp;Stack{</span><br><span class=\"line\">\t\tmaxSize: maxSize,</span><br><span class=\"line\">\t}</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x5E27;&#x8FDB;&#x6808;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Stack)</span> <span class=\"hljs-title\">push</span><span class=\"hljs-params\">(frame *Frame)</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> self.size &gt;= self.maxSize { <span class=\"hljs-comment\">//&#x5224;&#x65AD;&#x5F53;&#x524D;&#x6808;&#x5927;&#x5C0F;&#x662F;&#x5426;&#x8D85;&#x8FC7;&#x6700;&#x5927;&#x5BB9;&#x91CF;</span></span><br><span class=\"line\">\t\t<span class=\"hljs-built_in\">panic</span>(<span class=\"hljs-string\">&quot;java.lang.StackOverflowError&quot;</span>) </span><br><span class=\"line\">\t}</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> self._top != <span class=\"hljs-literal\">nil</span> {  <span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x6808;&#x9876;&#x4E0D;&#x4E3A;&#x7A7A;&#x65F6;</span></span><br><span class=\"line\">\t\tframe.lower = self._top <span class=\"hljs-comment\">//&#x5C06;&#x63D2;&#x5165;&#x5E27;&#x5C3E;&#x6307;&#x5411;&#x6808;&#x9876;&#x6307;&#x9488;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\"></span><br><span class=\"line\">\tself._top = frame <span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x6808;&#x9876;&#x6307;&#x5411;&#x5F53;&#x524D;&#x5E27;</span></span><br><span class=\"line\">\tself.size++ <span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x6808;&#x5927;&#x5C0F;&#x52A0;1</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x5E27;&#x51FA;&#x6808;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Stack)</span> <span class=\"hljs-title\">pop</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Frame</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> self._top == <span class=\"hljs-literal\">nil</span> { <span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x6808;&#x9876;&#x4E3A;&#x7A7A;&#x65F6;&#x62A5;&#x9519;</span></span><br><span class=\"line\">\t\t<span class=\"hljs-built_in\">panic</span>(<span class=\"hljs-string\">&quot;jvm stack is empty!&quot;</span>)</span><br><span class=\"line\">\t}</span><br><span class=\"line\"></span><br><span class=\"line\">\ttop := self._top <span class=\"hljs-comment\">//&#x53D6;&#x51FA;&#x5F53;&#x524D;&#x6808;&#x9876;&#x5E27;</span></span><br><span class=\"line\">\tself._top = top.lower <span class=\"hljs-comment\">//&#x5C06;&#x5F53;&#x524D;&#x6808;&#x9876;&#x6307;&#x5411;top&#x7684;&#x4E0B;&#x4E00;&#x5E27;</span></span><br><span class=\"line\">\ttop.lower = <span class=\"hljs-literal\">nil</span> <span class=\"hljs-comment\">//&#x65AD;&#x5F00;top&#x7684;&#x5C3E;&#x6307;&#x9488;</span></span><br><span class=\"line\">\tself.size-- <span class=\"hljs-comment\">//&#x5F53;&#x524D;&#x6808;&#x5927;&#x5C0F;&#x51CF;1</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> top <span class=\"hljs-comment\">//&#x8FD4;&#x56DE;top</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x6808;&#x9876;&#x5E27;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Stack)</span> <span class=\"hljs-title\">top</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Frame</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> self._top == <span class=\"hljs-literal\">nil</span> { <span class=\"hljs-comment\">////&#x5F53;&#x524D;&#x6808;&#x9876;&#x4E3A;&#x7A7A;&#x65F6;&#x62A5;&#x9519;</span></span><br><span class=\"line\">\t\t<span class=\"hljs-built_in\">panic</span>(<span class=\"hljs-string\">&quot;jvm stack is empty!&quot;</span>)</span><br><span class=\"line\">\t}</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self._top <span class=\"hljs-comment\">//&#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x6808;&#x9876;&#x5E27;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n\n<h4 id=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x5E27;\"><a href=\"#&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x5E27;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x5E27;\"></a>&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x5E27;</h4><figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> Frame <span class=\"hljs-keyword\">struct</span> {</span><br><span class=\"line\">\tlower        *Frame <span class=\"hljs-comment\">//&#x6307;&#x5411;&#x4E0B;&#x4E00;&#x5E27;</span></span><br><span class=\"line\">\tlocalVars    LocalVars <span class=\"hljs-comment\">//&#x4FDD;&#x5B58;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x8868;&#x6307;&#x9488;</span></span><br><span class=\"line\">\toperandStack *OperandStack <span class=\"hljs-comment\">//&#x4FDD;&#x5B58;&#x64CD;&#x4F5C;&#x6570;&#x6808;&#x6307;&#x9488;</span></span><br><span class=\"line\">\t<span class=\"hljs-comment\">// todo</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5B9E;&#x4F8B;&#x5316;&#x5E27;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">NewFrame</span><span class=\"hljs-params\">(maxLocals, maxStack <span class=\"hljs-keyword\">uint</span>)</span> *<span class=\"hljs-title\">Frame</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> &amp;Frame{</span><br><span class=\"line\">\t\tlocalVars:    newLocalVars(maxLocals), <span class=\"hljs-comment\">//&#x5B9E;&#x4F8B;&#x5316;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x5BF9;&#x8C61;</span></span><br><span class=\"line\">\t\toperandStack: newOperandStack(maxStack), <span class=\"hljs-comment\">//&#x5B9E;&#x4F8B;&#x5316;&#x64CD;&#x4F5C;&#x6570;&#x6808;&#x5BF9;&#x8C61;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// getters</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Frame)</span> <span class=\"hljs-title\">LocalVars</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">LocalVars</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.localVars</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *Frame)</span> <span class=\"hljs-title\">OperandStack</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">OperandStack</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.operandStack</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n\n<h4 id=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x8868;\"><a href=\"#&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x8868;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x8868;\"></a>&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x8868;</h4><figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> LocalVars []Slot</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x521B;&#x5EFA;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x5B9E;&#x4F8B;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newLocalVars</span><span class=\"hljs-params\">(maxLocals <span class=\"hljs-keyword\">uint</span>)</span> <span class=\"hljs-title\">LocalVars</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> maxLocals &gt; <span class=\"hljs-number\">0</span> {</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">make</span>([]Slot, maxLocals) <span class=\"hljs-comment\">//&#x7533;&#x660E;&#x5927;&#x5C0F;&#x4E3A;maxLocals&#x7684;Slot&#x6570;&#x7EC4;</span></span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x8BBE;&#x7F6E;int&#x7C7B;&#x578B;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">SetInt</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>, val <span class=\"hljs-keyword\">int32</span>)</span></span> {</span><br><span class=\"line\">\tself[index].num = val</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x53D6;int&#x7C7B;&#x578B;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">GetInt</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>)</span> <span class=\"hljs-title\">int32</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self[index].num</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x8BBE;&#x7F6E;float32&#x7C7B;&#x578B;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">SetFloat</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>, val <span class=\"hljs-keyword\">float32</span>)</span></span> {</span><br><span class=\"line\">\tbits := math.Float32bits(val)<span class=\"hljs-comment\">//&#x8F6C;&#x4E3A;uint32</span></span><br><span class=\"line\">\tself[index].num = <span class=\"hljs-keyword\">int32</span>(bits) <span class=\"hljs-comment\">//&#x8F6C;&#x4E3A;int32</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x53D6;float32&#x7C7B;&#x578B;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">GetFloat</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>)</span> <span class=\"hljs-title\">float32</span></span> {</span><br><span class=\"line\">\tbits := <span class=\"hljs-keyword\">uint32</span>(self[index].num)<span class=\"hljs-comment\">//&#x8F6C;&#x4E3A;unit32</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> math.Float32frombits(bits)<span class=\"hljs-comment\">//&#x8F6C;&#x4E3A;float</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x8BBE;&#x7F6E;long&#x7C7B;&#x578B;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">SetLong</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>, val <span class=\"hljs-keyword\">int64</span>)</span></span> {</span><br><span class=\"line\">\tself[index].num = <span class=\"hljs-keyword\">int32</span>(val)<span class=\"hljs-comment\">//&#x53D6;&#x4F4E;&#x4F4D;32&#x4F4D;&#x5B58;&#x50A8;&#x5728;index</span></span><br><span class=\"line\">\tself[index+<span class=\"hljs-number\">1</span>].num = <span class=\"hljs-keyword\">int32</span>(val &gt;&gt; <span class=\"hljs-number\">32</span>) <span class=\"hljs-comment\">//&#x53F3;&#x79FB;32&#x4F4D;&#x53D6;&#x9AD8;&#x4F4D;32&#x4F4D;&#x5B58;&#x50A8;&#x5728;index+1</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x53D6;long&#x7C7B;&#x578B;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">GetLong</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>)</span> <span class=\"hljs-title\">int64</span></span> {</span><br><span class=\"line\">\tlow := <span class=\"hljs-keyword\">uint32</span>(self[index].num) <span class=\"hljs-comment\">//&#x53D6;index&#x4F4E;32&#x4F4D;</span></span><br><span class=\"line\">\thigh := <span class=\"hljs-keyword\">uint32</span>(self[index+<span class=\"hljs-number\">1</span>].num) <span class=\"hljs-comment\">//&#x53D6;index+1&#x9AD8;32&#x4F4D;</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">int64</span>(high)&lt;&lt;<span class=\"hljs-number\">32</span> | <span class=\"hljs-keyword\">int64</span>(low) <span class=\"hljs-comment\">//&#x5DE6;&#x79FB;&#x9AD8;&#x4F4D;32&#x4F4D;&#xFF0C;&#x62FC;&#x63A5;&#x9AD8;&#x4F4E;&#x4F4D;&#x8FD4;&#x56DE;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x8BBE;&#x7F6E;float64</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">SetDouble</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>, val <span class=\"hljs-keyword\">float64</span>)</span></span> {</span><br><span class=\"line\">\tbits := math.Float64bits(val) <span class=\"hljs-comment\">//&#x8F6C;&#x4E3A;uint64</span></span><br><span class=\"line\">\tself.SetLong(index, <span class=\"hljs-keyword\">int64</span>(bits)) <span class=\"hljs-comment\">//&#x7528;long&#x578B;&#x8BBE;&#x7F6E;&#x65B9;&#x6CD5;&#x8BBE;&#x7F6E;int64</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x53D6;float64</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">GetDouble</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>)</span> <span class=\"hljs-title\">float64</span></span> {</span><br><span class=\"line\">\tbits := <span class=\"hljs-keyword\">uint64</span>(self.GetLong(index)) <span class=\"hljs-comment\">//&#x6309;long&#x578B;&#x53D6;&#x503C;&#x65B9;&#x6CD5;&#x53D6;&#x51FA;uint64</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> math.Float64frombits(bits) <span class=\"hljs-comment\">//&#x8F6C;&#x4E3A;float64</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x8BBE;&#x7F6E;&#x5F15;&#x7528;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">SetRef</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>, ref *Object)</span></span> {</span><br><span class=\"line\">\tself[index].ref = ref</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x53D6;&#x5F15;&#x7528;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self LocalVars)</span> <span class=\"hljs-title\">GetRef</span><span class=\"hljs-params\">(index <span class=\"hljs-keyword\">uint</span>)</span> *<span class=\"hljs-title\">Object</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self[index].ref</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n\n<h4 id=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x64CD;&#x4F5C;&#x6570;&#x6808;\"><a href=\"#&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x64CD;&#x4F5C;&#x6570;&#x6808;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x64CD;&#x4F5C;&#x6570;&#x6808;\"></a>&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x64CD;&#x4F5C;&#x6570;&#x6808;</h4><figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">type</span> OperandStack <span class=\"hljs-keyword\">struct</span> {</span><br><span class=\"line\">\tsize  <span class=\"hljs-keyword\">uint</span> <span class=\"hljs-comment\">//&#x8BB0;&#x5F55;&#x6808;&#x9876;&#x4F4D;&#x7F6E;</span></span><br><span class=\"line\">\tslots []Slot</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x5B9E;&#x4F8B;&#x5316;&#x64CD;&#x4F5C;&#x6570;&#x6808;</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-title\">newOperandStack</span><span class=\"hljs-params\">(maxStack <span class=\"hljs-keyword\">uint</span>)</span> *<span class=\"hljs-title\">OperandStack</span></span> {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> maxStack &gt; <span class=\"hljs-number\">0</span> {</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">return</span> &amp;OperandStack{</span><br><span class=\"line\">\t\t\tslots: <span class=\"hljs-built_in\">make</span>([]Slot, maxStack),<span class=\"hljs-comment\">//&#x7533;&#x660E;maxStack&#x5927;&#x5C0F;&#x7684;Slot&#x6570;&#x7EC4;</span></span><br><span class=\"line\">\t\t}</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span></span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PushInt</span><span class=\"hljs-params\">(val <span class=\"hljs-keyword\">int32</span>)</span></span> {</span><br><span class=\"line\">\tself.slots[self.size].num = val</span><br><span class=\"line\">\tself.size++</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PopInt</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">int32</span></span> {</span><br><span class=\"line\">\tself.size--</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> self.slots[self.size].num</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PushFloat</span><span class=\"hljs-params\">(val <span class=\"hljs-keyword\">float32</span>)</span></span> {</span><br><span class=\"line\">\tbits := math.Float32bits(val)</span><br><span class=\"line\">\tself.slots[self.size].num = <span class=\"hljs-keyword\">int32</span>(bits)</span><br><span class=\"line\">\tself.size++</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PopFloat</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">float32</span></span> {</span><br><span class=\"line\">\tself.size--</span><br><span class=\"line\">\tbits := <span class=\"hljs-keyword\">uint32</span>(self.slots[self.size].num)</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> math.Float32frombits(bits)</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// long consumes two slots</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PushLong</span><span class=\"hljs-params\">(val <span class=\"hljs-keyword\">int64</span>)</span></span> {</span><br><span class=\"line\">\tself.slots[self.size].num = <span class=\"hljs-keyword\">int32</span>(val)</span><br><span class=\"line\">\tself.slots[self.size+<span class=\"hljs-number\">1</span>].num = <span class=\"hljs-keyword\">int32</span>(val &gt;&gt; <span class=\"hljs-number\">32</span>)</span><br><span class=\"line\">\tself.size += <span class=\"hljs-number\">2</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PopLong</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">int64</span></span> {</span><br><span class=\"line\">\tself.size -= <span class=\"hljs-number\">2</span></span><br><span class=\"line\">\tlow := <span class=\"hljs-keyword\">uint32</span>(self.slots[self.size].num)</span><br><span class=\"line\">\thigh := <span class=\"hljs-keyword\">uint32</span>(self.slots[self.size+<span class=\"hljs-number\">1</span>].num)</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">int64</span>(high)&lt;&lt;<span class=\"hljs-number\">32</span> | <span class=\"hljs-keyword\">int64</span>(low)</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// double consumes two slots</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PushDouble</span><span class=\"hljs-params\">(val <span class=\"hljs-keyword\">float64</span>)</span></span> {</span><br><span class=\"line\">\tbits := math.Float64bits(val)</span><br><span class=\"line\">\tself.PushLong(<span class=\"hljs-keyword\">int64</span>(bits))</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PopDouble</span><span class=\"hljs-params\">()</span> <span class=\"hljs-title\">float64</span></span> {</span><br><span class=\"line\">\tbits := <span class=\"hljs-keyword\">uint64</span>(self.PopLong())</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> math.Float64frombits(bits)</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PushRef</span><span class=\"hljs-params\">(ref *Object)</span></span> {</span><br><span class=\"line\">\tself.slots[self.size].ref = ref</span><br><span class=\"line\">\tself.size++</span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">func</span> <span class=\"hljs-params\">(self *OperandStack)</span> <span class=\"hljs-title\">PopRef</span><span class=\"hljs-params\">()</span> *<span class=\"hljs-title\">Object</span></span> {</span><br><span class=\"line\">\tself.size--</span><br><span class=\"line\">\tref := self.slots[self.size].ref</span><br><span class=\"line\">\tself.slots[self.size].ref = <span class=\"hljs-literal\">nil</span></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> ref</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<h4 id=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x64CD;&#x4F5C;&#x6570;&#x6808;-1\"><a href=\"#&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x64CD;&#x4F5C;&#x6570;&#x6808;-1\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x64CD;&#x4F5C;&#x6570;&#x6808;\"></a>&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;-&#x64CD;&#x4F5C;&#x6570;&#x6808;</h4><figure class=\"highlight golang hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure></body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"JVM","path":"tags/JVM/"},{"name":"Java","path":"tags/Java/"},{"name":"Go","path":"tags/Go/"}],"excerpt":"<html><head></head><body><h3 id=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;\"><a href=\"#&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;\"></a>&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;</h3><p>JVM&#x5C06;&#x9700;&#x8981;&#x7528;&#x5230;&#x7684;&#x6570;&#x636E;&#x5B58;&#x653E;&#x5165;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;&#x5185;&#x5B58;&#x533A;&#x5C31;&#x53EB;&#x8FD0;&#x884C;&#x65F6;&#x6570;&#x636E;&#x533A;<br>&#x53EF;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#xFF1A;</p>\n<ol>\n<li>&#x4E00;&#x7C7B;&#x662F;&#x591A;&#x7EBF;&#x7A0B;&#x5171;&#x4EAB;&#x7684;&#xFF0C;&#x8BE5;&#x6570;&#x636E;&#x533A;&#x9700;&#x8981;&#x5728;Java&#x865A;&#x62DF;&#x673A;&#x542F;&#x52A8;&#x65F6;&#x521B;&#x5EFA;&#x597D;&#xFF0C;&#x5728;Java&#x865A;&#x62DF;&#x673A;&#x9000;&#x51FA;&#x65F6;&#x9500;&#x6BC1;&#x3002;</li>\n<li>&#x4E00;&#x7C7B;&#x5219;&#x662F;&#x7EBF;&#x7A0B;&#x79C1;&#x6709;&#x7684;&#xFF0C;&#x8BE5;&#x6570;&#x636E;&#x533A;&#x5219;&#x5728;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x65F6;&#x624D;&#x521B;&#x5EFA;&#xFF0C;&#x7EBF;&#x7A0B;&#x9000;&#x51FA;&#x65F6;&#x9500;&#x6BC1;&#x3002;</li>\n</ol></body></html>","more":"<p><img src=\"/2019/09/26/%E8%87%AA%E5%B7%B1%E5%8A%A8%E6%89%8B%E5%86%99Java%E8%99%9A%E6%8B%9F%E6%9C%BA-%E7%AC%94%E8%AE%B04/%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA.png\" alt=\"01\"></p>\n<h3 id=\"å®ç°\"><a href=\"#å®ç°\" class=\"headerlink\" title=\"å®ç°\"></a>å®ç°</h3><h4 id=\"å®šä¹‰å¯¹è±¡ç»“æ„\"><a href=\"#å®šä¹‰å¯¹è±¡ç»“æ„\" class=\"headerlink\" title=\"å®šä¹‰å¯¹è±¡ç»“æ„\"></a>å®šä¹‰å¯¹è±¡ç»“æ„</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Object <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// todo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-çº¿ç¨‹</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Thread <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tpc    <span class=\"keyword\">int</span> <span class=\"comment\">// the address of the instruction currently being executed</span></span><br><span class=\"line\">\tstack *Stack <span class=\"comment\">//Javaè™šæ‹Ÿæœºæ ˆæŒ‡é’ˆ</span></span><br><span class=\"line\">\t<span class=\"comment\">// todo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//åˆ›å»ºThreadå®ä¾‹</span></span><br><span class=\"line\"><span class=\"comment\">//javaå‘½ä»¤æä¾›äº†-Xssé€‰é¡¹æ¥è®¾ç½®Javaè™šæ‹Ÿæœºæ ˆå¤§å°</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewThread</span><span class=\"params\">()</span> *<span class=\"title\">Thread</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;Thread&#123;</span><br><span class=\"line\">\t\tstack: newStack(<span class=\"number\">1024</span>), <span class=\"comment\">//æœ€å¤šå®¹çº³1024å¸§</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Thread)</span> <span class=\"title\">PC</span><span class=\"params\">()</span> <span class=\"title\">int</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.pc</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Thread)</span> <span class=\"title\">SetPC</span><span class=\"params\">(pc <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\tself.pc = pc</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å½“å‰å¸§è¿›æ ˆ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Thread)</span> <span class=\"title\">PushFrame</span><span class=\"params\">(frame *Frame)</span></span> &#123;</span><br><span class=\"line\">\tself.stack.push(frame)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å½“å‰å¸§å‡ºæ ˆ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Thread)</span> <span class=\"title\">PopFrame</span><span class=\"params\">()</span> *<span class=\"title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.stack.pop()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//è·å–å½“å‰å¸§</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Thread)</span> <span class=\"title\">CurrentFrame</span><span class=\"params\">()</span> *<span class=\"title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.stack.top()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-Javaè™šæ‹Ÿæœºæ ˆ</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Stack <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tmaxSize <span class=\"keyword\">uint</span> <span class=\"comment\">//æœ€å¤šå¯ä»¥å®¹çº³å¤šå°‘å¸§</span></span><br><span class=\"line\">\tsize    <span class=\"keyword\">uint</span> <span class=\"comment\">//æ ˆçš„å½“å‰å¤§å°</span></span><br><span class=\"line\">\t_top    *Frame <span class=\"comment\">//ä¿å­˜æ ˆé¡¶æŒ‡é’ˆ</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å®ä¾‹ä¸€ä¸ªæ ˆ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newStack</span><span class=\"params\">(maxSize <span class=\"keyword\">uint</span>)</span> *<span class=\"title\">Stack</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;Stack&#123;</span><br><span class=\"line\">\t\tmaxSize: maxSize,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å½“å‰å¸§è¿›æ ˆ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Stack)</span> <span class=\"title\">push</span><span class=\"params\">(frame *Frame)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> self.size &gt;= self.maxSize &#123; <span class=\"comment\">//åˆ¤æ–­å½“å‰æ ˆå¤§å°æ˜¯å¦è¶…è¿‡æœ€å¤§å®¹é‡</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(<span class=\"string\">&quot;java.lang.StackOverflowError&quot;</span>) </span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> self._top != <span class=\"literal\">nil</span> &#123;  <span class=\"comment\">//å½“å‰æ ˆé¡¶ä¸ä¸ºç©ºæ—¶</span></span><br><span class=\"line\">\t\tframe.lower = self._top <span class=\"comment\">//å°†æ’å…¥å¸§å°¾æŒ‡å‘æ ˆé¡¶æŒ‡é’ˆ</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tself._top = frame <span class=\"comment\">//å½“å‰æ ˆé¡¶æŒ‡å‘å½“å‰å¸§</span></span><br><span class=\"line\">\tself.size++ <span class=\"comment\">//å½“å‰æ ˆå¤§å°åŠ 1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å½“å‰å¸§å‡ºæ ˆ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Stack)</span> <span class=\"title\">pop</span><span class=\"params\">()</span> *<span class=\"title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> self._top == <span class=\"literal\">nil</span> &#123; <span class=\"comment\">//å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(<span class=\"string\">&quot;jvm stack is empty!&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\ttop := self._top <span class=\"comment\">//å–å‡ºå½“å‰æ ˆé¡¶å¸§</span></span><br><span class=\"line\">\tself._top = top.lower <span class=\"comment\">//å°†å½“å‰æ ˆé¡¶æŒ‡å‘topçš„ä¸‹ä¸€å¸§</span></span><br><span class=\"line\">\ttop.lower = <span class=\"literal\">nil</span> <span class=\"comment\">//æ–­å¼€topçš„å°¾æŒ‡é’ˆ</span></span><br><span class=\"line\">\tself.size-- <span class=\"comment\">//å½“å‰æ ˆå¤§å°å‡1</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> top <span class=\"comment\">//è¿”å›top</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//è·å–å½“å‰æ ˆé¡¶å¸§</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Stack)</span> <span class=\"title\">top</span><span class=\"params\">()</span> *<span class=\"title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> self._top == <span class=\"literal\">nil</span> &#123; <span class=\"comment\">////å½“å‰æ ˆé¡¶ä¸ºç©ºæ—¶æŠ¥é”™</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">panic</span>(<span class=\"string\">&quot;jvm stack is empty!&quot;</span>)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self._top <span class=\"comment\">//è¿”å›å½“å‰æ ˆé¡¶å¸§</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-å¸§\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-å¸§</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Frame <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tlower        *Frame <span class=\"comment\">//æŒ‡å‘ä¸‹ä¸€å¸§</span></span><br><span class=\"line\">\tlocalVars    LocalVars <span class=\"comment\">//ä¿å­˜å±€éƒ¨å˜é‡è¡¨æŒ‡é’ˆ</span></span><br><span class=\"line\">\toperandStack *OperandStack <span class=\"comment\">//ä¿å­˜æ“ä½œæ•°æ ˆæŒ‡é’ˆ</span></span><br><span class=\"line\">\t<span class=\"comment\">// todo</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//å®ä¾‹åŒ–å¸§</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">NewFrame</span><span class=\"params\">(maxLocals, maxStack <span class=\"keyword\">uint</span>)</span> *<span class=\"title\">Frame</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> &amp;Frame&#123;</span><br><span class=\"line\">\t\tlocalVars:    newLocalVars(maxLocals), <span class=\"comment\">//å®ä¾‹åŒ–å±€éƒ¨å˜é‡å¯¹è±¡</span></span><br><span class=\"line\">\t\toperandStack: newOperandStack(maxStack), <span class=\"comment\">//å®ä¾‹åŒ–æ“ä½œæ•°æ ˆå¯¹è±¡</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// getters</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Frame)</span> <span class=\"title\">LocalVars</span><span class=\"params\">()</span> <span class=\"title\">LocalVars</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.localVars</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *Frame)</span> <span class=\"title\">OperandStack</span><span class=\"params\">()</span> *<span class=\"title\">OperandStack</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.operandStack</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-å±€éƒ¨å˜é‡è¡¨</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> LocalVars []Slot</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//åˆ›å»ºå±€éƒ¨å˜é‡å®ä¾‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newLocalVars</span><span class=\"params\">(maxLocals <span class=\"keyword\">uint</span>)</span> <span class=\"title\">LocalVars</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> maxLocals &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">make</span>([]Slot, maxLocals) <span class=\"comment\">//ç”³æ˜å¤§å°ä¸ºmaxLocalsçš„Slotæ•°ç»„</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®intç±»å‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">SetInt</span><span class=\"params\">(index <span class=\"keyword\">uint</span>, val <span class=\"keyword\">int32</span>)</span></span> &#123;</span><br><span class=\"line\">\tself[index].num = val</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å–intç±»å‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">GetInt</span><span class=\"params\">(index <span class=\"keyword\">uint</span>)</span> <span class=\"title\">int32</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self[index].num</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®float32ç±»å‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">SetFloat</span><span class=\"params\">(index <span class=\"keyword\">uint</span>, val <span class=\"keyword\">float32</span>)</span></span> &#123;</span><br><span class=\"line\">\tbits := math.Float32bits(val)<span class=\"comment\">//è½¬ä¸ºuint32</span></span><br><span class=\"line\">\tself[index].num = <span class=\"keyword\">int32</span>(bits) <span class=\"comment\">//è½¬ä¸ºint32</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å–float32ç±»å‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">GetFloat</span><span class=\"params\">(index <span class=\"keyword\">uint</span>)</span> <span class=\"title\">float32</span></span> &#123;</span><br><span class=\"line\">\tbits := <span class=\"keyword\">uint32</span>(self[index].num)<span class=\"comment\">//è½¬ä¸ºunit32</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> math.Float32frombits(bits)<span class=\"comment\">//è½¬ä¸ºfloat</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®longç±»å‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">SetLong</span><span class=\"params\">(index <span class=\"keyword\">uint</span>, val <span class=\"keyword\">int64</span>)</span></span> &#123;</span><br><span class=\"line\">\tself[index].num = <span class=\"keyword\">int32</span>(val)<span class=\"comment\">//å–ä½ä½32ä½å­˜å‚¨åœ¨index</span></span><br><span class=\"line\">\tself[index+<span class=\"number\">1</span>].num = <span class=\"keyword\">int32</span>(val &gt;&gt; <span class=\"number\">32</span>) <span class=\"comment\">//å³ç§»32ä½å–é«˜ä½32ä½å­˜å‚¨åœ¨index+1</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å–longç±»å‹</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">GetLong</span><span class=\"params\">(index <span class=\"keyword\">uint</span>)</span> <span class=\"title\">int64</span></span> &#123;</span><br><span class=\"line\">\tlow := <span class=\"keyword\">uint32</span>(self[index].num) <span class=\"comment\">//å–indexä½32ä½</span></span><br><span class=\"line\">\thigh := <span class=\"keyword\">uint32</span>(self[index+<span class=\"number\">1</span>].num) <span class=\"comment\">//å–index+1é«˜32ä½</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">int64</span>(high)&lt;&lt;<span class=\"number\">32</span> | <span class=\"keyword\">int64</span>(low) <span class=\"comment\">//å·¦ç§»é«˜ä½32ä½ï¼Œæ‹¼æ¥é«˜ä½ä½è¿”å›</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®float64</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">SetDouble</span><span class=\"params\">(index <span class=\"keyword\">uint</span>, val <span class=\"keyword\">float64</span>)</span></span> &#123;</span><br><span class=\"line\">\tbits := math.Float64bits(val) <span class=\"comment\">//è½¬ä¸ºuint64</span></span><br><span class=\"line\">\tself.SetLong(index, <span class=\"keyword\">int64</span>(bits)) <span class=\"comment\">//ç”¨longå‹è®¾ç½®æ–¹æ³•è®¾ç½®int64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å–float64</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">GetDouble</span><span class=\"params\">(index <span class=\"keyword\">uint</span>)</span> <span class=\"title\">float64</span></span> &#123;</span><br><span class=\"line\">\tbits := <span class=\"keyword\">uint64</span>(self.GetLong(index)) <span class=\"comment\">//æŒ‰longå‹å–å€¼æ–¹æ³•å–å‡ºuint64</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> math.Float64frombits(bits) <span class=\"comment\">//è½¬ä¸ºfloat64</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//è®¾ç½®å¼•ç”¨</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">SetRef</span><span class=\"params\">(index <span class=\"keyword\">uint</span>, ref *Object)</span></span> &#123;</span><br><span class=\"line\">\tself[index].ref = ref</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å–å¼•ç”¨</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self LocalVars)</span> <span class=\"title\">GetRef</span><span class=\"params\">(index <span class=\"keyword\">uint</span>)</span> *<span class=\"title\">Object</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self[index].ref</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> OperandStack <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\tsize  <span class=\"keyword\">uint</span> <span class=\"comment\">//è®°å½•æ ˆé¡¶ä½ç½®</span></span><br><span class=\"line\">\tslots []Slot</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//å®ä¾‹åŒ–æ“ä½œæ•°æ ˆ</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">newOperandStack</span><span class=\"params\">(maxStack <span class=\"keyword\">uint</span>)</span> *<span class=\"title\">OperandStack</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> maxStack &gt; <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> &amp;OperandStack&#123;</span><br><span class=\"line\">\t\t\tslots: <span class=\"built_in\">make</span>([]Slot, maxStack),<span class=\"comment\">//ç”³æ˜maxStackå¤§å°çš„Slotæ•°ç»„</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PushInt</span><span class=\"params\">(val <span class=\"keyword\">int32</span>)</span></span> &#123;</span><br><span class=\"line\">\tself.slots[self.size].num = val</span><br><span class=\"line\">\tself.size++</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PopInt</span><span class=\"params\">()</span> <span class=\"title\">int32</span></span> &#123;</span><br><span class=\"line\">\tself.size--</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> self.slots[self.size].num</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PushFloat</span><span class=\"params\">(val <span class=\"keyword\">float32</span>)</span></span> &#123;</span><br><span class=\"line\">\tbits := math.Float32bits(val)</span><br><span class=\"line\">\tself.slots[self.size].num = <span class=\"keyword\">int32</span>(bits)</span><br><span class=\"line\">\tself.size++</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PopFloat</span><span class=\"params\">()</span> <span class=\"title\">float32</span></span> &#123;</span><br><span class=\"line\">\tself.size--</span><br><span class=\"line\">\tbits := <span class=\"keyword\">uint32</span>(self.slots[self.size].num)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> math.Float32frombits(bits)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// long consumes two slots</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PushLong</span><span class=\"params\">(val <span class=\"keyword\">int64</span>)</span></span> &#123;</span><br><span class=\"line\">\tself.slots[self.size].num = <span class=\"keyword\">int32</span>(val)</span><br><span class=\"line\">\tself.slots[self.size+<span class=\"number\">1</span>].num = <span class=\"keyword\">int32</span>(val &gt;&gt; <span class=\"number\">32</span>)</span><br><span class=\"line\">\tself.size += <span class=\"number\">2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PopLong</span><span class=\"params\">()</span> <span class=\"title\">int64</span></span> &#123;</span><br><span class=\"line\">\tself.size -= <span class=\"number\">2</span></span><br><span class=\"line\">\tlow := <span class=\"keyword\">uint32</span>(self.slots[self.size].num)</span><br><span class=\"line\">\thigh := <span class=\"keyword\">uint32</span>(self.slots[self.size+<span class=\"number\">1</span>].num)</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">int64</span>(high)&lt;&lt;<span class=\"number\">32</span> | <span class=\"keyword\">int64</span>(low)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// double consumes two slots</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PushDouble</span><span class=\"params\">(val <span class=\"keyword\">float64</span>)</span></span> &#123;</span><br><span class=\"line\">\tbits := math.Float64bits(val)</span><br><span class=\"line\">\tself.PushLong(<span class=\"keyword\">int64</span>(bits))</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PopDouble</span><span class=\"params\">()</span> <span class=\"title\">float64</span></span> &#123;</span><br><span class=\"line\">\tbits := <span class=\"keyword\">uint64</span>(self.PopLong())</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> math.Float64frombits(bits)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PushRef</span><span class=\"params\">(ref *Object)</span></span> &#123;</span><br><span class=\"line\">\tself.slots[self.size].ref = ref</span><br><span class=\"line\">\tself.size++</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(self *OperandStack)</span> <span class=\"title\">PopRef</span><span class=\"params\">()</span> *<span class=\"title\">Object</span></span> &#123;</span><br><span class=\"line\">\tself.size--</span><br><span class=\"line\">\tref := self.slots[self.size].ref</span><br><span class=\"line\">\tself.slots[self.size].ref = <span class=\"literal\">nil</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ref</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ-1\"><a href=\"#è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ-1\" class=\"headerlink\" title=\"è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ\"></a>è¿è¡Œæ—¶æ•°æ®åŒº-æ“ä½œæ•°æ ˆ</h4><figure class=\"highlight golang\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜","date":"2019-09-24T06:36:13.000Z","_content":"\næ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š\n\n![01](è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜/wenti.png)\n<!-- more -->\n\nç»è¿‡è°ƒæŸ¥,ç”±äºé‡å†™äº†WebMvcConfigurationSupport.configureMessageConvertersæ–¹æ³•\n{% codeblock lang:java %}\n@Configuration\npublic class OpenServiceConfig extends WebMvcConfigurationSupport implements ApplicationRunner {\n\n    @Autowired\n    private Environment environment;\n\n    private ApiMappingHandlerMapping apiMappingHandlerMapping = new ApiMappingHandlerMapping();\n\n    @Override\n    protected RequestMappingHandlerMapping createRequestMappingHandlerMapping() {\n        return apiMappingHandlerMapping;\n    }\n\n    @Override\n    public void run(ApplicationArguments args) {\n        ApiMetaManager apiMetaManager = new ServiceZookeeperApiMetaManager(environment);\n        RequestMappingEvent requestMappingEvent = new DefaultRequestMappingEvent(apiMetaManager, environment);\n        requestMappingEvent.onRegisterSuccess(apiMappingHandlerMapping);\n    }\n\n    @Override\n    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {\n        converters.clear();\n        ObjectMapper objectMapper = new ObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);\n        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false);\n        converters.add(new MappingJackson2HttpMessageConverter(objectMapper));\n    }\n\n    @Override\n    protected void addResourceHandlers(ResourceHandlerRegistry registry) {\n        registry.addResourceHandler(\"swagger-ui.html\")\n                .addResourceLocations(\"classpath:/META-INF/resources/\");\n\n        registry.addResourceHandler(\"/webjars/**\")\n                .addResourceLocations(\"classpath:/META-INF/resources/webjars/\");\n    }\n}\n{% endcodeblock %}\n\nspringMVCå¼€å§‹åŠ è½½è½¬æ¢å™¨çš„æ—¶å€™ä¼šå…ˆèµ°ç”¨æˆ·å®šåˆ¶åŒ–æ–¹æ³•\n{% codeblock lang:java %}\n\tprotected final List<HttpMessageConverter<?>> getMessageConverters() {\n\t\tif (this.messageConverters == null) {\n\t\t\tthis.messageConverters = new ArrayList<HttpMessageConverter<?>>();\n\t\t\tconfigureMessageConverters(this.messageConverters);\n\t\t\tif (this.messageConverters.isEmpty()) {\n\t\t\t\taddDefaultHttpMessageConverters(this.messageConverters);\n\t\t\t}\n\t\t\textendMessageConverters(this.messageConverters);\n\t\t}\n\t\treturn this.messageConverters;\n\t}\n{% endcodeblock %}\n\nå¦‚æœç”¨æˆ·æ²¡æœ‰å®šåˆ¶åŒ–ï¼Œspringmvcä¼šä½¿ç”¨è‡ªå®šä¸ªçš„7ä¸ªè½¬æ¢å™¨\n{% codeblock lang:java %}\n\tprotected final void addDefaultHttpMessageConverters(List<HttpMessageConverter<?>> messageConverters) {\n\t\tStringHttpMessageConverter stringConverter = new StringHttpMessageConverter();\n\t\tstringConverter.setWriteAcceptCharset(false);\n\n\t\tmessageConverters.add(new ByteArrayHttpMessageConverter());\n\t\tmessageConverters.add(stringConverter);\n\t\tmessageConverters.add(new ResourceHttpMessageConverter());\n\t\tmessageConverters.add(new SourceHttpMessageConverter<Source>());\n\t\tmessageConverters.add(new AllEncompassingFormHttpMessageConverter());\n\n\t\tif (romePresent) {\n\t\t\tmessageConverters.add(new AtomFeedHttpMessageConverter());\n\t\t\tmessageConverters.add(new RssChannelHttpMessageConverter());\n\t\t}\n\n\t\tif (jackson2XmlPresent) {\n\t\t\tmessageConverters.add(new MappingJackson2XmlHttpMessageConverter(\n\t\t\t\t\tJackson2ObjectMapperBuilder.xml().applicationContext(this.applicationContext).build()));\n\t\t}\n\t\telse if (jaxb2Present) {\n\t\t\tmessageConverters.add(new Jaxb2RootElementHttpMessageConverter());\n\t\t}\n\n\t\tif (jackson2Present) {\n\t\t\tmessageConverters.add(new MappingJackson2HttpMessageConverter(\n\t\t\t\t\tJackson2ObjectMapperBuilder.json().applicationContext(this.applicationContext).build()));\n\t\t}\n\t\telse if (gsonPresent) {\n\t\t\tmessageConverters.add(new GsonHttpMessageConverter());\n\t\t}\n\t}\n{% endcodeblock %}\n\nç”±äºé¡¹ç›®åœ¨è‡ªå®šä¹‰çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½è¿™ç§å­—èŠ‚æµçš„è§£æï¼Œå¯¼è‡´åºåˆ—åŒ–å¤±è´¥\nå¢åŠ é…ç½®è§£å†³é—®é¢˜\n{% codeblock lang:java %}\nobjectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false);\n{% endcodeblock %}","source":"_posts/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜.md","raw":"---\ntitle: è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜\ndate: 2019-09-24 14:36:13\ntags:\n    - Java\n    - Spring Boot\ncategories:\n    - Technology\n---\n\næ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ—¶å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š\n\n![01](è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜/wenti.png)\n<!-- more -->\n\nç»è¿‡è°ƒæŸ¥,ç”±äºé‡å†™äº†WebMvcConfigurationSupport.configureMessageConvertersæ–¹æ³•\n{% codeblock lang:java %}\n@Configuration\npublic class OpenServiceConfig extends WebMvcConfigurationSupport implements ApplicationRunner {\n\n    @Autowired\n    private Environment environment;\n\n    private ApiMappingHandlerMapping apiMappingHandlerMapping = new ApiMappingHandlerMapping();\n\n    @Override\n    protected RequestMappingHandlerMapping createRequestMappingHandlerMapping() {\n        return apiMappingHandlerMapping;\n    }\n\n    @Override\n    public void run(ApplicationArguments args) {\n        ApiMetaManager apiMetaManager = new ServiceZookeeperApiMetaManager(environment);\n        RequestMappingEvent requestMappingEvent = new DefaultRequestMappingEvent(apiMetaManager, environment);\n        requestMappingEvent.onRegisterSuccess(apiMappingHandlerMapping);\n    }\n\n    @Override\n    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {\n        converters.clear();\n        ObjectMapper objectMapper = new ObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);\n        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false);\n        converters.add(new MappingJackson2HttpMessageConverter(objectMapper));\n    }\n\n    @Override\n    protected void addResourceHandlers(ResourceHandlerRegistry registry) {\n        registry.addResourceHandler(\"swagger-ui.html\")\n                .addResourceLocations(\"classpath:/META-INF/resources/\");\n\n        registry.addResourceHandler(\"/webjars/**\")\n                .addResourceLocations(\"classpath:/META-INF/resources/webjars/\");\n    }\n}\n{% endcodeblock %}\n\nspringMVCå¼€å§‹åŠ è½½è½¬æ¢å™¨çš„æ—¶å€™ä¼šå…ˆèµ°ç”¨æˆ·å®šåˆ¶åŒ–æ–¹æ³•\n{% codeblock lang:java %}\n\tprotected final List<HttpMessageConverter<?>> getMessageConverters() {\n\t\tif (this.messageConverters == null) {\n\t\t\tthis.messageConverters = new ArrayList<HttpMessageConverter<?>>();\n\t\t\tconfigureMessageConverters(this.messageConverters);\n\t\t\tif (this.messageConverters.isEmpty()) {\n\t\t\t\taddDefaultHttpMessageConverters(this.messageConverters);\n\t\t\t}\n\t\t\textendMessageConverters(this.messageConverters);\n\t\t}\n\t\treturn this.messageConverters;\n\t}\n{% endcodeblock %}\n\nå¦‚æœç”¨æˆ·æ²¡æœ‰å®šåˆ¶åŒ–ï¼Œspringmvcä¼šä½¿ç”¨è‡ªå®šä¸ªçš„7ä¸ªè½¬æ¢å™¨\n{% codeblock lang:java %}\n\tprotected final void addDefaultHttpMessageConverters(List<HttpMessageConverter<?>> messageConverters) {\n\t\tStringHttpMessageConverter stringConverter = new StringHttpMessageConverter();\n\t\tstringConverter.setWriteAcceptCharset(false);\n\n\t\tmessageConverters.add(new ByteArrayHttpMessageConverter());\n\t\tmessageConverters.add(stringConverter);\n\t\tmessageConverters.add(new ResourceHttpMessageConverter());\n\t\tmessageConverters.add(new SourceHttpMessageConverter<Source>());\n\t\tmessageConverters.add(new AllEncompassingFormHttpMessageConverter());\n\n\t\tif (romePresent) {\n\t\t\tmessageConverters.add(new AtomFeedHttpMessageConverter());\n\t\t\tmessageConverters.add(new RssChannelHttpMessageConverter());\n\t\t}\n\n\t\tif (jackson2XmlPresent) {\n\t\t\tmessageConverters.add(new MappingJackson2XmlHttpMessageConverter(\n\t\t\t\t\tJackson2ObjectMapperBuilder.xml().applicationContext(this.applicationContext).build()));\n\t\t}\n\t\telse if (jaxb2Present) {\n\t\t\tmessageConverters.add(new Jaxb2RootElementHttpMessageConverter());\n\t\t}\n\n\t\tif (jackson2Present) {\n\t\t\tmessageConverters.add(new MappingJackson2HttpMessageConverter(\n\t\t\t\t\tJackson2ObjectMapperBuilder.json().applicationContext(this.applicationContext).build()));\n\t\t}\n\t\telse if (gsonPresent) {\n\t\t\tmessageConverters.add(new GsonHttpMessageConverter());\n\t\t}\n\t}\n{% endcodeblock %}\n\nç”±äºé¡¹ç›®åœ¨è‡ªå®šä¹‰çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½è¿™ç§å­—èŠ‚æµçš„è§£æï¼Œå¯¼è‡´åºåˆ—åŒ–å¤±è´¥\nå¢åŠ é…ç½®è§£å†³é—®é¢˜\n{% codeblock lang:java %}\nobjectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false);\n{% endcodeblock %}","slug":"è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜","published":1,"updated":"2020-12-14T10:25:51.707Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71hty0021v2526zju8kpj","content":"<html><head></head><body><p>&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x4E0B;&#x8F7D;&#x65F6;&#x51FA;&#x73B0;&#x4EE5;&#x4E0B;&#x9519;&#x8BEF;&#xFF1A;</p>\n<p><img src=\"/2019/09/24/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%B1%E8%B4%A5%E5%AF%BC%E8%87%B4%E7%9A%84%E7%94%9F%E4%BA%A7%E9%97%AE%E9%A2%98/wenti.png\" alt=\"01\"></p>\n<a id=\"more\"></a>\n\n<p>&#x7ECF;&#x8FC7;&#x8C03;&#x67E5;,&#x7531;&#x4E8E;&#x91CD;&#x5199;&#x4E86;WebMvcConfigurationSupport.configureMessageConverters&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OpenServiceConfig</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">WebMvcConfigurationSupport</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">ApplicationRunner</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> Environment environment;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> ApiMappingHandlerMapping apiMappingHandlerMapping = <span class=\"hljs-keyword\">new</span> ApiMappingHandlerMapping();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> RequestMappingHandlerMapping <span class=\"hljs-title\">createRequestMappingHandlerMapping</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> apiMappingHandlerMapping;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">run</span><span class=\"hljs-params\">(ApplicationArguments args)</span> </span>{</span><br><span class=\"line\">        ApiMetaManager apiMetaManager = <span class=\"hljs-keyword\">new</span> ServiceZookeeperApiMetaManager(environment);</span><br><span class=\"line\">        RequestMappingEvent requestMappingEvent = <span class=\"hljs-keyword\">new</span> DefaultRequestMappingEvent(apiMetaManager, environment);</span><br><span class=\"line\">        requestMappingEvent.onRegisterSuccess(apiMappingHandlerMapping);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">configureMessageConverters</span><span class=\"hljs-params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>{</span><br><span class=\"line\">        converters.clear();</span><br><span class=\"line\">        ObjectMapper objectMapper = <span class=\"hljs-keyword\">new</span> ObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br><span class=\"line\">        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,<span class=\"hljs-keyword\">false</span>);</span><br><span class=\"line\">        converters.add(<span class=\"hljs-keyword\">new</span> MappingJackson2HttpMessageConverter(objectMapper));</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">addResourceHandlers</span><span class=\"hljs-params\">(ResourceHandlerRegistry registry)</span> </span>{</span><br><span class=\"line\">        registry.addResourceHandler(<span class=\"hljs-string\">&quot;swagger-ui.html&quot;</span>)</span><br><span class=\"line\">                .addResourceLocations(<span class=\"hljs-string\">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        registry.addResourceHandler(<span class=\"hljs-string\">&quot;/webjars/**&quot;</span>)</span><br><span class=\"line\">                .addResourceLocations(<span class=\"hljs-string\">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>springMVC&#x5F00;&#x59CB;&#x52A0;&#x8F7D;&#x8F6C;&#x6362;&#x5668;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x5148;&#x8D70;&#x7528;&#x6237;&#x5B9A;&#x5236;&#x5316;&#x65B9;&#x6CD5;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">final</span> List&lt;HttpMessageConverter&lt;?&gt;&gt; getMessageConverters() {</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">this</span>.messageConverters == <span class=\"hljs-keyword\">null</span>) {</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">this</span>.messageConverters = <span class=\"hljs-keyword\">new</span> ArrayList&lt;HttpMessageConverter&lt;?&gt;&gt;();</span><br><span class=\"line\">\t\tconfigureMessageConverters(<span class=\"hljs-keyword\">this</span>.messageConverters);</span><br><span class=\"line\">\t\t<span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">this</span>.messageConverters.isEmpty()) {</span><br><span class=\"line\">\t\t\taddDefaultHttpMessageConverters(<span class=\"hljs-keyword\">this</span>.messageConverters);</span><br><span class=\"line\">\t\t}</span><br><span class=\"line\">\t\textendMessageConverters(<span class=\"hljs-keyword\">this</span>.messageConverters);</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">this</span>.messageConverters;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x5982;&#x679C;&#x7528;&#x6237;&#x6CA1;&#x6709;&#x5B9A;&#x5236;&#x5316;&#xFF0C;springmvc&#x4F1A;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E2A;&#x7684;7&#x4E2A;&#x8F6C;&#x6362;&#x5668;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">addDefaultHttpMessageConverters</span><span class=\"hljs-params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters)</span> </span>{</span><br><span class=\"line\">\tStringHttpMessageConverter stringConverter = <span class=\"hljs-keyword\">new</span> StringHttpMessageConverter();</span><br><span class=\"line\">\tstringConverter.setWriteAcceptCharset(<span class=\"hljs-keyword\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> ByteArrayHttpMessageConverter());</span><br><span class=\"line\">\tmessageConverters.add(stringConverter);</span><br><span class=\"line\">\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> ResourceHttpMessageConverter());</span><br><span class=\"line\">\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> SourceHttpMessageConverter&lt;Source&gt;());</span><br><span class=\"line\">\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> AllEncompassingFormHttpMessageConverter());</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> (romePresent) {</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> AtomFeedHttpMessageConverter());</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> RssChannelHttpMessageConverter());</span><br><span class=\"line\">\t}</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> (jackson2XmlPresent) {</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> MappingJackson2XmlHttpMessageConverter(</span><br><span class=\"line\">\t\t\t\tJackson2ObjectMapperBuilder.xml().applicationContext(<span class=\"hljs-keyword\">this</span>.applicationContext).build()));</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (jaxb2Present) {</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> Jaxb2RootElementHttpMessageConverter());</span><br><span class=\"line\">\t}</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"hljs-keyword\">if</span> (jackson2Present) {</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> MappingJackson2HttpMessageConverter(</span><br><span class=\"line\">\t\t\t\tJackson2ObjectMapperBuilder.json().applicationContext(<span class=\"hljs-keyword\">this</span>.applicationContext).build()));</span><br><span class=\"line\">\t}</span><br><span class=\"line\">\t<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (gsonPresent) {</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"hljs-keyword\">new</span> GsonHttpMessageConverter());</span><br><span class=\"line\">\t}</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x7531;&#x4E8E;&#x9879;&#x76EE;&#x5728;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x65F6;&#x5019;&#x6CA1;&#x6709;&#x8003;&#x8651;&#x5230;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x4E0B;&#x8F7D;&#x8FD9;&#x79CD;&#x5B57;&#x8282;&#x6D41;&#x7684;&#x89E3;&#x6790;&#xFF0C;&#x5BFC;&#x81F4;&#x5E8F;&#x5217;&#x5316;&#x5931;&#x8D25;<br>&#x589E;&#x52A0;&#x914D;&#x7F6E;&#x89E3;&#x51B3;&#x95EE;&#x9898;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">objectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, <span class=\"hljs-keyword\">false</span>);</span><br></pre></td></tr></tbody></table></figure></body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Spring Boot","path":"tags/Spring-Boot/"}],"excerpt":"<html><head></head><body><p>&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x4E0B;&#x8F7D;&#x65F6;&#x51FA;&#x73B0;&#x4EE5;&#x4E0B;&#x9519;&#x8BEF;&#xFF1A;</p>\n<p><img src=\"/2019/09/24/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%B1%E8%B4%A5%E5%AF%BC%E8%87%B4%E7%9A%84%E7%94%9F%E4%BA%A7%E9%97%AE%E9%A2%98/wenti.png\" alt=\"01\"></p></body></html>","more":"<p>ç»è¿‡è°ƒæŸ¥,ç”±äºé‡å†™äº†WebMvcConfigurationSupport.configureMessageConvertersæ–¹æ³•</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">OpenServiceConfig</span> <span class=\"keyword\">extends</span> <span class=\"title\">WebMvcConfigurationSupport</span> <span class=\"keyword\">implements</span> <span class=\"title\">ApplicationRunner</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Environment environment;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ApiMappingHandlerMapping apiMappingHandlerMapping = <span class=\"keyword\">new</span> ApiMappingHandlerMapping();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> RequestMappingHandlerMapping <span class=\"title\">createRequestMappingHandlerMapping</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> apiMappingHandlerMapping;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">(ApplicationArguments args)</span> </span>&#123;</span><br><span class=\"line\">        ApiMetaManager apiMetaManager = <span class=\"keyword\">new</span> ServiceZookeeperApiMetaManager(environment);</span><br><span class=\"line\">        RequestMappingEvent requestMappingEvent = <span class=\"keyword\">new</span> DefaultRequestMappingEvent(apiMetaManager, environment);</span><br><span class=\"line\">        requestMappingEvent.onRegisterSuccess(apiMappingHandlerMapping);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">configureMessageConverters</span><span class=\"params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class=\"line\">        converters.clear();</span><br><span class=\"line\">        ObjectMapper objectMapper = <span class=\"keyword\">new</span> ObjectMapper().setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br><span class=\"line\">        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,<span class=\"keyword\">false</span>);</span><br><span class=\"line\">        converters.add(<span class=\"keyword\">new</span> MappingJackson2HttpMessageConverter(objectMapper));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">addResourceHandlers</span><span class=\"params\">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class=\"line\">        registry.addResourceHandler(<span class=\"string\">&quot;swagger-ui.html&quot;</span>)</span><br><span class=\"line\">                .addResourceLocations(<span class=\"string\">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        registry.addResourceHandler(<span class=\"string\">&quot;/webjars/**&quot;</span>)</span><br><span class=\"line\">                .addResourceLocations(<span class=\"string\">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>springMVCå¼€å§‹åŠ è½½è½¬æ¢å™¨çš„æ—¶å€™ä¼šå…ˆèµ°ç”¨æˆ·å®šåˆ¶åŒ–æ–¹æ³•</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">final</span> List&lt;HttpMessageConverter&lt;?&gt;&gt; getMessageConverters() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.messageConverters == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>.messageConverters = <span class=\"keyword\">new</span> ArrayList&lt;HttpMessageConverter&lt;?&gt;&gt;();</span><br><span class=\"line\">\t\tconfigureMessageConverters(<span class=\"keyword\">this</span>.messageConverters);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.messageConverters.isEmpty()) &#123;</span><br><span class=\"line\">\t\t\taddDefaultHttpMessageConverters(<span class=\"keyword\">this</span>.messageConverters);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\textendMessageConverters(<span class=\"keyword\">this</span>.messageConverters);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.messageConverters;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¦‚æœç”¨æˆ·æ²¡æœ‰å®šåˆ¶åŒ–ï¼Œspringmvcä¼šä½¿ç”¨è‡ªå®šä¸ªçš„7ä¸ªè½¬æ¢å™¨</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title\">addDefaultHttpMessageConverters</span><span class=\"params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters)</span> </span>&#123;</span><br><span class=\"line\">\tStringHttpMessageConverter stringConverter = <span class=\"keyword\">new</span> StringHttpMessageConverter();</span><br><span class=\"line\">\tstringConverter.setWriteAcceptCharset(<span class=\"keyword\">false</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\tmessageConverters.add(<span class=\"keyword\">new</span> ByteArrayHttpMessageConverter());</span><br><span class=\"line\">\tmessageConverters.add(stringConverter);</span><br><span class=\"line\">\tmessageConverters.add(<span class=\"keyword\">new</span> ResourceHttpMessageConverter());</span><br><span class=\"line\">\tmessageConverters.add(<span class=\"keyword\">new</span> SourceHttpMessageConverter&lt;Source&gt;());</span><br><span class=\"line\">\tmessageConverters.add(<span class=\"keyword\">new</span> AllEncompassingFormHttpMessageConverter());</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (romePresent) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"keyword\">new</span> AtomFeedHttpMessageConverter());</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"keyword\">new</span> RssChannelHttpMessageConverter());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (jackson2XmlPresent) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"keyword\">new</span> MappingJackson2XmlHttpMessageConverter(</span><br><span class=\"line\">\t\t\t\tJackson2ObjectMapperBuilder.xml().applicationContext(<span class=\"keyword\">this</span>.applicationContext).build()));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (jaxb2Present) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"keyword\">new</span> Jaxb2RootElementHttpMessageConverter());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (jackson2Present) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"keyword\">new</span> MappingJackson2HttpMessageConverter(</span><br><span class=\"line\">\t\t\t\tJackson2ObjectMapperBuilder.json().applicationContext(<span class=\"keyword\">this</span>.applicationContext).build()));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (gsonPresent) &#123;</span><br><span class=\"line\">\t\tmessageConverters.add(<span class=\"keyword\">new</span> GsonHttpMessageConverter());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç”±äºé¡¹ç›®åœ¨è‡ªå®šä¹‰çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½è¿™ç§å­—èŠ‚æµçš„è§£æï¼Œå¯¼è‡´åºåˆ—åŒ–å¤±è´¥<br>å¢åŠ é…ç½®è§£å†³é—®é¢˜</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">objectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, <span class=\"keyword\">false</span>);</span><br></pre></td></tr></table></figure>"},{"title":"ğŸ‡","date":"2019-09-05T05:19:02.000Z","_content":"\nå¤§ç™½å…”ã€‚ã€‚ä½ å˜äº†ã€‚ã€‚ã€‚\n\n![01](ğŸ‡/ç‰Œå­.jpeg)\n<!-- more -->\n\n![02](ğŸ‡/å…¨æ™¯.jpeg)","source":"_posts/ğŸ‡.md","raw":"---\ntitle: \"\\U0001F407\"\ndate: 2019-09-05 13:19:02\ntags: \n    - Food\ncategories :\n    - Life\n---\n\nå¤§ç™½å…”ã€‚ã€‚ä½ å˜äº†ã€‚ã€‚ã€‚\n\n![01](ğŸ‡/ç‰Œå­.jpeg)\n<!-- more -->\n\n![02](ğŸ‡/å…¨æ™¯.jpeg)","slug":"ğŸ‡","published":1,"updated":"2020-12-14T10:17:56.593Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71htz0023v2523flh1jar","content":"<html><head></head><body><p>&#x5927;&#x767D;&#x5154;&#x3002;&#x3002;&#x4F60;&#x53D8;&#x4E86;&#x3002;&#x3002;&#x3002;</p>\n<p><img src=\"/2019/09/05/%F0%9F%90%87/%E7%89%8C%E5%AD%90.jpeg\" alt=\"01\"></p>\n<a id=\"more\"></a>\n\n<p><img src=\"/2019/09/05/%F0%9F%90%87/%E5%85%A8%E6%99%AF.jpeg\" alt=\"02\"></p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Life","path":"categories/Life/"}],"_tags":[{"name":"Food","path":"tags/Food/"}],"excerpt":"<html><head></head><body><p>&#x5927;&#x767D;&#x5154;&#x3002;&#x3002;&#x4F60;&#x53D8;&#x4E86;&#x3002;&#x3002;&#x3002;</p>\n<p><img src=\"/2019/09/05/%F0%9F%90%87/%E7%89%8C%E5%AD%90.jpeg\" alt=\"01\"></p></body></html>","more":"<p><img src=\"/2019/09/05/%F0%9F%90%87/%E5%85%A8%E6%99%AF.jpeg\" alt=\"02\"></p>"},{"title":"fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥","date":"2020-08-17T02:43:05.000Z","_content":"\nfastjsonä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„javaåºåˆ—åŒ–ç±»åº“ï¼Œå…¶æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯å¿«ï¼Œå› æ­¤ä¹Ÿè¢«å›½å†…å„ä¸ªä¸­å°å‹å…¬å¸å¤§é‡çš„ä½¿ç”¨ã€‚ä½†å®ƒä¹Ÿæœ‰ä¸å°‘çŸ­æ¿ï¼Œå¦‚å¯å®šåˆ¶æ€§ä½ã€APIä¸å¤Ÿä¸°å¯Œã€ä»£ç è´¨é‡åŠæ–‡æ¡£ç¼ºå¤±ç­‰ä¸€äº›åˆ—é—®é¢˜ä¸€ç›´è¢«äººæ‰€è¯Ÿç—…ã€‚\n\næœ¬æ¬¡æˆ‘ä»¬ç¢°åˆ°çš„é—®é¢˜å°±æ˜¯ç”±fastjsonçš„ä¸€ä¸ªç®€å•bugè€Œå¼•èµ·çš„ä¸€è¿ä¸²ç ”ç©¶ã€‚\n<!-- more -->\n## å‘ç°bug\næŸæ—¥ä¸€ä½åŒå­¦åœ¨è°ƒè¯•æ–°éœ€æ±‚çš„æ—¶å€™å‘ç°å¦‚ä¸‹é”™è¯¯æ—¥å¿—ï¼š\n``` java\nException in thread \"collection-eventbus-thread-1\" java.lang.NoSuchMethodError: com.alibaba.fastjson.serializer.JavaBeanSerializer.processValue(Lcom/alibaba/fastjson/serializer/JSONSerializer;Lcom/alibaba/fastjson/serializer/BeanContext;Ljava/lang/Object;Ljava/lang/String;Ljava/lang/Object;)Ljava/lang/Object;Ljava/lang/Integer;\n\tat com.alibaba.fastjson.serializer.ASMSerializer_6_FastJsonSerializerWrapper.writeNormal(Unknown Source)\n\tat com.alibaba.fastjson.serializer.ASMSerializer_6_FastJsonSerializerWrapper.write(Unknown Source)\n\tat com.alibaba.fastjson.serializer.JSONSerializer.write(JSONSerializer.java:285)\n\tat com.alibaba.fastjson.JSON.toJSONString(JSON.java:663)\n\tat com.alibaba.fastjson.JSON.toJSONString(JSON.java:652)\n\tat com.oriente.cache.layeringCache.serializer.FastJsonRedisSerializer.serialize(FastJsonRedisSerializer.java:37)\n\tat org.springframework.data.redis.core.AbstractOperations.rawValue(AbstractOperations.java:117)\n\tat org.springframework.data.redis.core.DefaultValueOperations.multiSet(DefaultValueOperations.java:136)\n\tat com.oriente.collection.event.listener.RedisEventListener.schedule(RedisEventListener.java:75)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat com.google.common.eventbus.Subscriber.invokeSubscriberMethod(Subscriber.java:87)\n\tat com.google.common.eventbus.Subscriber$SynchronizedSubscriber.invokeSubscriberMethod(Subscriber.java:144)\n\tat com.google.common.eventbus.Subscriber$1.run(Subscriber.java:72)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat java.lang.Thread.run(Thread.java:748)\n```\n\né€šè¿‡è§‚å¯Ÿé”™è¯¯ï¼Œå¾ˆå¿«å°±èƒ½å®šä½åˆ°æ˜¯fastjsonåºåˆ—åŒ–çš„æ—¶å€™å‡ºç°äº†é”™è¯¯ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿç¡®è®¤çš„ä»£ç ï¼Œåœ¨è‡ªå®šçš„RedisTemplateä¸­ï¼Œé’ˆå¯¹Valueçš„åºåˆ—åŒ–å·¥å…·æˆ‘ä»¬çš„ç¡®ä½¿ç”¨äº†fastjsonçš„åºåˆ—åŒ–æ–¹å¼ã€‚\n\n- RedisTemplateä½¿ç”¨è‡ªå®šä¹‰çš„fastjosonåºåˆ—åŒ–å·¥å…·\n``` java\n        FastJsonRedisSerializer<Object> fastJsonRedisSerializer = new FastJsonRedisSerializer<>(Object.class);\n\n        redisTemplate.setValueSerializer(fastJsonRedisSerializer);\n```\n\n- FastJsonRedisSerializerä¸­ä½¿ç”¨fastjsonçš„APIå¯¹ç»Ÿä¸€åŒ…è£…ç±»è¿›è¡Œåºåˆ—åŒ–\n``` java\n    @Override\n    public byte[] serialize(T t) throws SerializationException {\n        try {\n            return JSON.toJSONString(new FastJsonSerializerWrapper(t), SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET);\n        } catch (Exception e) {\n            throw new SerializationException(String.format(\"FastJsonRedisSerializer åºåˆ—åŒ–å¼‚å¸¸: %s, ã€JSONï¼š%sã€‘\",\n                    e.getMessage(), JSON.toJSONString(t)), e);\n\n        }\n    }\n```\n\n## åˆ†æbug\nç»è¿‡ä¸Šé¢çš„ä¸€é¡¿æ’æŸ¥ï¼Œé—®é¢˜å·²ç»å¾ˆæ˜ç¡®å®šä½åˆ°æ˜¯fastjsonä¸Šäº†ï¼Œå¹¶ä¸”é”™è¯¯ä¿¡æ¯ç»™çš„ç›¸å½“æ˜ç¡®ï¼š\n\n  <font color=red> ` java.lang.NoSuchMethodError: com.alibaba.fastjson.serializer.JavaBeanSerializer.processValue(Lcom/alibaba/fastjson/serializer/JSONSerializer;Lcom/alibaba/fastjson/serializer/BeanContext;Ljava/lang/Object;Ljava/lang/String;Ljava/lang/Object;)Ljava/lang/Object;Ljava/lang/Integer; ` </font>\n\næç¤ºæœªæ‰¾åˆ°JavaBeanSerializer.processValueæ–¹æ³•ã€‚okæˆ‘ä»¬ç«‹é©¬æŸ¥è¯¢JavaBeanSerializeræºç ï¼Œå‘ç°processalueæ–¹æ³•æ˜¯ç»§æ‰¿è‡ªSerializeFilterableç±»ï¼š\n> æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.JavaBeanSerializer\n``` java\n    protected Object processValue(JSONSerializer jsonBeanDeser, //\n                               BeanContext beanContext,\n                               Object object, //\n                               String key, //\n                               Object propertyValue, //\n                               int features) {\n```\n\nä¹ä¸€çœ‹æ–¹æ³•æ˜¯å­˜åœ¨çš„ï¼Œè¿™æ˜¯æˆ‘ä»¬åˆå›åˆ°äº†é”™è¯¯æœ¬èº«ã€‚ä»”ç»†æŸ¥çœ‹é”™è¯¯ï¼Œé”™è¯¯ä¸­æç¤ºæˆ‘ä»¬processValueæ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š\n\nå…¥å‚ï¼š\n1. Lcom/alibaba/fastjson/serializer/JSONSerializer <font color=green>--JSONSerializerç±»å‹çš„å¯¹è±¡</font>\n2. Lcom/alibaba/fastjson/serializer/BeanContext <font color=green>--BeanContextç±»å‹çš„å¯¹è±¡</font>\n3. Ljava/lang/Object <font color=green>--Objectå¯¹è±¡</font>\n4. Ljava/lang/String <font color=green>--String ç±»å‹</font>\n5. Ljava/lang/Object <font color=green>--Objectå¯¹è±¡</font>\n\nè¿”å›å‚æ•°ï¼š\n1. Ljava/lang/Object;Ljava/lang/Integer; <font color=green>--è¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿjavaçš„è¿”å›å‚æ•°åº”è¯¥æ˜¯ä¸æ”¯æŒä¸¤ä¸ªæ‰å¯¹å•Šï¼</font>\n\nç»è¿‡å¯¹æ¯”ï¼Œæœç„¶æ–¹æ³•ç­¾åä¸ä¸€è‡´ã€‚æºç ä¸­SerializeFilterable.processValue()æ–¹æ³•ä¸­æœ‰6ä¸ªå…¥å‚ï¼Œè€Œé”™è¯¯æ—¥å¿—ä¸­æç¤ºçš„åªæœ‰5ä¸ªå…¥å‚ã€‚ç¼ºå°‘äº†æœ€åä¸€ä¸ª <font color=blue> int features</font>\n\n#### é—®é¢˜1\nä»æ–¹æ³•ç­¾åçš„å¯¹æ¯”æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¯¥é”™è¯¯çš„ç¡®æ˜¯å› ä¸ºæ‰¾ä¸å¯¹å¯¹åº”çš„æ–¹æ³•æ‰€å¯¼è‡´çš„ã€‚ç”±äºfastjsonåºåˆ—åŒ–çš„å¯¹è±¡æ˜¯é€šè¿‡ASMåŠ¨æ€ç”Ÿæˆå­—èŠ‚ç äº§ç”Ÿçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šå¤šæºç æˆ–è€…å€ŸåŠ©å·¥å…·æ¥éªŒè¯è¿™ä¸ªbugçš„çœŸå®æ€§ã€‚\n##### 1.ä»£ç éªŒè¯\nfastjsonåœ¨javaå¹³å°ä¸‹ä¼šé»˜è®¤ä½¿ç”¨ASMçš„æ–¹å¼åŠ¨æ€ç”Ÿæˆåºåˆ—åŒ–ä»£ç†ç±»\n> æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.SerializeConfig\n``` java\nprivate boolean                                       asm             = !ASMUtils.IS_ANDROID;\n```\n> æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.SerializeConfig\n``` java\nif (asm) {\n    try {\n        ObjectSerializer asmSerializer = createASMSerializer(beanInfo);\n        if (asmSerializer != null) {\n            return asmSerializer;\n        }\n    } catch (ClassNotFoundException ex) {\n        // skip\n    } catch (ClassFormatError e) {\n        // skip\n    } catch (ClassCastException e) {\n        // skip\n    } catch (OutOfMemoryError e) {\n        if (e.getMessage().indexOf(\"Metaspace\") != -1) {\n            throw e;\n        }\n        // skip\n    } catch (Throwable e) {\n        throw new JSONException(\"create asm serializer error, verson \" + JSON.VERSION + \", class \" + clazz, e);\n    }\n}\n```\n\n> æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.ASMSerializerFactory\n``` java\nprivate void _processValue(MethodVisitor mw, FieldInfo fieldInfo, Context context, Label _end) {\n...\n        mw.visitMethodInsn(INVOKEVIRTUAL, JavaBeanSerializer, \"processValue\",\n                           \"(L\" + JSONSerializer  + \";\" //\n                                                                          + desc(BeanContext.class) //\n                                                                          + \"Ljava/lang/Object;Ljava/lang/String;\" //\n                                                                          + valueDesc + \")Ljava/lang/Object;Ljava/lang/Integer;\");\n\n                                                                          ...\n}\n```\né€šè¿‡ä¸Šè¿°æºç ï¼Œå¯ä»¥å‘ç°åœ¨é€šè¿‡ASMç”ŸæˆprocessValueæ–¹æ³•ç­¾åæ—¶ï¼Œåªå®šä¹‰äº†5ä¸ªå‚æ•°ã€‚åŒæ—¶ä¹Ÿèƒ½çœ‹åˆ°è¿”å›å‚æ•°å¤šè®¾ç½®äº†ä¸ªLjava/lang/Integerç±»å‹ã€‚\n\nä¾èµ–ä»£ç é˜…è¯»ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥ç¡®å®šé”™è¯¯ä»£ç çš„ä½ç½®äº†ã€‚ä½†ç”±äºæ¯•ç«Ÿæ˜¯é€šè¿‡ASMåŠ¨æ€å­—èŠ‚ç ç”Ÿæˆçš„ç±»å’Œå¯¹è±¡ï¼Œå®é™…åœ¨JVMä¸­çš„ç±»æ˜¯å¦ä¹Ÿåƒæˆ‘ä»¬ç°åœ¨çœ‹åˆ°çš„ä¸€æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦å€ŸåŠ©å…¶ä»–å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬è§‚å¯Ÿäº†ã€‚\n\n##### 2.é€šè¿‡HSDBè§‚å¯ŸJVMä¸­çš„ç±»\n* å·²Debugæ¨¡å¼å¯åŠ¨JavaæœåŠ¡\n* å°†æ–­ç‚¹è®¾ç½®åˆ°ä»£ç†ç±»ç”Ÿäº§é€»è¾‘å\n> æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.ASMSerializerFactory\n``` java\n//å°†åŠ¨æ€ç”Ÿæˆçš„å­—èŠ‚ç å¯¹è±¡è£…ç»´å­—èŠ‚æ•°ç»„\nbyte[] code = cw.toByteArray();\n//åŠ¨æ€åŠ è½½ç±»\nClass<?> serializerClass = classLoader.defineClassPublic(classNameFull, code, 0, code.length);\n```\n\n![01](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/classloadæ–­ç‚¹.png)\n\n* æ‰“å¼€HSDB\n``` shell\njava -cp sa-jdi.jar sun.jvm.hotspot.HSDB\n```\n\n* è·å–å½“å‰javaè¿›ç¨‹\n\n![02](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/jps.png)\n\n* HSDB attachå½“å‰javaè¿›ç¨‹\n\n![03](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/hdbs_attach.png)\n\n\n* æ‰§è¡Œæ–¹æ³•è‡³æ–­ç‚¹å¤„åï¼Œåœ¨HSDBæœç´¢ä»£ç†ç±»\n\n![04](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/class_browser.png)\n\né€šè¿‡è§‚å¯ŸFastJsonSerializerWrapper.writeNormal()æ–¹æ³•çš„å­—èŠ‚ç ä¹Ÿå¯ä»¥å‘ç°ï¼Œåœ¨è°ƒç”¨processValue()æ–¹æ³•çš„æ—¶å€™ç¼ºå°‘äº†ä¸€ä¸ªå‚æ•°ã€‚\n\n* æŸ¥çœ‹FastJsonSerializerWrapperçš„å¸¸é‡æ± \n\n![05](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/constantpool.png)\n\næŸ¥çœ‹å¸¸é‡æ± ä¸­çš„å†…å®¹ï¼Œä¹Ÿå†æ¬¡ç¡®è®¤äº†processValue()æ–¹æ³•çš„ç­¾åå­˜åœ¨é—®é¢˜ï¼šå…¥å‚ä¸å¯¹ã€è¿”å›å‚æ•°ä¹Ÿæœ‰é—®é¢˜ã€‚\n\n\n\n#### é—®é¢˜2\nASMSerializer_6_FastJsonSerializerWrapper.processValue()æ–¹æ³•çš„è¿”å›å€¼æœ‰ä¸¤ä¸ªã€‚è¿™ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆåœ¨ç±»åŠ¨æ€åŠ è½½çš„æ—¶å€™JVMæ²¡æœ‰æ£€æŸ¥å‡ºæ–¹æ³•ç­¾åçš„é—®é¢˜?\n\né¢„çŸ¥å¤§é“ï¼Œå¿…å…ˆä¸ºå²ã€‚javaä¹Ÿä¸€æ ·ï¼Œjavaçš„å†å²å°±æ˜¯JVMã€‚è¦æƒ³äº†è§£åŠ¨æ€åŠ è½½ç±»çš„æ—¶å€™åˆ°åº•åšäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å°±å¿…é¡»å‚é˜…JVMæºç ã€‚\n\nä¹‹å‰é˜…è¯»fastjsonæºç çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ›¾ç»æ¥åˆ°è¿™ä¹ˆä¸€æ®µä»£ç ã€‚\n\n![06](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/classloadæ–­ç‚¹.png)\n\næ˜¾ç„¶æºç æ˜¯é€šè¿‡è°ƒç”¨nativeæ–¹æ³•ï¼Œå°†ç±»çš„å­—èŠ‚æµå†™å…¥åˆ°JVMä¸­çš„ã€‚jdkä¸ºå¼€å‘è€…æä¾›äº†ä¸°å¯Œçš„ç±»åŠ è½½æœºåˆ¶ï¼Œä½†ç©¶å…¶æºè¿˜æ˜¯ä¾èµ–äº†è¿™ä¸‰ä¸ªnativeæ–¹æ³•ï¼Œå¹¶ä¸”è¿™ä¸‰ä¸ªæ–¹æ³•ä»…ä»…æ˜¯å…¥å‚ä¸åŒï¼Œå…¶èƒŒåçš„å®ç°åŸç†å…¶å®æ˜¯ä¸€æ ·çš„ã€‚\n> æ–¹æ³•æ¸…å•ï¼šjava.lang.ClassLoader\n``` java\n    private native Class<?> defineClass0(String name, byte[] b, int off, int len,\n                                         ProtectionDomain pd);\n\n    private native Class<?> defineClass1(String name, byte[] b, int off, int len,\n                                         ProtectionDomain pd, String source);\n\n    private native Class<?> defineClass2(String name, java.nio.ByteBuffer b,\n                                         int off, int len, ProtectionDomain pd,\n                                         String source);\n```\n\n###### java native æ–¹æ³•å…¥å£\næŒ‰ç…§jniçš„å®šä¹‰è§„èŒƒï¼Œnativeæ–¹æ³•ä¼šæŒ‰ç…§ä»¥ä¸‹çš„æ ¼å¼è¿›è¡Œå®šä¹‰ï¼š\n__JNIEXPORT jclass JNICALL Java_packagepath(åŒ…è·¯å¾„å·²_åˆ†å‰²)_æ–¹æ³•å__\n\næ ¹æ®ä¸Šé¢çš„è§„å®šï¼Œæˆ‘ä»¬å¾ˆå¿«å°±èƒ½è¿˜åŸå‡ºdefineClass1æ–¹æ³•åœ¨jdkä¸­çš„å®šä¹‰ï¼š\n<font color=blue> JNIEXPORT jclass JNICALL Java_java_lang_ClassLoader_defineClass1</font>\n\n>ä»£ç æ¸…å•ï¼šsrc/share/native/java/lang/ClassLoader.c\n``` C++\nJNIEXPORT jclass JNICALL\nJava_java_lang_ClassLoader_defineClass1(JNIEnv *env,\n                                        jobject loader,\n                                        jstring name,\n                                        jbyteArray data,\n                                        jint offset,\n                                        jint length,\n                                        jobject pd,\n                                        jstring source)\n{\n    jbyte *body;\n    char *utfName;\n    jclass result = 0;\n    char buf[128];\n    char* utfSource;\n    char sourceBuf[1024];\n\n    if (data == NULL) {\n        JNU_ThrowNullPointerException(env, 0);\n        return 0;\n    }\n\n    /* Work around 4153825. malloc crashes on Solaris when passed a\n     * negative size.\n     */\n    if (length < 0) {\n        JNU_ThrowArrayIndexOutOfBoundsException(env, 0);\n        return 0;\n    }\n\n    body = (jbyte *)malloc(length);\n\n    if (body == 0) {\n        JNU_ThrowOutOfMemoryError(env, 0);\n        return 0;\n    }\n\n    (*env)->GetByteArrayRegion(env, data, offset, length, body);\n\n    if ((*env)->ExceptionOccurred(env))\n        goto free_body;\n\n    if (name != NULL) {\n        utfName = getUTF(env, name, buf, sizeof(buf));\n        if (utfName == NULL) {\n            JNU_ThrowOutOfMemoryError(env, NULL);\n            goto free_body;\n        }\n        VerifyFixClassname(utfName);\n    } else {\n        utfName = NULL;\n    }\n\n    if (source != NULL) {\n        utfSource = getUTF(env, source, sourceBuf, sizeof(sourceBuf));\n        if (utfSource == NULL) {\n            JNU_ThrowOutOfMemoryError(env, NULL);\n            goto free_utfName;\n        }\n    } else {\n        utfSource = NULL;\n    }\n    result = JVM_DefineClassWithSource(env, utfName, loader, body, length, pd, utfSource);\n\n    if (utfSource && utfSource != sourceBuf)\n        free(utfSource);\n\n free_utfName:\n    if (utfName && utfName != buf)\n        free(utfName);\n\n free_body:\n    free(body);\n    return result;\n}\n```\n\nä»£ç ä¸­è°ƒç”¨äº†JVM_DefineClassWithSourceæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®šä¹‰åœ¨JVMæºç ä¸­ï¼Œä¸‹è½½JVMæºç æœç´¢è¯¥æ–¹æ³•ã€‚\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/prims/jvm.cpp\n``` C++\nJVM_ENTRY(jclass, JVM_DefineClassWithSource(JNIEnv *env, const char *name, jobject loader, const jbyte *buf, jsize len, jobject pd, const char *source))\n  JVMWrapper2(\"JVM_DefineClassWithSource %s\", name);\n\n  return jvm_define_class_common(env, name, loader, buf, len, pd, source, true, THREAD);\nJVM_END\n```\nç»è¿‡ä¸€è¿ä¸²çš„å†…éƒ¨è°ƒç”¨,JVMæ‰å¼€å§‹çœŸæ­£è§£æå­—èŠ‚ç æµï¼š\n> src/share/vm/prims/jvm.cpp --> JVM_DefineClassWithSource()\n>> src/share/vm/prims/jvm.cpp --> jvm_define_class_common()\n>>> src/share/vm/classfile/systemDictionary.cpp --> Klass* SystemDictionary::resolve_from_stream()\n>>>> src/share/vm/classfile/classFileParser.cpp --> instanceKlassHandle ClassFileParser::parseClassFile()\n\n\nJVMé¦–å…ˆä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ ¼å¼æ ¡éªŒ\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/classfile/classFileParser.cpp\n``` C++\n  // Figure out whether we can skip format checking (matching classic VM behavior)\n  if (DumpSharedSpaces) {\n    // verify == true means it's a 'remote' class (i.e., non-boot class)\n    // Verification decision is based on BytecodeVerificationRemote flag\n    // for those classes.\n    _need_verify = (verify) ? BytecodeVerificationRemote :\n                              BytecodeVerificationLocal;\n  } else {\n    _need_verify = Verifier::should_verify_for(class_loader(), verify);\n  }\n```\nDumpSharedSpacesé»˜è®¤ä¸ºfalseï¼Œå› æ­¤ä¼šèµ°åˆ°ä¸‹é¢çš„åˆ†æ”¯\n\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/classfile/verifier.cpp\n``` C++\nbool Verifier::should_verify_for(oop class_loader, bool should_verify_class) {\n  return (class_loader == NULL || !should_verify_class) ?\n    BytecodeVerificationLocal : BytecodeVerificationRemote;\n}\n```\n\nå½“å‰class_loaderä¸ºå½“å‰classLoadï¼Œå¹¶ä¸”should_verify_classåœ¨è°ƒç”¨jvm_define_class_commonæ–¹æ³•æ—¶ä¼ å€¼true\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/prims/jvm.cpp\n``` C++\nJVM_ENTRY(jclass, JVM_DefineClassWithSource(JNIEnv *env, const char *name, jobject loader, const jbyte *buf, jsize len, jobject pd, const char *source))\n  JVMWrapper2(\"JVM_DefineClassWithSource %s\", name);\n\n  return jvm_define_class_common(env, name, loader, buf, len, pd, source, true, THREAD);\nJVM_END\n```\n\nå› æ­¤åˆ¤æ–­_need_verifyçš„ç»“æœæœ€ç»ˆè½åˆ°äº†BytecodeVerificationRemoteä¸Šã€‚\n\næˆ‘ä»¬å…ˆçœ‹BytecodeVerificationRemoteåœ¨jvmé‡Œçš„å®šä¹‰ï¼š\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/globals.hpp\n``` C++\n  product(bool, BytecodeVerificationRemote, true,                           \\\n          \"Enable the Java bytecode verifier for remote classes\")           \\\n```\nå¯è§BytecodeVerificationRemoteåœ¨JVMåˆå§‹åŒ–çš„æ—¶å€™é»˜è®¤å€¼ä¸ºtrueï¼Œä»£è¡¨éJVMè‡ªå·±çš„å¯¹è±¡åœ¨åŠ è½½çš„æ—¶å€™éœ€è¦è¿›è¡Œå„ç§æ ¡éªŒã€‚\n\nä¸ºäº†è¯æ˜è¿™ç‚¹ï¼Œæˆ‘ä»¬å†çœ‹çœ‹è§£ææ–¹æ³•æ—¶å…·ä½“çš„é€»è¾‘ï¼š\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/classfile/classFileParser.cpp --> methodHandle ClassFileParser::parse_method()\n``` C++\n  if (_need_verify) {\n    args_size = ((flags & JVM_ACC_STATIC) ? 0 : 1) +\n                 verify_legal_method_signature(name, signature, CHECK_(nullHandle));\n    if (args_size > MAX_ARGS_SIZE) {\n      classfile_parse_error(\"Too many arguments in method signature in class file %s\", CHECK_(nullHandle));\n    }\n  }\n```\n\nJVMåœ¨è§£ææ–¹æ³•çš„é€»è¾‘ä¸­ï¼Œä¼šå…ˆå¯¹æ–¹æ³•çš„åˆæ³•æ€§åšå„ç§æ ¡éªŒã€‚å…¶ä¸­å°±æœ‰å¯¹æ–¹æ³•ç­¾åçš„æ ¡éªŒã€‚å¦‚æœ_need_verifyä¸ºfalseï¼Œåˆ™æ”¹æ ¡éªŒä¼šè¢«è·³è¿‡ã€‚\n\né€šè¿‡ä¸Šé¢çš„ä¸€è¿ä¸²çš„ä»£ç åˆ†æï¼Œæˆ‘ä»¬å¾—åˆ°äº†BytecodeVerificationRemoteçš„å€¼æœ€ç»ˆä¼šå½±å“Fastjsoné€šè¿‡ASMåŠ¨æ€å­—èŠ‚ç ç”Ÿæˆçš„ç±»æ–‡ä»¶çš„è§£æã€‚\n\næ¥ä¸‹æ¥æˆ‘ä»¬ææ˜ç™½BytecodeVerificationRemoteçš„å€¼æ˜¯å¦‚ä½•è¢«æ›´æ”¹çš„ï¼Œè€æ ·å­ä»£ç ä¸€é¡¿ä¹±æœï¼š\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/arguments.cpp --> jint Arguments::parse_each_vm_init_arg\n``` C++\n// -Xverify\n    } else if (match_option(option, \"-Xverify\", &tail)) {\n      if (strcmp(tail, \":all\") == 0 || strcmp(tail, \"\") == 0) {\n        FLAG_SET_CMDLINE(bool, BytecodeVerificationLocal, true);\n        FLAG_SET_CMDLINE(bool, BytecodeVerificationRemote, true);\n      } else if (strcmp(tail, \":remote\") == 0) {\n        FLAG_SET_CMDLINE(bool, BytecodeVerificationLocal, false);\n        FLAG_SET_CMDLINE(bool, BytecodeVerificationRemote, true);\n      } else if (strcmp(tail, \":none\") == 0) {\n        FLAG_SET_CMDLINE(bool, BytecodeVerificationLocal, false);\n        FLAG_SET_CMDLINE(bool, BytecodeVerificationRemote, false);\n      } else if (is_bad_option(option, args->ignoreUnrecognized, \"verification\")) {\n        return JNI_EINVAL;\n      }\n```\n\n| Xverify | BytecodeVerificationLocal | BytecodeVerificationRemote |\n| ------ | ------ | ------ |\n| all æˆ– ä¸ä¼  | true | true |\n| remote | false | true |\n| none | false | false |\n\né¡ºç€è¿™ä¸ªæ€è·¯æˆ‘ä»¬å†çœ‹çœ‹æœåŠ¡å¯åŠ¨æ—¶çš„å‚æ•°ã€‚ç”±äºæ˜¯é‡‡ç”¨IDEAå¯åŠ¨çš„springbooté¡¹ç›®ï¼Œæˆ‘ä»¬æ²¡æœ‰æ‰‹åŠ¨æŒ‡å®šå„ç§å¯åŠ¨å‚æ•°ã€‚è€æ ·å­æˆ‘ä»¬è¿˜æ˜¯å€ŸåŠ©å…¶ä»–å·¥å…·è¿›è¡ŒæŸ¥çœ‹ã€‚è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨jdkè‡ªå¸¦çš„VisualVMã€‚\n\n![07](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/visualVM.png)\n\n\nè¿™å›äº‹çœŸç›¸å¤§ç™½äº†ï¼Œé€šè¿‡IDEAé»˜è®¤å¯åŠ¨springbooté¡¹ç›®æ—¶ï¼Œä¼šé»˜è®¤å¸¦ä¸Š<font color=red>-Xverify:none</font>å‚æ•°ã€‚ç»“åˆæˆ‘ä»¬ä¸Šé¢å¯¹JVMæºç çš„åˆ†æï¼Œåœ¨Xverify==noneæ—¶ã€‚åŠ è½½ç±»æ¨¡æ¿æ—¶ä¸ä¼šå¯¹ç±»ç»“æ„çš„åˆæ³•æ€§è¿›è¡Œæ ¡éªŒï¼Œè¿™ä¹Ÿæœ€ç»ˆå¯¼è‡´äº†ä¸ºä»€ä¹ˆæ–¹æ³•ç­¾åæ˜æ˜ä¸æ­£ç¡®ï¼Œä½†æ˜¯JVMè¿˜æ˜¯æˆåŠŸçš„åŠ è½½äº†è¿™ä¸ªç±»ã€‚\n\nè‡³äºä¸ºä»€ä¹ˆIDEAå¯åŠ¨çš„æ—¶å€™ä¼šå¸¦ä¸Š<font color=red>-Xverify:none</font>å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒå®˜ç½‘çš„ä¸€å¥è¯ã€‚\n> https://www.jetbrains.com/help/idea/run-debug-configuration-spring-boot.html#configuration-tab\n\n![08](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/idea.png)\n\n## æ€»ç»“\nè‡³æ­¤ï¼Œæ•´ä¸ªfastjsonåºåˆ—åŒ–å¼•èµ·çš„å¼‚å¸¸å·²ç»æ’æŸ¥å®Œäº†ã€‚\n\nå›é¡¾æ•´ä¸ªæ’æŸ¥è¿‡ç¨‹å…¶å®è¿™ä¸€ä¸ªé”™è¯¯å¼•å‡ºäº†ä¸¤ä¸ªé—®é¢˜ã€‚\n* ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯fastjsoné€šè¿‡ASMç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶çš„æ—¶å€™ï¼ŒprocessValueçš„å‚æ•°ä¸ªæ•°ä¸å¯¹ã€‚fastjsonå®˜æ–¹åœ¨åç»­ç‰ˆæœ¬ä¸­å¢åŠ äº†processValueçš„é‡è½½æ–¹æ³•ï¼Œä»è€Œä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚\n* ç¬¬äºŒä¸ªé—®é¢˜æ˜¯processValueæ–¹æ³•çš„æ–¹æ³•ç­¾åä¸æ­£ç¡®ï¼Œæ–¹æ³•è¿”å›ç±»å‹å†™æœ‰ä¸¤ä¸ªå‚æ•°ã€‚ä»è€Œå¼•èµ·å¯¹JVMè§£æç±»æ—¶ï¼Œæ–¹æ³•ç­¾ååˆæ³•æ€§æ ¡éªŒæœºåˆ¶çš„ç ”ç©¶ã€‚å®˜æ–¹ä¹Ÿåœ¨åç»­ç‰ˆæœ¬ä¸­ä¿®æ­£äº†æ–¹æ³•ç­¾åçš„é”™è¯¯ã€‚\n\nä»¥ä¸Šï¼Œè™½ç„¶è¿™æ¬¡é—®é¢˜çš„å‘ç°å’Œè§£å†³éƒ½å¾ˆç®€å•ã€‚ä½†æ˜¯ç‰µæ‰¯å‡ºäº†ä¸€éƒ¨åˆ†JVMæºç çš„çŸ¥è¯†ï¼Œå€Ÿç”±è¿™æ¬¡æœºä¼šï¼ŒåŠ æ·±ç›¸å…³çŸ¥è¯†ã€‚\n\n","source":"_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥.md","raw":"---\ntitle: fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥\ndate: 2020-08-17 10:43:05\ntags: \n    - Java\n    - fastjson\n    - ASM\ncategories :\n    - Technology\n---\n\nfastjsonä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„javaåºåˆ—åŒ–ç±»åº“ï¼Œå…¶æœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯å¿«ï¼Œå› æ­¤ä¹Ÿè¢«å›½å†…å„ä¸ªä¸­å°å‹å…¬å¸å¤§é‡çš„ä½¿ç”¨ã€‚ä½†å®ƒä¹Ÿæœ‰ä¸å°‘çŸ­æ¿ï¼Œå¦‚å¯å®šåˆ¶æ€§ä½ã€APIä¸å¤Ÿä¸°å¯Œã€ä»£ç è´¨é‡åŠæ–‡æ¡£ç¼ºå¤±ç­‰ä¸€äº›åˆ—é—®é¢˜ä¸€ç›´è¢«äººæ‰€è¯Ÿç—…ã€‚\n\næœ¬æ¬¡æˆ‘ä»¬ç¢°åˆ°çš„é—®é¢˜å°±æ˜¯ç”±fastjsonçš„ä¸€ä¸ªç®€å•bugè€Œå¼•èµ·çš„ä¸€è¿ä¸²ç ”ç©¶ã€‚\n<!-- more -->\n## å‘ç°bug\næŸæ—¥ä¸€ä½åŒå­¦åœ¨è°ƒè¯•æ–°éœ€æ±‚çš„æ—¶å€™å‘ç°å¦‚ä¸‹é”™è¯¯æ—¥å¿—ï¼š\n``` java\nException in thread \"collection-eventbus-thread-1\" java.lang.NoSuchMethodError: com.alibaba.fastjson.serializer.JavaBeanSerializer.processValue(Lcom/alibaba/fastjson/serializer/JSONSerializer;Lcom/alibaba/fastjson/serializer/BeanContext;Ljava/lang/Object;Ljava/lang/String;Ljava/lang/Object;)Ljava/lang/Object;Ljava/lang/Integer;\n\tat com.alibaba.fastjson.serializer.ASMSerializer_6_FastJsonSerializerWrapper.writeNormal(Unknown Source)\n\tat com.alibaba.fastjson.serializer.ASMSerializer_6_FastJsonSerializerWrapper.write(Unknown Source)\n\tat com.alibaba.fastjson.serializer.JSONSerializer.write(JSONSerializer.java:285)\n\tat com.alibaba.fastjson.JSON.toJSONString(JSON.java:663)\n\tat com.alibaba.fastjson.JSON.toJSONString(JSON.java:652)\n\tat com.oriente.cache.layeringCache.serializer.FastJsonRedisSerializer.serialize(FastJsonRedisSerializer.java:37)\n\tat org.springframework.data.redis.core.AbstractOperations.rawValue(AbstractOperations.java:117)\n\tat org.springframework.data.redis.core.DefaultValueOperations.multiSet(DefaultValueOperations.java:136)\n\tat com.oriente.collection.event.listener.RedisEventListener.schedule(RedisEventListener.java:75)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat com.google.common.eventbus.Subscriber.invokeSubscriberMethod(Subscriber.java:87)\n\tat com.google.common.eventbus.Subscriber$SynchronizedSubscriber.invokeSubscriberMethod(Subscriber.java:144)\n\tat com.google.common.eventbus.Subscriber$1.run(Subscriber.java:72)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat java.lang.Thread.run(Thread.java:748)\n```\n\né€šè¿‡è§‚å¯Ÿé”™è¯¯ï¼Œå¾ˆå¿«å°±èƒ½å®šä½åˆ°æ˜¯fastjsonåºåˆ—åŒ–çš„æ—¶å€™å‡ºç°äº†é”™è¯¯ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿç¡®è®¤çš„ä»£ç ï¼Œåœ¨è‡ªå®šçš„RedisTemplateä¸­ï¼Œé’ˆå¯¹Valueçš„åºåˆ—åŒ–å·¥å…·æˆ‘ä»¬çš„ç¡®ä½¿ç”¨äº†fastjsonçš„åºåˆ—åŒ–æ–¹å¼ã€‚\n\n- RedisTemplateä½¿ç”¨è‡ªå®šä¹‰çš„fastjosonåºåˆ—åŒ–å·¥å…·\n``` java\n        FastJsonRedisSerializer<Object> fastJsonRedisSerializer = new FastJsonRedisSerializer<>(Object.class);\n\n        redisTemplate.setValueSerializer(fastJsonRedisSerializer);\n```\n\n- FastJsonRedisSerializerä¸­ä½¿ç”¨fastjsonçš„APIå¯¹ç»Ÿä¸€åŒ…è£…ç±»è¿›è¡Œåºåˆ—åŒ–\n``` java\n    @Override\n    public byte[] serialize(T t) throws SerializationException {\n        try {\n            return JSON.toJSONString(new FastJsonSerializerWrapper(t), SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET);\n        } catch (Exception e) {\n            throw new SerializationException(String.format(\"FastJsonRedisSerializer åºåˆ—åŒ–å¼‚å¸¸: %s, ã€JSONï¼š%sã€‘\",\n                    e.getMessage(), JSON.toJSONString(t)), e);\n\n        }\n    }\n```\n\n## åˆ†æbug\nç»è¿‡ä¸Šé¢çš„ä¸€é¡¿æ’æŸ¥ï¼Œé—®é¢˜å·²ç»å¾ˆæ˜ç¡®å®šä½åˆ°æ˜¯fastjsonä¸Šäº†ï¼Œå¹¶ä¸”é”™è¯¯ä¿¡æ¯ç»™çš„ç›¸å½“æ˜ç¡®ï¼š\n\n  <font color=red> ` java.lang.NoSuchMethodError: com.alibaba.fastjson.serializer.JavaBeanSerializer.processValue(Lcom/alibaba/fastjson/serializer/JSONSerializer;Lcom/alibaba/fastjson/serializer/BeanContext;Ljava/lang/Object;Ljava/lang/String;Ljava/lang/Object;)Ljava/lang/Object;Ljava/lang/Integer; ` </font>\n\næç¤ºæœªæ‰¾åˆ°JavaBeanSerializer.processValueæ–¹æ³•ã€‚okæˆ‘ä»¬ç«‹é©¬æŸ¥è¯¢JavaBeanSerializeræºç ï¼Œå‘ç°processalueæ–¹æ³•æ˜¯ç»§æ‰¿è‡ªSerializeFilterableç±»ï¼š\n> æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.JavaBeanSerializer\n``` java\n    protected Object processValue(JSONSerializer jsonBeanDeser, //\n                               BeanContext beanContext,\n                               Object object, //\n                               String key, //\n                               Object propertyValue, //\n                               int features) {\n```\n\nä¹ä¸€çœ‹æ–¹æ³•æ˜¯å­˜åœ¨çš„ï¼Œè¿™æ˜¯æˆ‘ä»¬åˆå›åˆ°äº†é”™è¯¯æœ¬èº«ã€‚ä»”ç»†æŸ¥çœ‹é”™è¯¯ï¼Œé”™è¯¯ä¸­æç¤ºæˆ‘ä»¬processValueæ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š\n\nå…¥å‚ï¼š\n1. Lcom/alibaba/fastjson/serializer/JSONSerializer <font color=green>--JSONSerializerç±»å‹çš„å¯¹è±¡</font>\n2. Lcom/alibaba/fastjson/serializer/BeanContext <font color=green>--BeanContextç±»å‹çš„å¯¹è±¡</font>\n3. Ljava/lang/Object <font color=green>--Objectå¯¹è±¡</font>\n4. Ljava/lang/String <font color=green>--String ç±»å‹</font>\n5. Ljava/lang/Object <font color=green>--Objectå¯¹è±¡</font>\n\nè¿”å›å‚æ•°ï¼š\n1. Ljava/lang/Object;Ljava/lang/Integer; <font color=green>--è¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿjavaçš„è¿”å›å‚æ•°åº”è¯¥æ˜¯ä¸æ”¯æŒä¸¤ä¸ªæ‰å¯¹å•Šï¼</font>\n\nç»è¿‡å¯¹æ¯”ï¼Œæœç„¶æ–¹æ³•ç­¾åä¸ä¸€è‡´ã€‚æºç ä¸­SerializeFilterable.processValue()æ–¹æ³•ä¸­æœ‰6ä¸ªå…¥å‚ï¼Œè€Œé”™è¯¯æ—¥å¿—ä¸­æç¤ºçš„åªæœ‰5ä¸ªå…¥å‚ã€‚ç¼ºå°‘äº†æœ€åä¸€ä¸ª <font color=blue> int features</font>\n\n#### é—®é¢˜1\nä»æ–¹æ³•ç­¾åçš„å¯¹æ¯”æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¯¥é”™è¯¯çš„ç¡®æ˜¯å› ä¸ºæ‰¾ä¸å¯¹å¯¹åº”çš„æ–¹æ³•æ‰€å¯¼è‡´çš„ã€‚ç”±äºfastjsonåºåˆ—åŒ–çš„å¯¹è±¡æ˜¯é€šè¿‡ASMåŠ¨æ€ç”Ÿæˆå­—èŠ‚ç äº§ç”Ÿçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šå¤šæºç æˆ–è€…å€ŸåŠ©å·¥å…·æ¥éªŒè¯è¿™ä¸ªbugçš„çœŸå®æ€§ã€‚\n##### 1.ä»£ç éªŒè¯\nfastjsonåœ¨javaå¹³å°ä¸‹ä¼šé»˜è®¤ä½¿ç”¨ASMçš„æ–¹å¼åŠ¨æ€ç”Ÿæˆåºåˆ—åŒ–ä»£ç†ç±»\n> æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.SerializeConfig\n``` java\nprivate boolean                                       asm             = !ASMUtils.IS_ANDROID;\n```\n> æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.SerializeConfig\n``` java\nif (asm) {\n    try {\n        ObjectSerializer asmSerializer = createASMSerializer(beanInfo);\n        if (asmSerializer != null) {\n            return asmSerializer;\n        }\n    } catch (ClassNotFoundException ex) {\n        // skip\n    } catch (ClassFormatError e) {\n        // skip\n    } catch (ClassCastException e) {\n        // skip\n    } catch (OutOfMemoryError e) {\n        if (e.getMessage().indexOf(\"Metaspace\") != -1) {\n            throw e;\n        }\n        // skip\n    } catch (Throwable e) {\n        throw new JSONException(\"create asm serializer error, verson \" + JSON.VERSION + \", class \" + clazz, e);\n    }\n}\n```\n\n> æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.ASMSerializerFactory\n``` java\nprivate void _processValue(MethodVisitor mw, FieldInfo fieldInfo, Context context, Label _end) {\n...\n        mw.visitMethodInsn(INVOKEVIRTUAL, JavaBeanSerializer, \"processValue\",\n                           \"(L\" + JSONSerializer  + \";\" //\n                                                                          + desc(BeanContext.class) //\n                                                                          + \"Ljava/lang/Object;Ljava/lang/String;\" //\n                                                                          + valueDesc + \")Ljava/lang/Object;Ljava/lang/Integer;\");\n\n                                                                          ...\n}\n```\né€šè¿‡ä¸Šè¿°æºç ï¼Œå¯ä»¥å‘ç°åœ¨é€šè¿‡ASMç”ŸæˆprocessValueæ–¹æ³•ç­¾åæ—¶ï¼Œåªå®šä¹‰äº†5ä¸ªå‚æ•°ã€‚åŒæ—¶ä¹Ÿèƒ½çœ‹åˆ°è¿”å›å‚æ•°å¤šè®¾ç½®äº†ä¸ªLjava/lang/Integerç±»å‹ã€‚\n\nä¾èµ–ä»£ç é˜…è¯»ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥ç¡®å®šé”™è¯¯ä»£ç çš„ä½ç½®äº†ã€‚ä½†ç”±äºæ¯•ç«Ÿæ˜¯é€šè¿‡ASMåŠ¨æ€å­—èŠ‚ç ç”Ÿæˆçš„ç±»å’Œå¯¹è±¡ï¼Œå®é™…åœ¨JVMä¸­çš„ç±»æ˜¯å¦ä¹Ÿåƒæˆ‘ä»¬ç°åœ¨çœ‹åˆ°çš„ä¸€æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦å€ŸåŠ©å…¶ä»–å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬è§‚å¯Ÿäº†ã€‚\n\n##### 2.é€šè¿‡HSDBè§‚å¯ŸJVMä¸­çš„ç±»\n* å·²Debugæ¨¡å¼å¯åŠ¨JavaæœåŠ¡\n* å°†æ–­ç‚¹è®¾ç½®åˆ°ä»£ç†ç±»ç”Ÿäº§é€»è¾‘å\n> æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.ASMSerializerFactory\n``` java\n//å°†åŠ¨æ€ç”Ÿæˆçš„å­—èŠ‚ç å¯¹è±¡è£…ç»´å­—èŠ‚æ•°ç»„\nbyte[] code = cw.toByteArray();\n//åŠ¨æ€åŠ è½½ç±»\nClass<?> serializerClass = classLoader.defineClassPublic(classNameFull, code, 0, code.length);\n```\n\n![01](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/classloadæ–­ç‚¹.png)\n\n* æ‰“å¼€HSDB\n``` shell\njava -cp sa-jdi.jar sun.jvm.hotspot.HSDB\n```\n\n* è·å–å½“å‰javaè¿›ç¨‹\n\n![02](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/jps.png)\n\n* HSDB attachå½“å‰javaè¿›ç¨‹\n\n![03](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/hdbs_attach.png)\n\n\n* æ‰§è¡Œæ–¹æ³•è‡³æ–­ç‚¹å¤„åï¼Œåœ¨HSDBæœç´¢ä»£ç†ç±»\n\n![04](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/class_browser.png)\n\né€šè¿‡è§‚å¯ŸFastJsonSerializerWrapper.writeNormal()æ–¹æ³•çš„å­—èŠ‚ç ä¹Ÿå¯ä»¥å‘ç°ï¼Œåœ¨è°ƒç”¨processValue()æ–¹æ³•çš„æ—¶å€™ç¼ºå°‘äº†ä¸€ä¸ªå‚æ•°ã€‚\n\n* æŸ¥çœ‹FastJsonSerializerWrapperçš„å¸¸é‡æ± \n\n![05](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/constantpool.png)\n\næŸ¥çœ‹å¸¸é‡æ± ä¸­çš„å†…å®¹ï¼Œä¹Ÿå†æ¬¡ç¡®è®¤äº†processValue()æ–¹æ³•çš„ç­¾åå­˜åœ¨é—®é¢˜ï¼šå…¥å‚ä¸å¯¹ã€è¿”å›å‚æ•°ä¹Ÿæœ‰é—®é¢˜ã€‚\n\n\n\n#### é—®é¢˜2\nASMSerializer_6_FastJsonSerializerWrapper.processValue()æ–¹æ³•çš„è¿”å›å€¼æœ‰ä¸¤ä¸ªã€‚è¿™ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆåœ¨ç±»åŠ¨æ€åŠ è½½çš„æ—¶å€™JVMæ²¡æœ‰æ£€æŸ¥å‡ºæ–¹æ³•ç­¾åçš„é—®é¢˜?\n\né¢„çŸ¥å¤§é“ï¼Œå¿…å…ˆä¸ºå²ã€‚javaä¹Ÿä¸€æ ·ï¼Œjavaçš„å†å²å°±æ˜¯JVMã€‚è¦æƒ³äº†è§£åŠ¨æ€åŠ è½½ç±»çš„æ—¶å€™åˆ°åº•åšäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å°±å¿…é¡»å‚é˜…JVMæºç ã€‚\n\nä¹‹å‰é˜…è¯»fastjsonæºç çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ›¾ç»æ¥åˆ°è¿™ä¹ˆä¸€æ®µä»£ç ã€‚\n\n![06](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/classloadæ–­ç‚¹.png)\n\næ˜¾ç„¶æºç æ˜¯é€šè¿‡è°ƒç”¨nativeæ–¹æ³•ï¼Œå°†ç±»çš„å­—èŠ‚æµå†™å…¥åˆ°JVMä¸­çš„ã€‚jdkä¸ºå¼€å‘è€…æä¾›äº†ä¸°å¯Œçš„ç±»åŠ è½½æœºåˆ¶ï¼Œä½†ç©¶å…¶æºè¿˜æ˜¯ä¾èµ–äº†è¿™ä¸‰ä¸ªnativeæ–¹æ³•ï¼Œå¹¶ä¸”è¿™ä¸‰ä¸ªæ–¹æ³•ä»…ä»…æ˜¯å…¥å‚ä¸åŒï¼Œå…¶èƒŒåçš„å®ç°åŸç†å…¶å®æ˜¯ä¸€æ ·çš„ã€‚\n> æ–¹æ³•æ¸…å•ï¼šjava.lang.ClassLoader\n``` java\n    private native Class<?> defineClass0(String name, byte[] b, int off, int len,\n                                         ProtectionDomain pd);\n\n    private native Class<?> defineClass1(String name, byte[] b, int off, int len,\n                                         ProtectionDomain pd, String source);\n\n    private native Class<?> defineClass2(String name, java.nio.ByteBuffer b,\n                                         int off, int len, ProtectionDomain pd,\n                                         String source);\n```\n\n###### java native æ–¹æ³•å…¥å£\næŒ‰ç…§jniçš„å®šä¹‰è§„èŒƒï¼Œnativeæ–¹æ³•ä¼šæŒ‰ç…§ä»¥ä¸‹çš„æ ¼å¼è¿›è¡Œå®šä¹‰ï¼š\n__JNIEXPORT jclass JNICALL Java_packagepath(åŒ…è·¯å¾„å·²_åˆ†å‰²)_æ–¹æ³•å__\n\næ ¹æ®ä¸Šé¢çš„è§„å®šï¼Œæˆ‘ä»¬å¾ˆå¿«å°±èƒ½è¿˜åŸå‡ºdefineClass1æ–¹æ³•åœ¨jdkä¸­çš„å®šä¹‰ï¼š\n<font color=blue> JNIEXPORT jclass JNICALL Java_java_lang_ClassLoader_defineClass1</font>\n\n>ä»£ç æ¸…å•ï¼šsrc/share/native/java/lang/ClassLoader.c\n``` C++\nJNIEXPORT jclass JNICALL\nJava_java_lang_ClassLoader_defineClass1(JNIEnv *env,\n                                        jobject loader,\n                                        jstring name,\n                                        jbyteArray data,\n                                        jint offset,\n                                        jint length,\n                                        jobject pd,\n                                        jstring source)\n{\n    jbyte *body;\n    char *utfName;\n    jclass result = 0;\n    char buf[128];\n    char* utfSource;\n    char sourceBuf[1024];\n\n    if (data == NULL) {\n        JNU_ThrowNullPointerException(env, 0);\n        return 0;\n    }\n\n    /* Work around 4153825. malloc crashes on Solaris when passed a\n     * negative size.\n     */\n    if (length < 0) {\n        JNU_ThrowArrayIndexOutOfBoundsException(env, 0);\n        return 0;\n    }\n\n    body = (jbyte *)malloc(length);\n\n    if (body == 0) {\n        JNU_ThrowOutOfMemoryError(env, 0);\n        return 0;\n    }\n\n    (*env)->GetByteArrayRegion(env, data, offset, length, body);\n\n    if ((*env)->ExceptionOccurred(env))\n        goto free_body;\n\n    if (name != NULL) {\n        utfName = getUTF(env, name, buf, sizeof(buf));\n        if (utfName == NULL) {\n            JNU_ThrowOutOfMemoryError(env, NULL);\n            goto free_body;\n        }\n        VerifyFixClassname(utfName);\n    } else {\n        utfName = NULL;\n    }\n\n    if (source != NULL) {\n        utfSource = getUTF(env, source, sourceBuf, sizeof(sourceBuf));\n        if (utfSource == NULL) {\n            JNU_ThrowOutOfMemoryError(env, NULL);\n            goto free_utfName;\n        }\n    } else {\n        utfSource = NULL;\n    }\n    result = JVM_DefineClassWithSource(env, utfName, loader, body, length, pd, utfSource);\n\n    if (utfSource && utfSource != sourceBuf)\n        free(utfSource);\n\n free_utfName:\n    if (utfName && utfName != buf)\n        free(utfName);\n\n free_body:\n    free(body);\n    return result;\n}\n```\n\nä»£ç ä¸­è°ƒç”¨äº†JVM_DefineClassWithSourceæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®šä¹‰åœ¨JVMæºç ä¸­ï¼Œä¸‹è½½JVMæºç æœç´¢è¯¥æ–¹æ³•ã€‚\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/prims/jvm.cpp\n``` C++\nJVM_ENTRY(jclass, JVM_DefineClassWithSource(JNIEnv *env, const char *name, jobject loader, const jbyte *buf, jsize len, jobject pd, const char *source))\n  JVMWrapper2(\"JVM_DefineClassWithSource %s\", name);\n\n  return jvm_define_class_common(env, name, loader, buf, len, pd, source, true, THREAD);\nJVM_END\n```\nç»è¿‡ä¸€è¿ä¸²çš„å†…éƒ¨è°ƒç”¨,JVMæ‰å¼€å§‹çœŸæ­£è§£æå­—èŠ‚ç æµï¼š\n> src/share/vm/prims/jvm.cpp --> JVM_DefineClassWithSource()\n>> src/share/vm/prims/jvm.cpp --> jvm_define_class_common()\n>>> src/share/vm/classfile/systemDictionary.cpp --> Klass* SystemDictionary::resolve_from_stream()\n>>>> src/share/vm/classfile/classFileParser.cpp --> instanceKlassHandle ClassFileParser::parseClassFile()\n\n\nJVMé¦–å…ˆä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ ¼å¼æ ¡éªŒ\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/classfile/classFileParser.cpp\n``` C++\n  // Figure out whether we can skip format checking (matching classic VM behavior)\n  if (DumpSharedSpaces) {\n    // verify == true means it's a 'remote' class (i.e., non-boot class)\n    // Verification decision is based on BytecodeVerificationRemote flag\n    // for those classes.\n    _need_verify = (verify) ? BytecodeVerificationRemote :\n                              BytecodeVerificationLocal;\n  } else {\n    _need_verify = Verifier::should_verify_for(class_loader(), verify);\n  }\n```\nDumpSharedSpacesé»˜è®¤ä¸ºfalseï¼Œå› æ­¤ä¼šèµ°åˆ°ä¸‹é¢çš„åˆ†æ”¯\n\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/classfile/verifier.cpp\n``` C++\nbool Verifier::should_verify_for(oop class_loader, bool should_verify_class) {\n  return (class_loader == NULL || !should_verify_class) ?\n    BytecodeVerificationLocal : BytecodeVerificationRemote;\n}\n```\n\nå½“å‰class_loaderä¸ºå½“å‰classLoadï¼Œå¹¶ä¸”should_verify_classåœ¨è°ƒç”¨jvm_define_class_commonæ–¹æ³•æ—¶ä¼ å€¼true\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/prims/jvm.cpp\n``` C++\nJVM_ENTRY(jclass, JVM_DefineClassWithSource(JNIEnv *env, const char *name, jobject loader, const jbyte *buf, jsize len, jobject pd, const char *source))\n  JVMWrapper2(\"JVM_DefineClassWithSource %s\", name);\n\n  return jvm_define_class_common(env, name, loader, buf, len, pd, source, true, THREAD);\nJVM_END\n```\n\nå› æ­¤åˆ¤æ–­_need_verifyçš„ç»“æœæœ€ç»ˆè½åˆ°äº†BytecodeVerificationRemoteä¸Šã€‚\n\næˆ‘ä»¬å…ˆçœ‹BytecodeVerificationRemoteåœ¨jvmé‡Œçš„å®šä¹‰ï¼š\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/globals.hpp\n``` C++\n  product(bool, BytecodeVerificationRemote, true,                           \\\n          \"Enable the Java bytecode verifier for remote classes\")           \\\n```\nå¯è§BytecodeVerificationRemoteåœ¨JVMåˆå§‹åŒ–çš„æ—¶å€™é»˜è®¤å€¼ä¸ºtrueï¼Œä»£è¡¨éJVMè‡ªå·±çš„å¯¹è±¡åœ¨åŠ è½½çš„æ—¶å€™éœ€è¦è¿›è¡Œå„ç§æ ¡éªŒã€‚\n\nä¸ºäº†è¯æ˜è¿™ç‚¹ï¼Œæˆ‘ä»¬å†çœ‹çœ‹è§£ææ–¹æ³•æ—¶å…·ä½“çš„é€»è¾‘ï¼š\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/classfile/classFileParser.cpp --> methodHandle ClassFileParser::parse_method()\n``` C++\n  if (_need_verify) {\n    args_size = ((flags & JVM_ACC_STATIC) ? 0 : 1) +\n                 verify_legal_method_signature(name, signature, CHECK_(nullHandle));\n    if (args_size > MAX_ARGS_SIZE) {\n      classfile_parse_error(\"Too many arguments in method signature in class file %s\", CHECK_(nullHandle));\n    }\n  }\n```\n\nJVMåœ¨è§£ææ–¹æ³•çš„é€»è¾‘ä¸­ï¼Œä¼šå…ˆå¯¹æ–¹æ³•çš„åˆæ³•æ€§åšå„ç§æ ¡éªŒã€‚å…¶ä¸­å°±æœ‰å¯¹æ–¹æ³•ç­¾åçš„æ ¡éªŒã€‚å¦‚æœ_need_verifyä¸ºfalseï¼Œåˆ™æ”¹æ ¡éªŒä¼šè¢«è·³è¿‡ã€‚\n\né€šè¿‡ä¸Šé¢çš„ä¸€è¿ä¸²çš„ä»£ç åˆ†æï¼Œæˆ‘ä»¬å¾—åˆ°äº†BytecodeVerificationRemoteçš„å€¼æœ€ç»ˆä¼šå½±å“Fastjsoné€šè¿‡ASMåŠ¨æ€å­—èŠ‚ç ç”Ÿæˆçš„ç±»æ–‡ä»¶çš„è§£æã€‚\n\næ¥ä¸‹æ¥æˆ‘ä»¬ææ˜ç™½BytecodeVerificationRemoteçš„å€¼æ˜¯å¦‚ä½•è¢«æ›´æ”¹çš„ï¼Œè€æ ·å­ä»£ç ä¸€é¡¿ä¹±æœï¼š\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/arguments.cpp --> jint Arguments::parse_each_vm_init_arg\n``` C++\n// -Xverify\n    } else if (match_option(option, \"-Xverify\", &tail)) {\n      if (strcmp(tail, \":all\") == 0 || strcmp(tail, \"\") == 0) {\n        FLAG_SET_CMDLINE(bool, BytecodeVerificationLocal, true);\n        FLAG_SET_CMDLINE(bool, BytecodeVerificationRemote, true);\n      } else if (strcmp(tail, \":remote\") == 0) {\n        FLAG_SET_CMDLINE(bool, BytecodeVerificationLocal, false);\n        FLAG_SET_CMDLINE(bool, BytecodeVerificationRemote, true);\n      } else if (strcmp(tail, \":none\") == 0) {\n        FLAG_SET_CMDLINE(bool, BytecodeVerificationLocal, false);\n        FLAG_SET_CMDLINE(bool, BytecodeVerificationRemote, false);\n      } else if (is_bad_option(option, args->ignoreUnrecognized, \"verification\")) {\n        return JNI_EINVAL;\n      }\n```\n\n| Xverify | BytecodeVerificationLocal | BytecodeVerificationRemote |\n| ------ | ------ | ------ |\n| all æˆ– ä¸ä¼  | true | true |\n| remote | false | true |\n| none | false | false |\n\né¡ºç€è¿™ä¸ªæ€è·¯æˆ‘ä»¬å†çœ‹çœ‹æœåŠ¡å¯åŠ¨æ—¶çš„å‚æ•°ã€‚ç”±äºæ˜¯é‡‡ç”¨IDEAå¯åŠ¨çš„springbooté¡¹ç›®ï¼Œæˆ‘ä»¬æ²¡æœ‰æ‰‹åŠ¨æŒ‡å®šå„ç§å¯åŠ¨å‚æ•°ã€‚è€æ ·å­æˆ‘ä»¬è¿˜æ˜¯å€ŸåŠ©å…¶ä»–å·¥å…·è¿›è¡ŒæŸ¥çœ‹ã€‚è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨jdkè‡ªå¸¦çš„VisualVMã€‚\n\n![07](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/visualVM.png)\n\n\nè¿™å›äº‹çœŸç›¸å¤§ç™½äº†ï¼Œé€šè¿‡IDEAé»˜è®¤å¯åŠ¨springbooté¡¹ç›®æ—¶ï¼Œä¼šé»˜è®¤å¸¦ä¸Š<font color=red>-Xverify:none</font>å‚æ•°ã€‚ç»“åˆæˆ‘ä»¬ä¸Šé¢å¯¹JVMæºç çš„åˆ†æï¼Œåœ¨Xverify==noneæ—¶ã€‚åŠ è½½ç±»æ¨¡æ¿æ—¶ä¸ä¼šå¯¹ç±»ç»“æ„çš„åˆæ³•æ€§è¿›è¡Œæ ¡éªŒï¼Œè¿™ä¹Ÿæœ€ç»ˆå¯¼è‡´äº†ä¸ºä»€ä¹ˆæ–¹æ³•ç­¾åæ˜æ˜ä¸æ­£ç¡®ï¼Œä½†æ˜¯JVMè¿˜æ˜¯æˆåŠŸçš„åŠ è½½äº†è¿™ä¸ªç±»ã€‚\n\nè‡³äºä¸ºä»€ä¹ˆIDEAå¯åŠ¨çš„æ—¶å€™ä¼šå¸¦ä¸Š<font color=red>-Xverify:none</font>å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒå®˜ç½‘çš„ä¸€å¥è¯ã€‚\n> https://www.jetbrains.com/help/idea/run-debug-configuration-spring-boot.html#configuration-tab\n\n![08](fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/idea.png)\n\n## æ€»ç»“\nè‡³æ­¤ï¼Œæ•´ä¸ªfastjsonåºåˆ—åŒ–å¼•èµ·çš„å¼‚å¸¸å·²ç»æ’æŸ¥å®Œäº†ã€‚\n\nå›é¡¾æ•´ä¸ªæ’æŸ¥è¿‡ç¨‹å…¶å®è¿™ä¸€ä¸ªé”™è¯¯å¼•å‡ºäº†ä¸¤ä¸ªé—®é¢˜ã€‚\n* ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯fastjsoné€šè¿‡ASMç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶çš„æ—¶å€™ï¼ŒprocessValueçš„å‚æ•°ä¸ªæ•°ä¸å¯¹ã€‚fastjsonå®˜æ–¹åœ¨åç»­ç‰ˆæœ¬ä¸­å¢åŠ äº†processValueçš„é‡è½½æ–¹æ³•ï¼Œä»è€Œä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚\n* ç¬¬äºŒä¸ªé—®é¢˜æ˜¯processValueæ–¹æ³•çš„æ–¹æ³•ç­¾åä¸æ­£ç¡®ï¼Œæ–¹æ³•è¿”å›ç±»å‹å†™æœ‰ä¸¤ä¸ªå‚æ•°ã€‚ä»è€Œå¼•èµ·å¯¹JVMè§£æç±»æ—¶ï¼Œæ–¹æ³•ç­¾ååˆæ³•æ€§æ ¡éªŒæœºåˆ¶çš„ç ”ç©¶ã€‚å®˜æ–¹ä¹Ÿåœ¨åç»­ç‰ˆæœ¬ä¸­ä¿®æ­£äº†æ–¹æ³•ç­¾åçš„é”™è¯¯ã€‚\n\nä»¥ä¸Šï¼Œè™½ç„¶è¿™æ¬¡é—®é¢˜çš„å‘ç°å’Œè§£å†³éƒ½å¾ˆç®€å•ã€‚ä½†æ˜¯ç‰µæ‰¯å‡ºäº†ä¸€éƒ¨åˆ†JVMæºç çš„çŸ¥è¯†ï¼Œå€Ÿç”±è¿™æ¬¡æœºä¼šï¼ŒåŠ æ·±ç›¸å…³çŸ¥è¯†ã€‚\n\n","slug":"fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥","published":1,"updated":"2020-12-14T10:39:46.423Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71huj004nv252f90fazco","content":"<html><head></head><body><p>fastjson&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;java&#x5E8F;&#x5217;&#x5316;&#x7C7B;&#x5E93;&#xFF0C;&#x5176;&#x6700;&#x5927;&#x7684;&#x4F18;&#x52BF;&#x5C31;&#x662F;&#x5FEB;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x88AB;&#x56FD;&#x5185;&#x5404;&#x4E2A;&#x4E2D;&#x5C0F;&#x578B;&#x516C;&#x53F8;&#x5927;&#x91CF;&#x7684;&#x4F7F;&#x7528;&#x3002;&#x4F46;&#x5B83;&#x4E5F;&#x6709;&#x4E0D;&#x5C11;&#x77ED;&#x677F;&#xFF0C;&#x5982;&#x53EF;&#x5B9A;&#x5236;&#x6027;&#x4F4E;&#x3001;API&#x4E0D;&#x591F;&#x4E30;&#x5BCC;&#x3001;&#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x53CA;&#x6587;&#x6863;&#x7F3A;&#x5931;&#x7B49;&#x4E00;&#x4E9B;&#x5217;&#x95EE;&#x9898;&#x4E00;&#x76F4;&#x88AB;&#x4EBA;&#x6240;&#x8BDF;&#x75C5;&#x3002;</p>\n<p>&#x672C;&#x6B21;&#x6211;&#x4EEC;&#x78B0;&#x5230;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x7531;fastjson&#x7684;&#x4E00;&#x4E2A;&#x7B80;&#x5355;bug&#x800C;&#x5F15;&#x8D77;&#x7684;&#x4E00;&#x8FDE;&#x4E32;&#x7814;&#x7A76;&#x3002;</p>\n<a id=\"more\"></a>\n<h2 id=\"&#x53D1;&#x73B0;bug\"><a href=\"#&#x53D1;&#x73B0;bug\" class=\"headerlink\" title=\"&#x53D1;&#x73B0;bug\"></a>&#x53D1;&#x73B0;bug</h2><p>&#x67D0;&#x65E5;&#x4E00;&#x4F4D;&#x540C;&#x5B66;&#x5728;&#x8C03;&#x8BD5;&#x65B0;&#x9700;&#x6C42;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x73B0;&#x5982;&#x4E0B;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#xFF1A;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Exception in thread <span class=\"hljs-string\">&quot;collection-eventbus-thread-1&quot;</span> java.lang.NoSuchMethodError: com.alibaba.fastjson.serializer.JavaBeanSerializer.processValue(Lcom/alibaba/fastjson/serializer/JSONSerializer;Lcom/alibaba/fastjson/serializer/BeanContext;Ljava/lang/Object;Ljava/lang/String;Ljava/lang/Object;)Ljava/lang/Object;Ljava/lang/Integer;</span><br><span class=\"line\">\tat com.alibaba.fastjson.serializer.ASMSerializer_6_FastJsonSerializerWrapper.writeNormal(Unknown Source)</span><br><span class=\"line\">\tat com.alibaba.fastjson.serializer.ASMSerializer_6_FastJsonSerializerWrapper.write(Unknown Source)</span><br><span class=\"line\">\tat com.alibaba.fastjson.serializer.JSONSerializer.write(JSONSerializer.java:<span class=\"hljs-number\">285</span>)</span><br><span class=\"line\">\tat com.alibaba.fastjson.JSON.toJSONString(JSON.java:<span class=\"hljs-number\">663</span>)</span><br><span class=\"line\">\tat com.alibaba.fastjson.JSON.toJSONString(JSON.java:<span class=\"hljs-number\">652</span>)</span><br><span class=\"line\">\tat com.oriente.cache.layeringCache.serializer.FastJsonRedisSerializer.serialize(FastJsonRedisSerializer.java:<span class=\"hljs-number\">37</span>)</span><br><span class=\"line\">\tat org.springframework.data.redis.core.AbstractOperations.rawValue(AbstractOperations.java:<span class=\"hljs-number\">117</span>)</span><br><span class=\"line\">\tat org.springframework.data.redis.core.DefaultValueOperations.multiSet(DefaultValueOperations.java:<span class=\"hljs-number\">136</span>)</span><br><span class=\"line\">\tat com.oriente.collection.event.listener.RedisEventListener.schedule(RedisEventListener.java:<span class=\"hljs-number\">75</span>)</span><br><span class=\"line\">\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class=\"line\">\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class=\"hljs-number\">62</span>)</span><br><span class=\"line\">\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class=\"hljs-number\">43</span>)</span><br><span class=\"line\">\tat java.lang.reflect.Method.invoke(Method.java:<span class=\"hljs-number\">498</span>)</span><br><span class=\"line\">\tat com.google.common.eventbus.Subscriber.invokeSubscriberMethod(Subscriber.java:<span class=\"hljs-number\">87</span>)</span><br><span class=\"line\">\tat com.google.common.eventbus.Subscriber$SynchronizedSubscriber.invokeSubscriberMethod(Subscriber.java:<span class=\"hljs-number\">144</span>)</span><br><span class=\"line\">\tat com.google.common.eventbus.Subscriber$<span class=\"hljs-number\">1.</span>run(Subscriber.java:<span class=\"hljs-number\">72</span>)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class=\"hljs-number\">1149</span>)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class=\"hljs-number\">624</span>)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:<span class=\"hljs-number\">748</span>)</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x901A;&#x8FC7;&#x89C2;&#x5BDF;&#x9519;&#x8BEF;&#xFF0C;&#x5F88;&#x5FEB;&#x5C31;&#x80FD;&#x5B9A;&#x4F4D;&#x5230;&#x662F;fastjson&#x5E8F;&#x5217;&#x5316;&#x7684;&#x65F6;&#x5019;&#x51FA;&#x73B0;&#x4E86;&#x9519;&#x8BEF;&#x3002;&#x540C;&#x65F6;&#x6211;&#x4EEC;&#x4E5F;&#x786E;&#x8BA4;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x5728;&#x81EA;&#x5B9A;&#x7684;RedisTemplate&#x4E2D;&#xFF0C;&#x9488;&#x5BF9;Value&#x7684;&#x5E8F;&#x5217;&#x5316;&#x5DE5;&#x5177;&#x6211;&#x4EEC;&#x7684;&#x786E;&#x4F7F;&#x7528;&#x4E86;fastjson&#x7684;&#x5E8F;&#x5217;&#x5316;&#x65B9;&#x5F0F;&#x3002;</p>\n<ul>\n<li><p>RedisTemplate&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x7684;fastjoson&#x5E8F;&#x5217;&#x5316;&#x5DE5;&#x5177;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FastJsonRedisSerializer&lt;Object&gt; fastJsonRedisSerializer = <span class=\"hljs-keyword\">new</span> FastJsonRedisSerializer&lt;&gt;(Object.class);</span><br><span class=\"line\"></span><br><span class=\"line\">redisTemplate.setValueSerializer(fastJsonRedisSerializer);</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li><p>FastJsonRedisSerializer&#x4E2D;&#x4F7F;&#x7528;fastjson&#x7684;API&#x5BF9;&#x7EDF;&#x4E00;&#x5305;&#x88C5;&#x7C7B;&#x8FDB;&#x884C;&#x5E8F;&#x5217;&#x5316;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">byte</span>[] serialize(T t) <span class=\"hljs-keyword\">throws</span> SerializationException {</span><br><span class=\"line\">    <span class=\"hljs-keyword\">try</span> {</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> JSON.toJSONString(<span class=\"hljs-keyword\">new</span> FastJsonSerializerWrapper(t), SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET);</span><br><span class=\"line\">    } <span class=\"hljs-keyword\">catch</span> (Exception e) {</span><br><span class=\"line\">        <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> SerializationException(String.format(<span class=\"hljs-string\">&quot;FastJsonRedisSerializer &#x5E8F;&#x5217;&#x5316;&#x5F02;&#x5E38;: %s, &#x3010;JSON&#xFF1A;%s&#x3011;&quot;</span>,</span><br><span class=\"line\">                e.getMessage(), JSON.toJSONString(t)), e);</span><br><span class=\"line\"></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n</li>\n</ul>\n<h2 id=\"&#x5206;&#x6790;bug\"><a href=\"#&#x5206;&#x6790;bug\" class=\"headerlink\" title=\"&#x5206;&#x6790;bug\"></a>&#x5206;&#x6790;bug</h2><p>&#x7ECF;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x4E00;&#x987F;&#x6392;&#x67E5;&#xFF0C;&#x95EE;&#x9898;&#x5DF2;&#x7ECF;&#x5F88;&#x660E;&#x786E;&#x5B9A;&#x4F4D;&#x5230;&#x662F;fastjson&#x4E0A;&#x4E86;&#xFF0C;&#x5E76;&#x4E14;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x7ED9;&#x7684;&#x76F8;&#x5F53;&#x660E;&#x786E;&#xFF1A;</p>\n<p>  <font color=\"red\"> <code>java.lang.NoSuchMethodError: com.alibaba.fastjson.serializer.JavaBeanSerializer.processValue(Lcom/alibaba/fastjson/serializer/JSONSerializer;Lcom/alibaba/fastjson/serializer/BeanContext;Ljava/lang/Object;Ljava/lang/String;Ljava/lang/Object;)Ljava/lang/Object;Ljava/lang/Integer;</code> </font></p>\n<p>&#x63D0;&#x793A;&#x672A;&#x627E;&#x5230;JavaBeanSerializer.processValue&#x65B9;&#x6CD5;&#x3002;ok&#x6211;&#x4EEC;&#x7ACB;&#x9A6C;&#x67E5;&#x8BE2;JavaBeanSerializer&#x6E90;&#x7801;&#xFF0C;&#x53D1;&#x73B0;processalue&#x65B9;&#x6CD5;&#x662F;&#x7EE7;&#x627F;&#x81EA;SerializeFilterable&#x7C7B;&#xFF1A;</p>\n<blockquote>\n<p>&#x65B9;&#x6CD5;&#x6E05;&#x5355;&#xFF1A;com.alibaba.fastjson.serializer.JavaBeanSerializer</p>\n</blockquote>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> Object <span class=\"hljs-title\">processValue</span><span class=\"hljs-params\">(JSONSerializer jsonBeanDeser, //</span></span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-params\">                           BeanContext beanContext,</span></span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-params\">                           Object object, //</span></span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-params\">                           String key, //</span></span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-params\">                           Object propertyValue, //</span></span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-params\">                           <span class=\"hljs-keyword\">int</span> features)</span> </span>{</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x4E4D;&#x4E00;&#x770B;&#x65B9;&#x6CD5;&#x662F;&#x5B58;&#x5728;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x6211;&#x4EEC;&#x53C8;&#x56DE;&#x5230;&#x4E86;&#x9519;&#x8BEF;&#x672C;&#x8EAB;&#x3002;&#x4ED4;&#x7EC6;&#x67E5;&#x770B;&#x9519;&#x8BEF;&#xFF0C;&#x9519;&#x8BEF;&#x4E2D;&#x63D0;&#x793A;&#x6211;&#x4EEC;processValue&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x5982;&#x4E0B;&#xFF1A;</p>\n<p>&#x5165;&#x53C2;&#xFF1A;</p>\n<ol>\n<li>Lcom/alibaba/fastjson/serializer/JSONSerializer <font color=\"green\">&#x2013;JSONSerializer&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;</font></li>\n<li>Lcom/alibaba/fastjson/serializer/BeanContext <font color=\"green\">&#x2013;BeanContext&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;</font></li>\n<li>Ljava/lang/Object <font color=\"green\">&#x2013;Object&#x5BF9;&#x8C61;</font></li>\n<li>Ljava/lang/String <font color=\"green\">&#x2013;String &#x7C7B;&#x578B;</font></li>\n<li>Ljava/lang/Object <font color=\"green\">&#x2013;Object&#x5BF9;&#x8C61;</font></li>\n</ol>\n<p>&#x8FD4;&#x56DE;&#x53C2;&#x6570;&#xFF1A;</p>\n<ol>\n<li>Ljava/lang/Object;Ljava/lang/Integer; <font color=\"green\">&#x2013;&#x8FD9;&#x662F;&#x4EC0;&#x4E48;&#x9B3C;&#xFF1F;java&#x7684;&#x8FD4;&#x56DE;&#x53C2;&#x6570;&#x5E94;&#x8BE5;&#x662F;&#x4E0D;&#x652F;&#x6301;&#x4E24;&#x4E2A;&#x624D;&#x5BF9;&#x554A;&#xFF01;</font></li>\n</ol>\n<p>&#x7ECF;&#x8FC7;&#x5BF9;&#x6BD4;&#xFF0C;&#x679C;&#x7136;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x4E0D;&#x4E00;&#x81F4;&#x3002;&#x6E90;&#x7801;&#x4E2D;SerializeFilterable.processValue()&#x65B9;&#x6CD5;&#x4E2D;&#x6709;6&#x4E2A;&#x5165;&#x53C2;&#xFF0C;&#x800C;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x4E2D;&#x63D0;&#x793A;&#x7684;&#x53EA;&#x6709;5&#x4E2A;&#x5165;&#x53C2;&#x3002;&#x7F3A;&#x5C11;&#x4E86;&#x6700;&#x540E;&#x4E00;&#x4E2A; <font color=\"blue\"> int features</font></p>\n<h4 id=\"&#x95EE;&#x9898;1\"><a href=\"#&#x95EE;&#x9898;1\" class=\"headerlink\" title=\"&#x95EE;&#x9898;1\"></a>&#x95EE;&#x9898;1</h4><p>&#x4ECE;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x7684;&#x5BF9;&#x6BD4;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x8BE5;&#x9519;&#x8BEF;&#x7684;&#x786E;&#x662F;&#x56E0;&#x4E3A;&#x627E;&#x4E0D;&#x5BF9;&#x5BF9;&#x5E94;&#x7684;&#x65B9;&#x6CD5;&#x6240;&#x5BFC;&#x81F4;&#x7684;&#x3002;&#x7531;&#x4E8E;fastjson&#x5E8F;&#x5217;&#x5316;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x901A;&#x8FC7;ASM&#x52A8;&#x6001;&#x751F;&#x6210;&#x5B57;&#x8282;&#x7801;&#x4EA7;&#x751F;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x591A;&#x6E90;&#x7801;&#x6216;&#x8005;&#x501F;&#x52A9;&#x5DE5;&#x5177;&#x6765;&#x9A8C;&#x8BC1;&#x8FD9;&#x4E2A;bug&#x7684;&#x771F;&#x5B9E;&#x6027;&#x3002;</p>\n<h5 id=\"1-&#x4EE3;&#x7801;&#x9A8C;&#x8BC1;\"><a href=\"#1-&#x4EE3;&#x7801;&#x9A8C;&#x8BC1;\" class=\"headerlink\" title=\"1.&#x4EE3;&#x7801;&#x9A8C;&#x8BC1;\"></a>1.&#x4EE3;&#x7801;&#x9A8C;&#x8BC1;</h5><p>fastjson&#x5728;java&#x5E73;&#x53F0;&#x4E0B;&#x4F1A;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;ASM&#x7684;&#x65B9;&#x5F0F;&#x52A8;&#x6001;&#x751F;&#x6210;&#x5E8F;&#x5217;&#x5316;&#x4EE3;&#x7406;&#x7C7B;</p>\n<blockquote>\n<p>&#x65B9;&#x6CD5;&#x6E05;&#x5355;&#xFF1A;com.alibaba.fastjson.serializer.SerializeConfig</p>\n</blockquote>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span>                                       asm             = !ASMUtils.IS_ANDROID;</span><br></pre></td></tr></tbody></table></figure>\n<blockquote>\n<p>&#x65B9;&#x6CD5;&#x6E05;&#x5355;&#xFF1A;com.alibaba.fastjson.serializer.SerializeConfig</p>\n</blockquote>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">if</span> (asm) {</span><br><span class=\"line\">    <span class=\"hljs-keyword\">try</span> {</span><br><span class=\"line\">        ObjectSerializer asmSerializer = createASMSerializer(beanInfo);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (asmSerializer != <span class=\"hljs-keyword\">null</span>) {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">return</span> asmSerializer;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } <span class=\"hljs-keyword\">catch</span> (ClassNotFoundException ex) {</span><br><span class=\"line\">        <span class=\"hljs-comment\">// skip</span></span><br><span class=\"line\">    } <span class=\"hljs-keyword\">catch</span> (ClassFormatError e) {</span><br><span class=\"line\">        <span class=\"hljs-comment\">// skip</span></span><br><span class=\"line\">    } <span class=\"hljs-keyword\">catch</span> (ClassCastException e) {</span><br><span class=\"line\">        <span class=\"hljs-comment\">// skip</span></span><br><span class=\"line\">    } <span class=\"hljs-keyword\">catch</span> (OutOfMemoryError e) {</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (e.getMessage().indexOf(<span class=\"hljs-string\">&quot;Metaspace&quot;</span>) != -<span class=\"hljs-number\">1</span>) {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">throw</span> e;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"hljs-comment\">// skip</span></span><br><span class=\"line\">    } <span class=\"hljs-keyword\">catch</span> (Throwable e) {</span><br><span class=\"line\">        <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> JSONException(<span class=\"hljs-string\">&quot;create asm serializer error, verson &quot;</span> + JSON.VERSION + <span class=\"hljs-string\">&quot;, class &quot;</span> + clazz, e);</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<blockquote>\n<p>&#x65B9;&#x6CD5;&#x6E05;&#x5355;&#xFF1A;com.alibaba.fastjson.serializer.ASMSerializerFactory</p>\n</blockquote>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">_processValue</span><span class=\"hljs-params\">(MethodVisitor mw, FieldInfo fieldInfo, Context context, Label _end)</span> </span>{</span><br><span class=\"line\">...</span><br><span class=\"line\">        mw.visitMethodInsn(INVOKEVIRTUAL, JavaBeanSerializer, <span class=\"hljs-string\">&quot;processValue&quot;</span>,</span><br><span class=\"line\">                           <span class=\"hljs-string\">&quot;(L&quot;</span> + JSONSerializer  + <span class=\"hljs-string\">&quot;;&quot;</span> <span class=\"hljs-comment\">//</span></span><br><span class=\"line\">                                                                          + desc(BeanContext.class) <span class=\"hljs-comment\">//</span></span><br><span class=\"line\">                                                                          + <span class=\"hljs-string\">&quot;Ljava/lang/Object;Ljava/lang/String;&quot;</span> <span class=\"hljs-comment\">//</span></span><br><span class=\"line\">                                                                          + valueDesc + <span class=\"hljs-string\">&quot;)Ljava/lang/Object;Ljava/lang/Integer;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                                                                          ...</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x8FF0;&#x6E90;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x5728;&#x901A;&#x8FC7;ASM&#x751F;&#x6210;processValue&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x65F6;&#xFF0C;&#x53EA;&#x5B9A;&#x4E49;&#x4E86;5&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x540C;&#x65F6;&#x4E5F;&#x80FD;&#x770B;&#x5230;&#x8FD4;&#x56DE;&#x53C2;&#x6570;&#x591A;&#x8BBE;&#x7F6E;&#x4E86;&#x4E2A;Ljava/lang/Integer&#x7C7B;&#x578B;&#x3002;</p>\n<p>&#x4F9D;&#x8D56;&#x4EE3;&#x7801;&#x9605;&#x8BFB;&#xFF0C;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x53EF;&#x4EE5;&#x786E;&#x5B9A;&#x9519;&#x8BEF;&#x4EE3;&#x7801;&#x7684;&#x4F4D;&#x7F6E;&#x4E86;&#x3002;&#x4F46;&#x7531;&#x4E8E;&#x6BD5;&#x7ADF;&#x662F;&#x901A;&#x8FC7;ASM&#x52A8;&#x6001;&#x5B57;&#x8282;&#x7801;&#x751F;&#x6210;&#x7684;&#x7C7B;&#x548C;&#x5BF9;&#x8C61;&#xFF0C;&#x5B9E;&#x9645;&#x5728;JVM&#x4E2D;&#x7684;&#x7C7B;&#x662F;&#x5426;&#x4E5F;&#x50CF;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x770B;&#x5230;&#x7684;&#x4E00;&#x6837;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x9700;&#x8981;&#x501F;&#x52A9;&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x6765;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x89C2;&#x5BDF;&#x4E86;&#x3002;</p>\n<h5 id=\"2-&#x901A;&#x8FC7;HSDB&#x89C2;&#x5BDF;JVM&#x4E2D;&#x7684;&#x7C7B;\"><a href=\"#2-&#x901A;&#x8FC7;HSDB&#x89C2;&#x5BDF;JVM&#x4E2D;&#x7684;&#x7C7B;\" class=\"headerlink\" title=\"2.&#x901A;&#x8FC7;HSDB&#x89C2;&#x5BDF;JVM&#x4E2D;&#x7684;&#x7C7B;\"></a>2.&#x901A;&#x8FC7;HSDB&#x89C2;&#x5BDF;JVM&#x4E2D;&#x7684;&#x7C7B;</h5><ul>\n<li>&#x5DF2;Debug&#x6A21;&#x5F0F;&#x542F;&#x52A8;Java&#x670D;&#x52A1;</li>\n<li>&#x5C06;&#x65AD;&#x70B9;&#x8BBE;&#x7F6E;&#x5230;&#x4EE3;&#x7406;&#x7C7B;&#x751F;&#x4EA7;&#x903B;&#x8F91;&#x540E;<blockquote>\n<p>&#x65B9;&#x6CD5;&#x6E05;&#x5355;&#xFF1A;com.alibaba.fastjson.serializer.ASMSerializerFactory</p>\n</blockquote>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\">//&#x5C06;&#x52A8;&#x6001;&#x751F;&#x6210;&#x7684;&#x5B57;&#x8282;&#x7801;&#x5BF9;&#x8C61;&#x88C5;&#x7EF4;&#x5B57;&#x8282;&#x6570;&#x7EC4;</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">byte</span>[] code = cw.toByteArray();</span><br><span class=\"line\"><span class=\"hljs-comment\">//&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x7C7B;</span></span><br><span class=\"line\">Class&lt;?&gt; serializerClass = classLoader.defineClassPublic(classNameFull, code, <span class=\"hljs-number\">0</span>, code.length);</span><br></pre></td></tr></tbody></table></figure>\n\n</li>\n</ul>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/classload%E6%96%AD%E7%82%B9.png\" alt=\"01\"></p>\n<ul>\n<li><p>&#x6253;&#x5F00;HSDB</p>\n<figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -cp sa-jdi.jar sun.jvm.hotspot.HSDB</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li><p>&#x83B7;&#x53D6;&#x5F53;&#x524D;java&#x8FDB;&#x7A0B;</p>\n</li>\n</ul>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/jps.png\" alt=\"02\"></p>\n<ul>\n<li>HSDB attach&#x5F53;&#x524D;java&#x8FDB;&#x7A0B;</li>\n</ul>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/hdbs_attach.png\" alt=\"03\"></p>\n<ul>\n<li>&#x6267;&#x884C;&#x65B9;&#x6CD5;&#x81F3;&#x65AD;&#x70B9;&#x5904;&#x540E;&#xFF0C;&#x5728;HSDB&#x641C;&#x7D22;&#x4EE3;&#x7406;&#x7C7B;</li>\n</ul>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/class_browser.png\" alt=\"04\"></p>\n<p>&#x901A;&#x8FC7;&#x89C2;&#x5BDF;FastJsonSerializerWrapper.writeNormal()&#x65B9;&#x6CD5;&#x7684;&#x5B57;&#x8282;&#x7801;&#x4E5F;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x5728;&#x8C03;&#x7528;processValue()&#x65B9;&#x6CD5;&#x7684;&#x65F6;&#x5019;&#x7F3A;&#x5C11;&#x4E86;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x3002;</p>\n<ul>\n<li>&#x67E5;&#x770B;FastJsonSerializerWrapper&#x7684;&#x5E38;&#x91CF;&#x6C60;</li>\n</ul>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/constantpool.png\" alt=\"05\"></p>\n<p>&#x67E5;&#x770B;&#x5E38;&#x91CF;&#x6C60;&#x4E2D;&#x7684;&#x5185;&#x5BB9;&#xFF0C;&#x4E5F;&#x518D;&#x6B21;&#x786E;&#x8BA4;&#x4E86;processValue()&#x65B9;&#x6CD5;&#x7684;&#x7B7E;&#x540D;&#x5B58;&#x5728;&#x95EE;&#x9898;&#xFF1A;&#x5165;&#x53C2;&#x4E0D;&#x5BF9;&#x3001;&#x8FD4;&#x56DE;&#x53C2;&#x6570;&#x4E5F;&#x6709;&#x95EE;&#x9898;&#x3002;</p>\n<h4 id=\"&#x95EE;&#x9898;2\"><a href=\"#&#x95EE;&#x9898;2\" class=\"headerlink\" title=\"&#x95EE;&#x9898;2\"></a>&#x95EE;&#x9898;2</h4><p>ASMSerializer_6_FastJsonSerializerWrapper.processValue()&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x6709;&#x4E24;&#x4E2A;&#x3002;&#x8FD9;&#x4F1A;&#x5E26;&#x6765;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x5728;&#x7C7B;&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x7684;&#x65F6;&#x5019;JVM&#x6CA1;&#x6709;&#x68C0;&#x67E5;&#x51FA;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x7684;&#x95EE;&#x9898;?</p>\n<p>&#x9884;&#x77E5;&#x5927;&#x9053;&#xFF0C;&#x5FC5;&#x5148;&#x4E3A;&#x53F2;&#x3002;java&#x4E5F;&#x4E00;&#x6837;&#xFF0C;java&#x7684;&#x5386;&#x53F2;&#x5C31;&#x662F;JVM&#x3002;&#x8981;&#x60F3;&#x4E86;&#x89E3;&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x7C7B;&#x7684;&#x65F6;&#x5019;&#x5230;&#x5E95;&#x505A;&#x4E86;&#x4EC0;&#x4E48;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5FC5;&#x987B;&#x53C2;&#x9605;JVM&#x6E90;&#x7801;&#x3002;</p>\n<p>&#x4E4B;&#x524D;&#x9605;&#x8BFB;fastjson&#x6E90;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x66FE;&#x7ECF;&#x6765;&#x5230;&#x8FD9;&#x4E48;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x3002;</p>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/classload%E6%96%AD%E7%82%B9.png\" alt=\"06\"></p>\n<p>&#x663E;&#x7136;&#x6E90;&#x7801;&#x662F;&#x901A;&#x8FC7;&#x8C03;&#x7528;native&#x65B9;&#x6CD5;&#xFF0C;&#x5C06;&#x7C7B;&#x7684;&#x5B57;&#x8282;&#x6D41;&#x5199;&#x5165;&#x5230;JVM&#x4E2D;&#x7684;&#x3002;jdk&#x4E3A;&#x5F00;&#x53D1;&#x8005;&#x63D0;&#x4F9B;&#x4E86;&#x4E30;&#x5BCC;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x673A;&#x5236;&#xFF0C;&#x4F46;&#x7A76;&#x5176;&#x6E90;&#x8FD8;&#x662F;&#x4F9D;&#x8D56;&#x4E86;&#x8FD9;&#x4E09;&#x4E2A;native&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E09;&#x4E2A;&#x65B9;&#x6CD5;&#x4EC5;&#x4EC5;&#x662F;&#x5165;&#x53C2;&#x4E0D;&#x540C;&#xFF0C;&#x5176;&#x80CC;&#x540E;&#x7684;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#x5176;&#x5B9E;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>\n<blockquote>\n<p>&#x65B9;&#x6CD5;&#x6E05;&#x5355;&#xFF1A;java.lang.ClassLoader</p>\n</blockquote>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">native</span> Class&lt;?&gt; defineClass0(String name, <span class=\"hljs-keyword\">byte</span>[] b, <span class=\"hljs-keyword\">int</span> off, <span class=\"hljs-keyword\">int</span> len,</span><br><span class=\"line\">                                     ProtectionDomain pd);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">native</span> Class&lt;?&gt; defineClass1(String name, <span class=\"hljs-keyword\">byte</span>[] b, <span class=\"hljs-keyword\">int</span> off, <span class=\"hljs-keyword\">int</span> len,</span><br><span class=\"line\">                                     ProtectionDomain pd, String source);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">native</span> Class&lt;?&gt; defineClass2(String name, java.nio.ByteBuffer b,</span><br><span class=\"line\">                                     <span class=\"hljs-keyword\">int</span> off, <span class=\"hljs-keyword\">int</span> len, ProtectionDomain pd,</span><br><span class=\"line\">                                     String source);</span><br></pre></td></tr></tbody></table></figure>\n\n<h6 id=\"java-native-&#x65B9;&#x6CD5;&#x5165;&#x53E3;\"><a href=\"#java-native-&#x65B9;&#x6CD5;&#x5165;&#x53E3;\" class=\"headerlink\" title=\"java native &#x65B9;&#x6CD5;&#x5165;&#x53E3;\"></a>java native &#x65B9;&#x6CD5;&#x5165;&#x53E3;</h6><p>&#x6309;&#x7167;jni&#x7684;&#x5B9A;&#x4E49;&#x89C4;&#x8303;&#xFF0C;native&#x65B9;&#x6CD5;&#x4F1A;&#x6309;&#x7167;&#x4EE5;&#x4E0B;&#x7684;&#x683C;&#x5F0F;&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#xFF1A;<br>__JNIEXPORT jclass JNICALL Java_packagepath(&#x5305;&#x8DEF;&#x5F84;&#x5DF2;<em>&#x5206;&#x5272;)<em>&#x65B9;&#x6CD5;&#x540D;</em></em></p>\n<p>&#x6839;&#x636E;&#x4E0A;&#x9762;&#x7684;&#x89C4;&#x5B9A;&#xFF0C;&#x6211;&#x4EEC;&#x5F88;&#x5FEB;&#x5C31;&#x80FD;&#x8FD8;&#x539F;&#x51FA;defineClass1&#x65B9;&#x6CD5;&#x5728;jdk&#x4E2D;&#x7684;&#x5B9A;&#x4E49;&#xFF1A;<br><font color=\"blue\"> JNIEXPORT jclass JNICALL Java_java_lang_ClassLoader_defineClass1</font></p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/native/java/lang/ClassLoader.c</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JNIEXPORT jclass JNICALL</span><br><span class=\"line\">Java_java_lang_ClassLoader_defineClass1(JNIEnv *env,</span><br><span class=\"line\">                                        jobject loader,</span><br><span class=\"line\">                                        jstring name,</span><br><span class=\"line\">                                        jbyteArray data,</span><br><span class=\"line\">                                        jint offset,</span><br><span class=\"line\">                                        jint length,</span><br><span class=\"line\">                                        jobject pd,</span><br><span class=\"line\">                                        jstring source)</span><br><span class=\"line\">{</span><br><span class=\"line\">    jbyte *body;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">char</span> *utfName;</span><br><span class=\"line\">    jclass result = <span class=\"hljs-number\">0</span>;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">char</span> buf[<span class=\"hljs-number\">128</span>];</span><br><span class=\"line\">    <span class=\"hljs-keyword\">char</span>* utfSource;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">char</span> sourceBuf[<span class=\"hljs-number\">1024</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (data == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">        JNU_ThrowNullPointerException(env, <span class=\"hljs-number\">0</span>);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-comment\">/* Work around 4153825. malloc crashes on Solaris when passed a</span></span><br><span class=\"line\"><span class=\"hljs-comment\">     * negative size.</span></span><br><span class=\"line\"><span class=\"hljs-comment\">     */</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (length &lt; <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">        JNU_ThrowArrayIndexOutOfBoundsException(env, <span class=\"hljs-number\">0</span>);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    body = (jbyte *)<span class=\"hljs-built_in\">malloc</span>(length);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (body == <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">        JNU_ThrowOutOfMemoryError(env, <span class=\"hljs-number\">0</span>);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    (*env)-&gt;GetByteArrayRegion(env, data, offset, length, body);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> ((*env)-&gt;ExceptionOccurred(env))</span><br><span class=\"line\">        <span class=\"hljs-keyword\">goto</span> free_body;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (name != <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">        utfName = getUTF(env, name, buf, <span class=\"hljs-keyword\">sizeof</span>(buf));</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (utfName == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">            JNU_ThrowOutOfMemoryError(env, <span class=\"hljs-literal\">NULL</span>);</span><br><span class=\"line\">            <span class=\"hljs-keyword\">goto</span> free_body;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        VerifyFixClassname(utfName);</span><br><span class=\"line\">    } <span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">        utfName = <span class=\"hljs-literal\">NULL</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (source != <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">        utfSource = getUTF(env, source, sourceBuf, <span class=\"hljs-keyword\">sizeof</span>(sourceBuf));</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (utfSource == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">            JNU_ThrowOutOfMemoryError(env, <span class=\"hljs-literal\">NULL</span>);</span><br><span class=\"line\">            <span class=\"hljs-keyword\">goto</span> free_utfName;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    } <span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">        utfSource = <span class=\"hljs-literal\">NULL</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    result = JVM_DefineClassWithSource(env, utfName, loader, body, length, pd, utfSource);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (utfSource &amp;&amp; utfSource != sourceBuf)</span><br><span class=\"line\">        <span class=\"hljs-built_in\">free</span>(utfSource);</span><br><span class=\"line\"></span><br><span class=\"line\"> free_utfName:</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (utfName &amp;&amp; utfName != buf)</span><br><span class=\"line\">        <span class=\"hljs-built_in\">free</span>(utfName);</span><br><span class=\"line\"></span><br><span class=\"line\"> free_body:</span><br><span class=\"line\">    <span class=\"hljs-built_in\">free</span>(body);</span><br><span class=\"line\">    <span class=\"hljs-keyword\">return</span> result;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x4EE3;&#x7801;&#x4E2D;&#x8C03;&#x7528;&#x4E86;JVM_DefineClassWithSource&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;&#x5728;JVM&#x6E90;&#x7801;&#x4E2D;&#xFF0C;&#x4E0B;&#x8F7D;JVM&#x6E90;&#x7801;&#x641C;&#x7D22;&#x8BE5;&#x65B9;&#x6CD5;&#x3002;</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/vm/prims/jvm.cpp</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JVM_ENTRY(jclass, JVM_DefineClassWithSource(JNIEnv *env, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">char</span> *name, jobject loader, <span class=\"hljs-keyword\">const</span> jbyte *buf, jsize len, jobject pd, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">char</span> *source))</span><br><span class=\"line\">  JVMWrapper2(<span class=\"hljs-string\">&quot;JVM_DefineClassWithSource %s&quot;</span>, name);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"hljs-keyword\">return</span> jvm_define_class_common(env, name, loader, buf, len, pd, source, <span class=\"hljs-literal\">true</span>, THREAD);</span><br><span class=\"line\">JVM_END</span><br></pre></td></tr></tbody></table></figure>\n<p>&#x7ECF;&#x8FC7;&#x4E00;&#x8FDE;&#x4E32;&#x7684;&#x5185;&#x90E8;&#x8C03;&#x7528;,JVM&#x624D;&#x5F00;&#x59CB;&#x771F;&#x6B63;&#x89E3;&#x6790;&#x5B57;&#x8282;&#x7801;&#x6D41;&#xFF1A;</p>\n<blockquote>\n<p>src/share/vm/prims/jvm.cpp &#x2013;&gt; JVM_DefineClassWithSource()</p>\n<blockquote>\n<p>src/share/vm/prims/jvm.cpp &#x2013;&gt; jvm_define_class_common()</p>\n<blockquote>\n<p>src/share/vm/classfile/systemDictionary.cpp &#x2013;&gt; Klass* SystemDictionary::resolve_from_stream()</p>\n<blockquote>\n<p>src/share/vm/classfile/classFileParser.cpp &#x2013;&gt; instanceKlassHandle ClassFileParser::parseClassFile()</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<p>JVM&#x9996;&#x5148;&#x4F1A;&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x683C;&#x5F0F;&#x6821;&#x9A8C;</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/vm/classfile/classFileParser.cpp</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\">// Figure out whether we can skip format checking (matching classic VM behavior)</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">if</span> (DumpSharedSpaces) {</span><br><span class=\"line\">  <span class=\"hljs-comment\">// verify == true means it&apos;s a &apos;remote&apos; class (i.e., non-boot class)</span></span><br><span class=\"line\">  <span class=\"hljs-comment\">// Verification decision is based on BytecodeVerificationRemote flag</span></span><br><span class=\"line\">  <span class=\"hljs-comment\">// for those classes.</span></span><br><span class=\"line\">  _need_verify = (verify) ? BytecodeVerificationRemote :</span><br><span class=\"line\">                            BytecodeVerificationLocal;</span><br><span class=\"line\">} <span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">  _need_verify = Verifier::should_verify_for(class_loader(), verify);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n<p>DumpSharedSpaces&#x9ED8;&#x8BA4;&#x4E3A;false&#xFF0C;&#x56E0;&#x6B64;&#x4F1A;&#x8D70;&#x5230;&#x4E0B;&#x9762;&#x7684;&#x5206;&#x652F;</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/vm/classfile/verifier.cpp</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">bool</span> <span class=\"hljs-title\">Verifier::should_verify_for</span><span class=\"hljs-params\">(oop class_loader, <span class=\"hljs-keyword\">bool</span> should_verify_class)</span> </span>{</span><br><span class=\"line\">  <span class=\"hljs-keyword\">return</span> (class_loader == <span class=\"hljs-literal\">NULL</span> || !should_verify_class) ?</span><br><span class=\"line\">    BytecodeVerificationLocal : BytecodeVerificationRemote;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x5F53;&#x524D;class_loader&#x4E3A;&#x5F53;&#x524D;classLoad&#xFF0C;&#x5E76;&#x4E14;should_verify_class&#x5728;&#x8C03;&#x7528;jvm_define_class_common&#x65B9;&#x6CD5;&#x65F6;&#x4F20;&#x503C;true</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/vm/prims/jvm.cpp</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JVM_ENTRY(jclass, JVM_DefineClassWithSource(JNIEnv *env, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">char</span> *name, jobject loader, <span class=\"hljs-keyword\">const</span> jbyte *buf, jsize len, jobject pd, <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">char</span> *source))</span><br><span class=\"line\">  JVMWrapper2(<span class=\"hljs-string\">&quot;JVM_DefineClassWithSource %s&quot;</span>, name);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"hljs-keyword\">return</span> jvm_define_class_common(env, name, loader, buf, len, pd, source, <span class=\"hljs-literal\">true</span>, THREAD);</span><br><span class=\"line\">JVM_END</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x56E0;&#x6B64;&#x5224;&#x65AD;_need_verify&#x7684;&#x7ED3;&#x679C;&#x6700;&#x7EC8;&#x843D;&#x5230;&#x4E86;BytecodeVerificationRemote&#x4E0A;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x5148;&#x770B;BytecodeVerificationRemote&#x5728;jvm&#x91CC;&#x7684;&#x5B9A;&#x4E49;&#xFF1A;</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/vm/runtime/globals.hpp</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">product(<span class=\"hljs-keyword\">bool</span>, BytecodeVerificationRemote, <span class=\"hljs-literal\">true</span>,                           \\</span><br><span class=\"line\">        <span class=\"hljs-string\">&quot;Enable the Java bytecode verifier for remote classes&quot;</span>)           \\</span><br></pre></td></tr></tbody></table></figure>\n<p>&#x53EF;&#x89C1;BytecodeVerificationRemote&#x5728;JVM&#x521D;&#x59CB;&#x5316;&#x7684;&#x65F6;&#x5019;&#x9ED8;&#x8BA4;&#x503C;&#x4E3A;true&#xFF0C;&#x4EE3;&#x8868;&#x975E;JVM&#x81EA;&#x5DF1;&#x7684;&#x5BF9;&#x8C61;&#x5728;&#x52A0;&#x8F7D;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x5404;&#x79CD;&#x6821;&#x9A8C;&#x3002;</p>\n<p>&#x4E3A;&#x4E86;&#x8BC1;&#x660E;&#x8FD9;&#x70B9;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x770B;&#x770B;&#x89E3;&#x6790;&#x65B9;&#x6CD5;&#x65F6;&#x5177;&#x4F53;&#x7684;&#x903B;&#x8F91;&#xFF1A;</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/vm/classfile/classFileParser.cpp &#x2013;&gt; methodHandle ClassFileParser::parse_method()</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">if</span> (_need_verify) {</span><br><span class=\"line\">  args_size = ((flags &amp; JVM_ACC_STATIC) ? <span class=\"hljs-number\">0</span> : <span class=\"hljs-number\">1</span>) +</span><br><span class=\"line\">               verify_legal_method_signature(name, signature, CHECK_(nullHandle));</span><br><span class=\"line\">  <span class=\"hljs-keyword\">if</span> (args_size &gt; MAX_ARGS_SIZE) {</span><br><span class=\"line\">    classfile_parse_error(<span class=\"hljs-string\">&quot;Too many arguments in method signature in class file %s&quot;</span>, CHECK_(nullHandle));</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>JVM&#x5728;&#x89E3;&#x6790;&#x65B9;&#x6CD5;&#x7684;&#x903B;&#x8F91;&#x4E2D;&#xFF0C;&#x4F1A;&#x5148;&#x5BF9;&#x65B9;&#x6CD5;&#x7684;&#x5408;&#x6CD5;&#x6027;&#x505A;&#x5404;&#x79CD;&#x6821;&#x9A8C;&#x3002;&#x5176;&#x4E2D;&#x5C31;&#x6709;&#x5BF9;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x7684;&#x6821;&#x9A8C;&#x3002;&#x5982;&#x679C;_need_verify&#x4E3A;false&#xFF0C;&#x5219;&#x6539;&#x6821;&#x9A8C;&#x4F1A;&#x88AB;&#x8DF3;&#x8FC7;&#x3002;</p>\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x4E00;&#x8FDE;&#x4E32;&#x7684;&#x4EE3;&#x7801;&#x5206;&#x6790;&#xFF0C;&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x4E86;BytecodeVerificationRemote&#x7684;&#x503C;&#x6700;&#x7EC8;&#x4F1A;&#x5F71;&#x54CD;Fastjson&#x901A;&#x8FC7;ASM&#x52A8;&#x6001;&#x5B57;&#x8282;&#x7801;&#x751F;&#x6210;&#x7684;&#x7C7B;&#x6587;&#x4EF6;&#x7684;&#x89E3;&#x6790;&#x3002;</p>\n<p>&#x63A5;&#x4E0B;&#x6765;&#x6211;&#x4EEC;&#x641E;&#x660E;&#x767D;BytecodeVerificationRemote&#x7684;&#x503C;&#x662F;&#x5982;&#x4F55;&#x88AB;&#x66F4;&#x6539;&#x7684;&#xFF0C;&#x8001;&#x6837;&#x5B50;&#x4EE3;&#x7801;&#x4E00;&#x987F;&#x4E71;&#x641C;&#xFF1A;</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/vm/runtime/arguments.cpp &#x2013;&gt; jint Arguments::parse_each_vm_init_arg</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\">// -Xverify</span></span><br><span class=\"line\">    } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (match_option(option, <span class=\"hljs-string\">&quot;-Xverify&quot;</span>, &amp;tail)) {</span><br><span class=\"line\">      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">strcmp</span>(tail, <span class=\"hljs-string\">&quot;:all&quot;</span>) == <span class=\"hljs-number\">0</span> || <span class=\"hljs-built_in\">strcmp</span>(tail, <span class=\"hljs-string\">&quot;&quot;</span>) == <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">        FLAG_SET_CMDLINE(<span class=\"hljs-keyword\">bool</span>, BytecodeVerificationLocal, <span class=\"hljs-literal\">true</span>);</span><br><span class=\"line\">        FLAG_SET_CMDLINE(<span class=\"hljs-keyword\">bool</span>, BytecodeVerificationRemote, <span class=\"hljs-literal\">true</span>);</span><br><span class=\"line\">      } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">strcmp</span>(tail, <span class=\"hljs-string\">&quot;:remote&quot;</span>) == <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">        FLAG_SET_CMDLINE(<span class=\"hljs-keyword\">bool</span>, BytecodeVerificationLocal, <span class=\"hljs-literal\">false</span>);</span><br><span class=\"line\">        FLAG_SET_CMDLINE(<span class=\"hljs-keyword\">bool</span>, BytecodeVerificationRemote, <span class=\"hljs-literal\">true</span>);</span><br><span class=\"line\">      } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">strcmp</span>(tail, <span class=\"hljs-string\">&quot;:none&quot;</span>) == <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">        FLAG_SET_CMDLINE(<span class=\"hljs-keyword\">bool</span>, BytecodeVerificationLocal, <span class=\"hljs-literal\">false</span>);</span><br><span class=\"line\">        FLAG_SET_CMDLINE(<span class=\"hljs-keyword\">bool</span>, BytecodeVerificationRemote, <span class=\"hljs-literal\">false</span>);</span><br><span class=\"line\">      } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (is_bad_option(option, args-&gt;ignoreUnrecognized, <span class=\"hljs-string\">&quot;verification&quot;</span>)) {</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> JNI_EINVAL;</span><br><span class=\"line\">      }</span><br></pre></td></tr></tbody></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>Xverify</th>\n<th>BytecodeVerificationLocal</th>\n<th>BytecodeVerificationRemote</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>all &#x6216; &#x4E0D;&#x4F20;</td>\n<td>true</td>\n<td>true</td>\n</tr>\n<tr>\n<td>remote</td>\n<td>false</td>\n<td>true</td>\n</tr>\n<tr>\n<td>none</td>\n<td>false</td>\n<td>false</td>\n</tr>\n</tbody></table>\n<p>&#x987A;&#x7740;&#x8FD9;&#x4E2A;&#x601D;&#x8DEF;&#x6211;&#x4EEC;&#x518D;&#x770B;&#x770B;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x65F6;&#x7684;&#x53C2;&#x6570;&#x3002;&#x7531;&#x4E8E;&#x662F;&#x91C7;&#x7528;IDEA&#x542F;&#x52A8;&#x7684;springboot&#x9879;&#x76EE;&#xFF0C;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x624B;&#x52A8;&#x6307;&#x5B9A;&#x5404;&#x79CD;&#x542F;&#x52A8;&#x53C2;&#x6570;&#x3002;&#x8001;&#x6837;&#x5B50;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x501F;&#x52A9;&#x5176;&#x4ED6;&#x5DE5;&#x5177;&#x8FDB;&#x884C;&#x67E5;&#x770B;&#x3002;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x4F7F;&#x7528;jdk&#x81EA;&#x5E26;&#x7684;VisualVM&#x3002;</p>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/visualVM.png\" alt=\"07\"></p>\n<p>&#x8FD9;&#x56DE;&#x4E8B;&#x771F;&#x76F8;&#x5927;&#x767D;&#x4E86;&#xFF0C;&#x901A;&#x8FC7;IDEA&#x9ED8;&#x8BA4;&#x542F;&#x52A8;springboot&#x9879;&#x76EE;&#x65F6;&#xFF0C;&#x4F1A;&#x9ED8;&#x8BA4;&#x5E26;&#x4E0A;<font color=\"red\">-Xverify:none</font>&#x53C2;&#x6570;&#x3002;&#x7ED3;&#x5408;&#x6211;&#x4EEC;&#x4E0A;&#x9762;&#x5BF9;JVM&#x6E90;&#x7801;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x5728;Xverify==none&#x65F6;&#x3002;&#x52A0;&#x8F7D;&#x7C7B;&#x6A21;&#x677F;&#x65F6;&#x4E0D;&#x4F1A;&#x5BF9;&#x7C7B;&#x7ED3;&#x6784;&#x7684;&#x5408;&#x6CD5;&#x6027;&#x8FDB;&#x884C;&#x6821;&#x9A8C;&#xFF0C;&#x8FD9;&#x4E5F;&#x6700;&#x7EC8;&#x5BFC;&#x81F4;&#x4E86;&#x4E3A;&#x4EC0;&#x4E48;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x660E;&#x660E;&#x4E0D;&#x6B63;&#x786E;&#xFF0C;&#x4F46;&#x662F;JVM&#x8FD8;&#x662F;&#x6210;&#x529F;&#x7684;&#x52A0;&#x8F7D;&#x4E86;&#x8FD9;&#x4E2A;&#x7C7B;&#x3002;</p>\n<p>&#x81F3;&#x4E8E;&#x4E3A;&#x4EC0;&#x4E48;IDEA&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x5E26;&#x4E0A;<font color=\"red\">-Xverify:none</font>&#x53C2;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x5B98;&#x7F51;&#x7684;&#x4E00;&#x53E5;&#x8BDD;&#x3002;</p>\n<blockquote>\n<p><a href=\"https://www.jetbrains.com/help/idea/run-debug-configuration-spring-boot.html#configuration-tab\">https://www.jetbrains.com/help/idea/run-debug-configuration-spring-boot.html#configuration-tab</a></p>\n</blockquote>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/idea.png\" alt=\"08\"></p>\n<h2 id=\"&#x603B;&#x7ED3;\"><a href=\"#&#x603B;&#x7ED3;\" class=\"headerlink\" title=\"&#x603B;&#x7ED3;\"></a>&#x603B;&#x7ED3;</h2><p>&#x81F3;&#x6B64;&#xFF0C;&#x6574;&#x4E2A;fastjson&#x5E8F;&#x5217;&#x5316;&#x5F15;&#x8D77;&#x7684;&#x5F02;&#x5E38;&#x5DF2;&#x7ECF;&#x6392;&#x67E5;&#x5B8C;&#x4E86;&#x3002;</p>\n<p>&#x56DE;&#x987E;&#x6574;&#x4E2A;&#x6392;&#x67E5;&#x8FC7;&#x7A0B;&#x5176;&#x5B9E;&#x8FD9;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x5F15;&#x51FA;&#x4E86;&#x4E24;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>\n<ul>\n<li>&#x7B2C;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#x662F;fastjson&#x901A;&#x8FC7;ASM&#x751F;&#x6210;&#x5B57;&#x8282;&#x7801;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x5019;&#xFF0C;processValue&#x7684;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#x4E0D;&#x5BF9;&#x3002;fastjson&#x5B98;&#x65B9;&#x5728;&#x540E;&#x7EED;&#x7248;&#x672C;&#x4E2D;&#x589E;&#x52A0;&#x4E86;processValue&#x7684;&#x91CD;&#x8F7D;&#x65B9;&#x6CD5;&#xFF0C;&#x4ECE;&#x800C;&#x4FEE;&#x590D;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</li>\n<li>&#x7B2C;&#x4E8C;&#x4E2A;&#x95EE;&#x9898;&#x662F;processValue&#x65B9;&#x6CD5;&#x7684;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x4E0D;&#x6B63;&#x786E;&#xFF0C;&#x65B9;&#x6CD5;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x5199;&#x6709;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x4ECE;&#x800C;&#x5F15;&#x8D77;&#x5BF9;JVM&#x89E3;&#x6790;&#x7C7B;&#x65F6;&#xFF0C;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x5408;&#x6CD5;&#x6027;&#x6821;&#x9A8C;&#x673A;&#x5236;&#x7684;&#x7814;&#x7A76;&#x3002;&#x5B98;&#x65B9;&#x4E5F;&#x5728;&#x540E;&#x7EED;&#x7248;&#x672C;&#x4E2D;&#x4FEE;&#x6B63;&#x4E86;&#x65B9;&#x6CD5;&#x7B7E;&#x540D;&#x7684;&#x9519;&#x8BEF;&#x3002;</li>\n</ul>\n<p>&#x4EE5;&#x4E0A;&#xFF0C;&#x867D;&#x7136;&#x8FD9;&#x6B21;&#x95EE;&#x9898;&#x7684;&#x53D1;&#x73B0;&#x548C;&#x89E3;&#x51B3;&#x90FD;&#x5F88;&#x7B80;&#x5355;&#x3002;&#x4F46;&#x662F;&#x7275;&#x626F;&#x51FA;&#x4E86;&#x4E00;&#x90E8;&#x5206;JVM&#x6E90;&#x7801;&#x7684;&#x77E5;&#x8BC6;&#xFF0C;&#x501F;&#x7531;&#x8FD9;&#x6B21;&#x673A;&#x4F1A;&#xFF0C;&#x52A0;&#x6DF1;&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#x3002;</p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"fastjson","path":"tags/fastjson/"},{"name":"ASM","path":"tags/ASM/"}],"excerpt":"<html><head></head><body><p>fastjson&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x8F7B;&#x91CF;&#x7EA7;&#x7684;java&#x5E8F;&#x5217;&#x5316;&#x7C7B;&#x5E93;&#xFF0C;&#x5176;&#x6700;&#x5927;&#x7684;&#x4F18;&#x52BF;&#x5C31;&#x662F;&#x5FEB;&#xFF0C;&#x56E0;&#x6B64;&#x4E5F;&#x88AB;&#x56FD;&#x5185;&#x5404;&#x4E2A;&#x4E2D;&#x5C0F;&#x578B;&#x516C;&#x53F8;&#x5927;&#x91CF;&#x7684;&#x4F7F;&#x7528;&#x3002;&#x4F46;&#x5B83;&#x4E5F;&#x6709;&#x4E0D;&#x5C11;&#x77ED;&#x677F;&#xFF0C;&#x5982;&#x53EF;&#x5B9A;&#x5236;&#x6027;&#x4F4E;&#x3001;API&#x4E0D;&#x591F;&#x4E30;&#x5BCC;&#x3001;&#x4EE3;&#x7801;&#x8D28;&#x91CF;&#x53CA;&#x6587;&#x6863;&#x7F3A;&#x5931;&#x7B49;&#x4E00;&#x4E9B;&#x5217;&#x95EE;&#x9898;&#x4E00;&#x76F4;&#x88AB;&#x4EBA;&#x6240;&#x8BDF;&#x75C5;&#x3002;</p>\n<p>&#x672C;&#x6B21;&#x6211;&#x4EEC;&#x78B0;&#x5230;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x7531;fastjson&#x7684;&#x4E00;&#x4E2A;&#x7B80;&#x5355;bug&#x800C;&#x5F15;&#x8D77;&#x7684;&#x4E00;&#x8FDE;&#x4E32;&#x7814;&#x7A76;&#x3002;</p></body></html>","more":"<h2 id=\"å‘ç°bug\"><a href=\"#å‘ç°bug\" class=\"headerlink\" title=\"å‘ç°bug\"></a>å‘ç°bug</h2><p>æŸæ—¥ä¸€ä½åŒå­¦åœ¨è°ƒè¯•æ–°éœ€æ±‚çš„æ—¶å€™å‘ç°å¦‚ä¸‹é”™è¯¯æ—¥å¿—ï¼š</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Exception in thread <span class=\"string\">&quot;collection-eventbus-thread-1&quot;</span> java.lang.NoSuchMethodError: com.alibaba.fastjson.serializer.JavaBeanSerializer.processValue(Lcom/alibaba/fastjson/serializer/JSONSerializer;Lcom/alibaba/fastjson/serializer/BeanContext;Ljava/lang/Object;Ljava/lang/String;Ljava/lang/Object;)Ljava/lang/Object;Ljava/lang/Integer;</span><br><span class=\"line\">\tat com.alibaba.fastjson.serializer.ASMSerializer_6_FastJsonSerializerWrapper.writeNormal(Unknown Source)</span><br><span class=\"line\">\tat com.alibaba.fastjson.serializer.ASMSerializer_6_FastJsonSerializerWrapper.write(Unknown Source)</span><br><span class=\"line\">\tat com.alibaba.fastjson.serializer.JSONSerializer.write(JSONSerializer.java:<span class=\"number\">285</span>)</span><br><span class=\"line\">\tat com.alibaba.fastjson.JSON.toJSONString(JSON.java:<span class=\"number\">663</span>)</span><br><span class=\"line\">\tat com.alibaba.fastjson.JSON.toJSONString(JSON.java:<span class=\"number\">652</span>)</span><br><span class=\"line\">\tat com.oriente.cache.layeringCache.serializer.FastJsonRedisSerializer.serialize(FastJsonRedisSerializer.java:<span class=\"number\">37</span>)</span><br><span class=\"line\">\tat org.springframework.data.redis.core.AbstractOperations.rawValue(AbstractOperations.java:<span class=\"number\">117</span>)</span><br><span class=\"line\">\tat org.springframework.data.redis.core.DefaultValueOperations.multiSet(DefaultValueOperations.java:<span class=\"number\">136</span>)</span><br><span class=\"line\">\tat com.oriente.collection.event.listener.RedisEventListener.schedule(RedisEventListener.java:<span class=\"number\">75</span>)</span><br><span class=\"line\">\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class=\"line\">\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class=\"number\">62</span>)</span><br><span class=\"line\">\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class=\"number\">43</span>)</span><br><span class=\"line\">\tat java.lang.reflect.Method.invoke(Method.java:<span class=\"number\">498</span>)</span><br><span class=\"line\">\tat com.google.common.eventbus.Subscriber.invokeSubscriberMethod(Subscriber.java:<span class=\"number\">87</span>)</span><br><span class=\"line\">\tat com.google.common.eventbus.Subscriber$SynchronizedSubscriber.invokeSubscriberMethod(Subscriber.java:<span class=\"number\">144</span>)</span><br><span class=\"line\">\tat com.google.common.eventbus.Subscriber$<span class=\"number\">1.</span>run(Subscriber.java:<span class=\"number\">72</span>)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class=\"number\">1149</span>)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class=\"number\">624</span>)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:<span class=\"number\">748</span>)</span><br></pre></td></tr></table></figure>\n\n<p>é€šè¿‡è§‚å¯Ÿé”™è¯¯ï¼Œå¾ˆå¿«å°±èƒ½å®šä½åˆ°æ˜¯fastjsonåºåˆ—åŒ–çš„æ—¶å€™å‡ºç°äº†é”™è¯¯ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿç¡®è®¤çš„ä»£ç ï¼Œåœ¨è‡ªå®šçš„RedisTemplateä¸­ï¼Œé’ˆå¯¹Valueçš„åºåˆ—åŒ–å·¥å…·æˆ‘ä»¬çš„ç¡®ä½¿ç”¨äº†fastjsonçš„åºåˆ—åŒ–æ–¹å¼ã€‚</p>\n<ul>\n<li><p>RedisTemplateä½¿ç”¨è‡ªå®šä¹‰çš„fastjosonåºåˆ—åŒ–å·¥å…·</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FastJsonRedisSerializer&lt;Object&gt; fastJsonRedisSerializer = <span class=\"keyword\">new</span> FastJsonRedisSerializer&lt;&gt;(Object.class);</span><br><span class=\"line\"></span><br><span class=\"line\">redisTemplate.setValueSerializer(fastJsonRedisSerializer);</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>FastJsonRedisSerializerä¸­ä½¿ç”¨fastjsonçš„APIå¯¹ç»Ÿä¸€åŒ…è£…ç±»è¿›è¡Œåºåˆ—åŒ–</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">byte</span>[] serialize(T t) <span class=\"keyword\">throws</span> SerializationException &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JSON.toJSONString(<span class=\"keyword\">new</span> FastJsonSerializerWrapper(t), SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> SerializationException(String.format(<span class=\"string\">&quot;FastJsonRedisSerializer åºåˆ—åŒ–å¼‚å¸¸: %s, ã€JSONï¼š%sã€‘&quot;</span>,</span><br><span class=\"line\">                e.getMessage(), JSON.toJSONString(t)), e);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<h2 id=\"åˆ†æbug\"><a href=\"#åˆ†æbug\" class=\"headerlink\" title=\"åˆ†æbug\"></a>åˆ†æbug</h2><p>ç»è¿‡ä¸Šé¢çš„ä¸€é¡¿æ’æŸ¥ï¼Œé—®é¢˜å·²ç»å¾ˆæ˜ç¡®å®šä½åˆ°æ˜¯fastjsonä¸Šäº†ï¼Œå¹¶ä¸”é”™è¯¯ä¿¡æ¯ç»™çš„ç›¸å½“æ˜ç¡®ï¼š</p>\n<p>  <font color=\"red\"> <code>java.lang.NoSuchMethodError: com.alibaba.fastjson.serializer.JavaBeanSerializer.processValue(Lcom/alibaba/fastjson/serializer/JSONSerializer;Lcom/alibaba/fastjson/serializer/BeanContext;Ljava/lang/Object;Ljava/lang/String;Ljava/lang/Object;)Ljava/lang/Object;Ljava/lang/Integer;</code> </font></p>\n<p>æç¤ºæœªæ‰¾åˆ°JavaBeanSerializer.processValueæ–¹æ³•ã€‚okæˆ‘ä»¬ç«‹é©¬æŸ¥è¯¢JavaBeanSerializeræºç ï¼Œå‘ç°processalueæ–¹æ³•æ˜¯ç»§æ‰¿è‡ªSerializeFilterableç±»ï¼š</p>\n<blockquote>\n<p>æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.JavaBeanSerializer</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> Object <span class=\"title\">processValue</span><span class=\"params\">(JSONSerializer jsonBeanDeser, //</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                           BeanContext beanContext,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                           Object object, //</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                           String key, //</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                           Object propertyValue, //</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                           <span class=\"keyword\">int</span> features)</span> </span>&#123;</span><br></pre></td></tr></table></figure>\n\n<p>ä¹ä¸€çœ‹æ–¹æ³•æ˜¯å­˜åœ¨çš„ï¼Œè¿™æ˜¯æˆ‘ä»¬åˆå›åˆ°äº†é”™è¯¯æœ¬èº«ã€‚ä»”ç»†æŸ¥çœ‹é”™è¯¯ï¼Œé”™è¯¯ä¸­æç¤ºæˆ‘ä»¬processValueæ–¹æ³•ç­¾åå¦‚ä¸‹ï¼š</p>\n<p>å…¥å‚ï¼š</p>\n<ol>\n<li>Lcom/alibaba/fastjson/serializer/JSONSerializer <font color=\"green\">â€“JSONSerializerç±»å‹çš„å¯¹è±¡</font></li>\n<li>Lcom/alibaba/fastjson/serializer/BeanContext <font color=\"green\">â€“BeanContextç±»å‹çš„å¯¹è±¡</font></li>\n<li>Ljava/lang/Object <font color=\"green\">â€“Objectå¯¹è±¡</font></li>\n<li>Ljava/lang/String <font color=\"green\">â€“String ç±»å‹</font></li>\n<li>Ljava/lang/Object <font color=\"green\">â€“Objectå¯¹è±¡</font></li>\n</ol>\n<p>è¿”å›å‚æ•°ï¼š</p>\n<ol>\n<li>Ljava/lang/Object;Ljava/lang/Integer; <font color=\"green\">â€“è¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿjavaçš„è¿”å›å‚æ•°åº”è¯¥æ˜¯ä¸æ”¯æŒä¸¤ä¸ªæ‰å¯¹å•Šï¼</font></li>\n</ol>\n<p>ç»è¿‡å¯¹æ¯”ï¼Œæœç„¶æ–¹æ³•ç­¾åä¸ä¸€è‡´ã€‚æºç ä¸­SerializeFilterable.processValue()æ–¹æ³•ä¸­æœ‰6ä¸ªå…¥å‚ï¼Œè€Œé”™è¯¯æ—¥å¿—ä¸­æç¤ºçš„åªæœ‰5ä¸ªå…¥å‚ã€‚ç¼ºå°‘äº†æœ€åä¸€ä¸ª <font color=\"blue\"> int features</font></p>\n<h4 id=\"é—®é¢˜1\"><a href=\"#é—®é¢˜1\" class=\"headerlink\" title=\"é—®é¢˜1\"></a>é—®é¢˜1</h4><p>ä»æ–¹æ³•ç­¾åçš„å¯¹æ¯”æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¯¥é”™è¯¯çš„ç¡®æ˜¯å› ä¸ºæ‰¾ä¸å¯¹å¯¹åº”çš„æ–¹æ³•æ‰€å¯¼è‡´çš„ã€‚ç”±äºfastjsonåºåˆ—åŒ–çš„å¯¹è±¡æ˜¯é€šè¿‡ASMåŠ¨æ€ç”Ÿæˆå­—èŠ‚ç äº§ç”Ÿçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šå¤šæºç æˆ–è€…å€ŸåŠ©å·¥å…·æ¥éªŒè¯è¿™ä¸ªbugçš„çœŸå®æ€§ã€‚</p>\n<h5 id=\"1-ä»£ç éªŒè¯\"><a href=\"#1-ä»£ç éªŒè¯\" class=\"headerlink\" title=\"1.ä»£ç éªŒè¯\"></a>1.ä»£ç éªŒè¯</h5><p>fastjsonåœ¨javaå¹³å°ä¸‹ä¼šé»˜è®¤ä½¿ç”¨ASMçš„æ–¹å¼åŠ¨æ€ç”Ÿæˆåºåˆ—åŒ–ä»£ç†ç±»</p>\n<blockquote>\n<p>æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.SerializeConfig</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span>                                       asm             = !ASMUtils.IS_ANDROID;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.SerializeConfig</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (asm) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        ObjectSerializer asmSerializer = createASMSerializer(beanInfo);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (asmSerializer != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> asmSerializer;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// skip</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (ClassFormatError e) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// skip</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (ClassCastException e) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// skip</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (OutOfMemoryError e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (e.getMessage().indexOf(<span class=\"string\">&quot;Metaspace&quot;</span>) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> e;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// skip</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Throwable e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> JSONException(<span class=\"string\">&quot;create asm serializer error, verson &quot;</span> + JSON.VERSION + <span class=\"string\">&quot;, class &quot;</span> + clazz, e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.ASMSerializerFactory</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">_processValue</span><span class=\"params\">(MethodVisitor mw, FieldInfo fieldInfo, Context context, Label _end)</span> </span>&#123;</span><br><span class=\"line\">...</span><br><span class=\"line\">        mw.visitMethodInsn(INVOKEVIRTUAL, JavaBeanSerializer, <span class=\"string\">&quot;processValue&quot;</span>,</span><br><span class=\"line\">                           <span class=\"string\">&quot;(L&quot;</span> + JSONSerializer  + <span class=\"string\">&quot;;&quot;</span> <span class=\"comment\">//</span></span><br><span class=\"line\">                                                                          + desc(BeanContext.class) <span class=\"comment\">//</span></span><br><span class=\"line\">                                                                          + <span class=\"string\">&quot;Ljava/lang/Object;Ljava/lang/String;&quot;</span> <span class=\"comment\">//</span></span><br><span class=\"line\">                                                                          + valueDesc + <span class=\"string\">&quot;)Ljava/lang/Object;Ljava/lang/Integer;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                                                                          ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>é€šè¿‡ä¸Šè¿°æºç ï¼Œå¯ä»¥å‘ç°åœ¨é€šè¿‡ASMç”ŸæˆprocessValueæ–¹æ³•ç­¾åæ—¶ï¼Œåªå®šä¹‰äº†5ä¸ªå‚æ•°ã€‚åŒæ—¶ä¹Ÿèƒ½çœ‹åˆ°è¿”å›å‚æ•°å¤šè®¾ç½®äº†ä¸ªLjava/lang/Integerç±»å‹ã€‚</p>\n<p>ä¾èµ–ä»£ç é˜…è¯»ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥ç¡®å®šé”™è¯¯ä»£ç çš„ä½ç½®äº†ã€‚ä½†ç”±äºæ¯•ç«Ÿæ˜¯é€šè¿‡ASMåŠ¨æ€å­—èŠ‚ç ç”Ÿæˆçš„ç±»å’Œå¯¹è±¡ï¼Œå®é™…åœ¨JVMä¸­çš„ç±»æ˜¯å¦ä¹Ÿåƒæˆ‘ä»¬ç°åœ¨çœ‹åˆ°çš„ä¸€æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦å€ŸåŠ©å…¶ä»–å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬è§‚å¯Ÿäº†ã€‚</p>\n<h5 id=\"2-é€šè¿‡HSDBè§‚å¯ŸJVMä¸­çš„ç±»\"><a href=\"#2-é€šè¿‡HSDBè§‚å¯ŸJVMä¸­çš„ç±»\" class=\"headerlink\" title=\"2.é€šè¿‡HSDBè§‚å¯ŸJVMä¸­çš„ç±»\"></a>2.é€šè¿‡HSDBè§‚å¯ŸJVMä¸­çš„ç±»</h5><ul>\n<li>å·²Debugæ¨¡å¼å¯åŠ¨JavaæœåŠ¡</li>\n<li>å°†æ–­ç‚¹è®¾ç½®åˆ°ä»£ç†ç±»ç”Ÿäº§é€»è¾‘å<blockquote>\n<p>æ–¹æ³•æ¸…å•ï¼šcom.alibaba.fastjson.serializer.ASMSerializerFactory</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//å°†åŠ¨æ€ç”Ÿæˆçš„å­—èŠ‚ç å¯¹è±¡è£…ç»´å­—èŠ‚æ•°ç»„</span></span><br><span class=\"line\"><span class=\"keyword\">byte</span>[] code = cw.toByteArray();</span><br><span class=\"line\"><span class=\"comment\">//åŠ¨æ€åŠ è½½ç±»</span></span><br><span class=\"line\">Class&lt;?&gt; serializerClass = classLoader.defineClassPublic(classNameFull, code, <span class=\"number\">0</span>, code.length);</span><br></pre></td></tr></table></figure>\n\n</li>\n</ul>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/classload%E6%96%AD%E7%82%B9.png\" alt=\"01\"></p>\n<ul>\n<li><p>æ‰“å¼€HSDB</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -cp sa-jdi.jar sun.jvm.hotspot.HSDB</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>è·å–å½“å‰javaè¿›ç¨‹</p>\n</li>\n</ul>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/jps.png\" alt=\"02\"></p>\n<ul>\n<li>HSDB attachå½“å‰javaè¿›ç¨‹</li>\n</ul>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/hdbs_attach.png\" alt=\"03\"></p>\n<ul>\n<li>æ‰§è¡Œæ–¹æ³•è‡³æ–­ç‚¹å¤„åï¼Œåœ¨HSDBæœç´¢ä»£ç†ç±»</li>\n</ul>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/class_browser.png\" alt=\"04\"></p>\n<p>é€šè¿‡è§‚å¯ŸFastJsonSerializerWrapper.writeNormal()æ–¹æ³•çš„å­—èŠ‚ç ä¹Ÿå¯ä»¥å‘ç°ï¼Œåœ¨è°ƒç”¨processValue()æ–¹æ³•çš„æ—¶å€™ç¼ºå°‘äº†ä¸€ä¸ªå‚æ•°ã€‚</p>\n<ul>\n<li>æŸ¥çœ‹FastJsonSerializerWrapperçš„å¸¸é‡æ± </li>\n</ul>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/constantpool.png\" alt=\"05\"></p>\n<p>æŸ¥çœ‹å¸¸é‡æ± ä¸­çš„å†…å®¹ï¼Œä¹Ÿå†æ¬¡ç¡®è®¤äº†processValue()æ–¹æ³•çš„ç­¾åå­˜åœ¨é—®é¢˜ï¼šå…¥å‚ä¸å¯¹ã€è¿”å›å‚æ•°ä¹Ÿæœ‰é—®é¢˜ã€‚</p>\n<h4 id=\"é—®é¢˜2\"><a href=\"#é—®é¢˜2\" class=\"headerlink\" title=\"é—®é¢˜2\"></a>é—®é¢˜2</h4><p>ASMSerializer_6_FastJsonSerializerWrapper.processValue()æ–¹æ³•çš„è¿”å›å€¼æœ‰ä¸¤ä¸ªã€‚è¿™ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆåœ¨ç±»åŠ¨æ€åŠ è½½çš„æ—¶å€™JVMæ²¡æœ‰æ£€æŸ¥å‡ºæ–¹æ³•ç­¾åçš„é—®é¢˜?</p>\n<p>é¢„çŸ¥å¤§é“ï¼Œå¿…å…ˆä¸ºå²ã€‚javaä¹Ÿä¸€æ ·ï¼Œjavaçš„å†å²å°±æ˜¯JVMã€‚è¦æƒ³äº†è§£åŠ¨æ€åŠ è½½ç±»çš„æ—¶å€™åˆ°åº•åšäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å°±å¿…é¡»å‚é˜…JVMæºç ã€‚</p>\n<p>ä¹‹å‰é˜…è¯»fastjsonæºç çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ›¾ç»æ¥åˆ°è¿™ä¹ˆä¸€æ®µä»£ç ã€‚</p>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/classload%E6%96%AD%E7%82%B9.png\" alt=\"06\"></p>\n<p>æ˜¾ç„¶æºç æ˜¯é€šè¿‡è°ƒç”¨nativeæ–¹æ³•ï¼Œå°†ç±»çš„å­—èŠ‚æµå†™å…¥åˆ°JVMä¸­çš„ã€‚jdkä¸ºå¼€å‘è€…æä¾›äº†ä¸°å¯Œçš„ç±»åŠ è½½æœºåˆ¶ï¼Œä½†ç©¶å…¶æºè¿˜æ˜¯ä¾èµ–äº†è¿™ä¸‰ä¸ªnativeæ–¹æ³•ï¼Œå¹¶ä¸”è¿™ä¸‰ä¸ªæ–¹æ³•ä»…ä»…æ˜¯å…¥å‚ä¸åŒï¼Œå…¶èƒŒåçš„å®ç°åŸç†å…¶å®æ˜¯ä¸€æ ·çš„ã€‚</p>\n<blockquote>\n<p>æ–¹æ³•æ¸…å•ï¼šjava.lang.ClassLoader</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">native</span> Class&lt;?&gt; defineClass0(String name, <span class=\"keyword\">byte</span>[] b, <span class=\"keyword\">int</span> off, <span class=\"keyword\">int</span> len,</span><br><span class=\"line\">                                     ProtectionDomain pd);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">native</span> Class&lt;?&gt; defineClass1(String name, <span class=\"keyword\">byte</span>[] b, <span class=\"keyword\">int</span> off, <span class=\"keyword\">int</span> len,</span><br><span class=\"line\">                                     ProtectionDomain pd, String source);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">native</span> Class&lt;?&gt; defineClass2(String name, java.nio.ByteBuffer b,</span><br><span class=\"line\">                                     <span class=\"keyword\">int</span> off, <span class=\"keyword\">int</span> len, ProtectionDomain pd,</span><br><span class=\"line\">                                     String source);</span><br></pre></td></tr></table></figure>\n\n<h6 id=\"java-native-æ–¹æ³•å…¥å£\"><a href=\"#java-native-æ–¹æ³•å…¥å£\" class=\"headerlink\" title=\"java native æ–¹æ³•å…¥å£\"></a>java native æ–¹æ³•å…¥å£</h6><p>æŒ‰ç…§jniçš„å®šä¹‰è§„èŒƒï¼Œnativeæ–¹æ³•ä¼šæŒ‰ç…§ä»¥ä¸‹çš„æ ¼å¼è¿›è¡Œå®šä¹‰ï¼š<br>__JNIEXPORT jclass JNICALL Java_packagepath(åŒ…è·¯å¾„å·²<em>åˆ†å‰²)<em>æ–¹æ³•å</em></em></p>\n<p>æ ¹æ®ä¸Šé¢çš„è§„å®šï¼Œæˆ‘ä»¬å¾ˆå¿«å°±èƒ½è¿˜åŸå‡ºdefineClass1æ–¹æ³•åœ¨jdkä¸­çš„å®šä¹‰ï¼š<br><font color=\"blue\"> JNIEXPORT jclass JNICALL Java_java_lang_ClassLoader_defineClass1</font></p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/native/java/lang/ClassLoader.c</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JNIEXPORT jclass JNICALL</span><br><span class=\"line\">Java_java_lang_ClassLoader_defineClass1(JNIEnv *env,</span><br><span class=\"line\">                                        jobject loader,</span><br><span class=\"line\">                                        jstring name,</span><br><span class=\"line\">                                        jbyteArray data,</span><br><span class=\"line\">                                        jint offset,</span><br><span class=\"line\">                                        jint length,</span><br><span class=\"line\">                                        jobject pd,</span><br><span class=\"line\">                                        jstring source)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    jbyte *body;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> *utfName;</span><br><span class=\"line\">    jclass result = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> buf[<span class=\"number\">128</span>];</span><br><span class=\"line\">    <span class=\"keyword\">char</span>* utfSource;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> sourceBuf[<span class=\"number\">1024</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (data == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        JNU_ThrowNullPointerException(env, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* Work around 4153825. malloc crashes on Solaris when passed a</span></span><br><span class=\"line\"><span class=\"comment\">     * negative size.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (length &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        JNU_ThrowArrayIndexOutOfBoundsException(env, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    body = (jbyte *)<span class=\"built_in\">malloc</span>(length);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (body == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        JNU_ThrowOutOfMemoryError(env, <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    (*env)-&gt;GetByteArrayRegion(env, data, offset, length, body);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> ((*env)-&gt;ExceptionOccurred(env))</span><br><span class=\"line\">        <span class=\"keyword\">goto</span> free_body;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (name != <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        utfName = getUTF(env, name, buf, <span class=\"keyword\">sizeof</span>(buf));</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (utfName == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">            JNU_ThrowOutOfMemoryError(env, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">            <span class=\"keyword\">goto</span> free_body;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        VerifyFixClassname(utfName);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        utfName = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (source != <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        utfSource = getUTF(env, source, sourceBuf, <span class=\"keyword\">sizeof</span>(sourceBuf));</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (utfSource == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">            JNU_ThrowOutOfMemoryError(env, <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">            <span class=\"keyword\">goto</span> free_utfName;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        utfSource = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    result = JVM_DefineClassWithSource(env, utfName, loader, body, length, pd, utfSource);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (utfSource &amp;&amp; utfSource != sourceBuf)</span><br><span class=\"line\">        <span class=\"built_in\">free</span>(utfSource);</span><br><span class=\"line\"></span><br><span class=\"line\"> free_utfName:</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (utfName &amp;&amp; utfName != buf)</span><br><span class=\"line\">        <span class=\"built_in\">free</span>(utfName);</span><br><span class=\"line\"></span><br><span class=\"line\"> free_body:</span><br><span class=\"line\">    <span class=\"built_in\">free</span>(body);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä»£ç ä¸­è°ƒç”¨äº†JVM_DefineClassWithSourceæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®šä¹‰åœ¨JVMæºç ä¸­ï¼Œä¸‹è½½JVMæºç æœç´¢è¯¥æ–¹æ³•ã€‚</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/vm/prims/jvm.cpp</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JVM_ENTRY(jclass, JVM_DefineClassWithSource(JNIEnv *env, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *name, jobject loader, <span class=\"keyword\">const</span> jbyte *buf, jsize len, jobject pd, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *source))</span><br><span class=\"line\">  JVMWrapper2(<span class=\"string\">&quot;JVM_DefineClassWithSource %s&quot;</span>, name);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> jvm_define_class_common(env, name, loader, buf, len, pd, source, <span class=\"literal\">true</span>, THREAD);</span><br><span class=\"line\">JVM_END</span><br></pre></td></tr></table></figure>\n<p>ç»è¿‡ä¸€è¿ä¸²çš„å†…éƒ¨è°ƒç”¨,JVMæ‰å¼€å§‹çœŸæ­£è§£æå­—èŠ‚ç æµï¼š</p>\n<blockquote>\n<p>src/share/vm/prims/jvm.cpp â€“&gt; JVM_DefineClassWithSource()</p>\n<blockquote>\n<p>src/share/vm/prims/jvm.cpp â€“&gt; jvm_define_class_common()</p>\n<blockquote>\n<p>src/share/vm/classfile/systemDictionary.cpp â€“&gt; Klass* SystemDictionary::resolve_from_stream()</p>\n<blockquote>\n<p>src/share/vm/classfile/classFileParser.cpp â€“&gt; instanceKlassHandle ClassFileParser::parseClassFile()</p>\n</blockquote>\n</blockquote>\n</blockquote>\n</blockquote>\n<p>JVMé¦–å…ˆä¼šåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæ ¼å¼æ ¡éªŒ</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/vm/classfile/classFileParser.cpp</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Figure out whether we can skip format checking (matching classic VM behavior)</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (DumpSharedSpaces) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// verify == true means it&#x27;s a &#x27;remote&#x27; class (i.e., non-boot class)</span></span><br><span class=\"line\">  <span class=\"comment\">// Verification decision is based on BytecodeVerificationRemote flag</span></span><br><span class=\"line\">  <span class=\"comment\">// for those classes.</span></span><br><span class=\"line\">  _need_verify = (verify) ? BytecodeVerificationRemote :</span><br><span class=\"line\">                            BytecodeVerificationLocal;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  _need_verify = Verifier::should_verify_for(class_loader(), verify);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>DumpSharedSpacesé»˜è®¤ä¸ºfalseï¼Œå› æ­¤ä¼šèµ°åˆ°ä¸‹é¢çš„åˆ†æ”¯</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/vm/classfile/verifier.cpp</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">Verifier::should_verify_for</span><span class=\"params\">(oop class_loader, <span class=\"keyword\">bool</span> should_verify_class)</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (class_loader == <span class=\"literal\">NULL</span> || !should_verify_class) ?</span><br><span class=\"line\">    BytecodeVerificationLocal : BytecodeVerificationRemote;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å½“å‰class_loaderä¸ºå½“å‰classLoadï¼Œå¹¶ä¸”should_verify_classåœ¨è°ƒç”¨jvm_define_class_commonæ–¹æ³•æ—¶ä¼ å€¼true</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/vm/prims/jvm.cpp</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JVM_ENTRY(jclass, JVM_DefineClassWithSource(JNIEnv *env, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *name, jobject loader, <span class=\"keyword\">const</span> jbyte *buf, jsize len, jobject pd, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *source))</span><br><span class=\"line\">  JVMWrapper2(<span class=\"string\">&quot;JVM_DefineClassWithSource %s&quot;</span>, name);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> jvm_define_class_common(env, name, loader, buf, len, pd, source, <span class=\"literal\">true</span>, THREAD);</span><br><span class=\"line\">JVM_END</span><br></pre></td></tr></table></figure>\n\n<p>å› æ­¤åˆ¤æ–­_need_verifyçš„ç»“æœæœ€ç»ˆè½åˆ°äº†BytecodeVerificationRemoteä¸Šã€‚</p>\n<p>æˆ‘ä»¬å…ˆçœ‹BytecodeVerificationRemoteåœ¨jvmé‡Œçš„å®šä¹‰ï¼š</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/globals.hpp</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">product(<span class=\"keyword\">bool</span>, BytecodeVerificationRemote, <span class=\"literal\">true</span>,                           \\</span><br><span class=\"line\">        <span class=\"string\">&quot;Enable the Java bytecode verifier for remote classes&quot;</span>)           \\</span><br></pre></td></tr></table></figure>\n<p>å¯è§BytecodeVerificationRemoteåœ¨JVMåˆå§‹åŒ–çš„æ—¶å€™é»˜è®¤å€¼ä¸ºtrueï¼Œä»£è¡¨éJVMè‡ªå·±çš„å¯¹è±¡åœ¨åŠ è½½çš„æ—¶å€™éœ€è¦è¿›è¡Œå„ç§æ ¡éªŒã€‚</p>\n<p>ä¸ºäº†è¯æ˜è¿™ç‚¹ï¼Œæˆ‘ä»¬å†çœ‹çœ‹è§£ææ–¹æ³•æ—¶å…·ä½“çš„é€»è¾‘ï¼š</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/vm/classfile/classFileParser.cpp â€“&gt; methodHandle ClassFileParser::parse_method()</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (_need_verify) &#123;</span><br><span class=\"line\">  args_size = ((flags &amp; JVM_ACC_STATIC) ? <span class=\"number\">0</span> : <span class=\"number\">1</span>) +</span><br><span class=\"line\">               verify_legal_method_signature(name, signature, CHECK_(nullHandle));</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (args_size &gt; MAX_ARGS_SIZE) &#123;</span><br><span class=\"line\">    classfile_parse_error(<span class=\"string\">&quot;Too many arguments in method signature in class file %s&quot;</span>, CHECK_(nullHandle));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>JVMåœ¨è§£ææ–¹æ³•çš„é€»è¾‘ä¸­ï¼Œä¼šå…ˆå¯¹æ–¹æ³•çš„åˆæ³•æ€§åšå„ç§æ ¡éªŒã€‚å…¶ä¸­å°±æœ‰å¯¹æ–¹æ³•ç­¾åçš„æ ¡éªŒã€‚å¦‚æœ_need_verifyä¸ºfalseï¼Œåˆ™æ”¹æ ¡éªŒä¼šè¢«è·³è¿‡ã€‚</p>\n<p>é€šè¿‡ä¸Šé¢çš„ä¸€è¿ä¸²çš„ä»£ç åˆ†æï¼Œæˆ‘ä»¬å¾—åˆ°äº†BytecodeVerificationRemoteçš„å€¼æœ€ç»ˆä¼šå½±å“Fastjsoné€šè¿‡ASMåŠ¨æ€å­—èŠ‚ç ç”Ÿæˆçš„ç±»æ–‡ä»¶çš„è§£æã€‚</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬ææ˜ç™½BytecodeVerificationRemoteçš„å€¼æ˜¯å¦‚ä½•è¢«æ›´æ”¹çš„ï¼Œè€æ ·å­ä»£ç ä¸€é¡¿ä¹±æœï¼š</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/arguments.cpp â€“&gt; jint Arguments::parse_each_vm_init_arg</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// -Xverify</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (match_option(option, <span class=\"string\">&quot;-Xverify&quot;</span>, &amp;tail)) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (<span class=\"built_in\">strcmp</span>(tail, <span class=\"string\">&quot;:all&quot;</span>) == <span class=\"number\">0</span> || <span class=\"built_in\">strcmp</span>(tail, <span class=\"string\">&quot;&quot;</span>) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        FLAG_SET_CMDLINE(<span class=\"keyword\">bool</span>, BytecodeVerificationLocal, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        FLAG_SET_CMDLINE(<span class=\"keyword\">bool</span>, BytecodeVerificationRemote, <span class=\"literal\">true</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">strcmp</span>(tail, <span class=\"string\">&quot;:remote&quot;</span>) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        FLAG_SET_CMDLINE(<span class=\"keyword\">bool</span>, BytecodeVerificationLocal, <span class=\"literal\">false</span>);</span><br><span class=\"line\">        FLAG_SET_CMDLINE(<span class=\"keyword\">bool</span>, BytecodeVerificationRemote, <span class=\"literal\">true</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"built_in\">strcmp</span>(tail, <span class=\"string\">&quot;:none&quot;</span>) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        FLAG_SET_CMDLINE(<span class=\"keyword\">bool</span>, BytecodeVerificationLocal, <span class=\"literal\">false</span>);</span><br><span class=\"line\">        FLAG_SET_CMDLINE(<span class=\"keyword\">bool</span>, BytecodeVerificationRemote, <span class=\"literal\">false</span>);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (is_bad_option(option, args-&gt;ignoreUnrecognized, <span class=\"string\">&quot;verification&quot;</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JNI_EINVAL;</span><br><span class=\"line\">      &#125;</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>Xverify</th>\n<th>BytecodeVerificationLocal</th>\n<th>BytecodeVerificationRemote</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>all æˆ– ä¸ä¼ </td>\n<td>true</td>\n<td>true</td>\n</tr>\n<tr>\n<td>remote</td>\n<td>false</td>\n<td>true</td>\n</tr>\n<tr>\n<td>none</td>\n<td>false</td>\n<td>false</td>\n</tr>\n</tbody></table>\n<p>é¡ºç€è¿™ä¸ªæ€è·¯æˆ‘ä»¬å†çœ‹çœ‹æœåŠ¡å¯åŠ¨æ—¶çš„å‚æ•°ã€‚ç”±äºæ˜¯é‡‡ç”¨IDEAå¯åŠ¨çš„springbooté¡¹ç›®ï¼Œæˆ‘ä»¬æ²¡æœ‰æ‰‹åŠ¨æŒ‡å®šå„ç§å¯åŠ¨å‚æ•°ã€‚è€æ ·å­æˆ‘ä»¬è¿˜æ˜¯å€ŸåŠ©å…¶ä»–å·¥å…·è¿›è¡ŒæŸ¥çœ‹ã€‚è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨jdkè‡ªå¸¦çš„VisualVMã€‚</p>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/visualVM.png\" alt=\"07\"></p>\n<p>è¿™å›äº‹çœŸç›¸å¤§ç™½äº†ï¼Œé€šè¿‡IDEAé»˜è®¤å¯åŠ¨springbooté¡¹ç›®æ—¶ï¼Œä¼šé»˜è®¤å¸¦ä¸Š<font color=\"red\">-Xverify:none</font>å‚æ•°ã€‚ç»“åˆæˆ‘ä»¬ä¸Šé¢å¯¹JVMæºç çš„åˆ†æï¼Œåœ¨Xverify==noneæ—¶ã€‚åŠ è½½ç±»æ¨¡æ¿æ—¶ä¸ä¼šå¯¹ç±»ç»“æ„çš„åˆæ³•æ€§è¿›è¡Œæ ¡éªŒï¼Œè¿™ä¹Ÿæœ€ç»ˆå¯¼è‡´äº†ä¸ºä»€ä¹ˆæ–¹æ³•ç­¾åæ˜æ˜ä¸æ­£ç¡®ï¼Œä½†æ˜¯JVMè¿˜æ˜¯æˆåŠŸçš„åŠ è½½äº†è¿™ä¸ªç±»ã€‚</p>\n<p>è‡³äºä¸ºä»€ä¹ˆIDEAå¯åŠ¨çš„æ—¶å€™ä¼šå¸¦ä¸Š<font color=\"red\">-Xverify:none</font>å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒå®˜ç½‘çš„ä¸€å¥è¯ã€‚</p>\n<blockquote>\n<p><a href=\"https://www.jetbrains.com/help/idea/run-debug-configuration-spring-boot.html#configuration-tab\">https://www.jetbrains.com/help/idea/run-debug-configuration-spring-boot.html#configuration-tab</a></p>\n</blockquote>\n<p><img src=\"/2020/08/17/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5/idea.png\" alt=\"08\"></p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>è‡³æ­¤ï¼Œæ•´ä¸ªfastjsonåºåˆ—åŒ–å¼•èµ·çš„å¼‚å¸¸å·²ç»æ’æŸ¥å®Œäº†ã€‚</p>\n<p>å›é¡¾æ•´ä¸ªæ’æŸ¥è¿‡ç¨‹å…¶å®è¿™ä¸€ä¸ªé”™è¯¯å¼•å‡ºäº†ä¸¤ä¸ªé—®é¢˜ã€‚</p>\n<ul>\n<li>ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯fastjsoné€šè¿‡ASMç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶çš„æ—¶å€™ï¼ŒprocessValueçš„å‚æ•°ä¸ªæ•°ä¸å¯¹ã€‚fastjsonå®˜æ–¹åœ¨åç»­ç‰ˆæœ¬ä¸­å¢åŠ äº†processValueçš„é‡è½½æ–¹æ³•ï¼Œä»è€Œä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚</li>\n<li>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯processValueæ–¹æ³•çš„æ–¹æ³•ç­¾åä¸æ­£ç¡®ï¼Œæ–¹æ³•è¿”å›ç±»å‹å†™æœ‰ä¸¤ä¸ªå‚æ•°ã€‚ä»è€Œå¼•èµ·å¯¹JVMè§£æç±»æ—¶ï¼Œæ–¹æ³•ç­¾ååˆæ³•æ€§æ ¡éªŒæœºåˆ¶çš„ç ”ç©¶ã€‚å®˜æ–¹ä¹Ÿåœ¨åç»­ç‰ˆæœ¬ä¸­ä¿®æ­£äº†æ–¹æ³•ç­¾åçš„é”™è¯¯ã€‚</li>\n</ul>\n<p>ä»¥ä¸Šï¼Œè™½ç„¶è¿™æ¬¡é—®é¢˜çš„å‘ç°å’Œè§£å†³éƒ½å¾ˆç®€å•ã€‚ä½†æ˜¯ç‰µæ‰¯å‡ºäº†ä¸€éƒ¨åˆ†JVMæºç çš„çŸ¥è¯†ï¼Œå€Ÿç”±è¿™æ¬¡æœºä¼šï¼ŒåŠ æ·±ç›¸å…³çŸ¥è¯†ã€‚</p>"},{"title":"æˆ‘ä¸ºä»€ä¹ˆä¼šæ‰‹æ’¸ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»£ç ç¯‡","date":"2020-04-18T07:12:58.000Z","_content":"\nä¸ŠæœŸæˆ‘ä»¬ç¡®å®šäº†ä»¥Springçš„æ–¹å‘å’Œé‡‡ç”¨Redisæ¥åšé…ç½®å…³ç³»ï¼Œæˆ‘ä»¬å°±å¼€å§‹å›´ç»•è¿™ä¸¤ä¸ªå¤§å¤´å…·ä½“çš„å¼€å§‹è®¾è®¡å®¢æˆ·ç«¯åŠŸèƒ½ã€‚\n\n## 1.è®©Springå¯åŠ¨æˆ‘ä»¬çš„é…ç½®ä¸­å¿ƒå®¢æˆ·ç«¯\næˆ‘ä»¬å®šä¹‰äº†é…ç½®ä¸­å¿ƒçš„å¯åŠ¨æ³¨è§£ã€‚åŒå¤§å¤šæ•°Springçš„æ•´åˆé¡¹ç›®ä¸€æ ·ï¼Œä¸ä»…èƒ½é€šè¿‡å¯åŠ¨æ³¨è§£å¯ç”¨åŠŸèƒ½ï¼ŒåŒæ—¶è¿˜èƒ½å¯¹é…ç½®çš„åº”ç”¨è¿›è¡Œåˆå§‹è®¾å®šã€‚\n<!-- more -->\n``` java\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.TYPE)\n@Documented\n@Import(ConfigRegistrar.class)\npublic @interface EnableNadiaConfig {\n    //å¯ç”¨ç¯å¢ƒ\n    //æœªè®¾ç½®æ—¶æ‰€æœ‰ç¯å¢ƒå¯åŠ¨\n    String[] actives() default {};\n\n    //æŒ‡å®šé…ç½®æ‰€å±çš„Application\n    String application() default \"\";\n\n    //é»˜è®¤åˆ†ç»„\n    //æœªè®¾ç½®æ—¶ä¸ºé»˜è®¤åˆ†ç»„\n    String group() default \"\";\n\n    //æŒ‡å®šé…ç½®çš„åŒ…è·¯å¾„ï¼Œé¿å…è§£ææ— ç”¨çš„é…ç½®\n    String[] basePackages() default {};\n}\n```\n\n## 2.æ³¨å†Œé…ç½®ä¸­å¿ƒç›¸å…³ç±»\né€šè¿‡å®ç°ImportBeanDefinitionRegistraræ–¹æ³•æˆ‘ä»¬å¯ä»¥è·å¾—Beanå®šä¹‰çš„æ³¨å†Œå™¨ï¼Œæ­¤æ—¶å°±å¯ä»¥å°†æˆ‘ä»¬çš„åŠŸèƒ½ä¼˜é›…çš„æ³¨å†Œè‡³springç”Ÿå‘½å‘¨æœŸå†…ã€‚\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è®¾è®¡æ—¶é‡‡ç”¨äº†spiçš„æ–¹å¼ï¼Œåœ¨å®ç°çš„æ—¶å€™é‡‡ç”¨çš„æ˜¯Redisã€‚è¿™å°±æ„å‘³ç€æœªæ¥å¦‚æœæˆ‘ä»¬æƒ³æ›´æ¢é…ç½®ç®¡ç†çš„æ–¹å¼ï¼Œå®Œå…¨å¯ä»¥ç»§æ‰¿ç°æœ‰æ¥å£å®ç°ä¸€å¥—æ–°çš„æœºåˆ¶ã€‚ä¸ºæœªæ¥çš„æ‹“å±•æä¾›äº†å¯èƒ½æ€§ã€‚\n\n``` java\npublic class ConfigRegistrar implements ImportBeanDefinitionRegistrar, EnvironmentAware {\n\n    .....\n\n    @Override\n    public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {\n        AnnotationAttributes attributes = AnnotationAttributes\n                .fromMap(importingClassMetadata.getAnnotationAttributes(EnableNadiaConfig.class.getName()));\n\n        //æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨\n        if (!enableConfig(importingClassMetadata, attributes)) {\n            return;\n        }\n\n        //åˆå§‹åŒ–éœ€è¦æ‰«æçš„åŒ…\n        ConfigRegistrar.setBasePackages(attributes);\n\n        //å·¥å…·\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, SpringUtils.class.getName(), SpringUtils.class);\n\n        //æ”¶é›†æœ¬åœ°ç¯å¢ƒå˜é‡ã€ç”ŸæˆæœåŠ¡ä¿¡æ¯\n        //----->SPIå®ç°ï¼Œæœ¬åœ°å˜é‡çš„æ‰‹æœºå’ŒServiceç«¯æ˜¾ç¤ºçš„æœåŠ¡ä¿¡æ¯å¯è‡ªå®šä¹‰å®ç°\n        Map<String, Object> envPropertyValues = new HashMap<>();\n        envPropertyValues.put(\"importingClassMetadata\", importingClassMetadata);\n        InitEnvironment env = SpiServiceUtil.loadFirst(InitEnvironment.class);\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, InitEnvironment.class.getName(), env.getClass(), envPropertyValues);\n\n        //æ”¶é›†æœ¬åœ°é…ç½®&å›è°ƒæ–¹æ³•\n        Map<String, Object> processorPropertyValues = new HashMap<>();\n        processorPropertyValues.put(\"importingClassMetadata\", importingClassMetadata);\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, SpringValueProcessor.class.getName(), SpringValueProcessor.class, processorPropertyValues);\n\n        //å¯åŠ¨å™¨æ³¨å†Œ\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ConfigPostConstructProcessor.class.getName(), ConfigPostConstructProcessor.class);\n\n        //redisè£…è½½\n        ConfigCenter configCenter = SpiServiceUtil.loadFirst(ConfigCenter.class);\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ConfigCenter.class.getName(), configCenter.getClass());\n\n        //æŒ‰ç…§æœ¬åœ°ç¯å¢ƒå˜é‡æ”¶é›†redisä¸­çš„é…ç½®ï¼ˆï¼‰\n        //å‘redisæä¾›å½“å‰æœåŠ¡ä¿¡æ¯\n        //------>SPIå®ç°ï¼Œå¯æ›¿æ¢redisä¸ºå…¶ä»–ä¸­é—´ä»¶\n        LoadConfig loadConfig = SpiServiceUtil.loadFirst(LoadConfig.class);\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, LoadConfig.class.getName(), loadConfig.getClass());\n\n        //é…ç½®å˜æ›´è®¢é˜…\n        Listener listener = SpiServiceUtil.loadFirst(Listener.class);\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, Listener.class.getName(), listener.getClass());\n\n        //å®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡ç«¯\n        NotifyFactory notifyFactory = SpiServiceUtil.loadFirst(NotifyFactory.class);\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, NotifyFactory.class.getName(), notifyFactory.getClass());\n\n        //é…ç½®å˜æ›´å¯åŠ¨ç±»\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ConfigPostConstructProcessor.class.getName(), ConfigPostConstructProcessor.class);\n\n        //springå®¹å™¨å…³é—­æ—¶ï¼Œé”€æ¯å½“å‰å®ä¾‹ä¿¡æ¯\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ApplicationEventListener.class.getName(), ApplicationEventListener.class);\n\n    }\n```\n\n## 3.å®¢æˆ·ç«¯é…ç½®çš„ç»Ÿä¸€æ”¶é›†\næ”¶é›†é…ç½®æ—¶ï¼Œè€ƒè™‘åˆ°æŠŠå¯¹å¼€å‘äººå‘˜çš„ä»£ç ä¾µå…¥æ€§é™åˆ°æœ€ä½ï¼Œæˆ‘ä»¬å†³å®šé’ˆå¯¹Springè‡ªèº«@Valueæ³¨è§£å’Œ@ConfigurationPropertiesæ³¨è§£è¿›è¡Œæ”¶é›†ã€‚å¥½å¤„æ˜¯å¼€å‘äººå‘˜æ— éœ€å¼•å…¥å…¶ä»–çš„å­¦ä¹ æˆæœ¬ï¼Œåœ¨ä¸å˜æ›´ç°æœ‰å¼€å‘æ¨¡å¼ä¸‹å°±èƒ½è¿›è¡Œé…ç½®é¡¹çš„æ”¶é›†ä¸ç®¡ç†ã€‚\n\næ­¤å¤–ï¼Œé’ˆå¯¹é…ç½®ç®¡ç†çš„ä¸€äº›ç‰¹æ®Šæ›´èƒ½ï¼Œæˆ‘ä»¬è®¾è®¡äº†æ‰«åŒ…è·¯å¾„ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®éœ€è¦è®¾å®šæ‰«åŒ…è·¯å¾„ï¼Œä»è€Œå¯¹å…³å¿ƒçš„é…ç½®è¿›è¡Œè¿œç¨‹ç®¡ç†ã€‚åŒæ—¶æˆ‘ä»¬æä¾›äº†@NadiaConfigæ³¨è§£ï¼Œä¸€æ—¦æ ‡è®°ä¸Šè¯¥æ³¨è§£åã€‚å¼€å‘äººå‘˜å¯ä»¥é’ˆå¯¹é…ç½®çš„å˜æ›´è¿›è¡Œè‡ªå®šä¹‰çš„å›è°ƒå¤„ç†ã€‚\n\n```java\n@Target({ElementType.FIELD,ElementType.CONSTRUCTOR})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface NadiaConfig {\n    Class<? extends Callback> clazz();\n\n    CallbackScenes[] callbackScenes() default {CallbackScenes.UPDATE_VALUE, CallbackScenes.SWITCH_GROUP};\n\n    boolean exclude() default false;\n\n    enum CallbackScenes {\n        INIT,\n        SWITCH_GROUP,\n        UPDATE_VALUE,\n    }\n}\n```\n\nå®ç°BeanPostProcessoræ¥å£åï¼Œåœ¨Beançš„åç½®å¤„ç†é€»è¾‘ä¸­æˆ‘ä»¬ä¼šæ”¶é›†æŒ‡å®šåŒ…ä¸‹çš„é…ç½®\n\n```java\npublic class SpringValueProcessor extends AbstractMetadata implements BeanPostProcessor, PriorityOrdered {\n\n    ....\n\n    private void processField(Object bean, String beanName, Field field) {\n        // register @Value on field\n        Value value = field.getAnnotation(Value.class);\n        if (value == null) {\n            return;\n        }\n        Set<String> keys = PlaceholderHelper.extractPlaceholderKeys(value.value());\n        if (keys.isEmpty()) {\n            return;\n        }\n\n        for (String key : keys) {\n            Config config = generateConfig(bean, beanName, key, field);\n            ConfigContextHolder.setConfigHolder(key, config);\n        }\n    }\n\n    private Config generateConfig(Object bean, String beanName, String key, Field field) {\n        NadiaConfig nadiaConfig = field.getAnnotation(NadiaConfig.class);\n        Class<? extends Callback> callback = null;\n        Set<NadiaConfig.CallbackScenes> callbackScenesSet = null;\n        if (nadiaConfig != null) {\n            if(nadiaConfig.exclude()){\n                return null;\n            }\n            callback = nadiaConfig.clazz();\n            callbackScenesSet = getCallbackScenes(nadiaConfig);\n        }\n        return new Config(ConfigTypeEnum.FIELD,\n                beanName,\n                bean.getClass(),\n                key, field,\n                null,\n                FieldUtil.getValue(bean, field),\n                callback,\n                callbackScenesSet,\n                field.getType(),\n                bean);\n    }\n\n    ....\n}\n```\n\n## 4.å¯åŠ¨é…ç½®æœ¬åœ°é…ç½®æ›´æ–°çš„æ¨¡æ¿æµç¨‹\nå¯ä»¥çœ‹åˆ°ï¼Œæ¨¡æ¿æ¨¡å¼æŒ‡å®šäº†ä¸€å¥—è¿œç¨‹é…ç½®æ›´æ–°è‡³æœ¬åœ°çš„æµç¨‹ã€‚ç»“åˆSPIçš„ç‰¹æ€§ï¼Œå¯ä»¥å­˜åœ¨å¤šç§çš„å®ç°æ–¹å¼ã€‚\n\n```java\n@Component\npublic class ConfigBootstart {\n\n    @Autowired\n    private InitEnvironment initEnvironment;\n    @Autowired\n    private LoadConfig loadConfig;\n    @Autowired\n    private Listener listener;\n    @Autowired\n    private NotifyFactory notifyFactory;\n\n    public void start(){\n        //bootstart notify start\n        notifyFactory.startPush();\n        //env\n        initEnvironment.init();\n        //config\n        loadConfig.load();\n        loadConfig.updateClientValues();\n        loadConfig.onlineClientInGroup();\n        loadConfig.pushClientConfigs();\n        loadConfig.keepClientAlive();\n        //watch\n        listener.init();\n        //bootstart notify end\n        notifyFactory.stopPush();\n    }\n\n}\n```\n\n## 5.Rediså®ç°é…ç½®çš„æ›´æ–°ï¼Œå®¢æˆ·ç«¯çš„ä¸Šä¸‹çº¿\nè¿™é‡Œæˆ‘ä»¬ç”¨Rediså®ç°AbstractLoadConfigå®šä¹‰å¥½çš„æ¨¡æ¿æ–¹æ³•ï¼ŒåŒ…æ‹¬é…ç½®ä»redisçš„æ‹‰å–ã€æ›´æ–°æœ¬åœ°é…ç½®ã€å®¢æˆ·ç«¯å¿ƒè·³çš„ä¸ŠæŠ¥ã€å®¢æˆ·ç«¯ä¸Šçº¿é€šçŸ¥ã€å®¢æˆ·ç«¯ä¸‹çº¿é€šçŸ¥\n\n\n```java\npublic class RedisLoadConfig extends AbstractLoadConfig {\n    @Resource\n    private ConfigCenterRedisService configCenterRedisService;\n    @Resource\n    private RedisPubSub redisPubSub;\n\n    @Override\n    public void load() {\n        //get redis info\n        this.load(initEnvironment.getClientInfo().getApplication(), initEnvironment.getClientInfo().getGroup());\n    }\n\n    @Override\n    public void load(String application, String group) {\n        String configKey = RedisKeyUtil.getGroupConfig(application, group);\n        Map<String, String> configs = configCenterRedisService.hgetAll(configKey);\n        RemoteContextHolder.setRemoteHolder(configKey, configs);\n    }\n\n    @Override\n    public Object getValue(String key) {\n        return null;\n    }\n\n    @Override\n    public void onlineClientInGroup() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        String applicationGroup = RedisKeyUtil.getInstance(clientInfo.getApplication(), clientInfo.getGroup());\n        configCenterRedisService.sadd(applicationGroup, clientInfo.getName());\n        log.info(\"========================= onlineClientInGroup key[{}] value[{}] =========================\", applicationGroup, clientInfo.getName());\n    }\n\n    @Override\n    public void offlineClientInGroup() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        String applicationGroup = RedisKeyUtil.getInstance(clientInfo.getApplication(), clientInfo.getGroup());\n        configCenterRedisService.del(applicationGroup, clientInfo.getName());\n        log.info(\"========================= offlineClientInGroup key[{}] value[{}] =========================\", applicationGroup, clientInfo.getName());\n    }\n\n    @Override\n    public void offlineClientConfigs() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        String instanceConfig = RedisKeyUtil.getInstanceConfig(clientInfo.getApplication(), clientInfo.getGroup(), clientInfo.getName());\n        configCenterRedisService.del(instanceConfig);\n        log.info(\"========================= offlineClientConfigs key[{}] =========================\", instanceConfig);\n    }\n\n    @Override\n    public void keepClientAlive() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        //push client info to redis schedule\n        Executors.newScheduledThreadPool(1).scheduleAtFixedRate(new Runnable() {\n            @Override\n            public void run() {\n                log.info(\"========================= Client Keep Alive with Redis Start =========================\");\n                clientInfo.setTimestamp(new Date().getTime());\n                String hashCode = String.valueOf(clientInfo.hashCode());\n                log.info(\"========================= Client Keep Alive hashCode:[{}] clientInfo:[{}] =========================\", hashCode, clientInfo);\n                configCenterRedisService.hset(RedisKeyUtil.getClints(), hashCode, JSONObject.toJSONString(clientInfo));\n                log.info(\"========================= Client Keep Alive with Redis End   =========================\");\n            }\n        }, 0, 1, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public void pushClientConfig(String key, String value) {\n        String configKey = RedisKeyUtil.getInstanceConfig(initEnvironment.getClientInfo().getApplication(),\n                initEnvironment.getClientInfo().getGroup(), initEnvironment.getClientInfo().getName());\n        configCenterRedisService.hset(configKey, key, value);\n    }\n\n    @Override\n    public void pushClientConfigs() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        configCenterRedisService.del(RedisKeyUtil.getInstanceConfig(clientInfo.getApplication(), clientInfo.getGroup(), clientInfo.getName()));\n        Map<String, String> clientConfigs = ConfigContextHolder.getClientConfigs();\n        clientConfigs.forEach((k, v) -> {\n            configCenterRedisService.hset(RedisKeyUtil.getInstanceConfig(clientInfo.getApplication(), clientInfo.getGroup(), clientInfo.getName()), k, v);\n        });\n    }\n\n    @Override\n    protected void notificServer(String message,EventType type , LogLevelEnum level) {\n        redisPubSub.notifyServer(initEnvironment.getClientInfo(), type, level,message);\n    }\n\n    @Override\n    public void offlineClientInfo() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        configCenterRedisService.del(RedisKeyUtil.getClints(),String.valueOf(clientInfo.hashCode()));\n        log.info(\"========================= delete client info  key[{}] value[{}]=========================\", RedisKeyUtil.getClints(),clientInfo.hashCode());\n    }\n\n    @Override\n    public void pushClinetInfo() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        configCenterRedisService.hset(RedisKeyUtil.getClints(), String.valueOf(clientInfo.hashCode()), JSONObject.toJSONString(clientInfo));\n        log.info(\"========================= push client info  key[{}] value[{}]=========================\", RedisKeyUtil.getClints(),clientInfo.hashCode());\n    }\n}\n```\n\n## 6.Rediså®ç°è¿œç¨‹é…ç½®çš„å®æ—¶åŒæ­¥\né…ç½®ä¿¡æ¯çš„å®æ—¶åŒæ­¥ä¸»è¦é‡‡ç”¨äº†Redisçš„ç›‘å¬åŠŸèƒ½ï¼Œå®¢æˆ·ç«¯å¯åŠ¨åç›‘å¬ç‰¹æ®Šé€šé“çš„ä¿¡æ¯ï¼Œå¹¶å‰¥ç¦»å‡ºè‡ªå·±æ„Ÿå…´è¶£çš„ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚\n\n```java\nclass MyMessageListener implements MessageListener {\n\n        private LoadConfig loadConfig;\n\n        MyMessageListener(LoadConfig loadConfig) {\n            this.loadConfig = loadConfig;\n        }\n\n        @Override\n        public void onMessage(Message message, byte[] pattern) {\n            notifyFactory.startPush();\n            MessageBody messageBody = MessageConvert.unpackageMessage(message.toString());\n            if (messageBody instanceof UpdateValueMessageBody) {\n                log.info(\"receive UpdateValueMessageBody start\");\n                redisPubSub.notifyServer(initEnvironment.getClientInfo(), EventType.CLIENT_MESSAGE, LogLevelEnum.LOG,\"receive UpdateValueMessageBody start\");\n                UpdateValueMessageBody updateValueMessageBody = (UpdateValueMessageBody) messageBody;\n                String group = initEnvironment.getClientInfo().getGroup();\n                if (group.equals(updateValueMessageBody.getGroup())) {\n                    //updateClientValue local value\n                    boolean hasFaile = loadConfig.updateClientValue(updateValueMessageBody.getKey(), updateValueMessageBody.getValue(), NadiaConfig.CallbackScenes.UPDATE_VALUE);\n                    if(!hasFaile){\n                        Object oldValue = ConfigContextHolder.getOldValue(updateValueMessageBody.getKey());\n                        // update server value\n                        loadConfig.pushClientConfig(updateValueMessageBody.getKey(), ClientValueUtil.serializer(updateValueMessageBody.getValue(), oldValue));\n                    }\n                }\n            } else if (messageBody instanceof SwitchInstanceMessageBody) {\n                log.info(\"receive SwitchInstanceMessageBody start\");\n                redisPubSub.notifyServer(initEnvironment.getClientInfo(), EventType.CLIENT_MESSAGE, LogLevelEnum.LOG,\"receive SwitchInstanceMessageBody start\");\n                SwitchInstanceMessageBody switchInstanceMessageBody = (SwitchInstanceMessageBody) messageBody;\n                //update local value\n                loadConfig.switchGroup(switchInstanceMessageBody.getApplication(),switchInstanceMessageBody.getGroupFrom(),switchInstanceMessageBody.getGroupTo(),switchInstanceMessageBody.getInstance());\n            } else if (messageBody instanceof HeartbeatMessageBody) {\n                log.info(\"receive HeartbeatMessageBody\");\n\n            }\n            notifyFactory.stopPush();\n        }\n    }\n```\n\n\n","source":"_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»£ç ç¯‡.md","raw":"---\ntitle: æˆ‘ä¸ºä»€ä¹ˆä¼šæ‰‹æ’¸ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»£ç ç¯‡\ndate: 2020-04-18 15:12:58\ntags: \n    - Java\n    - Redis\n    - é…ç½®ä¸­å¿ƒ\ncategories :\n    - Technology\n---\n\nä¸ŠæœŸæˆ‘ä»¬ç¡®å®šäº†ä»¥Springçš„æ–¹å‘å’Œé‡‡ç”¨Redisæ¥åšé…ç½®å…³ç³»ï¼Œæˆ‘ä»¬å°±å¼€å§‹å›´ç»•è¿™ä¸¤ä¸ªå¤§å¤´å…·ä½“çš„å¼€å§‹è®¾è®¡å®¢æˆ·ç«¯åŠŸèƒ½ã€‚\n\n## 1.è®©Springå¯åŠ¨æˆ‘ä»¬çš„é…ç½®ä¸­å¿ƒå®¢æˆ·ç«¯\næˆ‘ä»¬å®šä¹‰äº†é…ç½®ä¸­å¿ƒçš„å¯åŠ¨æ³¨è§£ã€‚åŒå¤§å¤šæ•°Springçš„æ•´åˆé¡¹ç›®ä¸€æ ·ï¼Œä¸ä»…èƒ½é€šè¿‡å¯åŠ¨æ³¨è§£å¯ç”¨åŠŸèƒ½ï¼ŒåŒæ—¶è¿˜èƒ½å¯¹é…ç½®çš„åº”ç”¨è¿›è¡Œåˆå§‹è®¾å®šã€‚\n<!-- more -->\n``` java\n@Retention(RetentionPolicy.RUNTIME)\n@Target(ElementType.TYPE)\n@Documented\n@Import(ConfigRegistrar.class)\npublic @interface EnableNadiaConfig {\n    //å¯ç”¨ç¯å¢ƒ\n    //æœªè®¾ç½®æ—¶æ‰€æœ‰ç¯å¢ƒå¯åŠ¨\n    String[] actives() default {};\n\n    //æŒ‡å®šé…ç½®æ‰€å±çš„Application\n    String application() default \"\";\n\n    //é»˜è®¤åˆ†ç»„\n    //æœªè®¾ç½®æ—¶ä¸ºé»˜è®¤åˆ†ç»„\n    String group() default \"\";\n\n    //æŒ‡å®šé…ç½®çš„åŒ…è·¯å¾„ï¼Œé¿å…è§£ææ— ç”¨çš„é…ç½®\n    String[] basePackages() default {};\n}\n```\n\n## 2.æ³¨å†Œé…ç½®ä¸­å¿ƒç›¸å…³ç±»\né€šè¿‡å®ç°ImportBeanDefinitionRegistraræ–¹æ³•æˆ‘ä»¬å¯ä»¥è·å¾—Beanå®šä¹‰çš„æ³¨å†Œå™¨ï¼Œæ­¤æ—¶å°±å¯ä»¥å°†æˆ‘ä»¬çš„åŠŸèƒ½ä¼˜é›…çš„æ³¨å†Œè‡³springç”Ÿå‘½å‘¨æœŸå†…ã€‚\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è®¾è®¡æ—¶é‡‡ç”¨äº†spiçš„æ–¹å¼ï¼Œåœ¨å®ç°çš„æ—¶å€™é‡‡ç”¨çš„æ˜¯Redisã€‚è¿™å°±æ„å‘³ç€æœªæ¥å¦‚æœæˆ‘ä»¬æƒ³æ›´æ¢é…ç½®ç®¡ç†çš„æ–¹å¼ï¼Œå®Œå…¨å¯ä»¥ç»§æ‰¿ç°æœ‰æ¥å£å®ç°ä¸€å¥—æ–°çš„æœºåˆ¶ã€‚ä¸ºæœªæ¥çš„æ‹“å±•æä¾›äº†å¯èƒ½æ€§ã€‚\n\n``` java\npublic class ConfigRegistrar implements ImportBeanDefinitionRegistrar, EnvironmentAware {\n\n    .....\n\n    @Override\n    public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {\n        AnnotationAttributes attributes = AnnotationAttributes\n                .fromMap(importingClassMetadata.getAnnotationAttributes(EnableNadiaConfig.class.getName()));\n\n        //æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨\n        if (!enableConfig(importingClassMetadata, attributes)) {\n            return;\n        }\n\n        //åˆå§‹åŒ–éœ€è¦æ‰«æçš„åŒ…\n        ConfigRegistrar.setBasePackages(attributes);\n\n        //å·¥å…·\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, SpringUtils.class.getName(), SpringUtils.class);\n\n        //æ”¶é›†æœ¬åœ°ç¯å¢ƒå˜é‡ã€ç”ŸæˆæœåŠ¡ä¿¡æ¯\n        //----->SPIå®ç°ï¼Œæœ¬åœ°å˜é‡çš„æ‰‹æœºå’ŒServiceç«¯æ˜¾ç¤ºçš„æœåŠ¡ä¿¡æ¯å¯è‡ªå®šä¹‰å®ç°\n        Map<String, Object> envPropertyValues = new HashMap<>();\n        envPropertyValues.put(\"importingClassMetadata\", importingClassMetadata);\n        InitEnvironment env = SpiServiceUtil.loadFirst(InitEnvironment.class);\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, InitEnvironment.class.getName(), env.getClass(), envPropertyValues);\n\n        //æ”¶é›†æœ¬åœ°é…ç½®&å›è°ƒæ–¹æ³•\n        Map<String, Object> processorPropertyValues = new HashMap<>();\n        processorPropertyValues.put(\"importingClassMetadata\", importingClassMetadata);\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, SpringValueProcessor.class.getName(), SpringValueProcessor.class, processorPropertyValues);\n\n        //å¯åŠ¨å™¨æ³¨å†Œ\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ConfigPostConstructProcessor.class.getName(), ConfigPostConstructProcessor.class);\n\n        //redisè£…è½½\n        ConfigCenter configCenter = SpiServiceUtil.loadFirst(ConfigCenter.class);\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ConfigCenter.class.getName(), configCenter.getClass());\n\n        //æŒ‰ç…§æœ¬åœ°ç¯å¢ƒå˜é‡æ”¶é›†redisä¸­çš„é…ç½®ï¼ˆï¼‰\n        //å‘redisæä¾›å½“å‰æœåŠ¡ä¿¡æ¯\n        //------>SPIå®ç°ï¼Œå¯æ›¿æ¢redisä¸ºå…¶ä»–ä¸­é—´ä»¶\n        LoadConfig loadConfig = SpiServiceUtil.loadFirst(LoadConfig.class);\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, LoadConfig.class.getName(), loadConfig.getClass());\n\n        //é…ç½®å˜æ›´è®¢é˜…\n        Listener listener = SpiServiceUtil.loadFirst(Listener.class);\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, Listener.class.getName(), listener.getClass());\n\n        //å®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡ç«¯\n        NotifyFactory notifyFactory = SpiServiceUtil.loadFirst(NotifyFactory.class);\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, NotifyFactory.class.getName(), notifyFactory.getClass());\n\n        //é…ç½®å˜æ›´å¯åŠ¨ç±»\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ConfigPostConstructProcessor.class.getName(), ConfigPostConstructProcessor.class);\n\n        //springå®¹å™¨å…³é—­æ—¶ï¼Œé”€æ¯å½“å‰å®ä¾‹ä¿¡æ¯\n        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ApplicationEventListener.class.getName(), ApplicationEventListener.class);\n\n    }\n```\n\n## 3.å®¢æˆ·ç«¯é…ç½®çš„ç»Ÿä¸€æ”¶é›†\næ”¶é›†é…ç½®æ—¶ï¼Œè€ƒè™‘åˆ°æŠŠå¯¹å¼€å‘äººå‘˜çš„ä»£ç ä¾µå…¥æ€§é™åˆ°æœ€ä½ï¼Œæˆ‘ä»¬å†³å®šé’ˆå¯¹Springè‡ªèº«@Valueæ³¨è§£å’Œ@ConfigurationPropertiesæ³¨è§£è¿›è¡Œæ”¶é›†ã€‚å¥½å¤„æ˜¯å¼€å‘äººå‘˜æ— éœ€å¼•å…¥å…¶ä»–çš„å­¦ä¹ æˆæœ¬ï¼Œåœ¨ä¸å˜æ›´ç°æœ‰å¼€å‘æ¨¡å¼ä¸‹å°±èƒ½è¿›è¡Œé…ç½®é¡¹çš„æ”¶é›†ä¸ç®¡ç†ã€‚\n\næ­¤å¤–ï¼Œé’ˆå¯¹é…ç½®ç®¡ç†çš„ä¸€äº›ç‰¹æ®Šæ›´èƒ½ï¼Œæˆ‘ä»¬è®¾è®¡äº†æ‰«åŒ…è·¯å¾„ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®éœ€è¦è®¾å®šæ‰«åŒ…è·¯å¾„ï¼Œä»è€Œå¯¹å…³å¿ƒçš„é…ç½®è¿›è¡Œè¿œç¨‹ç®¡ç†ã€‚åŒæ—¶æˆ‘ä»¬æä¾›äº†@NadiaConfigæ³¨è§£ï¼Œä¸€æ—¦æ ‡è®°ä¸Šè¯¥æ³¨è§£åã€‚å¼€å‘äººå‘˜å¯ä»¥é’ˆå¯¹é…ç½®çš„å˜æ›´è¿›è¡Œè‡ªå®šä¹‰çš„å›è°ƒå¤„ç†ã€‚\n\n```java\n@Target({ElementType.FIELD,ElementType.CONSTRUCTOR})\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\npublic @interface NadiaConfig {\n    Class<? extends Callback> clazz();\n\n    CallbackScenes[] callbackScenes() default {CallbackScenes.UPDATE_VALUE, CallbackScenes.SWITCH_GROUP};\n\n    boolean exclude() default false;\n\n    enum CallbackScenes {\n        INIT,\n        SWITCH_GROUP,\n        UPDATE_VALUE,\n    }\n}\n```\n\nå®ç°BeanPostProcessoræ¥å£åï¼Œåœ¨Beançš„åç½®å¤„ç†é€»è¾‘ä¸­æˆ‘ä»¬ä¼šæ”¶é›†æŒ‡å®šåŒ…ä¸‹çš„é…ç½®\n\n```java\npublic class SpringValueProcessor extends AbstractMetadata implements BeanPostProcessor, PriorityOrdered {\n\n    ....\n\n    private void processField(Object bean, String beanName, Field field) {\n        // register @Value on field\n        Value value = field.getAnnotation(Value.class);\n        if (value == null) {\n            return;\n        }\n        Set<String> keys = PlaceholderHelper.extractPlaceholderKeys(value.value());\n        if (keys.isEmpty()) {\n            return;\n        }\n\n        for (String key : keys) {\n            Config config = generateConfig(bean, beanName, key, field);\n            ConfigContextHolder.setConfigHolder(key, config);\n        }\n    }\n\n    private Config generateConfig(Object bean, String beanName, String key, Field field) {\n        NadiaConfig nadiaConfig = field.getAnnotation(NadiaConfig.class);\n        Class<? extends Callback> callback = null;\n        Set<NadiaConfig.CallbackScenes> callbackScenesSet = null;\n        if (nadiaConfig != null) {\n            if(nadiaConfig.exclude()){\n                return null;\n            }\n            callback = nadiaConfig.clazz();\n            callbackScenesSet = getCallbackScenes(nadiaConfig);\n        }\n        return new Config(ConfigTypeEnum.FIELD,\n                beanName,\n                bean.getClass(),\n                key, field,\n                null,\n                FieldUtil.getValue(bean, field),\n                callback,\n                callbackScenesSet,\n                field.getType(),\n                bean);\n    }\n\n    ....\n}\n```\n\n## 4.å¯åŠ¨é…ç½®æœ¬åœ°é…ç½®æ›´æ–°çš„æ¨¡æ¿æµç¨‹\nå¯ä»¥çœ‹åˆ°ï¼Œæ¨¡æ¿æ¨¡å¼æŒ‡å®šäº†ä¸€å¥—è¿œç¨‹é…ç½®æ›´æ–°è‡³æœ¬åœ°çš„æµç¨‹ã€‚ç»“åˆSPIçš„ç‰¹æ€§ï¼Œå¯ä»¥å­˜åœ¨å¤šç§çš„å®ç°æ–¹å¼ã€‚\n\n```java\n@Component\npublic class ConfigBootstart {\n\n    @Autowired\n    private InitEnvironment initEnvironment;\n    @Autowired\n    private LoadConfig loadConfig;\n    @Autowired\n    private Listener listener;\n    @Autowired\n    private NotifyFactory notifyFactory;\n\n    public void start(){\n        //bootstart notify start\n        notifyFactory.startPush();\n        //env\n        initEnvironment.init();\n        //config\n        loadConfig.load();\n        loadConfig.updateClientValues();\n        loadConfig.onlineClientInGroup();\n        loadConfig.pushClientConfigs();\n        loadConfig.keepClientAlive();\n        //watch\n        listener.init();\n        //bootstart notify end\n        notifyFactory.stopPush();\n    }\n\n}\n```\n\n## 5.Rediså®ç°é…ç½®çš„æ›´æ–°ï¼Œå®¢æˆ·ç«¯çš„ä¸Šä¸‹çº¿\nè¿™é‡Œæˆ‘ä»¬ç”¨Rediså®ç°AbstractLoadConfigå®šä¹‰å¥½çš„æ¨¡æ¿æ–¹æ³•ï¼ŒåŒ…æ‹¬é…ç½®ä»redisçš„æ‹‰å–ã€æ›´æ–°æœ¬åœ°é…ç½®ã€å®¢æˆ·ç«¯å¿ƒè·³çš„ä¸ŠæŠ¥ã€å®¢æˆ·ç«¯ä¸Šçº¿é€šçŸ¥ã€å®¢æˆ·ç«¯ä¸‹çº¿é€šçŸ¥\n\n\n```java\npublic class RedisLoadConfig extends AbstractLoadConfig {\n    @Resource\n    private ConfigCenterRedisService configCenterRedisService;\n    @Resource\n    private RedisPubSub redisPubSub;\n\n    @Override\n    public void load() {\n        //get redis info\n        this.load(initEnvironment.getClientInfo().getApplication(), initEnvironment.getClientInfo().getGroup());\n    }\n\n    @Override\n    public void load(String application, String group) {\n        String configKey = RedisKeyUtil.getGroupConfig(application, group);\n        Map<String, String> configs = configCenterRedisService.hgetAll(configKey);\n        RemoteContextHolder.setRemoteHolder(configKey, configs);\n    }\n\n    @Override\n    public Object getValue(String key) {\n        return null;\n    }\n\n    @Override\n    public void onlineClientInGroup() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        String applicationGroup = RedisKeyUtil.getInstance(clientInfo.getApplication(), clientInfo.getGroup());\n        configCenterRedisService.sadd(applicationGroup, clientInfo.getName());\n        log.info(\"========================= onlineClientInGroup key[{}] value[{}] =========================\", applicationGroup, clientInfo.getName());\n    }\n\n    @Override\n    public void offlineClientInGroup() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        String applicationGroup = RedisKeyUtil.getInstance(clientInfo.getApplication(), clientInfo.getGroup());\n        configCenterRedisService.del(applicationGroup, clientInfo.getName());\n        log.info(\"========================= offlineClientInGroup key[{}] value[{}] =========================\", applicationGroup, clientInfo.getName());\n    }\n\n    @Override\n    public void offlineClientConfigs() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        String instanceConfig = RedisKeyUtil.getInstanceConfig(clientInfo.getApplication(), clientInfo.getGroup(), clientInfo.getName());\n        configCenterRedisService.del(instanceConfig);\n        log.info(\"========================= offlineClientConfigs key[{}] =========================\", instanceConfig);\n    }\n\n    @Override\n    public void keepClientAlive() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        //push client info to redis schedule\n        Executors.newScheduledThreadPool(1).scheduleAtFixedRate(new Runnable() {\n            @Override\n            public void run() {\n                log.info(\"========================= Client Keep Alive with Redis Start =========================\");\n                clientInfo.setTimestamp(new Date().getTime());\n                String hashCode = String.valueOf(clientInfo.hashCode());\n                log.info(\"========================= Client Keep Alive hashCode:[{}] clientInfo:[{}] =========================\", hashCode, clientInfo);\n                configCenterRedisService.hset(RedisKeyUtil.getClints(), hashCode, JSONObject.toJSONString(clientInfo));\n                log.info(\"========================= Client Keep Alive with Redis End   =========================\");\n            }\n        }, 0, 1, TimeUnit.MINUTES);\n    }\n\n    @Override\n    public void pushClientConfig(String key, String value) {\n        String configKey = RedisKeyUtil.getInstanceConfig(initEnvironment.getClientInfo().getApplication(),\n                initEnvironment.getClientInfo().getGroup(), initEnvironment.getClientInfo().getName());\n        configCenterRedisService.hset(configKey, key, value);\n    }\n\n    @Override\n    public void pushClientConfigs() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        configCenterRedisService.del(RedisKeyUtil.getInstanceConfig(clientInfo.getApplication(), clientInfo.getGroup(), clientInfo.getName()));\n        Map<String, String> clientConfigs = ConfigContextHolder.getClientConfigs();\n        clientConfigs.forEach((k, v) -> {\n            configCenterRedisService.hset(RedisKeyUtil.getInstanceConfig(clientInfo.getApplication(), clientInfo.getGroup(), clientInfo.getName()), k, v);\n        });\n    }\n\n    @Override\n    protected void notificServer(String message,EventType type , LogLevelEnum level) {\n        redisPubSub.notifyServer(initEnvironment.getClientInfo(), type, level,message);\n    }\n\n    @Override\n    public void offlineClientInfo() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        configCenterRedisService.del(RedisKeyUtil.getClints(),String.valueOf(clientInfo.hashCode()));\n        log.info(\"========================= delete client info  key[{}] value[{}]=========================\", RedisKeyUtil.getClints(),clientInfo.hashCode());\n    }\n\n    @Override\n    public void pushClinetInfo() {\n        ClientInfo clientInfo = initEnvironment.getClientInfo();\n        configCenterRedisService.hset(RedisKeyUtil.getClints(), String.valueOf(clientInfo.hashCode()), JSONObject.toJSONString(clientInfo));\n        log.info(\"========================= push client info  key[{}] value[{}]=========================\", RedisKeyUtil.getClints(),clientInfo.hashCode());\n    }\n}\n```\n\n## 6.Rediså®ç°è¿œç¨‹é…ç½®çš„å®æ—¶åŒæ­¥\né…ç½®ä¿¡æ¯çš„å®æ—¶åŒæ­¥ä¸»è¦é‡‡ç”¨äº†Redisçš„ç›‘å¬åŠŸèƒ½ï¼Œå®¢æˆ·ç«¯å¯åŠ¨åç›‘å¬ç‰¹æ®Šé€šé“çš„ä¿¡æ¯ï¼Œå¹¶å‰¥ç¦»å‡ºè‡ªå·±æ„Ÿå…´è¶£çš„ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚\n\n```java\nclass MyMessageListener implements MessageListener {\n\n        private LoadConfig loadConfig;\n\n        MyMessageListener(LoadConfig loadConfig) {\n            this.loadConfig = loadConfig;\n        }\n\n        @Override\n        public void onMessage(Message message, byte[] pattern) {\n            notifyFactory.startPush();\n            MessageBody messageBody = MessageConvert.unpackageMessage(message.toString());\n            if (messageBody instanceof UpdateValueMessageBody) {\n                log.info(\"receive UpdateValueMessageBody start\");\n                redisPubSub.notifyServer(initEnvironment.getClientInfo(), EventType.CLIENT_MESSAGE, LogLevelEnum.LOG,\"receive UpdateValueMessageBody start\");\n                UpdateValueMessageBody updateValueMessageBody = (UpdateValueMessageBody) messageBody;\n                String group = initEnvironment.getClientInfo().getGroup();\n                if (group.equals(updateValueMessageBody.getGroup())) {\n                    //updateClientValue local value\n                    boolean hasFaile = loadConfig.updateClientValue(updateValueMessageBody.getKey(), updateValueMessageBody.getValue(), NadiaConfig.CallbackScenes.UPDATE_VALUE);\n                    if(!hasFaile){\n                        Object oldValue = ConfigContextHolder.getOldValue(updateValueMessageBody.getKey());\n                        // update server value\n                        loadConfig.pushClientConfig(updateValueMessageBody.getKey(), ClientValueUtil.serializer(updateValueMessageBody.getValue(), oldValue));\n                    }\n                }\n            } else if (messageBody instanceof SwitchInstanceMessageBody) {\n                log.info(\"receive SwitchInstanceMessageBody start\");\n                redisPubSub.notifyServer(initEnvironment.getClientInfo(), EventType.CLIENT_MESSAGE, LogLevelEnum.LOG,\"receive SwitchInstanceMessageBody start\");\n                SwitchInstanceMessageBody switchInstanceMessageBody = (SwitchInstanceMessageBody) messageBody;\n                //update local value\n                loadConfig.switchGroup(switchInstanceMessageBody.getApplication(),switchInstanceMessageBody.getGroupFrom(),switchInstanceMessageBody.getGroupTo(),switchInstanceMessageBody.getInstance());\n            } else if (messageBody instanceof HeartbeatMessageBody) {\n                log.info(\"receive HeartbeatMessageBody\");\n\n            }\n            notifyFactory.stopPush();\n        }\n    }\n```\n\n\n","slug":"æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»£ç ç¯‡","published":1,"updated":"2020-12-14T09:51:24.047Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71huk004ov252bwtrab0t","content":"<html><head></head><body><p>&#x4E0A;&#x671F;&#x6211;&#x4EEC;&#x786E;&#x5B9A;&#x4E86;&#x4EE5;Spring&#x7684;&#x65B9;&#x5411;&#x548C;&#x91C7;&#x7528;Redis&#x6765;&#x505A;&#x914D;&#x7F6E;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5F00;&#x59CB;&#x56F4;&#x7ED5;&#x8FD9;&#x4E24;&#x4E2A;&#x5927;&#x5934;&#x5177;&#x4F53;&#x7684;&#x5F00;&#x59CB;&#x8BBE;&#x8BA1;&#x5BA2;&#x6237;&#x7AEF;&#x529F;&#x80FD;&#x3002;</p>\n<h2 id=\"1-&#x8BA9;Spring&#x542F;&#x52A8;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x5BA2;&#x6237;&#x7AEF;\"><a href=\"#1-&#x8BA9;Spring&#x542F;&#x52A8;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x5BA2;&#x6237;&#x7AEF;\" class=\"headerlink\" title=\"1.&#x8BA9;Spring&#x542F;&#x52A8;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x5BA2;&#x6237;&#x7AEF;\"></a>1.&#x8BA9;Spring&#x542F;&#x52A8;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x5BA2;&#x6237;&#x7AEF;</h2><p>&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x542F;&#x52A8;&#x6CE8;&#x89E3;&#x3002;&#x540C;&#x5927;&#x591A;&#x6570;Spring&#x7684;&#x6574;&#x5408;&#x9879;&#x76EE;&#x4E00;&#x6837;&#xFF0C;&#x4E0D;&#x4EC5;&#x80FD;&#x901A;&#x8FC7;&#x542F;&#x52A8;&#x6CE8;&#x89E3;&#x542F;&#x7528;&#x529F;&#x80FD;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x80FD;&#x5BF9;&#x914D;&#x7F6E;&#x7684;&#x5E94;&#x7528;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x8BBE;&#x5B9A;&#x3002;</p>\n<a id=\"more\"></a>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"hljs-meta\">@Target(ElementType.TYPE)</span></span><br><span class=\"line\"><span class=\"hljs-meta\">@Documented</span></span><br><span class=\"line\"><span class=\"hljs-meta\">@Import(ConfigRegistrar.class)</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-meta\">@interface</span> EnableNadiaConfig {</span><br><span class=\"line\">    <span class=\"hljs-comment\">//&#x542F;&#x7528;&#x73AF;&#x5883;</span></span><br><span class=\"line\">    <span class=\"hljs-comment\">//&#x672A;&#x8BBE;&#x7F6E;&#x65F6;&#x6240;&#x6709;&#x73AF;&#x5883;&#x542F;&#x52A8;</span></span><br><span class=\"line\">    String[] actives() <span class=\"hljs-keyword\">default</span> {};</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-comment\">//&#x6307;&#x5B9A;&#x914D;&#x7F6E;&#x6240;&#x5C5E;&#x7684;Application</span></span><br><span class=\"line\">    <span class=\"hljs-function\">String <span class=\"hljs-title\">application</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">default</span> &quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-comment\">//&#x9ED8;&#x8BA4;&#x5206;&#x7EC4;</span></span><br><span class=\"line\">    <span class=\"hljs-comment\">//&#x672A;&#x8BBE;&#x7F6E;&#x65F6;&#x4E3A;&#x9ED8;&#x8BA4;&#x5206;&#x7EC4;</span></span><br><span class=\"line\">    <span class=\"hljs-function\">String <span class=\"hljs-title\">group</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">default</span> &quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-comment\">//&#x6307;&#x5B9A;&#x914D;&#x7F6E;&#x7684;&#x5305;&#x8DEF;&#x5F84;&#xFF0C;&#x907F;&#x514D;&#x89E3;&#x6790;&#x65E0;&#x7528;&#x7684;&#x914D;&#x7F6E;</span></span><br><span class=\"line\">    String[] basePackages() <span class=\"hljs-keyword\">default</span> {};</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<h2 id=\"2-&#x6CE8;&#x518C;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x76F8;&#x5173;&#x7C7B;\"><a href=\"#2-&#x6CE8;&#x518C;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x76F8;&#x5173;&#x7C7B;\" class=\"headerlink\" title=\"2.&#x6CE8;&#x518C;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x76F8;&#x5173;&#x7C7B;\"></a>2.&#x6CE8;&#x518C;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x76F8;&#x5173;&#x7C7B;</h2><p>&#x901A;&#x8FC7;&#x5B9E;&#x73B0;ImportBeanDefinitionRegistrar&#x65B9;&#x6CD5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x83B7;&#x5F97;Bean&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x518C;&#x5668;&#xFF0C;&#x6B64;&#x65F6;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x6211;&#x4EEC;&#x7684;&#x529F;&#x80FD;&#x4F18;&#x96C5;&#x7684;&#x6CE8;&#x518C;&#x81F3;spring&#x751F;&#x547D;&#x5468;&#x671F;&#x5185;&#x3002;</p>\n<p>&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x8BBE;&#x8BA1;&#x65F6;&#x91C7;&#x7528;&#x4E86;spi&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5728;&#x5B9E;&#x73B0;&#x7684;&#x65F6;&#x5019;&#x91C7;&#x7528;&#x7684;&#x662F;Redis&#x3002;&#x8FD9;&#x5C31;&#x610F;&#x5473;&#x7740;&#x672A;&#x6765;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x66F4;&#x6362;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x7EE7;&#x627F;&#x73B0;&#x6709;&#x63A5;&#x53E3;&#x5B9E;&#x73B0;&#x4E00;&#x5957;&#x65B0;&#x7684;&#x673A;&#x5236;&#x3002;&#x4E3A;&#x672A;&#x6765;&#x7684;&#x62D3;&#x5C55;&#x63D0;&#x4F9B;&#x4E86;&#x53EF;&#x80FD;&#x6027;&#x3002;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ConfigRegistrar</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">ImportBeanDefinitionRegistrar</span>, <span class=\"hljs-title\">EnvironmentAware</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    .....</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">registerBeanDefinitions</span><span class=\"hljs-params\">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> </span>{</span><br><span class=\"line\">        AnnotationAttributes attributes = AnnotationAttributes</span><br><span class=\"line\">                .fromMap(importingClassMetadata.getAnnotationAttributes(EnableNadiaConfig.class.getName()));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//&#x68C0;&#x67E5;&#x662F;&#x5426;&#x9700;&#x8981;&#x542F;&#x52A8;</span></span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (!enableConfig(importingClassMetadata, attributes)) {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">return</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//&#x521D;&#x59CB;&#x5316;&#x9700;&#x8981;&#x626B;&#x63CF;&#x7684;&#x5305;</span></span><br><span class=\"line\">        ConfigRegistrar.setBasePackages(attributes);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//&#x5DE5;&#x5177;</span></span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, SpringUtils.class.getName(), SpringUtils.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//&#x6536;&#x96C6;&#x672C;&#x5730;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x3001;&#x751F;&#x6210;&#x670D;&#x52A1;&#x4FE1;&#x606F;</span></span><br><span class=\"line\">        <span class=\"hljs-comment\">//-----&gt;SPI&#x5B9E;&#x73B0;&#xFF0C;&#x672C;&#x5730;&#x53D8;&#x91CF;&#x7684;&#x624B;&#x673A;&#x548C;Service&#x7AEF;&#x663E;&#x793A;&#x7684;&#x670D;&#x52A1;&#x4FE1;&#x606F;&#x53EF;&#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x73B0;</span></span><br><span class=\"line\">        Map&lt;String, Object&gt; envPropertyValues = <span class=\"hljs-keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        envPropertyValues.put(<span class=\"hljs-string\">&quot;importingClassMetadata&quot;</span>, importingClassMetadata);</span><br><span class=\"line\">        InitEnvironment env = SpiServiceUtil.loadFirst(InitEnvironment.class);</span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, InitEnvironment.class.getName(), env.getClass(), envPropertyValues);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//&#x6536;&#x96C6;&#x672C;&#x5730;&#x914D;&#x7F6E;&amp;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;</span></span><br><span class=\"line\">        Map&lt;String, Object&gt; processorPropertyValues = <span class=\"hljs-keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        processorPropertyValues.put(<span class=\"hljs-string\">&quot;importingClassMetadata&quot;</span>, importingClassMetadata);</span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, SpringValueProcessor.class.getName(), SpringValueProcessor.class, processorPropertyValues);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//&#x542F;&#x52A8;&#x5668;&#x6CE8;&#x518C;</span></span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ConfigPostConstructProcessor.class.getName(), ConfigPostConstructProcessor.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//redis&#x88C5;&#x8F7D;</span></span><br><span class=\"line\">        ConfigCenter configCenter = SpiServiceUtil.loadFirst(ConfigCenter.class);</span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ConfigCenter.class.getName(), configCenter.getClass());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//&#x6309;&#x7167;&#x672C;&#x5730;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x6536;&#x96C6;redis&#x4E2D;&#x7684;&#x914D;&#x7F6E;&#xFF08;&#xFF09;</span></span><br><span class=\"line\">        <span class=\"hljs-comment\">//&#x5411;redis&#x63D0;&#x4F9B;&#x5F53;&#x524D;&#x670D;&#x52A1;&#x4FE1;&#x606F;</span></span><br><span class=\"line\">        <span class=\"hljs-comment\">//------&gt;SPI&#x5B9E;&#x73B0;&#xFF0C;&#x53EF;&#x66FF;&#x6362;redis&#x4E3A;&#x5176;&#x4ED6;&#x4E2D;&#x95F4;&#x4EF6;</span></span><br><span class=\"line\">        LoadConfig loadConfig = SpiServiceUtil.loadFirst(LoadConfig.class);</span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, LoadConfig.class.getName(), loadConfig.getClass());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//&#x914D;&#x7F6E;&#x53D8;&#x66F4;&#x8BA2;&#x9605;</span></span><br><span class=\"line\">        Listener listener = SpiServiceUtil.loadFirst(Listener.class);</span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, Listener.class.getName(), listener.getClass());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//&#x5BA2;&#x6237;&#x7AEF;&#x901A;&#x77E5;&#x670D;&#x52A1;&#x7AEF;</span></span><br><span class=\"line\">        NotifyFactory notifyFactory = SpiServiceUtil.loadFirst(NotifyFactory.class);</span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, NotifyFactory.class.getName(), notifyFactory.getClass());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//&#x914D;&#x7F6E;&#x53D8;&#x66F4;&#x542F;&#x52A8;&#x7C7B;</span></span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ConfigPostConstructProcessor.class.getName(), ConfigPostConstructProcessor.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//spring&#x5BB9;&#x5668;&#x5173;&#x95ED;&#x65F6;&#xFF0C;&#x9500;&#x6BC1;&#x5F53;&#x524D;&#x5B9E;&#x4F8B;&#x4FE1;&#x606F;</span></span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ApplicationEventListener.class.getName(), ApplicationEventListener.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    }</span><br></pre></td></tr></tbody></table></figure>\n\n<h2 id=\"3-&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x7684;&#x7EDF;&#x4E00;&#x6536;&#x96C6;\"><a href=\"#3-&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x7684;&#x7EDF;&#x4E00;&#x6536;&#x96C6;\" class=\"headerlink\" title=\"3.&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x7684;&#x7EDF;&#x4E00;&#x6536;&#x96C6;\"></a>3.&#x5BA2;&#x6237;&#x7AEF;&#x914D;&#x7F6E;&#x7684;&#x7EDF;&#x4E00;&#x6536;&#x96C6;</h2><p>&#x6536;&#x96C6;&#x914D;&#x7F6E;&#x65F6;&#xFF0C;&#x8003;&#x8651;&#x5230;&#x628A;&#x5BF9;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x7684;&#x4EE3;&#x7801;&#x4FB5;&#x5165;&#x6027;&#x964D;&#x5230;&#x6700;&#x4F4E;&#xFF0C;&#x6211;&#x4EEC;&#x51B3;&#x5B9A;&#x9488;&#x5BF9;Spring&#x81EA;&#x8EAB;@Value&#x6CE8;&#x89E3;&#x548C;@ConfigurationProperties&#x6CE8;&#x89E3;&#x8FDB;&#x884C;&#x6536;&#x96C6;&#x3002;&#x597D;&#x5904;&#x662F;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x65E0;&#x9700;&#x5F15;&#x5165;&#x5176;&#x4ED6;&#x7684;&#x5B66;&#x4E60;&#x6210;&#x672C;&#xFF0C;&#x5728;&#x4E0D;&#x53D8;&#x66F4;&#x73B0;&#x6709;&#x5F00;&#x53D1;&#x6A21;&#x5F0F;&#x4E0B;&#x5C31;&#x80FD;&#x8FDB;&#x884C;&#x914D;&#x7F6E;&#x9879;&#x7684;&#x6536;&#x96C6;&#x4E0E;&#x7BA1;&#x7406;&#x3002;</p>\n<p>&#x6B64;&#x5916;&#xFF0C;&#x9488;&#x5BF9;&#x914D;&#x7F6E;&#x7BA1;&#x7406;&#x7684;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x66F4;&#x80FD;&#xFF0C;&#x6211;&#x4EEC;&#x8BBE;&#x8BA1;&#x4E86;&#x626B;&#x5305;&#x8DEF;&#x5F84;&#x3002;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x8981;&#x8BBE;&#x5B9A;&#x626B;&#x5305;&#x8DEF;&#x5F84;&#xFF0C;&#x4ECE;&#x800C;&#x5BF9;&#x5173;&#x5FC3;&#x7684;&#x914D;&#x7F6E;&#x8FDB;&#x884C;&#x8FDC;&#x7A0B;&#x7BA1;&#x7406;&#x3002;&#x540C;&#x65F6;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x4E86;@NadiaConfig&#x6CE8;&#x89E3;&#xFF0C;&#x4E00;&#x65E6;&#x6807;&#x8BB0;&#x4E0A;&#x8BE5;&#x6CE8;&#x89E3;&#x540E;&#x3002;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x9488;&#x5BF9;&#x914D;&#x7F6E;&#x7684;&#x53D8;&#x66F4;&#x8FDB;&#x884C;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x56DE;&#x8C03;&#x5904;&#x7406;&#x3002;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-meta\">@Target({ElementType.FIELD,ElementType.CONSTRUCTOR})</span></span><br><span class=\"line\"><span class=\"hljs-meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"hljs-meta\">@Documented</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-meta\">@interface</span> NadiaConfig {</span><br><span class=\"line\">    Class&lt;? extends Callback&gt; clazz();</span><br><span class=\"line\"></span><br><span class=\"line\">    CallbackScenes[] callbackScenes() <span class=\"hljs-keyword\">default</span> {CallbackScenes.UPDATE_VALUE, CallbackScenes.SWITCH_GROUP};</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">exclude</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">false</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-class\"><span class=\"hljs-keyword\">enum</span> <span class=\"hljs-title\">CallbackScenes</span> </span>{</span><br><span class=\"line\">        INIT,</span><br><span class=\"line\">        SWITCH_GROUP,</span><br><span class=\"line\">        UPDATE_VALUE,</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x5B9E;&#x73B0;BeanPostProcessor&#x63A5;&#x53E3;&#x540E;&#xFF0C;&#x5728;Bean&#x7684;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x903B;&#x8F91;&#x4E2D;&#x6211;&#x4EEC;&#x4F1A;&#x6536;&#x96C6;&#x6307;&#x5B9A;&#x5305;&#x4E0B;&#x7684;&#x914D;&#x7F6E;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SpringValueProcessor</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">AbstractMetadata</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">BeanPostProcessor</span>, <span class=\"hljs-title\">PriorityOrdered</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    ....</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">processField</span><span class=\"hljs-params\">(Object bean, String beanName, Field field)</span> </span>{</span><br><span class=\"line\">        <span class=\"hljs-comment\">// register @Value on field</span></span><br><span class=\"line\">        Value value = field.getAnnotation(Value.class);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (value == <span class=\"hljs-keyword\">null</span>) {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">return</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        Set&lt;String&gt; keys = PlaceholderHelper.extractPlaceholderKeys(value.value());</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (keys.isEmpty()) {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">return</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-keyword\">for</span> (String key : keys) {</span><br><span class=\"line\">            Config config = generateConfig(bean, beanName, key, field);</span><br><span class=\"line\">            ConfigContextHolder.setConfigHolder(key, config);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> Config <span class=\"hljs-title\">generateConfig</span><span class=\"hljs-params\">(Object bean, String beanName, String key, Field field)</span> </span>{</span><br><span class=\"line\">        NadiaConfig nadiaConfig = field.getAnnotation(NadiaConfig.class);</span><br><span class=\"line\">        Class&lt;? extends Callback&gt; callback = <span class=\"hljs-keyword\">null</span>;</span><br><span class=\"line\">        Set&lt;NadiaConfig.CallbackScenes&gt; callbackScenesSet = <span class=\"hljs-keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (nadiaConfig != <span class=\"hljs-keyword\">null</span>) {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">if</span>(nadiaConfig.exclude()){</span><br><span class=\"line\">                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;</span><br><span class=\"line\">            }</span><br><span class=\"line\">            callback = nadiaConfig.clazz();</span><br><span class=\"line\">            callbackScenesSet = getCallbackScenes(nadiaConfig);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> Config(ConfigTypeEnum.FIELD,</span><br><span class=\"line\">                beanName,</span><br><span class=\"line\">                bean.getClass(),</span><br><span class=\"line\">                key, field,</span><br><span class=\"line\">                <span class=\"hljs-keyword\">null</span>,</span><br><span class=\"line\">                FieldUtil.getValue(bean, field),</span><br><span class=\"line\">                callback,</span><br><span class=\"line\">                callbackScenesSet,</span><br><span class=\"line\">                field.getType(),</span><br><span class=\"line\">                bean);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    ....</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<h2 id=\"4-&#x542F;&#x52A8;&#x914D;&#x7F6E;&#x672C;&#x5730;&#x914D;&#x7F6E;&#x66F4;&#x65B0;&#x7684;&#x6A21;&#x677F;&#x6D41;&#x7A0B;\"><a href=\"#4-&#x542F;&#x52A8;&#x914D;&#x7F6E;&#x672C;&#x5730;&#x914D;&#x7F6E;&#x66F4;&#x65B0;&#x7684;&#x6A21;&#x677F;&#x6D41;&#x7A0B;\" class=\"headerlink\" title=\"4.&#x542F;&#x52A8;&#x914D;&#x7F6E;&#x672C;&#x5730;&#x914D;&#x7F6E;&#x66F4;&#x65B0;&#x7684;&#x6A21;&#x677F;&#x6D41;&#x7A0B;\"></a>4.&#x542F;&#x52A8;&#x914D;&#x7F6E;&#x672C;&#x5730;&#x914D;&#x7F6E;&#x66F4;&#x65B0;&#x7684;&#x6A21;&#x677F;&#x6D41;&#x7A0B;</h2><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6A21;&#x677F;&#x6A21;&#x5F0F;&#x6307;&#x5B9A;&#x4E86;&#x4E00;&#x5957;&#x8FDC;&#x7A0B;&#x914D;&#x7F6E;&#x66F4;&#x65B0;&#x81F3;&#x672C;&#x5730;&#x7684;&#x6D41;&#x7A0B;&#x3002;&#x7ED3;&#x5408;SPI&#x7684;&#x7279;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;&#x5B58;&#x5728;&#x591A;&#x79CD;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x3002;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-meta\">@Component</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ConfigBootstart</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> InitEnvironment initEnvironment;</span><br><span class=\"line\">    <span class=\"hljs-meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> LoadConfig loadConfig;</span><br><span class=\"line\">    <span class=\"hljs-meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> Listener listener;</span><br><span class=\"line\">    <span class=\"hljs-meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> NotifyFactory notifyFactory;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">start</span><span class=\"hljs-params\">()</span></span>{</span><br><span class=\"line\">        <span class=\"hljs-comment\">//bootstart notify start</span></span><br><span class=\"line\">        notifyFactory.startPush();</span><br><span class=\"line\">        <span class=\"hljs-comment\">//env</span></span><br><span class=\"line\">        initEnvironment.init();</span><br><span class=\"line\">        <span class=\"hljs-comment\">//config</span></span><br><span class=\"line\">        loadConfig.load();</span><br><span class=\"line\">        loadConfig.updateClientValues();</span><br><span class=\"line\">        loadConfig.onlineClientInGroup();</span><br><span class=\"line\">        loadConfig.pushClientConfigs();</span><br><span class=\"line\">        loadConfig.keepClientAlive();</span><br><span class=\"line\">        <span class=\"hljs-comment\">//watch</span></span><br><span class=\"line\">        listener.init();</span><br><span class=\"line\">        <span class=\"hljs-comment\">//bootstart notify end</span></span><br><span class=\"line\">        notifyFactory.stopPush();</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<h2 id=\"5-Redis&#x5B9E;&#x73B0;&#x914D;&#x7F6E;&#x7684;&#x66F4;&#x65B0;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4E0A;&#x4E0B;&#x7EBF;\"><a href=\"#5-Redis&#x5B9E;&#x73B0;&#x914D;&#x7F6E;&#x7684;&#x66F4;&#x65B0;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4E0A;&#x4E0B;&#x7EBF;\" class=\"headerlink\" title=\"5.Redis&#x5B9E;&#x73B0;&#x914D;&#x7F6E;&#x7684;&#x66F4;&#x65B0;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4E0A;&#x4E0B;&#x7EBF;\"></a>5.Redis&#x5B9E;&#x73B0;&#x914D;&#x7F6E;&#x7684;&#x66F4;&#x65B0;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x4E0A;&#x4E0B;&#x7EBF;</h2><p>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x7528;Redis&#x5B9E;&#x73B0;AbstractLoadConfig&#x5B9A;&#x4E49;&#x597D;&#x7684;&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#xFF0C;&#x5305;&#x62EC;&#x914D;&#x7F6E;&#x4ECE;redis&#x7684;&#x62C9;&#x53D6;&#x3001;&#x66F4;&#x65B0;&#x672C;&#x5730;&#x914D;&#x7F6E;&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#x5FC3;&#x8DF3;&#x7684;&#x4E0A;&#x62A5;&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#x4E0A;&#x7EBF;&#x901A;&#x77E5;&#x3001;&#x5BA2;&#x6237;&#x7AEF;&#x4E0B;&#x7EBF;&#x901A;&#x77E5;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">RedisLoadConfig</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">AbstractLoadConfig</span> </span>{</span><br><span class=\"line\">    <span class=\"hljs-meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> ConfigCenterRedisService configCenterRedisService;</span><br><span class=\"line\">    <span class=\"hljs-meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">private</span> RedisPubSub redisPubSub;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">load</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">        <span class=\"hljs-comment\">//get redis info</span></span><br><span class=\"line\">        <span class=\"hljs-keyword\">this</span>.load(initEnvironment.getClientInfo().getApplication(), initEnvironment.getClientInfo().getGroup());</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">load</span><span class=\"hljs-params\">(String application, String group)</span> </span>{</span><br><span class=\"line\">        String configKey = RedisKeyUtil.getGroupConfig(application, group);</span><br><span class=\"line\">        Map&lt;String, String&gt; configs = configCenterRedisService.hgetAll(configKey);</span><br><span class=\"line\">        RemoteContextHolder.setRemoteHolder(configKey, configs);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title\">getValue</span><span class=\"hljs-params\">(String key)</span> </span>{</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">onlineClientInGroup</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        String applicationGroup = RedisKeyUtil.getInstance(clientInfo.getApplication(), clientInfo.getGroup());</span><br><span class=\"line\">        configCenterRedisService.sadd(applicationGroup, clientInfo.getName());</span><br><span class=\"line\">        log.info(<span class=\"hljs-string\">&quot;========================= onlineClientInGroup key[{}] value[{}] =========================&quot;</span>, applicationGroup, clientInfo.getName());</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">offlineClientInGroup</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        String applicationGroup = RedisKeyUtil.getInstance(clientInfo.getApplication(), clientInfo.getGroup());</span><br><span class=\"line\">        configCenterRedisService.del(applicationGroup, clientInfo.getName());</span><br><span class=\"line\">        log.info(<span class=\"hljs-string\">&quot;========================= offlineClientInGroup key[{}] value[{}] =========================&quot;</span>, applicationGroup, clientInfo.getName());</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">offlineClientConfigs</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        String instanceConfig = RedisKeyUtil.getInstanceConfig(clientInfo.getApplication(), clientInfo.getGroup(), clientInfo.getName());</span><br><span class=\"line\">        configCenterRedisService.del(instanceConfig);</span><br><span class=\"line\">        log.info(<span class=\"hljs-string\">&quot;========================= offlineClientConfigs key[{}] =========================&quot;</span>, instanceConfig);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">keepClientAlive</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        <span class=\"hljs-comment\">//push client info to redis schedule</span></span><br><span class=\"line\">        Executors.newScheduledThreadPool(<span class=\"hljs-number\">1</span>).scheduleAtFixedRate(<span class=\"hljs-keyword\">new</span> Runnable() {</span><br><span class=\"line\">            <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">            <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">run</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">                log.info(<span class=\"hljs-string\">&quot;========================= Client Keep Alive with Redis Start =========================&quot;</span>);</span><br><span class=\"line\">                clientInfo.setTimestamp(<span class=\"hljs-keyword\">new</span> Date().getTime());</span><br><span class=\"line\">                String hashCode = String.valueOf(clientInfo.hashCode());</span><br><span class=\"line\">                log.info(<span class=\"hljs-string\">&quot;========================= Client Keep Alive hashCode:[{}] clientInfo:[{}] =========================&quot;</span>, hashCode, clientInfo);</span><br><span class=\"line\">                configCenterRedisService.hset(RedisKeyUtil.getClints(), hashCode, JSONObject.toJSONString(clientInfo));</span><br><span class=\"line\">                log.info(<span class=\"hljs-string\">&quot;========================= Client Keep Alive with Redis End   =========================&quot;</span>);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">pushClientConfig</span><span class=\"hljs-params\">(String key, String value)</span> </span>{</span><br><span class=\"line\">        String configKey = RedisKeyUtil.getInstanceConfig(initEnvironment.getClientInfo().getApplication(),</span><br><span class=\"line\">                initEnvironment.getClientInfo().getGroup(), initEnvironment.getClientInfo().getName());</span><br><span class=\"line\">        configCenterRedisService.hset(configKey, key, value);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">pushClientConfigs</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        configCenterRedisService.del(RedisKeyUtil.getInstanceConfig(clientInfo.getApplication(), clientInfo.getGroup(), clientInfo.getName()));</span><br><span class=\"line\">        Map&lt;String, String&gt; clientConfigs = ConfigContextHolder.getClientConfigs();</span><br><span class=\"line\">        clientConfigs.forEach((k, v) -&gt; {</span><br><span class=\"line\">            configCenterRedisService.hset(RedisKeyUtil.getInstanceConfig(clientInfo.getApplication(), clientInfo.getGroup(), clientInfo.getName()), k, v);</span><br><span class=\"line\">        });</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">notificServer</span><span class=\"hljs-params\">(String message,EventType type , LogLevelEnum level)</span> </span>{</span><br><span class=\"line\">        redisPubSub.notifyServer(initEnvironment.getClientInfo(), type, level,message);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">offlineClientInfo</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        configCenterRedisService.del(RedisKeyUtil.getClints(),String.valueOf(clientInfo.hashCode()));</span><br><span class=\"line\">        log.info(<span class=\"hljs-string\">&quot;========================= delete client info  key[{}] value[{}]=========================&quot;</span>, RedisKeyUtil.getClints(),clientInfo.hashCode());</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">pushClinetInfo</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        configCenterRedisService.hset(RedisKeyUtil.getClints(), String.valueOf(clientInfo.hashCode()), JSONObject.toJSONString(clientInfo));</span><br><span class=\"line\">        log.info(<span class=\"hljs-string\">&quot;========================= push client info  key[{}] value[{}]=========================&quot;</span>, RedisKeyUtil.getClints(),clientInfo.hashCode());</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<h2 id=\"6-Redis&#x5B9E;&#x73B0;&#x8FDC;&#x7A0B;&#x914D;&#x7F6E;&#x7684;&#x5B9E;&#x65F6;&#x540C;&#x6B65;\"><a href=\"#6-Redis&#x5B9E;&#x73B0;&#x8FDC;&#x7A0B;&#x914D;&#x7F6E;&#x7684;&#x5B9E;&#x65F6;&#x540C;&#x6B65;\" class=\"headerlink\" title=\"6.Redis&#x5B9E;&#x73B0;&#x8FDC;&#x7A0B;&#x914D;&#x7F6E;&#x7684;&#x5B9E;&#x65F6;&#x540C;&#x6B65;\"></a>6.Redis&#x5B9E;&#x73B0;&#x8FDC;&#x7A0B;&#x914D;&#x7F6E;&#x7684;&#x5B9E;&#x65F6;&#x540C;&#x6B65;</h2><p>&#x914D;&#x7F6E;&#x4FE1;&#x606F;&#x7684;&#x5B9E;&#x65F6;&#x540C;&#x6B65;&#x4E3B;&#x8981;&#x91C7;&#x7528;&#x4E86;Redis&#x7684;&#x76D1;&#x542C;&#x529F;&#x80FD;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x542F;&#x52A8;&#x540E;&#x76D1;&#x542C;&#x7279;&#x6B8A;&#x901A;&#x9053;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5E76;&#x5265;&#x79BB;&#x51FA;&#x81EA;&#x5DF1;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x4FE1;&#x606F;&#x8FDB;&#x884C;&#x5904;&#x7406;&#x3002;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MyMessageListener</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">MessageListener</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-keyword\">private</span> LoadConfig loadConfig;</span><br><span class=\"line\"></span><br><span class=\"line\">        MyMessageListener(LoadConfig loadConfig) {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">this</span>.loadConfig = loadConfig;</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">        <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">onMessage</span><span class=\"hljs-params\">(Message message, <span class=\"hljs-keyword\">byte</span>[] pattern)</span> </span>{</span><br><span class=\"line\">            notifyFactory.startPush();</span><br><span class=\"line\">            MessageBody messageBody = MessageConvert.unpackageMessage(message.toString());</span><br><span class=\"line\">            <span class=\"hljs-keyword\">if</span> (messageBody <span class=\"hljs-keyword\">instanceof</span> UpdateValueMessageBody) {</span><br><span class=\"line\">                log.info(<span class=\"hljs-string\">&quot;receive UpdateValueMessageBody start&quot;</span>);</span><br><span class=\"line\">                redisPubSub.notifyServer(initEnvironment.getClientInfo(), EventType.CLIENT_MESSAGE, LogLevelEnum.LOG,<span class=\"hljs-string\">&quot;receive UpdateValueMessageBody start&quot;</span>);</span><br><span class=\"line\">                UpdateValueMessageBody updateValueMessageBody = (UpdateValueMessageBody) messageBody;</span><br><span class=\"line\">                String group = initEnvironment.getClientInfo().getGroup();</span><br><span class=\"line\">                <span class=\"hljs-keyword\">if</span> (group.equals(updateValueMessageBody.getGroup())) {</span><br><span class=\"line\">                    <span class=\"hljs-comment\">//updateClientValue local value</span></span><br><span class=\"line\">                    <span class=\"hljs-keyword\">boolean</span> hasFaile = loadConfig.updateClientValue(updateValueMessageBody.getKey(), updateValueMessageBody.getValue(), NadiaConfig.CallbackScenes.UPDATE_VALUE);</span><br><span class=\"line\">                    <span class=\"hljs-keyword\">if</span>(!hasFaile){</span><br><span class=\"line\">                        Object oldValue = ConfigContextHolder.getOldValue(updateValueMessageBody.getKey());</span><br><span class=\"line\">                        <span class=\"hljs-comment\">// update server value</span></span><br><span class=\"line\">                        loadConfig.pushClientConfig(updateValueMessageBody.getKey(), ClientValueUtil.serializer(updateValueMessageBody.getValue(), oldValue));</span><br><span class=\"line\">                    }</span><br><span class=\"line\">                }</span><br><span class=\"line\">            } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (messageBody <span class=\"hljs-keyword\">instanceof</span> SwitchInstanceMessageBody) {</span><br><span class=\"line\">                log.info(<span class=\"hljs-string\">&quot;receive SwitchInstanceMessageBody start&quot;</span>);</span><br><span class=\"line\">                redisPubSub.notifyServer(initEnvironment.getClientInfo(), EventType.CLIENT_MESSAGE, LogLevelEnum.LOG,<span class=\"hljs-string\">&quot;receive SwitchInstanceMessageBody start&quot;</span>);</span><br><span class=\"line\">                SwitchInstanceMessageBody switchInstanceMessageBody = (SwitchInstanceMessageBody) messageBody;</span><br><span class=\"line\">                <span class=\"hljs-comment\">//update local value</span></span><br><span class=\"line\">                loadConfig.switchGroup(switchInstanceMessageBody.getApplication(),switchInstanceMessageBody.getGroupFrom(),switchInstanceMessageBody.getGroupTo(),switchInstanceMessageBody.getInstance());</span><br><span class=\"line\">            } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (messageBody <span class=\"hljs-keyword\">instanceof</span> HeartbeatMessageBody) {</span><br><span class=\"line\">                log.info(<span class=\"hljs-string\">&quot;receive HeartbeatMessageBody&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            }</span><br><span class=\"line\">            notifyFactory.stopPush();</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br></pre></td></tr></tbody></table></figure>\n\n\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"Java","path":"tags/Java/"},{"name":"Redis","path":"tags/Redis/"},{"name":"é…ç½®ä¸­å¿ƒ","path":"tags/é…ç½®ä¸­å¿ƒ/"}],"excerpt":"<html><head></head><body><p>&#x4E0A;&#x671F;&#x6211;&#x4EEC;&#x786E;&#x5B9A;&#x4E86;&#x4EE5;Spring&#x7684;&#x65B9;&#x5411;&#x548C;&#x91C7;&#x7528;Redis&#x6765;&#x505A;&#x914D;&#x7F6E;&#x5173;&#x7CFB;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x5F00;&#x59CB;&#x56F4;&#x7ED5;&#x8FD9;&#x4E24;&#x4E2A;&#x5927;&#x5934;&#x5177;&#x4F53;&#x7684;&#x5F00;&#x59CB;&#x8BBE;&#x8BA1;&#x5BA2;&#x6237;&#x7AEF;&#x529F;&#x80FD;&#x3002;</p>\n<h2 id=\"1-&#x8BA9;Spring&#x542F;&#x52A8;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x5BA2;&#x6237;&#x7AEF;\"><a href=\"#1-&#x8BA9;Spring&#x542F;&#x52A8;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x5BA2;&#x6237;&#x7AEF;\" class=\"headerlink\" title=\"1.&#x8BA9;Spring&#x542F;&#x52A8;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x5BA2;&#x6237;&#x7AEF;\"></a>1.&#x8BA9;Spring&#x542F;&#x52A8;&#x6211;&#x4EEC;&#x7684;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x5BA2;&#x6237;&#x7AEF;</h2><p>&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x4E86;&#x914D;&#x7F6E;&#x4E2D;&#x5FC3;&#x7684;&#x542F;&#x52A8;&#x6CE8;&#x89E3;&#x3002;&#x540C;&#x5927;&#x591A;&#x6570;Spring&#x7684;&#x6574;&#x5408;&#x9879;&#x76EE;&#x4E00;&#x6837;&#xFF0C;&#x4E0D;&#x4EC5;&#x80FD;&#x901A;&#x8FC7;&#x542F;&#x52A8;&#x6CE8;&#x89E3;&#x542F;&#x7528;&#x529F;&#x80FD;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x80FD;&#x5BF9;&#x914D;&#x7F6E;&#x7684;&#x5E94;&#x7528;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x8BBE;&#x5B9A;&#x3002;</p></body></html>","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Target(ElementType.TYPE)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Import(ConfigRegistrar.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> EnableNadiaConfig &#123;</span><br><span class=\"line\">    <span class=\"comment\">//å¯ç”¨ç¯å¢ƒ</span></span><br><span class=\"line\">    <span class=\"comment\">//æœªè®¾ç½®æ—¶æ‰€æœ‰ç¯å¢ƒå¯åŠ¨</span></span><br><span class=\"line\">    String[] actives() <span class=\"keyword\">default</span> &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//æŒ‡å®šé…ç½®æ‰€å±çš„Application</span></span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">application</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> &quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//é»˜è®¤åˆ†ç»„</span></span><br><span class=\"line\">    <span class=\"comment\">//æœªè®¾ç½®æ—¶ä¸ºé»˜è®¤åˆ†ç»„</span></span><br><span class=\"line\">    <span class=\"function\">String <span class=\"title\">group</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> &quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//æŒ‡å®šé…ç½®çš„åŒ…è·¯å¾„ï¼Œé¿å…è§£ææ— ç”¨çš„é…ç½®</span></span><br><span class=\"line\">    String[] basePackages() <span class=\"keyword\">default</span> &#123;&#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-æ³¨å†Œé…ç½®ä¸­å¿ƒç›¸å…³ç±»\"><a href=\"#2-æ³¨å†Œé…ç½®ä¸­å¿ƒç›¸å…³ç±»\" class=\"headerlink\" title=\"2.æ³¨å†Œé…ç½®ä¸­å¿ƒç›¸å…³ç±»\"></a>2.æ³¨å†Œé…ç½®ä¸­å¿ƒç›¸å…³ç±»</h2><p>é€šè¿‡å®ç°ImportBeanDefinitionRegistraræ–¹æ³•æˆ‘ä»¬å¯ä»¥è·å¾—Beanå®šä¹‰çš„æ³¨å†Œå™¨ï¼Œæ­¤æ—¶å°±å¯ä»¥å°†æˆ‘ä»¬çš„åŠŸèƒ½ä¼˜é›…çš„æ³¨å†Œè‡³springç”Ÿå‘½å‘¨æœŸå†…ã€‚</p>\n<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è®¾è®¡æ—¶é‡‡ç”¨äº†spiçš„æ–¹å¼ï¼Œåœ¨å®ç°çš„æ—¶å€™é‡‡ç”¨çš„æ˜¯Redisã€‚è¿™å°±æ„å‘³ç€æœªæ¥å¦‚æœæˆ‘ä»¬æƒ³æ›´æ¢é…ç½®ç®¡ç†çš„æ–¹å¼ï¼Œå®Œå…¨å¯ä»¥ç»§æ‰¿ç°æœ‰æ¥å£å®ç°ä¸€å¥—æ–°çš„æœºåˆ¶ã€‚ä¸ºæœªæ¥çš„æ‹“å±•æä¾›äº†å¯èƒ½æ€§ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConfigRegistrar</span> <span class=\"keyword\">implements</span> <span class=\"title\">ImportBeanDefinitionRegistrar</span>, <span class=\"title\">EnvironmentAware</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    .....</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerBeanDefinitions</span><span class=\"params\">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class=\"line\">        AnnotationAttributes attributes = AnnotationAttributes</span><br><span class=\"line\">                .fromMap(importingClassMetadata.getAnnotationAttributes(EnableNadiaConfig.class.getName()));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//æ£€æŸ¥æ˜¯å¦éœ€è¦å¯åŠ¨</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!enableConfig(importingClassMetadata, attributes)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//åˆå§‹åŒ–éœ€è¦æ‰«æçš„åŒ…</span></span><br><span class=\"line\">        ConfigRegistrar.setBasePackages(attributes);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//å·¥å…·</span></span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, SpringUtils.class.getName(), SpringUtils.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//æ”¶é›†æœ¬åœ°ç¯å¢ƒå˜é‡ã€ç”ŸæˆæœåŠ¡ä¿¡æ¯</span></span><br><span class=\"line\">        <span class=\"comment\">//-----&gt;SPIå®ç°ï¼Œæœ¬åœ°å˜é‡çš„æ‰‹æœºå’ŒServiceç«¯æ˜¾ç¤ºçš„æœåŠ¡ä¿¡æ¯å¯è‡ªå®šä¹‰å®ç°</span></span><br><span class=\"line\">        Map&lt;String, Object&gt; envPropertyValues = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        envPropertyValues.put(<span class=\"string\">&quot;importingClassMetadata&quot;</span>, importingClassMetadata);</span><br><span class=\"line\">        InitEnvironment env = SpiServiceUtil.loadFirst(InitEnvironment.class);</span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, InitEnvironment.class.getName(), env.getClass(), envPropertyValues);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//æ”¶é›†æœ¬åœ°é…ç½®&amp;å›è°ƒæ–¹æ³•</span></span><br><span class=\"line\">        Map&lt;String, Object&gt; processorPropertyValues = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">        processorPropertyValues.put(<span class=\"string\">&quot;importingClassMetadata&quot;</span>, importingClassMetadata);</span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, SpringValueProcessor.class.getName(), SpringValueProcessor.class, processorPropertyValues);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//å¯åŠ¨å™¨æ³¨å†Œ</span></span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ConfigPostConstructProcessor.class.getName(), ConfigPostConstructProcessor.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//redisè£…è½½</span></span><br><span class=\"line\">        ConfigCenter configCenter = SpiServiceUtil.loadFirst(ConfigCenter.class);</span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ConfigCenter.class.getName(), configCenter.getClass());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//æŒ‰ç…§æœ¬åœ°ç¯å¢ƒå˜é‡æ”¶é›†redisä¸­çš„é…ç½®ï¼ˆï¼‰</span></span><br><span class=\"line\">        <span class=\"comment\">//å‘redisæä¾›å½“å‰æœåŠ¡ä¿¡æ¯</span></span><br><span class=\"line\">        <span class=\"comment\">//------&gt;SPIå®ç°ï¼Œå¯æ›¿æ¢redisä¸ºå…¶ä»–ä¸­é—´ä»¶</span></span><br><span class=\"line\">        LoadConfig loadConfig = SpiServiceUtil.loadFirst(LoadConfig.class);</span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, LoadConfig.class.getName(), loadConfig.getClass());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//é…ç½®å˜æ›´è®¢é˜…</span></span><br><span class=\"line\">        Listener listener = SpiServiceUtil.loadFirst(Listener.class);</span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, Listener.class.getName(), listener.getClass());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//å®¢æˆ·ç«¯é€šçŸ¥æœåŠ¡ç«¯</span></span><br><span class=\"line\">        NotifyFactory notifyFactory = SpiServiceUtil.loadFirst(NotifyFactory.class);</span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, NotifyFactory.class.getName(), notifyFactory.getClass());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//é…ç½®å˜æ›´å¯åŠ¨ç±»</span></span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ConfigPostConstructProcessor.class.getName(), ConfigPostConstructProcessor.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//springå®¹å™¨å…³é—­æ—¶ï¼Œé”€æ¯å½“å‰å®ä¾‹ä¿¡æ¯</span></span><br><span class=\"line\">        BeanRegistrationUtil.registerBeanDefinitionIfNotExists(registry, ApplicationEventListener.class.getName(), ApplicationEventListener.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-å®¢æˆ·ç«¯é…ç½®çš„ç»Ÿä¸€æ”¶é›†\"><a href=\"#3-å®¢æˆ·ç«¯é…ç½®çš„ç»Ÿä¸€æ”¶é›†\" class=\"headerlink\" title=\"3.å®¢æˆ·ç«¯é…ç½®çš„ç»Ÿä¸€æ”¶é›†\"></a>3.å®¢æˆ·ç«¯é…ç½®çš„ç»Ÿä¸€æ”¶é›†</h2><p>æ”¶é›†é…ç½®æ—¶ï¼Œè€ƒè™‘åˆ°æŠŠå¯¹å¼€å‘äººå‘˜çš„ä»£ç ä¾µå…¥æ€§é™åˆ°æœ€ä½ï¼Œæˆ‘ä»¬å†³å®šé’ˆå¯¹Springè‡ªèº«@Valueæ³¨è§£å’Œ@ConfigurationPropertiesæ³¨è§£è¿›è¡Œæ”¶é›†ã€‚å¥½å¤„æ˜¯å¼€å‘äººå‘˜æ— éœ€å¼•å…¥å…¶ä»–çš„å­¦ä¹ æˆæœ¬ï¼Œåœ¨ä¸å˜æ›´ç°æœ‰å¼€å‘æ¨¡å¼ä¸‹å°±èƒ½è¿›è¡Œé…ç½®é¡¹çš„æ”¶é›†ä¸ç®¡ç†ã€‚</p>\n<p>æ­¤å¤–ï¼Œé’ˆå¯¹é…ç½®ç®¡ç†çš„ä¸€äº›ç‰¹æ®Šæ›´èƒ½ï¼Œæˆ‘ä»¬è®¾è®¡äº†æ‰«åŒ…è·¯å¾„ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®éœ€è¦è®¾å®šæ‰«åŒ…è·¯å¾„ï¼Œä»è€Œå¯¹å…³å¿ƒçš„é…ç½®è¿›è¡Œè¿œç¨‹ç®¡ç†ã€‚åŒæ—¶æˆ‘ä»¬æä¾›äº†@NadiaConfigæ³¨è§£ï¼Œä¸€æ—¦æ ‡è®°ä¸Šè¯¥æ³¨è§£åã€‚å¼€å‘äººå‘˜å¯ä»¥é’ˆå¯¹é…ç½®çš„å˜æ›´è¿›è¡Œè‡ªå®šä¹‰çš„å›è°ƒå¤„ç†ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(&#123;ElementType.FIELD,ElementType.CONSTRUCTOR&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> NadiaConfig &#123;</span><br><span class=\"line\">    Class&lt;? extends Callback&gt; clazz();</span><br><span class=\"line\"></span><br><span class=\"line\">    CallbackScenes[] callbackScenes() <span class=\"keyword\">default</span> &#123;CallbackScenes.UPDATE_VALUE, CallbackScenes.SWITCH_GROUP&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">exclude</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"keyword\">false</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">CallbackScenes</span> </span>&#123;</span><br><span class=\"line\">        INIT,</span><br><span class=\"line\">        SWITCH_GROUP,</span><br><span class=\"line\">        UPDATE_VALUE,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å®ç°BeanPostProcessoræ¥å£åï¼Œåœ¨Beançš„åç½®å¤„ç†é€»è¾‘ä¸­æˆ‘ä»¬ä¼šæ”¶é›†æŒ‡å®šåŒ…ä¸‹çš„é…ç½®</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringValueProcessor</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractMetadata</span> <span class=\"keyword\">implements</span> <span class=\"title\">BeanPostProcessor</span>, <span class=\"title\">PriorityOrdered</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    ....</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">processField</span><span class=\"params\">(Object bean, String beanName, Field field)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// register @Value on field</span></span><br><span class=\"line\">        Value value = field.getAnnotation(Value.class);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (value == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Set&lt;String&gt; keys = PlaceholderHelper.extractPlaceholderKeys(value.value());</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (keys.isEmpty()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (String key : keys) &#123;</span><br><span class=\"line\">            Config config = generateConfig(bean, beanName, key, field);</span><br><span class=\"line\">            ConfigContextHolder.setConfigHolder(key, config);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Config <span class=\"title\">generateConfig</span><span class=\"params\">(Object bean, String beanName, String key, Field field)</span> </span>&#123;</span><br><span class=\"line\">        NadiaConfig nadiaConfig = field.getAnnotation(NadiaConfig.class);</span><br><span class=\"line\">        Class&lt;? extends Callback&gt; callback = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        Set&lt;NadiaConfig.CallbackScenes&gt; callbackScenesSet = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (nadiaConfig != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(nadiaConfig.exclude())&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            callback = nadiaConfig.clazz();</span><br><span class=\"line\">            callbackScenesSet = getCallbackScenes(nadiaConfig);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Config(ConfigTypeEnum.FIELD,</span><br><span class=\"line\">                beanName,</span><br><span class=\"line\">                bean.getClass(),</span><br><span class=\"line\">                key, field,</span><br><span class=\"line\">                <span class=\"keyword\">null</span>,</span><br><span class=\"line\">                FieldUtil.getValue(bean, field),</span><br><span class=\"line\">                callback,</span><br><span class=\"line\">                callbackScenesSet,</span><br><span class=\"line\">                field.getType(),</span><br><span class=\"line\">                bean);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ....</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-å¯åŠ¨é…ç½®æœ¬åœ°é…ç½®æ›´æ–°çš„æ¨¡æ¿æµç¨‹\"><a href=\"#4-å¯åŠ¨é…ç½®æœ¬åœ°é…ç½®æ›´æ–°çš„æ¨¡æ¿æµç¨‹\" class=\"headerlink\" title=\"4.å¯åŠ¨é…ç½®æœ¬åœ°é…ç½®æ›´æ–°çš„æ¨¡æ¿æµç¨‹\"></a>4.å¯åŠ¨é…ç½®æœ¬åœ°é…ç½®æ›´æ–°çš„æ¨¡æ¿æµç¨‹</h2><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¨¡æ¿æ¨¡å¼æŒ‡å®šäº†ä¸€å¥—è¿œç¨‹é…ç½®æ›´æ–°è‡³æœ¬åœ°çš„æµç¨‹ã€‚ç»“åˆSPIçš„ç‰¹æ€§ï¼Œå¯ä»¥å­˜åœ¨å¤šç§çš„å®ç°æ–¹å¼ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConfigBootstart</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> InitEnvironment initEnvironment;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LoadConfig loadConfig;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Listener listener;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> NotifyFactory notifyFactory;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">start</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//bootstart notify start</span></span><br><span class=\"line\">        notifyFactory.startPush();</span><br><span class=\"line\">        <span class=\"comment\">//env</span></span><br><span class=\"line\">        initEnvironment.init();</span><br><span class=\"line\">        <span class=\"comment\">//config</span></span><br><span class=\"line\">        loadConfig.load();</span><br><span class=\"line\">        loadConfig.updateClientValues();</span><br><span class=\"line\">        loadConfig.onlineClientInGroup();</span><br><span class=\"line\">        loadConfig.pushClientConfigs();</span><br><span class=\"line\">        loadConfig.keepClientAlive();</span><br><span class=\"line\">        <span class=\"comment\">//watch</span></span><br><span class=\"line\">        listener.init();</span><br><span class=\"line\">        <span class=\"comment\">//bootstart notify end</span></span><br><span class=\"line\">        notifyFactory.stopPush();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-Rediså®ç°é…ç½®çš„æ›´æ–°ï¼Œå®¢æˆ·ç«¯çš„ä¸Šä¸‹çº¿\"><a href=\"#5-Rediså®ç°é…ç½®çš„æ›´æ–°ï¼Œå®¢æˆ·ç«¯çš„ä¸Šä¸‹çº¿\" class=\"headerlink\" title=\"5.Rediså®ç°é…ç½®çš„æ›´æ–°ï¼Œå®¢æˆ·ç«¯çš„ä¸Šä¸‹çº¿\"></a>5.Rediså®ç°é…ç½®çš„æ›´æ–°ï¼Œå®¢æˆ·ç«¯çš„ä¸Šä¸‹çº¿</h2><p>è¿™é‡Œæˆ‘ä»¬ç”¨Rediså®ç°AbstractLoadConfigå®šä¹‰å¥½çš„æ¨¡æ¿æ–¹æ³•ï¼ŒåŒ…æ‹¬é…ç½®ä»redisçš„æ‹‰å–ã€æ›´æ–°æœ¬åœ°é…ç½®ã€å®¢æˆ·ç«¯å¿ƒè·³çš„ä¸ŠæŠ¥ã€å®¢æˆ·ç«¯ä¸Šçº¿é€šçŸ¥ã€å®¢æˆ·ç«¯ä¸‹çº¿é€šçŸ¥</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisLoadConfig</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractLoadConfig</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ConfigCenterRedisService configCenterRedisService;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RedisPubSub redisPubSub;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">load</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//get redis info</span></span><br><span class=\"line\">        <span class=\"keyword\">this</span>.load(initEnvironment.getClientInfo().getApplication(), initEnvironment.getClientInfo().getGroup());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">load</span><span class=\"params\">(String application, String group)</span> </span>&#123;</span><br><span class=\"line\">        String configKey = RedisKeyUtil.getGroupConfig(application, group);</span><br><span class=\"line\">        Map&lt;String, String&gt; configs = configCenterRedisService.hgetAll(configKey);</span><br><span class=\"line\">        RemoteContextHolder.setRemoteHolder(configKey, configs);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">getValue</span><span class=\"params\">(String key)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onlineClientInGroup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        String applicationGroup = RedisKeyUtil.getInstance(clientInfo.getApplication(), clientInfo.getGroup());</span><br><span class=\"line\">        configCenterRedisService.sadd(applicationGroup, clientInfo.getName());</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;========================= onlineClientInGroup key[&#123;&#125;] value[&#123;&#125;] =========================&quot;</span>, applicationGroup, clientInfo.getName());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">offlineClientInGroup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        String applicationGroup = RedisKeyUtil.getInstance(clientInfo.getApplication(), clientInfo.getGroup());</span><br><span class=\"line\">        configCenterRedisService.del(applicationGroup, clientInfo.getName());</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;========================= offlineClientInGroup key[&#123;&#125;] value[&#123;&#125;] =========================&quot;</span>, applicationGroup, clientInfo.getName());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">offlineClientConfigs</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        String instanceConfig = RedisKeyUtil.getInstanceConfig(clientInfo.getApplication(), clientInfo.getGroup(), clientInfo.getName());</span><br><span class=\"line\">        configCenterRedisService.del(instanceConfig);</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;========================= offlineClientConfigs key[&#123;&#125;] =========================&quot;</span>, instanceConfig);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">keepClientAlive</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        <span class=\"comment\">//push client info to redis schedule</span></span><br><span class=\"line\">        Executors.newScheduledThreadPool(<span class=\"number\">1</span>).scheduleAtFixedRate(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                log.info(<span class=\"string\">&quot;========================= Client Keep Alive with Redis Start =========================&quot;</span>);</span><br><span class=\"line\">                clientInfo.setTimestamp(<span class=\"keyword\">new</span> Date().getTime());</span><br><span class=\"line\">                String hashCode = String.valueOf(clientInfo.hashCode());</span><br><span class=\"line\">                log.info(<span class=\"string\">&quot;========================= Client Keep Alive hashCode:[&#123;&#125;] clientInfo:[&#123;&#125;] =========================&quot;</span>, hashCode, clientInfo);</span><br><span class=\"line\">                configCenterRedisService.hset(RedisKeyUtil.getClints(), hashCode, JSONObject.toJSONString(clientInfo));</span><br><span class=\"line\">                log.info(<span class=\"string\">&quot;========================= Client Keep Alive with Redis End   =========================&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"number\">0</span>, <span class=\"number\">1</span>, TimeUnit.MINUTES);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">pushClientConfig</span><span class=\"params\">(String key, String value)</span> </span>&#123;</span><br><span class=\"line\">        String configKey = RedisKeyUtil.getInstanceConfig(initEnvironment.getClientInfo().getApplication(),</span><br><span class=\"line\">                initEnvironment.getClientInfo().getGroup(), initEnvironment.getClientInfo().getName());</span><br><span class=\"line\">        configCenterRedisService.hset(configKey, key, value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">pushClientConfigs</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        configCenterRedisService.del(RedisKeyUtil.getInstanceConfig(clientInfo.getApplication(), clientInfo.getGroup(), clientInfo.getName()));</span><br><span class=\"line\">        Map&lt;String, String&gt; clientConfigs = ConfigContextHolder.getClientConfigs();</span><br><span class=\"line\">        clientConfigs.forEach((k, v) -&gt; &#123;</span><br><span class=\"line\">            configCenterRedisService.hset(RedisKeyUtil.getInstanceConfig(clientInfo.getApplication(), clientInfo.getGroup(), clientInfo.getName()), k, v);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">notificServer</span><span class=\"params\">(String message,EventType type , LogLevelEnum level)</span> </span>&#123;</span><br><span class=\"line\">        redisPubSub.notifyServer(initEnvironment.getClientInfo(), type, level,message);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">offlineClientInfo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        configCenterRedisService.del(RedisKeyUtil.getClints(),String.valueOf(clientInfo.hashCode()));</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;========================= delete client info  key[&#123;&#125;] value[&#123;&#125;]=========================&quot;</span>, RedisKeyUtil.getClints(),clientInfo.hashCode());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">pushClinetInfo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ClientInfo clientInfo = initEnvironment.getClientInfo();</span><br><span class=\"line\">        configCenterRedisService.hset(RedisKeyUtil.getClints(), String.valueOf(clientInfo.hashCode()), JSONObject.toJSONString(clientInfo));</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;========================= push client info  key[&#123;&#125;] value[&#123;&#125;]=========================&quot;</span>, RedisKeyUtil.getClints(),clientInfo.hashCode());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-Rediså®ç°è¿œç¨‹é…ç½®çš„å®æ—¶åŒæ­¥\"><a href=\"#6-Rediså®ç°è¿œç¨‹é…ç½®çš„å®æ—¶åŒæ­¥\" class=\"headerlink\" title=\"6.Rediså®ç°è¿œç¨‹é…ç½®çš„å®æ—¶åŒæ­¥\"></a>6.Rediså®ç°è¿œç¨‹é…ç½®çš„å®æ—¶åŒæ­¥</h2><p>é…ç½®ä¿¡æ¯çš„å®æ—¶åŒæ­¥ä¸»è¦é‡‡ç”¨äº†Redisçš„ç›‘å¬åŠŸèƒ½ï¼Œå®¢æˆ·ç«¯å¯åŠ¨åç›‘å¬ç‰¹æ®Šé€šé“çš„ä¿¡æ¯ï¼Œå¹¶å‰¥ç¦»å‡ºè‡ªå·±æ„Ÿå…´è¶£çš„ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyMessageListener</span> <span class=\"keyword\">implements</span> <span class=\"title\">MessageListener</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> LoadConfig loadConfig;</span><br><span class=\"line\"></span><br><span class=\"line\">        MyMessageListener(LoadConfig loadConfig) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.loadConfig = loadConfig;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">onMessage</span><span class=\"params\">(Message message, <span class=\"keyword\">byte</span>[] pattern)</span> </span>&#123;</span><br><span class=\"line\">            notifyFactory.startPush();</span><br><span class=\"line\">            MessageBody messageBody = MessageConvert.unpackageMessage(message.toString());</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (messageBody <span class=\"keyword\">instanceof</span> UpdateValueMessageBody) &#123;</span><br><span class=\"line\">                log.info(<span class=\"string\">&quot;receive UpdateValueMessageBody start&quot;</span>);</span><br><span class=\"line\">                redisPubSub.notifyServer(initEnvironment.getClientInfo(), EventType.CLIENT_MESSAGE, LogLevelEnum.LOG,<span class=\"string\">&quot;receive UpdateValueMessageBody start&quot;</span>);</span><br><span class=\"line\">                UpdateValueMessageBody updateValueMessageBody = (UpdateValueMessageBody) messageBody;</span><br><span class=\"line\">                String group = initEnvironment.getClientInfo().getGroup();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (group.equals(updateValueMessageBody.getGroup())) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//updateClientValue local value</span></span><br><span class=\"line\">                    <span class=\"keyword\">boolean</span> hasFaile = loadConfig.updateClientValue(updateValueMessageBody.getKey(), updateValueMessageBody.getValue(), NadiaConfig.CallbackScenes.UPDATE_VALUE);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(!hasFaile)&#123;</span><br><span class=\"line\">                        Object oldValue = ConfigContextHolder.getOldValue(updateValueMessageBody.getKey());</span><br><span class=\"line\">                        <span class=\"comment\">// update server value</span></span><br><span class=\"line\">                        loadConfig.pushClientConfig(updateValueMessageBody.getKey(), ClientValueUtil.serializer(updateValueMessageBody.getValue(), oldValue));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (messageBody <span class=\"keyword\">instanceof</span> SwitchInstanceMessageBody) &#123;</span><br><span class=\"line\">                log.info(<span class=\"string\">&quot;receive SwitchInstanceMessageBody start&quot;</span>);</span><br><span class=\"line\">                redisPubSub.notifyServer(initEnvironment.getClientInfo(), EventType.CLIENT_MESSAGE, LogLevelEnum.LOG,<span class=\"string\">&quot;receive SwitchInstanceMessageBody start&quot;</span>);</span><br><span class=\"line\">                SwitchInstanceMessageBody switchInstanceMessageBody = (SwitchInstanceMessageBody) messageBody;</span><br><span class=\"line\">                <span class=\"comment\">//update local value</span></span><br><span class=\"line\">                loadConfig.switchGroup(switchInstanceMessageBody.getApplication(),switchInstanceMessageBody.getGroupFrom(),switchInstanceMessageBody.getGroupTo(),switchInstanceMessageBody.getInstance());</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (messageBody <span class=\"keyword\">instanceof</span> HeartbeatMessageBody) &#123;</span><br><span class=\"line\">                log.info(<span class=\"string\">&quot;receive HeartbeatMessageBody&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            notifyFactory.stopPush();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>"},{"title":"æ·±åº¦å‰–æJVM åŠ¨æ€AttachåŸç†","date":"2020-09-21T11:01:04.000Z","_content":"\nç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´éƒ½ä½¿ç”¨è¿‡javaagentæ¢é’ˆæŠ€æœ¯ï¼Œjavaagentå¯ä»¥åœ¨ä¸ä¾µå…¥åŸä»£ç ä¸çš„å‰æä¸‹ï¼Œé€šè¿‡æŒ‡å®šæ–¹æ³•å¹¶åˆ©ç”¨åŠ¨æ€å­—èŠ‚ç æŠ€æœ¯å¢å¼ºæˆ‘ä»¬çš„ä»£ç ã€‚å¾ˆå¤šæˆç†Ÿçš„æ¡†æ¶ä¹Ÿè¿ç”¨åˆ°äº†è¯¥æŠ€æœ¯ï¼Œå¦‚skywalkingç­‰ã€‚è¿™ä¹ˆå¥½ç”¨çš„åŠŸèƒ½ï¼ŒJDKçš„å¼€å‘äººå‘˜æ²¡é“ç†ä¸ç©å‡ºäº›æ–°èŠ±å¤´ï¼Œå› æ­¤åœ¨JDK1.6ä¸­ï¼Œæ›´åŠ å¼ºå¤§çš„JVM åŠ¨æ€AttachæŠ€æœ¯å±•ç°åœ¨æˆ‘ä»¬çš„é¢å‰ã€‚å¤§åé¼é¼çš„Btraceã€Arthasç­‰éƒ½è¿ç”¨äº†åŠ¨æ€AttachæŠ€æœ¯ã€‚åœ¨JVMè¿è¡ŒæœŸè¿›æ‹¦æˆªå¹¶å¢å¼ºæˆ‘ä»¬çš„ä»£ç ï¼Œä½¿å¾—ä»¥å¾€ç”Ÿäº§éš¾ä»¥å®šä½çš„é—®é¢˜å˜å¾—æ›´åŠ å®¹æ˜“æ’æŸ¥ã€‚\n<!-- more -->\nJVMçš„åŠ¨æ€Attachå›ºç„¶å¥½ï¼Œç›¸ä¿¡å¤§å®¶æˆ–å¤šæˆ–å°‘å·²ç»çŸ¥é“å¦‚ä½•å»ä½¿ç”¨è¯¥æŠ€æœ¯äº†ï¼Œæ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬ç ”ç©¶çš„é‡ç‚¹æ˜¯JVMæ˜¯å¦‚ä½•å®ç°åŠ¨æ€Attachï¼Œè‡³äºJVMå¦‚ä½•åŠ è½½åŠ¨æ€JaråŒ…ã€åˆ†å‘æ–¹æ³•å¹¶ä¼ é€’jvmä¸Šä¸‹æ–‡å°±ä¸åœ¨æˆ‘ä»¬çš„ç ”ç©¶èŒƒå›´ä¹‹å†…ã€‚\n\nä¸ºäº†æ›´å¥½çš„ç ”ç©¶JVMçš„å®ç°ï¼Œæˆ‘ä»¬å°†ç”±æµ…å…¥æ·±ï¼Œåˆ†ä¸ºå‡ ä¸ªé˜¶æ®µè¿›è¡Œç ”ç©¶ï¼š\n* åŠ¨æ€Attachæ˜¯ä»€ä¹ˆï¼Ÿ\n* æœ‰å‡ ç§æ–¹æ¡ˆå¯ä»¥å®ç°åŠ¨æ€Attach\n* ä¸¾ä¸€ä¸ªæ —å­\n* çœ‹çœ‹JVMæ˜¯æ€ä¹ˆåšçš„\n\n## ä¸€ã€åŠ¨æ€Attachæ˜¯ä»€ä¹ˆ\nè™½ç„¶æˆ‘ä»¬è¿™æ¬¡ç ”ç©¶çš„æ˜¯å…·ä½“çš„å®ç°ï¼Œä½†åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åƒåˆ†æéœ€æ±‚ä¸€æ ·åˆ†æä¸‹åŠ¨æ€Attachåˆ°åº•æ˜¯ä»€ä¹ˆã€‚\n\næˆ‘ä»¬éƒ½çŸ¥é“javaagentå‚æ•°æ˜¯ä¼´éšç€javaå‘½ä»¤ï¼Œåœ¨JVMå¯åŠ¨çš„è¿‡ç¨‹ä¸­åŠ è½½javaagentå‚æ•°æŒ‡å®šçš„JaråŒ…è·¯å¾„ï¼Œå¹¶æ‰§è¡Œçº¦å®šç±»çš„premainæ–¹æ³•ã€‚åœ¨premainæ–¹æ³•ä¸­å¯ä»¥è·å–Instrumentationç±»å‹å‚æ•°ï¼Œä»è€Œå¯¹æˆ‘ä»¬çš„ç±»è¿›è¡ŒåŠ¨æ€å¢å¼ºå¢å¼ºã€‚\n\næˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨javaagentï¼š\n1. å…ˆå®ç°ä¸€ä¸ªæˆ‘ä»¬éœ€è¦æŒ‚åœ¨çš„ç±»ï¼Œå…¶ä¸­éœ€è¦å®ç°premain()æ–¹æ³•ï¼Œå¹¶å°†å®ƒæ‰“åŒ…ä¸ºå¯æ‰§è¡ŒJaråŒ…\n``` java\npublic class Javaagent {\n    public static void premain(String agentArgs, Instrumentation inst) {\n        System.out.println(\"agentArgs : \" + agentArgs);\n        inst.addTransformer(new TestTransformer(), true);\n    }\n\n    static class TestTransformer implements ClassFileTransformer {\n\n        @Override\n        public byte[] transform(ClassLoader loader, String className, Class<?> classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {\n            System.out.println(\"premain load Class:\" + className);\n            return classfileBuffer;\n        }\n    }\n}\n```\n\n2. é…ç½®MANIFEST.MFé…ç½®æ–‡ä»¶\n```xml\nPremain-Class: Javaagent\nAgent-Class: Javaagent\nCan-Redefine-Classes: true\nCan-Retransform-Classes: true\n```\n\n3. å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡\n```shell\njava -javaagent:Javaagent.jar è‡ªå·±çš„æœåŠ¡.jar\n```\n\nä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„javaagentè¿ç”¨åœºæ™¯ã€‚javaagentå¯ä»¥åœ¨ä¸ä¾µå…¥ä¸šåŠ¡ä»£ç çš„å‰æä¸‹ä¿®æ”¹æˆ‘ä»¬å·²åŠ è½½çš„ç±»ï¼Œä½†å”¯ä¸€çš„é—®é¢˜æ˜¯éœ€è¦ä¼´éšç€ä¸šåŠ¡æœåŠ¡ä¸€åŒå¯åŠ¨ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ— æ³•ä¾µå…¥å·²ç»è¿è¡Œåœ¨JVMä¸­çš„ä»£ç ï¼Œå› æ­¤JDKå¼€å‘çš„å¤§ç¥ä»¬ä¸ºæˆ‘ä»¬å¸¦æ¥äº†åŠ¨æ€Attach APIã€‚å…¶åŠŸèƒ½ä¸javaagentæ˜¯ä¸€æ ·çš„ï¼Œä½†æœ€å¤§çš„å¥½å¤„å°±æ˜¯æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€ä¸ªå·²ç»è¿è¡Œçš„JVMä¸ŠåŠ¨æ€çš„æŒ‚è½½ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±å¼€å‘çš„JaråŒ…ï¼Œä»è€Œå®ç°ä»»ä½•æ—¶é—´ç‚¹æˆ‘ä»¬éƒ½èƒ½æ‰‹åŠ¨çš„å¢å¼ºä¸šåŠ¡ä»£ç ã€‚æ¯”å¦‚é€šè¿‡attach Arthasï¼Œæˆ‘ä»¬èƒ½å¢å¼ºæŒ‡å®šæ–¹æ³•çš„å…¥å£&å‡ºå£ï¼Œä»è€Œè·å–å‡ºå…¥å‚çš„ç›¸å…³ä¿¡æ¯ã€‚è¿™åœ¨ç¼ºå°‘æ—¥å¿—è¾“å‡ºçš„åœºæ™¯ä¸‹æ˜¯éå¸¸æœ‰æ•ˆçš„é—®é¢˜å®šä½æ‰‹æ®µã€‚æ­¤å¤–æˆ‘ä»¬ä¹Ÿèƒ½ä¸ºæ–¹æ³•çš„è°ƒç”¨é“¾åšåŸ‹ç‚¹ï¼Œå¸®åŠ©æˆ‘ä»¬åˆ†æä¸šåŠ¡æµç¨‹ä¸­çš„æ…¢æ–¹æ³•ç­‰ç­‰ã€‚\n\næ€»ç»“ä¸‹ï¼ŒåŠ¨æ€Attachå°±æ˜¯JVMè¿è¡ŒæœŸä¸­æä¾›çš„æŒ‡å®šç±»å‹çš„ç±»åŠ è½½æœºåˆ¶ã€‚é€šè¿‡å¢å¼ºç±»çš„åŠ è½½ï¼Œå®ç°å„å¼å„æ ·æœ‰è¶£çš„åŠŸèƒ½ã€‚\n\n## äºŒã€æœ‰å‡ ç§æ–¹æ¡ˆå¯ä»¥å®ç°åŠ¨æ€Attach\nç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“ä»€ä¹ˆæ˜¯åŠ¨æ€Attachäº†ï¼Œå€˜è‹¥æˆ‘ä»¬æ˜¯JDKçš„å·¥ç¨‹å¸ˆï¼Œå½“äº§å“äº¤ç»™æˆ‘ä»¬éœ€è¦å®ç°åŠ¨æ€Attachè¿™ä¸ªéœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬ä¼šæ€ä¹ˆå®ç°å‘¢ï¼Ÿ\n#### 1.ç›´æ¥ç±»åŠ è½½æ³•\nJDKå·²ç»æä¾›äº†ä¸€å¥—å®Œå–„çš„ç±»åŠ è½½æœºåˆ¶ï¼Œå¦‚æœæä¾›è·å–Instrumentationå¯¹è±¡çš„JNIï¼Œå¼€å‘äººå‘˜å°±å¯ä»¥è‡ªè¡Œé€šè¿‡åŠ¨æ€ç±»åŠ è½½åè¿›è¡Œå­—èŠ‚ç åŠ¨æ€å¢å¼ºã€‚è¿™ä¸ªæ–¹æ¡ˆçœ‹ä¼¼å¾ˆç¾å¥½ï¼Œç°æœ‰Javaç”Ÿæ€åœˆå·²ç»æ‹¥æœ‰ä¸°å¯Œçš„ClassåŠ¨æ€åŠ è½½æ–¹æ¡ˆï¼Œåˆ©ç”¨è¿™äº›ç°æœ‰æ–¹æ¡ˆï¼Œå¼€å‘äººå‘˜èƒ½å¤Ÿå¾ˆå¿«çš„æ­å»ºå‡ºè‡ªå·±çš„å­—èŠ‚ç åŠ¨æ€åŠ è½½æœºåˆ¶ï¼Œè€Œæ— éœ€JVMæä¾›å¤§é‡çš„nativeæ”¯æŒã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆå­˜åœ¨é‡å¤§çš„å®‰å…¨é—®é¢˜ï¼Œä¸€æ—¦æœåŠ¡çš„åŠ¨æ€åŠ è½½æœºåˆ¶è¢«é»‘å®¢ç ´è§£ï¼Œé‚£ä¹ˆä»–å®Œå…¨èƒ½å¤ŸåŠ è½½ä¸€ä¸ªè‡ªå·±ç¼–å†™å¥½çš„ä¾µå…¥ç±»ï¼Œé€šè¿‡å…¥ä¾µç±»ä»»æ„ä¿®æ”¹ä¸šåŠ¡ä»£ç æœ€ç»ˆå¯¼è‡´æ— æ³•æŒ½å›çš„æŸå¤±ã€‚æ‰€ä»¥ä½œä¸ºä¸€ä¸ªJDKå¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸€å®šè¦åœ¨åˆæœŸå°±å±è”½è¿™ç§å®‰å…¨é—®é¢˜ã€‚åŒæ—¶Javaæœ€ä¸ºä¸€ç§å®‰å…¨è¯­è¨€ï¼Œä¸å®‰å…¨çš„æ“ä½œéœ€è¦å°½é‡é¿å…å¼•å…¥Javaç”Ÿæ€ä¸­ã€‚\n#### 2.Socketé€šä¿¡æ³•\næ—¢ç„¶æä¾›JNIä¸å®‰å…¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥è€ƒè™‘è®©JVMè‡ªå·±å¤„ç†ã€‚å‡è®¾æˆ‘ä»¬èƒ½å’ŒJVMå»ºç«‹èµ·Socketé€šè®¯ã€‚å¹¶å°†æˆ‘ä»¬å¸Œæœ›åŠ è½½çš„ç±»å‘ŠçŸ¥JVMï¼ŒJVMåœ¨åŠ è½½å®ŒæˆåæŒ‰ç…§çº¦å®šæ‰§è¡ŒæŒ‡å®šçš„å…¥å£æ–¹æ³•ï¼Œè¿™æ ·ä¹Ÿèƒ½å®ç°æˆ‘ä»¬å¯¹åŠ¨æ€Attachçš„å®ç°ã€‚\n\nSocketé€šä¿¡å¯ä»¥åˆ†ä¸ºè¿œç¨‹é€šä¿¡å’Œæœ¬åœ°é€šä¿¡ã€‚æˆ‘ä»¬éœ€è¦è€ƒè™‘ï¼Œå¦‚æœé‡‡ç”¨è¿œç¨‹é€šä¿¡ï¼Œçš„ç¡®èƒ½ç»™æˆ‘ä»¬å¸¦æ¥æ›´å¼ºå¤§çš„Attachçµæ´»æ€§ï¼Œä½†éœ€è¦JVMæš´éœ²ç«¯å£ï¼ŒåŒæ ·å…·æœ‰ä¸€å®šçš„å®‰å…¨é—®é¢˜ã€‚\næœ¬åœ°é€šè®¯æˆ‘ä»¬å¯ä»¥é‡‡ç”¨UNIX Domain Socketï¼Œé€šè¿‡æ–‡ä»¶å½¢å¼é€šè®¯ã€‚ä¸ä½†å…·æœ‰è¾ƒé«˜çš„é€šä¿¡é€Ÿåº¦ï¼ŒåŒæ—¶å…·æœ‰ä¸€å®šçš„å®‰å…¨æ€§ã€‚\n\nå¦‚æœé‡‡ç”¨Socket Localé€šä¿¡ï¼Œé‚£æˆ‘ä»¬åˆå¦‚ä½•ä¸JVMå»ºç«‹èµ·é€šä¿¡å‘¢ï¼Ÿ\n#### 3.ä¿¡å·ç›‘å¬æ³•\nå…¶å®è¿™ä¸ªæ–¹æ³•æ˜¯Socketé€šä¿¡æ³•çš„è¡¥å……ã€‚åœ¨ä¸JVMå»ºç«‹èµ·æœ¬åœ°é€šä¿¡å‰ï¼ŒJVMéœ€è¦çŸ¥é“ç”¨æˆ·æƒ³è¦å¼€å§‹åŠ¨æ€Attachã€‚è€Œä¿¡å·ç›‘å¬å°±èƒ½è¡¥å……è¿™æ–¹é¢çš„åŠŸèƒ½ã€‚å®¢æˆ·ç«¯ä»¥çº¦å®šçš„å½¢å¼å‘JVMè¿›ç¨‹å‘èµ·æŒ‡å®šä¿¡å·ï¼ŒåŒæ—¶JVMåœ¨ç›‘å¬åˆ°Attachä¿¡å·åä¸å®¢æˆ·ç«¯å»ºç«‹Socketé“¾æ¥ã€‚å®¢æˆ·ç«¯ä»¥Socketæ–¹å¼å°†éœ€è¦åŠ è½½çš„ç±»å‘ŠçŸ¥JVMå¹¶è¿›è¡ŒåŠ è½½å¹¶æœ€ç»ˆè¿è¡Œæˆ‘ä»¬åé¢ç†Ÿæ‚‰çš„javaagentæµç¨‹ã€‚\n\næˆ‘è™½ç„¶ä¸æ˜¯JDKçš„å·¥ç¨‹å¸ˆï¼Œä¸Šé¢çš„3ä¸ªæ–¹æ¡ˆä¹Ÿæ˜¯ç»“åˆäº†JDK1.8çš„å…·ä½“å®ç°åå¤§èƒ†çš„æ£æµ‹äº†å½“æ—¶å¼€å‘å·¥ç¨‹å¸ˆçš„æƒ³æ³•ã€‚å¯èƒ½å½“æ—¶æ‘†åœ¨ä»–é¢å‰çš„æ–¹æ¡ˆæ›´æ˜¯æˆåƒä¸Šä¸‡ï¼Œä½†æ˜¯æœ€ç»ˆç¡®å®šä¸‹è¿™ä¸ªæŠ€æœ¯æ–¹æ¡ˆçš„å¿ƒè·¯å†ç¨‹æˆ‘è§‰å¾—æ˜¯æˆ‘ä»¬æ¯ä¸ªå¼€å‘éƒ½éœ€è¦æ„ŸåŒèº«å—çš„ã€‚\n\n## ä¸‰ã€ä¸¾ä¸€ä¸ªæ —å­\nå‰é¢æˆ‘ä»¬åˆ†æäº†å®ç°æ–¹æ¡ˆï¼Œæˆ‘ä»¬å…ˆä¸¢ä¸€ä»½ä»£ç æ¥éªŒè¯ä¸Šé¢çš„æ–¹æ¡ˆï¼ˆä»£ç ä¸ºJDK1.8æºç ç›¸å…³åŠŸèƒ½çš„ç®€åŒ–ç‰ˆï¼‰\n\n### å¼€å§‹å®éªŒ\n\n<font color=blue>éœ€æ±‚ï¼š</font>å®ç°åŠ¨æ€Attach APIï¼Œæ¥æ”¶java -jar xxx.jar pidå‘èµ·çš„æŒ‚è½½è¯·æ±‚ï¼Œå¹¶å°†loadAgentæŒ‡å®šçš„JaråŒ…å®Œæ•´è·¯å¾„æ˜¾ç¤ºåœ¨æ§åˆ¶å°ã€‚\n\n<font color=blue>å®éªŒç¯å¢ƒï¼š</font>MacOS 10.15.6\n\n<font color=blue>é¡¹ç›®åœ°å€ï¼š</font>\n> https://github.com/xzenge/JVM_ATTACH/tree/dev\n\n##### æˆ‘ä»¬å…ˆå¯åŠ¨é¡¹ç›®ã€‚è¯¥é¡¹ç›®æ¨¡æ‹Ÿäº†JVMè¿è¡Œç¯å¢ƒï¼Œä½†åªå®ç°äº†Attach APIçš„éƒ¨åˆ†åŠŸèƒ½ã€‚é¡¹ç›®å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“å‰çš„JVMè¿›ç¨‹IDä¸ºï¼š<font color=red>32910</font>\n\n![01](æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/JVM_start.png)\n\n----\n\n##### æŒ‰ç…§JDKè§„èŒƒç¼–å†™JAVAæµ‹Attachæ–¹æ³•ã€‚ä¸ºäº†ç®€ä¾¿ï¼Œæ–¹æ³•ä¸­æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šäº†attachçš„çº¿ç¨‹å·ï¼Œå¹¶æä¾›äº†JVMéœ€è¦åŠ è½½çš„JaråŒ…è·¯å¾„ã€‚\n\n```java\npublic class Attach {\n    public static void main(String[] args) throws IOException, AttachNotSupportedException, AgentLoadException, AgentInitializationException {\n        VirtualMachine attach = VirtualMachine.attach(\"32910\");\n        attach.loadAgentPath(\"/Users/xiangshi/.gradle/caches/modules-2/files-2.1/cglib/cglib/3.1/1f1cb6c7a7479e0c7fd7987109e503914bebe84a/cglib-3.1.jar\");\n\n\n    }\n}\n\n```\n\n----\n##### è¿è¡ŒJava attachæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°æ¨¡æ‹Ÿçš„JVMå·²ç»è¯»å–åˆ°äº†æˆ‘ä»¬å¸Œæœ›classloaderçš„JaråŒ…\n\n![02](æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/load_agent_library.png)\n\n----\n\n### å®éªŒåˆ†æ\nå®éªŒè¿‡ç¨‹å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä¼ªé€ äº†ä¸ªJVMè¿è¡Œæ—¶ç¯å¢ƒã€‚å¹¶é€šè¿‡JAVAåŸç”Ÿçš„Attach APIæˆåŠŸçš„å®ç°äº†ä¸JVMä¹‹é—´é€šè®¯çš„åŠŸèƒ½ã€‚ä¸‹é¢æˆ‘ä»¬å¼€å§‹é€æ­¥åˆ†æå…·ä½“çš„å®ç°è¿‡ç¨‹ï¼š\n\n* ç›‘å¬signal\nåˆå§‹åŒ–OSä¿¡å·ç›‘å¬çš„ç›¸å…³æ•°æ®\n\n``` C++\n/**\n * JVMå¯åŠ¨æ—¶ç›‘å¬signal\n */\nvoid os::signal_init() {\n    //åˆå§‹åŒ–signalç›‘å¬pending_signals\n    os::signal_init_pd();\n    //åˆ›å»ºçº¿ç¨‹ç›‘å¬pending_signalsçŠ¶æ€å¹¶è¿›è¡Œç›¸åº”å¤„ç†\n    pthread_t tids;\n    int ret = pthread_create(&tids, NULL, reinterpret_cast<void *(*)(void *)>(signal_thread_entry), NULL);\n    //æ³¨å†Œsignalå¤„ç†å™¨\n    os::signal(SIGBREAK,os::user_handler());\n}\n```\n\nsigactionæ–¹æ³•æä¾›osä¿¡å·çš„ç›‘å¬å¹¶æ³¨å†Œä¿¡å·å¤„ç†å™¨ï¼Œæˆ‘ä»¬ç›‘å¬-3 SIGQUITä¿¡å·ã€‚\n\n```C++\n/**\n * æ³¨å†Œç›‘å¬ä¿¡å·&å¤„ç†å™¨\n * @param signal_number ä¿¡å·ç¼–å·\n * @param handler ä¿¡å·å¤„ç†å™¨\n * @return\n */\nvoid *os::signal(int signal_number, void *handler) {\n    struct sigaction sigAct, oldSigAct;\n\n    sigfillset(&(sigAct.sa_mask));\n    sigAct.sa_flags   = SA_RESTART|SA_SIGINFO;\n    sigAct.sa_handler = CAST_TO_FN_PTR(sa_handler_t, handler);\n\n    if (sigaction(signal_number, &sigAct, &oldSigAct)) {\n        // -1 means registration failed\n        return (void *)-1;\n    }\n\n    return CAST_FROM_FN_PTR(void*, oldSigAct.sa_handler);\n}\n```\n\nä¿¡å·å¤„ç†å™¨ä¸­ç®€å•çš„æ¨¡æ‹Ÿçš„æ”¶åˆ°ä¿¡å·çš„å¤„ç†è¿‡ç¨‹ï¼Œæ•°ç»„å¯¹åº”çš„ä¿¡å·ä½ç½®ä¸º1æ—¶ï¼Œè¯´æ˜æ”¶åˆ°äº†å¯¹åº”çš„ä¿¡å·ã€‚\n\n```C++\n/**\n * é€šè¿‡pending_signalsä¿ç•™ç›‘å¬åˆ°çš„ä¿¡æ¯ï¼Œäº¤ç”±ä¸“é—¨çš„çº¿ç¨‹å¤„ç†è¯¥ä¿¡æ¯\n * @param signal_number\n */\nvoid os::signal_notify(int signal_number) {\n    cout << \"enter signal_notify sig:\" << signal_number << endl;\n    //å°†ç›‘å¬åˆ°çš„ä¿¡å·ä¸ºç«–ä¸º1\n    //æ”¹æ“ä½œåº”è¯¥ä¸ºåŸå­æ“ä½œï¼Œç¡®ä¿ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹\n    //JVMä¸­æ··ç¼–å¹³å°ç›¸å…³æ±‡ç¼–æŒ‡ä»¤å®ç°åŸå­æ“ä½œï¼Œæ¼”ç¤ºä»£ç ä¸­ä¸ç ”ç©¶ç›¸å…³å®ç°\n    pending_signals[signal_number] = 1;\n\n    semaphore_signal(sig_sem);\n}\n```\n\nå•ç‹¬èµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹è½®è®­ä¿¡å·æ¥å—æ•°ç»„çš„çŠ¶æ€ï¼Œå°†ç½®ä¸º1çš„ä¿¡å·ç ä¼ ç»™ä¸‹æ¸¸å¤„ç†ã€‚å½“ä¿¡å·ä½-3 SIGQUITä¿¡å·æ—¶ï¼Œå¼€å§‹åˆå§‹åŒ–attachçš„ç›‘å¬æ–¹æ³•ã€‚\n\n```C++\n/**\n * å•ç‹¬çº¿ç¨‹å¯¹pending_signalsçŠ¶æ€å¹¶è¿›è¡Œç›¸åº”å¤„ç†\n */\nstatic void signal_thread_entry() {\n    cout << \"enter signal_thread_entry\" << endl;\n    while (true){\n        int sig;\n        {\n            sig = os::signal_wait();\n        }\n        switch (sig) {\n            case SIGBREAK: {\n                if (AttachListener::init()) {\n                    continue;\n                }\n            }\n        }\n\n    }\n}\n```\n\nåˆå§‹åŒ–attachç›‘å¬æ–¹æ³•æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªDomain Socketçš„æ–‡ä»¶ç›‘å¬ï¼Œå¹¶acceptåœ¨æ”¹æ–‡ä»¶ä¸Šã€‚\n\n```C++\n/**\n * åˆå§‹åŒ–domain socketç›‘å¬\n * JVMé€šè¿‡ç›‘å¬æŒ‡å®šçº¿ç¨‹æ–‡ä»¶æ–‡ä»¶\n * è·å–clientæƒ³JVMå‘é€çš„æŒ‡ä»¤å¹¶è¿›è¡Œç›¸å…³æ“ä½œ\n * @return\n */\nint AttachListener::pd_init() {\n    char path[UNIX_PATH_MAX];          // socket file\n    char initial_path[UNIX_PATH_MAX];  // socket file during setup\n    int listener;                      // listener socket (file descriptor)\n\n    // register function to cleanup\n    ::atexit(listener_cleanup);\n\n    int n = snprintf(path, UNIX_PATH_MAX, \"%s/.java_pid%d\",\n                     TEMP_PATH, getpid());\n    if (n < (int) UNIX_PATH_MAX) {\n        n = snprintf(initial_path, UNIX_PATH_MAX, \"%s.tmp\", path);\n    }\n    if (n >= (int) UNIX_PATH_MAX) {\n        return -1;\n    }\n    cout << \"path:\" << path << endl;\n    // create the listener socket\n    listener = ::socket(PF_UNIX, SOCK_STREAM, 0);\n    if (listener == -1) {\n        return -1;\n    }\n\n    // bind socket\n    struct sockaddr_un addr;\n    addr.sun_family = AF_UNIX;\n    strcpy(addr.sun_path, initial_path);\n    ::unlink(initial_path);\n    int res = ::bind(listener, (struct sockaddr *) &addr, sizeof(addr));\n    if (res == -1) {\n        ::close(listener);\n        return -1;\n    }\n\n    // put in listen mode, set permissions, and rename into place\n    res = ::listen(listener, 5);\n    if (res == 0) {\n        RESTARTABLE(::chmod(initial_path, S_IREAD | S_IWRITE), res);\n        if (res == 0) {\n            if (res == 0) {\n                res = ::rename(initial_path, path);\n            }\n        }\n    }\n    if (res == -1) {\n        ::close(listener);\n        ::unlink(initial_path);\n        return -1;\n    }\n    set_path(path);\n    set_listener(listener);\n\n    return 0;\n}\n```\n\nä¸€æ—¦æ”¶åˆ°javaå‘é€è¿‡æ¥çš„socketè¯·æ±‚ï¼Œåˆ™è§£æè¯¥è¯·æ±‚å¹¶åŒ…è£…ä¸ºAttachOperationå¯¹è±¡ã€‚\n\n```C++\n/**\n * accept domain socketï¼Œè¯»å–åˆ°å†…å®¹åç”Ÿæˆå¯¹åº”çš„AttachOperation\n * @return\n */\nAttachOperation *AttachListener::dequeue() {\n    for (;;) {\n        int s;\n\n        // wait for client to connect\n        struct sockaddr addr;\n        socklen_t len = sizeof(addr);\n        RESTARTABLE(::accept(listener(), &addr, &len), s);\n        if (s == -1) {\n            return NULL;      // log a warning?\n        }\n\n        // get the credentials of the peer and check the effective uid/guid\n        // - check with jeff on this.\n        uid_t puid;\n        gid_t pgid;\n        if (::getpeereid(s, &puid, &pgid) != 0) {\n            ::close(s);\n            continue;\n        }\n        uid_t euid = geteuid();\n        gid_t egid = getegid();\n\n        //æ£€æŸ¥DSæ–‡ä»¶æ˜¯å¦ä¸ºåŒä¸€ä¸ªç”¨æˆ·åˆ›å»º\n        if (puid != euid || pgid != egid) {\n            ::close(s);\n            continue;\n        }\n\n        // è¯»å–æ–‡ä»¶å†…å®¹ï¼Œç”ŸæˆAttachOperationå¯¹è±¡\n        AttachOperation *op = read_request(s);\n        if (op == NULL) {\n            ::close(s);\n            continue;\n        } else {\n            return op;\n        }\n    }\n}\n```\n\næœ€åç”¨åŒ…è£…åçš„AttachOperationï¼Œé€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å·²ç»‘å®šçš„å¤„ç†å‡½æ•°ã€‚\n\n```C++\nstatic void attach_listener_thread_entry() {\n    int pdint = AttachListener::pd_init();\n    if (pdint != 0) {\n        return;\n    }\n    AttachListener::set_initialized();\n\n    for (;;) {\n        AttachOperation* op = AttachListener::dequeue();\n        if (op == NULL) {\n            return;   // dequeue failed or shutdown\n        }\n\n        // find the function to dispatch too\n        AttachOperationFunctionInfo* info = NULL;\n        for (int i=0; funcs[i].name != NULL; i++) {\n            const char* name = funcs[i].name;\n            if (strcmp(op->name(), name) == 0) {\n                info = &(funcs[i]);\n                break;\n            }\n        }\n\n        if (info != NULL) {\n            // dispatch to the function that implements this operation\n            (info->func)(op);\n        }\n    }\n}\n```\n\n<font color=red>æ€»ç»“</font> ï¼Œé€šè¿‡ä¿¡å·ç›‘å¬-->socketé€šä¿¡-->è°ƒç”¨æŒ‡å®šæ–¹æ³•çš„æµç¨‹ï¼Œå®ç°äº†æˆ‘ä»¬å®éªŒçš„é¢„æœŸã€‚\n\n## å››ã€çœ‹çœ‹JVMæ˜¯æ€ä¹ˆåšçš„\næœ€åæˆ‘ä»¬å›åˆ°JVMå†…éƒ¨ï¼Œçœ‹çœ‹JVMæ˜¯å¦‚ä½•å®ç°çš„ã€‚\n\nç”±äºå®éªŒä»£ç å¤§é‡çš„é‡‡ç”¨äº†JVMçš„å®ç°ï¼Œæˆ‘ä»¬è¿™é‡Œä¸»è¦è§‚å¯ŸJVMçš„æµç¨‹ã€‚\n\n* JVMå¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–ä¿¡å·çš„ç›‘å¬\n\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/thread.cpp\n\n```C++\njint Threads::create_vm(JavaVMInitArgs* args, bool* canTryAgain) {\n    ...\n\n  // Signal Dispatcher needs to be started before VMInit event is posted\n  os::signal_init();\n\n  // Start Attach Listener if +StartAttachListener or it can't be started lazily\n  if (!DisableAttachMechanism) {\n    AttachListener::vm_start();\n    if (StartAttachListener || AttachListener::init_at_startup()) {\n      AttachListener::init();\n    }\n  }\n    ...\n}\n```\n\nos::signal_init();åŠŸèƒ½æˆ‘ä»¬å‰é¢å·²ç»åˆ†æè¿‡ï¼ŒJVMä¼šæ³¨å†Œkill -3ä¿¡å·çš„ç›‘å¬å’Œå¯¹åº”çš„ä¿¡å·å¤„ç†å™¨ï¼ŒåŒæ—¶ä¼šå¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¯¹ç›‘å¬åˆ°çš„ä¿¡å·åšåç»­ä¸šåŠ¡å¤„ç†ã€‚\n\n<font color=blue>DisableAttachMechanism</font> & <font color=blue>StartAttachListener</font> é»˜è®¤ä¸ºfalseï¼Œåœ¨JVMé»˜è®¤å¯åŠ¨çš„æƒ…å†µä¸‹ä¸ä¼šåˆå§‹åŒ–Attachçš„ç›‘å¬ã€‚\n\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/globals.hpp\n\n```C+++\n  product(bool, DisableAttachMechanism, false,                              \\\n          \"Disable mechanism that allows tools to attach to this VM\") \n  product(bool, StartAttachListener, false,                                 \\\n          \"Always start Attach Listener at VM startup\")      \n```\n\nJVMç›‘å¬åˆ°ä¿¡å·åï¼Œå½“ä¿¡å·ä½kill -3æ—¶å¦‚æœè¿˜æœªåˆå§‹åŒ–attachç›‘å¬ï¼Œå°†ä¼šè¿›è¡Œç›¸åº”åˆå§‹åŒ–è¿‡ç¨‹ã€‚\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/thread.cpp->create_vm()\n>             ---- src/share/vm/runtime/os.cpp->signal_init()\n>                 ---- src/share/vm/runtime/os.cpp->signal_thread_entry()\n\n\n```C++\nstatic void signal_thread_entry(JavaThread* thread, TRAPS) {\n  os::set_priority(thread, NearMaxPriority);\n  while (true) {\n    int sig;\n    {\n      // FIXME : Currently we have not decieded what should be the status\n      //         for this java thread blocked here. Once we decide about\n      //         that we should fix this.\n      sig = os::signal_wait();\n    }\n    if (sig == os::sigexitnum_pd()) {\n       // Terminate the signal thread\n       return;\n    }\n\n    switch (sig) {\n      case SIGBREAK: {\n        // Check if the signal is a trigger to start the Attach Listener - in that\n        // case don't print stack traces.\n        if (!DisableAttachMechanism && AttachListener::is_init_trigger()) {\n          continue;\n        }\n        // Print stack traces\n        // Any SIGBREAK operations added here should make sure to flush\n        // the output stream (e.g. tty->flush()) after output.  See 4803766.\n        // Each module also prints an extra carriage return after its output.\n        VM_PrintThreads op;\n        VMThread::execute(&op);\n        VM_PrintJNI jni_op;\n        VMThread::execute(&jni_op);\n        VM_FindDeadlocks op1(tty);\n        VMThread::execute(&op1);\n        Universe::print_heap_at_SIGBREAK();\n        if (PrintClassHistogram) {\n          VM_GC_HeapInspection op1(gclog_or_tty, true /* force full GC before heap inspection */);\n          VMThread::execute(&op1);\n        }\n        if (JvmtiExport::should_post_data_dump()) {\n          JvmtiExport::post_data_dump();\n        }\n        break;\n      }\n      ...\n  }\n}\n```\n\nåˆå§‹åŒ–Attachç›‘å¬æ—¶ä¼šæ£€æŸ¥Javaå®¢æˆ·ç«¯ç”Ÿæˆçš„attachæ–‡ä»¶ã€‚\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/thread.cpp->create_vm()\n>             ---- src/share/vm/runtime/os.cpp->signal_init()\n>                 ---- src/share/vm/runtime/os.cpp->signal_thread_entry()\n>                      ---- src/os/bsd/vm/attachListener_bsd.cpp->is_init_trigger()\n\n\n```C++\nbool AttachListener::is_init_trigger() {\n  if (init_at_startup() || is_initialized()) {\n    return false;               // initialized at startup or already initialized\n  }\n  char path[PATH_MAX + 1];\n  int ret;\n  struct stat st;\n\n  snprintf(path, PATH_MAX + 1, \"%s/.attach_pid%d\",\n           os::get_temp_directory(), os::current_process_id());\n  RESTARTABLE(::stat(path, &st), ret);\n  if (ret == 0) {\n    // simple check to avoid starting the attach mechanism when\n    // a bogus user creates the file\n    if (st.st_uid == geteuid()) {\n      init();\n      return true;\n    }\n  }\n  return false;\n}\n```\n\nç¡®è®¤Javaå®¢æˆ·ç«¯å¼€å§‹attachå¹¶ä¸”æƒé™æ ¡éªŒé€šè¿‡åå¼€å§‹socketé€šè®¯ï¼Œé¦–å…ˆåˆå§‹åŒ–socketå¹¶ç»‘å®šç›‘å¬ã€‚\n>ä»£ç æ¸…å•ï¼š src/os/bsd/vm/attachListener_bsd.cpp->is_init_trigger()\n>             ---- src/share/vm/services/attachListener.cpp->init()\n\n\n```C++\nbool AttachListener::is_init_trigger() {\n  if (init_at_startup() || is_initialized()) {\n    return false;               // initialized at startup or already initialized\n  }\n  char path[PATH_MAX + 1];\n  int ret;\n  struct stat st;\n\n  snprintf(path, PATH_MAX + 1, \"%s/.attach_pid%d\",\n           os::get_temp_directory(), os::current_process_id());\n  RESTARTABLE(::stat(path, &st), ret);\n  if (ret == 0) {\n    // simple check to avoid starting the attach mechanism when\n    // a bogus user creates the file\n    if (st.st_uid == geteuid()) {\n      init();\n      return true;\n    }\n  }\n  return false;\n}\n```\n\næœ€ç»ˆJVMåˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ‰§è¡ŒAttachç›‘å¬æ–¹æ³•ï¼Œæ–¹æ³•acceptä»Javaå®¢æˆ·ç«¯å‘é€çš„æŒ‡ä»¤ï¼Œå¹¶è§£æä¸ºå¯¹åº”çš„å‡½æ•°ã€‚\n>ä»£ç æ¸…å•ï¼š src/share/vm/services/attachListener.cpp->init()\n>             ---- src/share/vm/services/attachListener.cpp->attach_listener_thread_entry()\n\n\n```C++\nstatic void attach_listener_thread_entry(JavaThread* thread, TRAPS) {\n  os::set_priority(thread, NearMaxPriority);\n\n  thread->record_stack_base_and_size();\n\n  if (AttachListener::pd_init() != 0) {\n    return;\n  }\n  AttachListener::set_initialized();\n\n  for (;;) {\n    AttachOperation* op = AttachListener::dequeue();\n    if (op == NULL) {\n      return;   // dequeue failed or shutdown\n    }\n\n    ResourceMark rm;\n    bufferedStream st;\n    jint res = JNI_OK;\n\n    // handle special detachall operation\n    if (strcmp(op->name(), AttachOperation::detachall_operation_name()) == 0) {\n      AttachListener::detachall();\n    } else {\n      // find the function to dispatch too\n      AttachOperationFunctionInfo* info = NULL;\n      for (int i=0; funcs[i].name != NULL; i++) {\n        const char* name = funcs[i].name;\n        assert(strlen(name) <= AttachOperation::name_length_max, \"operation <= name_length_max\");\n        if (strcmp(op->name(), name) == 0) {\n          info = &(funcs[i]);\n          break;\n        }\n      }\n\n      // check for platform dependent attach operation\n      if (info == NULL) {\n        info = AttachListener::pd_find_operation(op->name());\n      }\n\n      if (info != NULL) {\n        // dispatch to the function that implements this operation\n        res = (info->func)(op, &st);\n      } else {\n        st.print(\"Operation %s not recognized!\", op->name());\n        res = JNI_ERR;\n      }\n    }\n\n    // operation complete - send result and output to client\n    op->complete(res, &st);\n  }\n}\n```\n\n>ä»£ç æ¸…å•ï¼š src/share/vm/services/attachListener.cpp->attach_listener_thread_entry()\n>             ---- src/os/bsd/vm/attachListener_bsd.cpp->dequeue()\n>                  ---- src/os/bsd/vm/attachListener_bsd.cpp->BsdAttachListener::dequeue()\n\n\n```C++\nBsdAttachOperation* BsdAttachListener::dequeue() {\n  for (;;) {\n    int s;\n\n    // wait for client to connect\n    struct sockaddr addr;\n    socklen_t len = sizeof(addr);\n    RESTARTABLE(::accept(listener(), &addr, &len), s);\n    if (s == -1) {\n      return NULL;      // log a warning?\n    }\n\n    // get the credentials of the peer and check the effective uid/guid\n    // - check with jeff on this.\n    uid_t puid;\n    gid_t pgid;\n    if (::getpeereid(s, &puid, &pgid) != 0) {\n      ::close(s);\n      continue;\n    }\n    uid_t euid = geteuid();\n    gid_t egid = getegid();\n\n    if (puid != euid || pgid != egid) {\n      ::close(s);\n      continue;\n    }\n\n    // peer credential look okay so we read the request\n    BsdAttachOperation* op = read_request(s);\n    if (op == NULL) {\n      ::close(s);\n      continue;\n    } else {\n      return op;\n    }\n  }\n}\n```\n\næŒ‡ä»¤ä¸æ–¹æ³•çš„æ˜ å°„æ˜¯äº‹å…ˆå‡†å¤‡å¥½çš„\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/services/attachListener.cpp\n```C++\nstatic AttachOperationFunctionInfo funcs[] = {\n  { \"agentProperties\",  get_agent_properties },\n  { \"datadump\",         data_dump },\n  { \"dumpheap\",         dump_heap },\n  { \"load\",             JvmtiExport::load_agent_library },\n  { \"properties\",       get_system_properties },\n  { \"threaddump\",       thread_dump },\n  { \"inspectheap\",      heap_inspection },\n  { \"setflag\",          set_flag },\n  { \"printflag\",        print_flag },\n  { \"jcmd\",             jcmd },\n  { NULL,               NULL }\n};\n```\n\n\n<font color=red>æ€»ç»“</font>,ç›¸ä¿¡é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å·²ç»æ¸…æ¥šçš„äº†è§£JVMæ˜¯å¦‚ä½•æ¥æ”¶åˆ°Javaå®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œä»è€Œå®ç°åŠ¨æ€Attachçš„åŠŸèƒ½ã€‚å…·ä½“æµç¨‹å¦‚å›¾ï¼š\n![03](æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/flow.png)","source":"_posts/æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†.md","raw":"---\ntitle: æ·±åº¦å‰–æJVM åŠ¨æ€AttachåŸç†\ndate: 2020-09-21 19:01:04\ntags:\n    - Java\n    - JVM\ncategories:\n    - Technology\n---\n\nç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´éƒ½ä½¿ç”¨è¿‡javaagentæ¢é’ˆæŠ€æœ¯ï¼Œjavaagentå¯ä»¥åœ¨ä¸ä¾µå…¥åŸä»£ç ä¸çš„å‰æä¸‹ï¼Œé€šè¿‡æŒ‡å®šæ–¹æ³•å¹¶åˆ©ç”¨åŠ¨æ€å­—èŠ‚ç æŠ€æœ¯å¢å¼ºæˆ‘ä»¬çš„ä»£ç ã€‚å¾ˆå¤šæˆç†Ÿçš„æ¡†æ¶ä¹Ÿè¿ç”¨åˆ°äº†è¯¥æŠ€æœ¯ï¼Œå¦‚skywalkingç­‰ã€‚è¿™ä¹ˆå¥½ç”¨çš„åŠŸèƒ½ï¼ŒJDKçš„å¼€å‘äººå‘˜æ²¡é“ç†ä¸ç©å‡ºäº›æ–°èŠ±å¤´ï¼Œå› æ­¤åœ¨JDK1.6ä¸­ï¼Œæ›´åŠ å¼ºå¤§çš„JVM åŠ¨æ€AttachæŠ€æœ¯å±•ç°åœ¨æˆ‘ä»¬çš„é¢å‰ã€‚å¤§åé¼é¼çš„Btraceã€Arthasç­‰éƒ½è¿ç”¨äº†åŠ¨æ€AttachæŠ€æœ¯ã€‚åœ¨JVMè¿è¡ŒæœŸè¿›æ‹¦æˆªå¹¶å¢å¼ºæˆ‘ä»¬çš„ä»£ç ï¼Œä½¿å¾—ä»¥å¾€ç”Ÿäº§éš¾ä»¥å®šä½çš„é—®é¢˜å˜å¾—æ›´åŠ å®¹æ˜“æ’æŸ¥ã€‚\n<!-- more -->\nJVMçš„åŠ¨æ€Attachå›ºç„¶å¥½ï¼Œç›¸ä¿¡å¤§å®¶æˆ–å¤šæˆ–å°‘å·²ç»çŸ¥é“å¦‚ä½•å»ä½¿ç”¨è¯¥æŠ€æœ¯äº†ï¼Œæ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬ç ”ç©¶çš„é‡ç‚¹æ˜¯JVMæ˜¯å¦‚ä½•å®ç°åŠ¨æ€Attachï¼Œè‡³äºJVMå¦‚ä½•åŠ è½½åŠ¨æ€JaråŒ…ã€åˆ†å‘æ–¹æ³•å¹¶ä¼ é€’jvmä¸Šä¸‹æ–‡å°±ä¸åœ¨æˆ‘ä»¬çš„ç ”ç©¶èŒƒå›´ä¹‹å†…ã€‚\n\nä¸ºäº†æ›´å¥½çš„ç ”ç©¶JVMçš„å®ç°ï¼Œæˆ‘ä»¬å°†ç”±æµ…å…¥æ·±ï¼Œåˆ†ä¸ºå‡ ä¸ªé˜¶æ®µè¿›è¡Œç ”ç©¶ï¼š\n* åŠ¨æ€Attachæ˜¯ä»€ä¹ˆï¼Ÿ\n* æœ‰å‡ ç§æ–¹æ¡ˆå¯ä»¥å®ç°åŠ¨æ€Attach\n* ä¸¾ä¸€ä¸ªæ —å­\n* çœ‹çœ‹JVMæ˜¯æ€ä¹ˆåšçš„\n\n## ä¸€ã€åŠ¨æ€Attachæ˜¯ä»€ä¹ˆ\nè™½ç„¶æˆ‘ä»¬è¿™æ¬¡ç ”ç©¶çš„æ˜¯å…·ä½“çš„å®ç°ï¼Œä½†åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åƒåˆ†æéœ€æ±‚ä¸€æ ·åˆ†æä¸‹åŠ¨æ€Attachåˆ°åº•æ˜¯ä»€ä¹ˆã€‚\n\næˆ‘ä»¬éƒ½çŸ¥é“javaagentå‚æ•°æ˜¯ä¼´éšç€javaå‘½ä»¤ï¼Œåœ¨JVMå¯åŠ¨çš„è¿‡ç¨‹ä¸­åŠ è½½javaagentå‚æ•°æŒ‡å®šçš„JaråŒ…è·¯å¾„ï¼Œå¹¶æ‰§è¡Œçº¦å®šç±»çš„premainæ–¹æ³•ã€‚åœ¨premainæ–¹æ³•ä¸­å¯ä»¥è·å–Instrumentationç±»å‹å‚æ•°ï¼Œä»è€Œå¯¹æˆ‘ä»¬çš„ç±»è¿›è¡ŒåŠ¨æ€å¢å¼ºå¢å¼ºã€‚\n\næˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨javaagentï¼š\n1. å…ˆå®ç°ä¸€ä¸ªæˆ‘ä»¬éœ€è¦æŒ‚åœ¨çš„ç±»ï¼Œå…¶ä¸­éœ€è¦å®ç°premain()æ–¹æ³•ï¼Œå¹¶å°†å®ƒæ‰“åŒ…ä¸ºå¯æ‰§è¡ŒJaråŒ…\n``` java\npublic class Javaagent {\n    public static void premain(String agentArgs, Instrumentation inst) {\n        System.out.println(\"agentArgs : \" + agentArgs);\n        inst.addTransformer(new TestTransformer(), true);\n    }\n\n    static class TestTransformer implements ClassFileTransformer {\n\n        @Override\n        public byte[] transform(ClassLoader loader, String className, Class<?> classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException {\n            System.out.println(\"premain load Class:\" + className);\n            return classfileBuffer;\n        }\n    }\n}\n```\n\n2. é…ç½®MANIFEST.MFé…ç½®æ–‡ä»¶\n```xml\nPremain-Class: Javaagent\nAgent-Class: Javaagent\nCan-Redefine-Classes: true\nCan-Retransform-Classes: true\n```\n\n3. å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡\n```shell\njava -javaagent:Javaagent.jar è‡ªå·±çš„æœåŠ¡.jar\n```\n\nä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„javaagentè¿ç”¨åœºæ™¯ã€‚javaagentå¯ä»¥åœ¨ä¸ä¾µå…¥ä¸šåŠ¡ä»£ç çš„å‰æä¸‹ä¿®æ”¹æˆ‘ä»¬å·²åŠ è½½çš„ç±»ï¼Œä½†å”¯ä¸€çš„é—®é¢˜æ˜¯éœ€è¦ä¼´éšç€ä¸šåŠ¡æœåŠ¡ä¸€åŒå¯åŠ¨ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ— æ³•ä¾µå…¥å·²ç»è¿è¡Œåœ¨JVMä¸­çš„ä»£ç ï¼Œå› æ­¤JDKå¼€å‘çš„å¤§ç¥ä»¬ä¸ºæˆ‘ä»¬å¸¦æ¥äº†åŠ¨æ€Attach APIã€‚å…¶åŠŸèƒ½ä¸javaagentæ˜¯ä¸€æ ·çš„ï¼Œä½†æœ€å¤§çš„å¥½å¤„å°±æ˜¯æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€ä¸ªå·²ç»è¿è¡Œçš„JVMä¸ŠåŠ¨æ€çš„æŒ‚è½½ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±å¼€å‘çš„JaråŒ…ï¼Œä»è€Œå®ç°ä»»ä½•æ—¶é—´ç‚¹æˆ‘ä»¬éƒ½èƒ½æ‰‹åŠ¨çš„å¢å¼ºä¸šåŠ¡ä»£ç ã€‚æ¯”å¦‚é€šè¿‡attach Arthasï¼Œæˆ‘ä»¬èƒ½å¢å¼ºæŒ‡å®šæ–¹æ³•çš„å…¥å£&å‡ºå£ï¼Œä»è€Œè·å–å‡ºå…¥å‚çš„ç›¸å…³ä¿¡æ¯ã€‚è¿™åœ¨ç¼ºå°‘æ—¥å¿—è¾“å‡ºçš„åœºæ™¯ä¸‹æ˜¯éå¸¸æœ‰æ•ˆçš„é—®é¢˜å®šä½æ‰‹æ®µã€‚æ­¤å¤–æˆ‘ä»¬ä¹Ÿèƒ½ä¸ºæ–¹æ³•çš„è°ƒç”¨é“¾åšåŸ‹ç‚¹ï¼Œå¸®åŠ©æˆ‘ä»¬åˆ†æä¸šåŠ¡æµç¨‹ä¸­çš„æ…¢æ–¹æ³•ç­‰ç­‰ã€‚\n\næ€»ç»“ä¸‹ï¼ŒåŠ¨æ€Attachå°±æ˜¯JVMè¿è¡ŒæœŸä¸­æä¾›çš„æŒ‡å®šç±»å‹çš„ç±»åŠ è½½æœºåˆ¶ã€‚é€šè¿‡å¢å¼ºç±»çš„åŠ è½½ï¼Œå®ç°å„å¼å„æ ·æœ‰è¶£çš„åŠŸèƒ½ã€‚\n\n## äºŒã€æœ‰å‡ ç§æ–¹æ¡ˆå¯ä»¥å®ç°åŠ¨æ€Attach\nç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“ä»€ä¹ˆæ˜¯åŠ¨æ€Attachäº†ï¼Œå€˜è‹¥æˆ‘ä»¬æ˜¯JDKçš„å·¥ç¨‹å¸ˆï¼Œå½“äº§å“äº¤ç»™æˆ‘ä»¬éœ€è¦å®ç°åŠ¨æ€Attachè¿™ä¸ªéœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬ä¼šæ€ä¹ˆå®ç°å‘¢ï¼Ÿ\n#### 1.ç›´æ¥ç±»åŠ è½½æ³•\nJDKå·²ç»æä¾›äº†ä¸€å¥—å®Œå–„çš„ç±»åŠ è½½æœºåˆ¶ï¼Œå¦‚æœæä¾›è·å–Instrumentationå¯¹è±¡çš„JNIï¼Œå¼€å‘äººå‘˜å°±å¯ä»¥è‡ªè¡Œé€šè¿‡åŠ¨æ€ç±»åŠ è½½åè¿›è¡Œå­—èŠ‚ç åŠ¨æ€å¢å¼ºã€‚è¿™ä¸ªæ–¹æ¡ˆçœ‹ä¼¼å¾ˆç¾å¥½ï¼Œç°æœ‰Javaç”Ÿæ€åœˆå·²ç»æ‹¥æœ‰ä¸°å¯Œçš„ClassåŠ¨æ€åŠ è½½æ–¹æ¡ˆï¼Œåˆ©ç”¨è¿™äº›ç°æœ‰æ–¹æ¡ˆï¼Œå¼€å‘äººå‘˜èƒ½å¤Ÿå¾ˆå¿«çš„æ­å»ºå‡ºè‡ªå·±çš„å­—èŠ‚ç åŠ¨æ€åŠ è½½æœºåˆ¶ï¼Œè€Œæ— éœ€JVMæä¾›å¤§é‡çš„nativeæ”¯æŒã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆå­˜åœ¨é‡å¤§çš„å®‰å…¨é—®é¢˜ï¼Œä¸€æ—¦æœåŠ¡çš„åŠ¨æ€åŠ è½½æœºåˆ¶è¢«é»‘å®¢ç ´è§£ï¼Œé‚£ä¹ˆä»–å®Œå…¨èƒ½å¤ŸåŠ è½½ä¸€ä¸ªè‡ªå·±ç¼–å†™å¥½çš„ä¾µå…¥ç±»ï¼Œé€šè¿‡å…¥ä¾µç±»ä»»æ„ä¿®æ”¹ä¸šåŠ¡ä»£ç æœ€ç»ˆå¯¼è‡´æ— æ³•æŒ½å›çš„æŸå¤±ã€‚æ‰€ä»¥ä½œä¸ºä¸€ä¸ªJDKå¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸€å®šè¦åœ¨åˆæœŸå°±å±è”½è¿™ç§å®‰å…¨é—®é¢˜ã€‚åŒæ—¶Javaæœ€ä¸ºä¸€ç§å®‰å…¨è¯­è¨€ï¼Œä¸å®‰å…¨çš„æ“ä½œéœ€è¦å°½é‡é¿å…å¼•å…¥Javaç”Ÿæ€ä¸­ã€‚\n#### 2.Socketé€šä¿¡æ³•\næ—¢ç„¶æä¾›JNIä¸å®‰å…¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥è€ƒè™‘è®©JVMè‡ªå·±å¤„ç†ã€‚å‡è®¾æˆ‘ä»¬èƒ½å’ŒJVMå»ºç«‹èµ·Socketé€šè®¯ã€‚å¹¶å°†æˆ‘ä»¬å¸Œæœ›åŠ è½½çš„ç±»å‘ŠçŸ¥JVMï¼ŒJVMåœ¨åŠ è½½å®ŒæˆåæŒ‰ç…§çº¦å®šæ‰§è¡ŒæŒ‡å®šçš„å…¥å£æ–¹æ³•ï¼Œè¿™æ ·ä¹Ÿèƒ½å®ç°æˆ‘ä»¬å¯¹åŠ¨æ€Attachçš„å®ç°ã€‚\n\nSocketé€šä¿¡å¯ä»¥åˆ†ä¸ºè¿œç¨‹é€šä¿¡å’Œæœ¬åœ°é€šä¿¡ã€‚æˆ‘ä»¬éœ€è¦è€ƒè™‘ï¼Œå¦‚æœé‡‡ç”¨è¿œç¨‹é€šä¿¡ï¼Œçš„ç¡®èƒ½ç»™æˆ‘ä»¬å¸¦æ¥æ›´å¼ºå¤§çš„Attachçµæ´»æ€§ï¼Œä½†éœ€è¦JVMæš´éœ²ç«¯å£ï¼ŒåŒæ ·å…·æœ‰ä¸€å®šçš„å®‰å…¨é—®é¢˜ã€‚\næœ¬åœ°é€šè®¯æˆ‘ä»¬å¯ä»¥é‡‡ç”¨UNIX Domain Socketï¼Œé€šè¿‡æ–‡ä»¶å½¢å¼é€šè®¯ã€‚ä¸ä½†å…·æœ‰è¾ƒé«˜çš„é€šä¿¡é€Ÿåº¦ï¼ŒåŒæ—¶å…·æœ‰ä¸€å®šçš„å®‰å…¨æ€§ã€‚\n\nå¦‚æœé‡‡ç”¨Socket Localé€šä¿¡ï¼Œé‚£æˆ‘ä»¬åˆå¦‚ä½•ä¸JVMå»ºç«‹èµ·é€šä¿¡å‘¢ï¼Ÿ\n#### 3.ä¿¡å·ç›‘å¬æ³•\nå…¶å®è¿™ä¸ªæ–¹æ³•æ˜¯Socketé€šä¿¡æ³•çš„è¡¥å……ã€‚åœ¨ä¸JVMå»ºç«‹èµ·æœ¬åœ°é€šä¿¡å‰ï¼ŒJVMéœ€è¦çŸ¥é“ç”¨æˆ·æƒ³è¦å¼€å§‹åŠ¨æ€Attachã€‚è€Œä¿¡å·ç›‘å¬å°±èƒ½è¡¥å……è¿™æ–¹é¢çš„åŠŸèƒ½ã€‚å®¢æˆ·ç«¯ä»¥çº¦å®šçš„å½¢å¼å‘JVMè¿›ç¨‹å‘èµ·æŒ‡å®šä¿¡å·ï¼ŒåŒæ—¶JVMåœ¨ç›‘å¬åˆ°Attachä¿¡å·åä¸å®¢æˆ·ç«¯å»ºç«‹Socketé“¾æ¥ã€‚å®¢æˆ·ç«¯ä»¥Socketæ–¹å¼å°†éœ€è¦åŠ è½½çš„ç±»å‘ŠçŸ¥JVMå¹¶è¿›è¡ŒåŠ è½½å¹¶æœ€ç»ˆè¿è¡Œæˆ‘ä»¬åé¢ç†Ÿæ‚‰çš„javaagentæµç¨‹ã€‚\n\næˆ‘è™½ç„¶ä¸æ˜¯JDKçš„å·¥ç¨‹å¸ˆï¼Œä¸Šé¢çš„3ä¸ªæ–¹æ¡ˆä¹Ÿæ˜¯ç»“åˆäº†JDK1.8çš„å…·ä½“å®ç°åå¤§èƒ†çš„æ£æµ‹äº†å½“æ—¶å¼€å‘å·¥ç¨‹å¸ˆçš„æƒ³æ³•ã€‚å¯èƒ½å½“æ—¶æ‘†åœ¨ä»–é¢å‰çš„æ–¹æ¡ˆæ›´æ˜¯æˆåƒä¸Šä¸‡ï¼Œä½†æ˜¯æœ€ç»ˆç¡®å®šä¸‹è¿™ä¸ªæŠ€æœ¯æ–¹æ¡ˆçš„å¿ƒè·¯å†ç¨‹æˆ‘è§‰å¾—æ˜¯æˆ‘ä»¬æ¯ä¸ªå¼€å‘éƒ½éœ€è¦æ„ŸåŒèº«å—çš„ã€‚\n\n## ä¸‰ã€ä¸¾ä¸€ä¸ªæ —å­\nå‰é¢æˆ‘ä»¬åˆ†æäº†å®ç°æ–¹æ¡ˆï¼Œæˆ‘ä»¬å…ˆä¸¢ä¸€ä»½ä»£ç æ¥éªŒè¯ä¸Šé¢çš„æ–¹æ¡ˆï¼ˆä»£ç ä¸ºJDK1.8æºç ç›¸å…³åŠŸèƒ½çš„ç®€åŒ–ç‰ˆï¼‰\n\n### å¼€å§‹å®éªŒ\n\n<font color=blue>éœ€æ±‚ï¼š</font>å®ç°åŠ¨æ€Attach APIï¼Œæ¥æ”¶java -jar xxx.jar pidå‘èµ·çš„æŒ‚è½½è¯·æ±‚ï¼Œå¹¶å°†loadAgentæŒ‡å®šçš„JaråŒ…å®Œæ•´è·¯å¾„æ˜¾ç¤ºåœ¨æ§åˆ¶å°ã€‚\n\n<font color=blue>å®éªŒç¯å¢ƒï¼š</font>MacOS 10.15.6\n\n<font color=blue>é¡¹ç›®åœ°å€ï¼š</font>\n> https://github.com/xzenge/JVM_ATTACH/tree/dev\n\n##### æˆ‘ä»¬å…ˆå¯åŠ¨é¡¹ç›®ã€‚è¯¥é¡¹ç›®æ¨¡æ‹Ÿäº†JVMè¿è¡Œç¯å¢ƒï¼Œä½†åªå®ç°äº†Attach APIçš„éƒ¨åˆ†åŠŸèƒ½ã€‚é¡¹ç›®å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“å‰çš„JVMè¿›ç¨‹IDä¸ºï¼š<font color=red>32910</font>\n\n![01](æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/JVM_start.png)\n\n----\n\n##### æŒ‰ç…§JDKè§„èŒƒç¼–å†™JAVAæµ‹Attachæ–¹æ³•ã€‚ä¸ºäº†ç®€ä¾¿ï¼Œæ–¹æ³•ä¸­æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šäº†attachçš„çº¿ç¨‹å·ï¼Œå¹¶æä¾›äº†JVMéœ€è¦åŠ è½½çš„JaråŒ…è·¯å¾„ã€‚\n\n```java\npublic class Attach {\n    public static void main(String[] args) throws IOException, AttachNotSupportedException, AgentLoadException, AgentInitializationException {\n        VirtualMachine attach = VirtualMachine.attach(\"32910\");\n        attach.loadAgentPath(\"/Users/xiangshi/.gradle/caches/modules-2/files-2.1/cglib/cglib/3.1/1f1cb6c7a7479e0c7fd7987109e503914bebe84a/cglib-3.1.jar\");\n\n\n    }\n}\n\n```\n\n----\n##### è¿è¡ŒJava attachæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°æ¨¡æ‹Ÿçš„JVMå·²ç»è¯»å–åˆ°äº†æˆ‘ä»¬å¸Œæœ›classloaderçš„JaråŒ…\n\n![02](æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/load_agent_library.png)\n\n----\n\n### å®éªŒåˆ†æ\nå®éªŒè¿‡ç¨‹å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä¼ªé€ äº†ä¸ªJVMè¿è¡Œæ—¶ç¯å¢ƒã€‚å¹¶é€šè¿‡JAVAåŸç”Ÿçš„Attach APIæˆåŠŸçš„å®ç°äº†ä¸JVMä¹‹é—´é€šè®¯çš„åŠŸèƒ½ã€‚ä¸‹é¢æˆ‘ä»¬å¼€å§‹é€æ­¥åˆ†æå…·ä½“çš„å®ç°è¿‡ç¨‹ï¼š\n\n* ç›‘å¬signal\nåˆå§‹åŒ–OSä¿¡å·ç›‘å¬çš„ç›¸å…³æ•°æ®\n\n``` C++\n/**\n * JVMå¯åŠ¨æ—¶ç›‘å¬signal\n */\nvoid os::signal_init() {\n    //åˆå§‹åŒ–signalç›‘å¬pending_signals\n    os::signal_init_pd();\n    //åˆ›å»ºçº¿ç¨‹ç›‘å¬pending_signalsçŠ¶æ€å¹¶è¿›è¡Œç›¸åº”å¤„ç†\n    pthread_t tids;\n    int ret = pthread_create(&tids, NULL, reinterpret_cast<void *(*)(void *)>(signal_thread_entry), NULL);\n    //æ³¨å†Œsignalå¤„ç†å™¨\n    os::signal(SIGBREAK,os::user_handler());\n}\n```\n\nsigactionæ–¹æ³•æä¾›osä¿¡å·çš„ç›‘å¬å¹¶æ³¨å†Œä¿¡å·å¤„ç†å™¨ï¼Œæˆ‘ä»¬ç›‘å¬-3 SIGQUITä¿¡å·ã€‚\n\n```C++\n/**\n * æ³¨å†Œç›‘å¬ä¿¡å·&å¤„ç†å™¨\n * @param signal_number ä¿¡å·ç¼–å·\n * @param handler ä¿¡å·å¤„ç†å™¨\n * @return\n */\nvoid *os::signal(int signal_number, void *handler) {\n    struct sigaction sigAct, oldSigAct;\n\n    sigfillset(&(sigAct.sa_mask));\n    sigAct.sa_flags   = SA_RESTART|SA_SIGINFO;\n    sigAct.sa_handler = CAST_TO_FN_PTR(sa_handler_t, handler);\n\n    if (sigaction(signal_number, &sigAct, &oldSigAct)) {\n        // -1 means registration failed\n        return (void *)-1;\n    }\n\n    return CAST_FROM_FN_PTR(void*, oldSigAct.sa_handler);\n}\n```\n\nä¿¡å·å¤„ç†å™¨ä¸­ç®€å•çš„æ¨¡æ‹Ÿçš„æ”¶åˆ°ä¿¡å·çš„å¤„ç†è¿‡ç¨‹ï¼Œæ•°ç»„å¯¹åº”çš„ä¿¡å·ä½ç½®ä¸º1æ—¶ï¼Œè¯´æ˜æ”¶åˆ°äº†å¯¹åº”çš„ä¿¡å·ã€‚\n\n```C++\n/**\n * é€šè¿‡pending_signalsä¿ç•™ç›‘å¬åˆ°çš„ä¿¡æ¯ï¼Œäº¤ç”±ä¸“é—¨çš„çº¿ç¨‹å¤„ç†è¯¥ä¿¡æ¯\n * @param signal_number\n */\nvoid os::signal_notify(int signal_number) {\n    cout << \"enter signal_notify sig:\" << signal_number << endl;\n    //å°†ç›‘å¬åˆ°çš„ä¿¡å·ä¸ºç«–ä¸º1\n    //æ”¹æ“ä½œåº”è¯¥ä¸ºåŸå­æ“ä½œï¼Œç¡®ä¿ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹\n    //JVMä¸­æ··ç¼–å¹³å°ç›¸å…³æ±‡ç¼–æŒ‡ä»¤å®ç°åŸå­æ“ä½œï¼Œæ¼”ç¤ºä»£ç ä¸­ä¸ç ”ç©¶ç›¸å…³å®ç°\n    pending_signals[signal_number] = 1;\n\n    semaphore_signal(sig_sem);\n}\n```\n\nå•ç‹¬èµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹è½®è®­ä¿¡å·æ¥å—æ•°ç»„çš„çŠ¶æ€ï¼Œå°†ç½®ä¸º1çš„ä¿¡å·ç ä¼ ç»™ä¸‹æ¸¸å¤„ç†ã€‚å½“ä¿¡å·ä½-3 SIGQUITä¿¡å·æ—¶ï¼Œå¼€å§‹åˆå§‹åŒ–attachçš„ç›‘å¬æ–¹æ³•ã€‚\n\n```C++\n/**\n * å•ç‹¬çº¿ç¨‹å¯¹pending_signalsçŠ¶æ€å¹¶è¿›è¡Œç›¸åº”å¤„ç†\n */\nstatic void signal_thread_entry() {\n    cout << \"enter signal_thread_entry\" << endl;\n    while (true){\n        int sig;\n        {\n            sig = os::signal_wait();\n        }\n        switch (sig) {\n            case SIGBREAK: {\n                if (AttachListener::init()) {\n                    continue;\n                }\n            }\n        }\n\n    }\n}\n```\n\nåˆå§‹åŒ–attachç›‘å¬æ–¹æ³•æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªDomain Socketçš„æ–‡ä»¶ç›‘å¬ï¼Œå¹¶acceptåœ¨æ”¹æ–‡ä»¶ä¸Šã€‚\n\n```C++\n/**\n * åˆå§‹åŒ–domain socketç›‘å¬\n * JVMé€šè¿‡ç›‘å¬æŒ‡å®šçº¿ç¨‹æ–‡ä»¶æ–‡ä»¶\n * è·å–clientæƒ³JVMå‘é€çš„æŒ‡ä»¤å¹¶è¿›è¡Œç›¸å…³æ“ä½œ\n * @return\n */\nint AttachListener::pd_init() {\n    char path[UNIX_PATH_MAX];          // socket file\n    char initial_path[UNIX_PATH_MAX];  // socket file during setup\n    int listener;                      // listener socket (file descriptor)\n\n    // register function to cleanup\n    ::atexit(listener_cleanup);\n\n    int n = snprintf(path, UNIX_PATH_MAX, \"%s/.java_pid%d\",\n                     TEMP_PATH, getpid());\n    if (n < (int) UNIX_PATH_MAX) {\n        n = snprintf(initial_path, UNIX_PATH_MAX, \"%s.tmp\", path);\n    }\n    if (n >= (int) UNIX_PATH_MAX) {\n        return -1;\n    }\n    cout << \"path:\" << path << endl;\n    // create the listener socket\n    listener = ::socket(PF_UNIX, SOCK_STREAM, 0);\n    if (listener == -1) {\n        return -1;\n    }\n\n    // bind socket\n    struct sockaddr_un addr;\n    addr.sun_family = AF_UNIX;\n    strcpy(addr.sun_path, initial_path);\n    ::unlink(initial_path);\n    int res = ::bind(listener, (struct sockaddr *) &addr, sizeof(addr));\n    if (res == -1) {\n        ::close(listener);\n        return -1;\n    }\n\n    // put in listen mode, set permissions, and rename into place\n    res = ::listen(listener, 5);\n    if (res == 0) {\n        RESTARTABLE(::chmod(initial_path, S_IREAD | S_IWRITE), res);\n        if (res == 0) {\n            if (res == 0) {\n                res = ::rename(initial_path, path);\n            }\n        }\n    }\n    if (res == -1) {\n        ::close(listener);\n        ::unlink(initial_path);\n        return -1;\n    }\n    set_path(path);\n    set_listener(listener);\n\n    return 0;\n}\n```\n\nä¸€æ—¦æ”¶åˆ°javaå‘é€è¿‡æ¥çš„socketè¯·æ±‚ï¼Œåˆ™è§£æè¯¥è¯·æ±‚å¹¶åŒ…è£…ä¸ºAttachOperationå¯¹è±¡ã€‚\n\n```C++\n/**\n * accept domain socketï¼Œè¯»å–åˆ°å†…å®¹åç”Ÿæˆå¯¹åº”çš„AttachOperation\n * @return\n */\nAttachOperation *AttachListener::dequeue() {\n    for (;;) {\n        int s;\n\n        // wait for client to connect\n        struct sockaddr addr;\n        socklen_t len = sizeof(addr);\n        RESTARTABLE(::accept(listener(), &addr, &len), s);\n        if (s == -1) {\n            return NULL;      // log a warning?\n        }\n\n        // get the credentials of the peer and check the effective uid/guid\n        // - check with jeff on this.\n        uid_t puid;\n        gid_t pgid;\n        if (::getpeereid(s, &puid, &pgid) != 0) {\n            ::close(s);\n            continue;\n        }\n        uid_t euid = geteuid();\n        gid_t egid = getegid();\n\n        //æ£€æŸ¥DSæ–‡ä»¶æ˜¯å¦ä¸ºåŒä¸€ä¸ªç”¨æˆ·åˆ›å»º\n        if (puid != euid || pgid != egid) {\n            ::close(s);\n            continue;\n        }\n\n        // è¯»å–æ–‡ä»¶å†…å®¹ï¼Œç”ŸæˆAttachOperationå¯¹è±¡\n        AttachOperation *op = read_request(s);\n        if (op == NULL) {\n            ::close(s);\n            continue;\n        } else {\n            return op;\n        }\n    }\n}\n```\n\næœ€åç”¨åŒ…è£…åçš„AttachOperationï¼Œé€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å·²ç»‘å®šçš„å¤„ç†å‡½æ•°ã€‚\n\n```C++\nstatic void attach_listener_thread_entry() {\n    int pdint = AttachListener::pd_init();\n    if (pdint != 0) {\n        return;\n    }\n    AttachListener::set_initialized();\n\n    for (;;) {\n        AttachOperation* op = AttachListener::dequeue();\n        if (op == NULL) {\n            return;   // dequeue failed or shutdown\n        }\n\n        // find the function to dispatch too\n        AttachOperationFunctionInfo* info = NULL;\n        for (int i=0; funcs[i].name != NULL; i++) {\n            const char* name = funcs[i].name;\n            if (strcmp(op->name(), name) == 0) {\n                info = &(funcs[i]);\n                break;\n            }\n        }\n\n        if (info != NULL) {\n            // dispatch to the function that implements this operation\n            (info->func)(op);\n        }\n    }\n}\n```\n\n<font color=red>æ€»ç»“</font> ï¼Œé€šè¿‡ä¿¡å·ç›‘å¬-->socketé€šä¿¡-->è°ƒç”¨æŒ‡å®šæ–¹æ³•çš„æµç¨‹ï¼Œå®ç°äº†æˆ‘ä»¬å®éªŒçš„é¢„æœŸã€‚\n\n## å››ã€çœ‹çœ‹JVMæ˜¯æ€ä¹ˆåšçš„\næœ€åæˆ‘ä»¬å›åˆ°JVMå†…éƒ¨ï¼Œçœ‹çœ‹JVMæ˜¯å¦‚ä½•å®ç°çš„ã€‚\n\nç”±äºå®éªŒä»£ç å¤§é‡çš„é‡‡ç”¨äº†JVMçš„å®ç°ï¼Œæˆ‘ä»¬è¿™é‡Œä¸»è¦è§‚å¯ŸJVMçš„æµç¨‹ã€‚\n\n* JVMå¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–ä¿¡å·çš„ç›‘å¬\n\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/thread.cpp\n\n```C++\njint Threads::create_vm(JavaVMInitArgs* args, bool* canTryAgain) {\n    ...\n\n  // Signal Dispatcher needs to be started before VMInit event is posted\n  os::signal_init();\n\n  // Start Attach Listener if +StartAttachListener or it can't be started lazily\n  if (!DisableAttachMechanism) {\n    AttachListener::vm_start();\n    if (StartAttachListener || AttachListener::init_at_startup()) {\n      AttachListener::init();\n    }\n  }\n    ...\n}\n```\n\nos::signal_init();åŠŸèƒ½æˆ‘ä»¬å‰é¢å·²ç»åˆ†æè¿‡ï¼ŒJVMä¼šæ³¨å†Œkill -3ä¿¡å·çš„ç›‘å¬å’Œå¯¹åº”çš„ä¿¡å·å¤„ç†å™¨ï¼ŒåŒæ—¶ä¼šå¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¯¹ç›‘å¬åˆ°çš„ä¿¡å·åšåç»­ä¸šåŠ¡å¤„ç†ã€‚\n\n<font color=blue>DisableAttachMechanism</font> & <font color=blue>StartAttachListener</font> é»˜è®¤ä¸ºfalseï¼Œåœ¨JVMé»˜è®¤å¯åŠ¨çš„æƒ…å†µä¸‹ä¸ä¼šåˆå§‹åŒ–Attachçš„ç›‘å¬ã€‚\n\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/globals.hpp\n\n```C+++\n  product(bool, DisableAttachMechanism, false,                              \\\n          \"Disable mechanism that allows tools to attach to this VM\") \n  product(bool, StartAttachListener, false,                                 \\\n          \"Always start Attach Listener at VM startup\")      \n```\n\nJVMç›‘å¬åˆ°ä¿¡å·åï¼Œå½“ä¿¡å·ä½kill -3æ—¶å¦‚æœè¿˜æœªåˆå§‹åŒ–attachç›‘å¬ï¼Œå°†ä¼šè¿›è¡Œç›¸åº”åˆå§‹åŒ–è¿‡ç¨‹ã€‚\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/thread.cpp->create_vm()\n>             ---- src/share/vm/runtime/os.cpp->signal_init()\n>                 ---- src/share/vm/runtime/os.cpp->signal_thread_entry()\n\n\n```C++\nstatic void signal_thread_entry(JavaThread* thread, TRAPS) {\n  os::set_priority(thread, NearMaxPriority);\n  while (true) {\n    int sig;\n    {\n      // FIXME : Currently we have not decieded what should be the status\n      //         for this java thread blocked here. Once we decide about\n      //         that we should fix this.\n      sig = os::signal_wait();\n    }\n    if (sig == os::sigexitnum_pd()) {\n       // Terminate the signal thread\n       return;\n    }\n\n    switch (sig) {\n      case SIGBREAK: {\n        // Check if the signal is a trigger to start the Attach Listener - in that\n        // case don't print stack traces.\n        if (!DisableAttachMechanism && AttachListener::is_init_trigger()) {\n          continue;\n        }\n        // Print stack traces\n        // Any SIGBREAK operations added here should make sure to flush\n        // the output stream (e.g. tty->flush()) after output.  See 4803766.\n        // Each module also prints an extra carriage return after its output.\n        VM_PrintThreads op;\n        VMThread::execute(&op);\n        VM_PrintJNI jni_op;\n        VMThread::execute(&jni_op);\n        VM_FindDeadlocks op1(tty);\n        VMThread::execute(&op1);\n        Universe::print_heap_at_SIGBREAK();\n        if (PrintClassHistogram) {\n          VM_GC_HeapInspection op1(gclog_or_tty, true /* force full GC before heap inspection */);\n          VMThread::execute(&op1);\n        }\n        if (JvmtiExport::should_post_data_dump()) {\n          JvmtiExport::post_data_dump();\n        }\n        break;\n      }\n      ...\n  }\n}\n```\n\nåˆå§‹åŒ–Attachç›‘å¬æ—¶ä¼šæ£€æŸ¥Javaå®¢æˆ·ç«¯ç”Ÿæˆçš„attachæ–‡ä»¶ã€‚\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/thread.cpp->create_vm()\n>             ---- src/share/vm/runtime/os.cpp->signal_init()\n>                 ---- src/share/vm/runtime/os.cpp->signal_thread_entry()\n>                      ---- src/os/bsd/vm/attachListener_bsd.cpp->is_init_trigger()\n\n\n```C++\nbool AttachListener::is_init_trigger() {\n  if (init_at_startup() || is_initialized()) {\n    return false;               // initialized at startup or already initialized\n  }\n  char path[PATH_MAX + 1];\n  int ret;\n  struct stat st;\n\n  snprintf(path, PATH_MAX + 1, \"%s/.attach_pid%d\",\n           os::get_temp_directory(), os::current_process_id());\n  RESTARTABLE(::stat(path, &st), ret);\n  if (ret == 0) {\n    // simple check to avoid starting the attach mechanism when\n    // a bogus user creates the file\n    if (st.st_uid == geteuid()) {\n      init();\n      return true;\n    }\n  }\n  return false;\n}\n```\n\nç¡®è®¤Javaå®¢æˆ·ç«¯å¼€å§‹attachå¹¶ä¸”æƒé™æ ¡éªŒé€šè¿‡åå¼€å§‹socketé€šè®¯ï¼Œé¦–å…ˆåˆå§‹åŒ–socketå¹¶ç»‘å®šç›‘å¬ã€‚\n>ä»£ç æ¸…å•ï¼š src/os/bsd/vm/attachListener_bsd.cpp->is_init_trigger()\n>             ---- src/share/vm/services/attachListener.cpp->init()\n\n\n```C++\nbool AttachListener::is_init_trigger() {\n  if (init_at_startup() || is_initialized()) {\n    return false;               // initialized at startup or already initialized\n  }\n  char path[PATH_MAX + 1];\n  int ret;\n  struct stat st;\n\n  snprintf(path, PATH_MAX + 1, \"%s/.attach_pid%d\",\n           os::get_temp_directory(), os::current_process_id());\n  RESTARTABLE(::stat(path, &st), ret);\n  if (ret == 0) {\n    // simple check to avoid starting the attach mechanism when\n    // a bogus user creates the file\n    if (st.st_uid == geteuid()) {\n      init();\n      return true;\n    }\n  }\n  return false;\n}\n```\n\næœ€ç»ˆJVMåˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ‰§è¡ŒAttachç›‘å¬æ–¹æ³•ï¼Œæ–¹æ³•acceptä»Javaå®¢æˆ·ç«¯å‘é€çš„æŒ‡ä»¤ï¼Œå¹¶è§£æä¸ºå¯¹åº”çš„å‡½æ•°ã€‚\n>ä»£ç æ¸…å•ï¼š src/share/vm/services/attachListener.cpp->init()\n>             ---- src/share/vm/services/attachListener.cpp->attach_listener_thread_entry()\n\n\n```C++\nstatic void attach_listener_thread_entry(JavaThread* thread, TRAPS) {\n  os::set_priority(thread, NearMaxPriority);\n\n  thread->record_stack_base_and_size();\n\n  if (AttachListener::pd_init() != 0) {\n    return;\n  }\n  AttachListener::set_initialized();\n\n  for (;;) {\n    AttachOperation* op = AttachListener::dequeue();\n    if (op == NULL) {\n      return;   // dequeue failed or shutdown\n    }\n\n    ResourceMark rm;\n    bufferedStream st;\n    jint res = JNI_OK;\n\n    // handle special detachall operation\n    if (strcmp(op->name(), AttachOperation::detachall_operation_name()) == 0) {\n      AttachListener::detachall();\n    } else {\n      // find the function to dispatch too\n      AttachOperationFunctionInfo* info = NULL;\n      for (int i=0; funcs[i].name != NULL; i++) {\n        const char* name = funcs[i].name;\n        assert(strlen(name) <= AttachOperation::name_length_max, \"operation <= name_length_max\");\n        if (strcmp(op->name(), name) == 0) {\n          info = &(funcs[i]);\n          break;\n        }\n      }\n\n      // check for platform dependent attach operation\n      if (info == NULL) {\n        info = AttachListener::pd_find_operation(op->name());\n      }\n\n      if (info != NULL) {\n        // dispatch to the function that implements this operation\n        res = (info->func)(op, &st);\n      } else {\n        st.print(\"Operation %s not recognized!\", op->name());\n        res = JNI_ERR;\n      }\n    }\n\n    // operation complete - send result and output to client\n    op->complete(res, &st);\n  }\n}\n```\n\n>ä»£ç æ¸…å•ï¼š src/share/vm/services/attachListener.cpp->attach_listener_thread_entry()\n>             ---- src/os/bsd/vm/attachListener_bsd.cpp->dequeue()\n>                  ---- src/os/bsd/vm/attachListener_bsd.cpp->BsdAttachListener::dequeue()\n\n\n```C++\nBsdAttachOperation* BsdAttachListener::dequeue() {\n  for (;;) {\n    int s;\n\n    // wait for client to connect\n    struct sockaddr addr;\n    socklen_t len = sizeof(addr);\n    RESTARTABLE(::accept(listener(), &addr, &len), s);\n    if (s == -1) {\n      return NULL;      // log a warning?\n    }\n\n    // get the credentials of the peer and check the effective uid/guid\n    // - check with jeff on this.\n    uid_t puid;\n    gid_t pgid;\n    if (::getpeereid(s, &puid, &pgid) != 0) {\n      ::close(s);\n      continue;\n    }\n    uid_t euid = geteuid();\n    gid_t egid = getegid();\n\n    if (puid != euid || pgid != egid) {\n      ::close(s);\n      continue;\n    }\n\n    // peer credential look okay so we read the request\n    BsdAttachOperation* op = read_request(s);\n    if (op == NULL) {\n      ::close(s);\n      continue;\n    } else {\n      return op;\n    }\n  }\n}\n```\n\næŒ‡ä»¤ä¸æ–¹æ³•çš„æ˜ å°„æ˜¯äº‹å…ˆå‡†å¤‡å¥½çš„\n> ä»£ç æ¸…å•ï¼šsrc/share/vm/services/attachListener.cpp\n```C++\nstatic AttachOperationFunctionInfo funcs[] = {\n  { \"agentProperties\",  get_agent_properties },\n  { \"datadump\",         data_dump },\n  { \"dumpheap\",         dump_heap },\n  { \"load\",             JvmtiExport::load_agent_library },\n  { \"properties\",       get_system_properties },\n  { \"threaddump\",       thread_dump },\n  { \"inspectheap\",      heap_inspection },\n  { \"setflag\",          set_flag },\n  { \"printflag\",        print_flag },\n  { \"jcmd\",             jcmd },\n  { NULL,               NULL }\n};\n```\n\n\n<font color=red>æ€»ç»“</font>,ç›¸ä¿¡é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å·²ç»æ¸…æ¥šçš„äº†è§£JVMæ˜¯å¦‚ä½•æ¥æ”¶åˆ°Javaå®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œä»è€Œå®ç°åŠ¨æ€Attachçš„åŠŸèƒ½ã€‚å…·ä½“æµç¨‹å¦‚å›¾ï¼š\n![03](æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/flow.png)","slug":"æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†","published":1,"updated":"2020-12-14T10:27:57.231Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckis71hul004qv252637lc9sc","content":"<html><head></head><body><p>&#x76F8;&#x4FE1;&#x5F88;&#x591A;&#x5C0F;&#x4F19;&#x4F34;&#x90FD;&#x4F7F;&#x7528;&#x8FC7;javaagent&#x63A2;&#x9488;&#x6280;&#x672F;&#xFF0C;javaagent&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x4FB5;&#x5165;&#x539F;&#x4EE3;&#x7801;&#x4E0D;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x65B9;&#x6CD5;&#x5E76;&#x5229;&#x7528;&#x52A8;&#x6001;&#x5B57;&#x8282;&#x7801;&#x6280;&#x672F;&#x589E;&#x5F3A;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x5F88;&#x591A;&#x6210;&#x719F;&#x7684;&#x6846;&#x67B6;&#x4E5F;&#x8FD0;&#x7528;&#x5230;&#x4E86;&#x8BE5;&#x6280;&#x672F;&#xFF0C;&#x5982;skywalking&#x7B49;&#x3002;&#x8FD9;&#x4E48;&#x597D;&#x7528;&#x7684;&#x529F;&#x80FD;&#xFF0C;JDK&#x7684;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6CA1;&#x9053;&#x7406;&#x4E0D;&#x73A9;&#x51FA;&#x4E9B;&#x65B0;&#x82B1;&#x5934;&#xFF0C;&#x56E0;&#x6B64;&#x5728;JDK1.6&#x4E2D;&#xFF0C;&#x66F4;&#x52A0;&#x5F3A;&#x5927;&#x7684;JVM &#x52A8;&#x6001;Attach&#x6280;&#x672F;&#x5C55;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x9762;&#x524D;&#x3002;&#x5927;&#x540D;&#x9F0E;&#x9F0E;&#x7684;Btrace&#x3001;Arthas&#x7B49;&#x90FD;&#x8FD0;&#x7528;&#x4E86;&#x52A8;&#x6001;Attach&#x6280;&#x672F;&#x3002;&#x5728;JVM&#x8FD0;&#x884C;&#x671F;&#x8FDB;&#x62E6;&#x622A;&#x5E76;&#x589E;&#x5F3A;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4F7F;&#x5F97;&#x4EE5;&#x5F80;&#x751F;&#x4EA7;&#x96BE;&#x4EE5;&#x5B9A;&#x4F4D;&#x7684;&#x95EE;&#x9898;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x5BB9;&#x6613;&#x6392;&#x67E5;&#x3002;</p>\n<a id=\"more\"></a>\n<p>JVM&#x7684;&#x52A8;&#x6001;Attach&#x56FA;&#x7136;&#x597D;&#xFF0C;&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x6216;&#x591A;&#x6216;&#x5C11;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x53BB;&#x4F7F;&#x7528;&#x8BE5;&#x6280;&#x672F;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x6B21;&#x6211;&#x4EEC;&#x7814;&#x7A76;&#x7684;&#x91CD;&#x70B9;&#x662F;JVM&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x52A8;&#x6001;Attach&#xFF0C;&#x81F3;&#x4E8E;JVM&#x5982;&#x4F55;&#x52A0;&#x8F7D;&#x52A8;&#x6001;Jar&#x5305;&#x3001;&#x5206;&#x53D1;&#x65B9;&#x6CD5;&#x5E76;&#x4F20;&#x9012;jvm&#x4E0A;&#x4E0B;&#x6587;&#x5C31;&#x4E0D;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x7814;&#x7A76;&#x8303;&#x56F4;&#x4E4B;&#x5185;&#x3002;</p>\n<p>&#x4E3A;&#x4E86;&#x66F4;&#x597D;&#x7684;&#x7814;&#x7A76;JVM&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x7531;&#x6D45;&#x5165;&#x6DF1;&#xFF0C;&#x5206;&#x4E3A;&#x51E0;&#x4E2A;&#x9636;&#x6BB5;&#x8FDB;&#x884C;&#x7814;&#x7A76;&#xFF1A;</p>\n<ul>\n<li>&#x52A8;&#x6001;Attach&#x662F;&#x4EC0;&#x4E48;&#xFF1F;</li>\n<li>&#x6709;&#x51E0;&#x79CD;&#x65B9;&#x6848;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x52A8;&#x6001;Attach</li>\n<li>&#x4E3E;&#x4E00;&#x4E2A;&#x6817;&#x5B50;</li>\n<li>&#x770B;&#x770B;JVM&#x662F;&#x600E;&#x4E48;&#x505A;&#x7684;</li>\n</ul>\n<h2 id=\"&#x4E00;&#x3001;&#x52A8;&#x6001;Attach&#x662F;&#x4EC0;&#x4E48;\"><a href=\"#&#x4E00;&#x3001;&#x52A8;&#x6001;Attach&#x662F;&#x4EC0;&#x4E48;\" class=\"headerlink\" title=\"&#x4E00;&#x3001;&#x52A8;&#x6001;Attach&#x662F;&#x4EC0;&#x4E48;\"></a>&#x4E00;&#x3001;&#x52A8;&#x6001;Attach&#x662F;&#x4EC0;&#x4E48;</h2><p>&#x867D;&#x7136;&#x6211;&#x4EEC;&#x8FD9;&#x6B21;&#x7814;&#x7A76;&#x7684;&#x662F;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x5728;&#x8FD9;&#x4E4B;&#x524D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x50CF;&#x5206;&#x6790;&#x9700;&#x6C42;&#x4E00;&#x6837;&#x5206;&#x6790;&#x4E0B;&#x52A8;&#x6001;Attach&#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x90FD;&#x77E5;&#x9053;javaagent&#x53C2;&#x6570;&#x662F;&#x4F34;&#x968F;&#x7740;java&#x547D;&#x4EE4;&#xFF0C;&#x5728;JVM&#x542F;&#x52A8;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x52A0;&#x8F7D;javaagent&#x53C2;&#x6570;&#x6307;&#x5B9A;&#x7684;Jar&#x5305;&#x8DEF;&#x5F84;&#xFF0C;&#x5E76;&#x6267;&#x884C;&#x7EA6;&#x5B9A;&#x7C7B;&#x7684;premain&#x65B9;&#x6CD5;&#x3002;&#x5728;premain&#x65B9;&#x6CD5;&#x4E2D;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;Instrumentation&#x7C7B;&#x578B;&#x53C2;&#x6570;&#xFF0C;&#x4ECE;&#x800C;&#x5BF9;&#x6211;&#x4EEC;&#x7684;&#x7C7B;&#x8FDB;&#x884C;&#x52A8;&#x6001;&#x589E;&#x5F3A;&#x589E;&#x5F3A;&#x3002;</p>\n<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x4F7F;&#x7528;javaagent&#xFF1A;</p>\n<ol>\n<li><p>&#x5148;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6302;&#x5728;&#x7684;&#x7C7B;&#xFF0C;&#x5176;&#x4E2D;&#x9700;&#x8981;&#x5B9E;&#x73B0;premain()&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x5C06;&#x5B83;&#x6253;&#x5305;&#x4E3A;&#x53EF;&#x6267;&#x884C;Jar&#x5305;</p>\n<figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Javaagent</span> </span>{</span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">premain</span><span class=\"hljs-params\">(String agentArgs, Instrumentation inst)</span> </span>{</span><br><span class=\"line\">        System.out.println(<span class=\"hljs-string\">&quot;agentArgs : &quot;</span> + agentArgs);</span><br><span class=\"line\">        inst.addTransformer(<span class=\"hljs-keyword\">new</span> TestTransformer(), <span class=\"hljs-keyword\">true</span>);</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">static</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TestTransformer</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">ClassFileTransformer</span> </span>{</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-meta\">@Override</span></span><br><span class=\"line\">        <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">byte</span>[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, <span class=\"hljs-keyword\">byte</span>[] classfileBuffer) <span class=\"hljs-keyword\">throws</span> IllegalClassFormatException {</span><br><span class=\"line\">            System.out.println(<span class=\"hljs-string\">&quot;premain load Class:&quot;</span> + className);</span><br><span class=\"line\">            <span class=\"hljs-keyword\">return</span> classfileBuffer;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li><p>&#x914D;&#x7F6E;MANIFEST.MF&#x914D;&#x7F6E;&#x6587;&#x4EF6;</p>\n<figure class=\"highlight xml hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Premain-Class: Javaagent</span><br><span class=\"line\">Agent-Class: Javaagent</span><br><span class=\"line\">Can-Redefine-Classes: true</span><br><span class=\"line\">Can-Retransform-Classes: true</span><br></pre></td></tr></tbody></table></figure>\n</li>\n<li><p>&#x542F;&#x52A8;&#x6211;&#x4EEC;&#x7684;&#x670D;&#x52A1;</p>\n<figure class=\"highlight shell hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -javaagent:Javaagent.jar &#x81EA;&#x5DF1;&#x7684;&#x670D;&#x52A1;.jar</span><br></pre></td></tr></tbody></table></figure>\n\n</li>\n</ol>\n<p>&#x4EE5;&#x4E0A;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;javaagent&#x8FD0;&#x7528;&#x573A;&#x666F;&#x3002;javaagent&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x4FB5;&#x5165;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x4FEE;&#x6539;&#x6211;&#x4EEC;&#x5DF2;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#xFF0C;&#x4F46;&#x552F;&#x4E00;&#x7684;&#x95EE;&#x9898;&#x662F;&#x9700;&#x8981;&#x4F34;&#x968F;&#x7740;&#x4E1A;&#x52A1;&#x670D;&#x52A1;&#x4E00;&#x540C;&#x542F;&#x52A8;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x4FB5;&#x5165;&#x5DF2;&#x7ECF;&#x8FD0;&#x884C;&#x5728;JVM&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x6B64;JDK&#x5F00;&#x53D1;&#x7684;&#x5927;&#x795E;&#x4EEC;&#x4E3A;&#x6211;&#x4EEC;&#x5E26;&#x6765;&#x4E86;&#x52A8;&#x6001;Attach API&#x3002;&#x5176;&#x529F;&#x80FD;&#x4E0E;javaagent&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x4F46;&#x6700;&#x5927;&#x7684;&#x597D;&#x5904;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x5728;&#x4E00;&#x4E2A;&#x5DF2;&#x7ECF;&#x8FD0;&#x884C;&#x7684;JVM&#x4E0A;&#x52A8;&#x6001;&#x7684;&#x6302;&#x8F7D;&#x4E00;&#x4E2A;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x5F00;&#x53D1;&#x7684;Jar&#x5305;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x4EFB;&#x4F55;&#x65F6;&#x95F4;&#x70B9;&#x6211;&#x4EEC;&#x90FD;&#x80FD;&#x624B;&#x52A8;&#x7684;&#x589E;&#x5F3A;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x3002;&#x6BD4;&#x5982;&#x901A;&#x8FC7;attach Arthas&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x589E;&#x5F3A;&#x6307;&#x5B9A;&#x65B9;&#x6CD5;&#x7684;&#x5165;&#x53E3;&amp;&#x51FA;&#x53E3;&#xFF0C;&#x4ECE;&#x800C;&#x83B7;&#x53D6;&#x51FA;&#x5165;&#x53C2;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x5728;&#x7F3A;&#x5C11;&#x65E5;&#x5FD7;&#x8F93;&#x51FA;&#x7684;&#x573A;&#x666F;&#x4E0B;&#x662F;&#x975E;&#x5E38;&#x6709;&#x6548;&#x7684;&#x95EE;&#x9898;&#x5B9A;&#x4F4D;&#x624B;&#x6BB5;&#x3002;&#x6B64;&#x5916;&#x6211;&#x4EEC;&#x4E5F;&#x80FD;&#x4E3A;&#x65B9;&#x6CD5;&#x7684;&#x8C03;&#x7528;&#x94FE;&#x505A;&#x57CB;&#x70B9;&#xFF0C;&#x5E2E;&#x52A9;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x4E1A;&#x52A1;&#x6D41;&#x7A0B;&#x4E2D;&#x7684;&#x6162;&#x65B9;&#x6CD5;&#x7B49;&#x7B49;&#x3002;</p>\n<p>&#x603B;&#x7ED3;&#x4E0B;&#xFF0C;&#x52A8;&#x6001;Attach&#x5C31;&#x662F;JVM&#x8FD0;&#x884C;&#x671F;&#x4E2D;&#x63D0;&#x4F9B;&#x7684;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x673A;&#x5236;&#x3002;&#x901A;&#x8FC7;&#x589E;&#x5F3A;&#x7C7B;&#x7684;&#x52A0;&#x8F7D;&#xFF0C;&#x5B9E;&#x73B0;&#x5404;&#x5F0F;&#x5404;&#x6837;&#x6709;&#x8DA3;&#x7684;&#x529F;&#x80FD;&#x3002;</p>\n<h2 id=\"&#x4E8C;&#x3001;&#x6709;&#x51E0;&#x79CD;&#x65B9;&#x6848;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x52A8;&#x6001;Attach\"><a href=\"#&#x4E8C;&#x3001;&#x6709;&#x51E0;&#x79CD;&#x65B9;&#x6848;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x52A8;&#x6001;Attach\" class=\"headerlink\" title=\"&#x4E8C;&#x3001;&#x6709;&#x51E0;&#x79CD;&#x65B9;&#x6848;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x52A8;&#x6001;Attach\"></a>&#x4E8C;&#x3001;&#x6709;&#x51E0;&#x79CD;&#x65B9;&#x6848;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x52A8;&#x6001;Attach</h2><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x77E5;&#x9053;&#x4EC0;&#x4E48;&#x662F;&#x52A8;&#x6001;Attach&#x4E86;&#xFF0C;&#x5018;&#x82E5;&#x6211;&#x4EEC;&#x662F;JDK&#x7684;&#x5DE5;&#x7A0B;&#x5E08;&#xFF0C;&#x5F53;&#x4EA7;&#x54C1;&#x4EA4;&#x7ED9;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x52A8;&#x6001;Attach&#x8FD9;&#x4E2A;&#x9700;&#x6C42;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x4F1A;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x5462;&#xFF1F;</p>\n<h4 id=\"1-&#x76F4;&#x63A5;&#x7C7B;&#x52A0;&#x8F7D;&#x6CD5;\"><a href=\"#1-&#x76F4;&#x63A5;&#x7C7B;&#x52A0;&#x8F7D;&#x6CD5;\" class=\"headerlink\" title=\"1.&#x76F4;&#x63A5;&#x7C7B;&#x52A0;&#x8F7D;&#x6CD5;\"></a>1.&#x76F4;&#x63A5;&#x7C7B;&#x52A0;&#x8F7D;&#x6CD5;</h4><p>JDK&#x5DF2;&#x7ECF;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x5957;&#x5B8C;&#x5584;&#x7684;&#x7C7B;&#x52A0;&#x8F7D;&#x673A;&#x5236;&#xFF0C;&#x5982;&#x679C;&#x63D0;&#x4F9B;&#x83B7;&#x53D6;Instrumentation&#x5BF9;&#x8C61;&#x7684;JNI&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5C31;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x901A;&#x8FC7;&#x52A8;&#x6001;&#x7C7B;&#x52A0;&#x8F7D;&#x540E;&#x8FDB;&#x884C;&#x5B57;&#x8282;&#x7801;&#x52A8;&#x6001;&#x589E;&#x5F3A;&#x3002;&#x8FD9;&#x4E2A;&#x65B9;&#x6848;&#x770B;&#x4F3C;&#x5F88;&#x7F8E;&#x597D;&#xFF0C;&#x73B0;&#x6709;Java&#x751F;&#x6001;&#x5708;&#x5DF2;&#x7ECF;&#x62E5;&#x6709;&#x4E30;&#x5BCC;&#x7684;Class&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x65B9;&#x6848;&#xFF0C;&#x5229;&#x7528;&#x8FD9;&#x4E9B;&#x73B0;&#x6709;&#x65B9;&#x6848;&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x80FD;&#x591F;&#x5F88;&#x5FEB;&#x7684;&#x642D;&#x5EFA;&#x51FA;&#x81EA;&#x5DF1;&#x7684;&#x5B57;&#x8282;&#x7801;&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x673A;&#x5236;&#xFF0C;&#x800C;&#x65E0;&#x9700;JVM&#x63D0;&#x4F9B;&#x5927;&#x91CF;&#x7684;native&#x652F;&#x6301;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x65B9;&#x6848;&#x5B58;&#x5728;&#x91CD;&#x5927;&#x7684;&#x5B89;&#x5168;&#x95EE;&#x9898;&#xFF0C;&#x4E00;&#x65E6;&#x670D;&#x52A1;&#x7684;&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x673A;&#x5236;&#x88AB;&#x9ED1;&#x5BA2;&#x7834;&#x89E3;&#xFF0C;&#x90A3;&#x4E48;&#x4ED6;&#x5B8C;&#x5168;&#x80FD;&#x591F;&#x52A0;&#x8F7D;&#x4E00;&#x4E2A;&#x81EA;&#x5DF1;&#x7F16;&#x5199;&#x597D;&#x7684;&#x4FB5;&#x5165;&#x7C7B;&#xFF0C;&#x901A;&#x8FC7;&#x5165;&#x4FB5;&#x7C7B;&#x4EFB;&#x610F;&#x4FEE;&#x6539;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x6700;&#x7EC8;&#x5BFC;&#x81F4;&#x65E0;&#x6CD5;&#x633D;&#x56DE;&#x7684;&#x635F;&#x5931;&#x3002;&#x6240;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;JDK&#x5F00;&#x53D1;&#x5DE5;&#x7A0B;&#x5E08;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x5728;&#x521D;&#x671F;&#x5C31;&#x5C4F;&#x853D;&#x8FD9;&#x79CD;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x3002;&#x540C;&#x65F6;Java&#x6700;&#x4E3A;&#x4E00;&#x79CD;&#x5B89;&#x5168;&#x8BED;&#x8A00;&#xFF0C;&#x4E0D;&#x5B89;&#x5168;&#x7684;&#x64CD;&#x4F5C;&#x9700;&#x8981;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x5F15;&#x5165;Java&#x751F;&#x6001;&#x4E2D;&#x3002;</p>\n<h4 id=\"2-Socket&#x901A;&#x4FE1;&#x6CD5;\"><a href=\"#2-Socket&#x901A;&#x4FE1;&#x6CD5;\" class=\"headerlink\" title=\"2.Socket&#x901A;&#x4FE1;&#x6CD5;\"></a>2.Socket&#x901A;&#x4FE1;&#x6CD5;</h4><p>&#x65E2;&#x7136;&#x63D0;&#x4F9B;JNI&#x4E0D;&#x5B89;&#x5168;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x8BA9;JVM&#x81EA;&#x5DF1;&#x5904;&#x7406;&#x3002;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x80FD;&#x548C;JVM&#x5EFA;&#x7ACB;&#x8D77;Socket&#x901A;&#x8BAF;&#x3002;&#x5E76;&#x5C06;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x544A;&#x77E5;JVM&#xFF0C;JVM&#x5728;&#x52A0;&#x8F7D;&#x5B8C;&#x6210;&#x540E;&#x6309;&#x7167;&#x7EA6;&#x5B9A;&#x6267;&#x884C;&#x6307;&#x5B9A;&#x7684;&#x5165;&#x53E3;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x6837;&#x4E5F;&#x80FD;&#x5B9E;&#x73B0;&#x6211;&#x4EEC;&#x5BF9;&#x52A8;&#x6001;Attach&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>\n<p>Socket&#x901A;&#x4FE1;&#x53EF;&#x4EE5;&#x5206;&#x4E3A;&#x8FDC;&#x7A0B;&#x901A;&#x4FE1;&#x548C;&#x672C;&#x5730;&#x901A;&#x4FE1;&#x3002;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x8003;&#x8651;&#xFF0C;&#x5982;&#x679C;&#x91C7;&#x7528;&#x8FDC;&#x7A0B;&#x901A;&#x4FE1;&#xFF0C;&#x7684;&#x786E;&#x80FD;&#x7ED9;&#x6211;&#x4EEC;&#x5E26;&#x6765;&#x66F4;&#x5F3A;&#x5927;&#x7684;Attach&#x7075;&#x6D3B;&#x6027;&#xFF0C;&#x4F46;&#x9700;&#x8981;JVM&#x66B4;&#x9732;&#x7AEF;&#x53E3;&#xFF0C;&#x540C;&#x6837;&#x5177;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x5B89;&#x5168;&#x95EE;&#x9898;&#x3002;<br>&#x672C;&#x5730;&#x901A;&#x8BAF;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x91C7;&#x7528;UNIX Domain Socket&#xFF0C;&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x5F62;&#x5F0F;&#x901A;&#x8BAF;&#x3002;&#x4E0D;&#x4F46;&#x5177;&#x6709;&#x8F83;&#x9AD8;&#x7684;&#x901A;&#x4FE1;&#x901F;&#x5EA6;&#xFF0C;&#x540C;&#x65F6;&#x5177;&#x6709;&#x4E00;&#x5B9A;&#x7684;&#x5B89;&#x5168;&#x6027;&#x3002;</p>\n<p>&#x5982;&#x679C;&#x91C7;&#x7528;Socket Local&#x901A;&#x4FE1;&#xFF0C;&#x90A3;&#x6211;&#x4EEC;&#x53C8;&#x5982;&#x4F55;&#x4E0E;JVM&#x5EFA;&#x7ACB;&#x8D77;&#x901A;&#x4FE1;&#x5462;&#xFF1F;</p>\n<h4 id=\"3-&#x4FE1;&#x53F7;&#x76D1;&#x542C;&#x6CD5;\"><a href=\"#3-&#x4FE1;&#x53F7;&#x76D1;&#x542C;&#x6CD5;\" class=\"headerlink\" title=\"3.&#x4FE1;&#x53F7;&#x76D1;&#x542C;&#x6CD5;\"></a>3.&#x4FE1;&#x53F7;&#x76D1;&#x542C;&#x6CD5;</h4><p>&#x5176;&#x5B9E;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;Socket&#x901A;&#x4FE1;&#x6CD5;&#x7684;&#x8865;&#x5145;&#x3002;&#x5728;&#x4E0E;JVM&#x5EFA;&#x7ACB;&#x8D77;&#x672C;&#x5730;&#x901A;&#x4FE1;&#x524D;&#xFF0C;JVM&#x9700;&#x8981;&#x77E5;&#x9053;&#x7528;&#x6237;&#x60F3;&#x8981;&#x5F00;&#x59CB;&#x52A8;&#x6001;Attach&#x3002;&#x800C;&#x4FE1;&#x53F7;&#x76D1;&#x542C;&#x5C31;&#x80FD;&#x8865;&#x5145;&#x8FD9;&#x65B9;&#x9762;&#x7684;&#x529F;&#x80FD;&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x7EA6;&#x5B9A;&#x7684;&#x5F62;&#x5F0F;&#x5411;JVM&#x8FDB;&#x7A0B;&#x53D1;&#x8D77;&#x6307;&#x5B9A;&#x4FE1;&#x53F7;&#xFF0C;&#x540C;&#x65F6;JVM&#x5728;&#x76D1;&#x542C;&#x5230;Attach&#x4FE1;&#x53F7;&#x540E;&#x4E0E;&#x5BA2;&#x6237;&#x7AEF;&#x5EFA;&#x7ACB;Socket&#x94FE;&#x63A5;&#x3002;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;Socket&#x65B9;&#x5F0F;&#x5C06;&#x9700;&#x8981;&#x52A0;&#x8F7D;&#x7684;&#x7C7B;&#x544A;&#x77E5;JVM&#x5E76;&#x8FDB;&#x884C;&#x52A0;&#x8F7D;&#x5E76;&#x6700;&#x7EC8;&#x8FD0;&#x884C;&#x6211;&#x4EEC;&#x540E;&#x9762;&#x719F;&#x6089;&#x7684;javaagent&#x6D41;&#x7A0B;&#x3002;</p>\n<p>&#x6211;&#x867D;&#x7136;&#x4E0D;&#x662F;JDK&#x7684;&#x5DE5;&#x7A0B;&#x5E08;&#xFF0C;&#x4E0A;&#x9762;&#x7684;3&#x4E2A;&#x65B9;&#x6848;&#x4E5F;&#x662F;&#x7ED3;&#x5408;&#x4E86;JDK1.8&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x540E;&#x5927;&#x80C6;&#x7684;&#x63E3;&#x6D4B;&#x4E86;&#x5F53;&#x65F6;&#x5F00;&#x53D1;&#x5DE5;&#x7A0B;&#x5E08;&#x7684;&#x60F3;&#x6CD5;&#x3002;&#x53EF;&#x80FD;&#x5F53;&#x65F6;&#x6446;&#x5728;&#x4ED6;&#x9762;&#x524D;&#x7684;&#x65B9;&#x6848;&#x66F4;&#x662F;&#x6210;&#x5343;&#x4E0A;&#x4E07;&#xFF0C;&#x4F46;&#x662F;&#x6700;&#x7EC8;&#x786E;&#x5B9A;&#x4E0B;&#x8FD9;&#x4E2A;&#x6280;&#x672F;&#x65B9;&#x6848;&#x7684;&#x5FC3;&#x8DEF;&#x5386;&#x7A0B;&#x6211;&#x89C9;&#x5F97;&#x662F;&#x6211;&#x4EEC;&#x6BCF;&#x4E2A;&#x5F00;&#x53D1;&#x90FD;&#x9700;&#x8981;&#x611F;&#x540C;&#x8EAB;&#x53D7;&#x7684;&#x3002;</p>\n<h2 id=\"&#x4E09;&#x3001;&#x4E3E;&#x4E00;&#x4E2A;&#x6817;&#x5B50;\"><a href=\"#&#x4E09;&#x3001;&#x4E3E;&#x4E00;&#x4E2A;&#x6817;&#x5B50;\" class=\"headerlink\" title=\"&#x4E09;&#x3001;&#x4E3E;&#x4E00;&#x4E2A;&#x6817;&#x5B50;\"></a>&#x4E09;&#x3001;&#x4E3E;&#x4E00;&#x4E2A;&#x6817;&#x5B50;</h2><p>&#x524D;&#x9762;&#x6211;&#x4EEC;&#x5206;&#x6790;&#x4E86;&#x5B9E;&#x73B0;&#x65B9;&#x6848;&#xFF0C;&#x6211;&#x4EEC;&#x5148;&#x4E22;&#x4E00;&#x4EFD;&#x4EE3;&#x7801;&#x6765;&#x9A8C;&#x8BC1;&#x4E0A;&#x9762;&#x7684;&#x65B9;&#x6848;&#xFF08;&#x4EE3;&#x7801;&#x4E3A;JDK1.8&#x6E90;&#x7801;&#x76F8;&#x5173;&#x529F;&#x80FD;&#x7684;&#x7B80;&#x5316;&#x7248;&#xFF09;</p>\n<h3 id=\"&#x5F00;&#x59CB;&#x5B9E;&#x9A8C;\"><a href=\"#&#x5F00;&#x59CB;&#x5B9E;&#x9A8C;\" class=\"headerlink\" title=\"&#x5F00;&#x59CB;&#x5B9E;&#x9A8C;\"></a>&#x5F00;&#x59CB;&#x5B9E;&#x9A8C;</h3><p><font color=\"blue\">&#x9700;&#x6C42;&#xFF1A;</font>&#x5B9E;&#x73B0;&#x52A8;&#x6001;Attach API&#xFF0C;&#x63A5;&#x6536;java -jar xxx.jar pid&#x53D1;&#x8D77;&#x7684;&#x6302;&#x8F7D;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x5C06;loadAgent&#x6307;&#x5B9A;&#x7684;Jar&#x5305;&#x5B8C;&#x6574;&#x8DEF;&#x5F84;&#x663E;&#x793A;&#x5728;&#x63A7;&#x5236;&#x53F0;&#x3002;</p>\n<p><font color=\"blue\">&#x5B9E;&#x9A8C;&#x73AF;&#x5883;&#xFF1A;</font>MacOS 10.15.6</p>\n<p><font color=\"blue\">&#x9879;&#x76EE;&#x5730;&#x5740;&#xFF1A;</font></p>\n<blockquote>\n<p><a href=\"https://github.com/xzenge/JVM_ATTACH/tree/dev\">https://github.com/xzenge/JVM_ATTACH/tree/dev</a></p>\n</blockquote>\n<h5 id=\"&#x6211;&#x4EEC;&#x5148;&#x542F;&#x52A8;&#x9879;&#x76EE;&#x3002;&#x8BE5;&#x9879;&#x76EE;&#x6A21;&#x62DF;&#x4E86;JVM&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x4F46;&#x53EA;&#x5B9E;&#x73B0;&#x4E86;Attach-API&#x7684;&#x90E8;&#x5206;&#x529F;&#x80FD;&#x3002;&#x9879;&#x76EE;&#x542F;&#x52A8;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F53;&#x524D;&#x7684;JVM&#x8FDB;&#x7A0B;ID&#x4E3A;&#xFF1A;32910\"><a href=\"#&#x6211;&#x4EEC;&#x5148;&#x542F;&#x52A8;&#x9879;&#x76EE;&#x3002;&#x8BE5;&#x9879;&#x76EE;&#x6A21;&#x62DF;&#x4E86;JVM&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x4F46;&#x53EA;&#x5B9E;&#x73B0;&#x4E86;Attach-API&#x7684;&#x90E8;&#x5206;&#x529F;&#x80FD;&#x3002;&#x9879;&#x76EE;&#x542F;&#x52A8;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F53;&#x524D;&#x7684;JVM&#x8FDB;&#x7A0B;ID&#x4E3A;&#xFF1A;32910\" class=\"headerlink\" title=\"&#x6211;&#x4EEC;&#x5148;&#x542F;&#x52A8;&#x9879;&#x76EE;&#x3002;&#x8BE5;&#x9879;&#x76EE;&#x6A21;&#x62DF;&#x4E86;JVM&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x4F46;&#x53EA;&#x5B9E;&#x73B0;&#x4E86;Attach API&#x7684;&#x90E8;&#x5206;&#x529F;&#x80FD;&#x3002;&#x9879;&#x76EE;&#x542F;&#x52A8;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F53;&#x524D;&#x7684;JVM&#x8FDB;&#x7A0B;ID&#x4E3A;&#xFF1A;32910\"></a>&#x6211;&#x4EEC;&#x5148;&#x542F;&#x52A8;&#x9879;&#x76EE;&#x3002;&#x8BE5;&#x9879;&#x76EE;&#x6A21;&#x62DF;&#x4E86;JVM&#x8FD0;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x4F46;&#x53EA;&#x5B9E;&#x73B0;&#x4E86;Attach API&#x7684;&#x90E8;&#x5206;&#x529F;&#x80FD;&#x3002;&#x9879;&#x76EE;&#x542F;&#x52A8;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F53;&#x524D;&#x7684;JVM&#x8FDB;&#x7A0B;ID&#x4E3A;&#xFF1A;<font color=\"red\">32910</font></h5><p><img src=\"/2020/09/21/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90JVM-%E5%8A%A8%E6%80%81Attach%E5%8E%9F%E7%90%86/JVM_start.png\" alt=\"01\"></p>\n<hr>\n<h5 id=\"&#x6309;&#x7167;JDK&#x89C4;&#x8303;&#x7F16;&#x5199;JAVA&#x6D4B;Attach&#x65B9;&#x6CD5;&#x3002;&#x4E3A;&#x4E86;&#x7B80;&#x4FBF;&#xFF0C;&#x65B9;&#x6CD5;&#x4E2D;&#x6211;&#x4EEC;&#x624B;&#x52A8;&#x6307;&#x5B9A;&#x4E86;attach&#x7684;&#x7EBF;&#x7A0B;&#x53F7;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x4E86;JVM&#x9700;&#x8981;&#x52A0;&#x8F7D;&#x7684;Jar&#x5305;&#x8DEF;&#x5F84;&#x3002;\"><a href=\"#&#x6309;&#x7167;JDK&#x89C4;&#x8303;&#x7F16;&#x5199;JAVA&#x6D4B;Attach&#x65B9;&#x6CD5;&#x3002;&#x4E3A;&#x4E86;&#x7B80;&#x4FBF;&#xFF0C;&#x65B9;&#x6CD5;&#x4E2D;&#x6211;&#x4EEC;&#x624B;&#x52A8;&#x6307;&#x5B9A;&#x4E86;attach&#x7684;&#x7EBF;&#x7A0B;&#x53F7;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x4E86;JVM&#x9700;&#x8981;&#x52A0;&#x8F7D;&#x7684;Jar&#x5305;&#x8DEF;&#x5F84;&#x3002;\" class=\"headerlink\" title=\"&#x6309;&#x7167;JDK&#x89C4;&#x8303;&#x7F16;&#x5199;JAVA&#x6D4B;Attach&#x65B9;&#x6CD5;&#x3002;&#x4E3A;&#x4E86;&#x7B80;&#x4FBF;&#xFF0C;&#x65B9;&#x6CD5;&#x4E2D;&#x6211;&#x4EEC;&#x624B;&#x52A8;&#x6307;&#x5B9A;&#x4E86;attach&#x7684;&#x7EBF;&#x7A0B;&#x53F7;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x4E86;JVM&#x9700;&#x8981;&#x52A0;&#x8F7D;&#x7684;Jar&#x5305;&#x8DEF;&#x5F84;&#x3002;\"></a>&#x6309;&#x7167;JDK&#x89C4;&#x8303;&#x7F16;&#x5199;JAVA&#x6D4B;Attach&#x65B9;&#x6CD5;&#x3002;&#x4E3A;&#x4E86;&#x7B80;&#x4FBF;&#xFF0C;&#x65B9;&#x6CD5;&#x4E2D;&#x6211;&#x4EEC;&#x624B;&#x52A8;&#x6307;&#x5B9A;&#x4E86;attach&#x7684;&#x7EBF;&#x7A0B;&#x53F7;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x4E86;JVM&#x9700;&#x8981;&#x52A0;&#x8F7D;&#x7684;Jar&#x5305;&#x8DEF;&#x5F84;&#x3002;</h5><figure class=\"highlight java hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Attach</span> </span>{</span><br><span class=\"line\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException, AttachNotSupportedException, AgentLoadException, AgentInitializationException </span>{</span><br><span class=\"line\">        VirtualMachine attach = VirtualMachine.attach(<span class=\"hljs-string\">&quot;32910&quot;</span>);</span><br><span class=\"line\">        attach.loadAgentPath(<span class=\"hljs-string\">&quot;/Users/xiangshi/.gradle/caches/modules-2/files-2.1/cglib/cglib/3.1/1f1cb6c7a7479e0c7fd7987109e503914bebe84a/cglib-3.1.jar&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br></pre></td></tr></tbody></table></figure>\n\n<hr>\n<h5 id=\"&#x8FD0;&#x884C;Java-attach&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230;&#x6A21;&#x62DF;&#x7684;JVM&#x5DF2;&#x7ECF;&#x8BFB;&#x53D6;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x5E0C;&#x671B;classloader&#x7684;Jar&#x5305;\"><a href=\"#&#x8FD0;&#x884C;Java-attach&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230;&#x6A21;&#x62DF;&#x7684;JVM&#x5DF2;&#x7ECF;&#x8BFB;&#x53D6;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x5E0C;&#x671B;classloader&#x7684;Jar&#x5305;\" class=\"headerlink\" title=\"&#x8FD0;&#x884C;Java attach&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230;&#x6A21;&#x62DF;&#x7684;JVM&#x5DF2;&#x7ECF;&#x8BFB;&#x53D6;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x5E0C;&#x671B;classloader&#x7684;Jar&#x5305;\"></a>&#x8FD0;&#x884C;Java attach&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x89C2;&#x5BDF;&#x5230;&#x6A21;&#x62DF;&#x7684;JVM&#x5DF2;&#x7ECF;&#x8BFB;&#x53D6;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x5E0C;&#x671B;classloader&#x7684;Jar&#x5305;</h5><p><img src=\"/2020/09/21/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90JVM-%E5%8A%A8%E6%80%81Attach%E5%8E%9F%E7%90%86/load_agent_library.png\" alt=\"02\"></p>\n<hr>\n<h3 id=\"&#x5B9E;&#x9A8C;&#x5206;&#x6790;\"><a href=\"#&#x5B9E;&#x9A8C;&#x5206;&#x6790;\" class=\"headerlink\" title=\"&#x5B9E;&#x9A8C;&#x5206;&#x6790;\"></a>&#x5B9E;&#x9A8C;&#x5206;&#x6790;</h3><p>&#x5B9E;&#x9A8C;&#x8FC7;&#x7A0B;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x6211;&#x4EEC;&#x4F2A;&#x9020;&#x4E86;&#x4E2A;JVM&#x8FD0;&#x884C;&#x65F6;&#x73AF;&#x5883;&#x3002;&#x5E76;&#x901A;&#x8FC7;JAVA&#x539F;&#x751F;&#x7684;Attach API&#x6210;&#x529F;&#x7684;&#x5B9E;&#x73B0;&#x4E86;&#x4E0E;JVM&#x4E4B;&#x95F4;&#x901A;&#x8BAF;&#x7684;&#x529F;&#x80FD;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x5F00;&#x59CB;&#x9010;&#x6B65;&#x5206;&#x6790;&#x5177;&#x4F53;&#x7684;&#x5B9E;&#x73B0;&#x8FC7;&#x7A0B;&#xFF1A;</p>\n<ul>\n<li>&#x76D1;&#x542C;signal<br>&#x521D;&#x59CB;&#x5316;OS&#x4FE1;&#x53F7;&#x76D1;&#x542C;&#x7684;&#x76F8;&#x5173;&#x6570;&#x636E;</li>\n</ul>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\">/**</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * JVM&#x542F;&#x52A8;&#x65F6;&#x76D1;&#x542C;signal</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> */</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">os::signal_init</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">    <span class=\"hljs-comment\">//&#x521D;&#x59CB;&#x5316;signal&#x76D1;&#x542C;pending_signals</span></span><br><span class=\"line\">    os::signal_init_pd();</span><br><span class=\"line\">    <span class=\"hljs-comment\">//&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x76D1;&#x542C;pending_signals&#x72B6;&#x6001;&#x5E76;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x5904;&#x7406;</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">pthread_t</span> tids;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">int</span> ret = pthread_create(&amp;tids, <span class=\"hljs-literal\">NULL</span>, <span class=\"hljs-keyword\">reinterpret_cast</span>&lt;<span class=\"hljs-keyword\">void</span> *(*)(<span class=\"hljs-keyword\">void</span> *)&gt;(signal_thread_entry), <span class=\"hljs-literal\">NULL</span>);</span><br><span class=\"line\">    <span class=\"hljs-comment\">//&#x6CE8;&#x518C;signal&#x5904;&#x7406;&#x5668;</span></span><br><span class=\"line\">    os::signal(SIGBREAK,os::user_handler());</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>sigaction&#x65B9;&#x6CD5;&#x63D0;&#x4F9B;os&#x4FE1;&#x53F7;&#x7684;&#x76D1;&#x542C;&#x5E76;&#x6CE8;&#x518C;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x76D1;&#x542C;-3 SIGQUIT&#x4FE1;&#x53F7;&#x3002;</p>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\">/**</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * &#x6CE8;&#x518C;&#x76D1;&#x542C;&#x4FE1;&#x53F7;&amp;&#x5904;&#x7406;&#x5668;</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * @param signal_number &#x4FE1;&#x53F7;&#x7F16;&#x53F7;</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * @param handler &#x4FE1;&#x53F7;&#x5904;&#x7406;&#x5668;</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * @return</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> */</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> *<span class=\"hljs-title\">os::signal</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> signal_number, <span class=\"hljs-keyword\">void</span> *handler)</span> </span>{</span><br><span class=\"line\">    <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">sigaction</span> <span class=\"hljs-title\">sigAct</span>, <span class=\"hljs-title\">oldSigAct</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sigfillset(&amp;(sigAct.sa_mask));</span><br><span class=\"line\">    sigAct.sa_flags   = SA_RESTART|SA_SIGINFO;</span><br><span class=\"line\">    sigAct.sa_handler = CAST_TO_FN_PTR(<span class=\"hljs-keyword\">sa_handler_t</span>, handler);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (sigaction(signal_number, &amp;sigAct, &amp;oldSigAct)) {</span><br><span class=\"line\">        <span class=\"hljs-comment\">// -1 means registration failed</span></span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> (<span class=\"hljs-keyword\">void</span> *)<span class=\"hljs-number\">-1</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">return</span> CAST_FROM_FN_PTR(<span class=\"hljs-keyword\">void</span>*, oldSigAct.sa_handler);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x5668;&#x4E2D;&#x7B80;&#x5355;&#x7684;&#x6A21;&#x62DF;&#x7684;&#x6536;&#x5230;&#x4FE1;&#x53F7;&#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#xFF0C;&#x6570;&#x7EC4;&#x5BF9;&#x5E94;&#x7684;&#x4FE1;&#x53F7;&#x4F4D;&#x7F6E;&#x4E3A;1&#x65F6;&#xFF0C;&#x8BF4;&#x660E;&#x6536;&#x5230;&#x4E86;&#x5BF9;&#x5E94;&#x7684;&#x4FE1;&#x53F7;&#x3002;</p>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\">/**</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * &#x901A;&#x8FC7;pending_signals&#x4FDD;&#x7559;&#x76D1;&#x542C;&#x5230;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x4EA4;&#x7531;&#x4E13;&#x95E8;&#x7684;&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x8BE5;&#x4FE1;&#x606F;</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * @param signal_number</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> */</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">os::signal_notify</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> signal_number)</span> </span>{</span><br><span class=\"line\">    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">&quot;enter signal_notify sig:&quot;</span> &lt;&lt; signal_number &lt;&lt; <span class=\"hljs-built_in\">endl</span>;</span><br><span class=\"line\">    <span class=\"hljs-comment\">//&#x5C06;&#x76D1;&#x542C;&#x5230;&#x7684;&#x4FE1;&#x53F7;&#x4E3A;&#x7AD6;&#x4E3A;1</span></span><br><span class=\"line\">    <span class=\"hljs-comment\">//&#x6539;&#x64CD;&#x4F5C;&#x5E94;&#x8BE5;&#x4E3A;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#xFF0C;&#x786E;&#x4FDD;&#x4E0D;&#x4F1A;&#x88AB;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x4FEE;&#x6539;</span></span><br><span class=\"line\">    <span class=\"hljs-comment\">//JVM&#x4E2D;&#x6DF7;&#x7F16;&#x5E73;&#x53F0;&#x76F8;&#x5173;&#x6C47;&#x7F16;&#x6307;&#x4EE4;&#x5B9E;&#x73B0;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#xFF0C;&#x6F14;&#x793A;&#x4EE3;&#x7801;&#x4E2D;&#x4E0D;&#x7814;&#x7A76;&#x76F8;&#x5173;&#x5B9E;&#x73B0;</span></span><br><span class=\"line\">    pending_signals[signal_number] = <span class=\"hljs-number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    semaphore_signal(sig_sem);</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x5355;&#x72EC;&#x8D77;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x8BE5;&#x7EBF;&#x7A0B;&#x8F6E;&#x8BAD;&#x4FE1;&#x53F7;&#x63A5;&#x53D7;&#x6570;&#x7EC4;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x5C06;&#x7F6E;&#x4E3A;1&#x7684;&#x4FE1;&#x53F7;&#x7801;&#x4F20;&#x7ED9;&#x4E0B;&#x6E38;&#x5904;&#x7406;&#x3002;&#x5F53;&#x4FE1;&#x53F7;&#x4F4D;-3 SIGQUIT&#x4FE1;&#x53F7;&#x65F6;&#xFF0C;&#x5F00;&#x59CB;&#x521D;&#x59CB;&#x5316;attach&#x7684;&#x76D1;&#x542C;&#x65B9;&#x6CD5;&#x3002;</p>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\">/**</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * &#x5355;&#x72EC;&#x7EBF;&#x7A0B;&#x5BF9;pending_signals&#x72B6;&#x6001;&#x5E76;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x5904;&#x7406;</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> */</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">signal_thread_entry</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">&quot;enter signal_thread_entry&quot;</span> &lt;&lt; <span class=\"hljs-built_in\">endl</span>;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>){</span><br><span class=\"line\">        <span class=\"hljs-keyword\">int</span> sig;</span><br><span class=\"line\">        {</span><br><span class=\"line\">            sig = os::signal_wait();</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"hljs-keyword\">switch</span> (sig) {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">case</span> SIGBREAK: {</span><br><span class=\"line\">                <span class=\"hljs-keyword\">if</span> (AttachListener::init()) {</span><br><span class=\"line\">                    <span class=\"hljs-keyword\">continue</span>;</span><br><span class=\"line\">                }</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x521D;&#x59CB;&#x5316;attach&#x76D1;&#x542C;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;Domain Socket&#x7684;&#x6587;&#x4EF6;&#x76D1;&#x542C;&#xFF0C;&#x5E76;accept&#x5728;&#x6539;&#x6587;&#x4EF6;&#x4E0A;&#x3002;</p>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\">/**</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * &#x521D;&#x59CB;&#x5316;domain socket&#x76D1;&#x542C;</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * JVM&#x901A;&#x8FC7;&#x76D1;&#x542C;&#x6307;&#x5B9A;&#x7EBF;&#x7A0B;&#x6587;&#x4EF6;&#x6587;&#x4EF6;</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * &#x83B7;&#x53D6;client&#x60F3;JVM&#x53D1;&#x9001;&#x7684;&#x6307;&#x4EE4;&#x5E76;&#x8FDB;&#x884C;&#x76F8;&#x5173;&#x64CD;&#x4F5C;</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * @return</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> */</span></span><br><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">AttachListener::pd_init</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">char</span> path[UNIX_PATH_MAX];          <span class=\"hljs-comment\">// socket file</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">char</span> initial_path[UNIX_PATH_MAX];  <span class=\"hljs-comment\">// socket file during setup</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">int</span> listener;                      <span class=\"hljs-comment\">// listener socket (file descriptor)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-comment\">// register function to cleanup</span></span><br><span class=\"line\">    ::atexit(listener_cleanup);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">int</span> n = <span class=\"hljs-built_in\">snprintf</span>(path, UNIX_PATH_MAX, <span class=\"hljs-string\">&quot;%s/.java_pid%d&quot;</span>,</span><br><span class=\"line\">                     TEMP_PATH, getpid());</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (n &lt; (<span class=\"hljs-keyword\">int</span>) UNIX_PATH_MAX) {</span><br><span class=\"line\">        n = <span class=\"hljs-built_in\">snprintf</span>(initial_path, UNIX_PATH_MAX, <span class=\"hljs-string\">&quot;%s.tmp&quot;</span>, path);</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (n &gt;= (<span class=\"hljs-keyword\">int</span>) UNIX_PATH_MAX) {</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">-1</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"hljs-built_in\">cout</span> &lt;&lt; <span class=\"hljs-string\">&quot;path:&quot;</span> &lt;&lt; path &lt;&lt; <span class=\"hljs-built_in\">endl</span>;</span><br><span class=\"line\">    <span class=\"hljs-comment\">// create the listener socket</span></span><br><span class=\"line\">    listener = ::socket(PF_UNIX, SOCK_STREAM, <span class=\"hljs-number\">0</span>);</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (listener == <span class=\"hljs-number\">-1</span>) {</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">-1</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-comment\">// bind socket</span></span><br><span class=\"line\">    <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">sockaddr_un</span> <span class=\"hljs-title\">addr</span>;</span></span><br><span class=\"line\">    addr.sun_family = AF_UNIX;</span><br><span class=\"line\">    <span class=\"hljs-built_in\">strcpy</span>(addr.sun_path, initial_path);</span><br><span class=\"line\">    ::unlink(initial_path);</span><br><span class=\"line\">    <span class=\"hljs-keyword\">int</span> res = ::bind(listener, (struct sockaddr *) &amp;addr, <span class=\"hljs-keyword\">sizeof</span>(addr));</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (res == <span class=\"hljs-number\">-1</span>) {</span><br><span class=\"line\">        ::close(listener);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">-1</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-comment\">// put in listen mode, set permissions, and rename into place</span></span><br><span class=\"line\">    res = ::listen(listener, <span class=\"hljs-number\">5</span>);</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (res == <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">        RESTARTABLE(::chmod(initial_path, S_IREAD | S_IWRITE), res);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (res == <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">if</span> (res == <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">                res = ::rename(initial_path, path);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (res == <span class=\"hljs-number\">-1</span>) {</span><br><span class=\"line\">        ::close(listener);</span><br><span class=\"line\">        ::unlink(initial_path);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">-1</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    set_path(path);</span><br><span class=\"line\">    set_listener(listener);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">0</span>;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x4E00;&#x65E6;&#x6536;&#x5230;java&#x53D1;&#x9001;&#x8FC7;&#x6765;&#x7684;socket&#x8BF7;&#x6C42;&#xFF0C;&#x5219;&#x89E3;&#x6790;&#x8BE5;&#x8BF7;&#x6C42;&#x5E76;&#x5305;&#x88C5;&#x4E3A;AttachOperation&#x5BF9;&#x8C61;&#x3002;</p>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-comment\">/**</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * accept domain socket&#xFF0C;&#x8BFB;&#x53D6;&#x5230;&#x5185;&#x5BB9;&#x540E;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;AttachOperation</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> * @return</span></span><br><span class=\"line\"><span class=\"hljs-comment\"> */</span></span><br><span class=\"line\"><span class=\"hljs-function\">AttachOperation *<span class=\"hljs-title\">AttachListener::dequeue</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">for</span> (;;) {</span><br><span class=\"line\">        <span class=\"hljs-keyword\">int</span> s;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">// wait for client to connect</span></span><br><span class=\"line\">        <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">sockaddr</span> <span class=\"hljs-title\">addr</span>;</span></span><br><span class=\"line\">        <span class=\"hljs-keyword\">socklen_t</span> len = <span class=\"hljs-keyword\">sizeof</span>(addr);</span><br><span class=\"line\">        RESTARTABLE(::accept(listener(), &amp;addr, &amp;len), s);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (s == <span class=\"hljs-number\">-1</span>) {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">NULL</span>;      <span class=\"hljs-comment\">// log a warning?</span></span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">// get the credentials of the peer and check the effective uid/guid</span></span><br><span class=\"line\">        <span class=\"hljs-comment\">// - check with jeff on this.</span></span><br><span class=\"line\">        <span class=\"hljs-keyword\">uid_t</span> puid;</span><br><span class=\"line\">        <span class=\"hljs-keyword\">gid_t</span> pgid;</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (::getpeereid(s, &amp;puid, &amp;pgid) != <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">            ::close(s);</span><br><span class=\"line\">            <span class=\"hljs-keyword\">continue</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"hljs-keyword\">uid_t</span> euid = geteuid();</span><br><span class=\"line\">        <span class=\"hljs-keyword\">gid_t</span> egid = getegid();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">//&#x68C0;&#x67E5;DS&#x6587;&#x4EF6;&#x662F;&#x5426;&#x4E3A;&#x540C;&#x4E00;&#x4E2A;&#x7528;&#x6237;&#x521B;&#x5EFA;</span></span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (puid != euid || pgid != egid) {</span><br><span class=\"line\">            ::close(s);</span><br><span class=\"line\">            <span class=\"hljs-keyword\">continue</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">// &#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#xFF0C;&#x751F;&#x6210;AttachOperation&#x5BF9;&#x8C61;</span></span><br><span class=\"line\">        AttachOperation *op = read_request(s);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (op == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">            ::close(s);</span><br><span class=\"line\">            <span class=\"hljs-keyword\">continue</span>;</span><br><span class=\"line\">        } <span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">return</span> op;</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x6700;&#x540E;&#x7528;&#x5305;&#x88C5;&#x540E;&#x7684;AttachOperation&#xFF0C;&#x901A;&#x8FC7;&#x51FD;&#x6570;&#x6307;&#x9488;&#x8C03;&#x7528;&#x5DF2;&#x7ED1;&#x5B9A;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#x3002;</p>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">attach_listener_thread_entry</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">    <span class=\"hljs-keyword\">int</span> pdint = AttachListener::pd_init();</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (pdint != <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">        <span class=\"hljs-keyword\">return</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    AttachListener::set_initialized();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">for</span> (;;) {</span><br><span class=\"line\">        AttachOperation* op = AttachListener::dequeue();</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (op == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">return</span>;   <span class=\"hljs-comment\">// dequeue failed or shutdown</span></span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-comment\">// find the function to dispatch too</span></span><br><span class=\"line\">        AttachOperationFunctionInfo* info = <span class=\"hljs-literal\">NULL</span>;</span><br><span class=\"line\">        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i=<span class=\"hljs-number\">0</span>; funcs[i].name != <span class=\"hljs-literal\">NULL</span>; i++) {</span><br><span class=\"line\">            <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">char</span>* name = funcs[i].name;</span><br><span class=\"line\">            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">strcmp</span>(op-&gt;name(), name) == <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">                info = &amp;(funcs[i]);</span><br><span class=\"line\">                <span class=\"hljs-keyword\">break</span>;</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (info != <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">            <span class=\"hljs-comment\">// dispatch to the function that implements this operation</span></span><br><span class=\"line\">            (info-&gt;func)(op);</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p><font color=\"red\">&#x603B;&#x7ED3;</font> &#xFF0C;&#x901A;&#x8FC7;&#x4FE1;&#x53F7;&#x76D1;&#x542C;&#x2013;&gt;socket&#x901A;&#x4FE1;&#x2013;&gt;&#x8C03;&#x7528;&#x6307;&#x5B9A;&#x65B9;&#x6CD5;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;&#x6211;&#x4EEC;&#x5B9E;&#x9A8C;&#x7684;&#x9884;&#x671F;&#x3002;</p>\n<h2 id=\"&#x56DB;&#x3001;&#x770B;&#x770B;JVM&#x662F;&#x600E;&#x4E48;&#x505A;&#x7684;\"><a href=\"#&#x56DB;&#x3001;&#x770B;&#x770B;JVM&#x662F;&#x600E;&#x4E48;&#x505A;&#x7684;\" class=\"headerlink\" title=\"&#x56DB;&#x3001;&#x770B;&#x770B;JVM&#x662F;&#x600E;&#x4E48;&#x505A;&#x7684;\"></a>&#x56DB;&#x3001;&#x770B;&#x770B;JVM&#x662F;&#x600E;&#x4E48;&#x505A;&#x7684;</h2><p>&#x6700;&#x540E;&#x6211;&#x4EEC;&#x56DE;&#x5230;JVM&#x5185;&#x90E8;&#xFF0C;&#x770B;&#x770B;JVM&#x662F;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>\n<p>&#x7531;&#x4E8E;&#x5B9E;&#x9A8C;&#x4EE3;&#x7801;&#x5927;&#x91CF;&#x7684;&#x91C7;&#x7528;&#x4E86;JVM&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x89C2;&#x5BDF;JVM&#x7684;&#x6D41;&#x7A0B;&#x3002;</p>\n<ul>\n<li>JVM&#x542F;&#x52A8;&#x65F6;&#x4F1A;&#x521D;&#x59CB;&#x5316;&#x4FE1;&#x53F7;&#x7684;&#x76D1;&#x542C;</li>\n</ul>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/vm/runtime/thread.cpp</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\">jint <span class=\"hljs-title\">Threads::create_vm</span><span class=\"hljs-params\">(JavaVMInitArgs* args, <span class=\"hljs-keyword\">bool</span>* canTryAgain)</span> </span>{</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"hljs-comment\">// Signal Dispatcher needs to be started before VMInit event is posted</span></span><br><span class=\"line\">  os::signal_init();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"hljs-comment\">// Start Attach Listener if +StartAttachListener or it can&apos;t be started lazily</span></span><br><span class=\"line\">  <span class=\"hljs-keyword\">if</span> (!DisableAttachMechanism) {</span><br><span class=\"line\">    AttachListener::vm_start();</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (StartAttachListener || AttachListener::init_at_startup()) {</span><br><span class=\"line\">      AttachListener::init();</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">    ...</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>os::signal_init();&#x529F;&#x80FD;&#x6211;&#x4EEC;&#x524D;&#x9762;&#x5DF2;&#x7ECF;&#x5206;&#x6790;&#x8FC7;&#xFF0C;JVM&#x4F1A;&#x6CE8;&#x518C;kill -3&#x4FE1;&#x53F7;&#x7684;&#x76D1;&#x542C;&#x548C;&#x5BF9;&#x5E94;&#x7684;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x540C;&#x65F6;&#x4F1A;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x7EBF;&#x7A0B;&#x5BF9;&#x76D1;&#x542C;&#x5230;&#x7684;&#x4FE1;&#x53F7;&#x505A;&#x540E;&#x7EED;&#x4E1A;&#x52A1;&#x5904;&#x7406;&#x3002;</p>\n<p><font color=\"blue\">DisableAttachMechanism</font> &amp; <font color=\"blue\">StartAttachListener</font> &#x9ED8;&#x8BA4;&#x4E3A;false&#xFF0C;&#x5728;JVM&#x9ED8;&#x8BA4;&#x542F;&#x52A8;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4E0D;&#x4F1A;&#x521D;&#x59CB;&#x5316;Attach&#x7684;&#x76D1;&#x542C;&#x3002;</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/vm/runtime/globals.hpp</p>\n</blockquote>\n<figure class=\"highlight plain hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">product(bool, DisableAttachMechanism, false,                              \\</span><br><span class=\"line\">        &quot;Disable mechanism that allows tools to attach to this VM&quot;) </span><br><span class=\"line\">product(bool, StartAttachListener, false,                                 \\</span><br><span class=\"line\">        &quot;Always start Attach Listener at VM startup&quot;)      </span><br></pre></td></tr></tbody></table></figure>\n\n<p>JVM&#x76D1;&#x542C;&#x5230;&#x4FE1;&#x53F7;&#x540E;&#xFF0C;&#x5F53;&#x4FE1;&#x53F7;&#x4F4D;kill -3&#x65F6;&#x5982;&#x679C;&#x8FD8;&#x672A;&#x521D;&#x59CB;&#x5316;attach&#x76D1;&#x542C;&#xFF0C;&#x5C06;&#x4F1A;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;&#x3002;</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/vm/runtime/thread.cpp-&gt;create_vm()<br>            &#x2014;- src/share/vm/runtime/os.cpp-&gt;signal_init()<br>                &#x2014;- src/share/vm/runtime/os.cpp-&gt;signal_thread_entry()</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">signal_thread_entry</span><span class=\"hljs-params\">(JavaThread* thread, TRAPS)</span> </span>{</span><br><span class=\"line\">  os::set_priority(thread, NearMaxPriority);</span><br><span class=\"line\">  <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {</span><br><span class=\"line\">    <span class=\"hljs-keyword\">int</span> sig;</span><br><span class=\"line\">    {</span><br><span class=\"line\">      <span class=\"hljs-comment\">// FIXME : Currently we have not decieded what should be the status</span></span><br><span class=\"line\">      <span class=\"hljs-comment\">//         for this java thread blocked here. Once we decide about</span></span><br><span class=\"line\">      <span class=\"hljs-comment\">//         that we should fix this.</span></span><br><span class=\"line\">      sig = os::signal_wait();</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (sig == os::sigexitnum_pd()) {</span><br><span class=\"line\">       <span class=\"hljs-comment\">// Terminate the signal thread</span></span><br><span class=\"line\">       <span class=\"hljs-keyword\">return</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">switch</span> (sig) {</span><br><span class=\"line\">      <span class=\"hljs-keyword\">case</span> SIGBREAK: {</span><br><span class=\"line\">        <span class=\"hljs-comment\">// Check if the signal is a trigger to start the Attach Listener - in that</span></span><br><span class=\"line\">        <span class=\"hljs-comment\">// case don&apos;t print stack traces.</span></span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (!DisableAttachMechanism &amp;&amp; AttachListener::is_init_trigger()) {</span><br><span class=\"line\">          <span class=\"hljs-keyword\">continue</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"hljs-comment\">// Print stack traces</span></span><br><span class=\"line\">        <span class=\"hljs-comment\">// Any SIGBREAK operations added here should make sure to flush</span></span><br><span class=\"line\">        <span class=\"hljs-comment\">// the output stream (e.g. tty-&gt;flush()) after output.  See 4803766.</span></span><br><span class=\"line\">        <span class=\"hljs-comment\">// Each module also prints an extra carriage return after its output.</span></span><br><span class=\"line\">        VM_PrintThreads op;</span><br><span class=\"line\">        VMThread::execute(&amp;op);</span><br><span class=\"line\">        VM_PrintJNI jni_op;</span><br><span class=\"line\">        VMThread::execute(&amp;jni_op);</span><br><span class=\"line\">        <span class=\"hljs-function\">VM_FindDeadlocks <span class=\"hljs-title\">op1</span><span class=\"hljs-params\">(tty)</span></span>;</span><br><span class=\"line\">        VMThread::execute(&amp;op1);</span><br><span class=\"line\">        Universe::print_heap_at_SIGBREAK();</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (PrintClassHistogram) {</span><br><span class=\"line\">          <span class=\"hljs-function\">VM_GC_HeapInspection <span class=\"hljs-title\">op1</span><span class=\"hljs-params\">(gclog_or_tty, <span class=\"hljs-literal\">true</span> <span class=\"hljs-comment\">/* force full GC before heap inspection */</span>)</span></span>;</span><br><span class=\"line\">          VMThread::execute(&amp;op1);</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (JvmtiExport::should_post_data_dump()) {</span><br><span class=\"line\">          JvmtiExport::post_data_dump();</span><br><span class=\"line\">        }</span><br><span class=\"line\">        <span class=\"hljs-keyword\">break</span>;</span><br><span class=\"line\">      }</span><br><span class=\"line\">      ...</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x521D;&#x59CB;&#x5316;Attach&#x76D1;&#x542C;&#x65F6;&#x4F1A;&#x68C0;&#x67E5;Java&#x5BA2;&#x6237;&#x7AEF;&#x751F;&#x6210;&#x7684;attach&#x6587;&#x4EF6;&#x3002;</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/vm/runtime/thread.cpp-&gt;create_vm()<br>            &#x2014;- src/share/vm/runtime/os.cpp-&gt;signal_init()<br>                &#x2014;- src/share/vm/runtime/os.cpp-&gt;signal_thread_entry()<br>                     &#x2014;- src/os/bsd/vm/attachListener_bsd.cpp-&gt;is_init_trigger()</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">bool</span> <span class=\"hljs-title\">AttachListener::is_init_trigger</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">  <span class=\"hljs-keyword\">if</span> (init_at_startup() || is_initialized()) {</span><br><span class=\"line\">    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;               <span class=\"hljs-comment\">// initialized at startup or already initialized</span></span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"hljs-keyword\">char</span> path[PATH_MAX + <span class=\"hljs-number\">1</span>];</span><br><span class=\"line\">  <span class=\"hljs-keyword\">int</span> ret;</span><br><span class=\"line\">  <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">stat</span> <span class=\"hljs-title\">st</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"hljs-built_in\">snprintf</span>(path, PATH_MAX + <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&quot;%s/.attach_pid%d&quot;</span>,</span><br><span class=\"line\">           os::get_temp_directory(), os::current_process_id());</span><br><span class=\"line\">  RESTARTABLE(::stat(path, &amp;st), ret);</span><br><span class=\"line\">  <span class=\"hljs-keyword\">if</span> (ret == <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">    <span class=\"hljs-comment\">// simple check to avoid starting the attach mechanism when</span></span><br><span class=\"line\">    <span class=\"hljs-comment\">// a bogus user creates the file</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (st.st_uid == geteuid()) {</span><br><span class=\"line\">      init();</span><br><span class=\"line\">      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x786E;&#x8BA4;Java&#x5BA2;&#x6237;&#x7AEF;&#x5F00;&#x59CB;attach&#x5E76;&#x4E14;&#x6743;&#x9650;&#x6821;&#x9A8C;&#x901A;&#x8FC7;&#x540E;&#x5F00;&#x59CB;socket&#x901A;&#x8BAF;&#xFF0C;&#x9996;&#x5148;&#x521D;&#x59CB;&#x5316;socket&#x5E76;&#x7ED1;&#x5B9A;&#x76D1;&#x542C;&#x3002;</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A; src/os/bsd/vm/attachListener_bsd.cpp-&gt;is_init_trigger()<br>            &#x2014;- src/share/vm/services/attachListener.cpp-&gt;init()</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">bool</span> <span class=\"hljs-title\">AttachListener::is_init_trigger</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">  <span class=\"hljs-keyword\">if</span> (init_at_startup() || is_initialized()) {</span><br><span class=\"line\">    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;               <span class=\"hljs-comment\">// initialized at startup or already initialized</span></span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"hljs-keyword\">char</span> path[PATH_MAX + <span class=\"hljs-number\">1</span>];</span><br><span class=\"line\">  <span class=\"hljs-keyword\">int</span> ret;</span><br><span class=\"line\">  <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">stat</span> <span class=\"hljs-title\">st</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"hljs-built_in\">snprintf</span>(path, PATH_MAX + <span class=\"hljs-number\">1</span>, <span class=\"hljs-string\">&quot;%s/.attach_pid%d&quot;</span>,</span><br><span class=\"line\">           os::get_temp_directory(), os::current_process_id());</span><br><span class=\"line\">  RESTARTABLE(::stat(path, &amp;st), ret);</span><br><span class=\"line\">  <span class=\"hljs-keyword\">if</span> (ret == <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">    <span class=\"hljs-comment\">// simple check to avoid starting the attach mechanism when</span></span><br><span class=\"line\">    <span class=\"hljs-comment\">// a bogus user creates the file</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (st.st_uid == geteuid()) {</span><br><span class=\"line\">      init();</span><br><span class=\"line\">      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x6700;&#x7EC8;JVM&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x7EBF;&#x7A0B;&#x6267;&#x884C;Attach&#x76D1;&#x542C;&#x65B9;&#x6CD5;&#xFF0C;&#x65B9;&#x6CD5;accept&#x4ECE;Java&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;&#x7684;&#x6307;&#x4EE4;&#xFF0C;&#x5E76;&#x89E3;&#x6790;&#x4E3A;&#x5BF9;&#x5E94;&#x7684;&#x51FD;&#x6570;&#x3002;</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A; src/share/vm/services/attachListener.cpp-&gt;init()<br>            &#x2014;- src/share/vm/services/attachListener.cpp-&gt;attach_listener_thread_entry()</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">attach_listener_thread_entry</span><span class=\"hljs-params\">(JavaThread* thread, TRAPS)</span> </span>{</span><br><span class=\"line\">  os::set_priority(thread, NearMaxPriority);</span><br><span class=\"line\"></span><br><span class=\"line\">  thread-&gt;record_stack_base_and_size();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"hljs-keyword\">if</span> (AttachListener::pd_init() != <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">    <span class=\"hljs-keyword\">return</span>;</span><br><span class=\"line\">  }</span><br><span class=\"line\">  AttachListener::set_initialized();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"hljs-keyword\">for</span> (;;) {</span><br><span class=\"line\">    AttachOperation* op = AttachListener::dequeue();</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (op == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">      <span class=\"hljs-keyword\">return</span>;   <span class=\"hljs-comment\">// dequeue failed or shutdown</span></span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    ResourceMark rm;</span><br><span class=\"line\">    bufferedStream st;</span><br><span class=\"line\">    jint res = JNI_OK;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-comment\">// handle special detachall operation</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">strcmp</span>(op-&gt;name(), AttachOperation::detachall_operation_name()) == <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">      AttachListener::detachall();</span><br><span class=\"line\">    } <span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">      <span class=\"hljs-comment\">// find the function to dispatch too</span></span><br><span class=\"line\">      AttachOperationFunctionInfo* info = <span class=\"hljs-literal\">NULL</span>;</span><br><span class=\"line\">      <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i=<span class=\"hljs-number\">0</span>; funcs[i].name != <span class=\"hljs-literal\">NULL</span>; i++) {</span><br><span class=\"line\">        <span class=\"hljs-keyword\">const</span> <span class=\"hljs-keyword\">char</span>* name = funcs[i].name;</span><br><span class=\"line\">        assert(<span class=\"hljs-built_in\">strlen</span>(name) &lt;= AttachOperation::name_length_max, <span class=\"hljs-string\">&quot;operation &lt;= name_length_max&quot;</span>);</span><br><span class=\"line\">        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">strcmp</span>(op-&gt;name(), name) == <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">          info = &amp;(funcs[i]);</span><br><span class=\"line\">          <span class=\"hljs-keyword\">break</span>;</span><br><span class=\"line\">        }</span><br><span class=\"line\">      }</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"hljs-comment\">// check for platform dependent attach operation</span></span><br><span class=\"line\">      <span class=\"hljs-keyword\">if</span> (info == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">        info = AttachListener::pd_find_operation(op-&gt;name());</span><br><span class=\"line\">      }</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"hljs-keyword\">if</span> (info != <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">        <span class=\"hljs-comment\">// dispatch to the function that implements this operation</span></span><br><span class=\"line\">        res = (info-&gt;func)(op, &amp;st);</span><br><span class=\"line\">      } <span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">        st.print(<span class=\"hljs-string\">&quot;Operation %s not recognized!&quot;</span>, op-&gt;name());</span><br><span class=\"line\">        res = JNI_ERR;</span><br><span class=\"line\">      }</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-comment\">// operation complete - send result and output to client</span></span><br><span class=\"line\">    op-&gt;complete(res, &amp;st);</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A; src/share/vm/services/attachListener.cpp-&gt;attach_listener_thread_entry()<br>            &#x2014;- src/os/bsd/vm/attachListener_bsd.cpp-&gt;dequeue()<br>                 &#x2014;- src/os/bsd/vm/attachListener_bsd.cpp-&gt;BsdAttachListener::dequeue()</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-function\">BsdAttachOperation* <span class=\"hljs-title\">BsdAttachListener::dequeue</span><span class=\"hljs-params\">()</span> </span>{</span><br><span class=\"line\">  <span class=\"hljs-keyword\">for</span> (;;) {</span><br><span class=\"line\">    <span class=\"hljs-keyword\">int</span> s;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-comment\">// wait for client to connect</span></span><br><span class=\"line\">    <span class=\"hljs-class\"><span class=\"hljs-keyword\">struct</span> <span class=\"hljs-title\">sockaddr</span> <span class=\"hljs-title\">addr</span>;</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">socklen_t</span> len = <span class=\"hljs-keyword\">sizeof</span>(addr);</span><br><span class=\"line\">    RESTARTABLE(::accept(listener(), &amp;addr, &amp;len), s);</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (s == <span class=\"hljs-number\">-1</span>) {</span><br><span class=\"line\">      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">NULL</span>;      <span class=\"hljs-comment\">// log a warning?</span></span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-comment\">// get the credentials of the peer and check the effective uid/guid</span></span><br><span class=\"line\">    <span class=\"hljs-comment\">// - check with jeff on this.</span></span><br><span class=\"line\">    <span class=\"hljs-keyword\">uid_t</span> puid;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">gid_t</span> pgid;</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (::getpeereid(s, &amp;puid, &amp;pgid) != <span class=\"hljs-number\">0</span>) {</span><br><span class=\"line\">      ::close(s);</span><br><span class=\"line\">      <span class=\"hljs-keyword\">continue</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\">    <span class=\"hljs-keyword\">uid_t</span> euid = geteuid();</span><br><span class=\"line\">    <span class=\"hljs-keyword\">gid_t</span> egid = getegid();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (puid != euid || pgid != egid) {</span><br><span class=\"line\">      ::close(s);</span><br><span class=\"line\">      <span class=\"hljs-keyword\">continue</span>;</span><br><span class=\"line\">    }</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"hljs-comment\">// peer credential look okay so we read the request</span></span><br><span class=\"line\">    BsdAttachOperation* op = read_request(s);</span><br><span class=\"line\">    <span class=\"hljs-keyword\">if</span> (op == <span class=\"hljs-literal\">NULL</span>) {</span><br><span class=\"line\">      ::close(s);</span><br><span class=\"line\">      <span class=\"hljs-keyword\">continue</span>;</span><br><span class=\"line\">    } <span class=\"hljs-keyword\">else</span> {</span><br><span class=\"line\">      <span class=\"hljs-keyword\">return</span> op;</span><br><span class=\"line\">    }</span><br><span class=\"line\">  }</span><br><span class=\"line\">}</span><br></pre></td></tr></tbody></table></figure>\n\n<p>&#x6307;&#x4EE4;&#x4E0E;&#x65B9;&#x6CD5;&#x7684;&#x6620;&#x5C04;&#x662F;&#x4E8B;&#x5148;&#x51C6;&#x5907;&#x597D;&#x7684;</p>\n<blockquote>\n<p>&#x4EE3;&#x7801;&#x6E05;&#x5355;&#xFF1A;src/share/vm/services/attachListener.cpp</p>\n</blockquote>\n<figure class=\"highlight c++ hljs\"><table><tbody><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">static</span> AttachOperationFunctionInfo funcs[] = {</span><br><span class=\"line\">  { <span class=\"hljs-string\">&quot;agentProperties&quot;</span>,  get_agent_properties },</span><br><span class=\"line\">  { <span class=\"hljs-string\">&quot;datadump&quot;</span>,         data_dump },</span><br><span class=\"line\">  { <span class=\"hljs-string\">&quot;dumpheap&quot;</span>,         dump_heap },</span><br><span class=\"line\">  { <span class=\"hljs-string\">&quot;load&quot;</span>,             JvmtiExport::load_agent_library },</span><br><span class=\"line\">  { <span class=\"hljs-string\">&quot;properties&quot;</span>,       get_system_properties },</span><br><span class=\"line\">  { <span class=\"hljs-string\">&quot;threaddump&quot;</span>,       thread_dump },</span><br><span class=\"line\">  { <span class=\"hljs-string\">&quot;inspectheap&quot;</span>,      heap_inspection },</span><br><span class=\"line\">  { <span class=\"hljs-string\">&quot;setflag&quot;</span>,          set_flag },</span><br><span class=\"line\">  { <span class=\"hljs-string\">&quot;printflag&quot;</span>,        print_flag },</span><br><span class=\"line\">  { <span class=\"hljs-string\">&quot;jcmd&quot;</span>,             jcmd },</span><br><span class=\"line\">  { <span class=\"hljs-literal\">NULL</span>,               <span class=\"hljs-literal\">NULL</span> }</span><br><span class=\"line\">};</span><br></pre></td></tr></tbody></table></figure>\n\n\n<p><font color=\"red\">&#x603B;&#x7ED3;</font>,&#x76F8;&#x4FE1;&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x7684;&#x5206;&#x6790;&#x6211;&#x4EEC;&#x5DF2;&#x7ECF;&#x6E05;&#x695A;&#x7684;&#x4E86;&#x89E3;JVM&#x662F;&#x5982;&#x4F55;&#x63A5;&#x6536;&#x5230;Java&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x8D77;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x52A8;&#x6001;Attach&#x7684;&#x529F;&#x80FD;&#x3002;&#x5177;&#x4F53;&#x6D41;&#x7A0B;&#x5982;&#x56FE;&#xFF1A;<br><img src=\"/2020/09/21/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90JVM-%E5%8A%A8%E6%80%81Attach%E5%8E%9F%E7%90%86/flow.png\" alt=\"03\"></p>\n</body></html>","site":{"data":{}},"_categories":[{"name":"Technology","path":"categories/Technology/"}],"_tags":[{"name":"JVM","path":"tags/JVM/"},{"name":"Java","path":"tags/Java/"}],"excerpt":"<html><head></head><body><p>&#x76F8;&#x4FE1;&#x5F88;&#x591A;&#x5C0F;&#x4F19;&#x4F34;&#x90FD;&#x4F7F;&#x7528;&#x8FC7;javaagent&#x63A2;&#x9488;&#x6280;&#x672F;&#xFF0C;javaagent&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x4FB5;&#x5165;&#x539F;&#x4EE3;&#x7801;&#x4E0D;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x65B9;&#x6CD5;&#x5E76;&#x5229;&#x7528;&#x52A8;&#x6001;&#x5B57;&#x8282;&#x7801;&#x6280;&#x672F;&#x589E;&#x5F3A;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x5F88;&#x591A;&#x6210;&#x719F;&#x7684;&#x6846;&#x67B6;&#x4E5F;&#x8FD0;&#x7528;&#x5230;&#x4E86;&#x8BE5;&#x6280;&#x672F;&#xFF0C;&#x5982;skywalking&#x7B49;&#x3002;&#x8FD9;&#x4E48;&#x597D;&#x7528;&#x7684;&#x529F;&#x80FD;&#xFF0C;JDK&#x7684;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6CA1;&#x9053;&#x7406;&#x4E0D;&#x73A9;&#x51FA;&#x4E9B;&#x65B0;&#x82B1;&#x5934;&#xFF0C;&#x56E0;&#x6B64;&#x5728;JDK1.6&#x4E2D;&#xFF0C;&#x66F4;&#x52A0;&#x5F3A;&#x5927;&#x7684;JVM &#x52A8;&#x6001;Attach&#x6280;&#x672F;&#x5C55;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x9762;&#x524D;&#x3002;&#x5927;&#x540D;&#x9F0E;&#x9F0E;&#x7684;Btrace&#x3001;Arthas&#x7B49;&#x90FD;&#x8FD0;&#x7528;&#x4E86;&#x52A8;&#x6001;Attach&#x6280;&#x672F;&#x3002;&#x5728;JVM&#x8FD0;&#x884C;&#x671F;&#x8FDB;&#x62E6;&#x622A;&#x5E76;&#x589E;&#x5F3A;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x4F7F;&#x5F97;&#x4EE5;&#x5F80;&#x751F;&#x4EA7;&#x96BE;&#x4EE5;&#x5B9A;&#x4F4D;&#x7684;&#x95EE;&#x9898;&#x53D8;&#x5F97;&#x66F4;&#x52A0;&#x5BB9;&#x6613;&#x6392;&#x67E5;&#x3002;</p></body></html>","more":"<p>JVMçš„åŠ¨æ€Attachå›ºç„¶å¥½ï¼Œç›¸ä¿¡å¤§å®¶æˆ–å¤šæˆ–å°‘å·²ç»çŸ¥é“å¦‚ä½•å»ä½¿ç”¨è¯¥æŠ€æœ¯äº†ï¼Œæ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬ç ”ç©¶çš„é‡ç‚¹æ˜¯JVMæ˜¯å¦‚ä½•å®ç°åŠ¨æ€Attachï¼Œè‡³äºJVMå¦‚ä½•åŠ è½½åŠ¨æ€JaråŒ…ã€åˆ†å‘æ–¹æ³•å¹¶ä¼ é€’jvmä¸Šä¸‹æ–‡å°±ä¸åœ¨æˆ‘ä»¬çš„ç ”ç©¶èŒƒå›´ä¹‹å†…ã€‚</p>\n<p>ä¸ºäº†æ›´å¥½çš„ç ”ç©¶JVMçš„å®ç°ï¼Œæˆ‘ä»¬å°†ç”±æµ…å…¥æ·±ï¼Œåˆ†ä¸ºå‡ ä¸ªé˜¶æ®µè¿›è¡Œç ”ç©¶ï¼š</p>\n<ul>\n<li>åŠ¨æ€Attachæ˜¯ä»€ä¹ˆï¼Ÿ</li>\n<li>æœ‰å‡ ç§æ–¹æ¡ˆå¯ä»¥å®ç°åŠ¨æ€Attach</li>\n<li>ä¸¾ä¸€ä¸ªæ —å­</li>\n<li>çœ‹çœ‹JVMæ˜¯æ€ä¹ˆåšçš„</li>\n</ul>\n<h2 id=\"ä¸€ã€åŠ¨æ€Attachæ˜¯ä»€ä¹ˆ\"><a href=\"#ä¸€ã€åŠ¨æ€Attachæ˜¯ä»€ä¹ˆ\" class=\"headerlink\" title=\"ä¸€ã€åŠ¨æ€Attachæ˜¯ä»€ä¹ˆ\"></a>ä¸€ã€åŠ¨æ€Attachæ˜¯ä»€ä¹ˆ</h2><p>è™½ç„¶æˆ‘ä»¬è¿™æ¬¡ç ”ç©¶çš„æ˜¯å…·ä½“çš„å®ç°ï¼Œä½†åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åƒåˆ†æéœ€æ±‚ä¸€æ ·åˆ†æä¸‹åŠ¨æ€Attachåˆ°åº•æ˜¯ä»€ä¹ˆã€‚</p>\n<p>æˆ‘ä»¬éƒ½çŸ¥é“javaagentå‚æ•°æ˜¯ä¼´éšç€javaå‘½ä»¤ï¼Œåœ¨JVMå¯åŠ¨çš„è¿‡ç¨‹ä¸­åŠ è½½javaagentå‚æ•°æŒ‡å®šçš„JaråŒ…è·¯å¾„ï¼Œå¹¶æ‰§è¡Œçº¦å®šç±»çš„premainæ–¹æ³•ã€‚åœ¨premainæ–¹æ³•ä¸­å¯ä»¥è·å–Instrumentationç±»å‹å‚æ•°ï¼Œä»è€Œå¯¹æˆ‘ä»¬çš„ç±»è¿›è¡ŒåŠ¨æ€å¢å¼ºå¢å¼ºã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨javaagentï¼š</p>\n<ol>\n<li><p>å…ˆå®ç°ä¸€ä¸ªæˆ‘ä»¬éœ€è¦æŒ‚åœ¨çš„ç±»ï¼Œå…¶ä¸­éœ€è¦å®ç°premain()æ–¹æ³•ï¼Œå¹¶å°†å®ƒæ‰“åŒ…ä¸ºå¯æ‰§è¡ŒJaråŒ…</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Javaagent</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">premain</span><span class=\"params\">(String agentArgs, Instrumentation inst)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;agentArgs : &quot;</span> + agentArgs);</span><br><span class=\"line\">        inst.addTransformer(<span class=\"keyword\">new</span> TestTransformer(), <span class=\"keyword\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestTransformer</span> <span class=\"keyword\">implements</span> <span class=\"title\">ClassFileTransformer</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">byte</span>[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, <span class=\"keyword\">byte</span>[] classfileBuffer) <span class=\"keyword\">throws</span> IllegalClassFormatException &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;premain load Class:&quot;</span> + className);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> classfileBuffer;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>é…ç½®MANIFEST.MFé…ç½®æ–‡ä»¶</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Premain-Class: Javaagent</span><br><span class=\"line\">Agent-Class: Javaagent</span><br><span class=\"line\">Can-Redefine-Classes: true</span><br><span class=\"line\">Can-Retransform-Classes: true</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -javaagent:Javaagent.jar è‡ªå·±çš„æœåŠ¡.jar</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<p>ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€å•çš„javaagentè¿ç”¨åœºæ™¯ã€‚javaagentå¯ä»¥åœ¨ä¸ä¾µå…¥ä¸šåŠ¡ä»£ç çš„å‰æä¸‹ä¿®æ”¹æˆ‘ä»¬å·²åŠ è½½çš„ç±»ï¼Œä½†å”¯ä¸€çš„é—®é¢˜æ˜¯éœ€è¦ä¼´éšç€ä¸šåŠ¡æœåŠ¡ä¸€åŒå¯åŠ¨ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ— æ³•ä¾µå…¥å·²ç»è¿è¡Œåœ¨JVMä¸­çš„ä»£ç ï¼Œå› æ­¤JDKå¼€å‘çš„å¤§ç¥ä»¬ä¸ºæˆ‘ä»¬å¸¦æ¥äº†åŠ¨æ€Attach APIã€‚å…¶åŠŸèƒ½ä¸javaagentæ˜¯ä¸€æ ·çš„ï¼Œä½†æœ€å¤§çš„å¥½å¤„å°±æ˜¯æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€ä¸ªå·²ç»è¿è¡Œçš„JVMä¸ŠåŠ¨æ€çš„æŒ‚è½½ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±å¼€å‘çš„JaråŒ…ï¼Œä»è€Œå®ç°ä»»ä½•æ—¶é—´ç‚¹æˆ‘ä»¬éƒ½èƒ½æ‰‹åŠ¨çš„å¢å¼ºä¸šåŠ¡ä»£ç ã€‚æ¯”å¦‚é€šè¿‡attach Arthasï¼Œæˆ‘ä»¬èƒ½å¢å¼ºæŒ‡å®šæ–¹æ³•çš„å…¥å£&amp;å‡ºå£ï¼Œä»è€Œè·å–å‡ºå…¥å‚çš„ç›¸å…³ä¿¡æ¯ã€‚è¿™åœ¨ç¼ºå°‘æ—¥å¿—è¾“å‡ºçš„åœºæ™¯ä¸‹æ˜¯éå¸¸æœ‰æ•ˆçš„é—®é¢˜å®šä½æ‰‹æ®µã€‚æ­¤å¤–æˆ‘ä»¬ä¹Ÿèƒ½ä¸ºæ–¹æ³•çš„è°ƒç”¨é“¾åšåŸ‹ç‚¹ï¼Œå¸®åŠ©æˆ‘ä»¬åˆ†æä¸šåŠ¡æµç¨‹ä¸­çš„æ…¢æ–¹æ³•ç­‰ç­‰ã€‚</p>\n<p>æ€»ç»“ä¸‹ï¼ŒåŠ¨æ€Attachå°±æ˜¯JVMè¿è¡ŒæœŸä¸­æä¾›çš„æŒ‡å®šç±»å‹çš„ç±»åŠ è½½æœºåˆ¶ã€‚é€šè¿‡å¢å¼ºç±»çš„åŠ è½½ï¼Œå®ç°å„å¼å„æ ·æœ‰è¶£çš„åŠŸèƒ½ã€‚</p>\n<h2 id=\"äºŒã€æœ‰å‡ ç§æ–¹æ¡ˆå¯ä»¥å®ç°åŠ¨æ€Attach\"><a href=\"#äºŒã€æœ‰å‡ ç§æ–¹æ¡ˆå¯ä»¥å®ç°åŠ¨æ€Attach\" class=\"headerlink\" title=\"äºŒã€æœ‰å‡ ç§æ–¹æ¡ˆå¯ä»¥å®ç°åŠ¨æ€Attach\"></a>äºŒã€æœ‰å‡ ç§æ–¹æ¡ˆå¯ä»¥å®ç°åŠ¨æ€Attach</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“ä»€ä¹ˆæ˜¯åŠ¨æ€Attachäº†ï¼Œå€˜è‹¥æˆ‘ä»¬æ˜¯JDKçš„å·¥ç¨‹å¸ˆï¼Œå½“äº§å“äº¤ç»™æˆ‘ä»¬éœ€è¦å®ç°åŠ¨æ€Attachè¿™ä¸ªéœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬ä¼šæ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p>\n<h4 id=\"1-ç›´æ¥ç±»åŠ è½½æ³•\"><a href=\"#1-ç›´æ¥ç±»åŠ è½½æ³•\" class=\"headerlink\" title=\"1.ç›´æ¥ç±»åŠ è½½æ³•\"></a>1.ç›´æ¥ç±»åŠ è½½æ³•</h4><p>JDKå·²ç»æä¾›äº†ä¸€å¥—å®Œå–„çš„ç±»åŠ è½½æœºåˆ¶ï¼Œå¦‚æœæä¾›è·å–Instrumentationå¯¹è±¡çš„JNIï¼Œå¼€å‘äººå‘˜å°±å¯ä»¥è‡ªè¡Œé€šè¿‡åŠ¨æ€ç±»åŠ è½½åè¿›è¡Œå­—èŠ‚ç åŠ¨æ€å¢å¼ºã€‚è¿™ä¸ªæ–¹æ¡ˆçœ‹ä¼¼å¾ˆç¾å¥½ï¼Œç°æœ‰Javaç”Ÿæ€åœˆå·²ç»æ‹¥æœ‰ä¸°å¯Œçš„ClassåŠ¨æ€åŠ è½½æ–¹æ¡ˆï¼Œåˆ©ç”¨è¿™äº›ç°æœ‰æ–¹æ¡ˆï¼Œå¼€å‘äººå‘˜èƒ½å¤Ÿå¾ˆå¿«çš„æ­å»ºå‡ºè‡ªå·±çš„å­—èŠ‚ç åŠ¨æ€åŠ è½½æœºåˆ¶ï¼Œè€Œæ— éœ€JVMæä¾›å¤§é‡çš„nativeæ”¯æŒã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆå­˜åœ¨é‡å¤§çš„å®‰å…¨é—®é¢˜ï¼Œä¸€æ—¦æœåŠ¡çš„åŠ¨æ€åŠ è½½æœºåˆ¶è¢«é»‘å®¢ç ´è§£ï¼Œé‚£ä¹ˆä»–å®Œå…¨èƒ½å¤ŸåŠ è½½ä¸€ä¸ªè‡ªå·±ç¼–å†™å¥½çš„ä¾µå…¥ç±»ï¼Œé€šè¿‡å…¥ä¾µç±»ä»»æ„ä¿®æ”¹ä¸šåŠ¡ä»£ç æœ€ç»ˆå¯¼è‡´æ— æ³•æŒ½å›çš„æŸå¤±ã€‚æ‰€ä»¥ä½œä¸ºä¸€ä¸ªJDKå¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸€å®šè¦åœ¨åˆæœŸå°±å±è”½è¿™ç§å®‰å…¨é—®é¢˜ã€‚åŒæ—¶Javaæœ€ä¸ºä¸€ç§å®‰å…¨è¯­è¨€ï¼Œä¸å®‰å…¨çš„æ“ä½œéœ€è¦å°½é‡é¿å…å¼•å…¥Javaç”Ÿæ€ä¸­ã€‚</p>\n<h4 id=\"2-Socketé€šä¿¡æ³•\"><a href=\"#2-Socketé€šä¿¡æ³•\" class=\"headerlink\" title=\"2.Socketé€šä¿¡æ³•\"></a>2.Socketé€šä¿¡æ³•</h4><p>æ—¢ç„¶æä¾›JNIä¸å®‰å…¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥è€ƒè™‘è®©JVMè‡ªå·±å¤„ç†ã€‚å‡è®¾æˆ‘ä»¬èƒ½å’ŒJVMå»ºç«‹èµ·Socketé€šè®¯ã€‚å¹¶å°†æˆ‘ä»¬å¸Œæœ›åŠ è½½çš„ç±»å‘ŠçŸ¥JVMï¼ŒJVMåœ¨åŠ è½½å®ŒæˆåæŒ‰ç…§çº¦å®šæ‰§è¡ŒæŒ‡å®šçš„å…¥å£æ–¹æ³•ï¼Œè¿™æ ·ä¹Ÿèƒ½å®ç°æˆ‘ä»¬å¯¹åŠ¨æ€Attachçš„å®ç°ã€‚</p>\n<p>Socketé€šä¿¡å¯ä»¥åˆ†ä¸ºè¿œç¨‹é€šä¿¡å’Œæœ¬åœ°é€šä¿¡ã€‚æˆ‘ä»¬éœ€è¦è€ƒè™‘ï¼Œå¦‚æœé‡‡ç”¨è¿œç¨‹é€šä¿¡ï¼Œçš„ç¡®èƒ½ç»™æˆ‘ä»¬å¸¦æ¥æ›´å¼ºå¤§çš„Attachçµæ´»æ€§ï¼Œä½†éœ€è¦JVMæš´éœ²ç«¯å£ï¼ŒåŒæ ·å…·æœ‰ä¸€å®šçš„å®‰å…¨é—®é¢˜ã€‚<br>æœ¬åœ°é€šè®¯æˆ‘ä»¬å¯ä»¥é‡‡ç”¨UNIX Domain Socketï¼Œé€šè¿‡æ–‡ä»¶å½¢å¼é€šè®¯ã€‚ä¸ä½†å…·æœ‰è¾ƒé«˜çš„é€šä¿¡é€Ÿåº¦ï¼ŒåŒæ—¶å…·æœ‰ä¸€å®šçš„å®‰å…¨æ€§ã€‚</p>\n<p>å¦‚æœé‡‡ç”¨Socket Localé€šä¿¡ï¼Œé‚£æˆ‘ä»¬åˆå¦‚ä½•ä¸JVMå»ºç«‹èµ·é€šä¿¡å‘¢ï¼Ÿ</p>\n<h4 id=\"3-ä¿¡å·ç›‘å¬æ³•\"><a href=\"#3-ä¿¡å·ç›‘å¬æ³•\" class=\"headerlink\" title=\"3.ä¿¡å·ç›‘å¬æ³•\"></a>3.ä¿¡å·ç›‘å¬æ³•</h4><p>å…¶å®è¿™ä¸ªæ–¹æ³•æ˜¯Socketé€šä¿¡æ³•çš„è¡¥å……ã€‚åœ¨ä¸JVMå»ºç«‹èµ·æœ¬åœ°é€šä¿¡å‰ï¼ŒJVMéœ€è¦çŸ¥é“ç”¨æˆ·æƒ³è¦å¼€å§‹åŠ¨æ€Attachã€‚è€Œä¿¡å·ç›‘å¬å°±èƒ½è¡¥å……è¿™æ–¹é¢çš„åŠŸèƒ½ã€‚å®¢æˆ·ç«¯ä»¥çº¦å®šçš„å½¢å¼å‘JVMè¿›ç¨‹å‘èµ·æŒ‡å®šä¿¡å·ï¼ŒåŒæ—¶JVMåœ¨ç›‘å¬åˆ°Attachä¿¡å·åä¸å®¢æˆ·ç«¯å»ºç«‹Socketé“¾æ¥ã€‚å®¢æˆ·ç«¯ä»¥Socketæ–¹å¼å°†éœ€è¦åŠ è½½çš„ç±»å‘ŠçŸ¥JVMå¹¶è¿›è¡ŒåŠ è½½å¹¶æœ€ç»ˆè¿è¡Œæˆ‘ä»¬åé¢ç†Ÿæ‚‰çš„javaagentæµç¨‹ã€‚</p>\n<p>æˆ‘è™½ç„¶ä¸æ˜¯JDKçš„å·¥ç¨‹å¸ˆï¼Œä¸Šé¢çš„3ä¸ªæ–¹æ¡ˆä¹Ÿæ˜¯ç»“åˆäº†JDK1.8çš„å…·ä½“å®ç°åå¤§èƒ†çš„æ£æµ‹äº†å½“æ—¶å¼€å‘å·¥ç¨‹å¸ˆçš„æƒ³æ³•ã€‚å¯èƒ½å½“æ—¶æ‘†åœ¨ä»–é¢å‰çš„æ–¹æ¡ˆæ›´æ˜¯æˆåƒä¸Šä¸‡ï¼Œä½†æ˜¯æœ€ç»ˆç¡®å®šä¸‹è¿™ä¸ªæŠ€æœ¯æ–¹æ¡ˆçš„å¿ƒè·¯å†ç¨‹æˆ‘è§‰å¾—æ˜¯æˆ‘ä»¬æ¯ä¸ªå¼€å‘éƒ½éœ€è¦æ„ŸåŒèº«å—çš„ã€‚</p>\n<h2 id=\"ä¸‰ã€ä¸¾ä¸€ä¸ªæ —å­\"><a href=\"#ä¸‰ã€ä¸¾ä¸€ä¸ªæ —å­\" class=\"headerlink\" title=\"ä¸‰ã€ä¸¾ä¸€ä¸ªæ —å­\"></a>ä¸‰ã€ä¸¾ä¸€ä¸ªæ —å­</h2><p>å‰é¢æˆ‘ä»¬åˆ†æäº†å®ç°æ–¹æ¡ˆï¼Œæˆ‘ä»¬å…ˆä¸¢ä¸€ä»½ä»£ç æ¥éªŒè¯ä¸Šé¢çš„æ–¹æ¡ˆï¼ˆä»£ç ä¸ºJDK1.8æºç ç›¸å…³åŠŸèƒ½çš„ç®€åŒ–ç‰ˆï¼‰</p>\n<h3 id=\"å¼€å§‹å®éªŒ\"><a href=\"#å¼€å§‹å®éªŒ\" class=\"headerlink\" title=\"å¼€å§‹å®éªŒ\"></a>å¼€å§‹å®éªŒ</h3><p><font color=\"blue\">éœ€æ±‚ï¼š</font>å®ç°åŠ¨æ€Attach APIï¼Œæ¥æ”¶java -jar xxx.jar pidå‘èµ·çš„æŒ‚è½½è¯·æ±‚ï¼Œå¹¶å°†loadAgentæŒ‡å®šçš„JaråŒ…å®Œæ•´è·¯å¾„æ˜¾ç¤ºåœ¨æ§åˆ¶å°ã€‚</p>\n<p><font color=\"blue\">å®éªŒç¯å¢ƒï¼š</font>MacOS 10.15.6</p>\n<p><font color=\"blue\">é¡¹ç›®åœ°å€ï¼š</font></p>\n<blockquote>\n<p><a href=\"https://github.com/xzenge/JVM_ATTACH/tree/dev\">https://github.com/xzenge/JVM_ATTACH/tree/dev</a></p>\n</blockquote>\n<h5 id=\"æˆ‘ä»¬å…ˆå¯åŠ¨é¡¹ç›®ã€‚è¯¥é¡¹ç›®æ¨¡æ‹Ÿäº†JVMè¿è¡Œç¯å¢ƒï¼Œä½†åªå®ç°äº†Attach-APIçš„éƒ¨åˆ†åŠŸèƒ½ã€‚é¡¹ç›®å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“å‰çš„JVMè¿›ç¨‹IDä¸ºï¼š32910\"><a href=\"#æˆ‘ä»¬å…ˆå¯åŠ¨é¡¹ç›®ã€‚è¯¥é¡¹ç›®æ¨¡æ‹Ÿäº†JVMè¿è¡Œç¯å¢ƒï¼Œä½†åªå®ç°äº†Attach-APIçš„éƒ¨åˆ†åŠŸèƒ½ã€‚é¡¹ç›®å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“å‰çš„JVMè¿›ç¨‹IDä¸ºï¼š32910\" class=\"headerlink\" title=\"æˆ‘ä»¬å…ˆå¯åŠ¨é¡¹ç›®ã€‚è¯¥é¡¹ç›®æ¨¡æ‹Ÿäº†JVMè¿è¡Œç¯å¢ƒï¼Œä½†åªå®ç°äº†Attach APIçš„éƒ¨åˆ†åŠŸèƒ½ã€‚é¡¹ç›®å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“å‰çš„JVMè¿›ç¨‹IDä¸ºï¼š32910\"></a>æˆ‘ä»¬å…ˆå¯åŠ¨é¡¹ç›®ã€‚è¯¥é¡¹ç›®æ¨¡æ‹Ÿäº†JVMè¿è¡Œç¯å¢ƒï¼Œä½†åªå®ç°äº†Attach APIçš„éƒ¨åˆ†åŠŸèƒ½ã€‚é¡¹ç›®å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“å‰çš„JVMè¿›ç¨‹IDä¸ºï¼š<font color=\"red\">32910</font></h5><p><img src=\"/2020/09/21/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90JVM-%E5%8A%A8%E6%80%81Attach%E5%8E%9F%E7%90%86/JVM_start.png\" alt=\"01\"></p>\n<hr>\n<h5 id=\"æŒ‰ç…§JDKè§„èŒƒç¼–å†™JAVAæµ‹Attachæ–¹æ³•ã€‚ä¸ºäº†ç®€ä¾¿ï¼Œæ–¹æ³•ä¸­æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šäº†attachçš„çº¿ç¨‹å·ï¼Œå¹¶æä¾›äº†JVMéœ€è¦åŠ è½½çš„JaråŒ…è·¯å¾„ã€‚\"><a href=\"#æŒ‰ç…§JDKè§„èŒƒç¼–å†™JAVAæµ‹Attachæ–¹æ³•ã€‚ä¸ºäº†ç®€ä¾¿ï¼Œæ–¹æ³•ä¸­æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šäº†attachçš„çº¿ç¨‹å·ï¼Œå¹¶æä¾›äº†JVMéœ€è¦åŠ è½½çš„JaråŒ…è·¯å¾„ã€‚\" class=\"headerlink\" title=\"æŒ‰ç…§JDKè§„èŒƒç¼–å†™JAVAæµ‹Attachæ–¹æ³•ã€‚ä¸ºäº†ç®€ä¾¿ï¼Œæ–¹æ³•ä¸­æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šäº†attachçš„çº¿ç¨‹å·ï¼Œå¹¶æä¾›äº†JVMéœ€è¦åŠ è½½çš„JaråŒ…è·¯å¾„ã€‚\"></a>æŒ‰ç…§JDKè§„èŒƒç¼–å†™JAVAæµ‹Attachæ–¹æ³•ã€‚ä¸ºäº†ç®€ä¾¿ï¼Œæ–¹æ³•ä¸­æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šäº†attachçš„çº¿ç¨‹å·ï¼Œå¹¶æä¾›äº†JVMéœ€è¦åŠ è½½çš„JaråŒ…è·¯å¾„ã€‚</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Attach</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException, AttachNotSupportedException, AgentLoadException, AgentInitializationException </span>&#123;</span><br><span class=\"line\">        VirtualMachine attach = VirtualMachine.attach(<span class=\"string\">&quot;32910&quot;</span>);</span><br><span class=\"line\">        attach.loadAgentPath(<span class=\"string\">&quot;/Users/xiangshi/.gradle/caches/modules-2/files-2.1/cglib/cglib/3.1/1f1cb6c7a7479e0c7fd7987109e503914bebe84a/cglib-3.1.jar&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<hr>\n<h5 id=\"è¿è¡ŒJava-attachæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°æ¨¡æ‹Ÿçš„JVMå·²ç»è¯»å–åˆ°äº†æˆ‘ä»¬å¸Œæœ›classloaderçš„JaråŒ…\"><a href=\"#è¿è¡ŒJava-attachæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°æ¨¡æ‹Ÿçš„JVMå·²ç»è¯»å–åˆ°äº†æˆ‘ä»¬å¸Œæœ›classloaderçš„JaråŒ…\" class=\"headerlink\" title=\"è¿è¡ŒJava attachæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°æ¨¡æ‹Ÿçš„JVMå·²ç»è¯»å–åˆ°äº†æˆ‘ä»¬å¸Œæœ›classloaderçš„JaråŒ…\"></a>è¿è¡ŒJava attachæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°æ¨¡æ‹Ÿçš„JVMå·²ç»è¯»å–åˆ°äº†æˆ‘ä»¬å¸Œæœ›classloaderçš„JaråŒ…</h5><p><img src=\"/2020/09/21/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90JVM-%E5%8A%A8%E6%80%81Attach%E5%8E%9F%E7%90%86/load_agent_library.png\" alt=\"02\"></p>\n<hr>\n<h3 id=\"å®éªŒåˆ†æ\"><a href=\"#å®éªŒåˆ†æ\" class=\"headerlink\" title=\"å®éªŒåˆ†æ\"></a>å®éªŒåˆ†æ</h3><p>å®éªŒè¿‡ç¨‹å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä¼ªé€ äº†ä¸ªJVMè¿è¡Œæ—¶ç¯å¢ƒã€‚å¹¶é€šè¿‡JAVAåŸç”Ÿçš„Attach APIæˆåŠŸçš„å®ç°äº†ä¸JVMä¹‹é—´é€šè®¯çš„åŠŸèƒ½ã€‚ä¸‹é¢æˆ‘ä»¬å¼€å§‹é€æ­¥åˆ†æå…·ä½“çš„å®ç°è¿‡ç¨‹ï¼š</p>\n<ul>\n<li>ç›‘å¬signal<br>åˆå§‹åŒ–OSä¿¡å·ç›‘å¬çš„ç›¸å…³æ•°æ®</li>\n</ul>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * JVMå¯åŠ¨æ—¶ç›‘å¬signal</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">os::signal_init</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//åˆå§‹åŒ–signalç›‘å¬pending_signals</span></span><br><span class=\"line\">    os::signal_init_pd();</span><br><span class=\"line\">    <span class=\"comment\">//åˆ›å»ºçº¿ç¨‹ç›‘å¬pending_signalsçŠ¶æ€å¹¶è¿›è¡Œç›¸åº”å¤„ç†</span></span><br><span class=\"line\">    <span class=\"keyword\">pthread_t</span> tids;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> ret = pthread_create(&amp;tids, <span class=\"literal\">NULL</span>, <span class=\"keyword\">reinterpret_cast</span>&lt;<span class=\"keyword\">void</span> *(*)(<span class=\"keyword\">void</span> *)&gt;(signal_thread_entry), <span class=\"literal\">NULL</span>);</span><br><span class=\"line\">    <span class=\"comment\">//æ³¨å†Œsignalå¤„ç†å™¨</span></span><br><span class=\"line\">    os::signal(SIGBREAK,os::user_handler());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>sigactionæ–¹æ³•æä¾›osä¿¡å·çš„ç›‘å¬å¹¶æ³¨å†Œä¿¡å·å¤„ç†å™¨ï¼Œæˆ‘ä»¬ç›‘å¬-3 SIGQUITä¿¡å·ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * æ³¨å†Œç›‘å¬ä¿¡å·&amp;å¤„ç†å™¨</span></span><br><span class=\"line\"><span class=\"comment\"> * @param signal_number ä¿¡å·ç¼–å·</span></span><br><span class=\"line\"><span class=\"comment\"> * @param handler ä¿¡å·å¤„ç†å™¨</span></span><br><span class=\"line\"><span class=\"comment\"> * @return</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> *<span class=\"title\">os::signal</span><span class=\"params\">(<span class=\"keyword\">int</span> signal_number, <span class=\"keyword\">void</span> *handler)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sigaction</span> <span class=\"title\">sigAct</span>, <span class=\"title\">oldSigAct</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sigfillset(&amp;(sigAct.sa_mask));</span><br><span class=\"line\">    sigAct.sa_flags   = SA_RESTART|SA_SIGINFO;</span><br><span class=\"line\">    sigAct.sa_handler = CAST_TO_FN_PTR(<span class=\"keyword\">sa_handler_t</span>, handler);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sigaction(signal_number, &amp;sigAct, &amp;oldSigAct)) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// -1 means registration failed</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"keyword\">void</span> *)<span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> CAST_FROM_FN_PTR(<span class=\"keyword\">void</span>*, oldSigAct.sa_handler);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¿¡å·å¤„ç†å™¨ä¸­ç®€å•çš„æ¨¡æ‹Ÿçš„æ”¶åˆ°ä¿¡å·çš„å¤„ç†è¿‡ç¨‹ï¼Œæ•°ç»„å¯¹åº”çš„ä¿¡å·ä½ç½®ä¸º1æ—¶ï¼Œè¯´æ˜æ”¶åˆ°äº†å¯¹åº”çš„ä¿¡å·ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * é€šè¿‡pending_signalsä¿ç•™ç›‘å¬åˆ°çš„ä¿¡æ¯ï¼Œäº¤ç”±ä¸“é—¨çš„çº¿ç¨‹å¤„ç†è¯¥ä¿¡æ¯</span></span><br><span class=\"line\"><span class=\"comment\"> * @param signal_number</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">os::signal_notify</span><span class=\"params\">(<span class=\"keyword\">int</span> signal_number)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;enter signal_notify sig:&quot;</span> &lt;&lt; signal_number &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    <span class=\"comment\">//å°†ç›‘å¬åˆ°çš„ä¿¡å·ä¸ºç«–ä¸º1</span></span><br><span class=\"line\">    <span class=\"comment\">//æ”¹æ“ä½œåº”è¯¥ä¸ºåŸå­æ“ä½œï¼Œç¡®ä¿ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹</span></span><br><span class=\"line\">    <span class=\"comment\">//JVMä¸­æ··ç¼–å¹³å°ç›¸å…³æ±‡ç¼–æŒ‡ä»¤å®ç°åŸå­æ“ä½œï¼Œæ¼”ç¤ºä»£ç ä¸­ä¸ç ”ç©¶ç›¸å…³å®ç°</span></span><br><span class=\"line\">    pending_signals[signal_number] = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    semaphore_signal(sig_sem);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å•ç‹¬èµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹è½®è®­ä¿¡å·æ¥å—æ•°ç»„çš„çŠ¶æ€ï¼Œå°†ç½®ä¸º1çš„ä¿¡å·ç ä¼ ç»™ä¸‹æ¸¸å¤„ç†ã€‚å½“ä¿¡å·ä½-3 SIGQUITä¿¡å·æ—¶ï¼Œå¼€å§‹åˆå§‹åŒ–attachçš„ç›‘å¬æ–¹æ³•ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * å•ç‹¬çº¿ç¨‹å¯¹pending_signalsçŠ¶æ€å¹¶è¿›è¡Œç›¸åº”å¤„ç†</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">signal_thread_entry</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;enter signal_thread_entry&quot;</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> sig;</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            sig = os::signal_wait();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (sig) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> SIGBREAK: &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (AttachListener::init()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>åˆå§‹åŒ–attachç›‘å¬æ–¹æ³•æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªDomain Socketçš„æ–‡ä»¶ç›‘å¬ï¼Œå¹¶acceptåœ¨æ”¹æ–‡ä»¶ä¸Šã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * åˆå§‹åŒ–domain socketç›‘å¬</span></span><br><span class=\"line\"><span class=\"comment\"> * JVMé€šè¿‡ç›‘å¬æŒ‡å®šçº¿ç¨‹æ–‡ä»¶æ–‡ä»¶</span></span><br><span class=\"line\"><span class=\"comment\"> * è·å–clientæƒ³JVMå‘é€çš„æŒ‡ä»¤å¹¶è¿›è¡Œç›¸å…³æ“ä½œ</span></span><br><span class=\"line\"><span class=\"comment\"> * @return</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">AttachListener::pd_init</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">char</span> path[UNIX_PATH_MAX];          <span class=\"comment\">// socket file</span></span><br><span class=\"line\">    <span class=\"keyword\">char</span> initial_path[UNIX_PATH_MAX];  <span class=\"comment\">// socket file during setup</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> listener;                      <span class=\"comment\">// listener socket (file descriptor)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// register function to cleanup</span></span><br><span class=\"line\">    ::atexit(listener_cleanup);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">int</span> n = <span class=\"built_in\">snprintf</span>(path, UNIX_PATH_MAX, <span class=\"string\">&quot;%s/.java_pid%d&quot;</span>,</span><br><span class=\"line\">                     TEMP_PATH, getpid());</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n &lt; (<span class=\"keyword\">int</span>) UNIX_PATH_MAX) &#123;</span><br><span class=\"line\">        n = <span class=\"built_in\">snprintf</span>(initial_path, UNIX_PATH_MAX, <span class=\"string\">&quot;%s.tmp&quot;</span>, path);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (n &gt;= (<span class=\"keyword\">int</span>) UNIX_PATH_MAX) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;path:&quot;</span> &lt;&lt; path &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    <span class=\"comment\">// create the listener socket</span></span><br><span class=\"line\">    listener = ::socket(PF_UNIX, SOCK_STREAM, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (listener == <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// bind socket</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sockaddr_un</span> <span class=\"title\">addr</span>;</span></span><br><span class=\"line\">    addr.sun_family = AF_UNIX;</span><br><span class=\"line\">    <span class=\"built_in\">strcpy</span>(addr.sun_path, initial_path);</span><br><span class=\"line\">    ::unlink(initial_path);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> res = ::bind(listener, (struct sockaddr *) &amp;addr, <span class=\"keyword\">sizeof</span>(addr));</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (res == <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">        ::close(listener);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// put in listen mode, set permissions, and rename into place</span></span><br><span class=\"line\">    res = ::listen(listener, <span class=\"number\">5</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (res == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        RESTARTABLE(::chmod(initial_path, S_IREAD | S_IWRITE), res);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (res == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (res == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                res = ::rename(initial_path, path);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (res == <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">        ::close(listener);</span><br><span class=\"line\">        ::unlink(initial_path);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    set_path(path);</span><br><span class=\"line\">    set_listener(listener);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸€æ—¦æ”¶åˆ°javaå‘é€è¿‡æ¥çš„socketè¯·æ±‚ï¼Œåˆ™è§£æè¯¥è¯·æ±‚å¹¶åŒ…è£…ä¸ºAttachOperationå¯¹è±¡ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * accept domain socketï¼Œè¯»å–åˆ°å†…å®¹åç”Ÿæˆå¯¹åº”çš„AttachOperation</span></span><br><span class=\"line\"><span class=\"comment\"> * @return</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\">AttachOperation *<span class=\"title\">AttachListener::dequeue</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> s;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// wait for client to connect</span></span><br><span class=\"line\">        <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sockaddr</span> <span class=\"title\">addr</span>;</span></span><br><span class=\"line\">        <span class=\"keyword\">socklen_t</span> len = <span class=\"keyword\">sizeof</span>(addr);</span><br><span class=\"line\">        RESTARTABLE(::accept(listener(), &amp;addr, &amp;len), s);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (s == <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;      <span class=\"comment\">// log a warning?</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// get the credentials of the peer and check the effective uid/guid</span></span><br><span class=\"line\">        <span class=\"comment\">// - check with jeff on this.</span></span><br><span class=\"line\">        <span class=\"keyword\">uid_t</span> puid;</span><br><span class=\"line\">        <span class=\"keyword\">gid_t</span> pgid;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (::getpeereid(s, &amp;puid, &amp;pgid) != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            ::close(s);</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">uid_t</span> euid = geteuid();</span><br><span class=\"line\">        <span class=\"keyword\">gid_t</span> egid = getegid();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//æ£€æŸ¥DSæ–‡ä»¶æ˜¯å¦ä¸ºåŒä¸€ä¸ªç”¨æˆ·åˆ›å»º</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (puid != euid || pgid != egid) &#123;</span><br><span class=\"line\">            ::close(s);</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// è¯»å–æ–‡ä»¶å†…å®¹ï¼Œç”ŸæˆAttachOperationå¯¹è±¡</span></span><br><span class=\"line\">        AttachOperation *op = read_request(s);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (op == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">            ::close(s);</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> op;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æœ€åç”¨åŒ…è£…åçš„AttachOperationï¼Œé€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å·²ç»‘å®šçš„å¤„ç†å‡½æ•°ã€‚</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">attach_listener_thread_entry</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> pdint = AttachListener::pd_init();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (pdint != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    AttachListener::set_initialized();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">        AttachOperation* op = AttachListener::dequeue();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (op == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;   <span class=\"comment\">// dequeue failed or shutdown</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// find the function to dispatch too</span></span><br><span class=\"line\">        AttachOperationFunctionInfo* info = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; funcs[i].name != <span class=\"literal\">NULL</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* name = funcs[i].name;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">strcmp</span>(op-&gt;name(), name) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                info = &amp;(funcs[i]);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (info != <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// dispatch to the function that implements this operation</span></span><br><span class=\"line\">            (info-&gt;func)(op);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><font color=\"red\">æ€»ç»“</font> ï¼Œé€šè¿‡ä¿¡å·ç›‘å¬â€“&gt;socketé€šä¿¡â€“&gt;è°ƒç”¨æŒ‡å®šæ–¹æ³•çš„æµç¨‹ï¼Œå®ç°äº†æˆ‘ä»¬å®éªŒçš„é¢„æœŸã€‚</p>\n<h2 id=\"å››ã€çœ‹çœ‹JVMæ˜¯æ€ä¹ˆåšçš„\"><a href=\"#å››ã€çœ‹çœ‹JVMæ˜¯æ€ä¹ˆåšçš„\" class=\"headerlink\" title=\"å››ã€çœ‹çœ‹JVMæ˜¯æ€ä¹ˆåšçš„\"></a>å››ã€çœ‹çœ‹JVMæ˜¯æ€ä¹ˆåšçš„</h2><p>æœ€åæˆ‘ä»¬å›åˆ°JVMå†…éƒ¨ï¼Œçœ‹çœ‹JVMæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>\n<p>ç”±äºå®éªŒä»£ç å¤§é‡çš„é‡‡ç”¨äº†JVMçš„å®ç°ï¼Œæˆ‘ä»¬è¿™é‡Œä¸»è¦è§‚å¯ŸJVMçš„æµç¨‹ã€‚</p>\n<ul>\n<li>JVMå¯åŠ¨æ—¶ä¼šåˆå§‹åŒ–ä¿¡å·çš„ç›‘å¬</li>\n</ul>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/thread.cpp</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">jint <span class=\"title\">Threads::create_vm</span><span class=\"params\">(JavaVMInitArgs* args, <span class=\"keyword\">bool</span>* canTryAgain)</span> </span>&#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Signal Dispatcher needs to be started before VMInit event is posted</span></span><br><span class=\"line\">  os::signal_init();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// Start Attach Listener if +StartAttachListener or it can&#x27;t be started lazily</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!DisableAttachMechanism) &#123;</span><br><span class=\"line\">    AttachListener::vm_start();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (StartAttachListener || AttachListener::init_at_startup()) &#123;</span><br><span class=\"line\">      AttachListener::init();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>os::signal_init();åŠŸèƒ½æˆ‘ä»¬å‰é¢å·²ç»åˆ†æè¿‡ï¼ŒJVMä¼šæ³¨å†Œkill -3ä¿¡å·çš„ç›‘å¬å’Œå¯¹åº”çš„ä¿¡å·å¤„ç†å™¨ï¼ŒåŒæ—¶ä¼šå¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å¯¹ç›‘å¬åˆ°çš„ä¿¡å·åšåç»­ä¸šåŠ¡å¤„ç†ã€‚</p>\n<p><font color=\"blue\">DisableAttachMechanism</font> &amp; <font color=\"blue\">StartAttachListener</font> é»˜è®¤ä¸ºfalseï¼Œåœ¨JVMé»˜è®¤å¯åŠ¨çš„æƒ…å†µä¸‹ä¸ä¼šåˆå§‹åŒ–Attachçš„ç›‘å¬ã€‚</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/globals.hpp</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">product(bool, DisableAttachMechanism, false,                              \\</span><br><span class=\"line\">        &quot;Disable mechanism that allows tools to attach to this VM&quot;) </span><br><span class=\"line\">product(bool, StartAttachListener, false,                                 \\</span><br><span class=\"line\">        &quot;Always start Attach Listener at VM startup&quot;)      </span><br></pre></td></tr></table></figure>\n\n<p>JVMç›‘å¬åˆ°ä¿¡å·åï¼Œå½“ä¿¡å·ä½kill -3æ—¶å¦‚æœè¿˜æœªåˆå§‹åŒ–attachç›‘å¬ï¼Œå°†ä¼šè¿›è¡Œç›¸åº”åˆå§‹åŒ–è¿‡ç¨‹ã€‚</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/thread.cpp-&gt;create_vm()<br>            â€”- src/share/vm/runtime/os.cpp-&gt;signal_init()<br>                â€”- src/share/vm/runtime/os.cpp-&gt;signal_thread_entry()</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">signal_thread_entry</span><span class=\"params\">(JavaThread* thread, TRAPS)</span> </span>&#123;</span><br><span class=\"line\">  os::set_priority(thread, NearMaxPriority);</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> sig;</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"comment\">// FIXME : Currently we have not decieded what should be the status</span></span><br><span class=\"line\">      <span class=\"comment\">//         for this java thread blocked here. Once we decide about</span></span><br><span class=\"line\">      <span class=\"comment\">//         that we should fix this.</span></span><br><span class=\"line\">      sig = os::signal_wait();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sig == os::sigexitnum_pd()) &#123;</span><br><span class=\"line\">       <span class=\"comment\">// Terminate the signal thread</span></span><br><span class=\"line\">       <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (sig) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> SIGBREAK: &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Check if the signal is a trigger to start the Attach Listener - in that</span></span><br><span class=\"line\">        <span class=\"comment\">// case don&#x27;t print stack traces.</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!DisableAttachMechanism &amp;&amp; AttachListener::is_init_trigger()) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// Print stack traces</span></span><br><span class=\"line\">        <span class=\"comment\">// Any SIGBREAK operations added here should make sure to flush</span></span><br><span class=\"line\">        <span class=\"comment\">// the output stream (e.g. tty-&gt;flush()) after output.  See 4803766.</span></span><br><span class=\"line\">        <span class=\"comment\">// Each module also prints an extra carriage return after its output.</span></span><br><span class=\"line\">        VM_PrintThreads op;</span><br><span class=\"line\">        VMThread::execute(&amp;op);</span><br><span class=\"line\">        VM_PrintJNI jni_op;</span><br><span class=\"line\">        VMThread::execute(&amp;jni_op);</span><br><span class=\"line\">        <span class=\"function\">VM_FindDeadlocks <span class=\"title\">op1</span><span class=\"params\">(tty)</span></span>;</span><br><span class=\"line\">        VMThread::execute(&amp;op1);</span><br><span class=\"line\">        Universe::print_heap_at_SIGBREAK();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (PrintClassHistogram) &#123;</span><br><span class=\"line\">          <span class=\"function\">VM_GC_HeapInspection <span class=\"title\">op1</span><span class=\"params\">(gclog_or_tty, <span class=\"literal\">true</span> <span class=\"comment\">/* force full GC before heap inspection */</span>)</span></span>;</span><br><span class=\"line\">          VMThread::execute(&amp;op1);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (JvmtiExport::should_post_data_dump()) &#123;</span><br><span class=\"line\">          JvmtiExport::post_data_dump();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>åˆå§‹åŒ–Attachç›‘å¬æ—¶ä¼šæ£€æŸ¥Javaå®¢æˆ·ç«¯ç”Ÿæˆçš„attachæ–‡ä»¶ã€‚</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/vm/runtime/thread.cpp-&gt;create_vm()<br>            â€”- src/share/vm/runtime/os.cpp-&gt;signal_init()<br>                â€”- src/share/vm/runtime/os.cpp-&gt;signal_thread_entry()<br>                     â€”- src/os/bsd/vm/attachListener_bsd.cpp-&gt;is_init_trigger()</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">AttachListener::is_init_trigger</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (init_at_startup() || is_initialized()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;               <span class=\"comment\">// initialized at startup or already initialized</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">char</span> path[PATH_MAX + <span class=\"number\">1</span>];</span><br><span class=\"line\">  <span class=\"keyword\">int</span> ret;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">stat</span> <span class=\"title\">st</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">snprintf</span>(path, PATH_MAX + <span class=\"number\">1</span>, <span class=\"string\">&quot;%s/.attach_pid%d&quot;</span>,</span><br><span class=\"line\">           os::get_temp_directory(), os::current_process_id());</span><br><span class=\"line\">  RESTARTABLE(::stat(path, &amp;st), ret);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (ret == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// simple check to avoid starting the attach mechanism when</span></span><br><span class=\"line\">    <span class=\"comment\">// a bogus user creates the file</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (st.st_uid == geteuid()) &#123;</span><br><span class=\"line\">      init();</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç¡®è®¤Javaå®¢æˆ·ç«¯å¼€å§‹attachå¹¶ä¸”æƒé™æ ¡éªŒé€šè¿‡åå¼€å§‹socketé€šè®¯ï¼Œé¦–å…ˆåˆå§‹åŒ–socketå¹¶ç»‘å®šç›‘å¬ã€‚</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼š src/os/bsd/vm/attachListener_bsd.cpp-&gt;is_init_trigger()<br>            â€”- src/share/vm/services/attachListener.cpp-&gt;init()</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">AttachListener::is_init_trigger</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (init_at_startup() || is_initialized()) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;               <span class=\"comment\">// initialized at startup or already initialized</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">char</span> path[PATH_MAX + <span class=\"number\">1</span>];</span><br><span class=\"line\">  <span class=\"keyword\">int</span> ret;</span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">stat</span> <span class=\"title\">st</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">snprintf</span>(path, PATH_MAX + <span class=\"number\">1</span>, <span class=\"string\">&quot;%s/.attach_pid%d&quot;</span>,</span><br><span class=\"line\">           os::get_temp_directory(), os::current_process_id());</span><br><span class=\"line\">  RESTARTABLE(::stat(path, &amp;st), ret);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (ret == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// simple check to avoid starting the attach mechanism when</span></span><br><span class=\"line\">    <span class=\"comment\">// a bogus user creates the file</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (st.st_uid == geteuid()) &#123;</span><br><span class=\"line\">      init();</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æœ€ç»ˆJVMåˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ‰§è¡ŒAttachç›‘å¬æ–¹æ³•ï¼Œæ–¹æ³•acceptä»Javaå®¢æˆ·ç«¯å‘é€çš„æŒ‡ä»¤ï¼Œå¹¶è§£æä¸ºå¯¹åº”çš„å‡½æ•°ã€‚</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼š src/share/vm/services/attachListener.cpp-&gt;init()<br>            â€”- src/share/vm/services/attachListener.cpp-&gt;attach_listener_thread_entry()</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">attach_listener_thread_entry</span><span class=\"params\">(JavaThread* thread, TRAPS)</span> </span>&#123;</span><br><span class=\"line\">  os::set_priority(thread, NearMaxPriority);</span><br><span class=\"line\"></span><br><span class=\"line\">  thread-&gt;record_stack_base_and_size();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (AttachListener::pd_init() != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  AttachListener::set_initialized();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">    AttachOperation* op = AttachListener::dequeue();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (op == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span>;   <span class=\"comment\">// dequeue failed or shutdown</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ResourceMark rm;</span><br><span class=\"line\">    bufferedStream st;</span><br><span class=\"line\">    jint res = JNI_OK;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// handle special detachall operation</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">strcmp</span>(op-&gt;name(), AttachOperation::detachall_operation_name()) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      AttachListener::detachall();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// find the function to dispatch too</span></span><br><span class=\"line\">      AttachOperationFunctionInfo* info = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; funcs[i].name != <span class=\"literal\">NULL</span>; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* name = funcs[i].name;</span><br><span class=\"line\">        assert(<span class=\"built_in\">strlen</span>(name) &lt;= AttachOperation::name_length_max, <span class=\"string\">&quot;operation &lt;= name_length_max&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"built_in\">strcmp</span>(op-&gt;name(), name) == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">          info = &amp;(funcs[i]);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">// check for platform dependent attach operation</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (info == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        info = AttachListener::pd_find_operation(op-&gt;name());</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> (info != <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// dispatch to the function that implements this operation</span></span><br><span class=\"line\">        res = (info-&gt;func)(op, &amp;st);</span><br><span class=\"line\">      &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        st.print(<span class=\"string\">&quot;Operation %s not recognized!&quot;</span>, op-&gt;name());</span><br><span class=\"line\">        res = JNI_ERR;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// operation complete - send result and output to client</span></span><br><span class=\"line\">    op-&gt;complete(res, &amp;st);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼š src/share/vm/services/attachListener.cpp-&gt;attach_listener_thread_entry()<br>            â€”- src/os/bsd/vm/attachListener_bsd.cpp-&gt;dequeue()<br>                 â€”- src/os/bsd/vm/attachListener_bsd.cpp-&gt;BsdAttachListener::dequeue()</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">BsdAttachOperation* <span class=\"title\">BsdAttachListener::dequeue</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (;;) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> s;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// wait for client to connect</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sockaddr</span> <span class=\"title\">addr</span>;</span></span><br><span class=\"line\">    <span class=\"keyword\">socklen_t</span> len = <span class=\"keyword\">sizeof</span>(addr);</span><br><span class=\"line\">    RESTARTABLE(::accept(listener(), &amp;addr, &amp;len), s);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s == <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;      <span class=\"comment\">// log a warning?</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// get the credentials of the peer and check the effective uid/guid</span></span><br><span class=\"line\">    <span class=\"comment\">// - check with jeff on this.</span></span><br><span class=\"line\">    <span class=\"keyword\">uid_t</span> puid;</span><br><span class=\"line\">    <span class=\"keyword\">gid_t</span> pgid;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (::getpeereid(s, &amp;puid, &amp;pgid) != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      ::close(s);</span><br><span class=\"line\">      <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">uid_t</span> euid = geteuid();</span><br><span class=\"line\">    <span class=\"keyword\">gid_t</span> egid = getegid();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (puid != euid || pgid != egid) &#123;</span><br><span class=\"line\">      ::close(s);</span><br><span class=\"line\">      <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// peer credential look okay so we read the request</span></span><br><span class=\"line\">    BsdAttachOperation* op = read_request(s);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (op == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">      ::close(s);</span><br><span class=\"line\">      <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> op;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æŒ‡ä»¤ä¸æ–¹æ³•çš„æ˜ å°„æ˜¯äº‹å…ˆå‡†å¤‡å¥½çš„</p>\n<blockquote>\n<p>ä»£ç æ¸…å•ï¼šsrc/share/vm/services/attachListener.cpp</p>\n</blockquote>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> AttachOperationFunctionInfo funcs[] = &#123;</span><br><span class=\"line\">  &#123; <span class=\"string\">&quot;agentProperties&quot;</span>,  get_agent_properties &#125;,</span><br><span class=\"line\">  &#123; <span class=\"string\">&quot;datadump&quot;</span>,         data_dump &#125;,</span><br><span class=\"line\">  &#123; <span class=\"string\">&quot;dumpheap&quot;</span>,         dump_heap &#125;,</span><br><span class=\"line\">  &#123; <span class=\"string\">&quot;load&quot;</span>,             JvmtiExport::load_agent_library &#125;,</span><br><span class=\"line\">  &#123; <span class=\"string\">&quot;properties&quot;</span>,       get_system_properties &#125;,</span><br><span class=\"line\">  &#123; <span class=\"string\">&quot;threaddump&quot;</span>,       thread_dump &#125;,</span><br><span class=\"line\">  &#123; <span class=\"string\">&quot;inspectheap&quot;</span>,      heap_inspection &#125;,</span><br><span class=\"line\">  &#123; <span class=\"string\">&quot;setflag&quot;</span>,          set_flag &#125;,</span><br><span class=\"line\">  &#123; <span class=\"string\">&quot;printflag&quot;</span>,        print_flag &#125;,</span><br><span class=\"line\">  &#123; <span class=\"string\">&quot;jcmd&quot;</span>,             jcmd &#125;,</span><br><span class=\"line\">  &#123; <span class=\"literal\">NULL</span>,               <span class=\"literal\">NULL</span> &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n\n<p><font color=\"red\">æ€»ç»“</font>,ç›¸ä¿¡é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å·²ç»æ¸…æ¥šçš„äº†è§£JVMæ˜¯å¦‚ä½•æ¥æ”¶åˆ°Javaå®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œä»è€Œå®ç°åŠ¨æ€Attachçš„åŠŸèƒ½ã€‚å…·ä½“æµç¨‹å¦‚å›¾ï¼š<br><img src=\"/2020/09/21/%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90JVM-%E5%8A%A8%E6%80%81Attach%E5%8E%9F%E7%90%86/flow.png\" alt=\"03\"></p>"}],"PostAsset":[{"_id":"source/_posts/CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º/pull.png","slug":"pull.png","post":"ckis71hsv0001v252awm830es","modified":0,"renderable":0},{"_id":"source/_posts/CSAPP-Dockerå®éªŒç¯å¢ƒæ­å»º/search.png","slug":"search.png","post":"ckis71hsv0001v252awm830es","modified":0,"renderable":0},{"_id":"source/_posts/Harmonica/GodenMelody.jpeg","slug":"GodenMelody.jpeg","post":"ckis71hsz0003v2522odqc0cl","modified":0,"renderable":0},{"_id":"source/_posts/Harmonica/SilverStar.jpeg","slug":"SilverStar.jpeg","post":"ckis71hsz0003v2522odqc0cl","modified":0,"renderable":0},{"_id":"source/_posts/hexoæ­å»ºé—®é¢˜ã€-no-layout-index-htmlã€‘/nolayout.jpg","slug":"nolayout.jpg","post":"ckis71ht6000cv2526aao0clh","modified":0,"renderable":0},{"_id":"source/_posts/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/springCache.png","slug":"springCache.png","post":"ckis71hta000hv252gby12mkn","modified":0,"renderable":0},{"_id":"source/_posts/ä¸€ä¸ªäº‹æ•…å¼•èµ·çš„ç¼“å­˜/å¤šçº§ç¼“å­˜.png","slug":"å¤šçº§ç¼“å­˜.png","post":"ckis71hta000hv252gby12mkn","modified":0,"renderable":0},{"_id":"source/_posts/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/flink-local.png","slug":"flink-local.png","post":"ckis71hth000wv252el9hayof","modified":0,"renderable":0},{"_id":"source/_posts/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-dashboard.png","slug":"rocketmq-dashboard.png","post":"ckis71hth000wv252el9hayof","modified":0,"renderable":0},{"_id":"source/_posts/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-message.png","slug":"rocketmq-message.png","post":"ckis71hth000wv252el9hayof","modified":0,"renderable":0},{"_id":"source/_posts/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/rocketmq-topic.png","slug":"rocketmq-topic.png","post":"ckis71hth000wv252el9hayof","modified":0,"renderable":0},{"_id":"source/_posts/åŸºäºFlinkæ¨é€æŠ¥è­¦ä¿¡æ¯-æµ‹è¯•/wechat-message.png","slug":"wechat-message.png","post":"ckis71hth000wv252el9hayof","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/addGroup.png","slug":"addGroup.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/allocate.png","slug":"allocate.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/allocateConfigs.png","slug":"allocateConfigs.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/clientLog.png","slug":"clientLog.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/compare.png","slug":"compare.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/completeTask.png","slug":"completeTask.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/configs.png","slug":"configs.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/history.png","slug":"history.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/instance.png","slug":"instance.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/instanceConfig.png","slug":"instanceConfig.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/metadata.png","slug":"metadata.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/operationLog.png","slug":"operationLog.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/pendingTask.png","slug":"pendingTask.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/processingTask.png","slug":"processingTask.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/role.png","slug":"role.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/switch.png","slug":"switch.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/user.png","slug":"user.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/ä¸»é¡µé¢.png","slug":"ä¸»é¡µé¢.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/æœåŠ¡éƒ¨ç½²å›¾.png","slug":"æœåŠ¡éƒ¨ç½²å›¾.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/æ³¨å†Œ.png","slug":"æ³¨å†Œ.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-ä»‹ç»ç¯‡/ç™»å½•.png","slug":"ç™»å½•.png","post":"ckis71htk0012v252dysvfnfm","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/CentOS6-Base-163.repo","slug":"CentOS6-Base-163.repo","post":"ckis71htm0018v252039k1qwo","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/å®¢æˆ·ç«¯å¯åŠ¨å¹¶æ›´æ–°é…ç½®.png","slug":"å®¢æˆ·ç«¯å¯åŠ¨å¹¶æ›´æ–°é…ç½®.png","post":"ckis71htm0018v252039k1qwo","modified":0,"renderable":0},{"_id":"source/_posts/æˆ‘ä¸ºä»€ä¹ˆä¼šé‡æ–°å†™ä¸€ä¸ªé…ç½®ä¸­å¿ƒ-è®¾è®¡ç¯‡2/æœåŠ¡ç«¯çƒ­æ›´æ–°é…ç½®.png","slug":"æœåŠ¡ç«¯çƒ­æ›´æ–°é…ç½®.png","post":"ckis71htm0018v252039k1qwo","modified":0,"renderable":0},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°1/gopath.png","slug":"gopath.png","post":"ckis71hts001nv252hbb3dttk","modified":0,"renderable":0},{"_id":"source/_posts/è‡ªå·±åŠ¨æ‰‹å†™Javaè™šæ‹Ÿæœº-ç¬”è®°4/è¿è¡Œæ—¶æ•°æ®åŒº.png","slug":"è¿è¡Œæ—¶æ•°æ®åŒº.png","post":"ckis71htx001yv252bj0094ri","modified":0,"renderable":0},{"_id":"source/_posts/è®°ä¸€æ¬¡åºåˆ—åŒ–å¤±è´¥å¯¼è‡´çš„ç”Ÿäº§é—®é¢˜/wenti.png","slug":"wenti.png","post":"ckis71hty0021v2526zju8kpj","modified":0,"renderable":0},{"_id":"source/_posts/ğŸ‡/å…¨æ™¯.jpeg","slug":"å…¨æ™¯.jpeg","post":"ckis71htz0023v2523flh1jar","modified":0,"renderable":0},{"_id":"source/_posts/ğŸ‡/ç‰Œå­.jpeg","slug":"ç‰Œå­.jpeg","post":"ckis71htz0023v2523flh1jar","modified":0,"renderable":0},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/BytecodeVerificationJunit.png","slug":"BytecodeVerificationJunit.png","post":"ckis71huj004nv252f90fazco","modified":0,"renderable":0},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/BytecodeVerificationWithApp.png","slug":"BytecodeVerificationWithApp.png","post":"ckis71huj004nv252f90fazco","modified":0,"renderable":0},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/class_browser.png","slug":"class_browser.png","post":"ckis71huj004nv252f90fazco","modified":0,"renderable":0},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/classloadæ–­ç‚¹.png","slug":"classloadæ–­ç‚¹.png","post":"ckis71huj004nv252f90fazco","modified":0,"renderable":0},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/constantpool.png","slug":"constantpool.png","post":"ckis71huj004nv252f90fazco","modified":0,"renderable":0},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/hdbs_attach.png","slug":"hdbs_attach.png","post":"ckis71huj004nv252f90fazco","modified":0,"renderable":0},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/idea.png","slug":"idea.png","post":"ckis71huj004nv252f90fazco","modified":0,"renderable":0},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/jps.png","slug":"jps.png","post":"ckis71huj004nv252f90fazco","modified":0,"renderable":0},{"_id":"source/_posts/fastjsonåºåˆ—åŒ–å¼‚å¸¸æ’æŸ¥/visualVM.png","slug":"visualVM.png","post":"ckis71huj004nv252f90fazco","modified":0,"renderable":0},{"_id":"source/_posts/æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/JVM_start.png","slug":"JVM_start.png","post":"ckis71hul004qv252637lc9sc","modified":0,"renderable":0},{"_id":"source/_posts/æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/flow.png","slug":"flow.png","post":"ckis71hul004qv252637lc9sc","modified":0,"renderable":0},{"_id":"source/_posts/æ·±åº¦è§£æJVM-åŠ¨æ€AttachåŸç†/load_agent_library.png","slug":"load_agent_library.png","post":"ckis71hul004qv252637lc9sc","modified":0,"renderable":0}],"PostCategory":[{"post_id":"ckis71ht30008v252fd3b0ipn","category_id":"ckis71ht00004v25299na538q","_id":"ckis71ht8000ev2523azvacrl"},{"post_id":"ckis71hsv0001v252awm830es","category_id":"ckis71ht00004v25299na538q","_id":"ckis71htb000iv252431z2hkd"},{"post_id":"ckis71ht40009v252hkw3edgq","category_id":"ckis71ht00004v25299na538q","_id":"ckis71htc000lv2526fi1dtub"},{"post_id":"ckis71ht6000cv2526aao0clh","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hte000pv2523f1q26qb"},{"post_id":"ckis71hsz0003v2522odqc0cl","category_id":"ckis71ht5000av252cpwx47dv","_id":"ckis71htf000sv252exte8e30"},{"post_id":"ckis71ht7000dv2527ey8fo8p","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hth000vv2529xoi8lka"},{"post_id":"ckis71hta000hv252gby12mkn","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hth000xv252fhcsh36s"},{"post_id":"ckis71ht20007v252axr85fg5","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hti000zv2525zq18kvl"},{"post_id":"ckis71htc000kv25248magx16","category_id":"ckis71ht00004v25299na538q","_id":"ckis71htl0013v2520t667rlu"},{"post_id":"ckis71htd000ov2529oao6um7","category_id":"ckis71ht00004v25299na538q","_id":"ckis71htl0016v2526qypbi06"},{"post_id":"ckis71htf000rv2524z0l9tfk","category_id":"ckis71ht00004v25299na538q","_id":"ckis71htn0019v25259akf9k6"},{"post_id":"ckis71htg000uv25243rb7mpl","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hto001bv2529qef1ot4"},{"post_id":"ckis71hth000wv252el9hayof","category_id":"ckis71ht00004v25299na538q","_id":"ckis71htp001ev2528axk10ij"},{"post_id":"ckis71hti000yv252112dc7je","category_id":"ckis71ht00004v25299na538q","_id":"ckis71htq001hv25294nodzfu"},{"post_id":"ckis71htk0012v252dysvfnfm","category_id":"ckis71ht00004v25299na538q","_id":"ckis71htr001lv252evf85cnu"},{"post_id":"ckis71htl0015v2521jmd29wg","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hts001ov2526ehsghmg"},{"post_id":"ckis71htm0018v252039k1qwo","category_id":"ckis71ht00004v25299na538q","_id":"ckis71htw001sv252c5r13qkd"},{"post_id":"ckis71htn001av252bj839727","category_id":"ckis71ht00004v25299na538q","_id":"ckis71htw001vv2525e771v86"},{"post_id":"ckis71hto001dv2527yj851zv","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hty001zv252593mdnww"},{"post_id":"ckis71htq001kv252amvo3uoz","category_id":"ckis71ht00004v25299na538q","_id":"ckis71htz0022v252eschewgh"},{"post_id":"ckis71hts001nv252hbb3dttk","category_id":"ckis71ht00004v25299na538q","_id":"ckis71htz0024v252fdo63uvb"},{"post_id":"ckis71htt001rv2527zex6mbp","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hu00027v2521x87hsuu"},{"post_id":"ckis71htp001gv252ehia4tyn","category_id":"ckis71htr001mv252fp9k9bwp","_id":"ckis71hu1002av252dwr3e2j0"},{"post_id":"ckis71htw001uv2525k2udzt3","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hu1002cv2526vhs8x9l"},{"post_id":"ckis71htx001yv252bj0094ri","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hu1002dv252die2940p"},{"post_id":"ckis71hty0021v2526zju8kpj","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hu2002fv2523uy6e781"},{"post_id":"ckis71htz0023v2523flh1jar","category_id":"ckis71hu00028v252enjlgu71","_id":"ckis71hu2002gv2527yyrc2rj"},{"post_id":"ckis71huj004nv252f90fazco","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hum004sv2529r5596fx"},{"post_id":"ckis71huk004ov252bwtrab0t","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hum004uv2524jcq953j"},{"post_id":"ckis71hul004qv252637lc9sc","category_id":"ckis71ht00004v25299na538q","_id":"ckis71hun004xv252dfq8ban2"}],"PostTag":[{"post_id":"ckis71hsv0001v252awm830es","tag_id":"ckis71ht10005v2523nu2hftc","_id":"ckis71htb000jv2528855f0re"},{"post_id":"ckis71hsv0001v252awm830es","tag_id":"ckis71ht5000bv2520enu5s1w","_id":"ckis71htc000mv25264x25m3q"},{"post_id":"ckis71hsz0003v2522odqc0cl","tag_id":"ckis71ht8000gv2522qizfd05","_id":"ckis71hte000qv252ax7w9uw6"},{"post_id":"ckis71ht20007v252axr85fg5","tag_id":"ckis71htd000nv2522dfn8srp","_id":"ckis71htk0011v2520pr8dcgx"},{"post_id":"ckis71ht20007v252axr85fg5","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71htl0014v2521hwx6ikk"},{"post_id":"ckis71ht30008v252fd3b0ipn","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71htp001fv252hgfkcsbc"},{"post_id":"ckis71ht30008v252fd3b0ipn","tag_id":"ckis71htm0017v25222fjhnur","_id":"ckis71htq001iv252brb160s1"},{"post_id":"ckis71htq001kv252amvo3uoz","tag_id":"ckis71ht5000bv2520enu5s1w","_id":"ckis71htt001qv252huak4144"},{"post_id":"ckis71ht40009v252hkw3edgq","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71htw001tv252aeo593cu"},{"post_id":"ckis71ht40009v252hkw3edgq","tag_id":"ckis71htq001jv252ed8p1rgy","_id":"ckis71htx001wv252g9sd4xvz"},{"post_id":"ckis71ht6000cv2526aao0clh","tag_id":"ckis71hts001pv25271l49ht8","_id":"ckis71hty0020v2522zq9hol4"},{"post_id":"ckis71ht7000dv2527ey8fo8p","tag_id":"ckis71htx001xv25245zncqgy","_id":"ckis71hu00026v252g6p4d3cf"},{"post_id":"ckis71ht7000dv2527ey8fo8p","tag_id":"ckis71ht5000bv2520enu5s1w","_id":"ckis71hu10029v252afrqga2n"},{"post_id":"ckis71hta000hv252gby12mkn","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hu2002iv2529i98g70x"},{"post_id":"ckis71hta000hv252gby12mkn","tag_id":"ckis71hu1002bv2527t6xh8tx","_id":"ckis71hu2002jv252a2hoabz2"},{"post_id":"ckis71hta000hv252gby12mkn","tag_id":"ckis71hu1002ev252au6f5qbk","_id":"ckis71hu3002lv2520pqchgf9"},{"post_id":"ckis71htc000kv25248magx16","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hu3002mv252erz67s3j"},{"post_id":"ckis71htd000ov2529oao6um7","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hu3002ov252a8dhdstx"},{"post_id":"ckis71htf000rv2524z0l9tfk","tag_id":"ckis71ht5000bv2520enu5s1w","_id":"ckis71hu4002rv2524z971tkm"},{"post_id":"ckis71htf000rv2524z0l9tfk","tag_id":"ckis71hu3002nv252bwb92m3t","_id":"ckis71hu4002sv252b7ht92i0"},{"post_id":"ckis71htf000rv2524z0l9tfk","tag_id":"ckis71hu3002pv252d2xw7o9u","_id":"ckis71hu4002uv2523nf664jj"},{"post_id":"ckis71htg000uv25243rb7mpl","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hu5002xv252ee62czix"},{"post_id":"ckis71htg000uv25243rb7mpl","tag_id":"ckis71hu4002tv252fsqre997","_id":"ckis71hu5002yv2528fgb5oe7"},{"post_id":"ckis71htg000uv25243rb7mpl","tag_id":"ckis71hu4002vv252bfxbdxgo","_id":"ckis71hu50030v2521cph26k8"},{"post_id":"ckis71hth000wv252el9hayof","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hu60032v252bf3tadu8"},{"post_id":"ckis71hth000wv252el9hayof","tag_id":"ckis71hu4002tv252fsqre997","_id":"ckis71hu60033v252dws96ap7"},{"post_id":"ckis71hth000wv252el9hayof","tag_id":"ckis71hu4002vv252bfxbdxgo","_id":"ckis71hu60035v2523gnob2je"},{"post_id":"ckis71hti000yv252112dc7je","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hu70037v252gwcu1j71"},{"post_id":"ckis71hti000yv252112dc7je","tag_id":"ckis71hu4002tv252fsqre997","_id":"ckis71hu70038v252frzoft72"},{"post_id":"ckis71hti000yv252112dc7je","tag_id":"ckis71hu4002vv252bfxbdxgo","_id":"ckis71hu7003av2524uord9dn"},{"post_id":"ckis71htk0012v252dysvfnfm","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hu8003cv2523dfoc12o"},{"post_id":"ckis71htk0012v252dysvfnfm","tag_id":"ckis71hu1002bv2527t6xh8tx","_id":"ckis71hu8003dv25284g0592p"},{"post_id":"ckis71htk0012v252dysvfnfm","tag_id":"ckis71hu70039v2522ca114iv","_id":"ckis71hu8003fv252001ngohs"},{"post_id":"ckis71htl0015v2521jmd29wg","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hu9003hv2524k9a745w"},{"post_id":"ckis71htl0015v2521jmd29wg","tag_id":"ckis71hu1002bv2527t6xh8tx","_id":"ckis71hu9003iv25201r5fclf"},{"post_id":"ckis71htl0015v2521jmd29wg","tag_id":"ckis71hu70039v2522ca114iv","_id":"ckis71hu9003kv252f4m8a16p"},{"post_id":"ckis71htm0018v252039k1qwo","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hua003mv2522hojds2i"},{"post_id":"ckis71htm0018v252039k1qwo","tag_id":"ckis71hu1002bv2527t6xh8tx","_id":"ckis71hua003nv2524hos2gi3"},{"post_id":"ckis71htm0018v252039k1qwo","tag_id":"ckis71hu70039v2522ca114iv","_id":"ckis71hua003pv2529d4cbhsj"},{"post_id":"ckis71htn001av252bj839727","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hub003rv2522b9w1aqa"},{"post_id":"ckis71htn001av252bj839727","tag_id":"ckis71hu1002bv2527t6xh8tx","_id":"ckis71hub003sv252e0xs87z8"},{"post_id":"ckis71htn001av252bj839727","tag_id":"ckis71hu70039v2522ca114iv","_id":"ckis71hub003uv252160h1na9"},{"post_id":"ckis71hto001dv2527yj851zv","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71huc003wv2526tnh1ki3"},{"post_id":"ckis71hto001dv2527yj851zv","tag_id":"ckis71hu1002bv2527t6xh8tx","_id":"ckis71huc003xv2520ggid11j"},{"post_id":"ckis71hto001dv2527yj851zv","tag_id":"ckis71hu70039v2522ca114iv","_id":"ckis71huc003zv2529z0t8wwv"},{"post_id":"ckis71htp001gv252ehia4tyn","tag_id":"ckis71hub003vv2523scgaxhb","_id":"ckis71hud0041v252bs4l3t8e"},{"post_id":"ckis71htp001gv252ehia4tyn","tag_id":"ckis71huc003yv2523kchbmxs","_id":"ckis71hud0042v2527j46hmmz"},{"post_id":"ckis71hts001nv252hbb3dttk","tag_id":"ckis71htd000nv2522dfn8srp","_id":"ckis71hud0044v2520t159hcr"},{"post_id":"ckis71hts001nv252hbb3dttk","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hud0045v2522vu676br"},{"post_id":"ckis71hts001nv252hbb3dttk","tag_id":"ckis71huc0040v252960e7h44","_id":"ckis71hue0047v25292s57kpi"},{"post_id":"ckis71htt001rv2527zex6mbp","tag_id":"ckis71htd000nv2522dfn8srp","_id":"ckis71hue0048v252bzvwcxcv"},{"post_id":"ckis71htt001rv2527zex6mbp","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71huf004av2526za0f6cp"},{"post_id":"ckis71htt001rv2527zex6mbp","tag_id":"ckis71huc0040v252960e7h44","_id":"ckis71huf004bv2523l998dot"},{"post_id":"ckis71htw001uv2525k2udzt3","tag_id":"ckis71htd000nv2522dfn8srp","_id":"ckis71huf004dv252amgc09b7"},{"post_id":"ckis71htw001uv2525k2udzt3","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hug004ev25227y4a41t"},{"post_id":"ckis71htw001uv2525k2udzt3","tag_id":"ckis71huc0040v252960e7h44","_id":"ckis71hug004gv252b91m2e3q"},{"post_id":"ckis71htx001yv252bj0094ri","tag_id":"ckis71htd000nv2522dfn8srp","_id":"ckis71hug004hv252aj2z2fsr"},{"post_id":"ckis71htx001yv252bj0094ri","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hug004iv252fwzja2vz"},{"post_id":"ckis71htx001yv252bj0094ri","tag_id":"ckis71huc0040v252960e7h44","_id":"ckis71hug004jv252bk941ktl"},{"post_id":"ckis71hty0021v2526zju8kpj","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hug004kv2528lug1c3i"},{"post_id":"ckis71hty0021v2526zju8kpj","tag_id":"ckis71huf004cv2524gq851pa","_id":"ckis71hug004lv2523g6p42p8"},{"post_id":"ckis71htz0023v2523flh1jar","tag_id":"ckis71hug004fv2523wbecrky","_id":"ckis71hug004mv252h38icqys"},{"post_id":"ckis71huk004ov252bwtrab0t","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hum004rv2529nxoddx6"},{"post_id":"ckis71huk004ov252bwtrab0t","tag_id":"ckis71hu1002bv2527t6xh8tx","_id":"ckis71hum004tv25219hqdyza"},{"post_id":"ckis71huk004ov252bwtrab0t","tag_id":"ckis71hu70039v2522ca114iv","_id":"ckis71hun004wv2520pu23myh"},{"post_id":"ckis71hul004qv252637lc9sc","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hun004yv2527hmahthr"},{"post_id":"ckis71hul004qv252637lc9sc","tag_id":"ckis71htd000nv2522dfn8srp","_id":"ckis71hun004zv252bfyqd1fw"},{"post_id":"ckis71huj004nv252f90fazco","tag_id":"ckis71htg000tv2529k5h69wd","_id":"ckis71hun0050v2526xq6f4ft"},{"post_id":"ckis71huj004nv252f90fazco","tag_id":"ckis71hul004pv2527a3v7m3q","_id":"ckis71hun0051v2521o7q9p7z"},{"post_id":"ckis71huj004nv252f90fazco","tag_id":"ckis71hum004vv252hv2309hj","_id":"ckis71hun0052v252357063d9"}],"Tag":[{"name":"CSAPP","_id":"ckis71ht10005v2523nu2hftc"},{"name":"C","_id":"ckis71ht5000bv2520enu5s1w"},{"name":"Harmonica","_id":"ckis71ht8000gv2522qizfd05"},{"name":"JVM","_id":"ckis71htd000nv2522dfn8srp"},{"name":"Java","_id":"ckis71htg000tv2529k5h69wd"},{"name":"IO","_id":"ckis71htm0017v25222fjhnur"},{"name":"Springboot","_id":"ckis71htq001jv252ed8p1rgy"},{"name":"Hexo","_id":"ckis71hts001pv25271l49ht8"},{"name":"Linux","_id":"ckis71htx001xv25245zncqgy"},{"name":"Redis","_id":"ckis71hu1002bv2527t6xh8tx"},{"name":"Cache","_id":"ckis71hu1002ev252au6f5qbk"},{"name":"GCC","_id":"ckis71hu3002nv252bwb92m3t"},{"name":"ä»£ç ä¼˜åŒ–","_id":"ckis71hu3002pv252d2xw7o9u"},{"name":"Flink","_id":"ckis71hu4002tv252fsqre997"},{"name":"ç›‘æ§","_id":"ckis71hu4002vv252bfxbdxgo"},{"name":"é…ç½®ä¸­å¿ƒ","_id":"ckis71hu70039v2522ca114iv"},{"name":"AI","_id":"ckis71hub003vv2523scgaxhb"},{"name":"APP","_id":"ckis71huc003yv2523kchbmxs"},{"name":"Go","_id":"ckis71huc0040v252960e7h44"},{"name":"Spring Boot","_id":"ckis71huf004cv2524gq851pa"},{"name":"Food","_id":"ckis71hug004fv2523wbecrky"},{"name":"fastjson","_id":"ckis71hul004pv2527a3v7m3q"},{"name":"ASM","_id":"ckis71hum004vv252hv2309hj"}]}}